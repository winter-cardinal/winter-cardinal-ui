{"version":3,"file":"wcardinal-ui.min.js","sources":["wcardinal/ui/shape/e-shape-deserializers.ts","wcardinal/ui/shape/e-shape-type.ts","wcardinal/ui/shape/e-shape-uploadeds.ts","wcardinal/ui/shape/e-shape-uploaded.ts","wcardinal/ui/shape/e-shape-stroke-style.ts","wcardinal/ui/shape/variant/to-dash.ts","wcardinal/ui/shape/variant/to-scale-invariant.ts","wcardinal/ui/shape/variant/build-bar.ts","wcardinal/ui/util/util-character-iterator.ts","wcardinal/ui/shape/e-shape-text.ts","wcardinal/ui/shape/e-shape-text-align-horizontal.ts","wcardinal/ui/shape/e-shape-text-align-vertical.ts","wcardinal/ui/shape/e-shape-text-direction.ts","wcardinal/ui/shape/variant/to-length.ts","wcardinal/ui/shape/variant/build-text.ts","../../../node_modules/tslib/tslib.es6.js","wcardinal/ui/shape/e-shape-points-style.ts","wcardinal/ui/shape/variant/e-shape-data-impl.ts","wcardinal/ui/shape/variant/build-line.ts","wcardinal/ui/shape/variant/build-color.ts","wcardinal/ui/shape/variant/builder-base.ts","wcardinal/ui/shape/variant/builders.ts","wcardinal/ui/theme/d-themes.ts","wcardinal/ui/shape/e-shape-defaults.ts","wcardinal/ui/shape/e-shape-points-marker-type.ts","wcardinal/ui/shape/variant/e-shape-fill-impl.ts","wcardinal/ui/shape/e-shape-points-marker-noop.ts","wcardinal/ui/shape/e-shape-points-marker-container-impl-noop.ts","wcardinal/ui/shape/variant/e-shape-bar-position.ts","wcardinal/ui/shape/variant/e-shape-bar-points.ts","wcardinal/ui/shape/variant/e-shape-line-base-hit-part.ts","wcardinal/ui/shape/e-shape-corner.ts","wcardinal/ui/d-applications.ts","wcardinal/ui/shape/action/e-shape-action.ts","wcardinal/ui/shape/e-shape-connector-container-impl.ts","wcardinal/ui/shape/e-shape-copy-part.ts","wcardinal/ui/d-base-state.ts","wcardinal/ui/util/is-function.ts","wcardinal/ui/util/is-string.ts","wcardinal/ui/d-base-state-set-impl.ts","wcardinal/ui/d-base-state-set-impl-observable.ts","wcardinal/ui/shape/e-shape-state.ts","wcardinal/ui/shape/e-shape-state-set-impl-observable.ts","wcardinal/ui/shape/e-shape-transform.ts","wcardinal/ui/shape/variant/e-shape-base-hit-test-data.ts","wcardinal/ui/shape/variant/hit-test-bbox.ts","wcardinal/ui/shape/variant/to-gradient-serialized.ts","wcardinal/ui/shape/variant/e-shape-base.ts","wcardinal/ui/shape/variant/e-shape-stroke-impl.ts","wcardinal/ui/shape/e-shape-data-value.ts","wcardinal/ui/shape/e-shape-data-value-range.ts","wcardinal/ui/shape/variant/e-shape-data-value-range-impl.ts","wcardinal/ui/shape/variant/e-shape-data-value-impl.ts","wcardinal/ui/shape/variant/e-shape-text-align-impl.ts","wcardinal/ui/shape/variant/e-shape-text-offset-impl.ts","wcardinal/ui/shape/variant/e-shape-text-outline-impl.ts","wcardinal/ui/shape/variant/e-shape-text-impl.ts","wcardinal/ui/shape/variant/e-shape-primitive.ts","wcardinal/ui/shape/variant/hit-test-circle.ts","wcardinal/ui/shape/e-shape-stroke-side.ts","wcardinal/ui/shape/variant/hit-test-rectangle.ts","wcardinal/ui/shape/variant/hit-test-triangle.ts","wcardinal/ui/shape/variant/to-threshold-default.ts","wcardinal/ui/shape/variant/e-shape-line-base.ts","wcardinal/ui/shape/variant/e-shape-bar.ts","wcardinal/ui/shape/variant/builder-bar.ts","wcardinal/ui/shape/variant/builder-text.ts","wcardinal/ui/shape/variant/create-bar-uploaded.ts","wcardinal/ui/util/is-array.ts","wcardinal/ui/util/is-number.ts","wcardinal/ui/util/to-padded.ts","wcardinal/ui/util/util-rgb.ts","wcardinal/ui/util/util-keyboard-event.ts","wcardinal/ui/shape/e-shape-runtime.ts","wcardinal/ui/shape/action/e-shape-action-bases.ts","wcardinal/ui/shape/action/e-shape-action-expressions.ts","wcardinal/ui/shape/action/e-shape-action-runtime.ts","wcardinal/ui/shape/action/e-shape-action-runtime-conditional.ts","wcardinal/ui/shape/action/e-shape-action-runtime-blink.ts","wcardinal/ui/shape/action/e-shape-action-runtime-blink-brighten.ts","wcardinal/ui/shape/action/e-shape-action-runtime-blink-color-fill.ts","wcardinal/ui/shape/action/e-shape-action-runtime-blink-color-stroke.ts","wcardinal/ui/shape/action/e-shape-action-runtime-blink-darken.ts","wcardinal/ui/shape/action/e-shape-action-runtime-blink-opacity.ts","wcardinal/ui/shape/action/e-shape-action-runtime-blink-visibility.ts","wcardinal/ui/shape/action/e-shape-action-value-blink-type.ts","wcardinal/ui/shape/action/e-shape-action-value-base.ts","wcardinal/ui/shape/action/e-shape-action-value-subtyped.ts","wcardinal/ui/shape/action/e-shape-action-value-type.ts","wcardinal/ui/shape/action/e-shape-action-values.ts","wcardinal/ui/shape/action/e-shape-action-value-blink.ts","wcardinal/ui/util/util-alpha.ts","wcardinal/ui/shape/action/e-shape-action-runtime-change-color-base.ts","wcardinal/ui/shape/action/e-shape-action-value-change-color-target.ts","wcardinal/ui/shape/action/e-shape-action-runtime-change-color.ts","wcardinal/ui/shape/action/e-shape-action-value-change-color-type.ts","wcardinal/ui/shape/action/e-shape-action-value-change-color-type-legacy.ts","wcardinal/ui/shape/action/e-shape-action-value-change-color-types.ts","wcardinal/ui/shape/action/e-shape-action-value-change-color.ts","wcardinal/ui/shape/action/e-shape-action-runtime-change-color-brightness.ts","wcardinal/ui/shape/action/e-shape-action-value-change-color-brightness.ts","wcardinal/ui/shape/action/e-shape-action-runtime-change-color-code.ts","wcardinal/ui/shape/action/e-shape-action-value-change-color-code.ts","wcardinal/ui/shape/action/e-shape-action-runtime-change-cursor.ts","wcardinal/ui/shape/action/e-shape-action-value-change-cursor.ts","wcardinal/ui/util/format-node/format-node-a-large.ts","wcardinal/ui/util/format-node/format-node-a-small.ts","wcardinal/ui/util/format-node/format-node-d-large.ts","wcardinal/ui/util/format-node/format-node-d-small.ts","wcardinal/ui/util/format-node/format-node-precision.ts","wcardinal/ui/util/format-node/format-node-e.ts","wcardinal/ui/util/format-node/format-node-f.ts","wcardinal/ui/util/format-node/format-node-fsi.ts","wcardinal/ui/util/format-node/format-node-g.ts","wcardinal/ui/util/format-node/format-node-h-large.ts","wcardinal/ui/util/format-node/format-node-h-small.ts","wcardinal/ui/util/format-node/format-node-m-large.ts","wcardinal/ui/util/format-node/format-node-m-small.ts","wcardinal/ui/util/format-node/format-node-mi.ts","wcardinal/ui/util/format-node/format-node-p-large.ts","wcardinal/ui/util/format-node/format-node-p-small.ts","wcardinal/ui/util/format-node/format-node-padding.ts","wcardinal/ui/util/format-node/format-node-parenthesis.ts","wcardinal/ui/util/format-node/format-node-plus.ts","wcardinal/ui/util/format-node/format-node-rp-large.ts","wcardinal/ui/util/format-node/format-node-rp-small.ts","wcardinal/ui/util/format-node/format-node-sdt.ts","wcardinal/ui/util/format-node/format-node-space.ts","wcardinal/ui/util/format-node/format-node-ssi.ts","wcardinal/ui/util/format-node/format-node-string.ts","wcardinal/ui/util/format-node/format-node-y-large.ts","wcardinal/ui/util/format-node/format-node-y-small.ts","wcardinal/ui/util/format-node/format-node-z.ts","wcardinal/ui/util/format-node/format-node-rd.ts","wcardinal/ui/util/format-node/format-nodes.ts","wcardinal/ui/util/number-formatter-impl.ts","wcardinal/ui/util/number-formatters.ts","wcardinal/ui/shape/action/e-shape-action-runtime-change-text-number.ts","wcardinal/ui/shape/action/e-shape-action-runtime-change-text-text.ts","wcardinal/ui/shape/action/e-shape-action-value-change-text-type.ts","wcardinal/ui/shape/action/e-shape-action-value-change-text.ts","wcardinal/ui/d-base-background.ts","wcardinal/ui/d-border-mask.ts","wcardinal/ui/util/to-enum.ts","wcardinal/ui/d-base-border.ts","wcardinal/ui/d-corner-mask.ts","wcardinal/ui/d-base-corner.ts","wcardinal/ui/d-base-interactive.ts","wcardinal/ui/d-base-outline.ts","wcardinal/ui/d-base-padding.ts","wcardinal/ui/d-base-point.ts","wcardinal/ui/d-base-mesh-geometry.ts","wcardinal/ui/d-base-background-mesh-geometry.ts","wcardinal/ui/d-base-background-mesh.ts","wcardinal/ui/d-base-background-snippet.ts","wcardinal/ui/d-base-border-mesh-geometry.ts","wcardinal/ui/d-base-border-mesh.ts","wcardinal/ui/d-base-border-snippet.ts","wcardinal/ui/d-base-outline-snippet.ts","wcardinal/ui/d-base-reflowable-impl.ts","wcardinal/ui/d-layout-clear-type.ts","wcardinal/ui/d-scalar-expression.ts","wcardinal/ui/d-scalar-functions.ts","wcardinal/ui/util/util-pointer-event.ts","wcardinal/ui/d-base-auto.ts","wcardinal/ui/d-base-auto-set.ts","wcardinal/ui/d-base-snippet-container.ts","wcardinal/ui/d-base-reflowable-container.ts","wcardinal/ui/d-base.ts","wcardinal/ui/d-base-overflow-mask.ts","wcardinal/ui/util/util-gesture-modifier.ts","wcardinal/ui/util/util-gesture-modifiers.ts","wcardinal/ui/util/util-gesture-mode.ts","wcardinal/ui/util/util-gesture-data.ts","wcardinal/ui/d-animation-timings.ts","wcardinal/ui/d-animation-base.ts","wcardinal/ui/util/util-gesture-easing-history.ts","wcardinal/ui/util/util-gesture-easing.ts","wcardinal/ui/util/util-gesture.ts","wcardinal/ui/d-view-gesture-impl.ts","wcardinal/ui/d-view-transform-impl.ts","wcardinal/ui/d-view-impl.ts","wcardinal/ui/d-canvas-container.ts","wcardinal/ui/shape/action/e-shape-action-runtimes.ts","wcardinal/ui/shape/action/e-shape-action-runtime-emit-event.ts","wcardinal/ui/shape/action/e-shape-action-value-emit-event.ts","wcardinal/ui/shape/action/e-shape-action-runtime-misc-emit-event.ts","wcardinal/ui/d-html-element-state.ts","wcardinal/ui/util/util-html-element-when.ts","wcardinal/ui/util/util-html-element.ts","wcardinal/ui/shape/action/e-shape-action-runtime-misc-html-element-base.ts","wcardinal/ui/shape/action/e-shape-action-value-misc-type.ts","wcardinal/ui/shape/action/e-shape-action-runtime-misc-html-element.ts","wcardinal/ui/util/util-input.ts","wcardinal/ui/util/util-input-input.ts","wcardinal/ui/util/util-input-number.ts","wcardinal/ui/shape/action/e-shape-action-value-on-input-action.ts","wcardinal/ui/shape/action/e-shape-action-value-on-input-actions.ts","wcardinal/ui/shape/action/e-shape-action-runtime-misc-input.ts","wcardinal/ui/shape/action/e-shape-action-runtime-misc-input-input.ts","wcardinal/ui/shape/action/e-shape-action-runtime-misc-input-number.ts","wcardinal/ui/shape/action/e-shape-action-runtime-misc-input-integer.ts","wcardinal/ui/shape/action/e-shape-action-runtime-misc-input-real.ts","wcardinal/ui/util/util-input-text.ts","wcardinal/ui/shape/action/e-shape-action-runtime-misc-input-text.ts","wcardinal/ui/shape/action/e-shape-action-runtime-misc-write.ts","wcardinal/ui/shape/action/e-shape-action-runtime-misc-write-both.ts","wcardinal/ui/shape/action/e-shape-action-runtime-misc-write-local.ts","wcardinal/ui/shape/action/e-shape-action-runtime-misc-write-remote.ts","wcardinal/ui/shape/action/e-shape-action-value-misc.ts","wcardinal/ui/shape/action/e-shape-action-value-misc-gesture-type.ts","wcardinal/ui/shape/action/e-shape-action-runtime-misc-gesture.ts","wcardinal/ui/shape/action/e-shape-action-value-misc-gesture.ts","wcardinal/ui/util/dynamic-atlas-item.ts","wcardinal/ui/util/dynamic-atlas-item-empty.ts","wcardinal/ui/util/dynamic-atlas-item-white.ts","wcardinal/ui/util/dynamic-atlas.ts","wcardinal/ui/util/dynamic-atlas-item-font-atlas.ts","wcardinal/ui/util/ascii.ts","wcardinal/ui/util/dynamic-font-atlas-chaaracter-origin.ts","wcardinal/ui/util/dynamic-font-atlas-character.ts","wcardinal/ui/util/dynamic-font-atlas-character-type.ts","wcardinal/ui/util/dynamic-sdf-font-generator.ts","wcardinal/ui/util/dynamic-sdf-font-atlas.ts","wcardinal/ui/util/dynamic-sdf-font-atlases.ts","wcardinal/ui/util/dynamic-atlas-item-image.ts","wcardinal/ui/shape/e-shape-buffer-unit.ts","wcardinal/ui/shape/e-shape-buffer-unit-builder.ts","wcardinal/ui/shape/e-shape-buffer.ts","wcardinal/ui/shape/e-shape-renderer-iterator-datum.ts","wcardinal/ui/shape/e-shape-renderer-iterator.ts","wcardinal/ui/shape/e-shape-renderer.ts","wcardinal/ui/shape/e-shape-container.ts","wcardinal/ui/d-diagram-layers.ts","wcardinal/ui/shape/action/e-shape-action-runtime-misc-layer-gesture.ts","wcardinal/ui/shape/action/e-shape-action-value-misc-layer-gesture.ts","wcardinal/ui/shape/action/e-shape-action-runtime-misc-layer-show-hide.ts","wcardinal/ui/shape/action/e-shape-action-value-misc-layer-show-hide.ts","wcardinal/ui/d-button-base-when.ts","wcardinal/ui/d-align-horizontal.ts","wcardinal/ui/d-align-vertical.ts","wcardinal/ui/d-align-with.ts","wcardinal/ui/d-image-base-theme-wrapper-secondary.ts","wcardinal/ui/d-image-base-theme-wrapper-tertiary.ts","wcardinal/ui/d-image-piece.ts","wcardinal/ui/d-base-overflow-mask-simple.ts","wcardinal/ui/d-dynamic-text-measure-result-character.ts","wcardinal/ui/d-dynamic-text-measure-result.ts","wcardinal/ui/d-dynamic-text-style-word-wrap.ts","wcardinal/ui/d-dynamic-text-measure.ts","wcardinal/ui/d-dynamic-text-geometry.ts","wcardinal/ui/d-dynamic-text-style.ts","wcardinal/ui/d-dynamic-text.ts","wcardinal/ui/d-text-base.ts","wcardinal/ui/d-image-base.ts","wcardinal/ui/d-button-base.ts","wcardinal/ui/d-button.ts","wcardinal/ui/d-button-primary.ts","wcardinal/ui/d-animation-fade-in.ts","wcardinal/ui/util/util-attach.ts","wcardinal/ui/d-dialog-close-on.ts","wcardinal/ui/d-dialog-mode.ts","wcardinal/ui/d-dialog-state.ts","wcardinal/ui/util/util-click-outside.ts","wcardinal/ui/util/util-overlay.ts","wcardinal/ui/d-dialog.ts","wcardinal/ui/d-layout-direction.ts","wcardinal/ui/d-layout-space.ts","wcardinal/ui/d-layout.ts","wcardinal/ui/d-layout-horizontal.ts","wcardinal/ui/d-layout-vertical.ts","wcardinal/ui/d-dialog-command.ts","wcardinal/ui/d-text.ts","wcardinal/ui/d-dialog-input.ts","wcardinal/ui/d-button-group.ts","wcardinal/ui/d-input-boolean-button-off.ts","wcardinal/ui/d-input-boolean-button-on.ts","wcardinal/ui/d-input-boolean.ts","wcardinal/ui/d-dialog-input-boolean.ts","wcardinal/ui/shape/action/e-shape-action-runtime-open.ts","wcardinal/ui/shape/action/e-shape-action-runtime-open-dialog.ts","wcardinal/ui/shape/action/e-shape-action-runtime-open-dialog-boolean.ts","wcardinal/ui/d-html-element.ts","wcardinal/ui/d-input.ts","wcardinal/ui/d-input-input.ts","wcardinal/ui/d-input-number.ts","wcardinal/ui/d-input-integer.ts","wcardinal/ui/d-dialog-input-integer.ts","wcardinal/ui/shape/action/e-shape-action-runtime-open-dialog-integer.ts","wcardinal/ui/d-input-real.ts","wcardinal/ui/d-dialog-input-real.ts","wcardinal/ui/shape/action/e-shape-action-runtime-open-dialog-real.ts","wcardinal/ui/d-input-text.ts","wcardinal/ui/d-dialog-input-text.ts","wcardinal/ui/shape/action/e-shape-action-runtime-open-dialog-text.ts","wcardinal/ui/shape/action/e-shape-action-runtime-open-diagram.ts","wcardinal/ui/shape/action/e-shape-action-runtime-open-page.ts","wcardinal/ui/shape/action/e-shape-action-runtime-open-page-inplace.ts","wcardinal/ui/shape/action/e-shape-action-value-open-type.ts","wcardinal/ui/d-button-ambient.ts","wcardinal/ui/d-picker-datetime-button-back.ts","wcardinal/ui/d-picker-datetime-button-date.ts","wcardinal/ui/d-picker-datetime-button-next.ts","wcardinal/ui/d-picker-datetime-label.ts","wcardinal/ui/d-picker-datetime-label-date.ts","wcardinal/ui/d-picker-datetime-space.ts","wcardinal/ui/d-picker-datetime-mask.ts","wcardinal/ui/d-picker-datetime-masks.ts","wcardinal/ui/d-picker-time-bound.ts","wcardinal/ui/d-picker-time-bound-hours.ts","wcardinal/ui/d-picker-time-bound-minutes.ts","wcardinal/ui/d-picker-time-bound-seconds.ts","wcardinal/ui/d-picker-time-bounds.ts","wcardinal/ui/d-picker-time.ts","wcardinal/ui/d-picker-datetime.ts","wcardinal/ui/d-dialog-datetime.ts","wcardinal/ui/shape/action/e-shape-action-runtime-open-dialog-datetime.ts","wcardinal/ui/d-dialog-time.ts","wcardinal/ui/util/is-nan.ts","wcardinal/ui/shape/action/e-shape-action-runtime-open-dialog-time.ts","wcardinal/ui/d-picker-date.ts","wcardinal/ui/d-dialog-date.ts","wcardinal/ui/shape/action/e-shape-action-runtime-open-dialog-date.ts","wcardinal/ui/shape/action/e-shape-action-value-open.ts","wcardinal/ui/shape/action/e-shape-action-value-show-hide-type.ts","wcardinal/ui/shape/action/e-shape-action-runtime-show-hide.ts","wcardinal/ui/shape/action/e-shape-action-value-show-hide.ts","wcardinal/ui/shape/action/e-shape-action-runtime-transform-move.ts","wcardinal/ui/shape/action/e-shape-action-runtime-transform-move-absolute-x.ts","wcardinal/ui/shape/action/e-shape-action-runtime-transform-move-absolute-y.ts","wcardinal/ui/shape/action/e-shape-action-runtime-transform-move-forward-or-backward.ts","wcardinal/ui/shape/action/e-shape-action-runtime-transform-move-left-or-right.ts","wcardinal/ui/shape/action/e-shape-action-runtime-transform-move-relative-x.ts","wcardinal/ui/shape/action/e-shape-action-runtime-transform-move-relative-y.ts","wcardinal/ui/shape/action/e-shape-action-value-opetyped.ts","wcardinal/ui/shape/action/e-shape-action-value-transform-move-type.ts","wcardinal/ui/shape/action/e-shape-action-value-transform-type.ts","wcardinal/ui/shape/action/e-shape-action-value-transform-move.ts","wcardinal/ui/shape/variant/to-size-normalized.ts","wcardinal/ui/shape/action/e-shape-action-value-transform-resize-type.ts","wcardinal/ui/shape/action/e-shape-action-runtime-transform-resize.ts","wcardinal/ui/shape/action/e-shape-action-runtime-transform-resize-height-absolute.ts","wcardinal/ui/shape/action/e-shape-action-runtime-transform-resize-height-relative.ts","wcardinal/ui/shape/action/e-shape-action-runtime-transform-resize-size-absolute.ts","wcardinal/ui/shape/action/e-shape-action-runtime-transform-resize-size-relative.ts","wcardinal/ui/shape/action/e-shape-action-runtime-transform-resize-width-absolute.ts","wcardinal/ui/shape/action/e-shape-action-runtime-transform-resize-width-relative.ts","wcardinal/ui/shape/action/e-shape-action-value-transform-resize.ts","wcardinal/ui/shape/action/e-shape-action-runtime-transform-rotate.ts","wcardinal/ui/shape/action/e-shape-action-runtime-transform-rotate-absolute.ts","wcardinal/ui/shape/action/e-shape-action-runtime-transform-rotate-relative.ts","wcardinal/ui/shape/action/e-shape-action-value-transform-rotate-type.ts","wcardinal/ui/shape/action/e-shape-action-value-transform-rotate.ts","wcardinal/ui/shape/action/deserialize-action-value.ts","wcardinal/ui/shape/variant/deserialize.ts","wcardinal/ui/shape/variant/deserialize-gradient.ts","wcardinal/ui/shape/variant/to-image-element.ts","wcardinal/ui/shape/variant/deserialize-base.ts","wcardinal/ui/shape/variant/deserialize-bar.ts","wcardinal/ui/shape/load/load-shape-bar.ts","wcardinal/ui/shape/e-shape-capability.ts","wcardinal/ui/shape/e-shape-capabilities.ts","wcardinal/ui/shape/e-shape-runtimes.ts","wcardinal/ui/shape/variant/build-rectangle-rounded.ts","wcardinal/ui/shape/variant/builder-rectangle-rounded.ts","wcardinal/ui/shape/variant/create-rectangle-rounded-uploaded.ts","wcardinal/ui/shape/variant/create-button-uploaded.ts","wcardinal/ui/shape/variant/hit-test-rectangle-rounded.ts","wcardinal/ui/shape/variant/e-shape-rectangle-rounded.ts","wcardinal/ui/shape/variant/e-shape-button.ts","wcardinal/ui/shape/variant/deserialize-button.ts","wcardinal/ui/shape/action/e-shape-action-value-misc-emit-event.ts","wcardinal/ui/shape/action/e-shape-action-value-misc-html-element.ts","wcardinal/ui/shape/action/e-shape-action-value-misc-input.ts","wcardinal/ui/shape/action/e-shape-action-value-misc-write.ts","wcardinal/ui/shape/variant/e-shape-button-runtime-action.ts","wcardinal/ui/shape/variant/e-shape-button-runtime-action-toggle.ts","wcardinal/ui/shape/variant/e-shape-button-runtime.ts","wcardinal/ui/shape/load/load-shape-button.ts","wcardinal/ui/shape/variant/build-circle.ts","wcardinal/ui/shape/variant/builder-circle.ts","wcardinal/ui/shape/variant/create-circle-uploaded.ts","wcardinal/ui/shape/variant/e-shape-circle.ts","wcardinal/ui/shape/variant/deserialize-circle.ts","wcardinal/ui/shape/load/load-shape-circle.ts","wcardinal/ui/shape/variant/builder-line.ts","wcardinal/ui/shape/variant/build-triangle.ts","wcardinal/ui/shape/variant/builder-marker-base.ts","wcardinal/ui/shape/variant/builder-marker-triangle.ts","wcardinal/ui/shape/variant/builder-marker-triangle-head.ts","wcardinal/ui/shape/variant/builder-marker-triangle-tail.ts","wcardinal/ui/shape/variant/builder-marker-circle.ts","wcardinal/ui/shape/variant/builder-marker-circle-head.ts","wcardinal/ui/shape/variant/builder-marker-circle-tail.ts","wcardinal/ui/shape/variant/builder-null.ts","wcardinal/ui/util/to-index-of.ts","wcardinal/ui/util/util-curve.ts","wcardinal/ui/shape/e-shape-points-formatter-curve.ts","wcardinal/ui/shape/e-shape-points-formatted.ts","wcardinal/ui/shape/e-shape-points-marker-base.ts","wcardinal/ui/shape/e-shape-points-marker-head.ts","wcardinal/ui/shape/e-shape-points-marker-tail.ts","wcardinal/ui/shape/e-shape-points-marker-container-impl.ts","wcardinal/ui/shape/variant/e-shape-line-points.ts","wcardinal/ui/shape/variant/build-rectangle.ts","wcardinal/ui/shape/variant/builder-marker-rectangle.ts","wcardinal/ui/shape/variant/builder-marker-rectangle-tail.ts","wcardinal/ui/shape/variant/builder-marker-rectangle-head.ts","wcardinal/ui/shape/variant/create-line-uploaded.ts","wcardinal/ui/shape/e-shape-connector-bodies.ts","wcardinal/ui/shape/e-shape-acceptor-impl.ts","wcardinal/ui/shape/e-shape-acceptor-type.ts","wcardinal/ui/shape/e-shape-acceptors.ts","wcardinal/ui/shape/e-shape-connector-edge-acceptor-impl.ts","wcardinal/ui/shape/e-shape-connector-edge-impl.ts","wcardinal/ui/shape/e-shape-connector-edge-container-impl.ts","wcardinal/ui/shape/e-shape-connector-body-impl.ts","wcardinal/ui/shape/variant/e-shape-connector-line.ts","wcardinal/ui/shape/variant/deserialize-connector-line.ts","wcardinal/ui/shape/load/load-shape-connector-line.ts","wcardinal/ui/shape/variant/builder-rectangle-pivoted.ts","wcardinal/ui/shape/variant/create-rectangle-pivoted-uploaded.ts","wcardinal/ui/shape/variant/create-group-uploaded.ts","wcardinal/ui/shape/variant/e-shape-group-text-align-editor.ts","wcardinal/ui/shape/variant/e-shape-group-text-offset-editor.ts","wcardinal/ui/shape/variant/e-shape-group-text-outline-editor.ts","wcardinal/ui/shape/variant/e-shape-group-text-padding-editor.ts","wcardinal/ui/shape/variant/e-shape-group-text-spacing-editor.ts","wcardinal/ui/shape/variant/e-shape-group-text-editor.ts","wcardinal/ui/shape/variant/e-shape-group-fill-viewer.ts","wcardinal/ui/shape/e-shape-editor.ts","wcardinal/ui/shape/e-shape-transforms.ts","wcardinal/ui/shape/variant/e-shape-group-size-layout.ts","wcardinal/ui/shape/variant/e-shape-group-size-editor.ts","wcardinal/ui/shape/variant/e-shape-group-size-viewer.ts","wcardinal/ui/shape/variant/e-shape-group-stroke-viewer.ts","wcardinal/ui/shape/variant/e-shape-group-text-align-viewer.ts","wcardinal/ui/shape/variant/e-shape-group-text-offset-viewer.ts","wcardinal/ui/shape/variant/e-shape-group-text-outline-viewer.ts","wcardinal/ui/shape/variant/e-shape-group-text-padding-viewer.ts","wcardinal/ui/shape/variant/e-shape-group-text-spacing-viewer.ts","wcardinal/ui/shape/variant/e-shape-group-text-viewer.ts","wcardinal/ui/shape/variant/e-shape-group-viewer.ts","wcardinal/ui/shape/variant/e-shape-embedded.ts","wcardinal/ui/shape/e-shape-layer-state.ts","wcardinal/ui/shape/variant/e-shape-embedded-layer.ts","wcardinal/ui/shape/variant/e-shape-rectangle.ts","wcardinal/ui/shape/variant/deserialize-embedded.ts","wcardinal/ui/shape/load/load-shape-embedded.ts","wcardinal/ui/shape/variant/e-shape-group-fill-editor.ts","wcardinal/ui/shape/variant/e-shape-group-points.ts","wcardinal/ui/shape/variant/e-shape-group-stroke-editor.ts","wcardinal/ui/shape/variant/e-shape-group.ts","wcardinal/ui/shape/variant/deserialize-group.ts","wcardinal/ui/shape/load/load-shape-group.ts","wcardinal/ui/shape/variant/e-shape-group-size-shadowed.ts","wcardinal/ui/shape/variant/e-shape-group-shadowed.ts","wcardinal/ui/shape/variant/deserialize-group-shadowed.ts","wcardinal/ui/shape/load/load-shape-group-shadowed.ts","wcardinal/ui/shape/variant/builder-rectangle.ts","wcardinal/ui/shape/variant/create-rectangle-uploaded.ts","wcardinal/ui/shape/variant/e-shape-image.ts","wcardinal/ui/shape/variant/deserialize-image.ts","wcardinal/ui/shape/load/load-shape-image.ts","wcardinal/ui/shape/variant/build-image-sdf.ts","wcardinal/ui/shape/variant/builder-image-sdf.ts","wcardinal/ui/shape/variant/create-image-sdf-uploaded.ts","wcardinal/ui/shape/variant/e-shape-image-sdf.ts","wcardinal/ui/shape/variant/deserialize-image-sdf.ts","wcardinal/ui/shape/variant/builder-label.ts","wcardinal/ui/shape/variant/create-label-uploaded.ts","wcardinal/ui/shape/variant/e-shape-label.ts","wcardinal/ui/shape/variant/deserialize-label.ts","wcardinal/ui/shape/load/load-shape-label.ts","wcardinal/ui/shape/variant/e-shape-line.ts","wcardinal/ui/shape/variant/deserialize-line.ts","wcardinal/ui/shape/load/load-shape-line.ts","wcardinal/ui/shape/variant/build-null.ts","wcardinal/ui/shape/variant/build-line-of-any.ts","wcardinal/ui/shape/variant/builder-line-of-any.ts","wcardinal/ui/shape/variant/copy-clipping.ts","wcardinal/ui/shape/variant/copy-index.ts","wcardinal/ui/shape/variant/copy-step.ts","wcardinal/ui/shape/variant/copy-uv.ts","wcardinal/ui/shape/variant/copy-vertex.ts","wcardinal/ui/shape/variant/is-static.ts","wcardinal/ui/shape/variant/to-computed.ts","wcardinal/ui/shape/variant/e-shape-line-of-any-points-fill-impl.ts","wcardinal/ui/shape/variant/e-shape-line-of-any-points-point-impl.ts","wcardinal/ui/shape/variant/e-shape-line-of-any-points-stroke-impl.ts","wcardinal/ui/shape/variant/e-shape-line-of-any-points-impl.ts","wcardinal/ui/shape/variant/builder-line-of-circles.ts","wcardinal/ui/shape/variant/create-line-of-any-uploaded.ts","wcardinal/ui/shape/variant/create-line-of-circles-uploaded.ts","wcardinal/ui/shape/variant/e-shape-line-of-circles.ts","wcardinal/ui/shape/variant/deserialize-line-of-circles.ts","wcardinal/ui/shape/load/load-shape-line-of-circles.ts","wcardinal/ui/shape/variant/builder-line-of-rectangle-roundeds.ts","wcardinal/ui/shape/variant/create-line-of-rectangle-roundeds-uploaded.ts","wcardinal/ui/shape/variant/e-shape-line-of-rectangle-roundeds.ts","wcardinal/ui/shape/variant/deserialize-line-of-rectangle-roundeds.ts","wcardinal/ui/shape/load/load-shape-line-of-rectangle-roundeds.ts","wcardinal/ui/shape/variant/builder-line-of-rectangles.ts","wcardinal/ui/shape/variant/create-line-of-rectangles-uploaded.ts","wcardinal/ui/shape/variant/e-shape-line-of-rectangles.ts","wcardinal/ui/shape/variant/deserialize-line-of-rectangles.ts","wcardinal/ui/shape/load/load-shape-line-of-rectangles.ts","wcardinal/ui/shape/variant/build-triangle-rounded.ts","wcardinal/ui/shape/variant/builder-line-of-triangle-roundeds.ts","wcardinal/ui/shape/variant/create-line-of-triangle-roundeds-uploaded.ts","wcardinal/ui/shape/variant/hit-test-triangle-rounded.ts","wcardinal/ui/shape/variant/e-shape-triangle-rounded.ts","wcardinal/ui/shape/variant/e-shape-line-of-triangle-roundeds.ts","wcardinal/ui/shape/variant/deserialize-line-of-triangle-roundeds.ts","wcardinal/ui/shape/load/load-shape-line-of-triangle-roundeds.ts","wcardinal/ui/shape/variant/builder-line-of-triangles.ts","wcardinal/ui/shape/variant/create-line-of-triangles-uploaded.ts","wcardinal/ui/shape/variant/e-shape-triangle.ts","wcardinal/ui/shape/variant/e-shape-line-of-triangles.ts","wcardinal/ui/shape/variant/deserialize-line-of-triangles.ts","wcardinal/ui/shape/load/load-shape-line-of-triangles.ts","wcardinal/ui/shape/variant/create-null-uploaded.ts","wcardinal/ui/shape/variant/e-shape-null.ts","wcardinal/ui/shape/variant/deserialize-null.ts","wcardinal/ui/shape/load/load-shape-null.ts","wcardinal/ui/shape/variant/deserialize-rectangle.ts","wcardinal/ui/shape/load/load-shape-rectangle.ts","wcardinal/ui/shape/variant/builder-triangle-rounded.ts","wcardinal/ui/shape/variant/builder-triangle.ts","wcardinal/ui/shape/variant/create-image-sdf.ts","wcardinal/ui/shape/variant/create-triangle-rounded-uploaded.ts","wcardinal/ui/shape/variant/create-triangle-uploaded.ts","wcardinal/ui/shape/e-shape-uuid-mapping-impl.ts","wcardinal/ui/shape/variant/deserialize-all.ts","wcardinal/ui/shape/variant/deserialize-rectangle-rounded.ts","wcardinal/ui/shape/variant/deserialize-triangle-rounded.ts","wcardinal/ui/shape/variant/deserialize-triangle.ts","wcardinal/ui/shape/variant/e-shape-embedded-datum.ts","wcardinal/ui/shape/e-shape-connectors.ts","wcardinal/ui/shape/variant/e-shape-embedded-layer-container.ts","wcardinal/ui/shape/e-shape-resource-manager-deserialization.ts","wcardinal/ui/d-diagrams.ts","wcardinal/ui/shape/variant/e-shape-embeddeds.ts","wcardinal/ui/shape/variant/e-shape-rectangle-pivoted.ts","wcardinal/ui/util/to-svg-url.ts","wcardinal/ui/shape/variant/to-size-rounded.ts","wcardinal/ui/shape/variant/deserialize-rectangle-pivoted.ts","wcardinal/ui/shape/load/load-shape-rectangle-rounded.ts","wcardinal/ui/shape/load/load-shape-triangle.ts","wcardinal/ui/shape/load/load-shape-triangle-rounded.ts","wcardinal/ui/shape/load/load-shape-all.ts","wcardinal/ui/shape/load/load-shape-image-sdf.ts","wcardinal/ui/shape/load/load-shape-rectangle-pivoted.ts","wcardinal/ui/d-image.ts","wcardinal/ui/d-menu-item-base.ts","wcardinal/ui/d-menu-item.ts","wcardinal/ui/d-menu-item-text.ts","wcardinal/ui/d-menu-item-check.ts","wcardinal/ui/d-menu-item-check-is-compatible.ts","wcardinal/ui/d-link-menu-item-id.ts","wcardinal/ui/d-menus.ts","wcardinal/ui/d-link-menu.ts","wcardinal/ui/d-link-target.ts","wcardinal/ui/util/util-clipboard.ts","wcardinal/ui/d-link.ts","wcardinal/ui/d-links.ts","wcardinal/ui/d-menu-item-link.ts","wcardinal/ui/d-menu-item-link-is-compatible.ts","wcardinal/ui/d-menu-item-menu.ts","wcardinal/ui/d-menu-item-menu-is-compatible.ts","wcardinal/ui/d-menu-item-menu-to-sub-menu-options.ts","wcardinal/ui/d-menu-item-separator-reflowable.ts","wcardinal/ui/d-menu-item-separator.ts","wcardinal/ui/d-menu-item-space.ts","wcardinal/ui/d-menu-item-space-is-compatible.ts","wcardinal/ui/load/load-menu-item.ts","wcardinal/ui/d-menu-item-expandable-body.ts","wcardinal/ui/d-menu-item-expandable-header.ts","wcardinal/ui/d-menu-item-expandables.ts","wcardinal/ui/d-menu-item-expandable.ts","wcardinal/ui/d-menu-item-expandable-is-compatible.ts","wcardinal/ui/d-menu-item-expandable-item-check.ts","wcardinal/ui/d-menu-item-expandable-item-link.ts","wcardinal/ui/d-menu-item-expandable-item-separator.ts","wcardinal/ui/d-menu-item-expandable-item-space.ts","wcardinal/ui/d-menu-item-expandable-item-text.ts","wcardinal/ui/load/load-menu-item-expandable.ts","wcardinal/ui/d-menu-sided-item-check.ts","wcardinal/ui/d-menu-sided-item-link.ts","wcardinal/ui/d-menu-sided-item-menu.ts","wcardinal/ui/d-menu-sided-item-separator.ts","wcardinal/ui/d-menu-sided-item-space.ts","wcardinal/ui/d-menu-sided-item-text.ts","wcardinal/ui/d-menu-sideds.ts","wcardinal/ui/load/load-menu-sided-item.ts","wcardinal/ui/d-menu-sided-item-expandables.ts","wcardinal/ui/d-menu-sided-item-expandable.ts","wcardinal/ui/d-menu-sided-item-expandable-item-check.ts","wcardinal/ui/d-menu-sided-item-expandable-item-link.ts","wcardinal/ui/d-menu-item-expandable-item-menu.ts","wcardinal/ui/d-menu-sided-item-expandable-item-menu.ts","wcardinal/ui/d-menu-sided-item-expandable-item-separator.ts","wcardinal/ui/d-menu-sided-item-expandable-item-space.ts","wcardinal/ui/d-menu-sided-item-expandable-item-text.ts","wcardinal/ui/load/load-menu-sided-item-expandable.ts","wcardinal/ui/load/load-menu-item-all.ts","wcardinal/ui/load/load-all.ts","wcardinal/ui/shape/e-shape-search.ts","wcardinal/ui/shape/e-shape-deleter.ts","wcardinal/ui/shape/e-shape-points-styles.ts","wcardinal/ui/shape/e-shape-resource-manager-serialization.ts","wcardinal/ui/snapper/e-snapper-grid.ts","wcardinal/ui/snapper/e-snapper-result.ts","wcardinal/ui/snapper/e-snapper-target-value.ts","wcardinal/ui/snapper/e-snapper-target.ts","wcardinal/ui/snapper/e-snapper.ts","wcardinal/ui/util/dynamic-atlas-item-text.ts","wcardinal/ui/util/dynamic-font-atlas-font.ts","wcardinal/ui/util/dynamic-font-atlas.ts","wcardinal/ui/util/dynamic-font-atlases.ts","wcardinal/ui/util/lazy.ts","wcardinal/ui/util/to-ceiling-index.ts","wcardinal/ui/util/to-label.ts","wcardinal/ui/util/util-svg-atlas-builder.ts","wcardinal/ui/util/util-extractor.ts","wcardinal/ui/util/util-file-downloader.ts","wcardinal/ui/util/util-extract.ts","wcardinal/ui/util/util-file-opener.ts","wcardinal/ui/util/util-hsv.ts","wcardinal/ui/util/util-input-text-area.ts","wcardinal/ui/util/util-name.ts","wcardinal/ui/util/util-rgba.ts","wcardinal/ui/util/util-state-blinker.ts","wcardinal/ui/util/util-transition.ts","wcardinal/ui/util/util-wheel-event.ts","wcardinal/ui/d-animation-empty.ts","wcardinal/ui/d-application-padding.ts","wcardinal/ui/d-application-layer-options.ts","wcardinal/ui/d-command-flag.ts","wcardinal/ui/d-command-clear.ts","wcardinal/ui/d-command-redo.ts","wcardinal/ui/d-command-undo.ts","wcardinal/ui/d-controller-default-command.ts","wcardinal/ui/d-controller-keyboard.ts","wcardinal/ui/d-controllers.ts","wcardinal/ui/d-application-layer.ts","wcardinal/ui/d-controller-default-focus.ts","wcardinal/ui/d-application.ts","wcardinal/ui/d-base-padding-adjustable.ts","wcardinal/ui/d-board.ts","wcardinal/ui/d-button-check.ts","wcardinal/ui/d-button-check-right.ts","wcardinal/ui/d-color-gradient-point-observable.ts","wcardinal/ui/d-color-gradient-observable.ts","wcardinal/ui/d-input-label.ts","wcardinal/ui/d-input-and-label.ts","wcardinal/ui/d-input-real-and-label.ts","wcardinal/ui/d-input-text-and-label.ts","wcardinal/ui/d-picker-color-and-alpha.ts","wcardinal/ui/d-picker-color-recent.ts","wcardinal/ui/d-picker-color.ts","wcardinal/ui/d-picker-color-gradient-recent.ts","wcardinal/ui/d-picker-color-gradient-view.ts","wcardinal/ui/d-picker-color-gradient.ts","wcardinal/ui/d-dialog-color-gradient.ts","wcardinal/ui/d-button-color-gradient.ts","wcardinal/ui/d-dialog-color.ts","wcardinal/ui/d-button-color.ts","wcardinal/ui/d-button-danger.ts","wcardinal/ui/d-dialog-dates.ts","wcardinal/ui/d-button-date.ts","wcardinal/ui/d-dialog-datetimes.ts","wcardinal/ui/d-picker-dates.ts","wcardinal/ui/d-picker-times.ts","wcardinal/ui/d-picker-datetimes.ts","wcardinal/ui/d-button-datetime.ts","wcardinal/ui/d-button-file.ts","wcardinal/ui/d-button-link.ts","wcardinal/ui/d-button-radio.ts","wcardinal/ui/d-button-radio-right.ts","wcardinal/ui/d-button-redo.ts","wcardinal/ui/d-button-secondary.ts","wcardinal/ui/d-list-data-selection.ts","wcardinal/ui/d-list-item.ts","wcardinal/ui/d-dialog-select-list-item.ts","wcardinal/ui/d-item-updater.ts","wcardinal/ui/d-list-item-updater.ts","wcardinal/ui/d-dialog-select-list-item-updater.ts","wcardinal/ui/d-list-data-mapped-impl.ts","wcardinal/ui/d-list-data-selection-multiple.ts","wcardinal/ui/d-list-data-selection-none.ts","wcardinal/ui/d-list-data-selection-single.ts","wcardinal/ui/d-list-item-accessor-impl.ts","wcardinal/ui/d-list-data-impl.ts","wcardinal/ui/d-content.ts","wcardinal/ui/d-scroll-bar.ts","wcardinal/ui/d-scroll-bar-thumb.ts","wcardinal/ui/d-scroll-bar-thumb-reflowable-horizontal.ts","wcardinal/ui/d-scroll-bar-thumb-horizontal.ts","wcardinal/ui/d-scroll-bar-horizontal.ts","wcardinal/ui/d-scroll-bar-thumb-reflowable-vertical.ts","wcardinal/ui/d-scroll-bar-thumb-vertical.ts","wcardinal/ui/d-scroll-bar-vertical.ts","wcardinal/ui/d-pane-scrollbar.ts","wcardinal/ui/d-pane.ts","wcardinal/ui/d-list.ts","wcardinal/ui/d-dialog-select-list.ts","wcardinal/ui/d-dialog-select-search.ts","wcardinal/ui/d-input-search.ts","wcardinal/ui/d-note.ts","wcardinal/ui/d-note-small.ts","wcardinal/ui/d-note-small-error.ts","wcardinal/ui/d-note-small-no-items-found.ts","wcardinal/ui/d-note-small-searching.ts","wcardinal/ui/d-dialog-select.ts","wcardinal/ui/d-button-select.ts","wcardinal/ui/d-dialog-times.ts","wcardinal/ui/d-button-time.ts","wcardinal/ui/d-button-undo.ts","wcardinal/ui/d-canvas.ts","wcardinal/ui/d-chart-axis-position.ts","wcardinal/ui/d-chart-axis-tick-position.ts","wcardinal/ui/d-chart-axis-base-options-parser.ts","wcardinal/ui/d-chart-axis-base.ts","wcardinal/ui/d-chart-axis-container-impl.ts","wcardinal/ui/d-chart-axis-x.ts","wcardinal/ui/d-chart-axis-x-datetime.ts","wcardinal/ui/d-chart-axis-y.ts","wcardinal/ui/d-chart-color-set.ts","wcardinal/ui/d-chart-coordinate-direction.ts","wcardinal/ui/d-chart-coordinate-container-sub-impl.ts","wcardinal/ui/d-chart-coordinate-container-impl.ts","wcardinal/ui/d-chart-coordinate-linear-tick.ts","wcardinal/ui/d-chart-coordinate-transform-impl.ts","wcardinal/ui/d-chart-coordinate-transform-mark.ts","wcardinal/ui/d-chart-region-impl.ts","wcardinal/ui/d-chart-coordinate-linear.ts","wcardinal/ui/d-chart-coordinate-log-tick.ts","wcardinal/ui/d-chart-coordinate-log.ts","wcardinal/ui/d-chart-legend-item.ts","wcardinal/ui/d-chart-legend.ts","wcardinal/ui/d-chart-overview.ts","wcardinal/ui/d-chart-plot-area-container.ts","wcardinal/ui/d-chart-series.ts","wcardinal/ui/d-chart-series-fill-computed-impl.ts","wcardinal/ui/d-chart-series-scalar.ts","wcardinal/ui/d-chart-series-fill-impl.ts","wcardinal/ui/d-chart-series-padding-computed-impl.ts","wcardinal/ui/d-chart-series-padding-impl.ts","wcardinal/ui/d-chart-series-point-computed-impl.ts","wcardinal/ui/d-chart-series-point-impl.ts","wcardinal/ui/d-chart-series-stroke-computed-impl.ts","wcardinal/ui/d-chart-series-stroke-impl.ts","wcardinal/ui/d-chart-series-container-impl.ts","wcardinal/ui/d-chart-plot-area-impl.ts","wcardinal/ui/d-chart-region-impl-observable.ts","wcardinal/ui/d-chart-selection-shape-base.ts","wcardinal/ui/d-chart-selection-gridline-x.ts","wcardinal/ui/d-chart-selection-gridline-y.ts","wcardinal/ui/d-chart-selection-gridline-container-impl.ts","wcardinal/ui/d-chart-selection-marker.ts","wcardinal/ui/d-chart-selection.ts","wcardinal/ui/d-chart-selection-sub-impl.ts","wcardinal/ui/d-chart-selection-simple.ts","wcardinal/ui/d-chart-series-base-coordinate-container.ts","wcardinal/ui/d-chart-series-base.ts","wcardinal/ui/d-chart-series-line-of-any.ts","wcardinal/ui/d-chart-series-bar.ts","wcardinal/ui/d-chart-series-line-of-circles.ts","wcardinal/ui/d-chart-series-line-of-rectangle-roundeds.ts","wcardinal/ui/d-chart-series-line-of-rectangles.ts","wcardinal/ui/d-chart-series-line-of-triangles.ts","wcardinal/ui/d-chart-series-line-of-triangle-roundeds.ts","wcardinal/ui/d-chart-series-line.ts","wcardinal/ui/d-chart-series-linear-parameters-impl.ts","wcardinal/ui/d-chart-series-linear.ts","wcardinal/ui/d-chart.ts","wcardinal/ui/d-command-create.ts","wcardinal/ui/d-command-delete.ts","wcardinal/ui/d-command-save-as.ts","wcardinal/ui/d-command-save.ts","wcardinal/ui/d-diagram-snapshot.ts","wcardinal/ui/d-diagram-base.ts","wcardinal/ui/d-diagram-canvas-editor-background.ts","wcardinal/ui/d-diagram-canvas-mapping-point-impl.ts","wcardinal/ui/d-diagram-canvas-mapping-impl.ts","wcardinal/ui/d-diagram-canvas-tile.ts","wcardinal/ui/d-diagram-layer.ts","wcardinal/ui/d-diagram-layer-container.ts","wcardinal/ui/d-diagram-canvas-base.ts","wcardinal/ui/d-diagram-canvas-editor-snap.ts","wcardinal/ui/d-diagram-canvas-editor.ts","wcardinal/ui/d-diagram-serialized.ts","wcardinal/ui/d-diagram-canvas.ts","wcardinal/ui/d-diagram-data-remote.ts","wcardinal/ui/d-diagram-data.ts","wcardinal/ui/d-diagram-editor-thumbnail.ts","wcardinal/ui/d-diagram-editor.ts","wcardinal/ui/d-diagram-shape.ts","wcardinal/ui/d-diagram.ts","wcardinal/ui/d-dialog-confirm-message.ts","wcardinal/ui/d-dialog-confirm.ts","wcardinal/ui/d-dialog-confirm-delete.ts","wcardinal/ui/d-dialog-confirm-discard.ts","wcardinal/ui/d-dialog-message.ts","wcardinal/ui/d-dialog-processing-message.ts","wcardinal/ui/d-dialog-processing.ts","wcardinal/ui/d-dialog-save-as.ts","wcardinal/ui/d-menu-context.ts","wcardinal/ui/d-menu.ts","wcardinal/ui/d-dropdown-base.ts","wcardinal/ui/d-dropdown.ts","wcardinal/ui/d-expandable-header.ts","wcardinal/ui/d-expandable.ts","wcardinal/ui/d-input-integer-and-label.ts","wcardinal/ui/d-input-text-area.ts","wcardinal/ui/d-list-item-ambient.ts","wcardinal/ui/d-map-coordinate-epsg3857.ts","wcardinal/ui/d-map-coordinates.ts","wcardinal/ui/d-map-tile.ts","wcardinal/ui/d-map-tile-plane.ts","wcardinal/ui/d-map-tile-pyramid-impl.ts","wcardinal/ui/d-map-tile-pyramids.ts","wcardinal/ui/d-menu-bar-item.ts","wcardinal/ui/d-menu-bar.ts","wcardinal/ui/d-menu-sided-content.ts","wcardinal/ui/d-menu-sided-selection.ts","wcardinal/ui/d-menu-sided.ts","wcardinal/ui/d-note-error.ts","wcardinal/ui/d-note-no-items-found.ts","wcardinal/ui/d-note-searching.ts","wcardinal/ui/d-notification.ts","wcardinal/ui/d-pagination-button-last.ts","wcardinal/ui/d-pagination-button-next.ts","wcardinal/ui/d-pagination-button-page.ts","wcardinal/ui/d-pagination-button-previous.ts","wcardinal/ui/d-pagination-button-top.ts","wcardinal/ui/d-pagination-dots.ts","wcardinal/ui/d-pagination-page.ts","wcardinal/ui/d-pagination.ts","wcardinal/ui/d-picker-datetime-range.ts","wcardinal/ui/d-picker-time-range.ts","wcardinal/ui/d-select-multiple.ts","wcardinal/ui/d-select.ts","wcardinal/ui/d-shadow-impl.ts","wcardinal/ui/d-slider-label.ts","wcardinal/ui/d-slider-thumb.ts","wcardinal/ui/d-slider-value.ts","wcardinal/ui/d-slider.ts","wcardinal/ui/d-slider-track.ts","wcardinal/ui/d-slider-track-horizontal.ts","wcardinal/ui/d-slider-horizontal.ts","wcardinal/ui/d-slider-track-vertical.ts","wcardinal/ui/d-slider-vertical.ts","wcardinal/ui/d-table-body-cells.ts","wcardinal/ui/d-table-body-cell-select-dialog.ts","wcardinal/ui/d-table-body-cell-action-dialog.ts","wcardinal/ui/d-table-body-cell-action-menu.ts","wcardinal/ui/d-table-body-cell-select-promise.ts","wcardinal/ui/d-table-body-cell-action-promise.ts","wcardinal/ui/d-table-body-cell-text.ts","wcardinal/ui/d-table-body-cell-button.ts","wcardinal/ui/d-table-column.ts","wcardinal/ui/d-table-body-cell-check.ts","wcardinal/ui/d-table-body-cell-color.ts","wcardinal/ui/d-table-body-cell-date.ts","wcardinal/ui/d-table-body-cell-datetime.ts","wcardinal/ui/d-table-body-cell-index.ts","wcardinal/ui/d-table-body-cell-input-integer.ts","wcardinal/ui/d-table-body-cell-input-real.ts","wcardinal/ui/d-table-body-cell-input-text.ts","wcardinal/ui/d-table-body-cell-input-tree-input.ts","wcardinal/ui/d-table-body-cell-input-tree-marker.ts","wcardinal/ui/d-table-state.ts","wcardinal/ui/d-table-body-cell-input-tree.ts","wcardinal/ui/d-table-body-cell-link.ts","wcardinal/ui/d-table-body-cell-select-menu.ts","wcardinal/ui/d-table-body-cell-select-multiple.ts","wcardinal/ui/d-table-body-cell-time.ts","wcardinal/ui/d-table-body-cell-tree.ts","wcardinal/ui/d-table-data-selection.ts","wcardinal/ui/d-table-row.ts","wcardinal/ui/d-table-body-row.ts","wcardinal/ui/d-table-data-list-filter.ts","wcardinal/ui/d-table-data-list-mapped.ts","wcardinal/ui/d-table-data-list-selection.ts","wcardinal/ui/d-table-data-sorter.ts","wcardinal/ui/d-table-data-list-sorter.ts","wcardinal/ui/d-table-data-list.ts","wcardinal/ui/d-table-body.ts","wcardinal/ui/d-table-category-cell.ts","wcardinal/ui/d-table-category.ts","wcardinal/ui/d-table-data-tree-filter.ts","wcardinal/ui/d-table-data-tree-item-accessor.ts","wcardinal/ui/d-table-data-tree-selection-impl.ts","wcardinal/ui/d-table-data-tree-sorter.ts","wcardinal/ui/d-table-data-tree.ts","wcardinal/ui/d-table-header-cell-check.ts","wcardinal/ui/d-table-header-cell.ts","wcardinal/ui/d-table-header.ts","wcardinal/ui/d-table-scrollbar.ts","wcardinal/ui/d-table.ts","wcardinal/ui/d-tree-node-accessor-impl.ts","wcardinal/ui/d-tree-data-selection.ts","wcardinal/ui/d-tree-data-mapped-impl.ts","wcardinal/ui/d-tree-data-selection-multiple.ts","wcardinal/ui/d-tree-data-selection-single.ts","wcardinal/ui/d-tree-data-selection-none.ts","wcardinal/ui/d-tree-data-impl.ts","wcardinal/ui/d-tree-item-state.ts","wcardinal/ui/d-tree-item-text.ts","wcardinal/ui/d-tree-item-button.ts","wcardinal/ui/d-tree-item-non-editable.ts","wcardinal/ui/d-tree-item-updater.ts","wcardinal/ui/d-tree.ts","wcardinal/ui/shape/variant/create-image.ts","wcardinal/ui/shape/variant/create-line.ts","wcardinal/ui/shape/variant/to-gradient-image-url.ts","wcardinal/ui/shape/variant/to-resized.ts","wcardinal/ui/snapper/e-snapper-result-scale.ts","wcardinal/ui/util/to-string.ts","wcardinal/ui/util/to-svg-texture.ts","wcardinal-ui.browser.ts"],"sourcesContent":["/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDiagramSerializedItem } from \"../d-diagram-serialized\";\nimport { EShape } from \"./e-shape\";\nimport { EShapeResourceManagerDeserialization } from \"./e-shape-resource-manager-deserialization\";\nimport { EShapeUuidMapping } from \"./e-shape-uuid-mapping\";\n\n/**\n * A shape deserializer\n */\nexport type EShapeDeserializer = (\n\titem: DDiagramSerializedItem,\n\tmanager: EShapeResourceManagerDeserialization\n) => Promise<EShape> | EShape | null;\n\n/**\n * Mappings of shape types and deserializers.\n */\nexport const EShapeDeserializers: Record<number, EShapeDeserializer | undefined> = {};\n\n/**\n * A handler which is called after the deserializations of all the shapes are completed.\n */\nexport type EShapeOnDeserialized = (\n\titem: DDiagramSerializedItem,\n\tshape: EShape,\n\tmapping: EShapeUuidMapping,\n\tmanager: EShapeResourceManagerDeserialization\n) => void;\n\n/**\n * Mappings of shape types and `onDeserialized` handlers.\n */\nexport const EShapeOnDeserializeds: Record<number, EShapeOnDeserialized | undefined> = {};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const EShapeType = {\n\tCIRCLE: 0,\n\tRECTANGLE: 1,\n\tRECTANGLE_ROUNDED: 2,\n\tTRIANGLE: 3,\n\tTRIANGLE_ROUNDED: 4,\n\tLINE: 5,\n\tIMAGE: 6,\n\tIMAGE_SDF: 7,\n\tGROUP: 8,\n\tBAR: 9,\n\tLABEL: 10,\n\tNULL: 11,\n\tGROUP_SHADOWED: 12,\n\tLINE_OF_CIRCLES: 13,\n\tLINE_OF_RECTANGLES: 14,\n\tLINE_OF_RECTANGLE_ROUNDEDS: 15,\n\tLINE_OF_TRIANGLES: 16,\n\tLINE_OF_TRIANGLE_ROUNDEDS: 17,\n\tEMBEDDED: 18,\n\tEMBEDDED_LAYER: 19,\n\tBUTTON: 20,\n\tRECTANGLE_PIVOTED: 21,\n\tCONNECTOR_LINE: 22,\n\tEXTENSION: 1000\n} as const;\n\nexport type EShapeType = number;\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"./e-shape\";\nimport { EShapeBuffer } from \"./e-shape-buffer\";\nimport { EShapeUploaded } from \"./e-shape-uploaded\";\n\nexport type EShapeUploadedCreator = (\n\tbuffer: EShapeBuffer,\n\tshape: EShape,\n\tvoffset: number,\n\tioffset: number,\n\tantialiasWeight: number\n) => EShapeUploaded | null;\n\nexport const EShapeUploadeds: Record<number, EShapeUploadedCreator | undefined> = {};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"./e-shape\";\nimport { EShapeBuffer } from \"./e-shape-buffer\";\nimport { EShapeBufferUnitBuilder } from \"./e-shape-buffer-unit-builder\";\nimport { Builder } from \"./variant/builder\";\n\nexport interface EShapeUploaded {\n\tupdate(shape: EShape): void;\n\tisCompatible(shape: EShape): boolean;\n\tgetBuffer(): EShapeBuffer;\n\tgetVertexOffset(): number;\n\tgetVertexCount(): number;\n\tgetIndexOffset(): number;\n\tgetIndexCount(): number;\n\tbuildUnit(builder: EShapeBufferUnitBuilder): void;\n}\n\nexport class EShapeUploadedImpl implements EShapeUploaded {\n\tprotected buffer: EShapeBuffer;\n\tprotected _builders: Builder[];\n\tprotected _vertexOffset: number;\n\tprotected _indexOffset: number;\n\tprotected _vertexCount: number;\n\tprotected _indexCount: number;\n\n\tconstructor(\n\t\tbuffer: EShapeBuffer,\n\t\tvertexOffset: number,\n\t\tindexOffset: number,\n\t\tvertexCount: number,\n\t\tindexCount: number,\n\t\tbuilders: Builder[]\n\t) {\n\t\tthis.buffer = buffer;\n\t\tthis._builders = builders;\n\t\tthis._vertexOffset = vertexOffset;\n\t\tthis._indexOffset = indexOffset;\n\t\tthis._vertexCount = vertexCount;\n\t\tthis._indexCount = indexCount;\n\t}\n\n\tinit(shape: EShape): this {\n\t\tshape.uploaded = this;\n\t\tconst buffer = this.buffer;\n\t\tconst builders = this._builders;\n\t\tfor (let i = 0, imax = builders.length; i < imax; ++i) {\n\t\t\tbuilders[i].init(buffer);\n\t\t}\n\t\tthis.update(shape);\n\t\treturn this;\n\t}\n\n\tupdate(shape: EShape): void {\n\t\tconst buffer = this.buffer;\n\t\tconst builders = this._builders;\n\t\tfor (let i = 0, imax = builders.length; i < imax; ++i) {\n\t\t\tbuilders[i].update(buffer, shape);\n\t\t}\n\t}\n\n\tisCompatible(shape: EShape): boolean {\n\t\tconst builders = this._builders;\n\t\tfor (let i = 0, imax = builders.length; i < imax; ++i) {\n\t\t\tif (!builders[i].isCompatible(shape)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\tgetBuffer(): EShapeBuffer {\n\t\treturn this.buffer;\n\t}\n\n\tgetVertexOffset(): number {\n\t\treturn this._vertexOffset;\n\t}\n\n\tgetVertexCount(): number {\n\t\treturn this._vertexCount;\n\t}\n\n\tgetIndexOffset(): number {\n\t\treturn this._indexOffset;\n\t}\n\n\tgetIndexCount(): number {\n\t\treturn this._indexCount;\n\t}\n\n\tbuildUnit(builder: EShapeBufferUnitBuilder): void {\n\t\tconst builders = this._builders;\n\t\tfor (let i = 0, imax = builders.length; i < imax; ++i) {\n\t\t\tbuilders[i].buildUnit(builder);\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nconst NON_EXPANDING_WIDTH = 2;\nconst NON_SHRINKING_WIDTH = 4;\nconst NON_SCALING_DOT_AND_DASH = 8;\n\nconst DOTTED = 16;\nconst DOTTED_DENSELY = 32;\nconst DOTTED_LOOSELY = 64;\n\nconst DASHED = 128;\nconst DASHED_DENSELY = 256;\nconst DASHED_LOOSELY = 512;\n\nexport const EShapeStrokeStyle = {\n\tNONE: 0,\n\n\tNON_EXPANDING_WIDTH,\n\tNON_SHRINKING_WIDTH,\n\tNON_SCALING_DOT_AND_DASH,\n\tNON_SCALING: NON_EXPANDING_WIDTH | NON_SHRINKING_WIDTH | NON_SCALING_DOT_AND_DASH,\n\tNON_SCALING_MASK: NON_EXPANDING_WIDTH | NON_SHRINKING_WIDTH | NON_SCALING_DOT_AND_DASH,\n\n\tDOTTED,\n\tDOTTED_DENSELY,\n\tDOTTED_LOOSELY,\n\tDOTTED_MASK: DOTTED | DOTTED_DENSELY | DOTTED_LOOSELY,\n\n\tDASHED,\n\tDASHED_DENSELY,\n\tDASHED_LOOSELY,\n\tDASHED_MASK: DASHED | DASHED_DENSELY | DASHED_LOOSELY\n} as const;\n\nexport type EShapeStrokeStyle = number;\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { IPoint } from \"pixi.js\";\nimport { EShapeStrokeStyle } from \"../e-shape-stroke-style\";\n\nexport const toDash = (\n\tlength: number,\n\tstrokeWidth: number,\n\tstyle: EShapeStrokeStyle,\n\tresult: IPoint\n): IPoint => {\n\tif (style & EShapeStrokeStyle.DOTTED_MASK) {\n\t\tif (style & EShapeStrokeStyle.DOTTED) {\n\t\t\tresult.set(strokeWidth, strokeWidth);\n\t\t} else if (style & EShapeStrokeStyle.DOTTED_DENSELY) {\n\t\t\tresult.set(strokeWidth, strokeWidth * 0.5);\n\t\t} else {\n\t\t\tresult.set(strokeWidth, strokeWidth * 2);\n\t\t}\n\t} else if (style & EShapeStrokeStyle.DASHED_MASK) {\n\t\tif (style & EShapeStrokeStyle.DASHED) {\n\t\t\tresult.set(strokeWidth * 2, strokeWidth);\n\t\t} else if (style & EShapeStrokeStyle.DASHED_DENSELY) {\n\t\t\tresult.set(strokeWidth * 2, strokeWidth * 0.5);\n\t\t} else {\n\t\t\tresult.set(strokeWidth * 2, strokeWidth * 2);\n\t\t}\n\t} else {\n\t\tresult.set(2 * length, 0);\n\t}\n\treturn result;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeStrokeStyle } from \"../e-shape-stroke-style\";\n\nexport const toScaleInvariant = (style: EShapeStrokeStyle): number => {\n\tconst nonExpandingWidth = style & EShapeStrokeStyle.NON_EXPANDING_WIDTH ? 1 : 0;\n\tconst nonShrinkingWidth = style & EShapeStrokeStyle.NON_SHRINKING_WIDTH ? 2 : 0;\n\tconst nonScalingDotAndDash = style & EShapeStrokeStyle.NON_SCALING_DOT_AND_DASH ? 4 : 0;\n\tif (style & (EShapeStrokeStyle.DOTTED_MASK || EShapeStrokeStyle.DASHED_MASK)) {\n\t\treturn nonExpandingWidth | nonShrinkingWidth | nonScalingDotAndDash;\n\t} else {\n\t\treturn nonExpandingWidth | nonShrinkingWidth;\n\t}\n};\n","import { Matrix, Point, TextureUvs } from \"pixi.js\";\nimport { EShapeStrokeStyle } from \"../e-shape-stroke-style\";\nimport { toDash } from \"./to-dash\";\nimport { toScaleInvariant } from \"./to-scale-invariant\";\n\nexport const BAR_VERTEX_COUNT = 4;\nexport const BAR_INDEX_COUNT = 2;\nconst BAR_FMIN: number = 0.00001;\nconst BAR_WORK_POINT: Point = new Point();\n\nexport const buildBarClipping = (clippings: Float32Array, voffset: number): void => {\n\tlet ic = voffset * 3 - 1;\n\tclippings[++ic] = 1;\n\tclippings[++ic] = 0;\n\tclippings[++ic] = 3;\n\n\tclippings[++ic] = 0;\n\tclippings[++ic] = 1;\n\tclippings[++ic] = 5;\n\n\tclippings[++ic] = 1;\n\tclippings[++ic] = 0;\n\tclippings[++ic] = 3;\n\n\tclippings[++ic] = 0;\n\tclippings[++ic] = 1;\n\tclippings[++ic] = 5;\n};\n\nexport const buildBarIndex = (\n\tindices: Uint16Array | Uint32Array,\n\tvoffset: number,\n\tioffset: number\n): void => {\n\tlet ii = ioffset * 3 - 1;\n\tindices[++ii] = voffset;\n\tindices[++ii] = voffset + 2;\n\tindices[++ii] = voffset + 1;\n\n\tindices[++ii] = voffset + 1;\n\tindices[++ii] = voffset + 2;\n\tindices[++ii] = voffset + 3;\n};\n\nexport const buildBarVertexStepAndColorFill = (\n\tvertices: Float32Array,\n\tsteps: Float32Array,\n\tcolorFills: Float32Array,\n\tvoffset: number,\n\tpointValues: number[],\n\tpointsSize: number,\n\tstrokeWidth: number,\n\tstrokeStyle: EShapeStrokeStyle,\n\tinternalTransform: Matrix\n): void => {\n\t// First point\n\tconst a = internalTransform.a;\n\tconst b = internalTransform.b;\n\tconst c = internalTransform.c;\n\tconst d = internalTransform.d;\n\tconst tx = internalTransform.tx;\n\tconst ty = internalTransform.ty;\n\tconst pv0 = pointValues[0];\n\tconst pv1 = pointValues[1];\n\tconst p1x = a * pv0 + c * pv1 + tx;\n\tconst p1y = b * pv0 + d * pv1 + ty;\n\n\t// Last point\n\tconst pv2 = pointValues[2];\n\tconst pv3 = pointValues[3];\n\tlet p2x = a * pv2 + c * pv3 + tx;\n\tlet p2y = b * pv2 + d * pv3 + ty;\n\n\t// Normal\n\tlet dx = p2x - p1x;\n\tlet dy = p2y - p1y;\n\tconst distance = Math.sqrt(dx * dx + dy * dy);\n\tlet l = distance;\n\tif (0 <= pointsSize && BAR_FMIN < distance) {\n\t\tconst ratio = pointsSize / distance;\n\t\tdx *= ratio;\n\t\tdy *= ratio;\n\t\tp2x = p1x + dx;\n\t\tp2y = p1y + dy;\n\t\tl = pointsSize;\n\t}\n\n\t// Other points\n\tconst p0x = p1x - dx;\n\tconst p0y = p1y - dy;\n\tconst p3x = p2x + dx;\n\tconst p3y = p2y + dy;\n\n\t//\n\tconst scaleInvariant = toScaleInvariant(strokeStyle);\n\tconst dash = toDash(l, strokeWidth, strokeStyle, BAR_WORK_POINT);\n\tconst dash0 = dash.x;\n\tconst dash1 = dash.y;\n\tlet iv = (voffset << 1) - 1;\n\tlet icf = (voffset << 2) - 1;\n\tlet is = voffset * 6 - 1;\n\tvertices[++iv] = p1x;\n\tvertices[++iv] = p1y;\n\tvertices[++iv] = p1x;\n\tvertices[++iv] = p1y;\n\tsteps[++is] = strokeWidth;\n\tsteps[++is] = scaleInvariant;\n\tsteps[++is] = p0x;\n\tsteps[++is] = p0y;\n\tsteps[++is] = p2x;\n\tsteps[++is] = p2y;\n\tsteps[++is] = strokeWidth;\n\tsteps[++is] = scaleInvariant;\n\tsteps[++is] = p0x;\n\tsteps[++is] = p0y;\n\tsteps[++is] = p2x;\n\tsteps[++is] = p2y;\n\tcolorFills[++icf] = 0;\n\tcolorFills[++icf] = dash0;\n\tcolorFills[++icf] = dash1;\n\tcolorFills[++icf] = l;\n\tcolorFills[++icf] = 0;\n\tcolorFills[++icf] = dash0;\n\tcolorFills[++icf] = dash1;\n\tcolorFills[++icf] = l;\n\n\tvertices[++iv] = p2x;\n\tvertices[++iv] = p2y;\n\tvertices[++iv] = p2x;\n\tvertices[++iv] = p2y;\n\tsteps[++is] = strokeWidth;\n\tsteps[++is] = scaleInvariant;\n\tsteps[++is] = p1x;\n\tsteps[++is] = p1y;\n\tsteps[++is] = p3x;\n\tsteps[++is] = p3y;\n\tsteps[++is] = strokeWidth;\n\tsteps[++is] = scaleInvariant;\n\tsteps[++is] = p1x;\n\tsteps[++is] = p1y;\n\tsteps[++is] = p3x;\n\tsteps[++is] = p3y;\n\tcolorFills[++icf] = l;\n\tcolorFills[++icf] = dash0;\n\tcolorFills[++icf] = dash1;\n\tcolorFills[++icf] = l;\n\tcolorFills[++icf] = l;\n\tcolorFills[++icf] = dash0;\n\tcolorFills[++icf] = dash1;\n\tcolorFills[++icf] = l;\n};\n\nexport const buildBarUv = (uvs: Float32Array, voffset: number, textureUvs: TextureUvs): void => {\n\tlet iuv = (voffset << 1) - 1;\n\tuvs[++iuv] = textureUvs.x0;\n\tuvs[++iuv] = textureUvs.y0;\n\tuvs[++iuv] = textureUvs.x3;\n\tuvs[++iuv] = textureUvs.y3;\n\n\tuvs[++iuv] = textureUvs.x1;\n\tuvs[++iuv] = textureUvs.y1;\n\tuvs[++iuv] = textureUvs.x2;\n\tuvs[++iuv] = textureUvs.y2;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport class UtilCharacterIterator {\n\tprotected static _instance: UtilCharacterIterator | null = null;\n\ttarget: string;\n\tposition: number;\n\n\tconstructor() {\n\t\tthis.target = \"\";\n\t\tthis.position = 0;\n\t}\n\n\tinit(target: string): void {\n\t\tthis.target = target;\n\t\tthis.position = 0;\n\t}\n\n\thasNext(): boolean {\n\t\treturn this.position < this.target.length;\n\t}\n\n\tprotected findNextBreak(target: string, istart: number): number {\n\t\tconst iend = target.length;\n\t\tfor (let i = istart; i < iend; ++i) {\n\t\t\tconst code = target.charCodeAt(i);\n\t\t\tif (!this.isLowSurrogate(code) && !this.isVariationSelector(code)) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\t\treturn iend;\n\t}\n\n\tprotected isHighSurrogate(code: number): boolean {\n\t\treturn 0xd800 <= code && code <= 0xdbff;\n\t}\n\n\tprotected isLowSurrogate(code: number): boolean {\n\t\treturn 0xdc00 <= code && code <= 0xdfff;\n\t}\n\n\tprotected isVariationSelector(code: number): boolean {\n\t\treturn 0xfe00 <= code && code <= 0xfe0f;\n\t}\n\n\tnext(): string {\n\t\tconst target = this.target;\n\t\tconst position = this.position;\n\t\tconst nextBreak = this.findNextBreak(target, position + 1);\n\t\tconst result = target.substring(position, nextBreak);\n\t\tthis.position = nextBreak;\n\t\treturn result;\n\t}\n\n\t/**\n\t * Advances the position if the next character is not equal to\n\t * the given `except`.\n\t *\n\t * @param except\n\t * @return true if the position is advanced\n\t */\n\tadvance(except?: string): boolean {\n\t\tconst target = this.target;\n\t\tconst position = this.position;\n\t\tconst nextBreak = this.findNextBreak(target, position + 1);\n\t\tif (target.substring(position, nextBreak) !== except) {\n\t\t\tthis.position = nextBreak;\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t/**\n\t * Closes this iterator.\n\t *\n\t * @returns true if closed.\n\t */\n\tclose(): boolean {\n\t\tconst length = this.target.length;\n\t\tif (this.position < length) {\n\t\t\tthis.position = length;\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tstatic from(target: string): UtilCharacterIterator {\n\t\tif (UtilCharacterIterator._instance == null) {\n\t\t\tUtilCharacterIterator._instance = new UtilCharacterIterator();\n\t\t}\n\t\tconst instance = UtilCharacterIterator._instance;\n\t\tinstance.init(target);\n\t\treturn instance;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Texture } from \"pixi.js\";\nimport { DeepPartial } from \"../util/deep-partial\";\nimport { EShapeResourceManagerDeserialization } from \"./e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"./e-shape-resource-manager-serialization\";\nimport { EShapeTextAlign, EShapeTextAlignLike } from \"./e-shape-text-align\";\nimport { EShapeTextDirection } from \"./e-shape-text-direction\";\nimport { EShapeTextOffset, EShapeTextOffsetLike } from \"./e-shape-text-offset\";\nimport { EShapeTextOutline, EShapeTextOutlineLike } from \"./e-shape-text-outline\";\n\nexport const EShapeTextWeight = {\n\tNORMAL: 0,\n\tBOLD: 1\n} as const;\n\nexport type EShapeTextWeight = typeof EShapeTextWeight[keyof typeof EShapeTextWeight];\n\nexport const EShapeTextStyle = {\n\tNORMAL: 0,\n\tITALIC: 1\n} as const;\n\nexport type EShapeTextStyle = typeof EShapeTextStyle[keyof typeof EShapeTextStyle];\n\nexport interface EShapeTextLike {\n\tvalue: string;\n\tcolor: number;\n\talpha: number;\n\tfamily: string;\n\tsize: number;\n\tweight: EShapeTextWeight;\n\talign: EShapeTextAlignLike;\n\toffset: EShapeTextOffsetLike;\n\tstyle: EShapeTextStyle;\n\toutline: EShapeTextOutlineLike;\n\tspacing: EShapeTextOffsetLike;\n\tdirection: EShapeTextDirection;\n\tpadding: EShapeTextOffsetLike;\n\tclipping: boolean;\n}\n\nexport interface EShapeTextAtlasCharacter {\n\tx: number;\n\ty: number;\n\twidth: number;\n\theight: number;\n\tadvance: number;\n\torigin: {\n\t\tx: number;\n\t\ty: number;\n\t};\n}\n\nexport type EShapeTextAtlasCharacters = Record<string, EShapeTextAtlasCharacter>;\n\nexport interface EShapeTextAtlas {\n\twidth: number;\n\theight: number;\n\tfont: {\n\t\tsize: number;\n\t};\n\tcharacters: EShapeTextAtlasCharacters;\n}\n\nexport interface EShapeText extends EShapeTextLike {\n\tenable: boolean;\n\n\talign: EShapeTextAlign;\n\toffset: EShapeTextOffset;\n\toutline: EShapeTextOutline;\n\tspacing: EShapeTextOffset;\n\tpadding: EShapeTextOffset;\n\n\ttexture?: Texture; // Used for rendering and updated when rendered\n\tatlas?: EShapeTextAtlas; // Used for rendering and updated when rendered\n\tworld?: number[]; // Updated when rendered\n\n\tcopy(target?: DeepPartial<EShapeTextLike>): this;\n\tset(\n\t\tvalue?: string,\n\t\tcolor?: number,\n\t\talpha?: number,\n\t\tfamily?: string,\n\t\tsize?: number,\n\t\tweight?: EShapeTextWeight,\n\t\tstyle?: EShapeTextStyle,\n\t\tdirection?: EShapeTextDirection,\n\t\tclipping?: boolean\n\t): this;\n\ttoObject(): EShapeTextLike;\n\tserialize(manager: EShapeResourceManagerSerialization): number;\n\tdeserialize(target: number, manager: EShapeResourceManagerDeserialization): void;\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const EShapeTextAlignHorizontal = {\n\tLEFT: 0,\n\tCENTER: 1,\n\tRIGHT: 2,\n\tOUTSIDE_LEFT: 3,\n\tOUTSIDE_RIGHT: 4\n} as const;\n\nexport type EShapeTextAlignHorizontal =\n\ttypeof EShapeTextAlignHorizontal[keyof typeof EShapeTextAlignHorizontal];\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const EShapeTextAlignVertical = {\n\tTOP: 0,\n\tMIDDLE: 1,\n\tBOTTOM: 2,\n\tOUTSIDE_TOP: 3,\n\tOUTSIDE_BOTTOM: 4\n} as const;\n\nexport type EShapeTextAlignVertical =\n\ttypeof EShapeTextAlignVertical[keyof typeof EShapeTextAlignVertical];\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const EShapeTextDirection = {\n\tLEFT_TO_RIGHT: 0,\n\tTOP_TO_BOTTOM: 1,\n\tBOTTOM_TO_TOP: 2\n} as const;\n\nexport type EShapeTextDirection = typeof EShapeTextDirection[keyof typeof EShapeTextDirection];\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const toLength = (p0x: number, p0y: number, p1x: number, p1y: number): number => {\n\tconst dx01 = p1x - p0x;\n\tconst dy01 = p1y - p0y;\n\treturn Math.sqrt(dx01 * dx01 + dy01 * dy01);\n};\n","import { Matrix, Point, TextureUvs } from \"pixi.js\";\nimport { UtilCharacterIterator } from \"../../util/util-character-iterator\";\nimport { EShape } from \"../e-shape\";\nimport { EShapeStrokeStyle } from \"../e-shape-stroke-style\";\nimport {\n\tEShapeTextAtlas,\n\tEShapeTextAtlasCharacter,\n\tEShapeTextStyle,\n\tEShapeTextWeight\n} from \"../e-shape-text\";\nimport { EShapeTextAlignHorizontal } from \"../e-shape-text-align-horizontal\";\nimport { EShapeTextAlignVertical } from \"../e-shape-text-align-vertical\";\nimport { EShapeTextDirection } from \"../e-shape-text-direction\";\nimport { toLength } from \"./to-length\";\nimport { toScaleInvariant } from \"./to-scale-invariant\";\n\nexport const TEXT_VERTEX_COUNT = 4;\nexport const TEXT_INDEX_COUNT = 2;\nconst TEXT_FMIN: number = 0.00001;\nconst TEXT_WORK_POINT: Point = new Point();\n\nexport const toTextBufferCount = (shape: EShape): number => {\n\treturn Math.ceil(shape.text.value.length / 12) * 12;\n};\n\nexport const buildTextClipping = (\n\tclippings: Float32Array,\n\tvoffset: number,\n\tvcount: number\n): void => {\n\tlet ic = voffset * 3 - 1;\n\tconst icmax = (voffset + vcount) * 3 - 1;\n\tfor (; ic < icmax; ) {\n\t\tclippings[++ic] = 0;\n\t\tclippings[++ic] = 0;\n\t\tclippings[++ic] = 2;\n\t}\n};\n\nexport const buildTextIndex = (\n\tindices: Uint16Array | Uint32Array,\n\tvoffset: number,\n\tioffset: number,\n\ticount: number\n): void => {\n\tlet ii = ioffset * 3 - 1;\n\tconst iimax = (ioffset + icount) * 3 - 1;\n\tlet iv = voffset;\n\tfor (; ii < iimax; ) {\n\t\tindices[++ii] = iv;\n\t\tindices[++ii] = iv + 1;\n\t\tindices[++ii] = iv + 3;\n\n\t\tindices[++ii] = iv + 1;\n\t\tindices[++ii] = iv + 2;\n\t\tindices[++ii] = iv + 3;\n\t\tiv += 4;\n\t}\n};\n\nexport const buildTextStep = (\n\tsteps: Float32Array,\n\tvoffset: number,\n\tvcount: number,\n\ttextAtlas: EShapeTextAtlas | undefined,\n\ttextSize: number,\n\ttextOutlineWidth: number,\n\ttextWeight: EShapeTextWeight\n): void => {\n\tlet is = voffset * 6 - 1;\n\tconst ismax = (voffset + vcount) * 6 - 1;\n\tconst scaleInvariant = toScaleInvariant(EShapeStrokeStyle.NONE);\n\tif (textAtlas != null) {\n\t\tconst scale = textAtlas.font.size / textSize;\n\t\tconst position = textWeight === EShapeTextWeight.NORMAL ? 0.0 : 0.05;\n\t\tfor (; is < ismax; ) {\n\t\t\tsteps[++is] = textOutlineWidth;\n\t\t\tsteps[++is] = scaleInvariant;\n\t\t\tsteps[++is] = scale;\n\t\t\tsteps[++is] = 1;\n\t\t\tsteps[++is] = 0;\n\t\t\tsteps[++is] = position;\n\t\t}\n\t} else {\n\t\tfor (; is < ismax; ) {\n\t\t\tsteps[++is] = 0;\n\t\t\tsteps[++is] = scaleInvariant;\n\t\t\tsteps[++is] = 0;\n\t\t\tsteps[++is] = 1;\n\t\t\tsteps[++is] = 0;\n\t\t\tsteps[++is] = 0;\n\t\t}\n\t}\n};\n\nconst getTextBBox = (\n\thalign: EShapeTextAlignHorizontal,\n\tvalign: EShapeTextAlignVertical,\n\thoffset: number,\n\tvoffset: number,\n\thpadding: number,\n\tvpadding: number,\n\twidth: number,\n\theight: number,\n\tx0: number,\n\ty0: number,\n\tx1: number,\n\ty1: number,\n\tx2: number,\n\ty2: number,\n\tx3: number,\n\ty3: number,\n\thnx: number,\n\thny: number,\n\tvnx: number,\n\tvny: number,\n\tresult: Point\n): void => {\n\tswitch (halign) {\n\t\tcase EShapeTextAlignHorizontal.LEFT:\n\t\t\tswitch (valign) {\n\t\t\t\tcase EShapeTextAlignVertical.TOP:\n\t\t\t\t\tresult.x = x0 + hnx * (hoffset + hpadding) + vnx * (voffset + vpadding);\n\t\t\t\t\tresult.y = y0 + hny * (hoffset + hpadding) + vny * (voffset + vpadding);\n\t\t\t\t\tbreak;\n\t\t\t\tcase EShapeTextAlignVertical.MIDDLE:\n\t\t\t\t\tresult.x =\n\t\t\t\t\t\t0.5 * (x0 + x3) +\n\t\t\t\t\t\thnx * (hoffset + hpadding) +\n\t\t\t\t\t\tvnx * (voffset - 0.5 * height);\n\t\t\t\t\tresult.y =\n\t\t\t\t\t\t0.5 * (y0 + y3) +\n\t\t\t\t\t\thny * (hoffset + hpadding) +\n\t\t\t\t\t\tvny * (voffset - 0.5 * height);\n\t\t\t\t\tbreak;\n\t\t\t\tcase EShapeTextAlignVertical.BOTTOM:\n\t\t\t\t\tresult.x =\n\t\t\t\t\t\tx3 + hnx * (hoffset + hpadding) + vnx * (voffset - vpadding - height);\n\t\t\t\t\tresult.y =\n\t\t\t\t\t\ty3 + hny * (hoffset + hpadding) + vny * (voffset - vpadding - height);\n\t\t\t\t\tbreak;\n\t\t\t\tcase EShapeTextAlignVertical.OUTSIDE_TOP:\n\t\t\t\t\tresult.x =\n\t\t\t\t\t\tx0 + hnx * (hoffset + hpadding) + vnx * (voffset - vpadding - height);\n\t\t\t\t\tresult.y =\n\t\t\t\t\t\ty0 + hny * (hoffset + hpadding) + vny * (voffset - vpadding - height);\n\t\t\t\t\tbreak;\n\t\t\t\tcase EShapeTextAlignVertical.OUTSIDE_BOTTOM:\n\t\t\t\t\tresult.x = x3 + hnx * (hoffset + hpadding) + vnx * (voffset + vpadding);\n\t\t\t\t\tresult.y = y3 + hny * (hoffset + hpadding) + vny * (voffset + vpadding);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\t\tcase EShapeTextAlignHorizontal.CENTER:\n\t\t\tswitch (valign) {\n\t\t\t\tcase EShapeTextAlignVertical.TOP:\n\t\t\t\t\tresult.x =\n\t\t\t\t\t\t0.5 * (x0 + x1) +\n\t\t\t\t\t\thnx * (hoffset - 0.5 * width) +\n\t\t\t\t\t\tvnx * (voffset + vpadding);\n\t\t\t\t\tresult.y =\n\t\t\t\t\t\t0.5 * (y0 + y1) +\n\t\t\t\t\t\thny * (hoffset - 0.5 * width) +\n\t\t\t\t\t\tvny * (voffset + vpadding);\n\t\t\t\t\tbreak;\n\t\t\t\tcase EShapeTextAlignVertical.MIDDLE:\n\t\t\t\t\tresult.x =\n\t\t\t\t\t\t0.5 * (x0 + x2) +\n\t\t\t\t\t\thnx * (hoffset - 0.5 * width) +\n\t\t\t\t\t\tvnx * (voffset - 0.5 * height);\n\t\t\t\t\tresult.y =\n\t\t\t\t\t\t0.5 * (y0 + y2) +\n\t\t\t\t\t\thny * (hoffset - 0.5 * width) +\n\t\t\t\t\t\tvny * (voffset - 0.5 * height);\n\t\t\t\t\tbreak;\n\t\t\t\tcase EShapeTextAlignVertical.BOTTOM:\n\t\t\t\t\tresult.x =\n\t\t\t\t\t\t0.5 * (x3 + x2) +\n\t\t\t\t\t\thnx * (hoffset - 0.5 * width) +\n\t\t\t\t\t\tvnx * (voffset - vpadding - height);\n\t\t\t\t\tresult.y =\n\t\t\t\t\t\t0.5 * (y3 + y2) +\n\t\t\t\t\t\thny * (hoffset - 0.5 * width) +\n\t\t\t\t\t\tvny * (voffset - vpadding - height);\n\t\t\t\t\tbreak;\n\t\t\t\tcase EShapeTextAlignVertical.OUTSIDE_TOP:\n\t\t\t\t\tresult.x =\n\t\t\t\t\t\t0.5 * (x0 + x1) +\n\t\t\t\t\t\thnx * (hoffset - 0.5 * width) +\n\t\t\t\t\t\tvnx * (voffset - vpadding - height);\n\t\t\t\t\tresult.y =\n\t\t\t\t\t\t0.5 * (y0 + y1) +\n\t\t\t\t\t\thny * (hoffset - 0.5 * width) +\n\t\t\t\t\t\tvny * (voffset - vpadding - height);\n\t\t\t\t\tbreak;\n\t\t\t\tcase EShapeTextAlignVertical.OUTSIDE_BOTTOM:\n\t\t\t\t\tresult.x =\n\t\t\t\t\t\t0.5 * (x3 + x2) +\n\t\t\t\t\t\thnx * (hoffset - 0.5 * width) +\n\t\t\t\t\t\tvnx * (voffset + vpadding);\n\t\t\t\t\tresult.y =\n\t\t\t\t\t\t0.5 * (y3 + y2) +\n\t\t\t\t\t\thny * (hoffset - 0.5 * width) +\n\t\t\t\t\t\tvny * (voffset + vpadding);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\t\tcase EShapeTextAlignHorizontal.RIGHT:\n\t\t\tswitch (valign) {\n\t\t\t\tcase EShapeTextAlignVertical.TOP:\n\t\t\t\t\tresult.x = x1 + hnx * (hoffset - hpadding - width) + vnx * (voffset + vpadding);\n\t\t\t\t\tresult.y = y1 + hny * (hoffset - hpadding - width) + vny * (voffset + vpadding);\n\t\t\t\t\tbreak;\n\t\t\t\tcase EShapeTextAlignVertical.MIDDLE:\n\t\t\t\t\tresult.x =\n\t\t\t\t\t\t0.5 * (x1 + x2) +\n\t\t\t\t\t\thnx * (hoffset - hpadding - width) +\n\t\t\t\t\t\tvnx * (voffset - 0.5 * height);\n\t\t\t\t\tresult.y =\n\t\t\t\t\t\t0.5 * (y1 + y2) +\n\t\t\t\t\t\thny * (hoffset - hpadding - width) +\n\t\t\t\t\t\tvny * (voffset - 0.5 * height);\n\t\t\t\t\tbreak;\n\t\t\t\tcase EShapeTextAlignVertical.BOTTOM:\n\t\t\t\t\tresult.x =\n\t\t\t\t\t\tx2 +\n\t\t\t\t\t\thnx * (hoffset - hpadding - width) +\n\t\t\t\t\t\tvnx * (voffset - vpadding - height);\n\t\t\t\t\tresult.y =\n\t\t\t\t\t\ty2 +\n\t\t\t\t\t\thny * (hoffset - hpadding - width) +\n\t\t\t\t\t\tvny * (voffset - vpadding - height);\n\t\t\t\t\tbreak;\n\t\t\t\tcase EShapeTextAlignVertical.OUTSIDE_TOP:\n\t\t\t\t\tresult.x =\n\t\t\t\t\t\tx1 +\n\t\t\t\t\t\thnx * (hoffset - hpadding - width) +\n\t\t\t\t\t\tvnx * (voffset - vpadding - height);\n\t\t\t\t\tresult.y =\n\t\t\t\t\t\ty1 +\n\t\t\t\t\t\thny * (hoffset - hpadding - width) +\n\t\t\t\t\t\tvny * (voffset - vpadding - height);\n\t\t\t\t\tbreak;\n\t\t\t\tcase EShapeTextAlignVertical.OUTSIDE_BOTTOM:\n\t\t\t\t\tresult.x = x2 + hnx * (hoffset - hpadding - width) + vnx * (voffset + vpadding);\n\t\t\t\t\tresult.y = y2 + hny * (hoffset - hpadding - width) + vny * (voffset + vpadding);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\t\tcase EShapeTextAlignHorizontal.OUTSIDE_LEFT:\n\t\t\tswitch (valign) {\n\t\t\t\tcase EShapeTextAlignVertical.TOP:\n\t\t\t\t\tresult.x = x0 + hnx * (hoffset - hpadding - width) + vnx * (voffset + vpadding);\n\t\t\t\t\tresult.y = y0 + hny * (hoffset - hpadding - width) + vny * (voffset + vpadding);\n\t\t\t\t\tbreak;\n\t\t\t\tcase EShapeTextAlignVertical.MIDDLE:\n\t\t\t\t\tresult.x =\n\t\t\t\t\t\t0.5 * (x0 + x3) +\n\t\t\t\t\t\thnx * (hoffset - hpadding - width) +\n\t\t\t\t\t\tvnx * (voffset - 0.5 * height);\n\t\t\t\t\tresult.y =\n\t\t\t\t\t\t0.5 * (y0 + y3) +\n\t\t\t\t\t\thny * (hoffset - hpadding - width) +\n\t\t\t\t\t\tvny * (voffset - 0.5 * height);\n\t\t\t\t\tbreak;\n\t\t\t\tcase EShapeTextAlignVertical.BOTTOM:\n\t\t\t\t\tresult.x =\n\t\t\t\t\t\tx3 +\n\t\t\t\t\t\thnx * (hoffset - hpadding - width) +\n\t\t\t\t\t\tvnx * (voffset - vpadding - height);\n\t\t\t\t\tresult.y =\n\t\t\t\t\t\ty3 +\n\t\t\t\t\t\thny * (hoffset - hpadding - width) +\n\t\t\t\t\t\tvny * (voffset - vpadding - height);\n\t\t\t\t\tbreak;\n\t\t\t\tcase EShapeTextAlignVertical.OUTSIDE_TOP:\n\t\t\t\t\tresult.x =\n\t\t\t\t\t\tx0 +\n\t\t\t\t\t\thnx * (hoffset - hpadding - width) +\n\t\t\t\t\t\tvnx * (voffset - vpadding - height);\n\t\t\t\t\tresult.y =\n\t\t\t\t\t\ty0 +\n\t\t\t\t\t\thny * (hoffset - hpadding - width) +\n\t\t\t\t\t\tvny * (voffset - vpadding - height);\n\t\t\t\t\tbreak;\n\t\t\t\tcase EShapeTextAlignVertical.OUTSIDE_BOTTOM:\n\t\t\t\t\tresult.x = x3 + hnx * (hoffset - hpadding - width) + vnx * (voffset + vpadding);\n\t\t\t\t\tresult.y = y3 + hny * (hoffset - hpadding - width) + vny * (voffset + vpadding);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\t\tcase EShapeTextAlignHorizontal.OUTSIDE_RIGHT:\n\t\t\tswitch (valign) {\n\t\t\t\tcase EShapeTextAlignVertical.TOP:\n\t\t\t\t\tresult.x = x1 + hnx * (hoffset + hpadding) + vnx * (voffset + vpadding);\n\t\t\t\t\tresult.y = y1 + hny * (hoffset + hpadding) + vny * (voffset + vpadding);\n\t\t\t\t\tbreak;\n\t\t\t\tcase EShapeTextAlignVertical.MIDDLE:\n\t\t\t\t\tresult.x =\n\t\t\t\t\t\t0.5 * (x1 + x2) +\n\t\t\t\t\t\thnx * (hoffset + hpadding) +\n\t\t\t\t\t\tvnx * (voffset - 0.5 * height);\n\t\t\t\t\tresult.y =\n\t\t\t\t\t\t0.5 * (y1 + y2) +\n\t\t\t\t\t\thny * (hoffset + hpadding) +\n\t\t\t\t\t\tvny * (voffset - 0.5 * height);\n\t\t\t\t\tbreak;\n\t\t\t\tcase EShapeTextAlignVertical.BOTTOM:\n\t\t\t\t\tresult.x =\n\t\t\t\t\t\tx2 + hnx * (hoffset + hpadding) + vnx * (voffset - vpadding - height);\n\t\t\t\t\tresult.y =\n\t\t\t\t\t\ty2 + hny * (hoffset + hpadding) + vny * (voffset - vpadding - height);\n\t\t\t\t\tbreak;\n\t\t\t\tcase EShapeTextAlignVertical.OUTSIDE_TOP:\n\t\t\t\t\tresult.x =\n\t\t\t\t\t\tx1 + hnx * (hoffset + hpadding) + vnx * (voffset - vpadding - height);\n\t\t\t\t\tresult.y =\n\t\t\t\t\t\ty1 + hny * (hoffset + hpadding) + vny * (voffset - vpadding - height);\n\t\t\t\t\tbreak;\n\t\t\t\tcase EShapeTextAlignVertical.OUTSIDE_BOTTOM:\n\t\t\t\t\tresult.x = x2 + hnx * (hoffset + hpadding) + vnx * (voffset + vpadding);\n\t\t\t\t\tresult.y = y2 + hny * (hoffset + hpadding) + vny * (voffset + vpadding);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\t}\n};\n\nconst toNormalized = (\n\tdx: number,\n\tdy: number,\n\tdefx: number,\n\tdefy: number,\n\tresult: Point\n): number => {\n\tconst d = dx * dx + dy * dy;\n\tif (TEXT_FMIN < d) {\n\t\tconst l = Math.sqrt(d);\n\t\tconst li = 1 / l;\n\t\tresult.set(dx * li, dy * li);\n\t\treturn l;\n\t} else {\n\t\tresult.set(defx, defy);\n\t\treturn 0;\n\t}\n};\n\nconst rotateAlignHorizontalRight = (align: EShapeTextAlignHorizontal): EShapeTextAlignVertical => {\n\tswitch (align) {\n\t\tcase EShapeTextAlignHorizontal.LEFT:\n\t\t\treturn EShapeTextAlignVertical.BOTTOM;\n\t\tcase EShapeTextAlignHorizontal.CENTER:\n\t\t\treturn EShapeTextAlignVertical.MIDDLE;\n\t\tcase EShapeTextAlignHorizontal.RIGHT:\n\t\t\treturn EShapeTextAlignVertical.TOP;\n\t\tcase EShapeTextAlignHorizontal.OUTSIDE_LEFT:\n\t\t\treturn EShapeTextAlignVertical.OUTSIDE_BOTTOM;\n\t\tcase EShapeTextAlignHorizontal.OUTSIDE_RIGHT:\n\t\t\treturn EShapeTextAlignVertical.OUTSIDE_TOP;\n\t}\n};\n\nconst rotateAlignVerticalRight = (align: EShapeTextAlignVertical): EShapeTextAlignHorizontal => {\n\tswitch (align) {\n\t\tcase EShapeTextAlignVertical.TOP:\n\t\t\treturn EShapeTextAlignHorizontal.LEFT;\n\t\tcase EShapeTextAlignVertical.MIDDLE:\n\t\t\treturn EShapeTextAlignHorizontal.CENTER;\n\t\tcase EShapeTextAlignVertical.BOTTOM:\n\t\t\treturn EShapeTextAlignHorizontal.RIGHT;\n\t\tcase EShapeTextAlignVertical.OUTSIDE_TOP:\n\t\t\treturn EShapeTextAlignHorizontal.OUTSIDE_LEFT;\n\t\tcase EShapeTextAlignVertical.OUTSIDE_BOTTOM:\n\t\t\treturn EShapeTextAlignHorizontal.OUTSIDE_RIGHT;\n\t}\n};\n\nconst rotateAlignHorizontalLeft = (align: EShapeTextAlignHorizontal): EShapeTextAlignVertical => {\n\tswitch (align) {\n\t\tcase EShapeTextAlignHorizontal.LEFT:\n\t\t\treturn EShapeTextAlignVertical.TOP;\n\t\tcase EShapeTextAlignHorizontal.CENTER:\n\t\t\treturn EShapeTextAlignVertical.MIDDLE;\n\t\tcase EShapeTextAlignHorizontal.RIGHT:\n\t\t\treturn EShapeTextAlignVertical.BOTTOM;\n\t\tcase EShapeTextAlignHorizontal.OUTSIDE_LEFT:\n\t\t\treturn EShapeTextAlignVertical.OUTSIDE_TOP;\n\t\tcase EShapeTextAlignHorizontal.OUTSIDE_RIGHT:\n\t\t\treturn EShapeTextAlignVertical.OUTSIDE_BOTTOM;\n\t}\n};\n\nconst rotateAlignVerticalLeft = (align: EShapeTextAlignVertical): EShapeTextAlignHorizontal => {\n\tswitch (align) {\n\t\tcase EShapeTextAlignVertical.TOP:\n\t\t\treturn EShapeTextAlignHorizontal.RIGHT;\n\t\tcase EShapeTextAlignVertical.MIDDLE:\n\t\t\treturn EShapeTextAlignHorizontal.CENTER;\n\t\tcase EShapeTextAlignVertical.BOTTOM:\n\t\t\treturn EShapeTextAlignHorizontal.LEFT;\n\t\tcase EShapeTextAlignVertical.OUTSIDE_TOP:\n\t\t\treturn EShapeTextAlignHorizontal.OUTSIDE_RIGHT;\n\t\tcase EShapeTextAlignVertical.OUTSIDE_BOTTOM:\n\t\t\treturn EShapeTextAlignHorizontal.OUTSIDE_LEFT;\n\t}\n};\n\nexport const buildTextVertex = (\n\tvertices: Float32Array,\n\tuvs: Float32Array,\n\tvoffset: number,\n\tvcount: number,\n\toriginX: number,\n\toriginY: number,\n\tsizeX: number,\n\tsizeY: number,\n\ttextAtlas: EShapeTextAtlas,\n\ttextSize: number,\n\ttextValue: string,\n\ttextStyle: EShapeTextStyle,\n\ttextAlignHorizontal: EShapeTextAlignHorizontal,\n\ttextAlignVertical: EShapeTextAlignVertical,\n\ttextOffsetHorizontal: number,\n\ttextOffsetVertical: number,\n\ttextSpacingHorizontal: number,\n\ttextSpacingVertical: number,\n\ttextDirection: EShapeTextDirection,\n\ttextPaddingHorizontal: number,\n\ttextPaddingVertical: number,\n\ttextClipping: boolean,\n\ttextWorld: number[],\n\ttextureUvs: TextureUvs,\n\tinternalTransform: Matrix\n): void => {\n\t// Calculate the transformed positions\n\t//\n\t//  0               1\n\t// |---------------|\n\t// |               |\n\t// |3              |2\n\t// |---------------|\n\t//\n\tconst sx = sizeX * 0.5;\n\tconst sy = sizeY * 0.5;\n\tconst work = TEXT_WORK_POINT;\n\twork.set(originX - sx, originY - sy);\n\tinternalTransform.apply(work, work);\n\tconst x0 = work.x;\n\tconst y0 = work.y;\n\twork.set(originX + sx, originY - sy);\n\tinternalTransform.apply(work, work);\n\tconst x1 = work.x;\n\tconst y1 = work.y;\n\twork.set(originX + sx, originY + sy);\n\tinternalTransform.apply(work, work);\n\tconst x2 = work.x;\n\tconst y2 = work.y;\n\tconst x3 = x0 + (x2 - x1);\n\tconst y3 = y0 + (y2 - y1);\n\n\t// Horizontal normal\n\tconst hl = toLength(x0, y0, x1, y1);\n\ttoNormalized(internalTransform.a, internalTransform.b, 1, 0, work);\n\tlet hnx = work.x;\n\tlet hny = work.y;\n\n\t// Vertical normal\n\tconst vl = toLength(x0, y0, x3, y3);\n\ttoNormalized(internalTransform.c, internalTransform.d, 0, 1, work);\n\tlet vnx = work.x;\n\tlet vny = work.y;\n\n\t// Calculate the width / height\n\tlet width = 0;\n\tlet height = 0;\n\tlet heightChar = 0;\n\tconst lineHeight = Math.max(0, textSize + textSpacingVertical);\n\tlet lineWidth = 0;\n\tconst textAtlasCharacters = textAtlas.characters;\n\tconst iterator = UtilCharacterIterator.from(textValue);\n\tlet advancePrevious = 0;\n\twhile (iterator.hasNext()) {\n\t\tconst character = iterator.next();\n\t\tif (character !== \"\\n\") {\n\t\t\tif (0 < advancePrevious) {\n\t\t\t\tlineWidth += Math.max(0, advancePrevious + textSpacingHorizontal);\n\t\t\t}\n\t\t\tconst data = textAtlasCharacters[character];\n\t\t\tif (data) {\n\t\t\t\tadvancePrevious = data.advance;\n\t\t\t\theightChar = data.height;\n\t\t\t} else {\n\t\t\t\tadvancePrevious = 0;\n\t\t\t}\n\t\t} else {\n\t\t\tlineWidth += advancePrevious;\n\t\t\tadvancePrevious = 0;\n\t\t\twidth = Math.max(width, lineWidth);\n\t\t\tlineWidth = 0;\n\t\t\theight += lineHeight;\n\t\t}\n\t}\n\n\tconst scale = textSize / textAtlas.font.size;\n\tlineWidth += advancePrevious;\n\twidth = Math.max(width, lineWidth) * scale;\n\tlineWidth = 0;\n\theightChar *= scale;\n\theight += textSize;\n\n\t//\n\tlet tx0 = 0;\n\tlet ty0 = 0;\n\tlet lineWidthMaximum = NaN;\n\tswitch (textDirection) {\n\t\tcase EShapeTextDirection.LEFT_TO_RIGHT:\n\t\t\tgetTextBBox(\n\t\t\t\ttextAlignHorizontal,\n\t\t\t\ttextAlignVertical,\n\t\t\t\ttextOffsetHorizontal,\n\t\t\t\ttextOffsetVertical,\n\t\t\t\ttextPaddingHorizontal,\n\t\t\t\ttextPaddingVertical,\n\t\t\t\twidth,\n\t\t\t\theight,\n\t\t\t\tx0,\n\t\t\t\ty0,\n\t\t\t\tx1,\n\t\t\t\ty1,\n\t\t\t\tx2,\n\t\t\t\ty2,\n\t\t\t\tx3,\n\t\t\t\ty3,\n\t\t\t\thnx,\n\t\t\t\thny,\n\t\t\t\tvnx,\n\t\t\t\tvny,\n\t\t\t\twork\n\t\t\t);\n\t\t\ttx0 = work.x;\n\t\t\tty0 = work.y;\n\t\t\tif (textClipping) {\n\t\t\t\tswitch (textAlignHorizontal) {\n\t\t\t\t\tcase EShapeTextAlignHorizontal.LEFT:\n\t\t\t\t\tcase EShapeTextAlignHorizontal.CENTER:\n\t\t\t\t\tcase EShapeTextAlignHorizontal.RIGHT:\n\t\t\t\t\t\tswitch (textAlignVertical) {\n\t\t\t\t\t\t\tcase EShapeTextAlignVertical.TOP:\n\t\t\t\t\t\t\tcase EShapeTextAlignVertical.MIDDLE:\n\t\t\t\t\t\t\tcase EShapeTextAlignVertical.BOTTOM:\n\t\t\t\t\t\t\t\tlineWidthMaximum = hl - textPaddingHorizontal * 2;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\t\tcase EShapeTextDirection.TOP_TO_BOTTOM:\n\t\t\t// Swap normals\n\t\t\twork.set(vnx, vny);\n\t\t\tvnx = -hnx;\n\t\t\tvny = -hny;\n\t\t\thnx = work.x;\n\t\t\thny = work.y;\n\n\t\t\t// Get text bbox\n\t\t\tgetTextBBox(\n\t\t\t\trotateAlignVerticalRight(textAlignVertical),\n\t\t\t\trotateAlignHorizontalRight(textAlignHorizontal),\n\t\t\t\ttextOffsetVertical,\n\t\t\t\ttextOffsetHorizontal,\n\t\t\t\ttextPaddingVertical,\n\t\t\t\ttextPaddingHorizontal,\n\t\t\t\twidth,\n\t\t\t\theight,\n\t\t\t\tx1,\n\t\t\t\ty1,\n\t\t\t\tx2,\n\t\t\t\ty2,\n\t\t\t\tx3,\n\t\t\t\ty3,\n\t\t\t\tx0,\n\t\t\t\ty0,\n\t\t\t\thnx,\n\t\t\t\thny,\n\t\t\t\tvnx,\n\t\t\t\tvny,\n\t\t\t\twork\n\t\t\t);\n\t\t\ttx0 = work.x;\n\t\t\tty0 = work.y;\n\t\t\tif (textClipping) {\n\t\t\t\tswitch (textAlignVertical) {\n\t\t\t\t\tcase EShapeTextAlignVertical.TOP:\n\t\t\t\t\tcase EShapeTextAlignVertical.MIDDLE:\n\t\t\t\t\tcase EShapeTextAlignVertical.BOTTOM:\n\t\t\t\t\t\tswitch (textAlignHorizontal) {\n\t\t\t\t\t\t\tcase EShapeTextAlignHorizontal.LEFT:\n\t\t\t\t\t\t\tcase EShapeTextAlignHorizontal.CENTER:\n\t\t\t\t\t\t\tcase EShapeTextAlignHorizontal.RIGHT:\n\t\t\t\t\t\t\t\tlineWidthMaximum = vl - textPaddingVertical * 2;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\t\tcase EShapeTextDirection.BOTTOM_TO_TOP:\n\t\t\t// Swap normals\n\t\t\twork.set(vnx, vny);\n\t\t\tvnx = hnx;\n\t\t\tvny = hny;\n\t\t\thnx = -work.x;\n\t\t\thny = -work.y;\n\n\t\t\t// Get text bbox\n\t\t\tgetTextBBox(\n\t\t\t\trotateAlignVerticalLeft(textAlignVertical),\n\t\t\t\trotateAlignHorizontalLeft(textAlignHorizontal),\n\t\t\t\ttextOffsetVertical,\n\t\t\t\ttextOffsetHorizontal,\n\t\t\t\ttextPaddingVertical,\n\t\t\t\ttextPaddingHorizontal,\n\t\t\t\twidth,\n\t\t\t\theight,\n\t\t\t\tx3,\n\t\t\t\ty3,\n\t\t\t\tx0,\n\t\t\t\ty0,\n\t\t\t\tx1,\n\t\t\t\ty1,\n\t\t\t\tx2,\n\t\t\t\ty2,\n\t\t\t\thnx,\n\t\t\t\thny,\n\t\t\t\tvnx,\n\t\t\t\tvny,\n\t\t\t\twork\n\t\t\t);\n\t\t\ttx0 = work.x;\n\t\t\tty0 = work.y;\n\t\t\tif (textClipping) {\n\t\t\t\tswitch (textAlignVertical) {\n\t\t\t\t\tcase EShapeTextAlignVertical.TOP:\n\t\t\t\t\tcase EShapeTextAlignVertical.MIDDLE:\n\t\t\t\t\tcase EShapeTextAlignVertical.BOTTOM:\n\t\t\t\t\t\tswitch (textAlignHorizontal) {\n\t\t\t\t\t\t\tcase EShapeTextAlignHorizontal.LEFT:\n\t\t\t\t\t\t\tcase EShapeTextAlignHorizontal.CENTER:\n\t\t\t\t\t\t\tcase EShapeTextAlignHorizontal.RIGHT:\n\t\t\t\t\t\t\t\tlineWidthMaximum = vl - textPaddingVertical * 2;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\t}\n\n\t//\n\tif (lineWidthMaximum < width) {\n\t\tconst dwidth = (width - lineWidthMaximum) * 0.5;\n\t\ttextWorld[0] = tx0 + hnx * dwidth;\n\t\ttextWorld[1] = ty0 + hny * dwidth;\n\t\ttextWorld[2] = hnx;\n\t\ttextWorld[3] = hny;\n\t\ttextWorld[4] = vnx;\n\t\ttextWorld[5] = vny;\n\t\ttextWorld[6] = lineWidthMaximum;\n\t\ttextWorld[7] = height;\n\t} else {\n\t\ttextWorld[0] = tx0;\n\t\ttextWorld[1] = ty0;\n\t\ttextWorld[2] = hnx;\n\t\ttextWorld[3] = hny;\n\t\ttextWorld[4] = vnx;\n\t\ttextWorld[5] = vny;\n\t\ttextWorld[6] = width;\n\t\ttextWorld[7] = height;\n\t}\n\n\t// Texture\n\tconst uvx0 = textureUvs.x0;\n\tconst uvx1 = textureUvs.x1;\n\tconst uvx3 = textureUvs.x3;\n\tconst uvy0 = textureUvs.y0;\n\tconst uvy1 = textureUvs.y1;\n\tconst uvy3 = textureUvs.y3;\n\n\tconst duvx01 = uvx1 - uvx0;\n\tconst duvy01 = uvy1 - uvy0;\n\tconst duvx03 = uvx3 - uvx0;\n\tconst duvy03 = uvy3 - uvy0;\n\n\t// Vertices & UVs\n\tconst lhx = lineHeight * vnx;\n\tconst lhy = lineHeight * vny;\n\n\tconst snx = scale * hnx;\n\tconst sny = scale * hny;\n\n\tconst offsetY = (heightChar - textSize) * 0.5;\n\tconst oyx = offsetY * vnx;\n\tconst oyy = offsetY * vny;\n\n\tconst offsetItalic = textStyle === EShapeTextStyle.NORMAL ? 0 : textSize * 0.25;\n\tlet bx0 = tx0 - oyx + offsetItalic * snx;\n\tlet by0 = ty0 - oyy + offsetItalic * sny;\n\tlet bx3 = tx0 + oyx + textSize * vnx;\n\tlet by3 = ty0 + oyy + textSize * vny;\n\tlet cx0 = bx0;\n\tlet cy0 = by0;\n\tlet cx3 = bx3;\n\tlet cy3 = by3;\n\n\tlineWidth = 0;\n\tadvancePrevious = 0;\n\titerator.position = 0;\n\tlet lineCount = 0;\n\tlet iv = voffset * 2;\n\tfor (; iterator.hasNext(); iv += 8) {\n\t\tconst character = iterator.next();\n\t\tif (character !== \"\\n\") {\n\t\t\tconst lineWidthPrevious = lineWidth;\n\t\t\tif (0 < advancePrevious) {\n\t\t\t\tlineWidth += Math.max(0, advancePrevious + textSpacingHorizontal);\n\t\t\t}\n\n\t\t\tconst ax = lineWidth * snx;\n\t\t\tconst ay = lineWidth * sny;\n\t\t\tcx0 = bx0 + ax;\n\t\t\tcy0 = by0 + ay;\n\t\t\tcx3 = bx3 + ax;\n\t\t\tcy3 = by3 + ay;\n\n\t\t\tconst data = textAtlasCharacters[character];\n\t\t\tlineCount += 1;\n\t\t\tif (data) {\n\t\t\t\tconst advance = data.advance;\n\t\t\t\tif (lineWidthMaximum < (lineWidth + advance) * scale) {\n\t\t\t\t\tconst dots = textAtlasCharacters[\"...\"];\n\t\t\t\t\tif (dots) {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t1 < lineCount &&\n\t\t\t\t\t\t\tlineWidthMaximum < (lineWidth + dots.advance) * scale\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tlineWidth = lineWidthPrevious;\n\t\t\t\t\t\t\tiv -= 8;\n\t\t\t\t\t\t\tlineCount -= 1;\n\t\t\t\t\t\t\tconst bx = lineWidth * snx;\n\t\t\t\t\t\t\tconst by = lineWidth * sny;\n\t\t\t\t\t\t\tcx0 = bx0 + bx;\n\t\t\t\t\t\t\tcy0 = by0 + by;\n\t\t\t\t\t\t\tcx3 = bx3 + bx;\n\t\t\t\t\t\t\tcy3 = by3 + by;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tadvancePrevious = dots.advance;\n\n\t\t\t\t\t\twriteCharacter(\n\t\t\t\t\t\t\tvertices,\n\t\t\t\t\t\t\tuvs,\n\t\t\t\t\t\t\tiv,\n\t\t\t\t\t\t\tdots,\n\t\t\t\t\t\t\ttextAtlas,\n\t\t\t\t\t\t\tsnx,\n\t\t\t\t\t\t\tsny,\n\t\t\t\t\t\t\tcx0,\n\t\t\t\t\t\t\tcy0,\n\t\t\t\t\t\t\tcx3,\n\t\t\t\t\t\t\tcy3,\n\t\t\t\t\t\t\tduvx01,\n\t\t\t\t\t\t\tduvy01,\n\t\t\t\t\t\t\tduvx03,\n\t\t\t\t\t\t\tduvy03,\n\t\t\t\t\t\t\tuvx0,\n\t\t\t\t\t\t\tuvy0\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tfor (iv += 8; true; iv += 8) {\n\t\t\t\t\t\t\tif (iterator.hasNext() && iterator.advance(\"\\n\")) {\n\t\t\t\t\t\t\t\twriteCharacterEmpty(\n\t\t\t\t\t\t\t\t\tvertices,\n\t\t\t\t\t\t\t\t\tuvs,\n\t\t\t\t\t\t\t\t\tiv,\n\t\t\t\t\t\t\t\t\tcx0,\n\t\t\t\t\t\t\t\t\tcy0,\n\t\t\t\t\t\t\t\t\tcx3,\n\t\t\t\t\t\t\t\t\tcy3,\n\t\t\t\t\t\t\t\t\tuvx0,\n\t\t\t\t\t\t\t\t\tuvy0,\n\t\t\t\t\t\t\t\t\tuvx3,\n\t\t\t\t\t\t\t\t\tuvy3\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tlineCount += 1;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tiv -= 8;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tadvancePrevious = advance;\n\n\t\t\t\t\t\twriteCharacterEmpty(\n\t\t\t\t\t\t\tvertices,\n\t\t\t\t\t\t\tuvs,\n\t\t\t\t\t\t\tiv,\n\t\t\t\t\t\t\tcx0,\n\t\t\t\t\t\t\tcy0,\n\t\t\t\t\t\t\tcx3,\n\t\t\t\t\t\t\tcy3,\n\t\t\t\t\t\t\tuvx0,\n\t\t\t\t\t\t\tuvy0,\n\t\t\t\t\t\t\tuvx3,\n\t\t\t\t\t\t\tuvy3\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tadvancePrevious = advance;\n\n\t\t\t\t\twriteCharacter(\n\t\t\t\t\t\tvertices,\n\t\t\t\t\t\tuvs,\n\t\t\t\t\t\tiv,\n\t\t\t\t\t\tdata,\n\t\t\t\t\t\ttextAtlas,\n\t\t\t\t\t\tsnx,\n\t\t\t\t\t\tsny,\n\t\t\t\t\t\tcx0,\n\t\t\t\t\t\tcy0,\n\t\t\t\t\t\tcx3,\n\t\t\t\t\t\tcy3,\n\t\t\t\t\t\tduvx01,\n\t\t\t\t\t\tduvy01,\n\t\t\t\t\t\tduvx03,\n\t\t\t\t\t\tduvy03,\n\t\t\t\t\t\tuvx0,\n\t\t\t\t\t\tuvy0\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tadvancePrevious = 0;\n\n\t\t\t\twriteCharacterEmpty(vertices, uvs, iv, cx0, cy0, cx3, cy3, uvx0, uvy0, uvx3, uvy3);\n\t\t\t}\n\t\t} else {\n\t\t\tlineWidth += advancePrevious;\n\t\t\tadvancePrevious = 0;\n\n\t\t\tbx0 += lhx;\n\t\t\tby0 += lhy;\n\t\t\tbx3 += lhx;\n\t\t\tby3 += lhy;\n\t\t\tcx0 = bx0;\n\t\t\tcy0 = by0;\n\t\t\tcx3 = bx3;\n\t\t\tcy3 = by3;\n\n\t\t\twriteCharacterEmpty(vertices, uvs, iv, cx0, cy0, cx3, cy3, uvx0, uvy0, uvx3, uvy3);\n\n\t\t\tadjustTextAlignment(\n\t\t\t\tvertices,\n\t\t\t\thnx,\n\t\t\t\thny,\n\t\t\t\tlineCount,\n\t\t\t\tiv,\n\t\t\t\twidth - lineWidth * scale,\n\t\t\t\ttextDirection,\n\t\t\t\ttextAlignHorizontal,\n\t\t\t\ttextAlignVertical\n\t\t\t);\n\t\t\tlineWidth = 0;\n\t\t\tlineCount = 0;\n\t\t}\n\t}\n\n\tlineWidth += advancePrevious;\n\tadjustTextAlignment(\n\t\tvertices,\n\t\thnx,\n\t\thny,\n\t\tlineCount,\n\t\tiv,\n\t\twidth - lineWidth * scale,\n\t\ttextDirection,\n\t\ttextAlignHorizontal,\n\t\ttextAlignVertical\n\t);\n\n\tfor (const ivmax = (voffset + vcount) * 2; iv < ivmax; iv += 2) {\n\t\tvertices[iv + 0] = tx0;\n\t\tvertices[iv + 1] = ty0;\n\t\tuvs[iv + 0] = uvx0;\n\t\tuvs[iv + 1] = uvy0;\n\t}\n};\n\nconst writeCharacterEmpty = (\n\tvertices: Float32Array,\n\tuvs: Float32Array,\n\tiv: number,\n\tcx0: number,\n\tcy0: number,\n\tcx3: number,\n\tcy3: number,\n\tuvx0: number,\n\tuvy0: number,\n\tuvx3: number,\n\tuvy3: number\n): void => {\n\tvertices[iv + 0] = cx0;\n\tvertices[iv + 1] = cy0;\n\tvertices[iv + 2] = cx0;\n\tvertices[iv + 3] = cy0;\n\tvertices[iv + 4] = cx3;\n\tvertices[iv + 5] = cy3;\n\tvertices[iv + 6] = cx3;\n\tvertices[iv + 7] = cy3;\n\n\tuvs[iv + 0] = uvx0;\n\tuvs[iv + 1] = uvy0;\n\tuvs[iv + 2] = uvx0;\n\tuvs[iv + 3] = uvy0;\n\tuvs[iv + 4] = uvx3;\n\tuvs[iv + 5] = uvy3;\n\tuvs[iv + 6] = uvx3;\n\tuvs[iv + 7] = uvy3;\n};\n\nconst writeCharacter = (\n\tvertices: Float32Array,\n\tuvs: Float32Array,\n\tiv: number,\n\tdata: EShapeTextAtlasCharacter,\n\tatlas: EShapeTextAtlas,\n\tsnx: number,\n\tsny: number,\n\tcx0: number,\n\tcy0: number,\n\tcx3: number,\n\tcy3: number,\n\tduvx01: number,\n\tduvy01: number,\n\tduvx03: number,\n\tduvy03: number,\n\tuvx0: number,\n\tuvy0: number\n): void => {\n\t// Vertices\n\tconst dataOffsetX = data.x - data.origin.x;\n\tconst dataWidth = data.width;\n\tconst dx0 = dataOffsetX * snx;\n\tconst dy0 = dataOffsetX * sny;\n\tconst dx1 = (dataOffsetX + dataWidth) * snx;\n\tconst dy1 = (dataOffsetX + dataWidth) * sny;\n\tvertices[iv + 0] = cx0 + dx0;\n\tvertices[iv + 1] = cy0 + dy0;\n\tvertices[iv + 2] = cx0 + dx1;\n\tvertices[iv + 3] = cy0 + dy1;\n\tvertices[iv + 4] = cx3 + dx1;\n\tvertices[iv + 5] = cy3 + dy1;\n\tvertices[iv + 6] = cx3 + dx0;\n\tvertices[iv + 7] = cy3 + dy0;\n\n\t// UVs\n\tconst px0 = data.x / atlas.width;\n\tconst py0 = data.y / atlas.height;\n\tconst px1 = (data.x + data.width) / atlas.width;\n\tconst py1 = (data.y + data.height) / atlas.height;\n\n\tconst dux0 = duvx01 * px0;\n\tconst duy0 = duvy01 * px0;\n\tconst dux1 = duvx01 * px1;\n\tconst duy1 = duvy01 * px1;\n\n\tconst dvx0 = duvx03 * py0;\n\tconst dvy0 = duvy03 * py0;\n\tconst dvx1 = duvx03 * py1;\n\tconst dvy1 = duvy03 * py1;\n\tuvs[iv + 0] = uvx0 + dux0 + dvx0;\n\tuvs[iv + 1] = uvy0 + duy0 + dvy0;\n\tuvs[iv + 2] = uvx0 + dux1 + dvx0;\n\tuvs[iv + 3] = uvy0 + duy1 + dvy0;\n\tuvs[iv + 4] = uvx0 + dux1 + dvx1;\n\tuvs[iv + 5] = uvy0 + duy1 + dvy1;\n\tuvs[iv + 6] = uvx0 + dux0 + dvx1;\n\tuvs[iv + 7] = uvy0 + duy0 + dvy1;\n};\n\nconst moveText = (\n\tvertices: Float32Array,\n\tvertexIndex: number,\n\ttextCount: number,\n\tdx: number,\n\tdy: number\n): void => {\n\tlet iv = vertexIndex - 8 * textCount - 1;\n\tfor (let i = 0; i < textCount; ++i) {\n\t\tvertices[++iv] += dx;\n\t\tvertices[++iv] += dy;\n\t\tvertices[++iv] += dx;\n\t\tvertices[++iv] += dy;\n\t\tvertices[++iv] += dx;\n\t\tvertices[++iv] += dy;\n\t\tvertices[++iv] += dx;\n\t\tvertices[++iv] += dy;\n\t}\n};\n\nconst moveTextHalf = (\n\tvertices: Float32Array,\n\tvertexIndex: number,\n\ttextCount: number,\n\toffset: number,\n\tnx: number,\n\tny: number\n): void => {\n\toffset *= 0.5;\n\tmoveText(vertices, vertexIndex, textCount, offset * nx, offset * ny);\n};\n\nconst moveTextFull = (\n\tvertices: Float32Array,\n\tvertexIndex: number,\n\ttextCount: number,\n\toffset: number,\n\tnx: number,\n\tny: number\n): void => {\n\tmoveText(vertices, vertexIndex, textCount, offset * nx, offset * ny);\n};\n\nconst adjustTextAlignment = (\n\tvertices: Float32Array,\n\tnx: number,\n\tny: number,\n\tlineCount: number,\n\tvertexIndex: number,\n\toffset: number,\n\ttextDirection: EShapeTextDirection,\n\ttextAlignHorizontal: EShapeTextAlignHorizontal,\n\ttextAlignVertical: EShapeTextAlignVertical\n): void => {\n\tif (TEXT_FMIN < offset) {\n\t\tswitch (textDirection) {\n\t\t\tcase EShapeTextDirection.LEFT_TO_RIGHT:\n\t\t\t\tswitch (textAlignHorizontal) {\n\t\t\t\t\tcase EShapeTextAlignHorizontal.OUTSIDE_RIGHT:\n\t\t\t\t\tcase EShapeTextAlignHorizontal.LEFT:\n\t\t\t\t\t\t// DO NOTHING\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase EShapeTextAlignHorizontal.CENTER:\n\t\t\t\t\t\tmoveTextHalf(vertices, vertexIndex, lineCount, offset, nx, ny);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase EShapeTextAlignHorizontal.OUTSIDE_LEFT:\n\t\t\t\t\tcase EShapeTextAlignHorizontal.RIGHT:\n\t\t\t\t\t\tmoveTextFull(vertices, vertexIndex, lineCount, offset, nx, ny);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase EShapeTextDirection.TOP_TO_BOTTOM:\n\t\t\t\tswitch (textAlignVertical) {\n\t\t\t\t\tcase EShapeTextAlignVertical.OUTSIDE_BOTTOM:\n\t\t\t\t\tcase EShapeTextAlignVertical.TOP:\n\t\t\t\t\t\t// DO NOTHING\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase EShapeTextAlignVertical.MIDDLE:\n\t\t\t\t\t\tmoveTextHalf(vertices, vertexIndex, lineCount, offset, nx, ny);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase EShapeTextAlignVertical.OUTSIDE_TOP:\n\t\t\t\t\tcase EShapeTextAlignVertical.BOTTOM:\n\t\t\t\t\t\tmoveTextFull(vertices, vertexIndex, lineCount, offset, nx, ny);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase EShapeTextDirection.BOTTOM_TO_TOP:\n\t\t\t\tswitch (textAlignVertical) {\n\t\t\t\t\tcase EShapeTextAlignVertical.OUTSIDE_BOTTOM:\n\t\t\t\t\tcase EShapeTextAlignVertical.TOP:\n\t\t\t\t\t\tmoveTextFull(vertices, vertexIndex, lineCount, offset, nx, ny);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase EShapeTextAlignVertical.MIDDLE:\n\t\t\t\t\t\tmoveTextHalf(vertices, vertexIndex, lineCount, offset, nx, ny);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase EShapeTextAlignVertical.OUTSIDE_TOP:\n\t\t\t\t\tcase EShapeTextAlignVertical.BOTTOM:\n\t\t\t\t\t\t// DO NOTHING\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t}\n};\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nconst CLOSED = 1;\n\nconst NON_EXPANDING_WIDTH = 2;\nconst NON_SHRINKING_WIDTH = 4;\nconst NON_SCALING_DOT_AND_DASH = 8;\n\nconst DOTTED = 16;\nconst DOTTED_DENSELY = 32;\nconst DOTTED_LOOSELY = 64;\n\nconst DASHED = 128;\nconst DASHED_DENSELY = 256;\nconst DASHED_LOOSELY = 512;\n\nconst CURVE = 1024;\n\nexport const EShapePointsStyle = {\n\tNONE: 0,\n\n\tCLOSED,\n\n\t/** @deprecated in favor of EShapeStrokeStyle. */\n\tNON_EXPANDING_WIDTH,\n\n\t/** @deprecated in favor of EShapeStrokeStyle. */\n\tNON_SHRINKING_WIDTH,\n\n\t/** @deprecated in favor of EShapeStrokeStyle. */\n\tNON_SCALING_DOT_AND_DASH,\n\n\t/** @deprecated in favor of EShapeStrokeStyle. */\n\tNON_SCALING_MASK: NON_EXPANDING_WIDTH | NON_SHRINKING_WIDTH | NON_SCALING_DOT_AND_DASH,\n\n\t/** @deprecated in favor of EShapeStrokeStyle. */\n\tDOTTED,\n\n\t/** @deprecated in favor of EShapeStrokeStyle. */\n\tDOTTED_DENSELY,\n\n\t/** @deprecated in favor of EShapeStrokeStyle. */\n\tDOTTED_LOOSELY,\n\n\t/** @deprecated in favor of EShapeStrokeStyle. */\n\tDOTTED_MASK: DOTTED | DOTTED_DENSELY | DOTTED_LOOSELY,\n\n\t/** @deprecated in favor of EShapeStrokeStyle. */\n\tDASHED,\n\n\t/** @deprecated in favor of EShapeStrokeStyle. */\n\tDASHED_DENSELY,\n\n\t/** @deprecated in favor of EShapeStrokeStyle. */\n\tDASHED_LOOSELY,\n\n\t/** @deprecated in favor of EShapeStrokeStyle. */\n\tDASHED_MASK: DASHED | DASHED_DENSELY | DASHED_LOOSELY,\n\n\tCURVE,\n\tFORMATTER_MASK: CURVE\n} as const;\n\nexport type EShapePointsStyle = number;\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShapeData } from \"../e-shape-data\";\nimport { EShapeDataValue } from \"../e-shape-data-value\";\nimport { EShapeDataValueRange } from \"../e-shape-data-value-range\";\nimport { EShapeDataValueImpl } from \"./e-shape-data-value-impl\";\nimport { EShapeDataValueRangeImpl } from \"./e-shape-data-value-range-impl\";\n\nlet RANGE_DUMMY: EShapeDataValueRange | undefined;\n\nexport class EShapeDataImpl implements EShapeData {\n\tprotected _values: EShapeDataValue[];\n\tprotected _isChanged: boolean;\n\n\tconstructor() {\n\t\tthis._values = [];\n\t\tthis._isChanged = true;\n\t}\n\n\tget values(): EShapeDataValue[] {\n\t\treturn this._values;\n\t}\n\n\tget isChanged(): boolean {\n\t\treturn this._isChanged;\n\t}\n\n\tset isChanged(isChanged: boolean) {\n\t\tthis._isChanged = isChanged;\n\t}\n\n\tget id(): string {\n\t\tconst values = this._values;\n\t\tif (0 < values.length) {\n\t\t\treturn values[0].id;\n\t\t}\n\t\treturn \"\";\n\t}\n\n\tget initial(): string {\n\t\tconst values = this._values;\n\t\tif (0 < values.length) {\n\t\t\treturn values[0].initial;\n\t\t}\n\t\treturn \"\";\n\t}\n\n\tget format(): string {\n\t\tconst values = this._values;\n\t\tif (0 < values.length) {\n\t\t\treturn values[0].format;\n\t\t}\n\t\treturn \"\";\n\t}\n\n\tget range(): EShapeDataValueRange {\n\t\tconst values = this._values;\n\t\tif (0 < values.length) {\n\t\t\treturn values[0].range;\n\t\t}\n\t\treturn (RANGE_DUMMY ??= new EShapeDataValueRangeImpl());\n\t}\n\n\tget value(): unknown {\n\t\tconst values = this._values;\n\t\tif (0 < values.length) {\n\t\t\treturn values[0].value;\n\t\t}\n\t\treturn 0;\n\t}\n\n\tset value(value: unknown) {\n\t\tconst values = this._values;\n\t\tif (0 < values.length) {\n\t\t\tvalues[0].value = value;\n\t\t}\n\t}\n\n\tget nvalue(): number {\n\t\tconst values = this._values;\n\t\tif (0 < values.length) {\n\t\t\treturn values[0].nvalue;\n\t\t}\n\t\treturn 0;\n\t}\n\n\tget time(): number {\n\t\tconst values = this._values;\n\t\tif (0 < values.length) {\n\t\t\treturn values[0].time;\n\t\t}\n\t\treturn 0;\n\t}\n\n\tset time(time: number) {\n\t\tconst values = this._values;\n\t\tif (0 < values.length) {\n\t\t\tvalues[0].time = time;\n\t\t}\n\t}\n\n\tget capacity(): number {\n\t\tconst values = this._values;\n\t\tif (0 < values.length) {\n\t\t\treturn values[0].capacity;\n\t\t}\n\t\treturn 0;\n\t}\n\n\tset capacity(capacity: number) {\n\t\tconst values = this._values;\n\t\tif (0 < values.length) {\n\t\t\tvalues[0].capacity = capacity;\n\t\t}\n\t}\n\n\tadd(value: EShapeDataValue, index?: number): void {\n\t\tconst values = this._values;\n\t\tvalue.parent = this;\n\t\tif (index === undefined) {\n\t\t\tvalues.push(value);\n\t\t} else {\n\t\t\tvalues.splice(index, 0, value);\n\t\t}\n\t}\n\n\tset(index: number, value: EShapeDataValue): EShapeDataValue | null {\n\t\tconst values = this._values;\n\t\tif (0 <= index && index < values.length) {\n\t\t\tconst result = values[index];\n\t\t\tvalue.parent = this;\n\t\t\tvalues[index] = value;\n\t\t\tresult.parent = undefined;\n\t\t\treturn result;\n\t\t}\n\t\treturn null;\n\t}\n\n\tremove(index: number): void {\n\t\tconst values = this._values;\n\t\tif (0 <= index && index < values.length) {\n\t\t\tvalues.splice(index, 1)[0].parent = undefined;\n\t\t}\n\t}\n\n\tindexOf(target: EShapeDataValue): number {\n\t\tconst values = this._values;\n\t\tconst valuesLength = values.length;\n\n\t\t// Instance-based matching\n\t\tfor (let i = 0; i < valuesLength; ++i) {\n\t\t\tif (values[i] === target) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\n\t\t// Data-based matching\n\t\tfor (let i = 0; i < valuesLength; ++i) {\n\t\t\tif (values[i].isEquals(target)) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\n\t\t// ID-based matching\n\t\tfor (let i = 0; i < valuesLength; ++i) {\n\t\t\tif (values[i].id === target.id) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\n\t\treturn -1;\n\t}\n\n\tget(index: number): EShapeDataValue | null {\n\t\tconst values = this._values;\n\t\tif (0 <= index && index < values.length) {\n\t\t\treturn values[index];\n\t\t}\n\t\treturn null;\n\t}\n\n\tsize(): number {\n\t\treturn this._values.length;\n\t}\n\n\tswap(indexA: number, indexB: number): void {\n\t\tconst values = this._values;\n\t\tconst tmp = values[indexB];\n\t\tvalues[indexB] = values[indexA];\n\t\tvalues[indexA] = tmp;\n\t}\n\n\tcopy(target: EShapeData): this {\n\t\tconst values = this._values;\n\t\tvalues.length = 0;\n\n\t\tfor (let i = 0, imax = target.size(); i < imax; ++i) {\n\t\t\tconst value = target.get(i);\n\t\t\tif (value != null) {\n\t\t\t\tconst newValue = new EShapeDataValueImpl().copy(value);\n\t\t\t\tnewValue.parent = this;\n\t\t\t\tvalues.push(newValue);\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\tconst values = this._values;\n\t\tif (values.length <= 0) {\n\t\t\treturn manager.addResource(\"[]\");\n\t\t} else {\n\t\t\tlet serialized = `[${values[0].serialize(manager)}`;\n\t\t\tfor (let i = 1, imax = values.length; i < imax; ++i) {\n\t\t\t\tserialized += `,${values[i].serialize(manager)}`;\n\t\t\t}\n\t\t\tserialized += \"]\";\n\t\t\treturn manager.addResource(serialized);\n\t\t}\n\t}\n\n\tdeserialize(target: number, manager: EShapeResourceManagerDeserialization): void {\n\t\tif (0 <= target && target < manager.resources.length) {\n\t\t\tlet deserialized: number[] | undefined = manager.getData(target);\n\t\t\tif (deserialized == null) {\n\t\t\t\tdeserialized = JSON.parse(manager.resources[target]) as number[];\n\t\t\t\tmanager.setData(target, deserialized);\n\t\t\t}\n\n\t\t\tconst values = this._values;\n\t\t\tvalues.length = 0;\n\t\t\tconst deserializedLength = deserialized.length;\n\t\t\tfor (let i = 0; i < deserializedLength; ++i) {\n\t\t\t\tconst index = deserialized[i];\n\t\t\t\tconst value = new EShapeDataValueImpl();\n\t\t\t\tvalue.parent = this;\n\t\t\t\tvalue.deserialize(index, manager);\n\t\t\t\tvalues.push(value);\n\t\t\t}\n\t\t}\n\t}\n}\n","import { Matrix, Point, TextureUvs } from \"pixi.js\";\nimport { EShapePoints } from \"../e-shape-points\";\nimport { EShapeStrokeStyle } from \"../e-shape-stroke-style\";\nimport { toDash } from \"./to-dash\";\nimport { toLength } from \"./to-length\";\nimport { toScaleInvariant } from \"./to-scale-invariant\";\n\nconst LINE_FMIN: number = 0.00001;\nconst LINE_WORK_POINT: Point = new Point();\n\nexport const toPointsCount = (points?: EShapePoints): number => {\n\tif (points) {\n\t\treturn points.formatted.length;\n\t}\n\treturn 0;\n};\n\nexport const toLinePointCount = (points?: EShapePoints): number => {\n\treturn Math.ceil(toPointsCount(points) / 12) * 12;\n};\n\nexport const toLineVertexCount = (pointCount: number, isClosed: boolean): number => {\n\tif (isClosed) {\n\t\treturn pointCount * 4 + 2;\n\t} else {\n\t\treturn pointCount * 4;\n\t}\n};\n\nexport const toLineIndexCount = (pointCount: number, isClosed: boolean): number => {\n\treturn toLineVertexCount(pointCount, isClosed) - 2;\n};\n\nexport const buildLineClipping = (\n\tclippings: Float32Array,\n\tvoffset: number,\n\tvcount: number,\n\tpointCount: number\n): void => {\n\tlet ic = voffset * 3 - 1;\n\tconst icmax = (voffset + vcount) * 3 - 1;\n\tfor (let i = 0; i < pointCount; ++i) {\n\t\tclippings[++ic] = 1;\n\t\tclippings[++ic] = 0;\n\t\tclippings[++ic] = 3;\n\n\t\tclippings[++ic] = 0;\n\t\tclippings[++ic] = 1;\n\t\tclippings[++ic] = 5;\n\n\t\tclippings[++ic] = 1;\n\t\tclippings[++ic] = 0;\n\t\tclippings[++ic] = 4;\n\n\t\tclippings[++ic] = 0;\n\t\tclippings[++ic] = 1;\n\t\tclippings[++ic] = 6;\n\t}\n\tfor (; ic < icmax; ) {\n\t\tclippings[++ic] = 1;\n\t\tclippings[++ic] = 0;\n\t\tclippings[++ic] = 3;\n\n\t\tclippings[++ic] = 0;\n\t\tclippings[++ic] = 1;\n\t\tclippings[++ic] = 5;\n\t}\n};\n\nexport const buildLineIndex = (\n\tindices: Uint16Array | Uint32Array,\n\tvoffset: number,\n\tioffset: number,\n\ticount: number\n): void => {\n\tlet ii = ioffset * 3 - 1;\n\tconst iimax = (ioffset + icount) * 3 - 1;\n\tlet io = voffset;\n\tfor (; ii < iimax; ) {\n\t\tindices[++ii] = io + 0;\n\t\tindices[++ii] = io + 2;\n\t\tindices[++ii] = io + 1;\n\n\t\tindices[++ii] = io + 1;\n\t\tindices[++ii] = io + 2;\n\t\tindices[++ii] = io + 3;\n\t\tio += 2;\n\t}\n};\n\nexport const buildLineUv = (\n\tuvs: Float32Array,\n\tcolorFills: Float32Array,\n\tvoffset: number,\n\tvcount: number,\n\ttextureUvs: TextureUvs,\n\tlength: number\n): void => {\n\tconst lengthInverse = 1 / Math.max(LINE_FMIN, length);\n\n\tconst x0 = textureUvs.x0;\n\tconst x1 = textureUvs.x1;\n\tconst x2 = textureUvs.x2;\n\tconst x3 = textureUvs.x3;\n\tconst y0 = textureUvs.y0;\n\tconst y1 = textureUvs.y1;\n\tconst y2 = textureUvs.y2;\n\tconst y3 = textureUvs.y3;\n\n\tconst dx01 = x1 - x0;\n\tconst dy01 = y1 - y0;\n\tconst dx32 = x2 - x3;\n\tconst dy32 = y2 - y3;\n\n\tlet iuv = (voffset << 1) - 1;\n\tconst iuvmax = ((voffset + vcount) << 1) - 1;\n\tlet icf = (voffset << 2) - 8;\n\tfor (; iuv < iuvmax; ) {\n\t\tconst r = colorFills[(icf += 8)] * lengthInverse;\n\t\tuvs[++iuv] = x0 + r * dx01;\n\t\tuvs[++iuv] = y0 + r * dy01;\n\t\tuvs[++iuv] = x3 + r * dx32;\n\t\tuvs[++iuv] = y3 + r * dy32;\n\t}\n};\n\nlet TRANSFORMED_POINT_VALUES: number[] | undefined;\n\nexport const buildLineVertexStepAndColorFill = (\n\tvertices: Float32Array,\n\tsteps: Float32Array,\n\tcolorFills: Float32Array,\n\tvoffset: number,\n\tvcount: number,\n\tpointCount: number,\n\tpointsClosed: boolean,\n\tpointValues: number[],\n\tpointSegments: number[],\n\tstrokeWidth: number,\n\tstrokeStyle: EShapeStrokeStyle,\n\tinternalTransform: Matrix\n): number => {\n\tlet transformedPointValues = TRANSFORMED_POINT_VALUES;\n\tif (transformedPointValues == null) {\n\t\ttransformedPointValues = [];\n\t\tTRANSFORMED_POINT_VALUES = transformedPointValues;\n\t}\n\tconst a = internalTransform.a;\n\tconst b = internalTransform.b;\n\tconst c = internalTransform.c;\n\tconst d = internalTransform.d;\n\tconst tx = internalTransform.tx;\n\tconst ty = internalTransform.ty;\n\tfor (let i = 0; i < pointCount; ++i) {\n\t\tconst iv = i << 1;\n\t\tconst x = pointValues[iv];\n\t\tconst y = pointValues[iv + 1];\n\t\ttransformedPointValues[iv] = a * x + c * y + tx;\n\t\ttransformedPointValues[iv + 1] = b * x + d * y + ty;\n\t}\n\treturn buildTransformedLineVertexStepAndColorFill(\n\t\tvertices,\n\t\tsteps,\n\t\tcolorFills,\n\t\tvoffset,\n\t\tvcount,\n\t\tpointCount,\n\t\tpointsClosed,\n\t\ttransformedPointValues,\n\t\tpointSegments,\n\t\tstrokeWidth,\n\t\tstrokeStyle\n\t);\n};\n\nconst fillTransformedLineVertexStepAndColorFill = (\n\tiv: number,\n\tvertices: Float32Array,\n\tis: number,\n\tsteps: Float32Array,\n\ticf: number,\n\tcolorFills: Float32Array,\n\tpx: number,\n\tpy: number,\n\tstrokeWidth: number,\n\tscaleInvariant: number,\n\tpprevx: number,\n\tpprevy: number,\n\tpnextx: number,\n\tpnexty: number,\n\tllo: number\n): void => {\n\tvertices[++iv] = px;\n\tvertices[++iv] = py;\n\tsteps[++is] = strokeWidth;\n\tsteps[++is] = scaleInvariant;\n\tsteps[++is] = pprevx;\n\tsteps[++is] = pprevy;\n\tsteps[++is] = pnextx;\n\tsteps[++is] = pnexty;\n\tcolorFills[(icf += 1)] = llo;\n\n\tvertices[++iv] = px;\n\tvertices[++iv] = py;\n\tsteps[++is] = strokeWidth;\n\tsteps[++is] = scaleInvariant;\n\tsteps[++is] = pprevx;\n\tsteps[++is] = pprevy;\n\tsteps[++is] = pnextx;\n\tsteps[++is] = pnexty;\n\tcolorFills[(icf += 4)] = llo;\n};\n\nconst buildTransformedLineVertexStepAndColorFill = (\n\tvertices: Float32Array,\n\tsteps: Float32Array,\n\tcolorFills: Float32Array,\n\tvoffset: number,\n\tvcount: number,\n\tlineVertexCount: number,\n\tlineIsClosed: boolean,\n\tlineVertices: number[],\n\tlineSegments: number[],\n\tstrokeWidth: number,\n\tstrokeStyle: EShapeStrokeStyle\n): number => {\n\tconst lineSegmentsLength = lineSegments.length;\n\tif (0 < lineSegmentsLength) {\n\t\tif (lineIsClosed) {\n\t\t\tlet lmax = 0;\n\t\t\tlet lprev = 0;\n\t\t\tlet ivoffset = voffset;\n\n\t\t\tlet iseg = 0;\n\t\t\tlet iprevseg = lineSegments[0];\n\t\t\tfor (let i = 1; i < lineSegmentsLength; ++i) {\n\t\t\t\tiseg = lineSegments[i];\n\t\t\t\tif (2 <= iseg - iprevseg) {\n\t\t\t\t\tlprev = buildTransformedLineOpenSegmentVertexStepAndColorFill(\n\t\t\t\t\t\tvertices,\n\t\t\t\t\t\tsteps,\n\t\t\t\t\t\tcolorFills,\n\t\t\t\t\t\tivoffset,\n\t\t\t\t\t\t-1,\n\t\t\t\t\t\tlineVertices,\n\t\t\t\t\t\tiprevseg,\n\t\t\t\t\t\tiseg,\n\t\t\t\t\t\tlineVertexCount,\n\t\t\t\t\t\tstrokeWidth,\n\t\t\t\t\t\tstrokeStyle,\n\t\t\t\t\t\tlprev\n\t\t\t\t\t);\n\t\t\t\t\tlmax = Math.max(lmax, lprev);\n\t\t\t\t\tivoffset += toLineVertexCount(iseg - iprevseg, false);\n\t\t\t\t}\n\t\t\t\tiprevseg = iseg;\n\t\t\t}\n\n\t\t\t// Last\n\t\t\tiseg = lineSegments[0] + lineVertexCount;\n\t\t\tif (2 <= iseg - iprevseg) {\n\t\t\t\tlprev = buildTransformedLineOpenSegmentVertexStepAndColorFill(\n\t\t\t\t\tvertices,\n\t\t\t\t\tsteps,\n\t\t\t\t\tcolorFills,\n\t\t\t\t\tivoffset,\n\t\t\t\t\tvoffset + vcount - ivoffset,\n\t\t\t\t\tlineVertices,\n\t\t\t\t\tiprevseg,\n\t\t\t\t\tiseg,\n\t\t\t\t\tlineVertexCount,\n\t\t\t\t\tstrokeWidth,\n\t\t\t\t\tstrokeStyle,\n\t\t\t\t\tlprev\n\t\t\t\t);\n\t\t\t\tlmax = Math.max(lmax, lprev);\n\t\t\t\tivoffset += toLineVertexCount(iseg - iprevseg, false);\n\t\t\t} else {\n\t\t\t\tbuildTransformedLineEmptyVertexStepAndColorFill(\n\t\t\t\t\tvertices,\n\t\t\t\t\tsteps,\n\t\t\t\t\tcolorFills,\n\t\t\t\t\tivoffset,\n\t\t\t\t\tvoffset + vcount - ivoffset,\n\t\t\t\t\tlineVertices,\n\t\t\t\t\tiprevseg,\n\t\t\t\t\tiseg,\n\t\t\t\t\tlineVertexCount,\n\t\t\t\t\tstrokeWidth,\n\t\t\t\t\tstrokeStyle,\n\t\t\t\t\tlprev\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn lmax;\n\t\t} else {\n\t\t\tlet lmax = 0;\n\t\t\tlet lprev = 0;\n\t\t\tlet ivoffset = voffset;\n\n\t\t\t// First\n\t\t\tlet iseg = lineSegments[0];\n\t\t\tif (2 <= iseg) {\n\t\t\t\tlprev = buildTransformedLineOpenSegmentVertexStepAndColorFill(\n\t\t\t\t\tvertices,\n\t\t\t\t\tsteps,\n\t\t\t\t\tcolorFills,\n\t\t\t\t\tivoffset,\n\t\t\t\t\t-1,\n\t\t\t\t\tlineVertices,\n\t\t\t\t\t0,\n\t\t\t\t\tiseg,\n\t\t\t\t\tlineVertexCount,\n\t\t\t\t\tstrokeWidth,\n\t\t\t\t\tstrokeStyle,\n\t\t\t\t\tlprev\n\t\t\t\t);\n\t\t\t\tlmax = Math.max(lmax, lprev);\n\t\t\t\tivoffset += toLineVertexCount(iseg, false);\n\t\t\t}\n\n\t\t\t// Middle\n\t\t\tlet iprevseg = iseg;\n\t\t\tfor (let i = 1; i < lineSegmentsLength; ++i) {\n\t\t\t\tiseg = lineSegments[i];\n\t\t\t\tif (2 <= iseg - iprevseg) {\n\t\t\t\t\tlprev = buildTransformedLineOpenSegmentVertexStepAndColorFill(\n\t\t\t\t\t\tvertices,\n\t\t\t\t\t\tsteps,\n\t\t\t\t\t\tcolorFills,\n\t\t\t\t\t\tivoffset,\n\t\t\t\t\t\t-1,\n\t\t\t\t\t\tlineVertices,\n\t\t\t\t\t\tiprevseg,\n\t\t\t\t\t\tiseg,\n\t\t\t\t\t\tlineVertexCount,\n\t\t\t\t\t\tstrokeWidth,\n\t\t\t\t\t\tstrokeStyle,\n\t\t\t\t\t\tlprev\n\t\t\t\t\t);\n\t\t\t\t\tlmax = Math.max(lmax, lprev);\n\t\t\t\t\tivoffset += toLineVertexCount(iseg - iprevseg, false);\n\t\t\t\t}\n\t\t\t\tiprevseg = iseg;\n\t\t\t}\n\n\t\t\t// Last\n\t\t\tiseg = lineVertexCount;\n\t\t\tif (2 <= iseg - iprevseg) {\n\t\t\t\tlprev = buildTransformedLineOpenSegmentVertexStepAndColorFill(\n\t\t\t\t\tvertices,\n\t\t\t\t\tsteps,\n\t\t\t\t\tcolorFills,\n\t\t\t\t\tivoffset,\n\t\t\t\t\tvoffset + vcount - ivoffset,\n\t\t\t\t\tlineVertices,\n\t\t\t\t\tiprevseg,\n\t\t\t\t\tiseg,\n\t\t\t\t\tlineVertexCount,\n\t\t\t\t\tstrokeWidth,\n\t\t\t\t\tstrokeStyle,\n\t\t\t\t\tlprev\n\t\t\t\t);\n\t\t\t\tlmax = Math.max(lmax, lprev);\n\t\t\t\tivoffset += toLineVertexCount(iseg - iprevseg, false);\n\t\t\t} else {\n\t\t\t\tbuildTransformedLineEmptyVertexStepAndColorFill(\n\t\t\t\t\tvertices,\n\t\t\t\t\tsteps,\n\t\t\t\t\tcolorFills,\n\t\t\t\t\tivoffset,\n\t\t\t\t\tvoffset + vcount - ivoffset,\n\t\t\t\t\tlineVertices,\n\t\t\t\t\tiprevseg,\n\t\t\t\t\tiseg,\n\t\t\t\t\tlineVertexCount,\n\t\t\t\t\tstrokeWidth,\n\t\t\t\t\tstrokeStyle,\n\t\t\t\t\tlprev\n\t\t\t\t);\n\t\t\t}\n\t\t\treturn lmax;\n\t\t}\n\t} else {\n\t\tif (lineIsClosed) {\n\t\t\treturn buildTransformedLineClosedSegmentVertexStepAndColorFill(\n\t\t\t\tvertices,\n\t\t\t\tsteps,\n\t\t\t\tcolorFills,\n\t\t\t\tvoffset,\n\t\t\t\tvcount,\n\t\t\t\tlineVertices,\n\t\t\t\t0,\n\t\t\t\tlineVertexCount,\n\t\t\t\tlineVertexCount,\n\t\t\t\tstrokeWidth,\n\t\t\t\tstrokeStyle\n\t\t\t);\n\t\t} else {\n\t\t\treturn buildTransformedLineOpenSegmentVertexStepAndColorFill(\n\t\t\t\tvertices,\n\t\t\t\tsteps,\n\t\t\t\tcolorFills,\n\t\t\t\tvoffset,\n\t\t\t\tvcount,\n\t\t\t\tlineVertices,\n\t\t\t\t0,\n\t\t\t\tlineVertexCount,\n\t\t\t\tlineVertexCount,\n\t\t\t\tstrokeWidth,\n\t\t\t\tstrokeStyle,\n\t\t\t\t0\n\t\t\t);\n\t\t}\n\t}\n};\n\nconst buildTransformedLineEmptyVertexStepAndColorFill = (\n\tvertices: Float32Array,\n\tsteps: Float32Array,\n\tcolorFills: Float32Array,\n\tvoffset: number,\n\tvcount: number,\n\tlineVertices: number[],\n\tlineVertexFrom: number,\n\tlineVertexTo: number,\n\tlineVertexCount: number,\n\tstrokeWidth: number,\n\tstrokeStyle: EShapeStrokeStyle,\n\tlength: number\n): number => {\n\tif (0 <= vcount) {\n\t\tconst scaleInvariant = toScaleInvariant(strokeStyle);\n\t\tlet iv = (voffset << 1) - 1;\n\t\tlet is = voffset * 6 - 1;\n\t\tlet icf = (voffset << 2) - 1;\n\t\tconst ivmax = ((voffset + vcount) << 1) - 1;\n\t\tconst ifirst = lineVertexFrom % lineVertexCount << 1;\n\t\tconst px = lineVertices[ifirst];\n\t\tconst py = lineVertices[ifirst + 1];\n\t\tfor (; iv < ivmax; ) {\n\t\t\tvertices[++iv] = px;\n\t\t\tvertices[++iv] = py;\n\t\t\tsteps[++is] = 0;\n\t\t\tsteps[++is] = scaleInvariant;\n\t\t\tsteps[++is] = -1;\n\t\t\tsteps[++is] = 0;\n\t\t\tsteps[++is] = +1;\n\t\t\tsteps[++is] = 0;\n\t\t\tcolorFills[++icf] = length;\n\t\t\tcolorFills[++icf] = 0;\n\t\t\tcolorFills[++icf] = 0;\n\t\t\tcolorFills[++icf] = length;\n\t\t}\n\t}\n\n\treturn 0;\n};\n\nconst buildTransformedLineOpenSegmentVertexStepAndColorFill = (\n\tvertices: Float32Array,\n\tsteps: Float32Array,\n\tcolorFills: Float32Array,\n\tvoffset: number,\n\tvcount: number,\n\tlineVertices: number[],\n\tlineVertexFrom: number,\n\tlineVertexTo: number,\n\tlineVertexCount: number,\n\tstrokeWidth: number,\n\tstrokeStyle: EShapeStrokeStyle,\n\tlength: number\n): number => {\n\tconst scaleInvariant = toScaleInvariant(strokeStyle);\n\n\t// First segment\n\tconst ifirst = lineVertexFrom % lineVertexCount << 1;\n\tlet px = lineVertices[ifirst];\n\tlet py = lineVertices[ifirst + 1];\n\tconst isecond = (lineVertexFrom + 1) % lineVertexCount << 1;\n\tlet pnextx = lineVertices[isecond];\n\tlet pnexty = lineVertices[isecond + 1];\n\tlet pprevx = px - (pnextx - px);\n\tlet pprevy = py - (pnexty - py);\n\tlet iv = (voffset << 1) - 1;\n\tlet is = voffset * 6 - 1;\n\tlet icf = (voffset << 2) - 1;\n\tlet l = 0;\n\tfillTransformedLineVertexStepAndColorFill(\n\t\tiv,\n\t\tvertices,\n\t\tis,\n\t\tsteps,\n\t\ticf,\n\t\tcolorFills,\n\t\tpx,\n\t\tpy,\n\t\tstrokeWidth,\n\t\tscaleInvariant,\n\t\tpprevx,\n\t\tpprevy,\n\t\tpnextx,\n\t\tpnexty,\n\t\tlength\n\t);\n\tiv += 4;\n\tis += 12;\n\ticf += 8;\n\n\tfillTransformedLineVertexStepAndColorFill(\n\t\tiv,\n\t\tvertices,\n\t\tis,\n\t\tsteps,\n\t\ticf,\n\t\tcolorFills,\n\t\tpx,\n\t\tpy,\n\t\tstrokeWidth,\n\t\tscaleInvariant,\n\t\tpprevx,\n\t\tpprevy,\n\t\tpnextx,\n\t\tpnexty,\n\t\tl\n\t);\n\tiv += 4;\n\tis += 12;\n\ticf += 8;\n\n\t// Middle segments\n\tfor (let i = lineVertexFrom + 1, imax = lineVertexTo - 1; i < imax; ++i) {\n\t\tpprevx = px;\n\t\tpprevy = py;\n\t\tpx = pnextx;\n\t\tpy = pnexty;\n\n\t\tconst imiddle = (i + 1) % lineVertexCount << 1;\n\t\tpnextx = lineVertices[imiddle];\n\t\tpnexty = lineVertices[imiddle + 1];\n\n\t\tl += toLength(pprevx, pprevy, px, py);\n\n\t\tfillTransformedLineVertexStepAndColorFill(\n\t\t\tiv,\n\t\t\tvertices,\n\t\t\tis,\n\t\t\tsteps,\n\t\t\ticf,\n\t\t\tcolorFills,\n\t\t\tpx,\n\t\t\tpy,\n\t\t\tstrokeWidth,\n\t\t\tscaleInvariant,\n\t\t\tpprevx,\n\t\t\tpprevy,\n\t\t\tpnextx,\n\t\t\tpnexty,\n\t\t\tl\n\t\t);\n\t\tiv += 4;\n\t\tis += 12;\n\t\ticf += 8;\n\n\t\tfillTransformedLineVertexStepAndColorFill(\n\t\t\tiv,\n\t\t\tvertices,\n\t\t\tis,\n\t\t\tsteps,\n\t\t\ticf,\n\t\t\tcolorFills,\n\t\t\tpx,\n\t\t\tpy,\n\t\t\tstrokeWidth,\n\t\t\tscaleInvariant,\n\t\t\tpprevx,\n\t\t\tpprevy,\n\t\t\tpnextx,\n\t\t\tpnexty,\n\t\t\tl\n\t\t);\n\t\tiv += 4;\n\t\tis += 12;\n\t\ticf += 8;\n\t}\n\n\t// Last segment\n\tpprevx = px;\n\tpprevy = py;\n\tpx = pnextx;\n\tpy = pnexty;\n\n\tpnextx = px + (px - pprevx);\n\tpnexty = py + (py - pprevy);\n\n\tl += toLength(pprevx, pprevy, px, py);\n\n\tfillTransformedLineVertexStepAndColorFill(\n\t\tiv,\n\t\tvertices,\n\t\tis,\n\t\tsteps,\n\t\ticf,\n\t\tcolorFills,\n\t\tpx,\n\t\tpy,\n\t\tstrokeWidth,\n\t\tscaleInvariant,\n\t\tpprevx,\n\t\tpprevy,\n\t\tpnextx,\n\t\tpnexty,\n\t\tl\n\t);\n\tiv += 4;\n\tis += 12;\n\ticf += 8;\n\n\tfillTransformedLineVertexStepAndColorFill(\n\t\tiv,\n\t\tvertices,\n\t\tis,\n\t\tsteps,\n\t\ticf,\n\t\tcolorFills,\n\t\tpx,\n\t\tpy,\n\t\tstrokeWidth,\n\t\tscaleInvariant,\n\t\tpprevx,\n\t\tpprevy,\n\t\tpnextx,\n\t\tpnexty,\n\t\tl\n\t);\n\tiv += 4;\n\tis += 12;\n\ticf += 8;\n\n\t// Total length\n\tconst dash = toDash(l, strokeWidth, strokeStyle, LINE_WORK_POINT);\n\tconst dash0 = dash.x;\n\tconst dash1 = dash.y;\n\tconst icf0 = (voffset << 2) - 1;\n\tfor (let i = icf0, imax = icf0 + 8; i < imax; i += 4) {\n\t\tcolorFills[i + 2] = dash0;\n\t\tcolorFills[i + 3] = dash1;\n\t\tcolorFills[i + 4] = length;\n\t}\n\tfor (let i = icf0 + 8; i < icf; i += 4) {\n\t\tcolorFills[i + 2] = dash0;\n\t\tcolorFills[i + 3] = dash1;\n\t\tcolorFills[i + 4] = l;\n\t}\n\n\t// Fill the rest\n\tif (0 <= vcount) {\n\t\tconst ivmax = ((voffset + vcount) << 1) - 1;\n\t\tfor (; iv < ivmax; ) {\n\t\t\tvertices[++iv] = px;\n\t\t\tvertices[++iv] = py;\n\t\t\tsteps[++is] = 0;\n\t\t\tsteps[++is] = scaleInvariant;\n\t\t\tsteps[++is] = pprevx;\n\t\t\tsteps[++is] = pprevy;\n\t\t\tsteps[++is] = pnextx;\n\t\t\tsteps[++is] = pnexty;\n\t\t\tcolorFills[++icf] = l;\n\t\t\tcolorFills[++icf] = dash0;\n\t\t\tcolorFills[++icf] = dash1;\n\t\t\tcolorFills[++icf] = l;\n\t\t}\n\t}\n\n\treturn l;\n};\n\nconst buildTransformedLineClosedSegmentVertexStepAndColorFill = (\n\tvertices: Float32Array,\n\tsteps: Float32Array,\n\tcolorFills: Float32Array,\n\tvoffset: number,\n\tvcount: number,\n\tlineVertices: number[],\n\tlineVertexFrom: number,\n\tlineVertexTo: number,\n\tlineVertexCount: number,\n\tstrokeWidth: number,\n\tstrokeStyle: EShapeStrokeStyle\n): number => {\n\tconst scaleInvariant = toScaleInvariant(strokeStyle);\n\n\tconst ilast = (lineVertexTo - 1) % lineVertexCount << 1;\n\tlet pprevx = 0;\n\tlet pprevy = 0;\n\tlet px = lineVertices[ilast];\n\tlet py = lineVertices[ilast + 1];\n\tconst ifirst = lineVertexFrom % lineVertexCount << 1;\n\tlet pnextx = lineVertices[ifirst];\n\tlet pnexty = lineVertices[ifirst + 1];\n\tlet l = 0;\n\tlet iv = (voffset << 1) - 1;\n\tlet is = voffset * 6 - 1;\n\tlet icf = (voffset << 2) - 1;\n\tfor (let i = lineVertexFrom; i < lineVertexTo; ++i) {\n\t\tpprevx = px;\n\t\tpprevy = py;\n\t\tpx = pnextx;\n\t\tpy = pnexty;\n\n\t\tconst imiddle = (i + 1) % lineVertexCount << 1;\n\t\tpnextx = lineVertices[imiddle];\n\t\tpnexty = lineVertices[imiddle + 1];\n\n\t\tl += toLength(pprevx, pprevy, px, py);\n\n\t\tfillTransformedLineVertexStepAndColorFill(\n\t\t\tiv,\n\t\t\tvertices,\n\t\t\tis,\n\t\t\tsteps,\n\t\t\ticf,\n\t\t\tcolorFills,\n\t\t\tpx,\n\t\t\tpy,\n\t\t\tstrokeWidth,\n\t\t\tscaleInvariant,\n\t\t\tpprevx,\n\t\t\tpprevy,\n\t\t\tpnextx,\n\t\t\tpnexty,\n\t\t\tl\n\t\t);\n\t\tiv += 4;\n\t\tis += 12;\n\t\ticf += 8;\n\n\t\tfillTransformedLineVertexStepAndColorFill(\n\t\t\tiv,\n\t\t\tvertices,\n\t\t\tis,\n\t\t\tsteps,\n\t\t\ticf,\n\t\t\tcolorFills,\n\t\t\tpx,\n\t\t\tpy,\n\t\t\tstrokeWidth,\n\t\t\tscaleInvariant,\n\t\t\tpprevx,\n\t\t\tpprevy,\n\t\t\tpnextx,\n\t\t\tpnexty,\n\t\t\tl\n\t\t);\n\t\tiv += 4;\n\t\tis += 12;\n\t\ticf += 8;\n\t}\n\n\t// Last segment\n\tpprevx = px;\n\tpprevy = py;\n\tpx = pnextx;\n\tpy = pnexty;\n\n\tconst isecond = (lineVertexFrom + 1) % lineVertexCount << 1;\n\tpnextx = lineVertices[isecond];\n\tpnexty = lineVertices[isecond + 1];\n\n\tl += toLength(pprevx, pprevy, px, py);\n\n\tfillTransformedLineVertexStepAndColorFill(\n\t\tiv,\n\t\tvertices,\n\t\tis,\n\t\tsteps,\n\t\ticf,\n\t\tcolorFills,\n\t\tpx,\n\t\tpy,\n\t\tstrokeWidth,\n\t\tscaleInvariant,\n\t\tpprevx,\n\t\tpprevy,\n\t\tpnextx,\n\t\tpnexty,\n\t\tl\n\t);\n\tiv += 4;\n\tis += 12;\n\ticf += 8;\n\n\t// Total length\n\tconst dash = toDash(l, strokeWidth, strokeStyle, LINE_WORK_POINT);\n\tconst dash0 = dash.x;\n\tconst dash1 = dash.y;\n\tfor (let i = (voffset << 2) - 1; i < icf; i += 4) {\n\t\tcolorFills[i + 2] = dash0;\n\t\tcolorFills[i + 3] = dash1;\n\t\tcolorFills[i + 4] = -1;\n\t}\n\n\t// Fill the rest\n\tif (0 <= vcount) {\n\t\tconst ivmax = ((voffset + vcount) << 1) - 1;\n\t\tfor (; iv < ivmax; ) {\n\t\t\tvertices[++iv] = px;\n\t\t\tvertices[++iv] = py;\n\t\t\tsteps[++is] = strokeWidth;\n\t\t\tsteps[++is] = scaleInvariant;\n\t\t\tsteps[++is] = pprevx;\n\t\t\tsteps[++is] = pprevy;\n\t\t\tsteps[++is] = pnextx;\n\t\t\tsteps[++is] = pnexty;\n\t\t\tcolorFills[++icf] = l;\n\t\t\tcolorFills[++icf] = dash0;\n\t\t\tcolorFills[++icf] = dash1;\n\t\t\tcolorFills[++icf] = -1;\n\t\t}\n\t}\n\treturn l;\n};\n","export const buildColor = (\n\tcolor: number,\n\talpha: number,\n\tvoffset: number,\n\tvcount: number,\n\tcolors: Float32Array\n): void => {\n\tconst r = (((color >> 16) & 0xff) / 255.0) * alpha;\n\tconst g = (((color >> 8) & 0xff) / 255.0) * alpha;\n\tconst b = (((color >> 0) & 0xff) / 255.0) * alpha;\n\tconst a = alpha;\n\n\tlet ic = (voffset << 2) - 1;\n\tconst icmax = ((voffset + vcount) << 2) - 1;\n\tfor (; ic < icmax; ) {\n\t\tcolors[++ic] = r;\n\t\tcolors[++ic] = g;\n\t\tcolors[++ic] = b;\n\t\tcolors[++ic] = a;\n\t}\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Texture } from \"pixi.js\";\nimport { EShape } from \"../e-shape\";\nimport { EShapeBuffer } from \"../e-shape-buffer\";\nimport { EShapeBufferUnitBuilder } from \"../e-shape-buffer-unit-builder\";\nimport { EShapeStrokeSide } from \"../e-shape-stroke-side\";\nimport { EShapeStrokeStyle } from \"../e-shape-stroke-style\";\nimport { buildColor } from \"./build-color\";\nimport { Builder } from \"./builder\";\n\nexport abstract class BuilderBase implements Builder {\n\treadonly vertexOffset: number;\n\treadonly vertexCount: number;\n\treadonly indexOffset: number;\n\treadonly indexCount: number;\n\n\tprotected sizeX: number;\n\tprotected sizeY: number;\n\n\tprotected transformLocalId: number;\n\n\tprotected strokeAlign: number;\n\tprotected strokeWidth: number;\n\tprotected strokeSide: EShapeStrokeSide;\n\tprotected strokeStyle: EShapeStrokeStyle;\n\n\tprotected colorFill: number;\n\tprotected alphaFill: number;\n\tprotected colorStroke: number;\n\tprotected alphaStroke: number;\n\n\tprotected texture: Texture | null;\n\tprotected textureTransformId: number;\n\n\tconstructor(\n\t\tvertexOffset: number,\n\t\tindexOffset: number,\n\t\tvertexCount: number,\n\t\tindexCount: number\n\t) {\n\t\tthis.vertexOffset = vertexOffset;\n\t\tthis.indexOffset = indexOffset;\n\t\tthis.vertexCount = vertexCount;\n\t\tthis.indexCount = indexCount;\n\n\t\tthis.sizeX = NaN;\n\t\tthis.sizeY = NaN;\n\n\t\tthis.transformLocalId = -1;\n\n\t\tthis.strokeAlign = NaN;\n\t\tthis.strokeWidth = NaN;\n\t\tthis.strokeSide = NaN;\n\t\tthis.strokeStyle = NaN;\n\n\t\tthis.colorFill = NaN;\n\t\tthis.alphaFill = -1;\n\t\tthis.colorStroke = NaN;\n\t\tthis.alphaStroke = -1;\n\n\t\tthis.texture = null;\n\t\tthis.textureTransformId = NaN;\n\t}\n\n\tabstract init(buffer: EShapeBuffer): void;\n\n\tisCompatible(shape: EShape): boolean {\n\t\treturn true;\n\t}\n\n\tabstract update(buffer: EShapeBuffer, shape: EShape): void;\n\n\tprotected updateColorFill(buffer: EShapeBuffer, shape: EShape): void {\n\t\tconst fill = shape.fill;\n\t\tconst isEnabled = shape.visible && fill.enable;\n\t\tconst color = fill.color;\n\t\tconst alpha = isEnabled ? fill.alpha : 0;\n\t\tif (color !== this.colorFill || alpha !== this.alphaFill) {\n\t\t\tthis.colorFill = color;\n\t\t\tthis.alphaFill = alpha;\n\t\t\tbuffer.updateColorFills();\n\n\t\t\tbuildColor(color, alpha, this.vertexOffset, this.vertexCount, buffer.colorFills);\n\t\t}\n\t}\n\n\tprotected updateColorStroke(buffer: EShapeBuffer, shape: EShape): void {\n\t\tconst stroke = shape.stroke;\n\t\tconst isEnabled = shape.visible && stroke.enable && 0 < stroke.width;\n\t\tconst color = stroke.color;\n\t\tconst alpha = isEnabled ? stroke.alpha : 0;\n\t\tif (color !== this.colorStroke || alpha !== this.alphaStroke) {\n\t\t\tthis.colorStroke = color;\n\t\t\tthis.alphaStroke = alpha;\n\t\t\tbuffer.updateColorStrokes();\n\n\t\t\tbuildColor(color, alpha, this.vertexOffset, this.vertexCount, buffer.colorStrokes);\n\t\t}\n\t}\n\n\tbuildUnit(builder: EShapeBufferUnitBuilder): void {\n\t\tconst texture = this.texture || Texture.WHITE;\n\t\tconst baseTexture = texture.baseTexture;\n\t\tif (baseTexture !== builder.baseTexture) {\n\t\t\tbuilder.baseTexture = baseTexture;\n\t\t\tconst indexOffset = this.indexOffset;\n\t\t\tbuilder.push(texture, indexOffset);\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Texture, TextureUvs } from \"pixi.js\";\nimport { EShape } from \"../e-shape\";\n\nexport const toTransformLocalId = (shape: EShape): number => {\n\tshape.updateTransform();\n\treturn shape.transform.getLocalId();\n};\n\nexport const toTexture = (shape: EShape): Texture => {\n\treturn shape.texture || Texture.WHITE;\n};\n\nexport const toTextureTransformId = (texture: Texture): number => {\n\tconst textureAny = texture as any;\n\tif (textureAny._uvs == null) {\n\t\ttexture.updateUvs();\n\t}\n\treturn textureAny._updateID;\n};\n\nexport const toTextureUvs = (texture: Texture): TextureUvs => {\n\treturn (texture as any)._uvs;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DTheme } from \"./d-theme\";\n\nexport class DThemes {\n\tprivate static DEFAULT_THEME_CLASS: (new () => DTheme) | null = null;\n\tprivate static INSTANCE: DTheme | null = null;\n\n\tpublic static setDefaultThemeClass(theme: new () => DTheme): void {\n\t\tthis.DEFAULT_THEME_CLASS = theme;\n\t}\n\n\tpublic static getDefaultThemeClass(): (new () => DTheme) | null {\n\t\treturn this.DEFAULT_THEME_CLASS;\n\t}\n\n\tpublic static getInstance(): DTheme {\n\t\tif (this.INSTANCE == null) {\n\t\t\tconst defaultThemeClass = this.getDefaultThemeClass();\n\t\t\tif (defaultThemeClass == null) {\n\t\t\t\tthrow new Error(\"No default theme class found\");\n\t\t\t}\n\t\t\tthis.INSTANCE = new defaultThemeClass();\n\t\t}\n\t\treturn this.INSTANCE;\n\t}\n\n\tpublic static setInstance(instance: DTheme): DTheme | null {\n\t\tconst result = this.INSTANCE;\n\t\tthis.INSTANCE = instance;\n\t\treturn result;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DThemes } from \"../theme/d-themes\";\nimport { EShapeStrokeSide } from \"./e-shape-stroke-side\";\nimport { EShapeStrokeStyle } from \"./e-shape-stroke-style\";\n\nexport interface EThemeShape {\n\tgetFillColor(): number;\n\tgetFillAlpha(): number;\n\tgetStrokeColor(): number;\n\tgetStrokeAlpha(): number;\n\tgetStrokeWidth(): number;\n\tgetStrokeAlign(): number;\n\tgetStrokeSide(): EShapeStrokeSide;\n\tgetStrokeStyle(): EShapeStrokeStyle;\n\tgetTextValue(): string;\n\tgetTextColor(): number;\n\tgetTextAlpha(): number;\n\tgetTextFamily(): string;\n\tgetTextSize(): number;\n\tgetCursor(): string;\n\tgetRadius(): number;\n\tgetSizeX(): number;\n\tgetSizeY(): number;\n\tgetHighlightColor(): number;\n\tgetCurveSegmentCount(): number;\n}\n\nexport class EShapeDefaults {\n\tprotected static _THEME?: EThemeShape;\n\n\tstatic get THEME(): EThemeShape {\n\t\tconst theme = this._THEME;\n\t\tif (theme != null) {\n\t\t\treturn theme;\n\t\t}\n\t\tconst newTheme: EThemeShape = DThemes.getInstance().get(\"EShape\");\n\t\tthis._THEME = newTheme;\n\t\treturn newTheme;\n\t}\n\n\tstatic get FILL_COLOR(): number {\n\t\treturn this.THEME.getFillColor();\n\t}\n\n\tstatic get FILL_ALPHA(): number {\n\t\treturn this.THEME.getFillAlpha();\n\t}\n\n\tstatic get STROKE_COLOR(): number {\n\t\treturn this.THEME.getStrokeColor();\n\t}\n\n\tstatic get STROKE_ALPHA(): number {\n\t\treturn this.THEME.getStrokeAlpha();\n\t}\n\n\tstatic get STROKE_WIDTH(): number {\n\t\treturn this.THEME.getStrokeWidth();\n\t}\n\n\tstatic get STROKE_ALIGN(): number {\n\t\treturn this.THEME.getStrokeAlign();\n\t}\n\n\tstatic get STROKE_SIDE(): EShapeStrokeSide {\n\t\treturn this.THEME.getStrokeSide();\n\t}\n\n\tstatic get STROKE_STYLE(): EShapeStrokeStyle {\n\t\treturn this.THEME.getStrokeStyle();\n\t}\n\n\tstatic get TEXT_VALUE(): string {\n\t\treturn this.THEME.getTextValue();\n\t}\n\n\tstatic get TEXT_COLOR(): number {\n\t\treturn this.THEME.getTextColor();\n\t}\n\n\tstatic get TEXT_ALPHA(): number {\n\t\treturn this.THEME.getTextAlpha();\n\t}\n\n\tstatic get TEXT_FAMILY(): string {\n\t\treturn this.THEME.getTextFamily();\n\t}\n\n\tstatic get TEXT_SIZE(): number {\n\t\treturn this.THEME.getTextSize();\n\t}\n\n\tstatic get CURSOR(): string {\n\t\treturn this.THEME.getCursor();\n\t}\n\n\tstatic get RADIUS(): number {\n\t\treturn this.THEME.getRadius();\n\t}\n\n\tstatic get SIZE_X(): number {\n\t\treturn this.THEME.getSizeX();\n\t}\n\n\tstatic get SIZE_Y(): number {\n\t\treturn this.THEME.getSizeY();\n\t}\n\n\tstatic get HIGHLIGHT_COLOR(): number {\n\t\treturn this.THEME.getHighlightColor();\n\t}\n\n\tstatic get CURVE_SEGMENT_COUNT(): number {\n\t\treturn this.THEME.getCurveSegmentCount();\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const EShapePointsMarkerType = {\n\tNONE: 0,\n\tCIRCLE: 1,\n\tTRIANGLE: 2,\n\tRECTANGLE: 3\n} as const;\n\nexport type EShapePointsMarkerType =\n\ttypeof EShapePointsMarkerType[keyof typeof EShapePointsMarkerType];\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeFill, EShapeFillLike } from \"../e-shape-fill\";\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShapeFillImplParent } from \"./e-shape-fill-impl-parent\";\n\nexport class EShapeFillImpl implements EShapeFill {\n\tprotected _parent: EShapeFillImplParent;\n\tprotected _enable: boolean;\n\tprotected _color: number;\n\tprotected _alpha: number;\n\n\tconstructor(parent: EShapeFillImplParent, enable: boolean, color: number, alpha: number) {\n\t\tthis._parent = parent;\n\t\tthis._enable = enable;\n\t\tthis._color = color;\n\t\tthis._alpha = alpha;\n\t}\n\n\tget enable(): boolean {\n\t\treturn this._enable;\n\t}\n\n\tset enable(enable: boolean) {\n\t\tif (this._enable !== enable) {\n\t\t\tthis._enable = enable;\n\t\t\tthis._parent.updateUploaded();\n\t\t}\n\t}\n\n\tget color(): number {\n\t\treturn this._color;\n\t}\n\n\tset color(color: number) {\n\t\tif (this._color !== color) {\n\t\t\tthis._color = color;\n\t\t\tthis._parent.updateUploaded();\n\t\t}\n\t}\n\n\tget alpha(): number {\n\t\treturn this._alpha;\n\t}\n\n\tset alpha(alpha: number) {\n\t\tif (this._alpha !== alpha) {\n\t\t\tthis._alpha = alpha;\n\t\t\tthis._parent.updateUploaded();\n\t\t}\n\t}\n\n\tcopy(target?: Partial<EShapeFillLike>): void {\n\t\tif (target) {\n\t\t\tthis.set(target.enable, target.color, target.alpha);\n\t\t}\n\t}\n\n\tset(enable?: boolean, color?: number, alpha?: number): void {\n\t\tlet isChanged = false;\n\n\t\tif (enable !== undefined && this._enable !== enable) {\n\t\t\tthis._enable = enable;\n\t\t\tisChanged = true;\n\t\t}\n\n\t\tif (color !== undefined && this._color !== color) {\n\t\t\tthis._color = color;\n\t\t\tisChanged = true;\n\t\t}\n\n\t\tif (alpha !== undefined && this._alpha !== alpha) {\n\t\t\tthis._alpha = alpha;\n\t\t\tisChanged = true;\n\t\t}\n\n\t\tif (isChanged) {\n\t\t\tthis._parent.updateUploaded();\n\t\t}\n\t}\n\n\tclone(): EShapeFill {\n\t\treturn new EShapeFillImpl(this._parent, this._enable, this._color, this._alpha);\n\t}\n\n\ttoObject(): EShapeFillLike {\n\t\treturn {\n\t\t\tenable: this._enable,\n\t\t\tcolor: this._color,\n\t\t\talpha: this._alpha\n\t\t};\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\tconst stringified = `[${this._enable ? 1 : 0},${this._color},${this._alpha}]`;\n\t\treturn manager.addResource(stringified);\n\t}\n\n\tdeserialize(target: number, manager: EShapeResourceManagerDeserialization): void {\n\t\tconst resources = manager.resources;\n\t\tif (0 <= target && target < resources.length) {\n\t\t\tconst parsed = manager.getFill(target);\n\t\t\tif (parsed != null) {\n\t\t\t\tthis.set(!!parsed[0], parsed[1], parsed[2]);\n\t\t\t} else {\n\t\t\t\tconst deserialized = JSON.parse(resources[target]);\n\t\t\t\tmanager.setFill(target, deserialized);\n\t\t\t\tthis.set(!!deserialized[0], deserialized[1], deserialized[2]);\n\t\t\t}\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { IPoint, Matrix, Point } from \"pixi.js\";\nimport { EShapeDefaults } from \"./e-shape-defaults\";\nimport { EShapeFill } from \"./e-shape-fill\";\nimport { EShapePointsMarker } from \"./e-shape-points-marker\";\nimport { EShapePointsMarkerType } from \"./e-shape-points-marker-type\";\nimport { EShapeResourceManagerDeserialization } from \"./e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"./e-shape-resource-manager-serialization\";\nimport { EShapeFillImpl } from \"./variant/e-shape-fill-impl\";\n\nexport class EShapePointsMarkerNoop implements EShapePointsMarker {\n\tprotected _size?: IPoint;\n\tprotected _transform?: Matrix;\n\tprotected _fill?: EShapeFill;\n\n\tlock(): this {\n\t\treturn this;\n\t}\n\n\tunlock(): this {\n\t\treturn this;\n\t}\n\n\tget type(): EShapePointsMarkerType {\n\t\treturn EShapePointsMarkerType.NONE;\n\t}\n\n\tset type(type: EShapePointsMarkerType) {\n\t\t// DO NOTHING\n\t}\n\n\tget size(): IPoint {\n\t\tlet result = this._size;\n\t\tif (result == null) {\n\t\t\tresult = new Point();\n\t\t\tthis._size = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tget transform(): Matrix {\n\t\tlet result = this._transform;\n\t\tif (result == null) {\n\t\t\tresult = new Matrix();\n\t\t\tthis._transform = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tget fill(): EShapeFill {\n\t\tlet result = this._fill;\n\t\tif (result == null) {\n\t\t\tresult = new EShapeFillImpl(this, true, EShapeDefaults.FILL_COLOR, 1);\n\t\t\tthis._fill = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tupdateUploaded(): void {\n\t\t// DO NOTHING\n\t}\n\n\tcopy(source: EShapePointsMarker): this {\n\t\treturn this;\n\t}\n\n\tset(type?: EShapePointsMarkerType, sizeX?: number, sizeY?: number): this {\n\t\treturn this;\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\treturn -1;\n\t}\n\n\tdeserialize(resourceId: number, manager: EShapeResourceManagerDeserialization): void {\n\t\t// DO NOTHING\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapePointsMarker } from \"./e-shape-points-marker\";\nimport { EShapePointsMarkerContainer } from \"./e-shape-points-marker-container\";\nimport { EShapePointsMarkerNoop } from \"./e-shape-points-marker-noop\";\nimport { EShapeResourceManagerDeserialization } from \"./e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"./e-shape-resource-manager-serialization\";\n\nexport class EShapePointsMarkerContainerImplNoop implements EShapePointsMarkerContainer {\n\tprotected _marker: EShapePointsMarker;\n\n\tprotected constructor() {\n\t\tthis._marker = new EShapePointsMarkerNoop();\n\t}\n\n\tlock(): this {\n\t\treturn this;\n\t}\n\n\tunlock(): this {\n\t\treturn this;\n\t}\n\n\tget head(): EShapePointsMarker {\n\t\treturn this._marker;\n\t}\n\n\tget tail(): EShapePointsMarker {\n\t\treturn this._marker;\n\t}\n\n\tcopy(source: EShapePointsMarkerContainer): this {\n\t\treturn this;\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\treturn -1;\n\t}\n\n\tdeserialize(resourceId: number, manager: EShapeResourceManagerDeserialization): void {\n\t\t// DO NOTHING\n\t}\n\n\tprotected static INSTANCE?: EShapePointsMarkerContainerImplNoop;\n\tstatic getInstance(): EShapePointsMarkerContainerImplNoop {\n\t\tlet result = this.INSTANCE;\n\t\tif (result == null) {\n\t\t\tresult = new EShapePointsMarkerContainerImplNoop();\n\t\t\tthis.INSTANCE = result;\n\t\t}\n\t\treturn result;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const EShapeBarPosition = {\n\tTOP: 0,\n\tLEFT: 1,\n\tRIGHT: 2,\n\tBOTTOM: 3\n} as const;\n\nexport type EShapeBarPosition = typeof EShapeBarPosition[keyof typeof EShapeBarPosition];\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Matrix, Point } from \"pixi.js\";\nimport { EShape } from \"../e-shape\";\nimport { EShapePoints } from \"../e-shape-points\";\nimport { EShapePointsFormatter } from \"../e-shape-points-formatter\";\nimport { EShapePointsMarkerContainer } from \"../e-shape-points-marker-container\";\nimport { EShapePointsMarkerContainerImplNoop } from \"../e-shape-points-marker-container-impl-noop\";\nimport { EShapePointsStyle } from \"../e-shape-points-style\";\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShapeBarPosition } from \"./e-shape-bar-position\";\nimport { EShapeLineBasePoints } from \"./e-shape-line-base-points\";\nimport { EShapeLineBasePointsHitTester } from \"./e-shape-line-base-points-hit-tester\";\nimport { EShapeLineBasePointsHitTesterToRange } from \"./e-shape-line-base-points-hit-tester-to-range\";\n\nexport class EShapeBarPoints implements EShapeLineBasePoints {\n\tprotected _parent: EShape;\n\tprotected _id: number;\n\tprotected _style: EShapePointsStyle;\n\tprotected _values: [number, number, number, number];\n\tprotected _segments: number[];\n\tprotected _size: number;\n\tprotected _position: EShapeBarPosition;\n\tprotected _marker?: EShapePointsMarkerContainer;\n\n\tprotected _updatedSize: number;\n\tprotected _updatedParentSizeX: number;\n\tprotected _updatedParentSizeY: number;\n\tprotected _updatedPosition: number;\n\n\tconstructor(parent: EShape) {\n\t\tthis._parent = parent;\n\t\tthis._id = 0;\n\t\tthis._values = [0, 0, 0, 0];\n\t\tthis._segments = [];\n\t\tthis._style = EShapePointsStyle.NONE;\n\t\tthis._size = -1;\n\t\tthis._position = EShapeBarPosition.TOP;\n\n\t\tthis._updatedSize = NaN;\n\t\tthis._updatedParentSizeX = NaN;\n\t\tthis._updatedParentSizeY = NaN;\n\t\tthis._updatedPosition = NaN;\n\t}\n\n\tprotected getComputedSize(\n\t\tsize: number,\n\t\tposition: EShapeBarPosition,\n\t\tsizeX: number,\n\t\tsizeY: number\n\t): number {\n\t\tif (0 <= size) {\n\t\t\treturn size;\n\t\t} else {\n\t\t\tswitch (position) {\n\t\t\t\tcase EShapeBarPosition.TOP:\n\t\t\t\tcase EShapeBarPosition.BOTTOM:\n\t\t\t\t\treturn Math.abs(sizeY);\n\t\t\t\tcase EShapeBarPosition.RIGHT:\n\t\t\t\tcase EShapeBarPosition.LEFT:\n\t\t\t\t\treturn Math.abs(sizeX);\n\t\t\t}\n\t\t\treturn 0;\n\t\t}\n\t}\n\n\tprotected update(): void {\n\t\tconst parentSize = this._parent.size;\n\t\tconst parentSizeX = parentSize.x;\n\t\tconst parentSizeY = parentSize.y;\n\t\tconst position = this._position;\n\t\tconst size = this._size;\n\t\tif (\n\t\t\tthis._updatedSize !== size ||\n\t\t\tthis._updatedParentSizeX !== parentSizeX ||\n\t\t\tthis._updatedParentSizeY !== parentSizeY ||\n\t\t\tthis._updatedPosition !== position\n\t\t) {\n\t\t\tthis._id += 1;\n\t\t\tthis._updatedSize = size;\n\t\t\tthis._updatedParentSizeX = parentSizeX;\n\t\t\tthis._updatedParentSizeY = parentSizeY;\n\t\t\tthis._updatedPosition = position;\n\t\t\tconst psxh = parentSizeX * 0.5;\n\t\t\tconst psyh = parentSizeY * 0.5;\n\t\t\tconst computedSize = this.getComputedSize(size, position, parentSizeX, parentSizeY);\n\t\t\tconst values = this._values;\n\t\t\tswitch (position) {\n\t\t\t\tcase EShapeBarPosition.TOP:\n\t\t\t\t\tvalues[0] = 0;\n\t\t\t\t\tvalues[1] = -psyh;\n\t\t\t\t\tvalues[2] = 0;\n\t\t\t\t\tvalues[3] = -psyh + computedSize;\n\t\t\t\t\tbreak;\n\t\t\t\tcase EShapeBarPosition.RIGHT:\n\t\t\t\t\tvalues[0] = psxh;\n\t\t\t\t\tvalues[1] = 0;\n\t\t\t\t\tvalues[2] = psxh - computedSize;\n\t\t\t\t\tvalues[3] = 0;\n\t\t\t\t\tbreak;\n\t\t\t\tcase EShapeBarPosition.BOTTOM:\n\t\t\t\t\tvalues[0] = 0;\n\t\t\t\t\tvalues[1] = psyh;\n\t\t\t\t\tvalues[2] = 0;\n\t\t\t\t\tvalues[3] = psyh - computedSize;\n\t\t\t\t\tbreak;\n\t\t\t\tcase EShapeBarPosition.LEFT:\n\t\t\t\t\tvalues[0] = -psxh;\n\t\t\t\t\tvalues[1] = 0;\n\t\t\t\t\tvalues[2] = -psxh + computedSize;\n\t\t\t\t\tvalues[3] = 0;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tget length(): number {\n\t\treturn 2;\n\t}\n\n\tget id(): number {\n\t\tthis.update();\n\t\treturn this._id;\n\t}\n\n\tget values(): number[] {\n\t\tthis.update();\n\t\treturn this._values;\n\t}\n\n\tset values(values: number[]) {\n\t\t// SUPPOSED NOT TO BE CALLED\n\t}\n\n\tget segments(): number[] {\n\t\treturn this._segments;\n\t}\n\n\tset segments(segments: number[]) {\n\t\t// SUPPOSED NOT TO BE CALLED\n\t}\n\n\tget size(): number {\n\t\treturn this._size;\n\t}\n\n\tset size(size: number) {\n\t\tthis.moveTo(undefined, size, undefined);\n\t}\n\n\tget position(): EShapeBarPosition {\n\t\treturn this._position;\n\t}\n\n\tset position(position: EShapeBarPosition) {\n\t\tthis.moveTo(position, undefined, undefined);\n\t}\n\n\tget style(): EShapePointsStyle {\n\t\treturn this._style;\n\t}\n\n\tset style(style: EShapePointsStyle) {\n\t\tthis.moveTo(undefined, undefined, style);\n\t}\n\n\tget marker(): EShapePointsMarkerContainer {\n\t\tlet result = this._marker;\n\t\tif (result == null) {\n\t\t\tresult = EShapePointsMarkerContainerImplNoop.getInstance();\n\t\t\tthis._marker = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tgetMarker(): EShapePointsMarkerContainer | undefined {\n\t\treturn undefined;\n\t}\n\n\tget formatter(): EShapePointsFormatter | null {\n\t\treturn null;\n\t}\n\n\tset formatter(formatter: EShapePointsFormatter | null) {\n\t\t// DO NOTHING\n\t}\n\n\tget formatted(): this {\n\t\treturn this;\n\t}\n\n\tcopy(source: EShapePoints): this {\n\t\tif (source instanceof EShapeBarPoints) {\n\t\t\treturn this.moveTo(source.position, source.size, source.style);\n\t\t} else {\n\t\t\treturn this.moveTo(undefined, undefined, source.style);\n\t\t}\n\t}\n\n\tset(newValues?: number[], newSegments?: number[], newStyle?: EShapePointsStyle): this {\n\t\tlet newPosition: EShapeBarPosition | undefined;\n\t\tlet newSize: number | undefined;\n\t\tif (newValues != null) {\n\t\t\tconst x0 = newValues[0];\n\t\t\tif (x0 === 0) {\n\t\t\t\tconst y0 = newValues[1];\n\t\t\t\tnewPosition = y0 <= 0 ? EShapeBarPosition.TOP : EShapeBarPosition.BOTTOM;\n\t\t\t\tnewSize = Math.abs(newValues[3] - y0);\n\t\t\t} else {\n\t\t\t\tnewPosition = x0 <= 0 ? EShapeBarPosition.LEFT : EShapeBarPosition.RIGHT;\n\t\t\t\tnewSize = Math.abs(newValues[2] - x0);\n\t\t\t}\n\t\t}\n\t\treturn this.moveTo(newPosition, newSize, newStyle);\n\t}\n\n\tprotected moveTo(position?: EShapeBarPosition, size?: number, style?: EShapePointsStyle): this {\n\t\tlet isChanged = false;\n\n\t\tif (style != null && this._style !== style) {\n\t\t\tthis._style = style;\n\t\t\tisChanged = true;\n\t\t}\n\n\t\tif (position != null && this._position !== position) {\n\t\t\tthis._position = position;\n\t\t\tisChanged = true;\n\t\t}\n\n\t\tif (size != null && this._size !== size) {\n\t\t\tthis._size = size;\n\t\t\tisChanged = true;\n\t\t}\n\n\t\tif (isChanged) {\n\t\t\tthis._parent.updateUploaded();\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tclone(parent: EShape): EShapeBarPoints {\n\t\treturn new EShapeBarPoints(parent).copy(this);\n\t}\n\n\ttoPoints(transform: Matrix): Point[] {\n\t\tconst result: Point[] = [];\n\t\tconst values = this.values;\n\t\tfor (let i = 0, imax = values.length; i < imax; i += 2) {\n\t\t\tconst point = new Point(values[i + 0], values[i + 1]);\n\t\t\tresult.push(transform.apply(point, point));\n\t\t}\n\t\treturn result;\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\treturn manager.addResource(`[${this._position},${this._size},${this._style}]`);\n\t}\n\n\tdeserialize(resourceId: number, manager: EShapeResourceManagerDeserialization): void {\n\t\tif (0 <= resourceId && resourceId < manager.resources.length) {\n\t\t\tconst resource = manager.resources[resourceId];\n\t\t\tconst parsed = JSON.parse(resource) as [EShapeBarPosition, number, number];\n\t\t\tthis.moveTo(parsed[0], parsed[1], parsed[2]);\n\t\t}\n\t}\n\n\tcalcHitPointAbs<RESULT>(\n\t\tx: number,\n\t\ty: number,\n\t\tax: number,\n\t\tay: number,\n\t\tthreshold: number,\n\t\ttoRange: EShapeLineBasePointsHitTesterToRange | null,\n\t\ttester: EShapeLineBasePointsHitTester<RESULT>,\n\t\tresult: RESULT\n\t): boolean {\n\t\tconst length = this.length;\n\t\tif (2 <= length) {\n\t\t\tconst values = this._values;\n\t\t\tconst v0x = values[0];\n\t\t\tconst v0y = values[1];\n\t\t\tconst v1x = values[2];\n\t\t\tconst v1y = values[3];\n\t\t\tif (tester(x, y, v0x, v0y, v1x, v1y, 0, threshold, result)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const EShapeLineBaseHitPart = {\n\tNONE: 0,\n\tLINE: 1,\n\tMARKER_TAIL: 2,\n\tMARKER_HEAD: 3,\n\tTEXT: 4,\n\tCHILDREN: 5\n} as const;\n\nexport type EShapeLineBaseHitPart =\n\ttypeof EShapeLineBaseHitPart[keyof typeof EShapeLineBaseHitPart];\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nconst TOP_LEFT = 1;\nconst TOP_RIGHT = 2;\nconst BOTTOM_LEFT = 4;\nconst BOTTOM_RIGHT = 8;\n\nexport const EShapeCorner = {\n\tNONE: 0,\n\tTOP_LEFT,\n\tTOP_RIGHT,\n\tBOTTOM_LEFT,\n\tBOTTOM_RIGHT,\n\tTOP: TOP_LEFT | TOP_RIGHT,\n\tBOTTOM: BOTTOM_LEFT | BOTTOM_RIGHT,\n\tLEFT: TOP_LEFT | BOTTOM_LEFT,\n\tRIGHT: TOP_RIGHT | BOTTOM_RIGHT,\n\tALL: TOP_LEFT | TOP_RIGHT | BOTTOM_LEFT | BOTTOM_RIGHT\n} as const;\n\nexport type EShapeCorner = number;\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DApplicationLayerLike } from \"./d-application-layer-like\";\nimport { DApplicationLayerStageLike } from \"./d-application-layer-stage-like\";\nimport { DApplicationLike, DApplicationTarget } from \"./d-application-like\";\n\nexport class DApplications {\n\tprotected static INSTANCES: DApplicationLike[] = [];\n\n\tstatic add(instance: DApplicationLike): void {\n\t\tconst instances = DApplications.INSTANCES;\n\t\tinstances.push(instance);\n\t}\n\n\tstatic first(): DApplicationLike {\n\t\tconst instances = DApplications.INSTANCES;\n\t\tif (0 < instances.length) {\n\t\t\treturn instances[0];\n\t\t}\n\t\tthrow new Error(\"No application found.\");\n\t}\n\n\tstatic last(): DApplicationLike {\n\t\tconst instances = DApplications.INSTANCES;\n\t\tif (0 < instances.length) {\n\t\t\treturn instances[instances.length - 1];\n\t\t}\n\t\tthrow new Error(\"No application found.\");\n\t}\n\n\tstatic get(index: number): DApplicationLike | null {\n\t\tconst instances = DApplications.INSTANCES;\n\t\tif (0 <= index && index < instances.length) {\n\t\t\treturn instances[index];\n\t\t}\n\t\treturn null;\n\t}\n\n\tstatic indexOf(instance: DApplicationLike): number {\n\t\treturn DApplications.INSTANCES.indexOf(instance);\n\t}\n\n\tstatic size(): number {\n\t\treturn DApplications.INSTANCES.length;\n\t}\n\n\tprotected static getStage(target: DApplicationTarget): DApplicationLayerStageLike | null {\n\t\tlet stage: any = target;\n\t\twhile (stage.parent) {\n\t\t\tstage = stage.parent;\n\t\t}\n\t\tif (\"application\" in stage && \"layer\" in stage) {\n\t\t\treturn stage as DApplicationLayerStageLike;\n\t\t}\n\t\treturn null;\n\t}\n\n\tstatic find(target: DApplicationTarget): DApplicationLike | null {\n\t\tconst stage = this.getStage(target);\n\t\tif (stage) {\n\t\t\treturn stage.layer.application;\n\t\t}\n\t\treturn null;\n\t}\n\n\tstatic getLayerBase(target: DApplicationTarget): DApplicationLayerLike | null {\n\t\tconst stage = this.getStage(target);\n\t\tif (stage) {\n\t\t\treturn stage.layer.application.getLayerBase();\n\t\t}\n\t\treturn null;\n\t}\n\n\tstatic getLayerOverlay(target: DApplicationTarget): DApplicationLayerLike | null {\n\t\tconst stage = this.getStage(target);\n\t\tif (stage) {\n\t\t\treturn stage.layer.application.getLayerOverlay();\n\t\t}\n\t\treturn null;\n\t}\n\n\tstatic getLayer(target: DApplicationTarget): DApplicationLayerLike | null {\n\t\tconst stage = this.getStage(target);\n\t\tif (stage) {\n\t\t\treturn stage.layer;\n\t\t}\n\t\treturn null;\n\t}\n\n\tstatic getResolution(target: DApplicationTarget): number {\n\t\tconst layer = this.getLayer(target);\n\t\tif (layer) {\n\t\t\treturn layer.renderer.resolution;\n\t\t}\n\t\treturn window.devicePixelRatio ?? 1;\n\t}\n\n\tstatic update(target?: DApplicationTarget): void {\n\t\tif (target) {\n\t\t\tconst stage = this.getStage(target);\n\t\t\tif (stage) {\n\t\t\t\tstage.layer.update();\n\t\t\t}\n\t\t} else {\n\t\t\tconst instances = DApplications.INSTANCES;\n\t\t\tfor (let i = 0, imax = instances.length; i < imax; ++i) {\n\t\t\t\tinstances[i].update();\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic render(target?: DApplicationTarget): void {\n\t\tif (target) {\n\t\t\tconst stage = this.getStage(target);\n\t\t\tif (stage) {\n\t\t\t\tstage.layer.render();\n\t\t\t}\n\t\t} else {\n\t\t\tconst instances = DApplications.INSTANCES;\n\t\t\tfor (let i = 0, imax = instances.length; i < imax; ++i) {\n\t\t\t\tinstances[i].render();\n\t\t\t}\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShapeActionValue } from \"./e-shape-action-value\";\n\nexport class EShapeAction {\n\tvalues: EShapeActionValue[];\n\n\tconstructor() {\n\t\tthis.values = [];\n\t}\n\n\tadd(value: EShapeActionValue, index?: number): this {\n\t\tconst values = this.values;\n\t\tif (index != null) {\n\t\t\tvalues.splice(index, 0, value);\n\t\t} else {\n\t\t\tvalues.push(value);\n\t\t}\n\t\treturn this;\n\t}\n\n\taddAll(values: EShapeActionValue[]): this {\n\t\tconst destination = this.values;\n\t\tfor (let i = 0, imax = values.length; i < imax; ++i) {\n\t\t\tdestination.push(values[i]);\n\t\t}\n\t\treturn this;\n\t}\n\n\tclearAndAdd(value: EShapeActionValue): this {\n\t\tthis.clear();\n\t\tthis.add(value);\n\t\treturn this;\n\t}\n\n\tclearAndAddAll(values: EShapeActionValue[]): this {\n\t\tthis.clear();\n\t\tthis.addAll(values);\n\t\treturn this;\n\t}\n\n\tindexOf(target: EShapeActionValue): number {\n\t\tconst values = this.values;\n\n\t\t// Instance-based matching\n\t\tfor (let i = 0, imax = values.length; i < imax; ++i) {\n\t\t\tconst value = values[i];\n\t\t\tif (value === target) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\n\t\t// Data-based matching\n\t\tfor (let i = 0, imax = values.length; i < imax; ++i) {\n\t\t\tconst value = values[i];\n\t\t\tif (value.isEquals(target)) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\n\t\treturn -1;\n\t}\n\n\tget(index: number): EShapeActionValue | null {\n\t\tconst values = this.values;\n\t\tif (0 <= index || index < values.length) {\n\t\t\treturn values[index];\n\t\t}\n\t\treturn null;\n\t}\n\n\tset(index: number, value: EShapeActionValue): EShapeActionValue | null {\n\t\tconst values = this.values;\n\t\tif (0 <= index || index < values.length) {\n\t\t\tconst result = values[index];\n\t\t\tvalues[index] = value;\n\t\t\treturn result;\n\t\t}\n\t\treturn null;\n\t}\n\n\tremove(index: number): EShapeActionValue | null {\n\t\tconst values = this.values;\n\t\tif (0 <= index || index < values.length) {\n\t\t\treturn values.splice(index, 1)[0];\n\t\t}\n\t\treturn null;\n\t}\n\n\tclear(): this {\n\t\tthis.values.length = 0;\n\t\treturn this;\n\t}\n\n\tsize(): number {\n\t\treturn this.values.length;\n\t}\n\n\tswap(indexA: number, indexB: number): this {\n\t\tconst values = this.values;\n\t\tconst tmp = values[indexB];\n\t\tvalues[indexB] = values[indexA];\n\t\tvalues[indexA] = tmp;\n\t\treturn this;\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number[] {\n\t\tconst result: number[] = [];\n\t\tconst values = this.values;\n\t\tfor (let i = 0, imax = values.length; i < imax; ++i) {\n\t\t\tresult.push(values[i].serialize(manager));\n\t\t}\n\t\treturn result;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"./e-shape\";\nimport { EShapeConnectorContainer } from \"./e-shape-connector-container\";\nimport { EShapeConnectorEdge } from \"./e-shape-connector-edge\";\n\nexport class EShapeConnectorContainerImpl implements EShapeConnectorContainer {\n\tprotected _parent: EShape;\n\tprotected _edges: Set<EShapeConnectorEdge>;\n\tprotected _onFitBound?: (connector: EShapeConnectorEdge) => void;\n\tprotected _onFitBoundForcibly?: (connector: EShapeConnectorEdge) => void;\n\n\tconstructor(parent: EShape) {\n\t\tthis._parent = parent;\n\t\tthis._edges = new Set<EShapeConnectorEdge>();\n\t}\n\n\tadd(target: EShapeConnectorEdge): boolean {\n\t\tconst edges = this._edges;\n\t\tif (!edges.has(target)) {\n\t\t\tedges.add(target);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tcontains(target: EShapeConnectorEdge): boolean {\n\t\treturn this._edges.has(target);\n\t}\n\n\tsize(): number {\n\t\treturn this._edges.size;\n\t}\n\n\tremove(target: EShapeConnectorEdge): boolean {\n\t\treturn this._edges.delete(target);\n\t}\n\n\tclear(): boolean {\n\t\tconst edges = this._edges;\n\t\tif (0 < edges.size) {\n\t\t\tthis._edges.clear();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tcopy(source: EShapeConnectorContainer): this {\n\t\tconst edges = this._edges;\n\t\tedges.clear();\n\t\tsource.each((edge): void => {\n\t\t\tedges.add(edge);\n\t\t});\n\t\treturn this;\n\t}\n\n\teach(iteratee: (edge: EShapeConnectorEdge) => void): this {\n\t\tthis._edges.forEach(iteratee);\n\t\treturn this;\n\t}\n\n\tfit(forcibly?: boolean): void {\n\t\tthis._edges.forEach(this.toOnFitBound(forcibly));\n\t}\n\n\tprotected toOnFitBound(forcibly?: boolean): (connector: EShapeConnectorEdge) => void {\n\t\tif (forcibly) {\n\t\t\tlet result = this._onFitBoundForcibly;\n\t\t\tif (result == null) {\n\t\t\t\tresult = this.newOnFitBound(true);\n\t\t\t\tthis._onFitBoundForcibly = result;\n\t\t\t}\n\t\t\treturn result;\n\t\t} else {\n\t\t\tlet result = this._onFitBound;\n\t\t\tif (result == null) {\n\t\t\t\tresult = this.newOnFitBound(false);\n\t\t\t\tthis._onFitBound = result;\n\t\t\t}\n\t\t\treturn result;\n\t\t}\n\t}\n\n\tprotected newOnFitBound(forcibly?: boolean): (edge: EShapeConnectorEdge) => void {\n\t\treturn (edge: EShapeConnectorEdge): void => {\n\t\t\tthis.onFit(edge, forcibly);\n\t\t};\n\t}\n\n\tprotected onFit(target: EShapeConnectorEdge, forcibly?: boolean): void {\n\t\ttarget.fit(forcibly);\n\t}\n\n\tattach(): this {\n\t\tconst parent = this._parent;\n\t\tthis._edges.forEach((edge: EShapeConnectorEdge): void => {\n\t\t\tedge.set(parent);\n\t\t});\n\t\treturn this;\n\t}\n\n\tdetach(): this {\n\t\tthis._edges.forEach((edge: EShapeConnectorEdge): void => {\n\t\t\tedge.set(null);\n\t\t});\n\t\treturn this;\n\t}\n}\n","/*\n * Copyright (C) 2021 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nconst TRANSFORM = 1;\nconst SIZE = 2;\nconst STYLE = 4;\nconst ACTION = 8;\nconst POINTS = 16;\nconst STATE = 32;\nconst IMAGE = 64;\nconst DATA = 128;\nconst CONNECTOR = 256;\n\nexport const EShapeCopyPart = {\n\tNONE: 0,\n\tTRANSFORM,\n\tSIZE,\n\tSTYLE,\n\tACTION,\n\tPOINTS,\n\tSTATE,\n\tIMAGE,\n\tDATA,\n\t/** @deprecated in favor of {@link data} */\n\tTAG: DATA,\n\tCONNECTOR,\n\tALL: TRANSFORM | SIZE | STYLE | ACTION | POINTS | STATE | IMAGE | DATA | CONNECTOR\n} as const;\n\nexport type EShapeCopyPart = number;\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const DBaseState = {\n\tHOVERED: \"HOVERED\",\n\tACTIVE: \"ACTIVE\",\n\tFOCUSED: \"FOCUSED\",\n\tUNFOCUSABLE: \"UNFOCUSABLE\",\n\tFOCUS_ROOT: \"FOCUS_ROOT\",\n\tFOCUS_REVERSE: \"FOCUS_REVERSE\",\n\tREAD_ONLY: \"READ_ONLY\",\n\tDISABLED: \"DISABLED\",\n\tGESTURING: \"GESTURING\",\n\tPRESSED: \"PRESSED\",\n\tINVALID: \"INVALID\",\n\tSUCCEEDED: \"SUCCEEDED\",\n\tFAILED: \"FAILED\",\n\tWARNED: \"WARNED\",\n\tCHANGED: \"CHANGED\",\n\tALTERNATED: \"ALTERNATED\",\n\tNEW_WINDOW: \"NEW_WINDOW\"\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport const isFunction = (target: unknown): target is Function => {\n\treturn typeof target === \"function\";\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const isString = (target: unknown): target is string => {\n\treturn (\n\t\ttypeof target === \"string\" || Object.prototype.toString.call(target) === \"[object String]\"\n\t);\n};\n","/*\n * Copyright (C) 2020 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBaseState } from \"./d-base-state\";\nimport { DBaseStateSet } from \"./d-base-state-set\";\nimport { DBaseStateSetLike } from \"./d-base-state-set-like\";\nimport { isFunction } from \"./util/is-function\";\nimport { isString } from \"./util/is-string\";\n\nexport class DBaseStateSetImpl implements DBaseStateSet {\n\tprotected _local: Set<string>;\n\tprotected _parent: DBaseStateSet | null;\n\n\tconstructor() {\n\t\tthis._local = new Set<string>();\n\t\tthis._parent = null;\n\t}\n\n\tis(state: string): boolean {\n\t\treturn this._local.has(state);\n\t}\n\n\tin(state: string): boolean {\n\t\treturn this.is(state) || this.under(state);\n\t}\n\n\ton(state: string): boolean {\n\t\treturn this._parent?.is(state) ?? false;\n\t}\n\n\tunder(state: string): boolean {\n\t\treturn this._parent?.in(state) ?? false;\n\t}\n\n\tlock(callOnChange?: boolean): this {\n\t\treturn this;\n\t}\n\n\tunlock(): this {\n\t\treturn this;\n\t}\n\n\tprotected begin(): this {\n\t\treturn this;\n\t}\n\n\tprotected end(): this {\n\t\treturn this;\n\t}\n\n\tprotected checkAdded(added: string): boolean {\n\t\treturn !this._local.has(added);\n\t}\n\n\tadd(state: string): this {\n\t\tif (this.checkAdded(state)) {\n\t\t\tthis.begin();\n\t\t\tthis._local.add(state);\n\t\t\tthis.end();\n\t\t}\n\t\treturn this;\n\t}\n\n\tprotected checkAddeds(states: string[]): boolean {\n\t\tconst local = this._local;\n\t\tfor (let i = 0, imax = states.length; i < imax; ++i) {\n\t\t\tif (!local.has(states[i])) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\taddAll(states: string[]): this;\n\taddAll(...states: string[]): this;\n\taddAll(stateOrStates: string | string[]): this {\n\t\tconst states = isString(stateOrStates)\n\t\t\t? (arguments as any as string[]) // eslint-disable-line prefer-rest-params\n\t\t\t: stateOrStates;\n\t\tif (this.checkAddeds(states)) {\n\t\t\tthis.begin();\n\t\t\tconst local = this._local;\n\t\t\tfor (let i = 0, imax = states.length; i < imax; ++i) {\n\t\t\t\tlocal.add(states[i]);\n\t\t\t}\n\t\t\tthis.end();\n\t\t}\n\t\treturn this;\n\t}\n\n\tprotected checkRemoved(removed: string): boolean {\n\t\treturn this._local.has(removed);\n\t}\n\n\tremove(state: string): this {\n\t\tif (this.checkRemoved(state)) {\n\t\t\tthis.begin();\n\t\t\tthis._local.delete(state);\n\t\t\tthis.end();\n\t\t}\n\t\treturn this;\n\t}\n\n\tprotected checkRemoveds(states: string[]): boolean {\n\t\tconst local = this._local;\n\t\tfor (let i = 0, imax = states.length; i < imax; ++i) {\n\t\t\tif (local.has(states[i])) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tremoveAll(states: string[]): this;\n\tremoveAll(...states: string[]): this;\n\tremoveAll(matcher: (state: string) => void | boolean): this;\n\tremoveAll(\n\t\tstateOrStatesOrMatcher: string | string[] | ((state: string) => void | boolean)\n\t): this {\n\t\tconst local = this._local;\n\t\tif (isFunction(stateOrStatesOrMatcher)) {\n\t\t\tlet isDirty = false;\n\t\t\tlocal.forEach((state): void => {\n\t\t\t\tif (stateOrStatesOrMatcher(state)) {\n\t\t\t\t\tif (!isDirty) {\n\t\t\t\t\t\tisDirty = true;\n\t\t\t\t\t\tthis.begin();\n\t\t\t\t\t}\n\t\t\t\t\tlocal.delete(state);\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (isDirty) {\n\t\t\t\tthis.end();\n\t\t\t}\n\t\t} else {\n\t\t\tconst states = isString(stateOrStatesOrMatcher)\n\t\t\t\t? (arguments as any as string[]) // eslint-disable-line prefer-rest-params\n\t\t\t\t: stateOrStatesOrMatcher;\n\t\t\tif (this.checkRemoveds(states)) {\n\t\t\t\tthis.begin();\n\t\t\t\tfor (let i = 0, imax = states.length; i < imax; ++i) {\n\t\t\t\t\tlocal.delete(states[i]);\n\t\t\t\t}\n\t\t\t\tthis.end();\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n\n\tclear(): this {\n\t\tconst local = this._local;\n\t\tif (0 < local.size) {\n\t\t\tthis.begin();\n\t\t\tlocal.clear();\n\t\t\tthis.end();\n\t\t}\n\t\treturn this;\n\t}\n\n\tset(state: string, isOn: boolean): this;\n\tset(added: string | null, removed: string | null): this;\n\tset(stateOrAdded: string | null, isOnOrRemoved: string | null | boolean): this {\n\t\tif (isOnOrRemoved === true) {\n\t\t\tif (stateOrAdded != null) {\n\t\t\t\tthis.add(stateOrAdded);\n\t\t\t}\n\t\t} else if (isOnOrRemoved === false) {\n\t\t\tif (stateOrAdded != null) {\n\t\t\t\tthis.remove(stateOrAdded);\n\t\t\t}\n\t\t} else {\n\t\t\tconst added = stateOrAdded;\n\t\t\tconst removed = isOnOrRemoved;\n\t\t\tif (added != null) {\n\t\t\t\tif (removed != null) {\n\t\t\t\t\tif (this.checkAdded(added) || this.checkRemoved(removed)) {\n\t\t\t\t\t\tthis.begin();\n\t\t\t\t\t\tthis._local.add(added).delete(removed);\n\t\t\t\t\t\tthis.end();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis.add(added);\n\t\t\t\t}\n\t\t\t} else if (removed != null) {\n\t\t\t\tthis.remove(removed);\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n\n\tsetAll(states: string[], isOn: boolean): this;\n\tsetAll(addeds: string[] | null, removeds: string[] | null): this;\n\tsetAll(statesOrAddeds: string[] | null, isOnOrRemoveds: string[] | null | boolean): this {\n\t\tif (isOnOrRemoveds === true) {\n\t\t\tif (statesOrAddeds != null) {\n\t\t\t\tthis.addAll(statesOrAddeds);\n\t\t\t}\n\t\t} else if (isOnOrRemoveds === false) {\n\t\t\tif (statesOrAddeds != null) {\n\t\t\t\tthis.removeAll(statesOrAddeds);\n\t\t\t}\n\t\t} else {\n\t\t\tconst addeds = statesOrAddeds;\n\t\t\tconst removeds = isOnOrRemoveds;\n\t\t\tif (addeds != null) {\n\t\t\t\tif (removeds != null) {\n\t\t\t\t\tif (this.checkAddeds(addeds) || this.checkRemoveds(removeds)) {\n\t\t\t\t\t\tthis.begin();\n\t\t\t\t\t\tconst local = this._local;\n\t\t\t\t\t\tfor (let i = 0, imax = addeds.length; i < imax; ++i) {\n\t\t\t\t\t\t\tlocal.add(addeds[i]);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfor (let i = 0, imax = removeds.length; i < imax; ++i) {\n\t\t\t\t\t\t\tlocal.delete(removeds[i]);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.end();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis.addAll(addeds);\n\t\t\t\t}\n\t\t\t} else if (removeds != null) {\n\t\t\t\tthis.removeAll(removeds);\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n\n\teach(iteratee: (state: string) => void): this {\n\t\tthis._local.forEach((state: string): void => {\n\t\t\titeratee(state);\n\t\t});\n\t\treturn this;\n\t}\n\n\tsize(): number {\n\t\treturn this._local.size;\n\t}\n\n\tcopy(other: DBaseStateSet): this {\n\t\tif (other instanceof DBaseStateSetImpl) {\n\t\t\tthis.begin();\n\t\t\tconst local = this._local;\n\t\t\tlocal.clear();\n\t\t\tother.local.forEach((value: string): void => {\n\t\t\t\tlocal.add(value);\n\t\t\t});\n\t\t\tthis._parent = other.parent;\n\t\t\tthis.end();\n\t\t}\n\t\treturn this;\n\t}\n\n\tget local(): Set<string> {\n\t\treturn this._local;\n\t}\n\n\tget parent(): DBaseStateSet | null {\n\t\treturn this._parent;\n\t}\n\n\tset parent(parent: DBaseStateSet | null) {\n\t\tif (this._parent !== parent) {\n\t\t\tthis.begin();\n\t\t\tthis._parent = parent;\n\t\t\tthis.end();\n\t\t}\n\t}\n\n\tonParentChange(newState: DBaseStateSet, oldState: DBaseStateSet): void {\n\t\tthis._parent = oldState;\n\t\tthis.begin();\n\t\tthis._parent = newState;\n\t\tthis.end();\n\t}\n\n\tget isHovered(): boolean {\n\t\treturn this.is(DBaseState.HOVERED);\n\t}\n\n\tset isHovered(isHovered: boolean) {\n\t\tthis.set(DBaseState.HOVERED, isHovered);\n\t}\n\n\tget inHovered(): boolean {\n\t\treturn this.in(DBaseState.HOVERED);\n\t}\n\n\tget onHovered(): boolean {\n\t\treturn this.on(DBaseState.HOVERED);\n\t}\n\n\tget underHovered(): boolean {\n\t\treturn this.under(DBaseState.HOVERED);\n\t}\n\n\tget isActive(): boolean {\n\t\treturn this.is(DBaseState.ACTIVE);\n\t}\n\n\tset isActive(isActive: boolean) {\n\t\tthis.set(DBaseState.ACTIVE, isActive);\n\t}\n\n\tget inActive(): boolean {\n\t\treturn this.in(DBaseState.ACTIVE);\n\t}\n\n\tget onActive(): boolean {\n\t\treturn this.on(DBaseState.ACTIVE);\n\t}\n\n\tget underActive(): boolean {\n\t\treturn this.under(DBaseState.ACTIVE);\n\t}\n\n\tget isPressed(): boolean {\n\t\treturn this.is(DBaseState.PRESSED);\n\t}\n\n\tset isPressed(isPressed: boolean) {\n\t\tthis.set(DBaseState.PRESSED, isPressed);\n\t}\n\n\tget inPressed(): boolean {\n\t\treturn this.in(DBaseState.PRESSED);\n\t}\n\n\tget onPressed(): boolean {\n\t\treturn this.on(DBaseState.PRESSED);\n\t}\n\n\tget underPressed(): boolean {\n\t\treturn this.under(DBaseState.PRESSED);\n\t}\n\n\tget isReadOnly(): boolean {\n\t\treturn this.is(DBaseState.READ_ONLY);\n\t}\n\n\tset isReadOnly(isReadOnly: boolean) {\n\t\tthis.set(DBaseState.READ_ONLY, isReadOnly);\n\t}\n\n\tget inReadOnly(): boolean {\n\t\treturn this.in(DBaseState.READ_ONLY);\n\t}\n\n\tget onReadOnly(): boolean {\n\t\treturn this.on(DBaseState.READ_ONLY);\n\t}\n\n\tget underReadOnly(): boolean {\n\t\treturn this.under(DBaseState.READ_ONLY);\n\t}\n\n\tget isEnabled(): boolean {\n\t\treturn !this.is(DBaseState.DISABLED);\n\t}\n\n\tset isEnabled(isEnabled: boolean) {\n\t\tthis.set(DBaseState.DISABLED, !isEnabled);\n\t}\n\n\tget inEnabled(): boolean {\n\t\treturn !this.in(DBaseState.DISABLED);\n\t}\n\n\tget onEnabled(): boolean {\n\t\treturn !this.on(DBaseState.DISABLED);\n\t}\n\n\tget underEnabled(): boolean {\n\t\treturn !this.under(DBaseState.DISABLED);\n\t}\n\n\tget isDisabled(): boolean {\n\t\treturn this.is(DBaseState.DISABLED);\n\t}\n\n\tset isDisabled(isDisabled: boolean) {\n\t\tthis.set(DBaseState.DISABLED, isDisabled);\n\t}\n\n\tget inDisabled(): boolean {\n\t\treturn this.in(DBaseState.DISABLED);\n\t}\n\n\tget onDisabled(): boolean {\n\t\treturn this.on(DBaseState.DISABLED);\n\t}\n\n\tget underDisabled(): boolean {\n\t\treturn this.under(DBaseState.DISABLED);\n\t}\n\n\tget isActionable(): boolean {\n\t\treturn !this.in(DBaseState.DISABLED) && !this.in(DBaseState.READ_ONLY);\n\t}\n\n\tget isGesturing(): boolean {\n\t\treturn this.is(DBaseState.GESTURING);\n\t}\n\n\tset isGesturing(isGesturing: boolean) {\n\t\tthis.set(DBaseState.GESTURING, isGesturing);\n\t}\n\n\tget inGesturing(): boolean {\n\t\treturn this.in(DBaseState.GESTURING);\n\t}\n\n\tget onGesturing(): boolean {\n\t\treturn this.on(DBaseState.GESTURING);\n\t}\n\n\tget underGesturing(): boolean {\n\t\treturn this.under(DBaseState.GESTURING);\n\t}\n\n\tget isFocused(): boolean {\n\t\treturn this.is(DBaseState.FOCUSED);\n\t}\n\n\tset isFocused(isFocused: boolean) {\n\t\tthis.set(DBaseState.FOCUSED, isFocused);\n\t}\n\n\tget inFocused(): boolean {\n\t\treturn this.in(DBaseState.FOCUSED);\n\t}\n\n\tget onFocused(): boolean {\n\t\treturn this.on(DBaseState.FOCUSED);\n\t}\n\n\tget underFocused(): boolean {\n\t\treturn this.under(DBaseState.FOCUSED);\n\t}\n\n\tget isFocusRoot(): boolean {\n\t\treturn this.is(DBaseState.FOCUS_ROOT);\n\t}\n\n\tset isFocusRoot(isFocusRoot: boolean) {\n\t\tthis.set(DBaseState.FOCUS_ROOT, isFocusRoot);\n\t}\n\n\tget inFocusRoot(): boolean {\n\t\treturn this.in(DBaseState.FOCUS_ROOT);\n\t}\n\n\tget onFocusRoot(): boolean {\n\t\treturn this.on(DBaseState.FOCUS_ROOT);\n\t}\n\n\tget underFocusRoot(): boolean {\n\t\treturn this.under(DBaseState.FOCUS_ROOT);\n\t}\n\n\tget isFocusReverse(): boolean {\n\t\treturn this.is(DBaseState.FOCUS_REVERSE);\n\t}\n\n\tset isFocusReverse(isFocusReverse: boolean) {\n\t\tthis.set(DBaseState.FOCUS_REVERSE, isFocusReverse);\n\t}\n\n\tget inFocusReverse(): boolean {\n\t\treturn this.in(DBaseState.FOCUS_REVERSE);\n\t}\n\n\tget onFocusReverse(): boolean {\n\t\treturn this.on(DBaseState.FOCUS_REVERSE);\n\t}\n\n\tget underFocusReverse(): boolean {\n\t\treturn this.under(DBaseState.FOCUS_REVERSE);\n\t}\n\n\tget isFocusable(): boolean {\n\t\treturn !this.is(DBaseState.UNFOCUSABLE);\n\t}\n\n\tset isFocusable(isFocusable: boolean) {\n\t\tthis.set(DBaseState.UNFOCUSABLE, !isFocusable);\n\t}\n\n\tget inFocusable(): boolean {\n\t\treturn !this.in(DBaseState.UNFOCUSABLE);\n\t}\n\n\tget onFocusable(): boolean {\n\t\treturn !this.on(DBaseState.UNFOCUSABLE);\n\t}\n\n\tget underFocusable(): boolean {\n\t\treturn !this.under(DBaseState.UNFOCUSABLE);\n\t}\n\n\tget isUnfocusable(): boolean {\n\t\treturn this.is(DBaseState.UNFOCUSABLE);\n\t}\n\n\tset isUnfocusable(unfocusable: boolean) {\n\t\tthis.set(DBaseState.UNFOCUSABLE, unfocusable);\n\t}\n\n\tget inUnfocusable(): boolean {\n\t\treturn this.in(DBaseState.UNFOCUSABLE);\n\t}\n\n\tget onUnfocusable(): boolean {\n\t\treturn this.on(DBaseState.UNFOCUSABLE);\n\t}\n\n\tget underUnfocusable(): boolean {\n\t\treturn this.under(DBaseState.UNFOCUSABLE);\n\t}\n\n\tget isInvalid(): boolean {\n\t\treturn this.is(DBaseState.INVALID);\n\t}\n\n\tset isInvalid(invalid: boolean) {\n\t\tthis.set(DBaseState.INVALID, invalid);\n\t}\n\n\tget inInvalid(): boolean {\n\t\treturn this.in(DBaseState.INVALID);\n\t}\n\n\tget onInvalid(): boolean {\n\t\treturn this.on(DBaseState.INVALID);\n\t}\n\n\tget underInvalid(): boolean {\n\t\treturn this.on(DBaseState.INVALID);\n\t}\n\n\tget isSucceeded(): boolean {\n\t\treturn this.is(DBaseState.SUCCEEDED);\n\t}\n\n\tset isSucceeded(succeeded: boolean) {\n\t\tthis.set(DBaseState.SUCCEEDED, succeeded);\n\t}\n\n\tget inSucceeded(): boolean {\n\t\treturn this.in(DBaseState.SUCCEEDED);\n\t}\n\n\tget onSucceeded(): boolean {\n\t\treturn this.on(DBaseState.SUCCEEDED);\n\t}\n\n\tget underSucceeded(): boolean {\n\t\treturn this.under(DBaseState.SUCCEEDED);\n\t}\n\n\tget isFailed(): boolean {\n\t\treturn this.is(DBaseState.FAILED);\n\t}\n\n\tset isFailed(failed: boolean) {\n\t\tthis.set(DBaseState.FAILED, failed);\n\t}\n\n\tget inFailed(): boolean {\n\t\treturn this.in(DBaseState.FAILED);\n\t}\n\n\tget onFailed(): boolean {\n\t\treturn this.on(DBaseState.FAILED);\n\t}\n\n\tget underFailed(): boolean {\n\t\treturn this.under(DBaseState.FAILED);\n\t}\n\n\tget isWarned(): boolean {\n\t\treturn this.is(DBaseState.WARNED);\n\t}\n\n\tset isWarned(isWarned: boolean) {\n\t\tthis.set(DBaseState.WARNED, isWarned);\n\t}\n\n\tget inWarned(): boolean {\n\t\treturn this.in(DBaseState.WARNED);\n\t}\n\n\tget onWarned(): boolean {\n\t\treturn this.on(DBaseState.WARNED);\n\t}\n\n\tget underWarned(): boolean {\n\t\treturn this.on(DBaseState.WARNED);\n\t}\n\n\tget isChanged(): boolean {\n\t\treturn this.is(DBaseState.CHANGED);\n\t}\n\n\tset isChanged(isChanged: boolean) {\n\t\tthis.set(DBaseState.CHANGED, isChanged);\n\t}\n\n\tget inChanged(): boolean {\n\t\treturn this.in(DBaseState.CHANGED);\n\t}\n\n\tget onChanged(): boolean {\n\t\treturn this.on(DBaseState.CHANGED);\n\t}\n\n\tget underChanged(): boolean {\n\t\treturn this.on(DBaseState.CHANGED);\n\t}\n\n\tget isAlternated(): boolean {\n\t\treturn this.is(DBaseState.ALTERNATED);\n\t}\n\n\tset isAlternated(isAlternated: boolean) {\n\t\tthis.set(DBaseState.ALTERNATED, isAlternated);\n\t}\n\n\tget inAlternated(): boolean {\n\t\treturn this.in(DBaseState.ALTERNATED);\n\t}\n\n\tget onAlternated(): boolean {\n\t\treturn this.on(DBaseState.ALTERNATED);\n\t}\n\n\tget underAlternated(): boolean {\n\t\treturn this.on(DBaseState.ALTERNATED);\n\t}\n\n\ttoObject(): DBaseStateSetLike {\n\t\tconst states: string[] = [];\n\t\tthis._local.forEach((value: string): void => {\n\t\t\tstates.push(value);\n\t\t});\n\t\treturn {\n\t\t\tlocal: states\n\t\t};\n\t}\n\n\ttoString(): string {\n\t\treturn JSON.stringify(this.toObject());\n\t}\n}\n","/*\n * Copyright (C) 2020 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBaseStateSet } from \"./d-base-state-set\";\nimport { DBaseStateSetImpl } from \"./d-base-state-set-impl\";\n\nexport type DBaseStateSetImplObservableOnChange = (\n\tnewState: DBaseStateSet,\n\toldState: DBaseStateSet\n) => void;\n\nexport class DBaseStateSetImplObservable extends DBaseStateSetImpl {\n\tprotected _onChange: DBaseStateSetImplObservableOnChange;\n\tprotected _isLocked: number;\n\tprotected _isSaved: boolean;\n\tprotected _doSave: boolean;\n\tprotected _saved?: DBaseStateSetImpl;\n\n\tconstructor(onChange: DBaseStateSetImplObservableOnChange) {\n\t\tsuper();\n\t\tthis._onChange = onChange;\n\t\tthis._isLocked = 0;\n\t\tthis._isSaved = false;\n\t\tthis._doSave = true;\n\t}\n\n\tlock(callOnChange?: boolean): this {\n\t\tthis._isLocked += 1;\n\t\tif (callOnChange === false) {\n\t\t\tthis._doSave = false;\n\t\t}\n\t\treturn this;\n\t}\n\n\tunlock(): this {\n\t\tthis._isLocked -= 1;\n\t\treturn this.end();\n\t}\n\n\tprotected get saved(): DBaseStateSetImpl {\n\t\tlet result = this._saved;\n\t\tif (result == null) {\n\t\t\tresult = new DBaseStateSetImpl();\n\t\t\tthis._saved = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected begin(): this {\n\t\tif (this._doSave && !this._isSaved) {\n\t\t\tthis._isSaved = true;\n\t\t\tthis.saved.copy(this);\n\t\t}\n\t\treturn this;\n\t}\n\n\tprotected end(): this {\n\t\tif (this._isLocked <= 0) {\n\t\t\tthis._doSave = true;\n\t\t\tif (this._isSaved) {\n\t\t\t\tthis._isSaved = false;\n\t\t\t\tthis.onChange(this, this.saved);\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n\n\tprotected onChange(newState: DBaseStateSet, oldState: DBaseStateSet): void {\n\t\tthis._onChange(newState, oldState);\n\t}\n}\n","/*\n * Copyright (C) 2020 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const EShapeState = {\n\tCLICKED: \"CLICKED\",\n\tDOWN: \"DOWN\",\n\tUP: \"UP\",\n\tACTIVATED: \"ACTIVATED\",\n\tDEACTIVATED: \"DEACTIVATED\"\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBaseStateSet } from \"../d-base-state-set\";\nimport { DBaseStateSetImplObservable } from \"../d-base-state-set-impl-observable\";\nimport { EShapeState } from \"./e-shape-state\";\nimport { EShapeStateSet } from \"./e-shape-state-set\";\n\nexport class EShapeStateSetImplObservable\n\textends DBaseStateSetImplObservable\n\timplements EShapeStateSet\n{\n\tprotected onChange(newState: DBaseStateSet, oldState: DBaseStateSet): void {\n\t\tif (newState.isActive) {\n\t\t\tif (!oldState.isActive) {\n\t\t\t\tthis._local.add(EShapeState.ACTIVATED).delete(EShapeState.DEACTIVATED);\n\t\t\t}\n\t\t} else {\n\t\t\tif (oldState.isActive) {\n\t\t\t\tthis._local.add(EShapeState.DEACTIVATED).delete(EShapeState.ACTIVATED);\n\t\t\t}\n\t\t}\n\t\tsuper.onChange(newState, oldState);\n\t}\n\n\tget isClicked(): boolean {\n\t\treturn this.is(EShapeState.CLICKED);\n\t}\n\n\tset isClicked(isClicked: boolean) {\n\t\tthis.set(EShapeState.CLICKED, isClicked);\n\t}\n\n\tget inClicked(): boolean {\n\t\treturn this.in(EShapeState.CLICKED);\n\t}\n\n\tget onClicked(): boolean {\n\t\treturn this.on(EShapeState.CLICKED);\n\t}\n\n\tget underClicked(): boolean {\n\t\treturn this.under(EShapeState.CLICKED);\n\t}\n\n\tget isDown(): boolean {\n\t\treturn this.is(EShapeState.DOWN);\n\t}\n\n\tset isDown(isDown: boolean) {\n\t\tthis.set(EShapeState.DOWN, isDown);\n\t}\n\n\tget inDown(): boolean {\n\t\treturn this.in(EShapeState.DOWN);\n\t}\n\n\tget onDown(): boolean {\n\t\treturn this.on(EShapeState.DOWN);\n\t}\n\n\tget underDown(): boolean {\n\t\treturn this.under(EShapeState.DOWN);\n\t}\n\n\tget isUp(): boolean {\n\t\treturn this.is(EShapeState.UP);\n\t}\n\n\tset isUp(isUp: boolean) {\n\t\tthis.set(EShapeState.UP, isUp);\n\t}\n\n\tget inUp(): boolean {\n\t\treturn this.in(EShapeState.UP);\n\t}\n\n\tget onUp(): boolean {\n\t\treturn this.on(EShapeState.UP);\n\t}\n\n\tget underUp(): boolean {\n\t\treturn this.under(EShapeState.UP);\n\t}\n\n\tget isActivated(): boolean {\n\t\treturn this.is(EShapeState.ACTIVATED);\n\t}\n\n\tset isActivated(isActivated: boolean) {\n\t\tthis.set(EShapeState.ACTIVATED, isActivated);\n\t}\n\n\tget inActivated(): boolean {\n\t\treturn this.in(EShapeState.ACTIVATED);\n\t}\n\n\tget onActivated(): boolean {\n\t\treturn this.on(EShapeState.ACTIVATED);\n\t}\n\n\tget underActivated(): boolean {\n\t\treturn this.under(EShapeState.ACTIVATED);\n\t}\n\n\tget isDeactivated(): boolean {\n\t\treturn this.is(EShapeState.DEACTIVATED);\n\t}\n\n\tset isDeactivated(isDeactivated: boolean) {\n\t\tthis.set(EShapeState.DEACTIVATED, isDeactivated);\n\t}\n\n\tget inDeactivated(): boolean {\n\t\treturn this.in(EShapeState.DEACTIVATED);\n\t}\n\n\tget onDeactivated(): boolean {\n\t\treturn this.on(EShapeState.DEACTIVATED);\n\t}\n\n\tget underDeactivated(): boolean {\n\t\treturn this.under(EShapeState.DEACTIVATED);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Matrix, ObservablePoint, Transform } from \"pixi.js\";\nimport { EShapeTransformParent } from \"./e-shape-transform-parent\";\n\nexport interface EShapeTransform extends Transform {\n\tinternalTransform: Matrix;\n\n\tposition: ObservablePoint;\n\tpivot: ObservablePoint;\n\trotation: number;\n\tskew: ObservablePoint;\n\tscale: ObservablePoint;\n\n\tgetLocalIdCurrent(): number;\n\tgetLocalId(): number;\n\tgetParentId(): number;\n\tgetWorldId(): number;\n}\n\nexport class EShapeTransformImpl extends Transform implements EShapeTransform {\n\tprotected _parent: EShapeTransformParent;\n\tinternalTransform: Matrix;\n\n\tconstructor(parent: EShapeTransformParent) {\n\t\tsuper();\n\t\tthis.internalTransform = new Matrix();\n\t\tthis._parent = parent;\n\t}\n\n\tprotected onChange(): void {\n\t\tsuper.onChange();\n\t\tthis._parent.onTransformChange();\n\t}\n\n\tprotected updateSkew(): void {\n\t\tsuper.updateSkew();\n\t\tthis._parent.onTransformChange();\n\t}\n\n\tgetLocalIdCurrent(): number {\n\t\treturn this._currentLocalID;\n\t}\n\n\tgetLocalId(): number {\n\t\treturn this._localID;\n\t}\n\n\tgetParentId(): number {\n\t\treturn this._parentID;\n\t}\n\n\tgetWorldId(): number {\n\t\treturn this._worldID;\n\t}\n\n\tupdateTransform(parentTransform: Transform): void {\n\t\tconst oldLocalId = this._currentLocalID;\n\t\tconst oldWorldId = this._worldID;\n\t\tsuper.updateTransform(parentTransform);\n\t\tconst newLocalId = this._currentLocalID;\n\t\tconst newWorldId = this._worldID;\n\t\tif (oldLocalId !== newLocalId) {\n\t\t\tconst localTransform = this.localTransform;\n\t\t\tconst internalTransform = this.internalTransform;\n\t\t\tlocalTransform.copyTo(internalTransform);\n\t\t\tif (parentTransform instanceof EShapeTransformImpl) {\n\t\t\t\tinternalTransform.prepend(parentTransform.internalTransform);\n\t\t\t}\n\t\t} else if (oldWorldId !== newWorldId) {\n\t\t\tconst localTransform = this.localTransform;\n\t\t\tconst internalTransform = this.internalTransform;\n\t\t\tif (parentTransform instanceof EShapeTransformImpl) {\n\t\t\t\tlocalTransform.copyTo(internalTransform).prepend(parentTransform.internalTransform);\n\t\t\t\tthis._currentLocalID += 1;\n\t\t\t\tthis._localID = this._currentLocalID;\n\t\t\t}\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport class EShapeBaseHitTestData {\n\tx: number;\n\ty: number;\n\twidth: number;\n\theight: number;\n\tstrokeWidth: number;\n\tstrokeScale: number;\n\tstrokeAlign: number;\n\n\tconstructor() {\n\t\tthis.x = 0;\n\t\tthis.y = 0;\n\t\tthis.width = 0;\n\t\tthis.height = 0;\n\t\tthis.strokeWidth = 0;\n\t\tthis.strokeScale = 1;\n\t\tthis.strokeAlign = 0;\n\t}\n\n\tset(\n\t\tx: number,\n\t\ty: number,\n\t\twidth: number,\n\t\theight: number,\n\t\tstrokeWidth: number,\n\t\tstrokeScale: number,\n\t\tstrokeAlign: number\n\t): this {\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t\tthis.width = width;\n\t\tthis.height = height;\n\t\tthis.strokeWidth = strokeWidth;\n\t\tthis.strokeScale = strokeScale;\n\t\tthis.strokeAlign = strokeAlign;\n\t\treturn this;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const hitTestBBox = (x: number, y: number, ax: number, ay: number): boolean => {\n\treturn -ax <= x && x <= +ax && -ay <= y && y <= +ay;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeGradientLike } from \"../e-shape-gradient\";\n\nexport const toGradientSerialized = (gradient: EShapeGradientLike): string => {\n\tconst points = gradient.points;\n\tlet result = `[${gradient.direction}`;\n\tfor (let i = 0, imax = points.length, j = 1; i < imax; i += 1, j += 3) {\n\t\tconst point = points[i];\n\t\tresult += `,${point.color},${point.alpha},${point.position}`;\n\t}\n\tresult += \"]\";\n\treturn result;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {\n\tDisplayObject,\n\tIPoint,\n\tMatrix,\n\tPoint,\n\tRectangle,\n\tRenderer,\n\tTexture,\n\tTransform,\n\tutils\n} from \"pixi.js\";\nimport { DApplications } from \"../../d-applications\";\nimport { DBaseStateSet } from \"../../d-base-state-set\";\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\nimport { EShapeAction } from \"../action/e-shape-action\";\nimport { EShape } from \"../e-shape\";\nimport { EShapeConnectorContainer } from \"../e-shape-connector-container\";\nimport { EShapeConnectorContainerImpl } from \"../e-shape-connector-container-impl\";\nimport { EShapeContainer } from \"../e-shape-container\";\nimport { EShapeCopyPart } from \"../e-shape-copy-part\";\nimport { EShapeCorner } from \"../e-shape-corner\";\nimport { EShapeEditor } from \"../e-shape-editor\";\nimport { EShapeFill } from \"../e-shape-fill\";\nimport { EShapeGradientLike } from \"../e-shape-gradient\";\nimport { EShapeLayout } from \"../e-shape-layout\";\nimport { EShapePoints } from \"../e-shape-points\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShapeRuntime } from \"../e-shape-runtime\";\nimport { EShapeStateSet } from \"../e-shape-state-set\";\nimport { EShapeStateSetImplObservable } from \"../e-shape-state-set-impl-observable\";\nimport { EShapeStroke } from \"../e-shape-stroke\";\nimport { EShapeStrokeStyle } from \"../e-shape-stroke-style\";\nimport { EShapeData } from \"../e-shape-data\";\nimport { EShapeText } from \"../e-shape-text\";\nimport { EShapeTransform, EShapeTransformImpl } from \"../e-shape-transform\";\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapeUploaded } from \"../e-shape-uploaded\";\nimport { EShapeBaseHitTestData } from \"./e-shape-base-hit-test-data\";\nimport { hitTestBBox } from \"./hit-test-bbox\";\nimport { toGradientSerialized } from \"./to-gradient-serialized\";\n\nexport abstract class EShapeBase extends utils.EventEmitter implements EShape {\n\tprotected static WORK_HIT_TEST_DATA?: EShapeBaseHitTestData;\n\tid: string;\n\tuuid: number;\n\treadonly type: EShapeType;\n\tabstract readonly size: IPoint;\n\tabstract readonly fill: EShapeFill;\n\tabstract readonly stroke: EShapeStroke;\n\treadonly transform: EShapeTransform;\n\tabstract radius: number;\n\tabstract corner: EShapeCorner;\n\tprotected _points?: EShapePoints;\n\tprotected _image?: HTMLImageElement;\n\timageSrc?: string;\n\ttexture?: Texture;\n\tabstract gradient?: EShapeGradientLike;\n\tabstract readonly text: EShapeText;\n\t/** @deprecated in favor of {@link data} */\n\tabstract readonly tag: EShapeData;\n\tabstract readonly data: EShapeData;\n\treadonly action: EShapeAction;\n\tabstract cursor: string;\n\tinteractive: boolean;\n\tshortcut?: string;\n\ttitle?: string;\n\n\tprotected _connector?: EShapeConnectorContainer;\n\n\tprotected _visible: boolean;\n\tprotected _onTransformChangeLock: number;\n\tprotected _isOnTransformChanged: boolean;\n\tprotected _uploadedUpdateLock: number;\n\tprotected _isUploadedUpdated: boolean;\n\tprotected _isUploadedUpdatedRecursively: boolean;\n\n\tprotected _bounds?: Rectangle;\n\tprotected _boundsTransformId: number;\n\tprotected _boundsInternal?: Rectangle;\n\tprotected _boundsInternalTransformId: number;\n\tprotected _boundsLocal?: Rectangle;\n\tprotected _boundsLocalTransformId: number;\n\n\tprotected _state?: EShapeStateSet;\n\n\t// Hierarchy\n\tparent: EShapeContainer | EShape | null;\n\tchildren: EShape[];\n\tlayout?: EShapeLayout;\n\n\t// Working space\n\tindex: number; // A work space for sorting.\n\tselected: boolean;\n\treference: number; // Count of references from commands\n\n\t// Working space for the viewer\n\truntime?: EShapeRuntime;\n\n\t// Working space for the editor\n\teditor?: EShapeEditor;\n\n\t// Working space for the renderer\n\tuploaded?: EShapeUploaded;\n\n\tconstructor(type: EShapeType) {\n\t\tsuper();\n\t\tthis.id = \"\";\n\t\tthis.uuid = 0;\n\t\tthis.type = type;\n\t\tthis.transform = this.newTransform();\n\t\tthis._onTransformChangeLock = 0;\n\t\tthis._isOnTransformChanged = false;\n\t\tthis.action = new EShapeAction();\n\t\tthis._visible = true;\n\t\tthis._uploadedUpdateLock = 0;\n\t\tthis._isUploadedUpdated = false;\n\t\tthis._isUploadedUpdatedRecursively = false;\n\n\t\tthis._boundsTransformId = NaN;\n\t\tthis._boundsInternalTransformId = NaN;\n\t\tthis._boundsLocalTransformId = NaN;\n\n\t\tthis.interactive = false;\n\n\t\t//\n\t\tthis.parent = null;\n\t\tthis.children = [];\n\n\t\t//\n\t\tthis.selected = false;\n\t\tthis.index = 0;\n\t\tthis.reference = 0;\n\t}\n\n\tprotected newTransform(): EShapeTransform {\n\t\treturn new EShapeTransformImpl(this);\n\t}\n\n\tonSizeChange(): void {\n\t\tthis._boundsTransformId = NaN;\n\t\tthis._boundsInternalTransformId = NaN;\n\t\tthis._boundsLocalTransformId = NaN;\n\n\t\tthis.onTransformChange_();\n\t\tthis.updateUploaded();\n\t\tthis._connector?.fit(true);\n\t}\n\n\tonTransformChange(): void {\n\t\tthis.onTransformChange_();\n\t\tthis.onParentTransformChange();\n\t}\n\n\tonParentTransformChange(): void {\n\t\tthis.updateUploaded();\n\t\tthis._connector?.fit(true);\n\t\tconst children = this.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].onParentTransformChange();\n\t\t}\n\t}\n\n\tprotected onTransformChange_(): void {\n\t\tif (this._onTransformChangeLock === 0) {\n\t\t\tconst parent = this.parent;\n\t\t\tif (parent != null) {\n\t\t\t\tparent.onChildTransformChange();\n\t\t\t}\n\t\t} else {\n\t\t\tthis._isOnTransformChanged = true;\n\t\t}\n\t}\n\n\tdisallowOnTransformChange(): void {\n\t\tthis._onTransformChangeLock += 1;\n\t\tif (this._onTransformChangeLock === 1) {\n\t\t\tthis._isOnTransformChanged = false;\n\t\t}\n\t}\n\n\tallowOnTransformChange(invokeOnTransformChange: boolean): void {\n\t\tthis._onTransformChangeLock -= 1;\n\t\tif (this._onTransformChangeLock === 0) {\n\t\t\tif (this._isOnTransformChanged) {\n\t\t\t\tthis._isOnTransformChanged = false;\n\t\t\t\tif (invokeOnTransformChange) {\n\t\t\t\t\tthis.onTransformChange();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tonChildTransformChange(): void {\n\t\t//\n\t}\n\n\tdisallowUploadedUpdate(): void {\n\t\tthis._uploadedUpdateLock += 1;\n\t\tif (this._uploadedUpdateLock === 1) {\n\t\t\tthis._isUploadedUpdated = false;\n\t\t\tthis._isUploadedUpdatedRecursively = false;\n\t\t}\n\t}\n\n\tallowUploadedUpdate(): void {\n\t\tthis._uploadedUpdateLock -= 1;\n\t\tif (this._uploadedUpdateLock === 0) {\n\t\t\tif (this._isUploadedUpdatedRecursively) {\n\t\t\t\tthis._isUploadedUpdatedRecursively = false;\n\t\t\t\tthis._isUploadedUpdated = false;\n\t\t\t\tthis.updateUploadedRecursively();\n\t\t\t} else if (this._isUploadedUpdated) {\n\t\t\t\tthis._isUploadedUpdated = false;\n\t\t\t\tthis.updateUploaded();\n\t\t\t}\n\t\t}\n\t}\n\n\tupdateUploadedRecursively(): void {\n\t\tif (this._uploadedUpdateLock === 0) {\n\t\t\tthis.updateUploaded();\n\t\t\tconst children = this.children;\n\t\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\t\tchildren[i].updateUploadedRecursively();\n\t\t\t}\n\t\t} else {\n\t\t\tthis._isUploadedUpdatedRecursively = true;\n\t\t}\n\t}\n\n\tupdateUploaded(): void {\n\t\tif (this._uploadedUpdateLock === 0) {\n\t\t\tconst uploaded = this.uploaded;\n\t\t\tif (uploaded != null) {\n\t\t\t\tuploaded.update(this);\n\t\t\t}\n\t\t} else {\n\t\t\tthis._isUploadedUpdated = true;\n\t\t}\n\t}\n\n\tget image(): HTMLImageElement | undefined {\n\t\treturn this._image;\n\t}\n\n\tset image(image: HTMLImageElement | undefined) {\n\t\tthis._image = image;\n\t}\n\n\tget points(): EShapePoints | undefined {\n\t\treturn this._points;\n\t}\n\n\tget root(): EShape {\n\t\tlet root: EShape = this;\n\t\twhile (root.parent instanceof EShapeBase) {\n\t\t\troot = root.parent;\n\t\t}\n\t\treturn root;\n\t}\n\n\tget connector(): EShapeConnectorContainer {\n\t\tlet result = this._connector;\n\t\tif (result == null) {\n\t\t\tresult = new EShapeConnectorContainerImpl(this);\n\t\t\tthis._connector = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tget visible(): boolean {\n\t\tif (this._visible) {\n\t\t\tconst parent = this.parent;\n\t\t\tif (parent instanceof EShapeBase) {\n\t\t\t\treturn parent.visible;\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tset visible(visible: boolean) {\n\t\tif (this._visible !== visible) {\n\t\t\tthis._visible = visible;\n\t\t\tthis.updateUploadedRecursively();\n\t\t}\n\t}\n\n\tget worldVisible(): boolean {\n\t\tif (this._visible) {\n\t\t\tconst parent = this.parent;\n\t\t\tif (parent) {\n\t\t\t\treturn parent.worldVisible;\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t//\n\tabstract clone(): EShape;\n\n\t//\n\ttoDirty(): void {\n\t\tthis.parent?.toDirty();\n\t}\n\n\t// Hierarchy\n\tattach(parent: EShapeContainer | EShape, at?: number): this {\n\t\tthis.detach();\n\t\tthis.parent = parent;\n\t\tconst children = parent.children;\n\t\tif (at != null && 0 <= at && at < children.length) {\n\t\t\tchildren.splice(at, 0, this);\n\t\t} else {\n\t\t\tchildren.push(this);\n\t\t}\n\t\tthis.uploaded = undefined;\n\t\tparent.onChildTransformChange();\n\t\tparent.toDirty();\n\t\tthis.onAttach();\n\t\treturn this;\n\t}\n\n\tonAttach(): void {\n\t\tconst connector = this._connector;\n\t\tif (connector) {\n\t\t\tconnector.attach();\n\t\t\tconnector.fit(true);\n\t\t}\n\t\tconst children = this.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].onAttach();\n\t\t}\n\t}\n\n\tdetach(): this {\n\t\tconst parent = this.parent;\n\t\tif (parent) {\n\t\t\tthis.parent = null;\n\t\t\tthis.uploaded = undefined;\n\t\t\tconst children = parent.children;\n\t\t\tconst index = children.indexOf(this);\n\t\t\tif (0 <= index) {\n\t\t\t\tchildren.splice(index, 1);\n\t\t\t\tparent.onChildTransformChange();\n\t\t\t\tparent.toDirty();\n\t\t\t\tthis.onDetach();\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n\n\tonDetach(): void {\n\t\tconst connector = this._connector;\n\t\tif (connector) {\n\t\t\tconnector.detach();\n\t\t}\n\t\tconst children = this.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].onDetach();\n\t\t}\n\t}\n\n\t// Transform\n\tupdateTransform(): void {\n\t\tconst parent = this.parent;\n\t\tif (parent) {\n\t\t\tif (parent.parent) {\n\t\t\t\tparent.updateTransform();\n\t\t\t}\n\t\t\tthis.transform.updateTransform(parent.transform);\n\t\t} else {\n\t\t\tthis.transform.updateTransform(Transform.IDENTITY);\n\t\t}\n\t}\n\n\t// Serialization\n\tserializeChildren(manager: EShapeResourceManagerSerialization): DDiagramSerializedItem[] {\n\t\tconst children = this.children;\n\t\tconst childrenSerialized = [];\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tconst child = children[i];\n\t\t\tchildrenSerialized.push(child.serialize(manager));\n\t\t}\n\t\treturn childrenSerialized;\n\t}\n\n\tserializeImage(manager: EShapeResourceManagerSerialization): number {\n\t\tconst image = this._image;\n\t\treturn image != null ? manager.addResource(image.src) : -1;\n\t}\n\n\tserializeGradient(manager: EShapeResourceManagerSerialization): number {\n\t\tconst gradient = this.gradient;\n\t\tif (gradient != null) {\n\t\t\tif (gradient.serialized == null) {\n\t\t\t\tgradient.serialized = toGradientSerialized(gradient);\n\t\t\t}\n\t\t\treturn manager.addResource(gradient.serialized);\n\t\t}\n\t\treturn -1;\n\t}\n\n\tserializeState(manager: EShapeResourceManagerSerialization): number {\n\t\tconst state = this.state;\n\t\treturn (this.interactive ? 1 : 0) | (state.isFocusable ? 0 : 2) | (state.isActive ? 4 : 0);\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): DDiagramSerializedItem {\n\t\tconst transform = this.transform;\n\t\tconst position = transform.position;\n\t\tconst pivot = transform.pivot;\n\t\tconst size = this.size;\n\t\tconst shortcut = this.shortcut;\n\t\tconst shortcutId = shortcut != null ? manager.addResource(shortcut) : -1;\n\t\tconst title = this.title;\n\t\tconst titleId = title != null ? manager.addResource(title) : -1;\n\t\treturn [\n\t\t\tthis.type,\n\t\t\tmanager.addResource(this.id),\n\t\t\tposition.x,\n\t\t\tposition.y,\n\t\t\tsize.x,\n\t\t\tsize.y,\n\t\t\ttransform.rotation,\n\t\t\ttransform.skew.x,\n\t\t\tthis.fill.serialize(manager),\n\t\t\tthis.stroke.serialize(manager),\n\t\t\tmanager.addResource(this.cursor.trim()),\n\t\t\tthis.text.serialize(manager),\n\t\t\tthis.data.serialize(manager),\n\t\t\tthis.radius,\n\t\t\tthis.corner,\n\t\t\t-1,\n\t\t\t-1,\n\t\t\tthis.action.serialize(manager),\n\t\t\tthis.serializeImage(manager),\n\t\t\tthis.serializeGradient(manager),\n\t\t\tthis.serializeChildren(manager),\n\t\t\tpivot.x,\n\t\t\tpivot.y,\n\t\t\tthis.serializeState(manager),\n\t\t\tshortcutId,\n\t\t\ttitleId,\n\t\t\tthis.uuid\n\t\t];\n\t}\n\n\taddUuid(manager: EShapeResourceManagerSerialization): void {\n\t\tthis.uuid = manager.addUuid(this.uuid);\n\t\tconst children = this.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].addUuid(manager);\n\t\t}\n\t}\n\n\tupdateUuid(manager: EShapeResourceManagerSerialization): void {\n\t\tthis.uuid = manager.updateUuid(this.uuid);\n\t\tconst children = this.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].updateUuid(manager);\n\t\t}\n\t}\n\n\t// Hit test\n\tprotected getShapeScale(): number {\n\t\tconst container = this.root.parent as any;\n\t\tif (container != null && container.getShapeScale != null) {\n\t\t\treturn container.getShapeScale();\n\t\t}\n\t\treturn 1.0;\n\t}\n\n\tprotected getStrokeWidthScale(style: EShapeStrokeStyle): number {\n\t\tif (style & EShapeStrokeStyle.NON_EXPANDING_WIDTH) {\n\t\t\tif (style & EShapeStrokeStyle.NON_SHRINKING_WIDTH) {\n\t\t\t\treturn this.getShapeScale();\n\t\t\t} else {\n\t\t\t\treturn Math.min(1.0, this.getShapeScale());\n\t\t\t}\n\t\t} else {\n\t\t\tif (style & EShapeStrokeStyle.NON_SHRINKING_WIDTH) {\n\t\t\t\treturn Math.max(1.0, this.getShapeScale());\n\t\t\t} else {\n\t\t\t\treturn 1.0;\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected getHitTestSize(result: EShapeBaseHitTestData): EShapeBaseHitTestData {\n\t\tconst size = this.size;\n\t\tresult.width = 0.5 * size.x;\n\t\tresult.height = 0.5 * size.y;\n\t\treturn result;\n\t}\n\n\ttoHitTestData(x: number, y: number): EShapeBaseHitTestData {\n\t\tconst result = this.getHitTestSize(\n\t\t\t(EShapeBase.WORK_HIT_TEST_DATA ??= new EShapeBaseHitTestData())\n\t\t);\n\t\tconst sx = result.width;\n\t\tconst sy = result.height;\n\t\tconst pivot = this.transform.pivot;\n\t\tconst dx = x - pivot.x;\n\t\tconst dy = y - pivot.y;\n\t\tconst stroke = this.stroke;\n\t\tconst strokeWidth = stroke.enable ? stroke.width : 0;\n\t\tconst strokeScale = this.getStrokeWidthScale(stroke.style);\n\t\tconst strokeAlign = stroke.align;\n\t\tconst s = strokeWidth * strokeScale * strokeAlign;\n\t\treturn result.set(\n\t\t\t0 <= sx ? +dx : -dx,\n\t\t\t0 <= sy ? +dy : -dy,\n\t\t\tMath.abs(sx) + s,\n\t\t\tMath.abs(sy) + s,\n\t\t\tstrokeWidth,\n\t\t\tstrokeScale,\n\t\t\tstrokeAlign\n\t\t);\n\t}\n\n\tcontains(x: number, y: number): EShape | null {\n\t\tconst data = this.toHitTestData(x, y);\n\t\tif (\n\t\t\tthis.containsAbs(\n\t\t\t\tdata.x,\n\t\t\t\tdata.y,\n\t\t\t\tdata.width,\n\t\t\t\tdata.height,\n\t\t\t\tdata.strokeWidth,\n\t\t\t\tdata.strokeScale,\n\t\t\t\tdata.strokeAlign\n\t\t\t)\n\t\t) {\n\t\t\treturn this;\n\t\t}\n\t\treturn this.containsText(x, y) || this.containsChildren(x, y);\n\t}\n\n\tprotected containsText(x: number, y: number): EShape | null {\n\t\tconst text = this.text;\n\t\tconst textAtlas = text.atlas;\n\t\tif (textAtlas != null) {\n\t\t\tconst textWorld = text.world;\n\t\t\tif (textWorld != null) {\n\t\t\t\tconst transform = this.transform.internalTransform;\n\t\t\t\tconst tx = transform.a * x + transform.c * y + transform.tx - textWorld[0];\n\t\t\t\tconst ty = transform.b * x + transform.d * y + transform.ty - textWorld[1];\n\t\t\t\tconst th = textWorld[2] * tx + textWorld[3] * ty;\n\t\t\t\tconst tv = textWorld[4] * tx + textWorld[5] * ty;\n\t\t\t\tif (0 <= th && th <= textWorld[6] && 0 <= tv && tv <= textWorld[7]) {\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tprotected containsChildren(x: number, y: number): EShape | null {\n\t\tconst children = this.children;\n\t\tfor (let i = children.length - 1; 0 <= i; --i) {\n\t\t\tconst child = children[i];\n\t\t\tchild.updateTransform();\n\t\t\tconst localTransform = child.transform.localTransform;\n\t\t\tconst a = localTransform.a;\n\t\t\tconst b = localTransform.b;\n\t\t\tconst c = localTransform.c;\n\t\t\tconst d = localTransform.d;\n\t\t\tconst tx = localTransform.tx;\n\t\t\tconst ty = localTransform.ty;\n\t\t\tconst id = 1 / (a * d - c * b);\n\t\t\tconst lx = (d * x - c * y + ty * c - tx * d) * id;\n\t\t\tconst ly = (a * y - b * x - ty * a + tx * b) * id;\n\t\t\tconst childResult = child.contains(lx, ly);\n\t\t\tif (childResult != null) {\n\t\t\t\treturn childResult;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tcontainsBBox(x: number, y: number): boolean {\n\t\tconst data = this.toHitTestData(x, y);\n\t\treturn this.containsAbsBBox(data.x, data.y, data.width, data.height);\n\t}\n\n\tcontainsAbs(\n\t\tx: number,\n\t\ty: number,\n\t\tax: number,\n\t\tay: number,\n\t\tsw: number,\n\t\tss: number,\n\t\tsa: number\n\t): boolean {\n\t\treturn this.containsAbsBBox(x, y, ax, ay);\n\t}\n\n\tcontainsAbsBBox(x: number, y: number, ax: number, ay: number): boolean {\n\t\treturn hitTestBBox(x, y, ax, ay);\n\t}\n\n\tselect(point: Point): boolean {\n\t\treturn false;\n\t}\n\n\t//\n\ttoGlobal(position: IPoint, result: Point, skipUpdate?: boolean): Point {\n\t\tif (skipUpdate !== true) {\n\t\t\tthis.updateTransform();\n\t\t}\n\t\tresult.copyFrom(position);\n\t\tthis.transform.worldTransform.apply(result, result);\n\t\treturn result;\n\t}\n\n\ttoLocal(position: IPoint, from?: DisplayObject, result?: Point, skipUpdate?: boolean): Point {\n\t\tif (skipUpdate !== true) {\n\t\t\tthis.updateTransform();\n\t\t}\n\t\tif (result === undefined) {\n\t\t\tresult = new Point();\n\t\t}\n\t\tresult.copyFrom(position);\n\t\tthis.transform.worldTransform.applyInverse(result, result);\n\t\treturn result;\n\t}\n\n\tgetBounds(work: Point, skipUpdate: boolean, result: Rectangle): Rectangle {\n\t\tif (skipUpdate !== true) {\n\t\t\tthis.updateTransform();\n\t\t}\n\t\tconst bounds = this._bounds || new Rectangle();\n\t\tthis._bounds = bounds;\n\t\tconst worldId = this.transform.getWorldId();\n\t\tif (worldId !== this._boundsTransformId) {\n\t\t\tthis._boundsTransformId = worldId;\n\t\t\tthis.getBounds_(this.transform.worldTransform, work, bounds);\n\t\t}\n\t\tresult.copyFrom(bounds);\n\t\treturn result;\n\t}\n\n\tgetBoundsInternal(work: Point, skipUpdate: boolean, result: Rectangle): Rectangle {\n\t\tif (skipUpdate !== true) {\n\t\t\tthis.updateTransform();\n\t\t}\n\t\tconst boundsInternal = this._boundsInternal || new Rectangle();\n\t\tthis._boundsInternal = boundsInternal;\n\t\tconst currentLocalId = this.transform.getLocalIdCurrent();\n\t\tif (currentLocalId !== this._boundsInternalTransformId) {\n\t\t\tthis._boundsInternalTransformId = currentLocalId;\n\t\t\tthis.getBounds_(this.transform.internalTransform, work, boundsInternal);\n\t\t}\n\t\tresult.copyFrom(boundsInternal);\n\t\treturn result;\n\t}\n\n\tgetBoundsLocal(work: Point, skipUpdate: boolean, result: Rectangle): Rectangle {\n\t\tif (skipUpdate !== true) {\n\t\t\tthis.updateTransform();\n\t\t}\n\t\tconst boundsLocal = this._boundsLocal || new Rectangle();\n\t\tthis._boundsLocal = boundsLocal;\n\t\tconst currentLocalId = this.transform.getLocalIdCurrent();\n\t\tif (currentLocalId !== this._boundsLocalTransformId) {\n\t\t\tthis._boundsLocalTransformId = currentLocalId;\n\t\t\tthis.getBounds_(this.transform.localTransform, work, boundsLocal);\n\t\t}\n\t\tresult.copyFrom(boundsLocal);\n\t\treturn result;\n\t}\n\n\tprotected getBoundsSize(): IPoint {\n\t\treturn this.size;\n\t}\n\n\tprotected getBounds_(transform: Matrix, work: Point, result: Rectangle): Rectangle {\n\t\tconst pivot = this.transform.pivot;\n\t\tconst px = pivot.x;\n\t\tconst py = pivot.y;\n\t\tconst size = this.getBoundsSize();\n\t\tconst sx = 0.5 * size.x;\n\t\tconst sy = 0.5 * size.y;\n\n\t\tconst a = transform.a;\n\t\tconst b = transform.b;\n\t\tconst c = transform.c;\n\t\tconst d = transform.d;\n\n\t\tlet x = -sx + px;\n\t\tlet y = -sy + py;\n\t\tconst x0 = a * x + c * y;\n\t\tconst y0 = b * x + d * y;\n\n\t\tx = +sx + px;\n\t\ty = -sy + py;\n\t\tconst x1 = a * x + c * y;\n\t\tconst y1 = b * x + d * y;\n\n\t\tx = -sx + px;\n\t\ty = +sy + py;\n\t\tconst x2 = a * x + c * y;\n\t\tconst y2 = b * x + d * y;\n\n\t\tx = +sx + px;\n\t\ty = +sy + py;\n\t\tconst x3 = a * x + c * y;\n\t\tconst y3 = b * x + d * y;\n\n\t\tconst xmin = Math.min(x0, x1, x2, x3);\n\t\tconst ymin = Math.min(y0, y1, y2, y3);\n\t\tconst xmax = Math.max(x0, x1, x2, x3);\n\t\tconst ymax = Math.max(y0, y1, y2, y3);\n\t\tresult.x = xmin + transform.tx;\n\t\tresult.y = ymin + transform.ty;\n\t\tresult.width = xmax - xmin;\n\t\tresult.height = ymax - ymin;\n\t\treturn result;\n\t}\n\n\t//\n\tdestroy(): void {\n\t\tconst children = this.children;\n\t\tfor (let i = children.length - 1; 0 <= i; --i) {\n\t\t\tchildren[i].destroy();\n\t\t}\n\t\tchildren.length = 0;\n\t}\n\n\t//\n\tprotected onStateChange(newState: DBaseStateSet, oldState: DBaseStateSet): void {\n\t\tthis.runtime?.onStateChange(this, newState, oldState);\n\n\t\tconst children = this.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tconst child = children[i];\n\t\t\tif (child instanceof EShapeBase) {\n\t\t\t\tchild.state.onParentChange(newState, oldState);\n\t\t\t}\n\t\t}\n\t}\n\n\tget state(): EShapeStateSet {\n\t\tlet result = this._state;\n\t\tif (result == null) {\n\t\t\tresult = new EShapeStateSetImplObservable((newState, oldState): void => {\n\t\t\t\tthis.onStateChange(newState, oldState);\n\t\t\t});\n\t\t\tthis._state = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tfocus(): this {\n\t\tthis.setFocused(true);\n\t\treturn this;\n\t}\n\n\tblur(): this {\n\t\tthis.setFocused(false);\n\t\treturn this;\n\t}\n\n\tprotected setFocused(isFocused: boolean): void {\n\t\tif (this.state.isFocused !== isFocused) {\n\t\t\tconst layer = DApplications.getLayer(this);\n\t\t\tif (layer) {\n\t\t\t\tlayer.getFocusController().set(this, isFocused);\n\t\t\t}\n\t\t}\n\t}\n\n\tonKeyDown(e: KeyboardEvent): boolean {\n\t\tconst runtime = this.runtime;\n\t\tif (runtime) {\n\t\t\treturn runtime.onKeyDown(this, e);\n\t\t}\n\t\treturn false;\n\t}\n\n\tonKeyUp(e: KeyboardEvent): boolean {\n\t\tconst runtime = this.runtime;\n\t\tif (runtime) {\n\t\t\treturn runtime.onKeyUp(this, e);\n\t\t}\n\t\treturn false;\n\t}\n\n\t//\n\tupdate(time: number): void {\n\t\tconst runtime = this.runtime;\n\t\tif (runtime) {\n\t\t\truntime.update(this, time);\n\t\t}\n\t}\n\n\tonRender(time: number, renderer: Renderer): void {\n\t\tconst runtime = this.runtime;\n\t\tif (runtime) {\n\t\t\truntime.onRender(this, time, renderer);\n\t\t}\n\t}\n\n\tupdateRecursively(time: number): void {\n\t\tthis.update(time);\n\n\t\tconst children = this.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].update(time);\n\t\t}\n\t}\n\n\tcopy(source: EShape, part: EShapeCopyPart = EShapeCopyPart.ALL): this {\n\t\tthis.id = source.id;\n\t\tthis.uuid = source.uuid;\n\t\tif (part & EShapeCopyPart.TRANSFORM) {\n\t\t\tconst transform = this.transform;\n\t\t\tconst sourceTransform = source.transform;\n\t\t\ttransform.position.copyFrom(sourceTransform.position);\n\t\t\ttransform.rotation = sourceTransform.rotation;\n\t\t\ttransform.skew.copyFrom(sourceTransform.skew);\n\t\t\ttransform.pivot.copyFrom(sourceTransform.pivot);\n\t\t\ttransform.scale.copyFrom(sourceTransform.scale);\n\t\t}\n\t\tif (part & EShapeCopyPart.SIZE) {\n\t\t\tthis.size.copyFrom(source.size);\n\t\t}\n\t\tif (part & EShapeCopyPart.STYLE) {\n\t\t\tthis.fill.copy(source.fill);\n\t\t\tthis.stroke.copy(source.stroke);\n\t\t\tthis.text.copy(source.text);\n\t\t\tthis.radius = source.radius;\n\t\t\tthis.corner = source.corner;\n\t\t}\n\t\tif (part & EShapeCopyPart.DATA) {\n\t\t\tthis.data.copy(source.data);\n\t\t}\n\t\tif (part & EShapeCopyPart.IMAGE) {\n\t\t\tthis.image = source.image;\n\t\t}\n\t\tif (part & EShapeCopyPart.ACTION) {\n\t\t\tthis.action.clearAndAddAll(source.action.values);\n\t\t\tthis.interactive = source.interactive;\n\t\t\tthis.cursor = source.cursor;\n\t\t\tthis.shortcut = source.shortcut;\n\t\t}\n\t\tif (part & EShapeCopyPart.POINTS) {\n\t\t\tconst sourcePoints = source.points;\n\t\t\tif (sourcePoints != null) {\n\t\t\t\tconst points = this.points;\n\t\t\t\tif (points != null) {\n\t\t\t\t\tpoints.copy(sourcePoints);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (part & EShapeCopyPart.STATE) {\n\t\t\tthis.state.lock(false).copy(source.state).unlock();\n\t\t}\n\t\tif (part & EShapeCopyPart.CONNECTOR) {\n\t\t\tif (source instanceof EShapeBase) {\n\t\t\t\tconst sourceConnector = source._connector;\n\t\t\t\tif (sourceConnector) {\n\t\t\t\t\tthis.connector.copy(sourceConnector);\n\t\t\t\t} else {\n\t\t\t\t\tconst connector = this._connector;\n\t\t\t\t\tif (connector) {\n\t\t\t\t\t\tconnector.clear();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst connector = this._connector;\n\t\t\t\tif (connector) {\n\t\t\t\t\tconnector.clear();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShapeStroke, EShapeStrokeLike } from \"../e-shape-stroke\";\nimport { EShapeStrokeSide } from \"../e-shape-stroke-side\";\nimport { EShapeStrokeStyle } from \"../e-shape-stroke-style\";\nimport { EShapeStrokeImplParent } from \"./e-shape-stroke-impl-parent\";\n\nexport class EShapeStrokeImpl implements EShapeStroke {\n\tprotected _parent: EShapeStrokeImplParent;\n\tprotected _enable: boolean;\n\tprotected _color: number;\n\tprotected _alpha: number;\n\tprotected _width: number;\n\tprotected _align: number;\n\tprotected _side: EShapeStrokeSide;\n\tprotected _style: EShapeStrokeStyle;\n\n\tconstructor(\n\t\tparent: EShapeStrokeImplParent,\n\t\tenable: boolean,\n\t\tcolor: number,\n\t\talpha: number,\n\t\twidth: number,\n\t\talign: number,\n\t\tside: EShapeStrokeSide,\n\t\tstyle: EShapeStrokeStyle\n\t) {\n\t\tthis._parent = parent;\n\t\tthis._enable = enable;\n\t\tthis._color = color;\n\t\tthis._alpha = alpha;\n\t\tthis._width = width;\n\t\tthis._align = align;\n\t\tthis._side = side;\n\t\tthis._style = style;\n\t}\n\n\tget enable(): boolean {\n\t\treturn this._enable;\n\t}\n\n\tset enable(enable: boolean) {\n\t\tif (this._enable !== enable) {\n\t\t\tthis._enable = enable;\n\t\t\tthis._parent.updateUploaded();\n\t\t}\n\t}\n\n\tget color(): number {\n\t\treturn this._color;\n\t}\n\n\tset color(color: number) {\n\t\tif (this._color !== color) {\n\t\t\tthis._color = color;\n\t\t\tthis._parent.updateUploaded();\n\t\t}\n\t}\n\n\tget alpha(): number {\n\t\treturn this._alpha;\n\t}\n\n\tset alpha(alpha: number) {\n\t\tif (this._alpha !== alpha) {\n\t\t\tthis._alpha = alpha;\n\t\t\tthis._parent.updateUploaded();\n\t\t}\n\t}\n\n\tget width(): number {\n\t\treturn this._width;\n\t}\n\n\tset width(width: number) {\n\t\tif (this._width !== width) {\n\t\t\tthis._width = width;\n\t\t\tthis._parent.updateUploaded();\n\t\t}\n\t}\n\n\tget align(): number {\n\t\treturn this._align;\n\t}\n\n\tset align(align: number) {\n\t\tif (this._align !== align) {\n\t\t\tthis._align = align;\n\t\t\tthis._parent.updateUploaded();\n\t\t}\n\t}\n\n\tget side(): EShapeStrokeSide {\n\t\treturn this._side;\n\t}\n\n\tset side(side: EShapeStrokeSide) {\n\t\tif (this._side !== side) {\n\t\t\tthis._side = side;\n\t\t\tthis._parent.updateUploaded();\n\t\t}\n\t}\n\n\tget style(): EShapeStrokeStyle {\n\t\treturn this._style;\n\t}\n\n\tset style(style: EShapeStrokeStyle) {\n\t\tif (this._style !== style) {\n\t\t\tthis._style = style;\n\t\t\tthis._parent.updateUploaded();\n\t\t}\n\t}\n\n\tcopy(target?: Partial<EShapeStrokeLike>): void {\n\t\tif (target) {\n\t\t\tthis.set(\n\t\t\t\ttarget.enable,\n\t\t\t\ttarget.color,\n\t\t\t\ttarget.alpha,\n\t\t\t\ttarget.width,\n\t\t\t\ttarget.align,\n\t\t\t\ttarget.side,\n\t\t\t\ttarget.style\n\t\t\t);\n\t\t}\n\t}\n\n\tset(\n\t\tenable?: boolean,\n\t\tcolor?: number,\n\t\talpha?: number,\n\t\twidth?: number,\n\t\talign?: number,\n\t\tside?: EShapeStrokeSide,\n\t\tstyle?: EShapeStrokeStyle\n\t): void {\n\t\tlet isChanged = false;\n\n\t\tif (enable !== undefined && this._enable !== enable) {\n\t\t\tthis._enable = enable;\n\t\t\tisChanged = true;\n\t\t}\n\n\t\tif (color !== undefined && this._color !== color) {\n\t\t\tthis._color = color;\n\t\t\tisChanged = true;\n\t\t}\n\n\t\tif (alpha !== undefined && this._alpha !== alpha) {\n\t\t\tthis._alpha = alpha;\n\t\t\tisChanged = true;\n\t\t}\n\n\t\tif (width !== undefined && this._width !== width) {\n\t\t\tthis._width = width;\n\t\t\tisChanged = true;\n\t\t}\n\n\t\tif (align !== undefined && this._align !== align) {\n\t\t\tthis._align = align;\n\t\t\tisChanged = true;\n\t\t}\n\n\t\tif (side !== undefined && this._side !== side) {\n\t\t\tthis._side = side;\n\t\t\tisChanged = true;\n\t\t}\n\n\t\tif (style !== undefined && this._style !== style) {\n\t\t\tthis._style = style;\n\t\t\tisChanged = true;\n\t\t}\n\n\t\tif (isChanged) {\n\t\t\tthis._parent.updateUploaded();\n\t\t}\n\t}\n\n\tclone(): EShapeStroke {\n\t\treturn new EShapeStrokeImpl(\n\t\t\tthis._parent,\n\t\t\tthis._enable,\n\t\t\tthis._color,\n\t\t\tthis._alpha,\n\t\t\tthis._width,\n\t\t\tthis._align,\n\t\t\tthis._side,\n\t\t\tthis._style\n\t\t);\n\t}\n\n\ttoObject(): EShapeStrokeLike {\n\t\treturn {\n\t\t\tenable: this._enable,\n\t\t\tcolor: this._color,\n\t\t\talpha: this._alpha,\n\t\t\twidth: this._width,\n\t\t\talign: this._align,\n\t\t\tside: this._side,\n\t\t\tstyle: this._style\n\t\t};\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\tconst enable = this._enable ? 1 : 0;\n\t\tconst serialized = `[${enable},${this._color},${this._alpha},${this._width},${this._align},${this._side},${this._style}]`;\n\t\treturn manager.addResource(serialized);\n\t}\n\n\tdeserialize(target: number, manager: EShapeResourceManagerDeserialization): void {\n\t\tconst resources = manager.resources;\n\t\tif (0 <= target && target < resources.length) {\n\t\t\tconst parsed = manager.getStroke(target);\n\t\t\tif (parsed != null) {\n\t\t\t\tthis.set(\n\t\t\t\t\t!!parsed[0],\n\t\t\t\t\tparsed[1],\n\t\t\t\t\tparsed[2],\n\t\t\t\t\tparsed[3],\n\t\t\t\t\tparsed[4],\n\t\t\t\t\tparsed[5],\n\t\t\t\t\tparsed[6]\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tconst deserialized = JSON.parse(resources[target]);\n\t\t\t\tmanager.setStroke(target, deserialized);\n\t\t\t\tthis.set(\n\t\t\t\t\t!!deserialized[0],\n\t\t\t\t\tdeserialized[1],\n\t\t\t\t\tdeserialized[2],\n\t\t\t\t\tdeserialized[3],\n\t\t\t\t\tdeserialized[4],\n\t\t\t\t\tdeserialized[5],\n\t\t\t\t\tdeserialized[6]\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeResourceManagerDeserialization } from \"./e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"./e-shape-resource-manager-serialization\";\nimport { EShapeDataValueRange, EShapeDataValueRangeLike } from \"./e-shape-data-value-range\";\n\nexport const EShapeDataValueOrder = {\n\tASCENDING: 0,\n\tDESCENDING: 1\n} as const;\n\nexport type EShapeDataValueOrder = typeof EShapeDataValueOrder[keyof typeof EShapeDataValueOrder];\n\nexport interface EShapeDataValueLike {\n\tid: string;\n\tinitial: string;\n\tformat: string;\n\trange: EShapeDataValueRangeLike;\n\tcapacity: number;\n\torder: EShapeDataValueOrder;\n}\n\nexport interface EShapeDataValueParent {\n\tisChanged: boolean;\n}\n\nexport interface EShapeDataValue extends EShapeDataValueLike {\n\tvalue: unknown;\n\treadonly nvalue: number;\n\ttime: number;\n\n\tvalues: unknown[];\n\ttimes: number[];\n\n\trange: EShapeDataValueRange;\n\tparent?: EShapeDataValueParent;\n\n\tformatter?: (value: unknown) => unknown;\n\n\tclear(): void;\n\tremove(index: number): void;\n\tremoveAll(indices: number[]): void;\n\tcopy(target: EShapeDataValue): void;\n\tisEquals(target: EShapeDataValue): boolean;\n\tserialize(manager: EShapeResourceManagerSerialization): number;\n\tdeserialize(target: number, manager: EShapeResourceManagerDeserialization): void;\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeResourceManagerDeserialization } from \"./e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"./e-shape-resource-manager-serialization\";\n\nconst FROM = 1;\nconst TO = 2;\n\nexport const EShapeDataValueRangeType = {\n\tNONE: 0,\n\tFROM,\n\tTO,\n\tFROM_TO: FROM | TO\n} as const;\n\nexport type EShapeDataValueRangeType = number;\n\nexport interface EShapeDataValueRangeLike {\n\ttype: EShapeDataValueRangeType;\n\tfrom: number;\n\tto: number;\n}\n\nexport interface EShapeDataValueRangeParent {\n\tisChanged: boolean;\n}\n\nexport interface EShapeDataValueRange extends EShapeDataValueRangeLike {\n\tparent?: EShapeDataValueRangeParent;\n\n\tset(from?: number | null, to?: number | null): boolean;\n\tnormalize(value: number): number;\n\tisEquals(target: EShapeDataValueRangeLike): boolean;\n\tcopy(target: EShapeDataValueRangeLike): void;\n\ttoObject(): EShapeDataValueRangeLike;\n\tserialize(manager: EShapeResourceManagerSerialization): number;\n\tdeserialize(target: number, manager: EShapeResourceManagerDeserialization): void;\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport {\n\tEShapeDataValueRange,\n\tEShapeDataValueRangeLike,\n\tEShapeDataValueRangeParent,\n\tEShapeDataValueRangeType\n} from \"../e-shape-data-value-range\";\n\nexport class EShapeDataValueRangeImpl implements EShapeDataValueRange {\n\tprotected _type: EShapeDataValueRangeType;\n\tprotected _from: number;\n\tprotected _to: number;\n\tparent?: EShapeDataValueRangeParent;\n\n\tconstructor() {\n\t\tthis._type = EShapeDataValueRangeType.NONE;\n\t\tthis._from = 0;\n\t\tthis._to = 1;\n\t}\n\n\tget type(): EShapeDataValueRangeType {\n\t\treturn this._type;\n\t}\n\n\tset type(type: EShapeDataValueRangeType) {\n\t\tif (this._type !== type) {\n\t\t\tthis._type = type;\n\t\t\tconst parent = this.parent;\n\t\t\tif (parent != null) {\n\t\t\t\tparent.isChanged = true;\n\t\t\t}\n\t\t}\n\t}\n\n\tget from(): number {\n\t\treturn this._from;\n\t}\n\n\tset from(from: number) {\n\t\tif (this._from !== from) {\n\t\t\tthis._from = from;\n\t\t\tconst parent = this.parent;\n\t\t\tif (parent != null) {\n\t\t\t\tparent.isChanged = true;\n\t\t\t}\n\t\t}\n\t}\n\n\tget to(): number {\n\t\treturn this._to;\n\t}\n\n\tset to(to: number) {\n\t\tif (this._to !== to) {\n\t\t\tthis._to = to;\n\t\t\tconst parent = this.parent;\n\t\t\tif (parent != null) {\n\t\t\t\tparent.isChanged = true;\n\t\t\t}\n\t\t}\n\t}\n\n\tset(from?: number | null, to?: number | null): boolean {\n\t\tlet result = false;\n\t\tif (from !== undefined && to !== undefined) {\n\t\t\tif (from !== null && to !== null) {\n\t\t\t\tconst type =\n\t\t\t\t\tthis._type | EShapeDataValueRangeType.FROM | EShapeDataValueRangeType.TO;\n\t\t\t\tif (this._type !== type || this._from !== from || this._to !== to) {\n\t\t\t\t\tthis._type = type;\n\t\t\t\t\tthis._from = from;\n\t\t\t\t\tthis._to = to;\n\t\t\t\t\tresult = true;\n\t\t\t\t}\n\t\t\t} else if (from !== null) {\n\t\t\t\tconst type =\n\t\t\t\t\t(this._type | EShapeDataValueRangeType.FROM) & ~EShapeDataValueRangeType.TO;\n\t\t\t\tif (this._type !== type || this._from !== from) {\n\t\t\t\t\tthis._type = type;\n\t\t\t\t\tthis._from = from;\n\t\t\t\t\tresult = true;\n\t\t\t\t}\n\t\t\t} else if (to !== null) {\n\t\t\t\tconst type =\n\t\t\t\t\t(this._type | EShapeDataValueRangeType.TO) & ~EShapeDataValueRangeType.FROM;\n\t\t\t\tif (this._type !== type || this._from !== from) {\n\t\t\t\t\tthis._type = type;\n\t\t\t\t\tthis._to = to;\n\t\t\t\t\tresult = true;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst type =\n\t\t\t\t\tthis._type & ~(EShapeDataValueRangeType.TO | EShapeDataValueRangeType.FROM);\n\t\t\t\tif (this._type !== type) {\n\t\t\t\t\tthis._type = type;\n\t\t\t\t\tresult = true;\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (from !== undefined) {\n\t\t\tif (from !== null) {\n\t\t\t\tconst type = this._type | EShapeDataValueRangeType.FROM;\n\t\t\t\tif (this._type !== type || this._from !== from) {\n\t\t\t\t\tthis._type = type;\n\t\t\t\t\tthis._from = from;\n\t\t\t\t\tresult = true;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst type = this._type & ~EShapeDataValueRangeType.FROM;\n\t\t\t\tif (this._type !== type) {\n\t\t\t\t\tthis._type = type;\n\t\t\t\t\tresult = true;\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (to !== undefined) {\n\t\t\tif (to !== null) {\n\t\t\t\tconst type = this._type | EShapeDataValueRangeType.TO;\n\t\t\t\tif (this._type !== type || this._to !== to) {\n\t\t\t\t\tthis._type = type;\n\t\t\t\t\tthis._to = to;\n\t\t\t\t\tresult = true;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst type = this._type & ~EShapeDataValueRangeType.TO;\n\t\t\t\tif (this._type !== type) {\n\t\t\t\t\tthis._type = type;\n\t\t\t\t\tresult = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (result) {\n\t\t\tconst parent = this.parent;\n\t\t\tif (parent != null) {\n\t\t\t\tparent.isChanged = true;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tnormalize(value: number): number {\n\t\tconst type = this._type;\n\t\tconst from = this._from;\n\t\tconst to = this._to;\n\t\tswitch (type) {\n\t\t\tcase EShapeDataValueRangeType.FROM_TO:\n\t\t\t\treturn (value - from) / (to - from);\n\t\t\tcase EShapeDataValueRangeType.FROM:\n\t\t\t\treturn value - from;\n\t\t\tcase EShapeDataValueRangeType.TO:\n\t\t\t\treturn to - value;\n\t\t\tcase EShapeDataValueRangeType.NONE:\n\t\t\tdefault:\n\t\t\t\treturn value;\n\t\t}\n\t}\n\n\tisEquals(target: EShapeDataValueRangeLike): boolean {\n\t\treturn this._type === target.type && this._from === target.from && this._to === target.to;\n\t}\n\n\tcopy(target: EShapeDataValueRangeLike): this {\n\t\treturn this.copy_(target.type, target.from, target.to);\n\t}\n\n\tprotected copy_(type: EShapeDataValueRangeType, from: number, to: number): this {\n\t\tlet isChanged = false;\n\n\t\tif (this._type !== type) {\n\t\t\tthis._type = type;\n\t\t\tisChanged = true;\n\t\t}\n\n\t\tif (this._from !== from) {\n\t\t\tthis._from = from;\n\t\t\tisChanged = true;\n\t\t}\n\n\t\tif (this._to !== to) {\n\t\t\tthis._to = to;\n\t\t\tisChanged = true;\n\t\t}\n\n\t\tif (isChanged) {\n\t\t\tconst parent = this.parent;\n\t\t\tif (parent != null) {\n\t\t\t\tparent.isChanged = true;\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t}\n\n\ttoObject(): EShapeDataValueRangeLike {\n\t\treturn {\n\t\t\ttype: this.type,\n\t\t\tfrom: this.from,\n\t\t\tto: this.to\n\t\t};\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\tconst serialized = `[${this._type},${this._from},${this._to}]`;\n\t\treturn manager.addResource(serialized);\n\t}\n\n\tdeserialize(target: number, manager: EShapeResourceManagerDeserialization): void {\n\t\tconst resources = manager.resources;\n\t\tif (0 <= target && target < resources.length) {\n\t\t\tconst parsed = manager.getRange(target);\n\t\t\tif (parsed != null) {\n\t\t\t\tthis.copy_(parsed[0], parsed[1], parsed[2]);\n\t\t\t} else {\n\t\t\t\tconst deserialized = JSON.parse(resources[target]);\n\t\t\t\tmanager.setRange(target, deserialized);\n\t\t\t\tthis.copy_(deserialized[0], deserialized[1], deserialized[2]);\n\t\t\t}\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDiagramSerializedDataValue } from \"../../d-diagram-serialized\";\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport {\n\tEShapeDataValue,\n\tEShapeDataValueOrder,\n\tEShapeDataValueParent\n} from \"../e-shape-data-value\";\nimport { EShapeDataValueRange } from \"../e-shape-data-value-range\";\nimport { EShapeDataValueRangeImpl } from \"./e-shape-data-value-range-impl\";\n\nconst INDEX_COMPARATOR = (a: number, b: number): number => {\n\treturn a - b;\n};\n\nexport class EShapeDataValueImpl implements EShapeDataValue {\n\tid: string;\n\tinitial: string;\n\tformat: string;\n\trange: EShapeDataValueRange;\n\tprotected _value: unknown;\n\tprotected _time: number;\n\n\tprotected _values: unknown[] | undefined;\n\tprotected _times: number[] | undefined;\n\tprotected _capacity: number;\n\tprotected _order: EShapeDataValueOrder;\n\n\tprotected _parent?: EShapeDataValueParent;\n\n\tformatter?: (value: unknown) => unknown;\n\n\tconstructor() {\n\t\tthis.id = \"\";\n\t\tthis.initial = \"\";\n\t\tthis.format = \"\";\n\t\tthis.range = new EShapeDataValueRangeImpl();\n\t\tthis._value = 0;\n\t\tthis._time = 0;\n\t\tthis._capacity = 0;\n\t\tthis._order = EShapeDataValueOrder.ASCENDING;\n\t}\n\n\tget parent(): EShapeDataValueParent | undefined {\n\t\treturn this._parent;\n\t}\n\n\tset parent(parent: EShapeDataValueParent | undefined) {\n\t\tif (this._parent !== parent) {\n\t\t\tthis._parent = parent;\n\t\t\tthis.range.parent = parent;\n\t\t}\n\t}\n\n\tget value(): unknown {\n\t\treturn this._value;\n\t}\n\n\tset value(newValue: unknown) {\n\t\tconst formatter = this.formatter;\n\t\tif (formatter != null) {\n\t\t\tnewValue = formatter(newValue);\n\t\t}\n\n\t\tconst capacity = this._capacity;\n\t\tif (capacity <= 0) {\n\t\t\tif (this._value !== newValue) {\n\t\t\t\tthis._value = newValue;\n\t\t\t\tconst parent = this.parent;\n\t\t\t\tif (parent != null) {\n\t\t\t\t\tparent.isChanged = true;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tlet values = this._values;\n\t\t\tif (values == null) {\n\t\t\t\tvalues = [];\n\t\t\t\tthis._values = values;\n\t\t\t}\n\n\t\t\t// Update the value\n\t\t\tthis._value = newValue;\n\n\t\t\t// Update the values\n\t\t\tconst order = this._order;\n\t\t\tif (order === EShapeDataValueOrder.ASCENDING) {\n\t\t\t\tvalues.push(newValue);\n\t\t\t} else {\n\t\t\t\tvalues.unshift(newValue);\n\t\t\t}\n\n\t\t\t// Remove the unnecessary values\n\t\t\tconst count = values.length - capacity;\n\t\t\tif (0 < count) {\n\t\t\t\tif (order === EShapeDataValueOrder.ASCENDING) {\n\t\t\t\t\tfor (let i = 0; i < count; ++i) {\n\t\t\t\t\t\tvalues.shift();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tvalues.length = capacity;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Tell the parent it's changed\n\t\t\tconst parent = this.parent;\n\t\t\tif (parent != null) {\n\t\t\t\tparent.isChanged = true;\n\t\t\t}\n\t\t}\n\t}\n\n\tget nvalue(): number {\n\t\treturn this.range.normalize(this._value as number);\n\t}\n\n\tget values(): unknown[] {\n\t\tlet result = this._values;\n\t\tif (result == null) {\n\t\t\tresult = [];\n\t\t\tthis._values = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tset values(newValues: unknown[]) {\n\t\tif (0 < newValues.length) {\n\t\t\tconst capacity = this._capacity;\n\t\t\tif (capacity <= 0) {\n\t\t\t\tlet newValue = newValues[newValues.length - 1];\n\t\t\t\tconst formatter = this.formatter;\n\t\t\t\tif (formatter != null) {\n\t\t\t\t\tnewValue = formatter(newValue);\n\t\t\t\t}\n\t\t\t\tif (this._value !== newValue) {\n\t\t\t\t\tthis._value = newValue;\n\t\t\t\t\tconst parent = this.parent;\n\t\t\t\t\tif (parent != null) {\n\t\t\t\t\t\tparent.isChanged = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlet values = this._values;\n\t\t\t\tif (values == null) {\n\t\t\t\t\tvalues = [];\n\t\t\t\t\tthis._values = values;\n\t\t\t\t}\n\n\t\t\t\tconst order = this._order;\n\t\t\t\tconst formatter = this.formatter;\n\t\t\t\tif (formatter != null) {\n\t\t\t\t\t// Update the value\n\t\t\t\t\tthis._value = formatter(newValues[newValues.length - 1]);\n\n\t\t\t\t\t// Update the values\n\t\t\t\t\tif (order === EShapeDataValueOrder.ASCENDING) {\n\t\t\t\t\t\tfor (let i = 0, imax = newValues.length; i < imax; ++i) {\n\t\t\t\t\t\t\tvalues.push(formatter(newValues[i]));\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfor (let i = 0, imax = newValues.length; i < imax; ++i) {\n\t\t\t\t\t\t\tvalues.unshift(formatter(newValues[i]));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// Update the value\n\t\t\t\t\tthis._value = newValues[newValues.length - 1];\n\n\t\t\t\t\t// Update the values\n\t\t\t\t\tif (order === EShapeDataValueOrder.ASCENDING) {\n\t\t\t\t\t\tfor (let i = 0, imax = newValues.length; i < imax; ++i) {\n\t\t\t\t\t\t\tvalues.push(newValues[i]);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfor (let i = 0, imax = newValues.length; i < imax; ++i) {\n\t\t\t\t\t\t\tvalues.unshift(newValues[i]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Remove the unnecessary values\n\t\t\t\tconst count = values.length - capacity;\n\t\t\t\tif (0 < count) {\n\t\t\t\t\tif (order === EShapeDataValueOrder.ASCENDING) {\n\t\t\t\t\t\tfor (let i = 0; i < count; ++i) {\n\t\t\t\t\t\t\tvalues.shift();\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvalues.length = capacity;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Tell the parent it's changed\n\t\t\t\tconst parent = this.parent;\n\t\t\t\tif (parent != null) {\n\t\t\t\t\tparent.isChanged = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tget time(): number {\n\t\treturn this._time;\n\t}\n\n\tset time(newTime: number) {\n\t\tconst capacity = this._capacity;\n\t\tif (capacity <= 0) {\n\t\t\tif (this._time !== newTime) {\n\t\t\t\tthis._time = newTime;\n\t\t\t\tconst parent = this.parent;\n\t\t\t\tif (parent != null) {\n\t\t\t\t\tparent.isChanged = true;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\t// Update the times\n\t\t\tlet times = this._times;\n\t\t\tif (times == null) {\n\t\t\t\ttimes = [];\n\t\t\t\tthis._times = times;\n\t\t\t}\n\n\t\t\t// Update the time\n\t\t\tthis._time = newTime;\n\n\t\t\t// Update the times\n\t\t\tconst order = this._order;\n\t\t\tif (order === EShapeDataValueOrder.ASCENDING) {\n\t\t\t\ttimes.push(newTime);\n\t\t\t} else {\n\t\t\t\ttimes.unshift(newTime);\n\t\t\t}\n\n\t\t\t// Remove the unnecessary times\n\t\t\tconst count = times.length - capacity;\n\t\t\tif (0 < count) {\n\t\t\t\tif (order === EShapeDataValueOrder.ASCENDING) {\n\t\t\t\t\tfor (let i = 0; i < count; ++i) {\n\t\t\t\t\t\ttimes.shift();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\ttimes.length = capacity;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Tell the parent it's changed\n\t\t\tconst parent = this.parent;\n\t\t\tif (parent != null) {\n\t\t\t\tparent.isChanged = true;\n\t\t\t}\n\t\t}\n\t}\n\n\tget times(): number[] {\n\t\tlet result = this._times;\n\t\tif (result == null) {\n\t\t\tresult = [];\n\t\t\tthis._times = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tset times(newTimes: number[]) {\n\t\tif (0 < newTimes.length) {\n\t\t\tconst capacity = this._capacity;\n\t\t\tif (capacity <= 0) {\n\t\t\t\tconst newTime = newTimes[newTimes.length - 1];\n\t\t\t\tif (this._time !== newTime) {\n\t\t\t\t\tthis._time = newTime;\n\t\t\t\t\tconst parent = this.parent;\n\t\t\t\t\tif (parent != null) {\n\t\t\t\t\t\tparent.isChanged = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Update the times\n\t\t\t\tlet times = this._times;\n\t\t\t\tif (times == null) {\n\t\t\t\t\ttimes = [];\n\t\t\t\t\tthis._times = times;\n\t\t\t\t}\n\n\t\t\t\t// Update the value\n\t\t\t\tthis._time = newTimes[newTimes.length - 1];\n\n\t\t\t\t//\n\t\t\t\tconst order = this._order;\n\t\t\t\tif (order === EShapeDataValueOrder.ASCENDING) {\n\t\t\t\t\tfor (let i = 0, imax = newTimes.length; i < imax; ++i) {\n\t\t\t\t\t\ttimes.push(newTimes[i]);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tfor (let i = 0, imax = newTimes.length; i < imax; ++i) {\n\t\t\t\t\t\ttimes.unshift(newTimes[i]);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t//\n\t\t\t\tconst count = times.length - capacity;\n\t\t\t\tif (0 < count) {\n\t\t\t\t\tif (order === EShapeDataValueOrder.ASCENDING) {\n\t\t\t\t\t\tfor (let i = 0; i < count; ++i) {\n\t\t\t\t\t\t\ttimes.shift();\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttimes.length = capacity;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Tell the parent it's changed\n\t\t\t\tconst parent = this.parent;\n\t\t\t\tif (parent != null) {\n\t\t\t\t\tparent.isChanged = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tget capacity(): number {\n\t\treturn this._capacity;\n\t}\n\n\tset capacity(capacity: number) {\n\t\tif (this._capacity < capacity) {\n\t\t\tthis._capacity = capacity;\n\t\t} else if (capacity < this._capacity) {\n\t\t\tthis._capacity = capacity;\n\n\t\t\tlet isChanged = false;\n\n\t\t\t// Values\n\t\t\tconst order = this._order;\n\t\t\tconst values = this._values;\n\t\t\tif (values != null) {\n\t\t\t\tconst count = values.length - capacity;\n\t\t\t\tif (0 < count) {\n\t\t\t\t\tif (order === EShapeDataValueOrder.ASCENDING) {\n\t\t\t\t\t\tfor (let i = 0; i < count; ++i) {\n\t\t\t\t\t\t\tvalues.shift();\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvalues.length = capacity;\n\t\t\t\t\t}\n\t\t\t\t\tisChanged = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Times\n\t\t\tconst times = this._times;\n\t\t\tif (times != null) {\n\t\t\t\tconst count = times.length - capacity;\n\t\t\t\tif (0 < count) {\n\t\t\t\t\tif (order === EShapeDataValueOrder.ASCENDING) {\n\t\t\t\t\t\tfor (let i = 0; i < count; ++i) {\n\t\t\t\t\t\t\ttimes.shift();\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttimes.length = capacity;\n\t\t\t\t\t}\n\t\t\t\t\tisChanged = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (isChanged) {\n\t\t\t\tconst parent = this.parent;\n\t\t\t\tif (parent != null) {\n\t\t\t\t\tparent.isChanged = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tget order(): EShapeDataValueOrder {\n\t\treturn this._order;\n\t}\n\n\tset order(order: EShapeDataValueOrder) {\n\t\tthis._order = order;\n\t}\n\n\tremove(index: number): void {\n\t\tlet isChanged = false;\n\n\t\t// Values\n\t\tconst values = this._values;\n\t\tif (values != null) {\n\t\t\tif (0 <= index && index < values.length) {\n\t\t\t\tvalues.splice(index, 1);\n\t\t\t\tisChanged = true;\n\t\t\t}\n\t\t}\n\n\t\t// Times\n\t\tconst times = this._times;\n\t\tif (times != null) {\n\t\t\tif (0 <= index && index < times.length) {\n\t\t\t\ttimes.splice(index, 1);\n\t\t\t\tisChanged = true;\n\t\t\t}\n\t\t}\n\n\t\tif (isChanged) {\n\t\t\tconst parent = this.parent;\n\t\t\tif (parent != null) {\n\t\t\t\tparent.isChanged = true;\n\t\t\t}\n\t\t}\n\t}\n\n\tremoveAll(indices: number[]): void {\n\t\tlet isChanged = false;\n\n\t\tconst values = this._values;\n\t\tconst times = this._times;\n\t\tconst sorted = indices.slice(0).sort(INDEX_COMPARATOR);\n\t\tif (values != null) {\n\t\t\tif (times != null) {\n\t\t\t\tfor (let i = sorted.length - 1; 0 <= i; --i) {\n\t\t\t\t\tconst index = sorted[i];\n\t\t\t\t\tif (0 <= index) {\n\t\t\t\t\t\tif (index < values.length) {\n\t\t\t\t\t\t\tvalues.splice(index, 1);\n\t\t\t\t\t\t\tisChanged = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (index < times.length) {\n\t\t\t\t\t\t\ttimes.splice(index, 1);\n\t\t\t\t\t\t\tisChanged = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (let i = sorted.length - 1; 0 <= i; --i) {\n\t\t\t\t\tconst index = sorted[i];\n\t\t\t\t\tif (0 <= index && index < values.length) {\n\t\t\t\t\t\tvalues.splice(index, 1);\n\t\t\t\t\t\tisChanged = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tif (times != null) {\n\t\t\t\tfor (let i = sorted.length - 1; 0 <= i; --i) {\n\t\t\t\t\tconst index = sorted[i];\n\t\t\t\t\tif (0 <= index && index < times.length) {\n\t\t\t\t\t\ttimes.splice(index, 1);\n\t\t\t\t\t\tisChanged = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (isChanged) {\n\t\t\tconst parent = this.parent;\n\t\t\tif (parent != null) {\n\t\t\t\tparent.isChanged = true;\n\t\t\t}\n\t\t}\n\t}\n\n\tclear(): void {\n\t\tlet isChanged = false;\n\n\t\t// Values\n\t\tconst values = this._values;\n\t\tif (values != null) {\n\t\t\tvalues.length = 0;\n\t\t\tisChanged = true;\n\t\t}\n\n\t\t// Times\n\t\tconst times = this._times;\n\t\tif (times != null) {\n\t\t\ttimes.length = 0;\n\t\t\tisChanged = true;\n\t\t}\n\n\t\t// Change flag\n\t\tif (isChanged) {\n\t\t\tconst parent = this.parent;\n\t\t\tif (parent != null) {\n\t\t\t\tparent.isChanged = true;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * This method does not copy the `#values` and `#times` for the performance.\n\t *\n\t * @param target a copy target\n\t */\n\tcopy(target: EShapeDataValue): this {\n\t\tthis.id = target.id;\n\t\tthis.initial = target.initial;\n\t\tthis.format = target.format;\n\t\tthis.formatter = target.formatter;\n\t\tthis.range.copy(target.range);\n\t\tthis._value = target.value;\n\t\tthis._time = target.time;\n\t\tthis._capacity = target.capacity;\n\t\treturn this;\n\t}\n\n\tisEquals(target: EShapeDataValue): boolean {\n\t\treturn (\n\t\t\tthis.id === target.id &&\n\t\t\tthis.initial === target.initial &&\n\t\t\tthis.formatter === target.formatter &&\n\t\t\tthis.range.isEquals(target.range)\n\t\t);\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\tconst idSerialized = manager.addData(this.id);\n\t\tconst initialSerialized = manager.addResource(this.initial);\n\t\tconst formatSerialized = manager.addResource(this.format.trim());\n\t\tconst rangeSerialized = this.range.serialize(manager);\n\t\treturn manager.addResource(\n\t\t\t`[${idSerialized},${initialSerialized},${formatSerialized},${rangeSerialized},${this._capacity},${this._order}]`\n\t\t);\n\t}\n\n\tdeserialize(target: number, manager: EShapeResourceManagerDeserialization): this {\n\t\tconst resources = manager.resources;\n\t\tif (0 <= target && target < resources.length) {\n\t\t\tlet parsed = manager.getDataValue(target);\n\t\t\tif (parsed == null) {\n\t\t\t\tparsed = JSON.parse(resources[target]) as DDiagramSerializedDataValue;\n\t\t\t\tmanager.setDataValue(target, parsed);\n\t\t\t}\n\t\t\tthis.id = manager.data[parsed[0]] || \"\";\n\t\t\tthis.initial = resources[parsed[1]] || \"\";\n\t\t\tthis.format = resources[parsed[2]] || \"\";\n\t\t\tthis.range.deserialize(parsed[3], manager);\n\t\t\tthis._capacity = parsed[4];\n\t\t\tthis._order = parsed[5];\n\t\t}\n\n\t\treturn this;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShapeTextAlign, EShapeTextAlignLike } from \"../e-shape-text-align\";\nimport { EShapeTextAlignHorizontal } from \"../e-shape-text-align-horizontal\";\nimport { EShapeTextAlignVertical } from \"../e-shape-text-align-vertical\";\nimport { EShapeTextAlignImplParent } from \"./e-shape-text-align-impl-parent\";\n\nexport class EShapeTextAlignImpl implements EShapeTextAlign {\n\tprotected _parent: EShapeTextAlignImplParent;\n\tprotected _horizontal: EShapeTextAlignHorizontal;\n\tprotected _vertical: EShapeTextAlignVertical;\n\n\tconstructor(\n\t\tparent: EShapeTextAlignImplParent,\n\t\thorizontal: EShapeTextAlignHorizontal,\n\t\tvertical: EShapeTextAlignVertical\n\t) {\n\t\tthis._parent = parent;\n\t\tthis._horizontal = horizontal;\n\t\tthis._vertical = vertical;\n\t}\n\n\tget horizontal(): EShapeTextAlignHorizontal {\n\t\treturn this._horizontal;\n\t}\n\n\tset horizontal(horizontal: EShapeTextAlignHorizontal) {\n\t\tif (this._horizontal !== horizontal) {\n\t\t\tthis._horizontal = horizontal;\n\t\t\tthis._parent.updateUploaded();\n\t\t}\n\t}\n\n\tget vertical(): EShapeTextAlignVertical {\n\t\treturn this._vertical;\n\t}\n\n\tset vertical(vertical: EShapeTextAlignVertical) {\n\t\tif (this._vertical !== vertical) {\n\t\t\tthis._vertical = vertical;\n\t\t\tthis._parent.updateUploaded();\n\t\t}\n\t}\n\n\tcopy(target?: Partial<EShapeTextAlignLike>): void {\n\t\tif (target) {\n\t\t\tthis.set(target.horizontal, target.vertical);\n\t\t}\n\t}\n\n\tset(horizontal?: EShapeTextAlignHorizontal, vertical?: EShapeTextAlignVertical): void {\n\t\tlet isChanged = false;\n\n\t\tif (horizontal != null && this._horizontal !== horizontal) {\n\t\t\tthis._horizontal = horizontal;\n\t\t\tisChanged = true;\n\t\t}\n\n\t\tif (vertical != null && this._vertical !== vertical) {\n\t\t\tthis._vertical = vertical;\n\t\t\tisChanged = true;\n\t\t}\n\n\t\tif (isChanged) {\n\t\t\tthis._parent.updateUploaded();\n\t\t}\n\t}\n\n\ttoObject(): EShapeTextAlignLike {\n\t\treturn {\n\t\t\thorizontal: this._horizontal,\n\t\t\tvertical: this._vertical\n\t\t};\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\treturn manager.addResource(`[${this._horizontal},${this._vertical}]`);\n\t}\n\n\tdeserialize(target: number, manager: EShapeResourceManagerDeserialization): void {\n\t\tconst resources = manager.resources;\n\t\tif (0 <= target && target < resources.length) {\n\t\t\tconst parsed = manager.getAlign(target);\n\t\t\tif (parsed != null) {\n\t\t\t\tthis.set(parsed[0], parsed[1]);\n\t\t\t} else {\n\t\t\t\tconst deserialized = JSON.parse(resources[target]);\n\t\t\t\tmanager.setAlign(target, deserialized);\n\t\t\t\tthis.set(deserialized[0], deserialized[1]);\n\t\t\t}\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShapeTextOffset, EShapeTextOffsetLike } from \"../e-shape-text-offset\";\nimport { EShapeTextOffsetImplParent } from \"./e-shape-text-offset-impl-parent\";\n\nexport class EShapeTextOffsetImpl implements EShapeTextOffset {\n\tprotected _parent: EShapeTextOffsetImplParent;\n\tprotected _horizontal: number;\n\tprotected _vertical: number;\n\n\tconstructor(parent: EShapeTextOffsetImplParent, horizontal: number, vertical: number) {\n\t\tthis._parent = parent;\n\t\tthis._horizontal = horizontal;\n\t\tthis._vertical = vertical;\n\t}\n\n\tget horizontal(): number {\n\t\treturn this._horizontal;\n\t}\n\n\tset horizontal(horizontal: number) {\n\t\tif (this._horizontal !== horizontal) {\n\t\t\tthis._horizontal = horizontal;\n\t\t\tthis._parent.updateUploaded();\n\t\t}\n\t}\n\n\tget vertical(): number {\n\t\treturn this._vertical;\n\t}\n\n\tset vertical(vertical: number) {\n\t\tif (this._vertical !== vertical) {\n\t\t\tthis._vertical = vertical;\n\t\t\tthis._parent.updateUploaded();\n\t\t}\n\t}\n\n\tcopy(target?: Partial<EShapeTextOffsetLike>): void {\n\t\tif (target) {\n\t\t\tthis.set(target.horizontal, target.vertical);\n\t\t}\n\t}\n\n\tset(horizontal?: number, vertical?: number): void {\n\t\tlet isChanged = false;\n\n\t\tif (horizontal != null && this._horizontal !== horizontal) {\n\t\t\tthis._horizontal = horizontal;\n\t\t\tisChanged = true;\n\t\t}\n\n\t\tif (vertical != null && this._vertical !== vertical) {\n\t\t\tthis._vertical = vertical;\n\t\t\tisChanged = true;\n\t\t}\n\n\t\tif (isChanged) {\n\t\t\tthis._parent.updateUploaded();\n\t\t}\n\t}\n\n\ttoObject(): EShapeTextOffsetLike {\n\t\treturn {\n\t\t\thorizontal: this._horizontal,\n\t\t\tvertical: this._vertical\n\t\t};\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\treturn manager.addResource(`[${this._horizontal},${this._vertical}]`);\n\t}\n\n\tdeserialize(target: number, manager: EShapeResourceManagerDeserialization): void {\n\t\tconst resources = manager.resources;\n\t\tif (0 <= target && target < resources.length) {\n\t\t\tconst parsed = manager.getMargin(target);\n\t\t\tif (parsed != null) {\n\t\t\t\tthis.set(parsed[0], parsed[1]);\n\t\t\t} else {\n\t\t\t\tconst deserialized = JSON.parse(resources[target]);\n\t\t\t\tmanager.setMargin(target, deserialized);\n\t\t\t\tthis.set(deserialized[0], deserialized[1]);\n\t\t\t}\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShapeTextOutline, EShapeTextOutlineLike } from \"../e-shape-text-outline\";\nimport { EShapeTextOutlineImplParent } from \"./e-shape-text-outline-impl-parent\";\n\nexport class EShapeTextOutlineImpl implements EShapeTextOutline {\n\tprotected _parent: EShapeTextOutlineImplParent;\n\tprotected _enable: boolean;\n\tprotected _color: number;\n\tprotected _alpha: number;\n\tprotected _width: number;\n\n\tconstructor(\n\t\tparent: EShapeTextOutlineImplParent,\n\t\tenable: boolean,\n\t\tcolor: number,\n\t\talpha: number,\n\t\twidth: number\n\t) {\n\t\tthis._parent = parent;\n\t\tthis._enable = enable;\n\t\tthis._color = color;\n\t\tthis._alpha = alpha;\n\t\tthis._width = width;\n\t}\n\n\tget enable(): boolean {\n\t\treturn this._enable;\n\t}\n\n\tset enable(enable: boolean) {\n\t\tif (this._enable !== enable) {\n\t\t\tthis._enable = enable;\n\t\t\tthis._parent.updateUploaded();\n\t\t}\n\t}\n\n\tget color(): number {\n\t\treturn this._color;\n\t}\n\n\tset color(color: number) {\n\t\tif (this._color !== color) {\n\t\t\tthis._color = color;\n\t\t\tthis._parent.updateUploaded();\n\t\t}\n\t}\n\n\tget alpha(): number {\n\t\treturn this._alpha;\n\t}\n\n\tset alpha(alpha: number) {\n\t\tif (this._alpha !== alpha) {\n\t\t\tthis._alpha = alpha;\n\t\t\tthis._parent.updateUploaded();\n\t\t}\n\t}\n\n\tget width(): number {\n\t\treturn this._width;\n\t}\n\n\tset width(width: number) {\n\t\tif (this._width !== width) {\n\t\t\tthis._width = width;\n\t\t\tthis._parent.updateUploaded();\n\t\t}\n\t}\n\n\tcopy(target?: Partial<EShapeTextOutlineLike>): void {\n\t\tif (target) {\n\t\t\tthis.set(target.enable, target.color, target.alpha, target.width);\n\t\t}\n\t}\n\n\tset(enable?: boolean, color?: number, alpha?: number, width?: number): void {\n\t\tlet isChanged = false;\n\n\t\tif (enable !== undefined && this._enable !== enable) {\n\t\t\tthis._enable = enable;\n\t\t\tisChanged = true;\n\t\t}\n\n\t\tif (color !== undefined && this._color !== color) {\n\t\t\tthis._color = color;\n\t\t\tisChanged = true;\n\t\t}\n\n\t\tif (alpha !== undefined && this._alpha !== alpha) {\n\t\t\tthis._alpha = alpha;\n\t\t\tisChanged = true;\n\t\t}\n\n\t\tif (width !== undefined && this._width !== width) {\n\t\t\tthis._width = width;\n\t\t\tisChanged = true;\n\t\t}\n\n\t\tif (isChanged) {\n\t\t\tthis._parent.updateUploaded();\n\t\t}\n\t}\n\n\tclone(): EShapeTextOutline {\n\t\treturn new EShapeTextOutlineImpl(\n\t\t\tthis._parent,\n\t\t\tthis._enable,\n\t\t\tthis._color,\n\t\t\tthis._alpha,\n\t\t\tthis._width\n\t\t);\n\t}\n\n\ttoObject(): EShapeTextOutlineLike {\n\t\treturn {\n\t\t\tenable: this._enable,\n\t\t\tcolor: this._color,\n\t\t\talpha: this._alpha,\n\t\t\twidth: this._width\n\t\t};\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\tconst serialized = `[${this._enable ? 1 : 0},${this._color},${this._alpha},${this._width}]`;\n\t\treturn manager.addResource(serialized);\n\t}\n\n\tdeserialize(target: number, manager: EShapeResourceManagerDeserialization): void {\n\t\tconst resources = manager.resources;\n\t\tif (0 <= target && target < resources.length) {\n\t\t\tconst parsed = manager.getTextOutline(target);\n\t\t\tif (parsed != null) {\n\t\t\t\tthis.set(!!parsed[0], parsed[1], parsed[2], parsed[3]);\n\t\t\t} else {\n\t\t\t\tconst deserialized = JSON.parse(resources[target]);\n\t\t\t\tmanager.setTextOutline(target, deserialized);\n\t\t\t\tthis.set(!!deserialized[0], deserialized[1], deserialized[2], deserialized[3]);\n\t\t\t}\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Texture } from \"pixi.js\";\nimport { DDiagramSerializedText } from \"../../d-diagram-serialized\";\nimport { DeepPartial } from \"../../util/deep-partial\";\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport {\n\tEShapeText,\n\tEShapeTextAtlas,\n\tEShapeTextLike,\n\tEShapeTextStyle,\n\tEShapeTextWeight\n} from \"../e-shape-text\";\nimport { EShapeTextAlign } from \"../e-shape-text-align\";\nimport { EShapeTextAlignHorizontal } from \"../e-shape-text-align-horizontal\";\nimport { EShapeTextAlignVertical } from \"../e-shape-text-align-vertical\";\nimport { EShapeTextDirection } from \"../e-shape-text-direction\";\nimport { EShapeTextOffset } from \"../e-shape-text-offset\";\nimport { EShapeTextOutline } from \"../e-shape-text-outline\";\nimport { EShapeTextAlignImpl } from \"./e-shape-text-align-impl\";\nimport { EShapeTextImplParent } from \"./e-shape-text-impl-parent\";\nimport { EShapeTextOffsetImpl } from \"./e-shape-text-offset-impl\";\nimport { EShapeTextOutlineImpl } from \"./e-shape-text-outline-impl\";\n\nexport class EShapeTextImpl implements EShapeText {\n\tprotected _parent: EShapeTextImplParent;\n\tprotected _enable: boolean;\n\tprotected _value: string;\n\tprotected _family: string;\n\tprotected _color: number;\n\tprotected _alpha: number;\n\tprotected _size: number;\n\tprotected _weight: EShapeTextWeight;\n\treadonly align: EShapeTextAlign;\n\treadonly offset: EShapeTextOffset;\n\tprotected _style: EShapeTextStyle;\n\treadonly outline: EShapeTextOutline;\n\treadonly spacing: EShapeTextOffset;\n\tprotected _direction: EShapeTextDirection;\n\treadonly padding: EShapeTextOffset;\n\tprotected _clipping: boolean;\n\n\ttexture?: Texture; // Used for rendering and updated when rendered\n\tatlas?: EShapeTextAtlas; // Used for rendering and updated when rendered\n\tworld?: number[]; // Updated when rendered\n\n\tconstructor(\n\t\tparent: EShapeTextImplParent,\n\t\tvalue: string,\n\t\tcolor: number,\n\t\talpha: number,\n\t\tfamily: string,\n\t\tsize: number\n\t) {\n\t\tthis._parent = parent;\n\t\tthis._enable = true;\n\t\tthis._value = value;\n\t\tthis._color = color;\n\t\tthis._alpha = alpha;\n\t\tthis._family = family;\n\t\tthis._size = size;\n\t\tthis._weight = EShapeTextWeight.NORMAL;\n\t\tthis.align = new EShapeTextAlignImpl(\n\t\t\tparent,\n\t\t\tEShapeTextAlignHorizontal.CENTER,\n\t\t\tEShapeTextAlignVertical.MIDDLE\n\t\t);\n\t\tthis.offset = new EShapeTextOffsetImpl(parent, 0, 0);\n\t\tthis._style = EShapeTextStyle.NORMAL;\n\t\tthis.spacing = new EShapeTextOffsetImpl(parent, 0, 0);\n\t\tthis.outline = new EShapeTextOutlineImpl(parent, false, 0xffffff, 1.0, 0.5);\n\t\tthis._direction = EShapeTextDirection.LEFT_TO_RIGHT;\n\t\tthis.padding = new EShapeTextOffsetImpl(parent, 10, 10);\n\t\tthis._clipping = false;\n\t}\n\n\tget enable(): boolean {\n\t\treturn this._enable;\n\t}\n\n\tset enable(enable: boolean) {\n\t\tif (this._enable !== enable) {\n\t\t\tthis._enable = enable;\n\t\t\tthis._parent.updateUploaded();\n\t\t}\n\t}\n\n\tget value(): string {\n\t\treturn this._value;\n\t}\n\n\tset value(value: string) {\n\t\tif (this._value !== value) {\n\t\t\tthis._value = value;\n\n\t\t\t// Compatibility check\n\t\t\tconst parent = this._parent;\n\t\t\tconst uploaded = parent.uploaded;\n\t\t\tif (uploaded == null || !uploaded.isCompatible(parent)) {\n\t\t\t\tthis.atlas = undefined;\n\t\t\t\tparent.toDirty();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Character code check\n\t\t\tconst atlas = this.atlas;\n\t\t\tconst characters = atlas && atlas.characters;\n\t\t\tif (characters != null) {\n\t\t\t\tfor (let i = 0, imax = value.length; i < imax; ++i) {\n\t\t\t\t\tconst char = value[i];\n\t\t\t\t\tif (!(char in characters)) {\n\t\t\t\t\t\tthis.atlas = undefined;\n\t\t\t\t\t\tparent.toDirty();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.atlas = undefined;\n\t\t\t\tparent.toDirty();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Update uploaded\n\t\t\tparent.updateUploaded();\n\t\t}\n\t}\n\n\tget family(): string {\n\t\treturn this._family;\n\t}\n\n\tset family(family: string) {\n\t\tif (this._family !== family) {\n\t\t\tthis._family = family;\n\t\t\tthis._parent.toDirty();\n\t\t}\n\t}\n\n\tget color(): number {\n\t\treturn this._color;\n\t}\n\n\tset color(color: number) {\n\t\tif (this._color !== color) {\n\t\t\tthis._color = color;\n\t\t\tthis._parent.updateUploaded();\n\t\t}\n\t}\n\n\tget alpha(): number {\n\t\treturn this._alpha;\n\t}\n\n\tset alpha(alpha: number) {\n\t\tif (this._alpha !== alpha) {\n\t\t\tthis._alpha = alpha;\n\t\t\tthis._parent.updateUploaded();\n\t\t}\n\t}\n\n\tget size(): number {\n\t\treturn this._size;\n\t}\n\n\tset size(size: number) {\n\t\tif (this._size !== size) {\n\t\t\tthis._size = size;\n\t\t\tthis._parent.updateUploaded();\n\t\t}\n\t}\n\n\tget weight(): EShapeTextWeight {\n\t\treturn this._weight;\n\t}\n\n\tset weight(weight: EShapeTextWeight) {\n\t\tif (this._weight !== weight) {\n\t\t\tthis._weight = weight;\n\t\t\tthis._parent.updateUploaded();\n\t\t}\n\t}\n\n\tget style(): EShapeTextStyle {\n\t\treturn this._style;\n\t}\n\n\tset style(style: EShapeTextStyle) {\n\t\tif (this._style !== style) {\n\t\t\tthis._style = style;\n\t\t\tthis._parent.updateUploaded();\n\t\t}\n\t}\n\n\tget direction(): EShapeTextDirection {\n\t\treturn this._direction;\n\t}\n\n\tset direction(direction: EShapeTextDirection) {\n\t\tif (this._direction !== direction) {\n\t\t\tthis._direction = direction;\n\t\t\tthis._parent.updateUploaded();\n\t\t}\n\t}\n\n\tget clipping(): boolean {\n\t\treturn this._clipping;\n\t}\n\n\tset clipping(clipping: boolean) {\n\t\tif (this._clipping !== clipping) {\n\t\t\tthis._clipping = clipping;\n\t\t\tthis._parent.updateUploaded();\n\t\t}\n\t}\n\n\tcopy(target?: DeepPartial<EShapeTextLike>): this {\n\t\tif (target) {\n\t\t\tthis.set(\n\t\t\t\ttarget.value,\n\t\t\t\ttarget.color,\n\t\t\t\ttarget.alpha,\n\t\t\t\ttarget.family,\n\t\t\t\ttarget.size,\n\t\t\t\ttarget.weight,\n\t\t\t\ttarget.style,\n\t\t\t\ttarget.direction,\n\t\t\t\ttarget.clipping\n\t\t\t);\n\t\t\tthis.align.copy(target.align);\n\t\t\tthis.offset.copy(target.offset);\n\t\t\tthis.outline.copy(target.outline);\n\t\t\tthis.spacing.copy(target.spacing);\n\t\t\tthis.padding.copy(target.padding);\n\t\t}\n\t\treturn this;\n\t}\n\n\tset(\n\t\tvalue?: string,\n\t\tcolor?: number,\n\t\talpha?: number,\n\t\tfamily?: string,\n\t\tsize?: number,\n\t\tweight?: EShapeTextWeight,\n\t\tstyle?: EShapeTextStyle,\n\t\tdirection?: EShapeTextDirection,\n\t\tclipping?: boolean\n\t): this {\n\t\tlet isChangedDirty = false;\n\t\tlet isChangedUploaded = false;\n\n\t\tif (value != null && this._value !== value) {\n\t\t\tthis._value = value;\n\t\t\tisChangedDirty = true;\n\t\t}\n\n\t\tif (color != null && this._color !== color) {\n\t\t\tthis._color = color;\n\t\t\tisChangedUploaded = true;\n\t\t}\n\n\t\tif (alpha != null && this._alpha !== alpha) {\n\t\t\tthis._alpha = alpha;\n\t\t\tisChangedUploaded = true;\n\t\t}\n\n\t\tif (family != null && this._family !== family) {\n\t\t\tthis._family = family;\n\t\t\tisChangedDirty = true;\n\t\t}\n\n\t\tif (size != null && this._size !== size) {\n\t\t\tthis._size = size;\n\t\t\tisChangedUploaded = true;\n\t\t}\n\n\t\tif (weight != null && this._weight !== weight) {\n\t\t\tthis._weight = weight;\n\t\t\tisChangedUploaded = true;\n\t\t}\n\n\t\tif (style != null && this._style !== style) {\n\t\t\tthis._style = style;\n\t\t\tisChangedUploaded = true;\n\t\t}\n\n\t\tif (direction != null && this._direction !== direction) {\n\t\t\tthis._direction = direction;\n\t\t\tisChangedUploaded = true;\n\t\t}\n\n\t\tif (clipping != null && this._clipping !== clipping) {\n\t\t\tthis._clipping = clipping;\n\t\t\tisChangedUploaded = true;\n\t\t}\n\n\t\tif (isChangedDirty) {\n\t\t\tthis._parent.toDirty();\n\t\t} else if (isChangedUploaded) {\n\t\t\tthis._parent.updateUploaded();\n\t\t}\n\n\t\treturn this;\n\t}\n\n\ttoObject(): EShapeTextLike {\n\t\treturn {\n\t\t\tvalue: this._value,\n\t\t\tcolor: this._color,\n\t\t\talpha: this._alpha,\n\t\t\tfamily: this._family,\n\t\t\tsize: this._size,\n\t\t\tweight: this._weight,\n\t\t\talign: this.align.toObject(),\n\t\t\toffset: this.offset.toObject(),\n\t\t\tstyle: this._style,\n\t\t\toutline: this.outline.toObject(),\n\t\t\tdirection: this._direction,\n\t\t\tspacing: this.spacing.toObject(),\n\t\t\tpadding: this.padding.toObject(),\n\t\t\tclipping: this._clipping\n\t\t};\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\tconst valueId = manager.addResource(this._value);\n\t\tconst familyId = manager.addResource(this._family);\n\t\tconst alignId = this.align.serialize(manager);\n\t\tconst offsetId = this.offset.serialize(manager);\n\t\tconst outlineId = this.outline.serialize(manager);\n\t\tconst spacingId = this.spacing.serialize(manager);\n\t\tconst paddingId = this.padding.serialize(manager);\n\t\tconst serialized =\n\t\t\t`[${valueId},${this._color},${this._alpha},${familyId},${this._size},` +\n\t\t\t`${this._weight},${alignId},${offsetId},${this._style},${outlineId},` +\n\t\t\t`${spacingId},${this._direction},${paddingId},${this._clipping ? 1 : 0}]`;\n\t\treturn manager.addResource(serialized);\n\t}\n\n\tdeserialize(target: number, manager: EShapeResourceManagerDeserialization): void {\n\t\tconst resources = manager.resources;\n\t\tif (0 <= target && target < resources.length) {\n\t\t\tlet parsed = manager.getText(target);\n\t\t\tif (parsed == null) {\n\t\t\t\tparsed = JSON.parse(resources[target]) as DDiagramSerializedText;\n\t\t\t\tmanager.setText(target, parsed);\n\t\t\t}\n\t\t\tthis.set(\n\t\t\t\tresources[parsed[0]] || \"\",\n\t\t\t\tparsed[1],\n\t\t\t\tparsed[2],\n\t\t\t\tresources[parsed[3]] || \"auto\",\n\t\t\t\tparsed[4],\n\t\t\t\tparsed[5],\n\t\t\t\tparsed[8],\n\t\t\t\tparsed[11],\n\t\t\t\t!!parsed[13]\n\t\t\t);\n\t\t\tthis.align.deserialize(parsed[6], manager);\n\t\t\tthis.offset.deserialize(parsed[7], manager);\n\t\t\tthis.outline.deserialize(parsed[9], manager);\n\t\t\tthis.spacing.deserialize(parsed[10], manager);\n\t\t\tthis.padding.deserialize(parsed[12], manager);\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { IPoint, ObservablePoint } from \"pixi.js\";\nimport { EShape } from \"../e-shape\";\nimport { EShapeCorner } from \"../e-shape-corner\";\nimport { EShapeDefaults } from \"../e-shape-defaults\";\nimport { EShapeFill } from \"../e-shape-fill\";\nimport { EShapeGradientLike } from \"../e-shape-gradient\";\nimport { EShapeStroke } from \"../e-shape-stroke\";\nimport { EShapeData } from \"../e-shape-data\";\nimport { EShapeText } from \"../e-shape-text\";\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapeBase } from \"./e-shape-base\";\nimport { EShapeFillImpl } from \"./e-shape-fill-impl\";\nimport { EShapeStrokeImpl } from \"./e-shape-stroke-impl\";\nimport { EShapeDataImpl } from \"./e-shape-data-impl\";\nimport { EShapeTextImpl } from \"./e-shape-text-impl\";\n\nexport abstract class EShapePrimitive extends EShapeBase {\n\treadonly size: IPoint;\n\treadonly fill: EShapeFill;\n\treadonly stroke: EShapeStroke;\n\tprotected _radius: number;\n\tprotected _corner: EShapeCorner;\n\tprotected _image?: HTMLImageElement;\n\tgradient?: EShapeGradientLike;\n\treadonly text: EShapeText;\n\t/** @deprecated in favor of {@link data} */\n\treadonly tag: EShapeData;\n\treadonly data: EShapeData;\n\tcursor: string;\n\n\tconstructor(type: EShapeType) {\n\t\tsuper(type);\n\t\tthis.size = this.newSize();\n\t\tthis.fill = this.newFill();\n\t\tthis.stroke = this.newStroke();\n\t\tthis._radius = EShapeDefaults.RADIUS;\n\t\tthis._corner = EShapeCorner.ALL;\n\t\tconst data = new EShapeDataImpl();\n\t\tthis.data = data;\n\t\tthis.tag = data;\n\t\tthis.text = this.newText();\n\t\tthis.cursor = EShapeDefaults.CURSOR;\n\t}\n\n\tprotected newSize(): IPoint {\n\t\treturn new ObservablePoint(\n\t\t\t() => {\n\t\t\t\tthis.onSizeChange();\n\t\t\t},\n\t\t\tundefined,\n\t\t\tEShapeDefaults.SIZE_X,\n\t\t\tEShapeDefaults.SIZE_Y\n\t\t);\n\t}\n\n\tprotected newFill(): EShapeFill {\n\t\treturn new EShapeFillImpl(this, true, EShapeDefaults.FILL_COLOR, EShapeDefaults.FILL_ALPHA);\n\t}\n\n\tprotected newStroke(): EShapeStroke {\n\t\treturn new EShapeStrokeImpl(\n\t\t\tthis,\n\t\t\ttrue,\n\t\t\tEShapeDefaults.STROKE_COLOR,\n\t\t\tEShapeDefaults.STROKE_ALPHA,\n\t\t\tEShapeDefaults.STROKE_WIDTH,\n\t\t\tEShapeDefaults.STROKE_ALIGN,\n\t\t\tEShapeDefaults.STROKE_SIDE,\n\t\t\tEShapeDefaults.STROKE_STYLE\n\t\t);\n\t}\n\n\tprotected newText(): EShapeText {\n\t\treturn new EShapeTextImpl(\n\t\t\tthis,\n\t\t\tEShapeDefaults.TEXT_VALUE,\n\t\t\tEShapeDefaults.TEXT_COLOR,\n\t\t\tEShapeDefaults.TEXT_ALPHA,\n\t\t\tEShapeDefaults.TEXT_FAMILY,\n\t\t\tEShapeDefaults.TEXT_SIZE\n\t\t);\n\t}\n\n\tabstract clone(): EShape;\n\n\tget corner(): number {\n\t\treturn this._corner;\n\t}\n\n\tset corner(corner: number) {\n\t\tif (this._corner !== corner) {\n\t\t\tthis._corner = corner;\n\t\t\tthis.updateUploaded();\n\t\t}\n\t}\n\n\tget radius(): number {\n\t\treturn this._radius;\n\t}\n\n\tset radius(radius: number) {\n\t\tif (this._radius !== radius) {\n\t\t\tthis._radius = radius;\n\t\t\tthis.updateUploaded();\n\t\t}\n\t}\n\n\tget image(): HTMLImageElement | undefined {\n\t\treturn this._image;\n\t}\n\n\tset image(image: HTMLImageElement | undefined) {\n\t\tif (this._image !== image) {\n\t\t\tif (image != null) {\n\t\t\t\tthis._image = image;\n\t\t\t\tthis.imageSrc = image.src;\n\t\t\t} else {\n\t\t\t\tthis._image = undefined;\n\t\t\t\tthis.imageSrc = undefined;\n\t\t\t}\n\t\t\tconst parent = this.parent;\n\t\t\tif (parent != null) {\n\t\t\t\tparent.toDirty();\n\t\t\t}\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\n\nexport const hitTestCircle = (\n\tshape: EShape,\n\tx: number,\n\ty: number,\n\tax: number,\n\tay: number,\n\tsw: number,\n\tss: number\n): boolean => {\n\tconst fill = shape.fill;\n\tif (fill.enable) {\n\t\tconst x2 = x * x;\n\t\tconst y2 = y * y;\n\t\tconst ax2 = ax * ax;\n\t\tconst ay2 = ay * ay;\n\t\tif (x2 * ay2 + y2 * ax2 <= ax2 * ay2) {\n\t\t\treturn true;\n\t\t}\n\t} else {\n\t\tif (0 < sw) {\n\t\t\tconst s = sw * ss;\n\t\t\tconst x2 = x * x;\n\t\t\tconst y2 = y * y;\n\t\t\tconst wx = Math.max(0.0, ax - s);\n\t\t\tconst wy = Math.max(0.0, ay - s);\n\t\t\tconst wx2 = wx * wx;\n\t\t\tconst wy2 = wy * wy;\n\t\t\tif (wx2 * wy2 <= x2 * wy2 + y2 * wx2) {\n\t\t\t\tconst ax2 = ax * ax;\n\t\t\t\tconst ay2 = ay * ay;\n\t\t\t\tif (x2 * ay2 + y2 * ax2 <= ax2 * ay2) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn false;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nconst TOP = 1;\nconst RIGHT = 2;\nconst BOTTOM = 4;\nconst LEFT = 8;\n\nexport const EShapeStrokeSide = {\n\tNONE: 0,\n\tTOP,\n\tRIGHT,\n\tBOTTOM,\n\tLEFT,\n\tTOP_OR_LEFT: TOP | LEFT,\n\tTOP_OR_RIGHT: TOP | RIGHT,\n\tBOTTOM_OR_LEFT: BOTTOM | LEFT,\n\tBOTTOM_OR_RIGHT: BOTTOM | RIGHT,\n\tALL: TOP | RIGHT | BOTTOM | LEFT\n} as const;\n\nexport type EShapeStrokeSide = typeof EShapeStrokeSide[keyof typeof EShapeStrokeSide];\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeStrokeSide } from \"../e-shape-stroke-side\";\nimport { hitTestBBox } from \"./hit-test-bbox\";\n\nexport const hitTestRectangle = (\n\tshape: EShape,\n\tx: number,\n\ty: number,\n\tax: number,\n\tay: number,\n\tsw: number,\n\tss: number\n): boolean => {\n\tif (hitTestBBox(x, y, ax, ay)) {\n\t\tconst fill = shape.fill;\n\t\tif (fill.enable) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\tconst strokeSide = shape.stroke.side;\n\t\t\tif (0 < sw && strokeSide !== EShapeStrokeSide.NONE) {\n\t\t\t\tconst s = sw * ss;\n\t\t\t\tconst wx = Math.max(0.0, ax - s);\n\t\t\t\tconst wy = Math.max(0.0, ay - s);\n\t\t\t\tif (!hitTestBBox(x, y, wx, wy)) {\n\t\t\t\t\tif (strokeSide === EShapeStrokeSide.ALL) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (x <= -wx) {\n\t\t\t\t\t\t\tif (y <= -wy) {\n\t\t\t\t\t\t\t\treturn !!(strokeSide & EShapeStrokeSide.TOP_OR_LEFT);\n\t\t\t\t\t\t\t} else if (+wy <= y) {\n\t\t\t\t\t\t\t\treturn !!(strokeSide & EShapeStrokeSide.BOTTOM_OR_LEFT);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\treturn !!(strokeSide & EShapeStrokeSide.LEFT);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (+wx <= x) {\n\t\t\t\t\t\t\tif (y <= -wy) {\n\t\t\t\t\t\t\t\treturn !!(strokeSide & EShapeStrokeSide.TOP_OR_RIGHT);\n\t\t\t\t\t\t\t} else if (+wy <= y) {\n\t\t\t\t\t\t\t\treturn !!(strokeSide & EShapeStrokeSide.BOTTOM_OR_RIGHT);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\treturn !!(strokeSide & EShapeStrokeSide.RIGHT);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (y <= -wy) {\n\t\t\t\t\t\t\t\treturn !!(strokeSide & EShapeStrokeSide.TOP);\n\t\t\t\t\t\t\t} else if (+wy <= y) {\n\t\t\t\t\t\t\t\treturn !!(strokeSide & EShapeStrokeSide.BOTTOM);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn false;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\n\nexport const hitTestTriangleFilled = (\n\tx: number,\n\ty: number,\n\ta: number,\n\tay1: number,\n\tay2: number\n): boolean => {\n\t// a = 2 * ay / ax\n\t// y = + a * x + ay1\n\t// y = - a * x + ay1\n\t// y = ay2;\n\treturn +a * x + ay1 - y <= 0 && -a * x + ay1 - y <= 0 && y <= ay2;\n};\n\nexport const hitTestTriangle = (\n\tshape: EShape,\n\tx: number,\n\ty: number,\n\tax: number,\n\tay: number,\n\tsw: number,\n\tss: number\n): boolean => {\n\tconst a = (2 * ay) / ax;\n\tconst fill = shape.fill;\n\tif (fill.enable) {\n\t\tif (hitTestTriangleFilled(x, y, a, -ay, +ay)) {\n\t\t\treturn true;\n\t\t}\n\t} else {\n\t\tif (0 < sw) {\n\t\t\tconst s = sw * ss;\n\t\t\tif (hitTestTriangleFilled(x, y, a, -ay, +ay)) {\n\t\t\t\tconst az = Math.sqrt(ax * ax + 4 * ay * ay);\n\t\t\t\tconst aw = (2 * ax * ay) / (ax + az);\n\n\t\t\t\tconst cy = ay - aw;\n\t\t\t\tconst ay1 = cy + ((-ay - cy) * Math.max(0.0, aw - s)) / aw;\n\t\t\t\tconst ay2 = ay - s;\n\t\t\t\tif (!hitTestTriangleFilled(x, y, a, ay1, ay2)) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn false;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const toThresholdDefault = (size: number, scale: number, offset: number): number => {\n\treturn 0.5 * (offset + size * scale);\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapePoints } from \"../e-shape-points\";\nimport { EShapePointsMarker } from \"../e-shape-points-marker\";\nimport { EShapePointsMarkerType } from \"../e-shape-points-marker-type\";\nimport { EShapeBaseHitTestData } from \"./e-shape-base-hit-test-data\";\nimport { EShapeLineBaseHitPart } from \"./e-shape-line-base-hit-part\";\nimport { EShapeLineBasePoints } from \"./e-shape-line-base-points\";\nimport { EShapeLineBasePointsHitTester } from \"./e-shape-line-base-points-hit-tester\";\nimport { EShapeLineBasePointsHitTesterToRange } from \"./e-shape-line-base-points-hit-tester-to-range\";\nimport { EShapeLineBasePointsHitTesterToThreshold } from \"./e-shape-line-base-points-hit-tester-to-threshold\";\nimport { EShapePrimitive } from \"./e-shape-primitive\";\nimport { hitTestCircle } from \"./hit-test-circle\";\nimport { hitTestRectangle } from \"./hit-test-rectangle\";\nimport { hitTestTriangle } from \"./hit-test-triangle\";\nimport { toThresholdDefault } from \"./to-threshold-default\";\n\nexport abstract class EShapeLineBase extends EShapePrimitive {\n\tprotected declare _points: EShapeLineBasePoints;\n\tabstract clone(): EShapeLineBase;\n\n\tprotected getHitTestSize(result: EShapeBaseHitTestData): EShapeBaseHitTestData {\n\t\tconst formatted = this._points.formatted;\n\t\tif (\"boundary\" in formatted) {\n\t\t\tconst boundary = formatted.boundary;\n\t\t\tresult.width = Math.max(Math.abs(boundary[0]), Math.abs(boundary[2]));\n\t\t\tresult.height = Math.max(Math.abs(boundary[1]), Math.abs(boundary[3]));\n\t\t} else {\n\t\t\tsuper.getHitTestSize(result);\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected toMarkerSize(points: EShapePoints): number {\n\t\tlet result = 0;\n\t\tconst marker = points.getMarker();\n\t\tif (marker) {\n\t\t\tconst head = marker.head;\n\t\t\tif (head.type !== EShapePointsMarkerType.NONE) {\n\t\t\t\tconst size = head.size;\n\t\t\t\tresult = Math.max(result, Math.max(Math.abs(size.x), Math.abs(size.y)) * 2);\n\t\t\t}\n\n\t\t\tconst tail = marker.tail;\n\t\t\tif (tail.type !== EShapePointsMarkerType.NONE) {\n\t\t\t\tconst size = tail.size;\n\t\t\t\tresult = Math.max(result, Math.max(Math.abs(size.x), Math.abs(size.y)) * 2);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected containsAbsMarker(\n\t\tmarker: EShapePointsMarker,\n\t\tx: number,\n\t\ty: number,\n\t\tsw: number,\n\t\tss: number,\n\t\tsa: number\n\t): boolean {\n\t\tconst type = marker.type;\n\t\tif (type !== EShapePointsMarkerType.NONE) {\n\t\t\tconst transform = marker.transform;\n\t\t\tconst a = transform.a;\n\t\t\tconst b = transform.b;\n\t\t\tconst c = transform.c;\n\t\t\tconst d = transform.d;\n\t\t\tconst tx = transform.tx;\n\t\t\tconst ty = transform.ty;\n\t\t\tconst id = 1 / (a * d - c * b);\n\t\t\tconst lx = (d * x - c * y + ty * c - tx * d) * id;\n\t\t\tconst ly = (a * y - b * x - ty * a + tx * b) * id;\n\n\t\t\tconst size = marker.size;\n\t\t\tlet sx = 0.5 * size.x;\n\t\t\tlet sy = 0.5 * size.y;\n\t\t\tif (sx < 0) {\n\t\t\t\tsx = -sx;\n\t\t\t\tx = -x;\n\t\t\t}\n\t\t\tif (sy < 0) {\n\t\t\t\tsy = -sy;\n\t\t\t\ty = -y;\n\t\t\t}\n\n\t\t\tconst s = sw * ss * sa;\n\t\t\tsx += s;\n\t\t\tsy += s;\n\n\t\t\tswitch (type) {\n\t\t\t\tcase EShapePointsMarkerType.CIRCLE:\n\t\t\t\t\treturn hitTestCircle(this, lx, ly, sx, sy, sw, ss);\n\t\t\t\tcase EShapePointsMarkerType.TRIANGLE:\n\t\t\t\t\treturn hitTestTriangle(this, lx, ly, sx, sy, sw, ss);\n\t\t\t\tcase EShapePointsMarkerType.RECTANGLE:\n\t\t\t\t\treturn hitTestRectangle(this, lx, ly, sx, sy, sw, ss);\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tcontainsAbs(\n\t\tx: number,\n\t\ty: number,\n\t\tax: number,\n\t\tay: number,\n\t\tsw: number,\n\t\tss: number,\n\t\tsa: number\n\t): boolean {\n\t\tconst points = this._points;\n\t\tconst threshold = toThresholdDefault(sw, ss, 0);\n\t\tconst margin = threshold + this.toMarkerSize(points);\n\t\tif (this.containsAbsBBox(x, y, ax + margin, ay + margin)) {\n\t\t\tconst marker = points.getMarker();\n\t\t\tif (marker) {\n\t\t\t\tif (this.containsAbsMarker(marker.head, x, y, sw, ss, sa)) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\tif (this.containsAbsMarker(marker.tail, x, y, sw, ss, sa)) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst tester = this.calcHitPointAbsHitTester;\n\t\t\treturn points.calcHitPointAbs(x, y, ax, ay, threshold, null, tester, null);\n\t\t}\n\t\treturn false;\n\t}\n\n\tcalcHitPart(x: number, y: number): EShapeLineBaseHitPart {\n\t\tconst data = this.toHitTestData(x, y);\n\t\tconst sw = data.strokeWidth;\n\t\tconst ss = data.strokeScale;\n\t\tconst threshold = toThresholdDefault(sw, ss, 0);\n\t\tconst points = this._points;\n\t\tconst margin = threshold + this.toMarkerSize(points);\n\t\tconst dx = data.x;\n\t\tconst dy = data.y;\n\t\tconst ax = data.width;\n\t\tconst ay = data.height;\n\t\tif (this.containsAbsBBox(dx, dy, ax + margin, ay + margin)) {\n\t\t\tconst marker = points.getMarker();\n\t\t\tif (marker) {\n\t\t\t\tconst sa = data.strokeAlign;\n\t\t\t\tif (this.containsAbsMarker(marker.head, dx, dy, sw, ss, sa)) {\n\t\t\t\t\treturn EShapeLineBaseHitPart.MARKER_HEAD;\n\t\t\t\t}\n\t\t\t\tif (this.containsAbsMarker(marker.tail, dx, dy, sw, ss, sa)) {\n\t\t\t\t\treturn EShapeLineBaseHitPart.MARKER_TAIL;\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst tester = this.calcHitPointAbsHitTester;\n\t\t\tif (points.calcHitPointAbs(dx, dy, ax, ay, threshold, null, tester, null)) {\n\t\t\t\treturn EShapeLineBaseHitPart.LINE;\n\t\t\t}\n\t\t}\n\t\tif (this.containsText(x, y)) {\n\t\t\treturn EShapeLineBaseHitPart.TEXT;\n\t\t}\n\t\tif (this.containsChildren(x, y)) {\n\t\t\treturn EShapeLineBaseHitPart.CHILDREN;\n\t\t}\n\t\treturn EShapeLineBaseHitPart.NONE;\n\t}\n\n\tcalcHitPoint<RESULT>(\n\t\tx: number,\n\t\ty: number,\n\t\ttoThreshold: EShapeLineBasePointsHitTesterToThreshold | null,\n\t\ttoRange: EShapeLineBasePointsHitTesterToRange | null,\n\t\ttester: EShapeLineBasePointsHitTester<RESULT>,\n\t\tresult: RESULT\n\t): boolean {\n\t\tconst points = this._points;\n\t\tconst data = this.toHitTestData(x, y);\n\t\tconst threshold = (toThreshold || toThresholdDefault)(\n\t\t\tdata.strokeWidth,\n\t\t\tdata.strokeScale,\n\t\t\t0\n\t\t);\n\t\tif (this.containsAbsBBox(data.x, data.y, data.width + threshold, data.height + threshold)) {\n\t\t\treturn points.calcHitPointAbs(\n\t\t\t\tdata.x,\n\t\t\t\tdata.y,\n\t\t\t\tdata.width,\n\t\t\t\tdata.height,\n\t\t\t\tthreshold,\n\t\t\t\ttoRange,\n\t\t\t\ttester,\n\t\t\t\tresult\n\t\t\t);\n\t\t}\n\t\treturn false;\n\t}\n\n\tprotected calcHitPointAbsHitTester(\n\t\tthis: unknown,\n\t\tx: number,\n\t\ty: number,\n\t\tp0x: number,\n\t\tp0y: number,\n\t\tp1x: number,\n\t\tp1y: number,\n\t\tindex: number,\n\t\tthreshold: number,\n\t\tresult: unknown\n\t): boolean {\n\t\t// (x, y) = p0 + (p1 - p0) * t where 0 <= t <= 1\n\t\t// d0 := p1 - p0\n\t\t// d1 := v - p0\n\t\t// (p0.x + d0.x * t - x)^2 + (p0.y + d0.y * t - y)^2\n\t\t// (d0.x t - d1.x)^2 + (d0.y t - d1.y)^2\n\t\t// (d0.x^2 + d0.y^2) t^2 - 2 (d0.x * d1.x + d0.y * d1.y) t + (d1.x^2 + d1.y^2)\n\t\t// a := dot( d0, d0 )\n\t\t// b := dot( d0, d1 )\n\t\t// c := dot( d1, d1 )\n\t\t// a t^2 - 2 b t + c = a (t - b / a)^2 + c - b * b / a\n\t\t// t0 = b / a  min = c - b * b / a\n\t\tconst d0x = p1x - p0x;\n\t\tconst d0y = p1y - p0y;\n\t\tconst d1x = x - p0x;\n\t\tconst d1y = y - p0y;\n\t\tconst a = d0x * d0x + d0y * d0y;\n\t\tconst b = d0x * d1x + d0y * d1y;\n\t\tconst c = d1x * d1x + d1y * d1y;\n\t\tif (0.0001 < a) {\n\t\t\tconst t = Math.max(0, Math.min(1, b / a));\n\t\t\tconst d = a * t * t - 2 * b * t + c;\n\t\t\tif (d < threshold * threshold) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapeBarPoints } from \"./e-shape-bar-points\";\nimport { EShapeLineBase } from \"./e-shape-line-base\";\n\nexport class EShapeBar extends EShapeLineBase {\n\tprotected declare _points: EShapeBarPoints;\n\n\tconstructor(type: EShapeType = EShapeType.BAR) {\n\t\tsuper(type);\n\t\tthis._points = new EShapeBarPoints(this);\n\t}\n\n\tget points(): EShapeBarPoints {\n\t\treturn this._points;\n\t}\n\n\tclone(): EShapeBar {\n\t\treturn new EShapeBar(this.type).copy(this);\n\t}\n\n\tcontainsAbsBBox(x: number, y: number, ax: number, ay: number): boolean {\n\t\tconst size = Math.max(0, this._points.size);\n\t\treturn super.containsAbsBBox(x, y, ax + size, ay + size);\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): DDiagramSerializedItem {\n\t\tconst result = super.serialize(manager);\n\t\tresult[15] = this._points.serialize(manager);\n\t\treturn result;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeBuffer } from \"../e-shape-buffer\";\nimport { EShapePointsStyle } from \"../e-shape-points-style\";\nimport {\n\tBAR_INDEX_COUNT,\n\tBAR_VERTEX_COUNT,\n\tbuildBarClipping,\n\tbuildBarIndex,\n\tbuildBarUv,\n\tbuildBarVertexStepAndColorFill\n} from \"./build-bar\";\nimport { BuilderBase } from \"./builder-base\";\nimport { toTexture, toTextureTransformId, toTextureUvs, toTransformLocalId } from \"./builders\";\nimport { EShapeBar } from \"./e-shape-bar\";\n\nexport class BuilderBar extends BuilderBase {\n\tprotected pointsId: number;\n\tprotected pointsStyle: EShapePointsStyle;\n\n\tconstructor(vertexOffset: number, indexOffset: number) {\n\t\tsuper(vertexOffset, indexOffset, BAR_VERTEX_COUNT, BAR_INDEX_COUNT);\n\t\tthis.pointsId = NaN;\n\t\tthis.pointsStyle = EShapePointsStyle.NONE;\n\t}\n\n\tinit(buffer: EShapeBuffer): void {\n\t\tconst voffset = this.vertexOffset;\n\t\tconst ioffset = this.indexOffset;\n\t\tbuffer.updateClippings();\n\t\tbuffer.updateIndices();\n\t\tbuildBarClipping(buffer.clippings, voffset);\n\t\tbuildBarIndex(buffer.indices, voffset, ioffset);\n\t}\n\n\tupdate(buffer: EShapeBuffer, shape: EShape): void {\n\t\tthis.updateVertexStepAndColorFill(buffer, shape);\n\t\tthis.updateColorStroke(buffer, shape);\n\t\tthis.updateUv(buffer, shape);\n\t}\n\n\tprotected updateVertexStepAndColorFill(buffer: EShapeBuffer, shape: EShape): void {\n\t\tif (shape instanceof EShapeBar) {\n\t\t\tconst size = shape.size;\n\t\t\tconst sizeX = size.x;\n\t\t\tconst sizeY = size.y;\n\t\t\tconst isSizeChanged = sizeX !== this.sizeX || sizeY !== this.sizeY;\n\n\t\t\tconst stroke = shape.stroke;\n\t\t\tconst strokeWidth = stroke.enable ? stroke.width : 0;\n\t\t\tconst strokeStyle = stroke.style;\n\t\t\tconst isStrokeWidthChanged =\n\t\t\t\tstrokeWidth !== this.strokeWidth || strokeStyle !== this.strokeStyle;\n\n\t\t\tconst transformLocalId = toTransformLocalId(shape);\n\t\t\tconst isTransformChanged = this.transformLocalId !== transformLocalId;\n\n\t\t\tconst points = shape.points;\n\t\t\tconst pointsId = points.id;\n\t\t\tconst isPointsIdChanged = pointsId !== this.pointsId;\n\n\t\t\tconst pointsStyle = points.style;\n\t\t\tconst isPointsStyleChanged = pointsStyle !== this.pointsStyle;\n\n\t\t\tif (\n\t\t\t\tisSizeChanged ||\n\t\t\t\tisTransformChanged ||\n\t\t\t\tisStrokeWidthChanged ||\n\t\t\t\tisPointsIdChanged ||\n\t\t\t\tisPointsStyleChanged\n\t\t\t) {\n\t\t\t\tthis.sizeX = sizeX;\n\t\t\t\tthis.sizeY = sizeY;\n\t\t\t\tthis.strokeWidth = strokeWidth;\n\t\t\t\tthis.strokeStyle = strokeStyle;\n\t\t\t\tthis.transformLocalId = transformLocalId;\n\t\t\t\tthis.pointsId = pointsId;\n\t\t\t\tthis.pointsStyle = pointsStyle;\n\n\t\t\t\tif (isPointsIdChanged) {\n\t\t\t\t\t// Invalidate the texture transform ID to update the UVs\n\t\t\t\t\tthis.textureTransformId = NaN;\n\t\t\t\t}\n\n\t\t\t\tbuffer.updateVertices();\n\t\t\t\tbuffer.updateSteps();\n\t\t\t\tbuffer.updateColorFills();\n\t\t\t\tbuildBarVertexStepAndColorFill(\n\t\t\t\t\tbuffer.vertices,\n\t\t\t\t\tbuffer.steps,\n\t\t\t\t\tbuffer.colorFills,\n\t\t\t\t\tthis.vertexOffset,\n\t\t\t\t\tpoints.values,\n\t\t\t\t\tpoints.size,\n\t\t\t\t\tstrokeWidth,\n\t\t\t\t\tstrokeStyle,\n\t\t\t\t\tshape.transform.internalTransform\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected updateUv(buffer: EShapeBuffer, shape: EShape): void {\n\t\tconst texture = toTexture(shape);\n\t\tconst textureTransformId = toTextureTransformId(texture);\n\t\tif (texture !== this.texture || textureTransformId !== this.textureTransformId) {\n\t\t\tthis.texture = texture;\n\t\t\tthis.textureTransformId = textureTransformId;\n\n\t\t\tbuffer.updateUvs();\n\t\t\tbuildBarUv(buffer.uvs, this.vertexOffset, toTextureUvs(texture));\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Texture } from \"pixi.js\";\nimport { EShape } from \"../e-shape\";\nimport { EShapeBuffer } from \"../e-shape-buffer\";\nimport { EShapeBufferUnitBuilder } from \"../e-shape-buffer-unit-builder\";\nimport { EShapeTextAtlas } from \"../e-shape-text\";\nimport { buildColor } from \"./build-color\";\nimport {\n\tbuildTextClipping,\n\tbuildTextIndex,\n\tbuildTextStep,\n\tbuildTextVertex,\n\tTEXT_VERTEX_COUNT,\n\ttoTextBufferCount\n} from \"./build-text\";\nimport { Builder } from \"./builder\";\nimport { toTextureTransformId, toTextureUvs, toTransformLocalId } from \"./builders\";\n\nexport class BuilderText implements Builder {\n\treadonly vertexOffset: number;\n\treadonly indexOffset: number;\n\treadonly vertexCount: number;\n\treadonly indexCount: number;\n\n\tprotected sizeX: number;\n\tprotected sizeY: number;\n\tprotected transformLocalId: number;\n\n\tprotected texture: Texture | null;\n\tprotected textureTransformId: number;\n\tprotected value: string;\n\tprotected family: string;\n\tprotected size: number;\n\tprotected color: number;\n\tprotected alpha: number;\n\tprotected weight: number;\n\tprotected style: number;\n\tprotected alignHorizontal: number;\n\tprotected alignVertical: number;\n\tprotected offsetHorizontal: number;\n\tprotected offsetVertical: number;\n\tprotected outlineWidth: number;\n\tprotected outlineColor: number;\n\tprotected outlineAlpha: number;\n\tprotected spacingHorizontal: number;\n\tprotected spacingVertical: number;\n\tprotected direction: number;\n\tprotected paddingHorizontal: number;\n\tprotected paddingVertical: number;\n\tprotected clipping: boolean;\n\n\tconstructor(\n\t\tvertexOffset: number,\n\t\tindexOffset: number,\n\t\tvertexCount: number,\n\t\tindexCount: number\n\t) {\n\t\tthis.vertexOffset = vertexOffset;\n\t\tthis.indexOffset = indexOffset;\n\t\tthis.vertexCount = vertexCount;\n\t\tthis.indexCount = indexCount;\n\n\t\tthis.sizeX = NaN;\n\t\tthis.sizeY = NaN;\n\n\t\tthis.transformLocalId = NaN;\n\n\t\tthis.size = NaN;\n\t\tthis.family = \"auto\";\n\t\tthis.value = \"\";\n\t\tthis.texture = null;\n\t\tthis.textureTransformId = NaN;\n\t\tthis.color = NaN;\n\t\tthis.alpha = NaN;\n\t\tthis.weight = NaN;\n\t\tthis.style = NaN;\n\t\tthis.alignHorizontal = NaN;\n\t\tthis.alignVertical = NaN;\n\t\tthis.offsetHorizontal = NaN;\n\t\tthis.offsetVertical = NaN;\n\t\tthis.outlineWidth = NaN;\n\t\tthis.outlineColor = NaN;\n\t\tthis.outlineAlpha = NaN;\n\t\tthis.spacingHorizontal = NaN;\n\t\tthis.spacingVertical = NaN;\n\t\tthis.direction = NaN;\n\t\tthis.paddingHorizontal = NaN;\n\t\tthis.paddingVertical = NaN;\n\t\tthis.clipping = false;\n\t}\n\n\tinit(buffer: EShapeBuffer): void {\n\t\tconst vcount = this.vertexCount;\n\t\tif (0 < vcount) {\n\t\t\t// Clippings\n\t\t\tconst voffset = this.vertexOffset;\n\t\t\tbuffer.updateClippings();\n\t\t\tbuildTextClipping(buffer.clippings, voffset, vcount);\n\n\t\t\t// Indices\n\t\t\tbuffer.updateIndices();\n\t\t\tbuildTextIndex(buffer.indices, voffset, this.indexOffset, this.indexCount);\n\t\t}\n\t}\n\n\tisCompatible(shape: EShape): boolean {\n\t\treturn toTextBufferCount(shape) * TEXT_VERTEX_COUNT === this.vertexCount;\n\t}\n\n\tupdate(buffer: EShapeBuffer, shape: EShape): void {\n\t\tconst vcount = this.vertexCount;\n\t\tif (0 < vcount) {\n\t\t\tconst textAtlas = shape.text.atlas;\n\t\t\tif (textAtlas != null) {\n\t\t\t\tthis.updateVertex(buffer, shape, textAtlas);\n\t\t\t\tthis.updateColorFill(buffer, shape);\n\t\t\t\tthis.updateColorStroke(buffer, shape);\n\t\t\t\tthis.updateStep(buffer, shape);\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected updateVertex(buffer: EShapeBuffer, shape: EShape, textAtlas: EShapeTextAtlas): void {\n\t\tconst size = shape.size;\n\t\tconst sizeX = size.x;\n\t\tconst sizeY = size.y;\n\t\tconst isSizeChanged = sizeX !== this.sizeX || sizeY !== this.sizeY;\n\n\t\tconst transformLocalId = toTransformLocalId(shape);\n\t\tconst isTransformChanged = this.transformLocalId !== transformLocalId;\n\n\t\tconst text = shape.text;\n\t\tconst textSize = text.size;\n\t\tconst textFamily = text.family;\n\t\tconst textValue = text.value;\n\t\tconst textStyle = text.style;\n\t\tconst textAlignHorizontal = text.align.horizontal;\n\t\tconst textAlignVertical = text.align.vertical;\n\t\tconst textOffsetHorizontal = text.offset.horizontal;\n\t\tconst textOffsetVertical = text.offset.vertical;\n\t\tconst textSpacingHorizontal = text.spacing.horizontal;\n\t\tconst textSpacingVertical = text.spacing.vertical;\n\t\tconst textDirection = text.direction;\n\t\tconst textPaddingHorizontal = text.padding.horizontal;\n\t\tconst textPaddingVertical = text.padding.vertical;\n\t\tconst textClipping = text.clipping;\n\t\tconst textTexture = text.texture || Texture.WHITE;\n\t\tconst textTextureTransformId = toTextureTransformId(textTexture);\n\n\t\tconst isCharChanged = textValue !== this.value || textFamily !== this.family;\n\t\tconst isCharSizeChanged = textSize !== this.size;\n\t\tconst isCharStyleChanged = textStyle !== this.style;\n\t\tconst isCharAlignChanged =\n\t\t\ttextAlignHorizontal !== this.alignHorizontal ||\n\t\t\ttextAlignVertical !== this.alignVertical;\n\t\tconst isCharOffsetChanged =\n\t\t\ttextOffsetHorizontal !== this.offsetHorizontal ||\n\t\t\ttextOffsetVertical !== this.offsetVertical;\n\t\tconst isCharSpacingChanged =\n\t\t\ttextSpacingHorizontal !== this.spacingHorizontal ||\n\t\t\ttextSpacingVertical !== this.spacingVertical ||\n\t\t\ttextPaddingHorizontal !== this.paddingHorizontal ||\n\t\t\ttextPaddingVertical !== this.paddingVertical;\n\t\tconst isCharDirectionChanged = textDirection !== this.direction;\n\t\tconst isClippingChanged = this.clipping !== textClipping;\n\t\tconst isTextureChanged =\n\t\t\ttextTexture !== this.texture || textTextureTransformId !== this.textureTransformId;\n\n\t\tif (\n\t\t\tisSizeChanged ||\n\t\t\tisTransformChanged ||\n\t\t\tisCharChanged ||\n\t\t\tisCharSizeChanged ||\n\t\t\tisCharStyleChanged ||\n\t\t\tisCharAlignChanged ||\n\t\t\tisCharOffsetChanged ||\n\t\t\tisCharSpacingChanged ||\n\t\t\tisCharDirectionChanged ||\n\t\t\tisClippingChanged ||\n\t\t\tisTextureChanged\n\t\t) {\n\t\t\tthis.size = textSize;\n\t\t\tthis.family = textFamily;\n\t\t\tthis.value = textValue;\n\t\t\tthis.style = textStyle;\n\t\t\tthis.alignHorizontal = textAlignHorizontal;\n\t\t\tthis.alignVertical = textAlignVertical;\n\t\t\tthis.offsetHorizontal = textOffsetHorizontal;\n\t\t\tthis.offsetVertical = textOffsetVertical;\n\t\t\tthis.spacingHorizontal = textSpacingHorizontal;\n\t\t\tthis.spacingVertical = textSpacingVertical;\n\t\t\tthis.direction = textDirection;\n\t\t\tthis.paddingHorizontal = textPaddingHorizontal;\n\t\t\tthis.paddingVertical = textPaddingVertical;\n\t\t\tthis.clipping = textClipping;\n\t\t\tthis.texture = textTexture;\n\t\t\tthis.textureTransformId = textTextureTransformId;\n\n\t\t\tif (isCharSizeChanged) {\n\t\t\t\t// Invalidate the text weight to update the text steps.\n\t\t\t\tthis.weight = NaN;\n\t\t\t}\n\n\t\t\t// Vertices & UVs\n\t\t\tbuffer.updateVertices();\n\t\t\tbuffer.updateUvs();\n\t\t\tconst shapeSize = shape.size;\n\t\t\tlet textWorld = text.world;\n\t\t\tif (textWorld == null) {\n\t\t\t\ttextWorld = [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0];\n\t\t\t\ttext.world = textWorld;\n\t\t\t}\n\t\t\tbuildTextVertex(\n\t\t\t\tbuffer.vertices,\n\t\t\t\tbuffer.uvs,\n\t\t\t\tthis.vertexOffset,\n\t\t\t\tthis.vertexCount,\n\t\t\t\t0,\n\t\t\t\t0,\n\t\t\t\tshapeSize.x,\n\t\t\t\tshapeSize.y,\n\t\t\t\ttextAtlas,\n\t\t\t\ttextSize,\n\t\t\t\ttextValue,\n\t\t\t\ttextStyle,\n\t\t\t\ttextAlignHorizontal,\n\t\t\t\ttextAlignVertical,\n\t\t\t\ttextOffsetHorizontal,\n\t\t\t\ttextOffsetVertical,\n\t\t\t\ttextSpacingHorizontal,\n\t\t\t\ttextSpacingVertical,\n\t\t\t\ttextDirection,\n\t\t\t\ttextPaddingHorizontal,\n\t\t\t\ttextPaddingVertical,\n\t\t\t\ttextClipping,\n\t\t\t\ttextWorld,\n\t\t\t\ttoTextureUvs(textTexture),\n\t\t\t\tshape.transform.internalTransform\n\t\t\t);\n\t\t}\n\t}\n\n\tprotected updateColorFill(buffer: EShapeBuffer, shape: EShape): void {\n\t\tconst text = shape.text;\n\t\tconst color = text.color;\n\t\tconst alpha = shape.visible && text.enable ? text.alpha : 0;\n\t\tif (color !== this.color || alpha !== this.alpha) {\n\t\t\tthis.color = color;\n\t\t\tthis.alpha = alpha;\n\t\t\tbuffer.updateColorFills();\n\n\t\t\tbuildColor(color, alpha, this.vertexOffset, this.vertexCount, buffer.colorFills);\n\t\t}\n\t}\n\n\tprotected updateColorStroke(buffer: EShapeBuffer, shape: EShape): void {\n\t\tconst text = shape.text;\n\t\tconst outline = text.outline;\n\t\tconst color = outline.color;\n\t\tconst alpha = shape.visible && text.enable ? outline.alpha : 0;\n\t\tif (color !== this.outlineColor || alpha !== this.outlineAlpha) {\n\t\t\tthis.outlineColor = color;\n\t\t\tthis.outlineAlpha = alpha;\n\t\t\tbuffer.updateColorStrokes();\n\n\t\t\tbuildColor(color, alpha, this.vertexOffset, this.vertexCount, buffer.colorStrokes);\n\t\t}\n\t}\n\n\tprotected updateStep(buffer: EShapeBuffer, shape: EShape): void {\n\t\tconst text = shape.text;\n\t\tconst textOutline = text.outline;\n\t\tconst textOutlineWidth = textOutline.enable ? textOutline.width : 0;\n\t\tconst textWeight = text.weight;\n\t\tif (textWeight !== this.weight || textOutlineWidth !== this.outlineWidth) {\n\t\t\tthis.weight = textWeight;\n\t\t\tthis.outlineWidth = textOutlineWidth;\n\n\t\t\tbuffer.updateSteps();\n\t\t\tbuildTextStep(\n\t\t\t\tbuffer.steps,\n\t\t\t\tthis.vertexOffset,\n\t\t\t\tthis.vertexCount,\n\t\t\t\ttext.atlas,\n\t\t\t\ttext.size,\n\t\t\t\ttextOutlineWidth,\n\t\t\t\ttextWeight\n\t\t\t);\n\t\t}\n\t}\n\n\tbuildUnit(builder: EShapeBufferUnitBuilder): void {\n\t\tif (0 < this.vertexCount) {\n\t\t\tconst textTexture = this.texture || Texture.WHITE;\n\t\t\tconst textBaseTexture = textTexture.baseTexture;\n\t\t\tif (textBaseTexture !== builder.baseTexture) {\n\t\t\t\tbuilder.baseTexture = textBaseTexture;\n\t\t\t\tbuilder.push(textTexture, this.indexOffset);\n\t\t\t}\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeBuffer } from \"../e-shape-buffer\";\nimport { EShapeUploaded, EShapeUploadedImpl } from \"../e-shape-uploaded\";\nimport { BAR_INDEX_COUNT, BAR_VERTEX_COUNT } from \"./build-bar\";\nimport { TEXT_INDEX_COUNT, TEXT_VERTEX_COUNT, toTextBufferCount } from \"./build-text\";\nimport { BuilderBar } from \"./builder-bar\";\nimport { BuilderText } from \"./builder-text\";\n\nexport const createBarUploaded = (\n\tbuffer: EShapeBuffer,\n\tshape: EShape,\n\tvoffset: number,\n\tioffset: number,\n\tantialiasWeight: number\n): EShapeUploaded | null => {\n\tconst tcount = toTextBufferCount(shape);\n\tconst tvcount = tcount * TEXT_VERTEX_COUNT;\n\tconst ticount = tcount * TEXT_INDEX_COUNT;\n\tconst vcount = BAR_VERTEX_COUNT + tvcount;\n\tconst icount = BAR_INDEX_COUNT + ticount;\n\tif (buffer.check(voffset, ioffset, vcount, icount)) {\n\t\treturn new EShapeUploadedImpl(buffer, voffset, ioffset, vcount, icount, [\n\t\t\tnew BuilderBar(voffset, ioffset),\n\t\t\tnew BuilderText(voffset + BAR_VERTEX_COUNT, ioffset + BAR_INDEX_COUNT, tvcount, ticount)\n\t\t]).init(shape);\n\t}\n\treturn null;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const isArray =\n\tArray.isArray ||\n\t((target: any): target is unknown[] => {\n\t\treturn Object.prototype.toString.call(target) === \"[object Array]\";\n\t});\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const isNumber = (target: unknown): target is number => {\n\treturn (\n\t\ttypeof target === \"number\" || Object.prototype.toString.call(target) === \"[object Number]\"\n\t);\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const toPadded = (str: string, length: number, c: string): string => {\n\tconst strLength = str.length;\n\tif (length < strLength) {\n\t\treturn str;\n\t}\n\tlet padding = \"\";\n\tfor (let i = 0, imax = length - strLength; i < imax; ++i) {\n\t\tpadding += c;\n\t}\n\treturn padding + str;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { toPadded } from \"./to-padded\";\n\nexport class UtilRgb {\n\tstatic toCode(color: number): string {\n\t\treturn toPadded(color.toString(16).toUpperCase(), 6, \"0\");\n\t}\n\n\tstatic fromCode(code: string): number | null {\n\t\tconst trimmed = code.trim().toLowerCase();\n\t\tif (trimmed.length === 6) {\n\t\t\tconst color = Number(`0x${trimmed}`);\n\t\t\tif (color === color) {\n\t\t\t\treturn color;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tstatic fromRgb(r: number, g: number, b: number): number {\n\t\treturn ((r * 0xff) << 16) | ((g * 0xff) << 8) | ((b * 0xff) | 0);\n\t}\n\n\tstatic blend(colorA: number, colorB: number, t: number): number {\n\t\tconst ar = (colorA >> 16) & 0xff;\n\t\tconst ag = (colorA >> 8) & 0xff;\n\t\tconst ab = (colorA | 0) & 0xff;\n\n\t\tconst br = (colorB >> 16) & 0xff;\n\t\tconst bg = (colorB >> 8) & 0xff;\n\t\tconst bb = (colorB | 0) & 0xff;\n\n\t\tconst w1 = Math.max(0, Math.min(1, t));\n\t\tconst w0 = 1 - w1;\n\t\tconst cr = Math.max(0, Math.min(0xff, ar * w0 + br * w1));\n\t\tconst cg = Math.max(0, Math.min(0xff, ag * w0 + bg * w1));\n\t\tconst cb = Math.max(0, Math.min(0xff, ab * w0 + bb * w1));\n\n\t\treturn (cr << 16) | (cg << 8) | (cb | 0);\n\t}\n\n\tstatic brighten(color: number, amount: number): number {\n\t\tif (0 <= amount) {\n\t\t\treturn this.blend(color, 0xffffff, amount);\n\t\t} else {\n\t\t\treturn this.blend(color, 0x000000, -amount);\n\t\t}\n\t}\n\n\tstatic darken(color: number, amount: number): number {\n\t\tif (0 <= amount) {\n\t\t\treturn this.blend(color, 0x000000, amount);\n\t\t} else {\n\t\t\treturn this.blend(color, 0xffffff, -amount);\n\t\t}\n\t}\n\n\t/**\n\t * Convertes the given color to a grayscale color.\n\t *\n\t * @param color a color to be converted\n\t * @returns a grayscale color\n\t * @see https://en.wikipedia.org/wiki/Grayscale\n\t */\n\tstatic toGrayscale(color: number): number {\n\t\tconst l = this.toLuma(color);\n\t\treturn (l << 16) | (l << 8) | l;\n\t}\n\n\t/**\n\t * Convertes the given color to a luma in the range [0, 255].\n\t *\n\t * @param color a color to be converted\n\t * @returns a luma in the range [0, 255]\n\t * @see https://en.wikipedia.org/wiki/Grayscale\n\t */\n\tstatic toLuma(color: number): number {\n\t\tconst r = (color >> 16) & 0xff;\n\t\tconst g = (color >> 8) & 0xff;\n\t\tconst b = (color | 0) & 0xff;\n\t\treturn (0.2126 * r + 0.7152 * g + 0.0722 * b) & 0xff;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DApplicationLayerLike } from \"../d-application-layer-like\";\nimport { DApplications } from \"../d-applications\";\nimport { DBase } from \"../d-base\";\nimport { DBaseStateSet } from \"../d-base-state-set\";\nimport { isString } from \"./is-string\";\n\nexport interface UtilKeyboardEventLayerPicker {\n\tpicked: DApplicationLayerLike | null;\n}\n\nexport interface UtilKeyboardEventShortcut {\n\talt: boolean;\n\tctrl: boolean;\n\tshift: boolean;\n\tkey: string;\n\twhich: number;\n\tevent?: string;\n}\n\nexport interface UtilKeyboardEventShortcutTarget {\n\tstate: DBaseStateSet;\n\temit(eventName: string): void;\n}\n\nconst setShortcutKeyAndWhich = (shortcut: UtilKeyboardEventShortcut): UtilKeyboardEventShortcut => {\n\tconst key = shortcut.key;\n\tif (key.length <= 1) {\n\t\tif (shortcut.shift) {\n\t\t\tshortcut.key = key.toUpperCase();\n\t\t}\n\t\tconst code = key.charCodeAt(0);\n\t\tif (97 <= code && code <= 122) {\n\t\t\t// a ... z\n\t\t\tshortcut.which = code - 32;\n\t\t} else {\n\t\t\tshortcut.which = code;\n\t\t}\n\t} else {\n\t\tswitch (key) {\n\t\t\tcase \"Enter\":\n\t\t\t\tshortcut.which = 13;\n\t\t\t\tbreak;\n\t\t\tcase \"Space\":\n\t\t\t\tshortcut.key = \" \";\n\t\t\t\tshortcut.which = 32;\n\t\t\t\tbreak;\n\t\t\tcase \"Escape\":\n\t\t\t\tshortcut.which = 27;\n\t\t\t\tbreak;\n\t\t\tcase \"F1\":\n\t\t\t\tshortcut.which = 112;\n\t\t\t\tbreak;\n\t\t\tcase \"F2\":\n\t\t\t\tshortcut.which = 113;\n\t\t\t\tbreak;\n\t\t\tcase \"F3\":\n\t\t\t\tshortcut.which = 114;\n\t\t\t\tbreak;\n\t\t\tcase \"F4\":\n\t\t\t\tshortcut.which = 115;\n\t\t\t\tbreak;\n\t\t\tcase \"F5\":\n\t\t\t\tshortcut.which = 116;\n\t\t\t\tbreak;\n\t\t\tcase \"F6\":\n\t\t\t\tshortcut.which = 117;\n\t\t\t\tbreak;\n\t\t\tcase \"F7\":\n\t\t\t\tshortcut.which = 118;\n\t\t\t\tbreak;\n\t\t\tcase \"F8\":\n\t\t\t\tshortcut.which = 119;\n\t\t\t\tbreak;\n\t\t\tcase \"F9\":\n\t\t\t\tshortcut.which = 120;\n\t\t\t\tbreak;\n\t\t\tcase \"F10\":\n\t\t\t\tshortcut.which = 121;\n\t\t\t\tbreak;\n\t\t\tcase \"F11\":\n\t\t\t\tshortcut.which = 122;\n\t\t\t\tbreak;\n\t\t\tcase \"F12\":\n\t\t\t\tshortcut.which = 123;\n\t\t\t\tbreak;\n\t\t\tcase \"CapsLock\":\n\t\t\t\tif (shortcut.shift) {\n\t\t\t\t\tshortcut.which = 20;\n\t\t\t\t} else {\n\t\t\t\t\tshortcut.which = 240;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase \"ArrowUp\":\n\t\t\t\tshortcut.which = 38;\n\t\t\t\tbreak;\n\t\t\tcase \"ArrowDown\":\n\t\t\t\tshortcut.which = 40;\n\t\t\t\tbreak;\n\t\t\tcase \"ArrowLeft\":\n\t\t\t\tshortcut.which = 37;\n\t\t\t\tbreak;\n\t\t\tcase \"ArrowRight\":\n\t\t\t\tshortcut.which = 39;\n\t\t\t\tbreak;\n\t\t\tcase \"Insert\":\n\t\t\t\tshortcut.which = 45;\n\t\t\t\tbreak;\n\t\t\tcase \"Delete\":\n\t\t\t\tshortcut.which = 46;\n\t\t\t\tbreak;\n\t\t\tcase \"PageUp\":\n\t\t\t\tshortcut.which = 33;\n\t\t\t\tbreak;\n\t\t\tcase \"PageDown\":\n\t\t\t\tshortcut.which = 34;\n\t\t\t\tbreak;\n\t\t\tcase \"Backspace\":\n\t\t\t\tshortcut.which = 8;\n\t\t\t\tbreak;\n\t\t\tcase \";\":\n\t\t\t\tshortcut.which = 187;\n\t\t\t\tbreak;\n\t\t\tcase \"Pause\":\n\t\t\t\tshortcut.which = 19;\n\t\t\t\tbreak;\n\t\t\tcase \"ScrollLock\":\n\t\t\t\tshortcut.which = 145;\n\t\t\t\tbreak;\n\t\t\tcase \"Tab\":\n\t\t\t\tshortcut.which = 9;\n\t\t\t\tbreak;\n\t\t}\n\t}\n\treturn shortcut;\n};\n\nexport class UtilKeyboardEvent {\n\tstatic isActivateKey(e: KeyboardEvent): boolean {\n\t\treturn e.key === \"Space\" || e.key === \"Enter\" || e.which === 32 || e.which === 13;\n\t}\n\n\tstatic isArrowUpKey(e: KeyboardEvent): boolean {\n\t\treturn e.key === \"ArrowUp\" || e.which === 38;\n\t}\n\n\tstatic isArrowDownKey(e: KeyboardEvent): boolean {\n\t\treturn e.key === \"ArrowDown\" || e.which === 40;\n\t}\n\n\tstatic isArrowLeftKey(e: KeyboardEvent): boolean {\n\t\treturn e.key === \"ArrowLeft\" || e.which === 37;\n\t}\n\n\tstatic isArrowRightKey(e: KeyboardEvent): boolean {\n\t\treturn e.key === \"ArrowRight\" || e.which === 39;\n\t}\n\n\tstatic isCancelKey(e: KeyboardEvent): boolean {\n\t\treturn e.key === \"Esc\" || e.which === 27;\n\t}\n\n\tstatic isFocusKey(e: KeyboardEvent): boolean {\n\t\treturn e.key === \"Tab\" || e.which === 9;\n\t}\n\n\tstatic isUndoKey(e: KeyboardEvent): boolean {\n\t\treturn e.ctrlKey && (e.key === \"z\" || e.which === 90);\n\t}\n\n\tstatic isRedoKey(e: KeyboardEvent): boolean {\n\t\treturn e.ctrlKey && (e.key === \"y\" || e.which === 89);\n\t}\n\n\tstatic isSaveKey(e: KeyboardEvent): boolean {\n\t\treturn e.ctrlKey && !e.shiftKey && (e.key === \"s\" || e.which === 83);\n\t}\n\n\tstatic isSaveAsKey(e: KeyboardEvent): boolean {\n\t\treturn e.ctrlKey && e.shiftKey && (e.key === \"S\" || e.which === 83);\n\t}\n\n\tstatic isDeleteKey(e: KeyboardEvent): boolean {\n\t\treturn e.key === \"Delete\" || e.which === 46;\n\t}\n\n\tstatic isSelectAllKey(e: KeyboardEvent): boolean {\n\t\treturn e.ctrlKey && !e.shiftKey && (e.key === \"a\" || e.which === 65);\n\t}\n\n\tstatic isOkKey(e: KeyboardEvent): boolean {\n\t\treturn e.key === \"Enter\" || e.which === 13;\n\t}\n\n\tstatic getFocusDirection(e: KeyboardEvent): boolean {\n\t\treturn e.shiftKey !== true;\n\t}\n\n\tstatic toShortcut(\n\t\texpressionOrShortcut: string | UtilKeyboardEventShortcut\n\t): UtilKeyboardEventShortcut {\n\t\tif (!isString(expressionOrShortcut)) {\n\t\t\treturn expressionOrShortcut;\n\t\t} else {\n\t\t\tconst expression = expressionOrShortcut;\n\t\t\tconst arrowIndex = expression.indexOf(\"->\");\n\t\t\tlet keyExpression: string;\n\t\t\tlet event: string | undefined;\n\t\t\tif (0 <= arrowIndex) {\n\t\t\t\tkeyExpression = expression.substring(0, arrowIndex).trim();\n\t\t\t\tevent = expression.substring(arrowIndex + 2).trim();\n\t\t\t} else {\n\t\t\t\tkeyExpression = expression.trim();\n\t\t\t}\n\t\t\tconst keys = keyExpression.toLowerCase().split(\"+\");\n\t\t\tconst alt: boolean = 0 <= keys.indexOf(\"alt\");\n\t\t\tconst ctrl: boolean = 0 <= keys.indexOf(\"ctrl\");\n\t\t\tconst shift: boolean = 0 <= keys.indexOf(\"shift\");\n\t\t\tconst key: string = keys[keys.length - 1];\n\t\t\treturn setShortcutKeyAndWhich({\n\t\t\t\talt,\n\t\t\t\tctrl,\n\t\t\t\tshift,\n\t\t\t\tkey,\n\t\t\t\twhich: 0,\n\t\t\t\tevent\n\t\t\t});\n\t\t}\n\t}\n\n\tstatic toString(shortcut: UtilKeyboardEventShortcut): string {\n\t\tconst parts = [];\n\t\tif (shortcut.ctrl) {\n\t\t\tparts.push(\"Ctrl\");\n\t\t}\n\t\tif (shortcut.shift) {\n\t\t\tparts.push(\"Shift\");\n\t\t}\n\t\tif (shortcut.alt) {\n\t\t\tparts.push(\"Alt\");\n\t\t}\n\t\tparts.push(shortcut.key.toUpperCase());\n\t\treturn parts.join(\"+\");\n\t}\n\n\tstatic on(\n\t\ttarget: UtilKeyboardEventShortcutTarget,\n\t\texpressionOrShortcut: string | UtilKeyboardEventShortcut,\n\t\thandler?: (e: KeyboardEvent) => void\n\t): void {\n\t\tconst shortcut = this.toShortcut(expressionOrShortcut);\n\t\tdocument.body.addEventListener(\"keydown\", (e: KeyboardEvent): void => {\n\t\t\tif (\n\t\t\t\te.altKey === shortcut.alt &&\n\t\t\t\te.ctrlKey === shortcut.ctrl &&\n\t\t\t\te.shiftKey === shortcut.shift &&\n\t\t\t\t(e.key === shortcut.key || e.which === shortcut.which)\n\t\t\t) {\n\t\t\t\tif (target.state.isActionable) {\n\t\t\t\t\tif (shortcut.event != null) {\n\t\t\t\t\t\ttarget.emit(shortcut.event);\n\t\t\t\t\t} else if (handler != null) {\n\t\t\t\t\t\thandler(e);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\te.preventDefault();\n\t\t\t}\n\t\t});\n\t}\n\n\tstatic moveFocusVertically(\n\t\te: KeyboardEvent,\n\t\ttarget: DBase,\n\t\tpicker?: UtilKeyboardEventLayerPicker\n\t): boolean {\n\t\tif (target.state.isActionable) {\n\t\t\tconst isBackward = UtilKeyboardEvent.isArrowUpKey(e);\n\t\t\tconst isForward = UtilKeyboardEvent.isArrowDownKey(e);\n\t\t\tif (isBackward || isForward) {\n\t\t\t\treturn this.moveFocus(isForward, target, picker);\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tstatic moveFocusHorizontally(\n\t\te: KeyboardEvent,\n\t\ttarget: DBase,\n\t\tpicker?: UtilKeyboardEventLayerPicker\n\t): boolean {\n\t\tif (target.state.isActionable) {\n\t\t\tconst isBackward = UtilKeyboardEvent.isArrowLeftKey(e);\n\t\t\tconst isForward = UtilKeyboardEvent.isArrowRightKey(e);\n\t\t\tif (isBackward || isForward) {\n\t\t\t\treturn this.moveFocus(isForward, target, picker);\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tstatic moveFocus(\n\t\tdirection: boolean,\n\t\ttarget: DBase,\n\t\tpicker?: UtilKeyboardEventLayerPicker\n\t): boolean {\n\t\tconst layer = picker?.picked ?? DApplications.getLayer(target);\n\t\tif (layer) {\n\t\t\tconst focusController = layer.getFocusController();\n\t\t\tconst focused = focusController.get();\n\t\t\tif (focused != null) {\n\t\t\t\tconst next = focusController.find(\n\t\t\t\t\tfocused,\n\t\t\t\t\tfalse,\n\t\t\t\t\tfocused.state.isFocusRoot || direction,\n\t\t\t\t\tdirection,\n\t\t\t\t\ttarget\n\t\t\t\t);\n\t\t\t\tif (next != null) {\n\t\t\t\t\tfocusController.focus(next);\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction, Point, Renderer } from \"pixi.js\";\nimport InteractionEvent = interaction.InteractionEvent;\nimport InteractionManager = interaction.InteractionManager;\nimport { DApplications } from \"../d-applications\";\nimport { UtilKeyboardEvent } from \"../util/util-keyboard-event\";\nimport { EShapeActionRuntime } from \"./action/e-shape-action-runtime\";\nimport { EShape } from \"./e-shape\";\nimport { EShapeFillLike } from \"./e-shape-fill\";\nimport { EShapeState } from \"./e-shape-state\";\nimport { EShapeStrokeLike } from \"./e-shape-stroke\";\nimport { EShapeTextLike } from \"./e-shape-text\";\nimport { DBaseState } from \"../d-base-state\";\nimport { DBaseStateSet } from \"../d-base-state-set\";\n\nconst POSITION_X = 1;\nconst POSITION_Y = 2;\nconst ROTATION = 4;\nconst COLOR_FILL = 8;\nconst COLOR_STROKE = 16;\nconst COLOR_TEXT = 32;\nconst COLOR_TEXT_OUTLINE = 64;\nconst VISIBILITY = 128;\nconst HEIGHT = 256;\nconst WIDTH = 512;\nconst TEXT = 1024;\nconst CURSOR = 2048;\n\nexport const EShapeRuntimeReset = {\n\tNONE: 0,\n\tPOSITION_X,\n\tPOSITION_Y,\n\tPOSITION: POSITION_X | POSITION_Y,\n\tROTATION,\n\tCOLOR_FILL,\n\tCOLOR_STROKE,\n\tCOLOR_FILL_AND_STROKE: COLOR_FILL | COLOR_STROKE,\n\tCOLOR_TEXT,\n\tCOLOR_TEXT_OUTLINE,\n\tCOLOR: COLOR_FILL | COLOR_STROKE | COLOR_TEXT | COLOR_TEXT_OUTLINE,\n\tVISIBILITY,\n\tHEIGHT,\n\tWIDTH,\n\tSIZE: HEIGHT | WIDTH,\n\tTEXT,\n\tCURSOR\n} as const;\n\nexport type EShapeRuntimeReset = typeof EShapeRuntimeReset[keyof typeof EShapeRuntimeReset];\n\nexport class EShapeRuntime {\n\tx: number;\n\ty: number;\n\tsize: Point;\n\trotation: number;\n\tactions: EShapeActionRuntime[];\n\tfill: EShapeFillLike;\n\tstroke: EShapeStrokeLike;\n\ttext: EShapeTextLike;\n\tcursor: string;\n\n\treset: EShapeRuntimeReset;\n\twritten: EShapeRuntimeReset;\n\n\teffect: number;\n\n\tisStateChanged: boolean;\n\tinteractive: boolean;\n\n\tconstructor(shape: EShape) {\n\t\tconst transform = shape.transform;\n\t\tconst position = transform.position;\n\t\tthis.x = position.x;\n\t\tthis.y = position.y;\n\t\tconst size = shape.size;\n\t\tthis.size = new Point(size.x, size.y);\n\t\tthis.rotation = transform.rotation;\n\t\tthis.actions = [];\n\t\tthis.fill = shape.fill.toObject();\n\t\tthis.stroke = shape.stroke.toObject();\n\t\tthis.text = shape.text.toObject();\n\t\tthis.cursor = shape.cursor;\n\t\tthis.reset = EShapeRuntimeReset.NONE;\n\t\tthis.written = EShapeRuntimeReset.NONE;\n\t\tthis.effect = NaN;\n\t\tthis.isStateChanged = false;\n\t\tthis.interactive = false;\n\t}\n\n\tinitialize(shape: EShape): void {\n\t\tshape.disallowUploadedUpdate();\n\t\tthis.onInitialize(shape);\n\t\tshape.allowUploadedUpdate();\n\t}\n\n\tonInitialize(shape: EShape): void {\n\t\tconst actions = this.actions;\n\t\tfor (let i = 0, imax = actions.length; i < imax; ++i) {\n\t\t\tactions[i].initialize(shape, this);\n\t\t}\n\t}\n\n\tisActionable(): boolean {\n\t\treturn 0 < this.actions.length;\n\t}\n\n\tonClick(shape: EShape, e: InteractionEvent | KeyboardEvent): void {\n\t\tconst state = shape.state;\n\t\tif (state.isActionable) {\n\t\t\tstate.isClicked = true;\n\t\t}\n\t}\n\n\tonDblClick(\n\t\tshape: EShape,\n\t\te: MouseEvent | TouchEvent,\n\t\tinteractionManager: InteractionManager\n\t): boolean {\n\t\tconst actions = this.actions;\n\t\tfor (let i = 0, imax = actions.length; i < imax; ++i) {\n\t\t\tactions[i].onDblClick(shape, this, e, interactionManager);\n\t\t}\n\t\treturn false;\n\t}\n\n\tonOver(shape: EShape, e: InteractionEvent): void {\n\t\tshape.state.isHovered = true;\n\t}\n\n\tonOut(shape: EShape, e: InteractionEvent): void {\n\t\tshape.state.isHovered = false;\n\t}\n\n\tonDown(shape: EShape, e: InteractionEvent | KeyboardEvent): void {\n\t\t// Actions\n\t\tconst actions = this.actions;\n\t\tfor (let i = 0, imax = actions.length; i < imax; ++i) {\n\t\t\tactions[i].onDowning(shape, this, e);\n\t\t}\n\n\t\tif (!shape.state.isDown) {\n\t\t\t// Down / Press\n\t\t\tshape.state.addAll(EShapeState.DOWN, DBaseState.PRESSED);\n\n\t\t\t// Focus and states\n\t\t\tconst layer = DApplications.getLayer(shape);\n\t\t\tif (layer) {\n\t\t\t\t// Focus\n\t\t\t\tconst focusController = layer.getFocusController();\n\t\t\t\tfocusController.focus(focusController.findParent(shape));\n\t\t\t}\n\t\t}\n\n\t\t// Actions\n\t\tfor (let i = 0, imax = actions.length; i < imax; ++i) {\n\t\t\tactions[i].onDown(shape, this, e);\n\t\t}\n\t}\n\n\tonUp(shape: EShape, e: InteractionEvent | KeyboardEvent): void {\n\t\tconst state = shape.state;\n\t\tif (!state.isUp) {\n\t\t\tstate.set(EShapeState.UP, DBaseState.PRESSED);\n\t\t}\n\t}\n\n\tonUpOutside(shape: EShape, e: InteractionEvent): void {\n\t\tshape.state.isPressed = false;\n\t}\n\n\tonMove(shape: EShape, e: InteractionEvent): void {\n\t\tconst actions = this.actions;\n\t\tfor (let i = 0, imax = actions.length; i < imax; ++i) {\n\t\t\tactions[i].onMove(shape, this, e);\n\t\t}\n\t}\n\n\tonKeyDown(shape: EShape, e: KeyboardEvent): boolean {\n\t\tif (UtilKeyboardEvent.isActivateKey(e)) {\n\t\t\tthis.onDown(shape, e);\n\t\t}\n\t\treturn false;\n\t}\n\n\tonKeyUp(shape: EShape, e: KeyboardEvent): boolean {\n\t\tif (UtilKeyboardEvent.isActivateKey(e)) {\n\t\t\tconst state = shape.state;\n\t\t\tif (state.isPressed) {\n\t\t\t\tconst wasUp = state.isUp;\n\t\t\t\tthis.onUp(shape, e);\n\t\t\t\tif (!wasUp && state.isUp) {\n\t\t\t\t\tthis.onClick(shape, e);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tonStateChange(shape: EShape, newState: DBaseStateSet, oldState: DBaseStateSet): void {\n\t\tthis.isStateChanged = true;\n\t\tDApplications.update(shape);\n\n\t\tif (newState.isFocused) {\n\t\t\tif (!oldState.isFocused) {\n\t\t\t\tthis.onFocus(shape);\n\t\t\t}\n\t\t} else if (oldState.isFocused) {\n\t\t\tthis.onBlur(shape);\n\t\t}\n\t}\n\n\tonFocus(shape: EShape): void {\n\t\tconst actions = this.actions;\n\t\tfor (let i = 0, imax = actions.length; i < imax; ++i) {\n\t\t\tactions[i].onFocus(shape, this);\n\t\t}\n\t}\n\n\tonBlur(shape: EShape): void {\n\t\tconst actions = this.actions;\n\t\tfor (let i = 0, imax = actions.length; i < imax; ++i) {\n\t\t\tactions[i].onBlur(shape, this);\n\t\t}\n\t}\n\n\tupdate(shape: EShape, time: number): void {\n\t\tconst data = shape.data;\n\t\tconst isEffectTimeUp = this.effect <= time;\n\t\tif (data.isChanged || this.isStateChanged || isEffectTimeUp) {\n\t\t\tif (isEffectTimeUp) {\n\t\t\t\tthis.effect = NaN;\n\t\t\t}\n\t\t\tshape.disallowUploadedUpdate();\n\t\t\tthis.onUpdate(shape, time);\n\t\t\tshape.allowUploadedUpdate();\n\t\t\tshape.state.removeAll(\n\t\t\t\tEShapeState.CLICKED,\n\t\t\t\tEShapeState.DOWN,\n\t\t\t\tEShapeState.UP,\n\t\t\t\tEShapeState.ACTIVATED,\n\t\t\t\tEShapeState.DEACTIVATED\n\t\t\t);\n\t\t\tthis.isStateChanged = false;\n\t\t\tdata.isChanged = false;\n\t\t}\n\t}\n\n\tonRender(shape: EShape, time: number, renderer: Renderer): void {\n\t\tconst actions = this.actions;\n\t\tfor (let i = 0, imax = actions.length; i < imax; ++i) {\n\t\t\tactions[i].onRender(shape, this, time, renderer);\n\t\t}\n\t\tthis.update(shape, time);\n\t}\n\n\tprotected onUpdate(shape: EShape, time: number): void {\n\t\tconst actions = this.actions;\n\t\tif (0 < actions.length) {\n\t\t\tthis.written = EShapeRuntimeReset.NONE;\n\t\t\tfor (let i = 0, imax = actions.length; i < imax; ++i) {\n\t\t\t\tactions[i].execute(shape, this, time);\n\t\t\t}\n\t\t\tthis.doReset(shape);\n\t\t}\n\t}\n\n\tprotected doReset(shape: EShape): void {\n\t\tconst target = ~this.written & this.reset;\n\t\tif (target !== EShapeRuntimeReset.NONE) {\n\t\t\tif (target & EShapeRuntimeReset.POSITION_X) {\n\t\t\t\tshape.transform.position.x = this.x;\n\t\t\t}\n\t\t\tif (target & EShapeRuntimeReset.POSITION_Y) {\n\t\t\t\tshape.transform.position.y = this.y;\n\t\t\t}\n\t\t\tif (target & EShapeRuntimeReset.VISIBILITY) {\n\t\t\t\tshape.visible = true;\n\t\t\t}\n\t\t\tif (target & EShapeRuntimeReset.COLOR_FILL) {\n\t\t\t\tconst fill = this.fill;\n\t\t\t\tshape.fill.set(undefined, fill.color, fill.alpha);\n\t\t\t}\n\t\t\tif (target & EShapeRuntimeReset.COLOR_STROKE) {\n\t\t\t\tconst stroke = this.stroke;\n\t\t\t\tshape.stroke.set(undefined, stroke.color, stroke.alpha);\n\t\t\t}\n\t\t\tif (target & EShapeRuntimeReset.COLOR_TEXT) {\n\t\t\t\tconst text = this.text;\n\t\t\t\tshape.text.set(undefined, text.color, text.alpha);\n\t\t\t}\n\t\t\tif (target & EShapeRuntimeReset.COLOR_TEXT_OUTLINE) {\n\t\t\t\tconst outline = this.text.outline;\n\t\t\t\tshape.text.outline.set(undefined, outline.color, outline.alpha);\n\t\t\t}\n\t\t\tif (target & EShapeRuntimeReset.HEIGHT) {\n\t\t\t\tshape.size.y = this.size.y;\n\t\t\t}\n\t\t\tif (target & EShapeRuntimeReset.WIDTH) {\n\t\t\t\tshape.size.x = this.size.x;\n\t\t\t}\n\t\t\tif (target & EShapeRuntimeReset.ROTATION) {\n\t\t\t\tshape.transform.rotation = this.rotation;\n\t\t\t}\n\t\t\tif (target & EShapeRuntimeReset.TEXT) {\n\t\t\t\tshape.text.value = this.text.value;\n\t\t\t}\n\t\t\tif (target & EShapeRuntimeReset.CURSOR) {\n\t\t\t\tshape.cursor = this.cursor;\n\t\t\t}\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeFillLike } from \"../e-shape-fill\";\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\nimport { EShapeStrokeLike } from \"../e-shape-stroke\";\nimport { EShapeTextLike } from \"../e-shape-text\";\nimport { EShapeTextOutlineLike } from \"../e-shape-text-outline\";\n\nexport class EShapeActionBases {\n\tstatic toBaseFill(shape: EShape, runtime: EShapeRuntime): EShapeFillLike {\n\t\treturn (runtime.written & EShapeRuntimeReset.COLOR_FILL ? shape : runtime).fill;\n\t}\n\n\tstatic toBaseStroke(shape: EShape, runtime: EShapeRuntime): EShapeStrokeLike {\n\t\treturn (runtime.written & EShapeRuntimeReset.COLOR_STROKE ? shape : runtime).stroke;\n\t}\n\n\tstatic toBaseText(shape: EShape, runtime: EShapeRuntime): EShapeTextLike {\n\t\treturn (runtime.written & EShapeRuntimeReset.COLOR_TEXT ? shape : runtime).text;\n\t}\n\n\tstatic toBaseTextOutline(shape: EShape, runtime: EShapeRuntime): EShapeTextOutlineLike {\n\t\treturn (runtime.written & EShapeRuntimeReset.COLOR_TEXT_OUTLINE ? shape : runtime).text\n\t\t\t.outline;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {\n\tEShapeActionExpression,\n\tEShapeActionExpressionWithParameter\n} from \"./e-shape-action-expression\";\n\nexport class EShapeActionExpressions {\n\tstatic NULL = (): null => null;\n\tstatic ZERO = (): number => 0;\n\tstatic ONE = (): number => 1;\n\tstatic ONE_HUNDRED = (): number => 100;\n\tstatic EMPTY = (): string => \"\";\n\tstatic TRUE = (): boolean => true;\n\tstatic FALSE = (): boolean => false;\n\n\tstatic from<T, DEF>(\n\t\texpression: string,\n\t\tcaster: string,\n\t\tdef: DEF,\n\t\tdefLiteral: string,\n\t\tnullable: boolean\n\t): EShapeActionExpression<T> | DEF;\n\tstatic from<T, P, DEF>(\n\t\texpression: string,\n\t\tcaster: string,\n\t\tdef: DEF,\n\t\tdefLiteral: string,\n\t\tnullable: boolean,\n\t\tparameter: string\n\t): EShapeActionExpressionWithParameter<T, P> | DEF;\n\tstatic from<T, P>(\n\t\texpression: string,\n\t\tcaster: string,\n\t\tdef: EShapeActionExpression<T> | EShapeActionExpressionWithParameter<T, P> | undefined,\n\t\tdefLiteral: string,\n\t\tnullable: boolean,\n\t\tparameter?: string\n\t): EShapeActionExpression<T> | EShapeActionExpressionWithParameter<T, P> | undefined {\n\t\tif (expression.trim().length <= 0) {\n\t\t\treturn def;\n\t\t}\n\n\t\ttry {\n\t\t\t/* eslint-disable prettier/prettier */\n\t\t\tconst body = `` +\n\t\t\t\t`try{` +\n\t\t\t\t\t`with( shape ) {` +\n\t\t\t\t\t\t`with( state ) {` +\n\t\t\t\t\t\t\t( nullable ?\n\t\t\t\t\t\t\t\t(\n\t\t\t\t\t\t\t\t\t`var result = (${expression});` +\n\t\t\t\t\t\t\t\t\t`return (result != null ? ${caster}(result) : null);`\n\t\t\t\t\t\t\t\t) :\n\t\t\t\t\t\t\t\t`return ${caster}(${expression});`\n\t\t\t\t\t\t\t) +\n\t\t\t\t\t\t`}` +\n\t\t\t\t\t`}` +\n\t\t\t\t`} catch( e ) {` +\n\t\t\t\t\t`return ${defLiteral};` +\n\t\t\t\t`}`;\n\t\t\t/* eslint-enable prettier/prettier */\n\t\t\tif (parameter == null) {\n\t\t\t\treturn Function(\"shape\", \"time\", body) as EShapeActionExpression<T>;\n\t\t\t} else {\n\t\t\t\treturn Function(\n\t\t\t\t\t\"shape\",\n\t\t\t\t\t\"time\",\n\t\t\t\t\tparameter,\n\t\t\t\t\tbody\n\t\t\t\t) as EShapeActionExpressionWithParameter<T, P>;\n\t\t\t}\n\t\t} catch (e) {\n\t\t\treturn def;\n\t\t}\n\t}\n\n\tstatic ofNumberOrNull(expression: string): EShapeActionExpression<number | null> {\n\t\treturn this.from(expression, \"Number\", this.NULL, \"null\", true);\n\t}\n\n\tstatic ofStringOrNull(expression: string): EShapeActionExpression<string | null> {\n\t\treturn this.from(expression, \"String\", this.NULL, \"null\", true);\n\t}\n\n\tstatic ofUnknown(expression: string): EShapeActionExpression<unknown> {\n\t\treturn this.from(expression, \"\", this.NULL, \"null\", false);\n\t}\n\n\tstatic ofNumber(expression: string): EShapeActionExpression<number> {\n\t\treturn this.from(expression, \"Number\", this.ZERO, \"0\", false);\n\t}\n\n\tstatic ofNumberOrOne(expression: string): EShapeActionExpression<number> {\n\t\treturn this.from(expression, \"Number\", this.ONE, \"1\", false);\n\t}\n\n\tstatic ofNumberOrOneHundred(expression: string): EShapeActionExpression<number> {\n\t\treturn this.from(expression, \"Number\", this.ONE_HUNDRED, \"100\", false);\n\t}\n\n\tstatic ofString(expression: string): EShapeActionExpression<string> {\n\t\treturn this.from(expression, \"String\", this.EMPTY, '\"\"', false);\n\t}\n\n\tstatic ofBoolean(expression: string): EShapeActionExpression<boolean> {\n\t\treturn this.from(expression, \"Boolean\", this.TRUE, \"true\", false);\n\t}\n\n\tstatic ofBooleanOrTrue(expression: string): EShapeActionExpression<boolean> {\n\t\treturn this.from(expression, \"Boolean\", this.TRUE, \"true\", false);\n\t}\n\n\tstatic ofBooleanOrFalse(expression: string): EShapeActionExpression<boolean> {\n\t\treturn this.from(expression, \"Boolean\", this.FALSE, \"false\", false);\n\t}\n\n\tstatic ofElementOrNull<ELEMENT extends HTMLElement>(\n\t\texpression: string\n\t): EShapeActionExpressionWithParameter<ELEMENT | null, HTMLElement> | undefined {\n\t\treturn this.from(expression, \"\", undefined, \"null\", false, \"container\");\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction, Renderer } from \"pixi.js\";\nimport InteractionEvent = interaction.InteractionEvent;\nimport InteractionManager = interaction.InteractionManager;\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\n\n/**\n * An action runtime.\n * Please note that all the action runtimes are shared across shapes.\n */\nexport class EShapeActionRuntime {\n\treset: EShapeRuntimeReset;\n\n\tconstructor(reset?: EShapeRuntimeReset) {\n\t\tthis.reset = reset || EShapeRuntimeReset.NONE;\n\t}\n\n\tinitialize(shape: EShape, runtime: EShapeRuntime): void {\n\t\t// OVERRIDE THIS\n\t}\n\n\texecute(shape: EShape, runtime: EShapeRuntime, time: number): void {\n\t\t// OVERRIDE THIS\n\t}\n\n\tonFocus(shape: EShape, runtime: EShapeRuntime): void {\n\t\t// DO NOTHING\n\t}\n\n\tonBlur(shape: EShape, runtime: EShapeRuntime): void {\n\t\t// DO NOTHING\n\t}\n\n\tonDowning(shape: EShape, runtime: EShapeRuntime, e: InteractionEvent | KeyboardEvent): void {\n\t\t// DO NOTHING\n\t}\n\n\tonDown(shape: EShape, runtime: EShapeRuntime, e: InteractionEvent | KeyboardEvent): void {\n\t\t// DO NOTHING\n\t}\n\n\tonMove(shape: EShape, runtime: EShapeRuntime, e: InteractionEvent): void {\n\t\t// DO NOTHING\n\t}\n\n\tonDblClick(\n\t\tshape: EShape,\n\t\truntime: EShapeRuntime,\n\t\te: MouseEvent | TouchEvent,\n\t\tinteractionManager: InteractionManager\n\t): void {\n\t\t// DO NOTHING\n\t}\n\n\tonRender(shape: EShape, runtime: EShapeRuntime, time: number, renderer: Renderer): void {\n\t\t// DO NOTHING\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeRuntimeReset } from \"../e-shape-runtime\";\nimport { EShapeActionExpression } from \"./e-shape-action-expression\";\nimport { EShapeActionExpressions } from \"./e-shape-action-expressions\";\nimport { EShapeActionRuntime } from \"./e-shape-action-runtime\";\nimport { EShapeActionValue } from \"./e-shape-action-value\";\n\nexport class EShapeActionRuntimeConditional extends EShapeActionRuntime {\n\tprotected readonly condition: EShapeActionExpression<boolean>;\n\n\tconstructor(value: EShapeActionValue, reset: EShapeRuntimeReset) {\n\t\tsuper(reset);\n\t\tthis.condition = EShapeActionExpressions.ofBoolean(value.condition);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\nimport { EShapeActionRuntimeConditional } from \"./e-shape-action-runtime-conditional\";\nimport { EShapeActionValueBlink } from \"./e-shape-action-value-blink\";\n\nexport class EShapeActionRuntimeBlink extends EShapeActionRuntimeConditional {\n\tprotected interval: number;\n\n\tconstructor(value: EShapeActionValueBlink, reset: EShapeRuntimeReset) {\n\t\tsuper(value, reset);\n\t\tthis.interval = value.interval;\n\t}\n\n\texecute(shape: EShape, runtime: EShapeRuntime, time: number): void {\n\t\tif (this.condition(shape, time)) {\n\t\t\tconst interval = this.interval;\n\t\t\tconst dinterval = interval << 1;\n\t\t\tconst elapsed = time % dinterval;\n\t\t\tif (elapsed < interval) {\n\t\t\t\tthis.toOff(shape, runtime);\n\t\t\t\truntime.effect = time + (interval - elapsed);\n\t\t\t} else {\n\t\t\t\tthis.toOn(shape, runtime);\n\t\t\t\truntime.effect = time + (dinterval - elapsed);\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected toOn(shape: EShape, runtime: EShapeRuntime): void {\n\t\t//\n\t}\n\n\tprotected toOff(shape: EShape, runtime: EShapeRuntime): void {\n\t\t//\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { UtilRgb } from \"../../util/util-rgb\";\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\nimport { EShapeActionBases } from \"./e-shape-action-bases\";\nimport { EShapeActionRuntimeBlink } from \"./e-shape-action-runtime-blink\";\nimport { EShapeActionValueBlink } from \"./e-shape-action-value-blink\";\n\nexport class EShapeActionRuntimeBlinkBrighten extends EShapeActionRuntimeBlink {\n\tconstructor(value: EShapeActionValueBlink) {\n\t\tsuper(value, EShapeRuntimeReset.COLOR);\n\t}\n\n\tprotected toOn(shape: EShape, runtime: EShapeRuntime): void {\n\t\tconst fill = EShapeActionBases.toBaseFill(shape, runtime);\n\t\tshape.fill.set(undefined, UtilRgb.brighten(fill.color, 0.5), fill.alpha);\n\n\t\tconst stroke = EShapeActionBases.toBaseStroke(shape, runtime);\n\t\tshape.stroke.set(undefined, UtilRgb.brighten(stroke.color, 0.5), stroke.alpha);\n\n\t\tconst text = EShapeActionBases.toBaseText(shape, runtime);\n\t\tshape.text.set(undefined, UtilRgb.brighten(text.color, 0.5), text.alpha);\n\n\t\tconst outline = EShapeActionBases.toBaseTextOutline(shape, runtime);\n\t\tshape.text.outline.set(undefined, UtilRgb.brighten(outline.color, 0.5), outline.alpha);\n\n\t\truntime.written |= this.reset;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\nimport { EShapeActionRuntimeBlink } from \"./e-shape-action-runtime-blink\";\nimport { EShapeActionValueBlink } from \"./e-shape-action-value-blink\";\n\nexport class EShapeActionRuntimeBlinkColorFill extends EShapeActionRuntimeBlink {\n\tprotected color: number;\n\tprotected alpha: number;\n\n\tconstructor(value: EShapeActionValueBlink) {\n\t\tsuper(value, EShapeRuntimeReset.COLOR_FILL);\n\t\tthis.color = value.color;\n\t\tthis.alpha = value.alpha;\n\t}\n\n\tprotected toOn(shape: EShape, runtime: EShapeRuntime): void {\n\t\tshape.fill.set(undefined, this.color, this.alpha);\n\t\truntime.written |= this.reset;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\nimport { EShapeActionRuntimeBlink } from \"./e-shape-action-runtime-blink\";\nimport { EShapeActionValueBlink } from \"./e-shape-action-value-blink\";\n\nexport class EShapeActionRuntimeBlinkColorStroke extends EShapeActionRuntimeBlink {\n\tprotected color: number;\n\tprotected alpha: number;\n\n\tconstructor(value: EShapeActionValueBlink) {\n\t\tsuper(value, EShapeRuntimeReset.COLOR_STROKE);\n\t\tthis.color = value.color;\n\t\tthis.alpha = value.alpha;\n\t}\n\n\tprotected toOn(shape: EShape, runtime: EShapeRuntime): void {\n\t\tshape.stroke.set(undefined, this.color, this.alpha);\n\t\truntime.written |= this.reset;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { UtilRgb } from \"../../util/util-rgb\";\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\nimport { EShapeActionBases } from \"./e-shape-action-bases\";\nimport { EShapeActionRuntimeBlink } from \"./e-shape-action-runtime-blink\";\nimport { EShapeActionValueBlink } from \"./e-shape-action-value-blink\";\n\nexport class EShapeActionRuntimeBlinkDarken extends EShapeActionRuntimeBlink {\n\tconstructor(value: EShapeActionValueBlink) {\n\t\tsuper(value, EShapeRuntimeReset.COLOR);\n\t}\n\n\tprotected toOn(shape: EShape, runtime: EShapeRuntime): void {\n\t\tconst fill = EShapeActionBases.toBaseFill(shape, runtime);\n\t\tshape.fill.set(undefined, UtilRgb.darken(fill.color, 0.5), fill.alpha);\n\n\t\tconst stroke = EShapeActionBases.toBaseStroke(shape, runtime);\n\t\tshape.stroke.set(undefined, UtilRgb.darken(stroke.color, 0.5), stroke.alpha);\n\n\t\tconst text = EShapeActionBases.toBaseText(shape, runtime);\n\t\tshape.text.set(undefined, UtilRgb.darken(text.color, 0.5), text.alpha);\n\n\t\tconst outline = EShapeActionBases.toBaseTextOutline(shape, runtime);\n\t\tshape.text.outline.set(undefined, UtilRgb.darken(outline.color, 0.5), outline.alpha);\n\n\t\truntime.written |= this.reset;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\nimport { EShapeActionBases } from \"./e-shape-action-bases\";\nimport { EShapeActionRuntimeBlink } from \"./e-shape-action-runtime-blink\";\nimport { EShapeActionValueBlink } from \"./e-shape-action-value-blink\";\n\nexport class EShapeActionRuntimeBlinkOpacity extends EShapeActionRuntimeBlink {\n\tconstructor(value: EShapeActionValueBlink) {\n\t\tsuper(value, EShapeRuntimeReset.COLOR_FILL_AND_STROKE);\n\t}\n\n\tprotected toOn(shape: EShape, runtime: EShapeRuntime): void {\n\t\tconst fill = EShapeActionBases.toBaseFill(shape, runtime);\n\t\tshape.fill.set(undefined, fill.color, fill.alpha * 0.5);\n\n\t\tconst stroke = EShapeActionBases.toBaseStroke(shape, runtime);\n\t\tshape.stroke.set(undefined, stroke.color, stroke.alpha * 0.5);\n\n\t\truntime.written |= this.reset;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\nimport { EShapeActionRuntimeBlink } from \"./e-shape-action-runtime-blink\";\nimport { EShapeActionValueBlink } from \"./e-shape-action-value-blink\";\n\nexport class EShapeActionRuntimeBlinkVisibility extends EShapeActionRuntimeBlink {\n\tconstructor(value: EShapeActionValueBlink) {\n\t\tsuper(value, EShapeRuntimeReset.VISIBILITY);\n\t}\n\n\tprotected toOn(shape: EShape, runtime: EShapeRuntime): void {\n\t\tshape.visible = true;\n\t\truntime.written |= this.reset;\n\t}\n\n\tprotected toOff(shape: EShape, runtime: EShapeRuntime): void {\n\t\tshape.visible = false;\n\t\truntime.written |= this.reset;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const EShapeActionValueBlinkType = {\n\tVISIBILITY: 0,\n\tBRIGHTEN: 1,\n\tDARKEN: 2,\n\tOPACITY: 3,\n\tCOLOR_FILL: 4,\n\tCOLOR_STROKE: 5\n} as const;\n\nexport type EShapeActionValueBlinkType =\n\ttypeof EShapeActionValueBlinkType[keyof typeof EShapeActionValueBlinkType];\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DThemes } from \"../../theme/d-themes\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShapeActionRuntime } from \"./e-shape-action-runtime\";\nimport { EShapeActionValue, EThemeShapeActionValue } from \"./e-shape-action-value\";\nimport { EShapeActionValueType } from \"./e-shape-action-value-type\";\n\nexport abstract class EShapeActionValueBase implements EShapeActionValue {\n\treadonly type: EShapeActionValueType;\n\treadonly condition: string;\n\n\tconstructor(type: EShapeActionValueType, condition: string) {\n\t\tthis.type = type;\n\t\tthis.condition = condition;\n\t}\n\n\tisEquals(value: EShapeActionValue): boolean {\n\t\treturn this.type === value.type && this.condition === value.condition;\n\t}\n\n\ttoLabel(): string {\n\t\treturn DThemes.getInstance().get<EThemeShapeActionValue>(\"EShapeActionValue\").toLabel(this);\n\t}\n\n\tabstract toRuntime(): EShapeActionRuntime;\n\tabstract serialize(manager: EShapeResourceManagerSerialization): number;\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeActionValue } from \"./e-shape-action-value\";\nimport { EShapeActionValueBase } from \"./e-shape-action-value-base\";\nimport { EShapeActionValueType } from \"./e-shape-action-value-type\";\n\nexport abstract class EShapeActionValueSubtyped<\n\tSUBTYPE extends number\n> extends EShapeActionValueBase {\n\treadonly subtype: SUBTYPE;\n\n\tconstructor(type: EShapeActionValueType, condition: string, subtype: SUBTYPE) {\n\t\tsuper(type, condition);\n\t\tthis.subtype = subtype;\n\t}\n\n\tisEquals(value: EShapeActionValue): boolean {\n\t\treturn (\n\t\t\tsuper.isEquals(value) &&\n\t\t\tvalue instanceof EShapeActionValueSubtyped &&\n\t\t\tthis.subtype === value.subtype\n\t\t);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const EShapeActionValueType = {\n\tSHOW_HIDE: 0,\n\tBLINK: 1,\n\tTRANSFORM: 2,\n\tOPEN: 3,\n\t/** @deprecated in favor of {@link EShapeActionValueMiscType.MISC} */\n\tEMIT_EVENT: 4,\n\t/** @deprecated in favor of {@link EShapeActionValueType.CHANGE_COLOR} */\n\tCHANGE_COLOR_LEGACY: 5,\n\tCHANGE_TEXT: 6,\n\tCHANGE_CURSOR: 7,\n\tMISC: 8,\n\tCHANGE_COLOR: 9\n} as const;\n\nexport type EShapeActionValueType =\n\ttypeof EShapeActionValueType[keyof typeof EShapeActionValueType];\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { isNumber } from \"../../util/is-number\";\n\nexport class EShapeActionValues {\n\tstatic toResource(index: number, parsed: number[], resources: string[]): string {\n\t\tif (0 <= index && index < parsed.length) {\n\t\t\tconst id = parsed[index];\n\t\t\tif (isNumber(id) && 0 <= id && id < resources.length) {\n\t\t\t\treturn resources[id];\n\t\t\t}\n\t\t}\n\t\treturn \"\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShapeActionRuntimeBlink } from \"./e-shape-action-runtime-blink\";\nimport { EShapeActionRuntimeBlinkBrighten } from \"./e-shape-action-runtime-blink-brighten\";\nimport { EShapeActionRuntimeBlinkColorFill } from \"./e-shape-action-runtime-blink-color-fill\";\nimport { EShapeActionRuntimeBlinkColorStroke } from \"./e-shape-action-runtime-blink-color-stroke\";\nimport { EShapeActionRuntimeBlinkDarken } from \"./e-shape-action-runtime-blink-darken\";\nimport { EShapeActionRuntimeBlinkOpacity } from \"./e-shape-action-runtime-blink-opacity\";\nimport { EShapeActionRuntimeBlinkVisibility } from \"./e-shape-action-runtime-blink-visibility\";\nimport { EShapeActionValue } from \"./e-shape-action-value\";\nimport { EShapeActionValueBlinkType } from \"./e-shape-action-value-blink-type\";\nimport { EShapeActionValueSubtyped } from \"./e-shape-action-value-subtyped\";\nimport { EShapeActionValueType } from \"./e-shape-action-value-type\";\nimport { EShapeActionValues } from \"./e-shape-action-values\";\n\nexport type EShapeActionValueBlinkSerialized = [\n\ttypeof EShapeActionValueType.BLINK,\n\tnumber,\n\ttypeof EShapeActionValueBlinkType.COLOR_FILL | typeof EShapeActionValueBlinkType.COLOR_STROKE,\n\tnumber,\n\tnumber,\n\tnumber\n];\n\nexport class EShapeActionValueBlink extends EShapeActionValueSubtyped<EShapeActionValueBlinkType> {\n\treadonly interval: number;\n\treadonly color: number;\n\treadonly alpha: number;\n\n\tconstructor(\n\t\tsubtype: EShapeActionValueBlinkType,\n\t\tcondition: string,\n\t\tinterval: number,\n\t\tcolor: number,\n\t\talpha: number\n\t) {\n\t\tsuper(EShapeActionValueType.BLINK, condition, subtype);\n\t\tthis.interval = interval;\n\t\tthis.color = color;\n\t\tthis.alpha = alpha;\n\t}\n\n\tisEquals(value: EShapeActionValue): boolean {\n\t\treturn (\n\t\t\tsuper.isEquals(value) &&\n\t\t\tvalue instanceof EShapeActionValueBlink &&\n\t\t\tthis.interval === value.interval &&\n\t\t\tthis.color === value.color &&\n\t\t\tthis.alpha === value.alpha\n\t\t);\n\t}\n\n\ttoRuntime(): EShapeActionRuntimeBlink {\n\t\tswitch (this.subtype) {\n\t\t\tcase EShapeActionValueBlinkType.BRIGHTEN:\n\t\t\t\treturn new EShapeActionRuntimeBlinkBrighten(this);\n\t\t\tcase EShapeActionValueBlinkType.COLOR_FILL:\n\t\t\t\treturn new EShapeActionRuntimeBlinkColorFill(this);\n\t\t\tcase EShapeActionValueBlinkType.COLOR_STROKE:\n\t\t\t\treturn new EShapeActionRuntimeBlinkColorStroke(this);\n\t\t\tcase EShapeActionValueBlinkType.DARKEN:\n\t\t\t\treturn new EShapeActionRuntimeBlinkDarken(this);\n\t\t\tcase EShapeActionValueBlinkType.OPACITY:\n\t\t\t\treturn new EShapeActionRuntimeBlinkOpacity(this);\n\t\t\tcase EShapeActionValueBlinkType.VISIBILITY:\n\t\t\t\treturn new EShapeActionRuntimeBlinkVisibility(this);\n\t\t}\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\tconst conditionId = manager.addResource(this.condition);\n\t\treturn manager.addResource(\n\t\t\t`[${this.type},${conditionId},${this.subtype},${this.interval},${this.color},${this.alpha}]`\n\t\t);\n\t}\n\n\tstatic deserialize(\n\t\tserialized: EShapeActionValueBlinkSerialized,\n\t\tmanager: EShapeResourceManagerDeserialization\n\t): EShapeActionValueBlink {\n\t\tconst condition = EShapeActionValues.toResource(1, serialized, manager.resources);\n\t\treturn new EShapeActionValueBlink(\n\t\t\tserialized[2],\n\t\t\tcondition,\n\t\t\tserialized[3],\n\t\t\tserialized[4],\n\t\t\tserialized[5]\n\t\t);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport class UtilAlpha {\n\tstatic blend(alphaA: number, alphaB: number, t: number): number {\n\t\tconst w = Math.max(0, Math.min(1, t));\n\t\treturn Math.max(0, Math.min(1, alphaA * (1 - w) + alphaB * w));\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { UtilAlpha } from \"../../util/util-alpha\";\nimport { UtilRgb } from \"../../util/util-rgb\";\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\nimport { EShapeActionBases } from \"./e-shape-action-bases\";\nimport { EShapeActionRuntimeConditional } from \"./e-shape-action-runtime-conditional\";\nimport { EShapeActionValue } from \"./e-shape-action-value\";\nimport { EShapeActionValueChangeColorType } from \"./e-shape-action-value-change-color-type\";\n\nconst toReset = (type: EShapeActionValueChangeColorType): EShapeRuntimeReset => {\n\treturn type << 3;\n};\n\nexport interface EShapeActionRuntimeChangeColorBaseValue extends EShapeActionValue {\n\tsubtype: EShapeActionValueChangeColorType;\n}\n\nexport class EShapeActionRuntimeChangeColorBase extends EShapeActionRuntimeConditional {\n\tconstructor(value: EShapeActionRuntimeChangeColorBaseValue) {\n\t\tsuper(value, toReset(value.subtype));\n\t}\n\n\tprotected set(\n\t\tshape: EShape,\n\t\truntime: EShapeRuntime,\n\t\ttime: number,\n\t\tcolor: number | null,\n\t\talpha: number | null,\n\t\tblend: number | null\n\t): void {\n\t\tconst reset = this.reset;\n\t\tif (color != null) {\n\t\t\tif (alpha != null) {\n\t\t\t\tif (blend != null) {\n\t\t\t\t\tif (reset & EShapeRuntimeReset.COLOR_FILL) {\n\t\t\t\t\t\tconst base = EShapeActionBases.toBaseFill(shape, runtime);\n\t\t\t\t\t\tshape.fill.set(\n\t\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t\tUtilRgb.blend(base.color, color, blend),\n\t\t\t\t\t\t\tUtilAlpha.blend(base.alpha, alpha, blend)\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tif (reset & EShapeRuntimeReset.COLOR_STROKE) {\n\t\t\t\t\t\tconst base = EShapeActionBases.toBaseStroke(shape, runtime);\n\t\t\t\t\t\tshape.stroke.set(\n\t\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t\tUtilRgb.blend(base.color, color, blend),\n\t\t\t\t\t\t\tUtilAlpha.blend(base.alpha, alpha, blend)\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tif (reset & EShapeRuntimeReset.COLOR_TEXT) {\n\t\t\t\t\t\tconst base = EShapeActionBases.toBaseText(shape, runtime);\n\t\t\t\t\t\tshape.text.set(\n\t\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t\tUtilRgb.blend(base.color, color, blend),\n\t\t\t\t\t\t\tUtilAlpha.blend(base.alpha, alpha, blend)\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tif (reset & EShapeRuntimeReset.COLOR_TEXT_OUTLINE) {\n\t\t\t\t\t\tconst base = EShapeActionBases.toBaseTextOutline(shape, runtime);\n\t\t\t\t\t\tshape.text.outline.set(\n\t\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t\tUtilRgb.blend(base.color, color, blend),\n\t\t\t\t\t\t\tUtilAlpha.blend(base.alpha, alpha, blend)\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (reset & EShapeRuntimeReset.COLOR_FILL) {\n\t\t\t\t\t\tshape.fill.set(undefined, color, alpha);\n\t\t\t\t\t}\n\t\t\t\t\tif (reset & EShapeRuntimeReset.COLOR_STROKE) {\n\t\t\t\t\t\tshape.stroke.set(undefined, color, alpha);\n\t\t\t\t\t}\n\t\t\t\t\tif (reset & EShapeRuntimeReset.COLOR_TEXT) {\n\t\t\t\t\t\tshape.text.set(undefined, color, alpha);\n\t\t\t\t\t}\n\t\t\t\t\tif (reset & EShapeRuntimeReset.COLOR_TEXT_OUTLINE) {\n\t\t\t\t\t\tshape.text.outline.set(undefined, color, alpha);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (blend != null) {\n\t\t\t\t\tif (reset & EShapeRuntimeReset.COLOR_FILL) {\n\t\t\t\t\t\tconst base = EShapeActionBases.toBaseFill(shape, runtime);\n\t\t\t\t\t\tshape.fill.set(\n\t\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t\tUtilRgb.blend(base.color, color, blend),\n\t\t\t\t\t\t\tbase.alpha\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tif (reset & EShapeRuntimeReset.COLOR_STROKE) {\n\t\t\t\t\t\tconst base = EShapeActionBases.toBaseStroke(shape, runtime);\n\t\t\t\t\t\tshape.stroke.set(\n\t\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t\tUtilRgb.blend(base.color, color, blend),\n\t\t\t\t\t\t\tbase.alpha\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tif (reset & EShapeRuntimeReset.COLOR_TEXT) {\n\t\t\t\t\t\tconst base = EShapeActionBases.toBaseText(shape, runtime);\n\t\t\t\t\t\tshape.text.set(\n\t\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t\tUtilRgb.blend(base.color, color, blend),\n\t\t\t\t\t\t\tbase.alpha\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tif (reset & EShapeRuntimeReset.COLOR_TEXT_OUTLINE) {\n\t\t\t\t\t\tconst base = EShapeActionBases.toBaseTextOutline(shape, runtime);\n\t\t\t\t\t\tshape.text.outline.set(\n\t\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t\tUtilRgb.blend(base.color, color, blend),\n\t\t\t\t\t\t\tbase.alpha\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (reset & EShapeRuntimeReset.COLOR_FILL) {\n\t\t\t\t\t\tconst base = EShapeActionBases.toBaseFill(shape, runtime);\n\t\t\t\t\t\tshape.fill.set(undefined, color, base.alpha);\n\t\t\t\t\t}\n\t\t\t\t\tif (reset & EShapeRuntimeReset.COLOR_STROKE) {\n\t\t\t\t\t\tconst base = EShapeActionBases.toBaseStroke(shape, runtime);\n\t\t\t\t\t\tshape.stroke.set(undefined, color, base.alpha);\n\t\t\t\t\t}\n\t\t\t\t\tif (reset & EShapeRuntimeReset.COLOR_TEXT) {\n\t\t\t\t\t\tconst base = EShapeActionBases.toBaseText(shape, runtime);\n\t\t\t\t\t\tshape.text.set(undefined, color, base.alpha);\n\t\t\t\t\t}\n\t\t\t\t\tif (reset & EShapeRuntimeReset.COLOR_TEXT_OUTLINE) {\n\t\t\t\t\t\tconst base = EShapeActionBases.toBaseTextOutline(shape, runtime);\n\t\t\t\t\t\tshape.text.outline.set(undefined, color, base.alpha);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\truntime.written |= reset;\n\t\t} else if (alpha != null) {\n\t\t\tif (blend != null) {\n\t\t\t\tif (reset & EShapeRuntimeReset.COLOR_FILL) {\n\t\t\t\t\tconst base = EShapeActionBases.toBaseFill(shape, runtime);\n\t\t\t\t\tshape.fill.set(\n\t\t\t\t\t\tundefined,\n\t\t\t\t\t\tbase.color,\n\t\t\t\t\t\tUtilAlpha.blend(base.alpha, alpha, blend)\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tif (reset & EShapeRuntimeReset.COLOR_STROKE) {\n\t\t\t\t\tconst base = EShapeActionBases.toBaseStroke(shape, runtime);\n\t\t\t\t\tshape.stroke.set(\n\t\t\t\t\t\tundefined,\n\t\t\t\t\t\tbase.color,\n\t\t\t\t\t\tUtilAlpha.blend(base.alpha, alpha, blend)\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tif (reset & EShapeRuntimeReset.COLOR_TEXT) {\n\t\t\t\t\tconst base = EShapeActionBases.toBaseText(shape, runtime);\n\t\t\t\t\tshape.text.set(\n\t\t\t\t\t\tundefined,\n\t\t\t\t\t\tbase.color,\n\t\t\t\t\t\tUtilAlpha.blend(base.alpha, alpha, blend)\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tif (reset & EShapeRuntimeReset.COLOR_TEXT_OUTLINE) {\n\t\t\t\t\tconst base = EShapeActionBases.toBaseTextOutline(shape, runtime);\n\t\t\t\t\tshape.text.outline.set(\n\t\t\t\t\t\tundefined,\n\t\t\t\t\t\tbase.color,\n\t\t\t\t\t\tUtilAlpha.blend(base.alpha, alpha, blend)\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (reset & EShapeRuntimeReset.COLOR_FILL) {\n\t\t\t\t\tconst base = EShapeActionBases.toBaseFill(shape, runtime);\n\t\t\t\t\tshape.fill.set(undefined, base.color, alpha);\n\t\t\t\t}\n\t\t\t\tif (reset & EShapeRuntimeReset.COLOR_STROKE) {\n\t\t\t\t\tconst base = EShapeActionBases.toBaseStroke(shape, runtime);\n\t\t\t\t\tshape.stroke.set(undefined, base.color, alpha);\n\t\t\t\t}\n\t\t\t\tif (reset & EShapeRuntimeReset.COLOR_TEXT) {\n\t\t\t\t\tconst base = EShapeActionBases.toBaseText(shape, runtime);\n\t\t\t\t\tshape.text.set(undefined, base.color, alpha);\n\t\t\t\t}\n\t\t\t\tif (reset & EShapeRuntimeReset.COLOR_TEXT_OUTLINE) {\n\t\t\t\t\tconst base = EShapeActionBases.toBaseTextOutline(shape, runtime);\n\t\t\t\t\tshape.text.outline.set(undefined, base.color, alpha);\n\t\t\t\t}\n\t\t\t}\n\t\t\truntime.written |= reset;\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const EShapeActionValueChangeColorTarget = {\n\tCOLOR_AND_ALPHA: 0,\n\tCOLOR: 1,\n\tALPHA: 2,\n\tCODE: 3,\n\tBRIGHTNESS: 4\n} as const;\n\nexport type EShapeActionValueChangeColorTarget =\n\ttypeof EShapeActionValueChangeColorTarget[keyof typeof EShapeActionValueChangeColorTarget];\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime } from \"../e-shape-runtime\";\nimport { EShapeActionExpression } from \"./e-shape-action-expression\";\nimport { EShapeActionExpressions } from \"./e-shape-action-expressions\";\nimport { EShapeActionRuntimeChangeColorBase } from \"./e-shape-action-runtime-change-color-base\";\nimport { EShapeActionValueChangeColor } from \"./e-shape-action-value-change-color\";\nimport { EShapeActionValueChangeColorTarget } from \"./e-shape-action-value-change-color-target\";\n\nexport class EShapeActionRuntimeChangeColor extends EShapeActionRuntimeChangeColorBase {\n\tprotected readonly color: number | null;\n\tprotected readonly alpha: number | null;\n\tprotected readonly blend: EShapeActionExpression<number | null>;\n\n\tconstructor(value: EShapeActionValueChangeColor) {\n\t\tsuper(value);\n\n\t\tswitch (value.target) {\n\t\t\tcase EShapeActionValueChangeColorTarget.COLOR:\n\t\t\t\tthis.color = value.color;\n\t\t\t\tthis.alpha = null;\n\t\t\t\tbreak;\n\t\t\tcase EShapeActionValueChangeColorTarget.ALPHA:\n\t\t\t\tthis.color = null;\n\t\t\t\tthis.alpha = value.alpha;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthis.color = value.color;\n\t\t\t\tthis.alpha = value.alpha;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tthis.blend = EShapeActionExpressions.ofNumberOrNull(value.blend);\n\t}\n\n\texecute(shape: EShape, runtime: EShapeRuntime, time: number): void {\n\t\tif (this.condition(shape, time)) {\n\t\t\tconst color = this.color;\n\t\t\tconst alpha = this.alpha;\n\t\t\tconst blend = this.blend(shape, time);\n\t\t\tthis.set(shape, runtime, time, color, alpha, blend);\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nconst FILL = 1;\nconst STROKE = 2;\nconst TEXT = 4;\nconst TEXT_OUTLINE = 8;\n\nexport const EShapeActionValueChangeColorType = {\n\tNONE: 0,\n\tFILL,\n\tSTROKE,\n\tTEXT,\n\tTEXT_OUTLINE,\n\tFILL_AND_STROKE: FILL | STROKE,\n\tALL: FILL | STROKE | TEXT | TEXT_OUTLINE\n} as const;\n\nexport type EShapeActionValueChangeColorType = number;\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const EShapeActionValueChangeColorTypeLegacy = {\n\tFILL: 0,\n\tSTROKE: 1,\n\tFILL_AND_STROKE: 2,\n\tTEXT: 3,\n\tTEXT_OUTLINE: 4,\n\tALL: 5\n} as const;\n\nexport type EShapeActionValueChangeColorTypeLegacy =\n\ttypeof EShapeActionValueChangeColorTypeLegacy[keyof typeof EShapeActionValueChangeColorTypeLegacy];\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeActionValueChangeColorType } from \"./e-shape-action-value-change-color-type\";\nimport { EShapeActionValueChangeColorTypeLegacy } from \"./e-shape-action-value-change-color-type-legacy\";\nimport { EShapeActionValueType } from \"./e-shape-action-value-type\";\n\nexport interface EShapeActionValueChangeColorTypesSerialized {\n\t[0]: typeof EShapeActionValueType.CHANGE_COLOR;\n\t[2]: EShapeActionValueChangeColorType;\n}\n\nexport interface EShapeActionValueChangeColorTypesSerializedLegacy {\n\t[0]: typeof EShapeActionValueType.CHANGE_COLOR_LEGACY;\n\t[2]: EShapeActionValueChangeColorTypeLegacy;\n}\n\nexport class EShapeActionValueChangeColorTypes {\n\tstatic from(\n\t\tserialized:\n\t\t\t| EShapeActionValueChangeColorTypesSerialized\n\t\t\t| EShapeActionValueChangeColorTypesSerializedLegacy\n\t): EShapeActionValueChangeColorType {\n\t\tif (serialized[0] === EShapeActionValueType.CHANGE_COLOR) {\n\t\t\treturn serialized[2];\n\t\t}\n\t\tswitch (serialized[2]) {\n\t\t\tcase EShapeActionValueChangeColorTypeLegacy.FILL:\n\t\t\t\treturn EShapeActionValueChangeColorType.FILL;\n\t\t\tcase EShapeActionValueChangeColorTypeLegacy.STROKE:\n\t\t\t\treturn EShapeActionValueChangeColorType.STROKE;\n\t\t\tcase EShapeActionValueChangeColorTypeLegacy.FILL_AND_STROKE:\n\t\t\t\treturn EShapeActionValueChangeColorType.FILL_AND_STROKE;\n\t\t\tcase EShapeActionValueChangeColorTypeLegacy.TEXT:\n\t\t\t\treturn EShapeActionValueChangeColorType.TEXT;\n\t\t\tcase EShapeActionValueChangeColorTypeLegacy.TEXT_OUTLINE:\n\t\t\t\treturn EShapeActionValueChangeColorType.TEXT_OUTLINE;\n\t\t\tcase EShapeActionValueChangeColorTypeLegacy.ALL:\n\t\t\t\treturn EShapeActionValueChangeColorType.ALL;\n\t\t}\n\t}\n\n\tstatic unpack(type: EShapeActionValueChangeColorType): EShapeActionValueChangeColorType[] {\n\t\tconst result: EShapeActionValueChangeColorType[] = [];\n\t\tif (type & EShapeActionValueChangeColorType.FILL) {\n\t\t\tresult.push(EShapeActionValueChangeColorType.FILL);\n\t\t}\n\t\tif (type & EShapeActionValueChangeColorType.STROKE) {\n\t\t\tresult.push(EShapeActionValueChangeColorType.STROKE);\n\t\t}\n\t\tif (type & EShapeActionValueChangeColorType.TEXT) {\n\t\t\tresult.push(EShapeActionValueChangeColorType.TEXT);\n\t\t}\n\t\tif (type & EShapeActionValueChangeColorType.TEXT_OUTLINE) {\n\t\t\tresult.push(EShapeActionValueChangeColorType.TEXT_OUTLINE);\n\t\t}\n\t\treturn result;\n\t}\n\n\tstatic pack(types: EShapeActionValueChangeColorType[]): EShapeActionValueChangeColorType {\n\t\tlet result = EShapeActionValueChangeColorType.NONE;\n\t\tfor (let i = 0, imax = types.length; i < imax; ++i) {\n\t\t\tresult |= types[i];\n\t\t}\n\t\treturn result;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShapeActionRuntimeChangeColor } from \"./e-shape-action-runtime-change-color\";\nimport { EShapeActionValue } from \"./e-shape-action-value\";\nimport { EShapeActionValueChangeColorTarget } from \"./e-shape-action-value-change-color-target\";\nimport { EShapeActionValueChangeColorType } from \"./e-shape-action-value-change-color-type\";\nimport { EShapeActionValueChangeColorTypeLegacy } from \"./e-shape-action-value-change-color-type-legacy\";\nimport { EShapeActionValueChangeColorTypes } from \"./e-shape-action-value-change-color-types\";\nimport { EShapeActionValueSubtyped } from \"./e-shape-action-value-subtyped\";\nimport { EShapeActionValueType } from \"./e-shape-action-value-type\";\nimport { EShapeActionValues } from \"./e-shape-action-values\";\n\nexport type EShapeActionValueChangeColorTargetColorOrAlpha =\n\t| typeof EShapeActionValueChangeColorTarget.COLOR_AND_ALPHA\n\t| typeof EShapeActionValueChangeColorTarget.COLOR\n\t| typeof EShapeActionValueChangeColorTarget.ALPHA;\n\nexport type EShapeActionValueChangeColorSerialized = [\n\ttypeof EShapeActionValueType.CHANGE_COLOR,\n\tnumber,\n\tEShapeActionValueChangeColorType,\n\tEShapeActionValueChangeColorTargetColorOrAlpha,\n\tnumber,\n\tnumber,\n\tnumber\n];\n\nexport type EShapeActionValueChangeColorSerializedLegacy = [\n\ttypeof EShapeActionValueType.CHANGE_COLOR_LEGACY,\n\tnumber,\n\tEShapeActionValueChangeColorTypeLegacy,\n\tEShapeActionValueChangeColorTargetColorOrAlpha,\n\tnumber,\n\tnumber,\n\tnumber\n];\n\nexport class EShapeActionValueChangeColor extends EShapeActionValueSubtyped<EShapeActionValueChangeColorType> {\n\treadonly target: EShapeActionValueChangeColorTargetColorOrAlpha;\n\treadonly color: number;\n\treadonly alpha: number;\n\treadonly blend: string;\n\n\tconstructor(\n\t\tsubtype: EShapeActionValueChangeColorType,\n\t\tcondition: string,\n\t\ttarget: EShapeActionValueChangeColorTargetColorOrAlpha,\n\t\tcolor: number,\n\t\talpha: number,\n\t\tblend: string\n\t) {\n\t\tsuper(EShapeActionValueType.CHANGE_COLOR, condition, subtype);\n\t\tthis.target = target;\n\t\tthis.color = color;\n\t\tthis.alpha = alpha;\n\t\tthis.blend = blend;\n\t}\n\n\tisEquals(value: EShapeActionValue): boolean {\n\t\treturn (\n\t\t\tsuper.isEquals(value) &&\n\t\t\tvalue instanceof EShapeActionValueChangeColor &&\n\t\t\tthis.target === value.target &&\n\t\t\tthis.color === value.color &&\n\t\t\tthis.alpha === value.alpha &&\n\t\t\tthis.blend === value.blend\n\t\t);\n\t}\n\n\ttoRuntime(): EShapeActionRuntimeChangeColor {\n\t\treturn new EShapeActionRuntimeChangeColor(this);\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\tconst conditionId = manager.addResource(this.condition);\n\t\tconst blendId = manager.addResource(this.blend);\n\t\treturn manager.addResource(\n\t\t\t`[${this.type},${conditionId},${this.subtype},${this.target},${this.color},${this.alpha},${blendId}]`\n\t\t);\n\t}\n\n\tstatic deserialize(\n\t\tserialized:\n\t\t\t| EShapeActionValueChangeColorSerialized\n\t\t\t| EShapeActionValueChangeColorSerializedLegacy,\n\t\tmanager: EShapeResourceManagerDeserialization\n\t): EShapeActionValueChangeColor {\n\t\tconst subtype = EShapeActionValueChangeColorTypes.from(serialized);\n\t\tconst condition = EShapeActionValues.toResource(1, serialized, manager.resources);\n\t\tconst blend = EShapeActionValues.toResource(6, serialized, manager.resources);\n\t\treturn new EShapeActionValueChangeColor(\n\t\t\tsubtype,\n\t\t\tcondition,\n\t\t\tserialized[3],\n\t\t\tserialized[4],\n\t\t\tserialized[5],\n\t\t\tblend\n\t\t);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { UtilRgb } from \"../../util/util-rgb\";\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\nimport { EShapeActionBases } from \"./e-shape-action-bases\";\nimport { EShapeActionExpression } from \"./e-shape-action-expression\";\nimport { EShapeActionExpressions } from \"./e-shape-action-expressions\";\nimport { EShapeActionRuntimeChangeColorBase } from \"./e-shape-action-runtime-change-color-base\";\nimport { EShapeActionValueChangeColorBrightness } from \"./e-shape-action-value-change-color-brightness\";\n\nexport class EShapeActionRuntimeChangeColorBrightness extends EShapeActionRuntimeChangeColorBase {\n\tprotected readonly brightness: EShapeActionExpression<number | null>;\n\n\tconstructor(value: EShapeActionValueChangeColorBrightness) {\n\t\tsuper(value);\n\t\tthis.brightness = EShapeActionExpressions.ofNumberOrNull(value.brightness);\n\t}\n\n\texecute(shape: EShape, runtime: EShapeRuntime, time: number): void {\n\t\tif (this.condition(shape, time)) {\n\t\t\tconst brightness = this.brightness(shape, time);\n\t\t\tthis.set(shape, runtime, time, brightness);\n\t\t}\n\t}\n\n\tprotected set(\n\t\tshape: EShape,\n\t\truntime: EShapeRuntime,\n\t\ttime: number,\n\t\tbrightness: number | null\n\t): void {\n\t\tconst reset = this.reset;\n\t\tif (brightness != null) {\n\t\t\tconst toAdjusted = this.toAdjusted;\n\n\t\t\tif (reset & EShapeRuntimeReset.COLOR_FILL) {\n\t\t\t\tconst base = EShapeActionBases.toBaseFill(shape, runtime);\n\t\t\t\tshape.fill.set(undefined, toAdjusted(base.color, brightness), base.alpha);\n\t\t\t}\n\t\t\tif (reset & EShapeRuntimeReset.COLOR_STROKE) {\n\t\t\t\tconst base = EShapeActionBases.toBaseStroke(shape, runtime);\n\t\t\t\tshape.stroke.set(undefined, toAdjusted(base.color, brightness), base.alpha);\n\t\t\t}\n\t\t\tif (reset & EShapeRuntimeReset.COLOR_TEXT) {\n\t\t\t\tconst base = EShapeActionBases.toBaseText(shape, runtime);\n\t\t\t\tshape.text.set(undefined, toAdjusted(base.color, brightness), base.alpha);\n\t\t\t}\n\t\t\tif (reset & EShapeRuntimeReset.COLOR_TEXT_OUTLINE) {\n\t\t\t\tconst base = EShapeActionBases.toBaseTextOutline(shape, runtime);\n\t\t\t\tshape.text.outline.set(undefined, toAdjusted(base.color, brightness), base.alpha);\n\t\t\t}\n\t\t\truntime.written |= reset;\n\t\t}\n\t}\n\n\tprotected toAdjusted(color: number, brightness: number): number {\n\t\tif (0 <= brightness) {\n\t\t\treturn UtilRgb.brighten(color, +brightness);\n\t\t} else {\n\t\t\treturn UtilRgb.darken(color, -brightness);\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShapeActionRuntimeChangeColorBrightness } from \"./e-shape-action-runtime-change-color-brightness\";\nimport { EShapeActionValue } from \"./e-shape-action-value\";\nimport { EShapeActionValueChangeColorTarget } from \"./e-shape-action-value-change-color-target\";\nimport { EShapeActionValueChangeColorType } from \"./e-shape-action-value-change-color-type\";\nimport { EShapeActionValueChangeColorTypeLegacy } from \"./e-shape-action-value-change-color-type-legacy\";\nimport { EShapeActionValueChangeColorTypes } from \"./e-shape-action-value-change-color-types\";\nimport { EShapeActionValueSubtyped } from \"./e-shape-action-value-subtyped\";\nimport { EShapeActionValueType } from \"./e-shape-action-value-type\";\nimport { EShapeActionValues } from \"./e-shape-action-values\";\n\nexport type EShapeActionValueChangeColorBrightnessSerialized = [\n\ttypeof EShapeActionValueType.CHANGE_COLOR,\n\tnumber,\n\tEShapeActionValueChangeColorType,\n\ttypeof EShapeActionValueChangeColorTarget.BRIGHTNESS,\n\tnumber\n];\n\nexport type EShapeActionValueChangeColorBrightnessSerializedLegacy = [\n\ttypeof EShapeActionValueType.CHANGE_COLOR_LEGACY,\n\tnumber,\n\tEShapeActionValueChangeColorTypeLegacy,\n\ttypeof EShapeActionValueChangeColorTarget.BRIGHTNESS,\n\tnumber\n];\n\nexport class EShapeActionValueChangeColorBrightness extends EShapeActionValueSubtyped<EShapeActionValueChangeColorType> {\n\treadonly brightness: string;\n\n\tconstructor(subtype: EShapeActionValueChangeColorType, condition: string, brightness: string) {\n\t\tsuper(EShapeActionValueType.CHANGE_COLOR, condition, subtype);\n\t\tthis.brightness = brightness;\n\t}\n\n\tisEquals(value: EShapeActionValue): boolean {\n\t\treturn (\n\t\t\tsuper.isEquals(value) &&\n\t\t\tvalue instanceof EShapeActionValueChangeColorBrightness &&\n\t\t\tthis.brightness === value.brightness\n\t\t);\n\t}\n\n\ttoRuntime(): EShapeActionRuntimeChangeColorBrightness {\n\t\treturn new EShapeActionRuntimeChangeColorBrightness(this);\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\tconst conditionId = manager.addResource(this.condition);\n\t\tconst target = EShapeActionValueChangeColorTarget.BRIGHTNESS;\n\t\tconst brightnessId = manager.addResource(this.brightness);\n\t\treturn manager.addResource(\n\t\t\t`[${this.type},${conditionId},${this.subtype},${target},${brightnessId}]`\n\t\t);\n\t}\n\n\tstatic deserialize(\n\t\tserialized:\n\t\t\t| EShapeActionValueChangeColorBrightnessSerialized\n\t\t\t| EShapeActionValueChangeColorBrightnessSerializedLegacy,\n\t\tmanager: EShapeResourceManagerDeserialization\n\t): EShapeActionValueChangeColorBrightness {\n\t\tconst subtype = EShapeActionValueChangeColorTypes.from(serialized);\n\t\tconst condition = EShapeActionValues.toResource(1, serialized, manager.resources);\n\t\tconst brightness = EShapeActionValues.toResource(4, serialized, manager.resources);\n\t\treturn new EShapeActionValueChangeColorBrightness(subtype, condition, brightness);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime } from \"../e-shape-runtime\";\nimport { EShapeActionExpression } from \"./e-shape-action-expression\";\nimport { EShapeActionExpressions } from \"./e-shape-action-expressions\";\nimport { EShapeActionRuntimeChangeColorBase } from \"./e-shape-action-runtime-change-color-base\";\nimport { EShapeActionValueChangeColorCode } from \"./e-shape-action-value-change-color-code\";\n\nexport class EShapeActionRuntimeChangeColorCode extends EShapeActionRuntimeChangeColorBase {\n\tprotected readonly color: EShapeActionExpression<number | null>;\n\tprotected readonly alpha: EShapeActionExpression<number | null>;\n\tprotected readonly blend: EShapeActionExpression<number | null>;\n\n\tconstructor(value: EShapeActionValueChangeColorCode) {\n\t\tsuper(value);\n\t\tthis.color = EShapeActionExpressions.ofNumberOrNull(value.color);\n\t\tthis.alpha = EShapeActionExpressions.ofNumberOrNull(value.alpha);\n\t\tthis.blend = EShapeActionExpressions.ofNumberOrNull(value.blend);\n\t}\n\n\texecute(shape: EShape, runtime: EShapeRuntime, time: number): void {\n\t\tif (this.condition(shape, time)) {\n\t\t\tconst color = this.color(shape, time);\n\t\t\tconst alpha = this.alpha(shape, time);\n\t\t\tconst blend = this.blend(shape, time);\n\t\t\tthis.set(shape, runtime, time, color, alpha, blend);\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShapeActionRuntimeChangeColorCode } from \"./e-shape-action-runtime-change-color-code\";\nimport { EShapeActionValue } from \"./e-shape-action-value\";\nimport { EShapeActionValueChangeColorTarget } from \"./e-shape-action-value-change-color-target\";\nimport { EShapeActionValueChangeColorTypeLegacy } from \"./e-shape-action-value-change-color-type-legacy\";\nimport { EShapeActionValueChangeColorType } from \"./e-shape-action-value-change-color-type\";\nimport { EShapeActionValueSubtyped } from \"./e-shape-action-value-subtyped\";\nimport { EShapeActionValueType } from \"./e-shape-action-value-type\";\nimport { EShapeActionValues } from \"./e-shape-action-values\";\nimport { EShapeActionValueChangeColorTypes } from \"./e-shape-action-value-change-color-types\";\n\nexport type EShapeActionValueChangeColorCodeSerialized = [\n\ttypeof EShapeActionValueType.CHANGE_COLOR,\n\tnumber,\n\tEShapeActionValueChangeColorType,\n\ttypeof EShapeActionValueChangeColorTarget.CODE,\n\tnumber,\n\tnumber,\n\tnumber\n];\n\nexport type EShapeActionValueChangeColorCodeSerializedLegacy = [\n\ttypeof EShapeActionValueType.CHANGE_COLOR_LEGACY,\n\tnumber,\n\tEShapeActionValueChangeColorTypeLegacy,\n\ttypeof EShapeActionValueChangeColorTarget.CODE,\n\tnumber,\n\tnumber,\n\tnumber\n];\n\nexport class EShapeActionValueChangeColorCode extends EShapeActionValueSubtyped<EShapeActionValueChangeColorType> {\n\treadonly color: string;\n\treadonly alpha: string;\n\treadonly blend: string;\n\n\tconstructor(\n\t\tsubtype: EShapeActionValueChangeColorType,\n\t\tcondition: string,\n\t\tcolor: string,\n\t\talpha: string,\n\t\tblend: string\n\t) {\n\t\tsuper(EShapeActionValueType.CHANGE_COLOR, condition, subtype);\n\t\tthis.color = color;\n\t\tthis.alpha = alpha;\n\t\tthis.blend = blend;\n\t}\n\n\tisEquals(value: EShapeActionValue): boolean {\n\t\treturn (\n\t\t\tsuper.isEquals(value) &&\n\t\t\tvalue instanceof EShapeActionValueChangeColorCode &&\n\t\t\tthis.color === value.color &&\n\t\t\tthis.alpha === value.alpha &&\n\t\t\tthis.blend === value.blend\n\t\t);\n\t}\n\n\ttoRuntime(): EShapeActionRuntimeChangeColorCode {\n\t\treturn new EShapeActionRuntimeChangeColorCode(this);\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\tconst conditionId = manager.addResource(this.condition);\n\t\tconst target = EShapeActionValueChangeColorTarget.CODE;\n\t\tconst colorId = manager.addResource(this.color);\n\t\tconst alphaId = manager.addResource(this.alpha);\n\t\tconst blendId = manager.addResource(this.blend);\n\t\treturn manager.addResource(\n\t\t\t`[${this.type},${conditionId},${this.subtype},${target},${colorId},${alphaId},${blendId}]`\n\t\t);\n\t}\n\n\tstatic deserialize(\n\t\tserialized:\n\t\t\t| EShapeActionValueChangeColorCodeSerialized\n\t\t\t| EShapeActionValueChangeColorCodeSerializedLegacy,\n\t\tmanager: EShapeResourceManagerDeserialization\n\t): EShapeActionValueChangeColorCode {\n\t\tconst subtype = EShapeActionValueChangeColorTypes.from(serialized);\n\t\tconst condition = EShapeActionValues.toResource(1, serialized, manager.resources);\n\t\tconst color = EShapeActionValues.toResource(4, serialized, manager.resources);\n\t\tconst alpha = EShapeActionValues.toResource(5, serialized, manager.resources);\n\t\tconst blend = EShapeActionValues.toResource(6, serialized, manager.resources);\n\t\treturn new EShapeActionValueChangeColorCode(subtype, condition, color, alpha, blend);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\nimport { EShapeActionExpression } from \"./e-shape-action-expression\";\nimport { EShapeActionExpressions } from \"./e-shape-action-expressions\";\nimport { EShapeActionRuntimeConditional } from \"./e-shape-action-runtime-conditional\";\nimport { EShapeActionValueChangeCursor } from \"./e-shape-action-value-change-cursor\";\n\nexport class EShapeActionRuntimeChangeCursor extends EShapeActionRuntimeConditional {\n\tprotected name: EShapeActionExpression<string | null>;\n\n\tconstructor(value: EShapeActionValueChangeCursor) {\n\t\tsuper(value, EShapeRuntimeReset.CURSOR);\n\t\tthis.name = EShapeActionExpressions.ofStringOrNull(value.name);\n\t}\n\n\texecute(shape: EShape, runtime: EShapeRuntime, time: number): void {\n\t\tif (this.condition(shape, time)) {\n\t\t\tconst name = this.name(shape, time);\n\t\t\tif (name != null) {\n\t\t\t\tshape.cursor = name;\n\t\t\t\truntime.written |= this.reset;\n\t\t\t}\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShapeActionRuntimeChangeCursor } from \"./e-shape-action-runtime-change-cursor\";\nimport { EShapeActionValue } from \"./e-shape-action-value\";\nimport { EShapeActionValueBase } from \"./e-shape-action-value-base\";\nimport { EShapeActionValueType } from \"./e-shape-action-value-type\";\nimport { EShapeActionValues } from \"./e-shape-action-values\";\n\nexport type EShapeActionValueChangeCursorSerialized = [\n\ttypeof EShapeActionValueType.CHANGE_CURSOR,\n\tnumber,\n\tnumber\n];\n\nexport class EShapeActionValueChangeCursor extends EShapeActionValueBase {\n\treadonly name: string;\n\n\tconstructor(condition: string, name: string) {\n\t\tsuper(EShapeActionValueType.CHANGE_CURSOR, condition);\n\t\tthis.name = name;\n\t}\n\n\tisEquals(value: EShapeActionValue): boolean {\n\t\treturn (\n\t\t\tsuper.isEquals(value) &&\n\t\t\tvalue instanceof EShapeActionValueChangeCursor &&\n\t\t\tthis.name === value.name\n\t\t);\n\t}\n\n\ttoRuntime(): EShapeActionRuntimeChangeCursor {\n\t\treturn new EShapeActionRuntimeChangeCursor(this);\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\tconst conditionId = manager.addResource(this.condition);\n\t\tconst nameId = manager.addResource(this.name);\n\t\treturn manager.addResource(`[${this.type},${conditionId},${nameId}]`);\n\t}\n\n\tstatic deserialize(\n\t\tserialized: EShapeActionValueChangeCursorSerialized,\n\t\tmanager: EShapeResourceManagerDeserialization\n\t): EShapeActionValueChangeCursor {\n\t\tconst condition = EShapeActionValues.toResource(1, serialized, manager.resources);\n\t\tconst name = EShapeActionValues.toResource(2, serialized, manager.resources);\n\t\treturn new EShapeActionValueChangeCursor(condition, name);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { FormatNode } from \"./format-node\";\n\nexport class FormatNodeA implements FormatNode {\n\tformat(target: number, step: number, date: Date): string {\n\t\treturn date.getHours() < 12 ? \"AM\" : \"PM\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { FormatNode } from \"./format-node\";\n\nexport class FormatNodea implements FormatNode {\n\tformat(target: number, step: number, date: Date): string {\n\t\treturn date.getHours() < 12 ? \"am\" : \"pm\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { FormatNode } from \"./format-node\";\n\nexport class FormatNodeD implements FormatNode {\n\tformat(target: number, step: number, date: Date): string {\n\t\treturn String(date.getDate());\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { FormatNode } from \"./format-node\";\n\nexport class FormatNoded implements FormatNode {\n\tformat(target: number, step: number, date: Date): string {\n\t\treturn `${target | 0}`;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { FormatNode } from \"./format-node\";\n\nexport abstract class FormatNodePrecision implements FormatNode {\n\tprotected precision: number | undefined;\n\n\tconstructor(precision?: string) {\n\t\tif (precision != null) {\n\t\t\tthis.precision = +precision.substring(1, precision.length);\n\t\t} else {\n\t\t\tthis.precision = undefined;\n\t\t}\n\t}\n\n\tabstract format(target: number, step: number, date: Date): string;\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { FormatNodePrecision } from \"./format-node-precision\";\n\nexport class FormatNodee extends FormatNodePrecision {\n\tformat(target: number, step: number, date: Date): string {\n\t\treturn target.toExponential(this.precision);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { FormatNodePrecision } from \"./format-node-precision\";\n\nexport class FormatNodef extends FormatNodePrecision {\n\tformat(target: number, step: number, date: Date): string {\n\t\treturn target.toFixed(this.precision);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { FormatNodePrecision } from \"./format-node-precision\";\n\nexport class FormatNodefsi extends FormatNodePrecision {\n\tformat(target: number, step: number, date: Date): string {\n\t\tconst abs = this.toAbs(target, step, date);\n\t\tif (abs < 1e-24) {\n\t\t\treturn this.format_(target, 1, \"\");\n\t\t} else if (abs < 1e-21) {\n\t\t\treturn this.format_(target, 1e24, \"y\");\n\t\t} else if (abs < 1e-18) {\n\t\t\treturn this.format_(target, 1e21, \"z\");\n\t\t} else if (abs < 1e-15) {\n\t\t\treturn this.format_(target, 1e18, \"a\");\n\t\t} else if (abs < 1e-12) {\n\t\t\treturn this.format_(target, 1e15, \"f\");\n\t\t} else if (abs < 1e-9) {\n\t\t\treturn this.format_(target, 1e12, \"p\");\n\t\t} else if (abs < 1e-6) {\n\t\t\treturn this.format_(target, 1e9, \"n\");\n\t\t} else if (abs < 1e-3) {\n\t\t\treturn this.format_(target, 1e6, \"\");\n\t\t} else if (abs < 1) {\n\t\t\treturn this.format_(target, 1e3, \"m\");\n\t\t} else if (abs < 1e3) {\n\t\t\treturn this.format_(target, 1, \"\");\n\t\t} else if (abs < 1e6) {\n\t\t\treturn this.format_(target, 1e-3, \"k\");\n\t\t} else if (abs < 1e9) {\n\t\t\treturn this.format_(target, 1e-6, \"M\");\n\t\t} else if (abs < 1e12) {\n\t\t\treturn this.format_(target, 1e-9, \"G\");\n\t\t} else if (abs < 1e15) {\n\t\t\treturn this.format_(target, 1e-12, \"T\");\n\t\t} else if (abs < 1e18) {\n\t\t\treturn this.format_(target, 1e-15, \"P\");\n\t\t} else if (abs < 1e21) {\n\t\t\treturn this.format_(target, 1e-18, \"E\");\n\t\t} else if (abs < 1e24) {\n\t\t\treturn this.format_(target, 1e-21, \"Z\");\n\t\t} else {\n\t\t\treturn this.format_(target, 1e-24, \"Y\");\n\t\t}\n\t}\n\n\tprotected toAbs(target: number, step: number, date: Date): number {\n\t\treturn Math.abs(target);\n\t}\n\n\tprotected format_(target: number, unitInverse: number, postfix: string): string {\n\t\tconst value = target * unitInverse;\n\t\treturn `${value.toFixed(this.precision)}${postfix}`;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { FormatNodePrecision } from \"./format-node-precision\";\n\nexport class FormatNodeg extends FormatNodePrecision {\n\tformat(target: number, step: number, date: Date): string {\n\t\treturn target.toPrecision(this.precision);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { FormatNode } from \"./format-node\";\n\nexport class FormatNodeH implements FormatNode {\n\tformat(target: number, step: number, date: Date): string {\n\t\treturn String(date.getHours());\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { FormatNode } from \"./format-node\";\n\nexport class FormatNodeh implements FormatNode {\n\tformat(target: number, step: number, date: Date): string {\n\t\treturn String(date.getHours() % 12);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { FormatNode } from \"./format-node\";\n\nexport class FormatNodeM implements FormatNode {\n\tformat(target: number, step: number, date: Date): string {\n\t\treturn String(date.getMonth() + 1);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { FormatNode } from \"./format-node\";\n\nexport class FormatNodem implements FormatNode {\n\tformat(target: number, step: number, date: Date): string {\n\t\treturn String(date.getMinutes());\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { FormatNode } from \"./format-node\";\n\nexport class FormatNodemi implements FormatNode {\n\tformat(target: number, step: number, date: Date): string {\n\t\treturn String(date.getMilliseconds());\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { FormatNode } from \"./format-node\";\n\nexport class FormatNodeP implements FormatNode {\n\tformat(target: number, step: number, date: Date): string {\n\t\treturn `${(target * 100) | 0}%`;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { FormatNode } from \"./format-node\";\n\nexport class FormatNodep implements FormatNode {\n\tformat(target: number, step: number, date: Date): string {\n\t\treturn `${target | 0}%`;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { toPadded } from \"../to-padded\";\nimport { FormatNode } from \"./format-node\";\n\nexport class FormatNodePadding implements FormatNode {\n\tprotected length: number;\n\tprotected character: string;\n\tprotected node: FormatNode;\n\n\tconstructor(length: number, character: string, node: FormatNode) {\n\t\tthis.length = length;\n\t\tthis.character = character;\n\t\tthis.node = node;\n\t}\n\n\tformat(target: number, step: number, date: Date): string {\n\t\treturn toPadded(this.node.format(target, step, date), this.length, this.character);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { FormatNode } from \"./format-node\";\n\nexport class FormatNodeParenthesis {\n\tprotected node: FormatNode;\n\n\tconstructor(node: FormatNode) {\n\t\tthis.node = node;\n\t}\n\n\tformat(target: number, step: number, date: Date): string {\n\t\tconst result = this.node.format(target, step, date);\n\t\tif (0 < result.length && result[0] === \"-\") {\n\t\t\treturn `(${result.substring(1, result.length)})`;\n\t\t}\n\t\treturn result;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { FormatNode } from \"./format-node\";\n\nexport class FormatNodePlus implements FormatNode {\n\tprotected node: FormatNode;\n\n\tconstructor(node: FormatNode) {\n\t\tthis.node = node;\n\t}\n\n\tformat(target: number, step: number, date: Date): string {\n\t\tconst result = this.node.format(target, step, date);\n\t\tif (0 < result.length && result[0] !== \"-\") {\n\t\t\treturn `+${result}`;\n\t\t}\n\t\treturn result;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { FormatNode } from \"./format-node\";\n\nexport class FormatNodeRP implements FormatNode {\n\tformat(target: number, step: number, date: Date): string {\n\t\treturn `${Math.round(target * 100)}%`;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { FormatNode } from \"./format-node\";\n\nexport class FormatNoderp implements FormatNode {\n\tformat(target: number, step: number, date: Date): string {\n\t\treturn `${Math.round(target)}%`;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { FormatNode } from \"./format-node\";\n\nexport class FormatNodesdt implements FormatNode {\n\tprotected Y: FormatNode;\n\tprotected M: FormatNode;\n\tprotected D: FormatNode;\n\tprotected H: FormatNode;\n\tprotected m: FormatNode;\n\tprotected s: FormatNode;\n\tprotected mi: FormatNode;\n\n\tconstructor(\n\t\tY: FormatNode,\n\t\tM: FormatNode,\n\t\tD: FormatNode,\n\t\tH: FormatNode,\n\t\tm: FormatNode,\n\t\ts: FormatNode,\n\t\tmi: FormatNode\n\t) {\n\t\tthis.Y = Y;\n\t\tthis.M = M;\n\t\tthis.D = D;\n\t\tthis.H = H;\n\t\tthis.m = m;\n\t\tthis.s = s;\n\t\tthis.mi = mi;\n\t}\n\n\tformat(target: number, step: number, date: Date): string {\n\t\tif (step < 1000) {\n\t\t\treturn `${this.s.format(target, step, date)}.${this.mi.format(target, step, date)}`;\n\t\t} else if (step < 60000) {\n\t\t\treturn `${this.m.format(target, step, date)}:${this.s.format(target, step, date)}`;\n\t\t} else if (step < 3600000) {\n\t\t\treturn `${this.H.format(target, step, date)}:${this.m.format(target, step, date)}`;\n\t\t} else if (step < 86400000) {\n\t\t\tconst M = this.M.format(target, step, date);\n\t\t\tconst D = this.D.format(target, step, date);\n\t\t\treturn `${M}/${D} ${this.H.format(target, step, date)}`;\n\t\t} else if (step < 2592000000) {\n\t\t\treturn `${this.M.format(target, step, date)}/${this.D.format(target, step, date)}`;\n\t\t} else {\n\t\t\treturn `${this.Y.format(target, step, date)}/${this.M.format(target, step, date)}`;\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { FormatNode } from \"./format-node\";\n\nexport class FormatNodeSpace {\n\tprotected node: FormatNode;\n\n\tconstructor(node: FormatNode) {\n\t\tthis.node = node;\n\t}\n\n\tformat(target: number, step: number, date: Date): string {\n\t\tconst result = this.node.format(target, step, date);\n\t\tif (0 < result.length && result[0] !== \"-\") {\n\t\t\treturn ` ${result}`;\n\t\t}\n\t\treturn result;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { FormatNodefsi } from \"./format-node-fsi\";\n\nexport class FormatNodessi extends FormatNodefsi {\n\tprotected toAbs(target: number, step: number, date: Date): number {\n\t\treturn Math.abs(step);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { FormatNode } from \"./format-node\";\n\nexport class FormatNodeString implements FormatNode {\n\tprotected str: string;\n\n\tconstructor(str: string) {\n\t\tthis.str = str;\n\t}\n\n\tformat(target: number, step: number, date: Date): string {\n\t\treturn this.str;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { FormatNode } from \"./format-node\";\n\nexport class FormatNodeY implements FormatNode {\n\tformat(target: number, step: number, date: Date): string {\n\t\treturn String(date.getFullYear());\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { FormatNode } from \"./format-node\";\n\nexport class FormatNodey implements FormatNode {\n\tformat(target: number, step: number, date: Date): string {\n\t\treturn String(date.getFullYear() % 100);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { toPadded } from \"../to-padded\";\nimport { FormatNode } from \"./format-node\";\n\nexport class FormatNodez implements FormatNode {\n\tformat(target: number, step: number, date: Date): string {\n\t\tconst z = date.getTimezoneOffset();\n\t\tconst tzs = z <= 0 ? \"+\" : \"-\";\n\t\tconst tzh = toPadded(String(Math.floor(Math.abs(z) / 60)), 2, \"0\");\n\t\tconst tzm = toPadded(String(Math.floor(Math.abs(z) % 60)), 2, \"0\");\n\t\treturn `${tzs}${tzh}:${tzm}`;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { FormatNode } from \"./format-node\";\n\nexport class FormatNoderd implements FormatNode {\n\tformat(target: number, step: number, date: Date): string {\n\t\treturn `${Math.round(target)}`;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { FormatNode } from \"./format-node\";\n\nexport class FormatNodes implements FormatNode {\n\tformat(target: number, step: number, date: Date): string {\n\t\treturn String(date.getSeconds());\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { FormatNode } from \"./format-node/format-node\";\nimport { FormatNodeA } from \"./format-node/format-node-a-large\";\nimport { FormatNodea } from \"./format-node/format-node-a-small\";\nimport { FormatNodeD } from \"./format-node/format-node-d-large\";\nimport { FormatNoded } from \"./format-node/format-node-d-small\";\nimport { FormatNodee } from \"./format-node/format-node-e\";\nimport { FormatNodef } from \"./format-node/format-node-f\";\nimport { FormatNodefsi } from \"./format-node/format-node-fsi\";\nimport { FormatNodeg } from \"./format-node/format-node-g\";\nimport { FormatNodeH } from \"./format-node/format-node-h-large\";\nimport { FormatNodeh } from \"./format-node/format-node-h-small\";\nimport { FormatNodeM } from \"./format-node/format-node-m-large\";\nimport { FormatNodem } from \"./format-node/format-node-m-small\";\nimport { FormatNodemi } from \"./format-node/format-node-mi\";\nimport { FormatNodeP } from \"./format-node/format-node-p-large\";\nimport { FormatNodep } from \"./format-node/format-node-p-small\";\nimport { FormatNodePadding } from \"./format-node/format-node-padding\";\nimport { FormatNodeParenthesis } from \"./format-node/format-node-parenthesis\";\nimport { FormatNodePlus } from \"./format-node/format-node-plus\";\nimport { FormatNodeRP } from \"./format-node/format-node-rp-large\";\nimport { FormatNoderp } from \"./format-node/format-node-rp-small\";\nimport { FormatNodesdt } from \"./format-node/format-node-sdt\";\nimport { FormatNodeSpace } from \"./format-node/format-node-space\";\nimport { FormatNodessi } from \"./format-node/format-node-ssi\";\nimport { FormatNodeString } from \"./format-node/format-node-string\";\nimport { FormatNodeY } from \"./format-node/format-node-y-large\";\nimport { FormatNodey } from \"./format-node/format-node-y-small\";\nimport { FormatNodez } from \"./format-node/format-node-z\";\nimport { FormatNoderd } from \"./format-node/format-node-rd\";\nimport { FormatNodes } from \"./format-node/format-nodes\";\nimport { NumberFormatter } from \"./number-formatter\";\n\nlet REGEXP: RegExp | undefined = undefined;\n\nconst getRegExp = (): RegExp => {\n\tlet result = REGEXP;\n\tif (result) {\n\t\tresult.lastIndex = 0;\n\t} else {\n\t\tresult =\n\t\t\t/%(0|_|-|\\+|\\()?(\\.\\d+)?(Y(?:MD?)?|y(?:MD?)?|MD?|D|H(?:ms?)?|h(?:ms?)?|m(?:i|s)?|a|A|s(?:s?i|dt)?|z|%|f(?:si)?|e|g|d|r(?:d|p)|p|P|RP)/g;\n\t\tREGEXP = result;\n\t}\n\treturn result;\n};\n\nconst toModifiedDatetime = (modifier: string, length: number, node: FormatNode): FormatNode => {\n\tswitch (modifier) {\n\t\tcase \"_\":\n\t\t\treturn new FormatNodePadding(length, \" \", node);\n\t\tcase \"-\":\n\t\t\treturn node;\n\t\tdefault:\n\t\t\treturn new FormatNodePadding(length, \"0\", node);\n\t}\n};\n\nconst toModifiedNumber = (modifier: string, node: FormatNode): FormatNode => {\n\tswitch (modifier) {\n\t\tcase \"_\": // space for non-negative numbers\n\t\t\treturn new FormatNodeSpace(node);\n\t\tcase \"+\": // plus sign for non-negative numbers\n\t\t\treturn new FormatNodePlus(node);\n\t\tcase \"(\": // parenthesis for the negative numbers\n\t\t\treturn new FormatNodeParenthesis(node);\n\t\tdefault:\n\t\t\treturn node;\n\t}\n};\n\ninterface Parsed {\n\t/** Nodes */\n\tnodes: FormatNode[];\n\n\t/** True if nodes contains nodes which requires a date object */\n\tdate: boolean;\n}\n\nconst toParsed = (format: string): Parsed => {\n\tlet previousIndex = 0;\n\tlet isDateRequired = false;\n\tconst result: FormatNode[] = [];\n\tconst regExp = getRegExp();\n\twhile (true) {\n\t\tconst matched = regExp.exec(format);\n\t\tif (matched != null) {\n\t\t\tconst index = matched.index;\n\t\t\tif (previousIndex < index) {\n\t\t\t\tresult.push(new FormatNodeString(format.substring(previousIndex, index)));\n\t\t\t}\n\t\t\tpreviousIndex = index + matched[0].length;\n\n\t\t\tconst all = matched[0];\n\t\t\tconst modifier = matched[1];\n\t\t\tconst precision = matched[2];\n\t\t\tconst specifier = matched[3];\n\n\t\t\tswitch (specifier) {\n\t\t\t\tcase \"Y\": // full year\n\t\t\t\t\tisDateRequired = true;\n\t\t\t\t\tresult.push(new FormatNodeY());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"YM\":\n\t\t\t\t\tisDateRequired = true;\n\t\t\t\t\tresult.push(\n\t\t\t\t\t\tnew FormatNodeY(),\n\t\t\t\t\t\tnew FormatNodeString(\"/\"),\n\t\t\t\t\t\ttoModifiedDatetime(modifier, 2, new FormatNodeM())\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"YMD\":\n\t\t\t\t\tisDateRequired = true;\n\t\t\t\t\tresult.push(\n\t\t\t\t\t\tnew FormatNodeY(),\n\t\t\t\t\t\tnew FormatNodeString(\"/\"),\n\t\t\t\t\t\ttoModifiedDatetime(modifier, 2, new FormatNodeM()),\n\t\t\t\t\t\tnew FormatNodeString(\"/\"),\n\t\t\t\t\t\ttoModifiedDatetime(modifier, 2, new FormatNodeD())\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"y\": // short year: [0, 99]\n\t\t\t\t\tisDateRequired = true;\n\t\t\t\t\tresult.push(toModifiedDatetime(modifier, 2, new FormatNodey()));\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"yM\":\n\t\t\t\t\tisDateRequired = true;\n\t\t\t\t\tresult.push(\n\t\t\t\t\t\ttoModifiedDatetime(modifier, 2, new FormatNodey()),\n\t\t\t\t\t\tnew FormatNodeString(\"/\"),\n\t\t\t\t\t\ttoModifiedDatetime(modifier, 2, new FormatNodeM())\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"yMD\":\n\t\t\t\t\tresult.push(\n\t\t\t\t\t\ttoModifiedDatetime(modifier, 2, new FormatNodey()),\n\t\t\t\t\t\tnew FormatNodeString(\"/\"),\n\t\t\t\t\t\ttoModifiedDatetime(modifier, 2, new FormatNodeM()),\n\t\t\t\t\t\tnew FormatNodeString(\"/\"),\n\t\t\t\t\t\ttoModifiedDatetime(modifier, 2, new FormatNodeD())\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"M\": // month: [1, 12]\n\t\t\t\t\tisDateRequired = true;\n\t\t\t\t\tresult.push(toModifiedDatetime(modifier, 2, new FormatNodeM()));\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"MD\":\n\t\t\t\t\tisDateRequired = true;\n\t\t\t\t\tresult.push(\n\t\t\t\t\t\ttoModifiedDatetime(modifier, 2, new FormatNodeM()),\n\t\t\t\t\t\tnew FormatNodeString(\"/\"),\n\t\t\t\t\t\ttoModifiedDatetime(modifier, 2, new FormatNodeD())\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"D\": // day of the month: [1, 31]\n\t\t\t\t\tisDateRequired = true;\n\t\t\t\t\tresult.push(toModifiedDatetime(modifier, 2, new FormatNodeD()));\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"H\": // 24-hour clock: [0, 23]\n\t\t\t\t\tisDateRequired = true;\n\t\t\t\t\tresult.push(toModifiedDatetime(modifier, 2, new FormatNodeH()));\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"Hm\":\n\t\t\t\t\tisDateRequired = true;\n\t\t\t\t\tresult.push(\n\t\t\t\t\t\ttoModifiedDatetime(modifier, 2, new FormatNodeH()),\n\t\t\t\t\t\tnew FormatNodeString(\":\"),\n\t\t\t\t\t\ttoModifiedDatetime(modifier, 2, new FormatNodem())\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"Hms\":\n\t\t\t\t\tisDateRequired = true;\n\t\t\t\t\tresult.push(\n\t\t\t\t\t\ttoModifiedDatetime(modifier, 2, new FormatNodeH()),\n\t\t\t\t\t\tnew FormatNodeString(\":\"),\n\t\t\t\t\t\ttoModifiedDatetime(modifier, 2, new FormatNodem()),\n\t\t\t\t\t\tnew FormatNodeString(\":\"),\n\t\t\t\t\t\ttoModifiedDatetime(modifier, 2, new FormatNodes())\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"h\": // 12-hour clock: [1, 12]\n\t\t\t\t\tisDateRequired = true;\n\t\t\t\t\tresult.push(toModifiedDatetime(modifier, 2, new FormatNodeh()));\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"hm\":\n\t\t\t\t\tisDateRequired = true;\n\t\t\t\t\tresult.push(\n\t\t\t\t\t\ttoModifiedDatetime(modifier, 2, new FormatNodeh()),\n\t\t\t\t\t\tnew FormatNodeString(\":\"),\n\t\t\t\t\t\ttoModifiedDatetime(modifier, 2, new FormatNodem())\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"hms\":\n\t\t\t\t\tisDateRequired = true;\n\t\t\t\t\tresult.push(\n\t\t\t\t\t\ttoModifiedDatetime(modifier, 2, new FormatNodeh()),\n\t\t\t\t\t\tnew FormatNodeString(\":\"),\n\t\t\t\t\t\ttoModifiedDatetime(modifier, 2, new FormatNodem()),\n\t\t\t\t\t\tnew FormatNodeString(\":\"),\n\t\t\t\t\t\ttoModifiedDatetime(modifier, 2, new FormatNodes())\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"m\": // minute [0, 59]\n\t\t\t\t\tisDateRequired = true;\n\t\t\t\t\tresult.push(toModifiedDatetime(modifier, 2, new FormatNodem()));\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"ms\":\n\t\t\t\t\tisDateRequired = true;\n\t\t\t\t\tresult.push(\n\t\t\t\t\t\ttoModifiedDatetime(modifier, 2, new FormatNodem()),\n\t\t\t\t\t\tnew FormatNodeString(\":\"),\n\t\t\t\t\t\ttoModifiedDatetime(modifier, 2, new FormatNodes())\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"mi\": // milliseconds [0, 999]\n\t\t\t\t\tisDateRequired = true;\n\t\t\t\t\tresult.push(toModifiedDatetime(modifier, 3, new FormatNodemi()));\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"a\": // am or pm\n\t\t\t\t\tisDateRequired = true;\n\t\t\t\t\tresult.push(new FormatNodea());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"A\": // AM or PM\n\t\t\t\t\tisDateRequired = true;\n\t\t\t\t\tresult.push(new FormatNodeA());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"s\": // seconds: [0, 61]\n\t\t\t\t\tisDateRequired = true;\n\t\t\t\t\tresult.push(toModifiedDatetime(modifier, 2, new FormatNodes()));\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"sdt\":\n\t\t\t\t\tisDateRequired = true;\n\t\t\t\t\tresult.push(\n\t\t\t\t\t\tnew FormatNodesdt(\n\t\t\t\t\t\t\tnew FormatNodeY(),\n\t\t\t\t\t\t\ttoModifiedDatetime(modifier, 2, new FormatNodeM()),\n\t\t\t\t\t\t\ttoModifiedDatetime(modifier, 2, new FormatNodeD()),\n\t\t\t\t\t\t\ttoModifiedDatetime(modifier, 2, new FormatNodeH()),\n\t\t\t\t\t\t\ttoModifiedDatetime(modifier, 2, new FormatNodem()),\n\t\t\t\t\t\t\ttoModifiedDatetime(modifier, 2, new FormatNodes()),\n\t\t\t\t\t\t\ttoModifiedDatetime(modifier, 3, new FormatNodemi())\n\t\t\t\t\t\t)\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"z\": // time zone\n\t\t\t\t\tisDateRequired = true;\n\t\t\t\t\tresult.push(new FormatNodez());\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"%\": // a % literal\n\t\t\t\t\tresult.push(new FormatNodeString(\"%\"));\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"f\": // fixed point notation\n\t\t\t\t\tresult.push(toModifiedNumber(modifier, new FormatNodef(precision)));\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"e\": // exponent notation\n\t\t\t\t\tresult.push(toModifiedNumber(modifier, new FormatNodee(precision)));\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"g\": // %f or %e\n\t\t\t\t\tresult.push(toModifiedNumber(modifier, new FormatNodeg(precision)));\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"rd\": // rounded decimal notation\n\t\t\t\t\tresult.push(toModifiedNumber(modifier, new FormatNoderd()));\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"d\": // decimal notation\n\t\t\t\t\tresult.push(toModifiedNumber(modifier, new FormatNoded()));\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"P\": // percent notation (Multiplied by 100)\n\t\t\t\t\tresult.push(toModifiedNumber(modifier, new FormatNodeP()));\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"p\": // percent notation (Not multiplied by 100)\n\t\t\t\t\tresult.push(toModifiedNumber(modifier, new FormatNodep()));\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"RP\": // percent notation (Multiplied by 100)\n\t\t\t\t\tresult.push(toModifiedNumber(modifier, new FormatNodeRP()));\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"rp\": // percent notation (Not multiplied by 100)\n\t\t\t\t\tresult.push(toModifiedNumber(modifier, new FormatNoderp()));\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"fsi\": // fixed point notation with a SI prefix\n\t\t\t\t\tresult.push(toModifiedNumber(modifier, new FormatNodefsi(precision)));\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"ssi\": // Step-based fixed point notation with a SI prefix\n\t\t\t\t\tresult.push(toModifiedNumber(modifier, new FormatNodessi(precision)));\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tresult.push(new FormatNodeString(all));\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t} else {\n\t\t\tif (previousIndex < format.length) {\n\t\t\t\tresult.push(new FormatNodeString(format.substring(previousIndex, format.length)));\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn {\n\t\tnodes: result,\n\t\tdate: isDateRequired\n\t};\n};\n\n/**\n * A NumberFormatter implementation class.\n */\nexport class NumberFormatterImpl implements NumberFormatter {\n\tprotected static DATE?: Date;\n\n\tprotected date: boolean;\n\tprotected nodes: FormatNode[];\n\n\tconstructor(format: string) {\n\t\tconst parsed = toParsed(format);\n\t\tthis.date = parsed.date;\n\t\tthis.nodes = parsed.nodes;\n\t}\n\n\tformat(target: number, step: number): string {\n\t\tconst nodes = this.nodes;\n\t\tlet date = NumberFormatterImpl.DATE;\n\t\tif (date == null) {\n\t\t\tdate = new Date();\n\t\t\tNumberFormatterImpl.DATE = date;\n\t\t}\n\t\tif (this.date) {\n\t\t\tdate.setTime(target);\n\t\t}\n\t\tlet result = \"\";\n\t\tfor (let i = 0, imax = nodes.length; i < imax; ++i) {\n\t\t\tresult += nodes[i].format(target, step, date);\n\t\t}\n\t\treturn result;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { NumberFormatter } from \"./number-formatter\";\nimport { NumberFormatterImpl } from \"./number-formatter-impl\";\n\n/**\n * An number formatter utility class.\n */\nexport class NumberFormatters {\n\t/**\n\t * Creates a number formatter of the given format.\n\t * Please refer to {@link NumberFormatter} for format details.\n\t *\n\t * @return A created number formatter\n\t */\n\tstatic create(format: string): NumberFormatter {\n\t\treturn new NumberFormatterImpl(format);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { NumberFormatter } from \"../../util/number-formatter\";\nimport { NumberFormatters } from \"../../util/number-formatters\";\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\nimport { EShapeActionExpression } from \"./e-shape-action-expression\";\nimport { EShapeActionExpressions } from \"./e-shape-action-expressions\";\nimport { EShapeActionRuntimeConditional } from \"./e-shape-action-runtime-conditional\";\nimport { EShapeActionValueChangeText } from \"./e-shape-action-value-change-text\";\n\nexport class EShapeActionRuntimeChangeTextNumber extends EShapeActionRuntimeConditional {\n\tprotected number: EShapeActionExpression<number>;\n\tprotected formatters: Map<string, NumberFormatter | null>;\n\n\tconstructor(value: EShapeActionValueChangeText) {\n\t\tsuper(value, EShapeRuntimeReset.TEXT);\n\n\t\tthis.number = EShapeActionExpressions.ofNumber(value.value);\n\t\tthis.formatters = new Map<string, NumberFormatter | null>();\n\t}\n\n\tprotected getFormatter(shape: EShape, runtime: EShapeRuntime): NumberFormatter | null {\n\t\tconst formatters = this.formatters;\n\t\tconst text = runtime.text.value;\n\t\tlet result = formatters.get(text);\n\t\tif (result === undefined) {\n\t\t\tresult = this.newFormatter(text);\n\t\t\tformatters.set(text, result);\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected newFormatter(format: string): NumberFormatter | null {\n\t\tformat = format.trim();\n\t\tif (0 < format.length) {\n\t\t\treturn NumberFormatters.create(format);\n\t\t}\n\t\treturn null;\n\t}\n\n\texecute(shape: EShape, runtime: EShapeRuntime, time: number): void {\n\t\tif (this.condition(shape, time)) {\n\t\t\tconst value = this.number(shape, time);\n\t\t\tconst formatter = this.getFormatter(shape, runtime);\n\t\t\tshape.text.value = formatter != null ? formatter.format(value, 0) : String(value);\n\t\t\truntime.written |= this.reset;\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\nimport { EShapeActionExpression } from \"./e-shape-action-expression\";\nimport { EShapeActionExpressions } from \"./e-shape-action-expressions\";\nimport { EShapeActionRuntimeConditional } from \"./e-shape-action-runtime-conditional\";\nimport { EShapeActionValueChangeText } from \"./e-shape-action-value-change-text\";\n\nexport class EShapeActionRuntimeChangeTextText extends EShapeActionRuntimeConditional {\n\tprotected text: EShapeActionExpression<string>;\n\n\tconstructor(value: EShapeActionValueChangeText) {\n\t\tsuper(value, EShapeRuntimeReset.TEXT);\n\t\tthis.text = EShapeActionExpressions.ofString(value.value);\n\t}\n\n\texecute(shape: EShape, runtime: EShapeRuntime, time: number): void {\n\t\tif (this.condition(shape, time)) {\n\t\t\tshape.text.value = this.text(shape, time);\n\t\t\truntime.written |= this.reset;\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const EShapeActionValueChangeTextType = {\n\tTEXT: 0,\n\tNUMBER: 1\n} as const;\n\nexport type EShapeActionValueChangeTextType =\n\ttypeof EShapeActionValueChangeTextType[keyof typeof EShapeActionValueChangeTextType];\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShapeActionRuntimeChangeTextNumber } from \"./e-shape-action-runtime-change-text-number\";\nimport { EShapeActionRuntimeChangeTextText } from \"./e-shape-action-runtime-change-text-text\";\nimport { EShapeActionValue } from \"./e-shape-action-value\";\nimport { EShapeActionValueChangeTextType } from \"./e-shape-action-value-change-text-type\";\nimport { EShapeActionValueSubtyped } from \"./e-shape-action-value-subtyped\";\nimport { EShapeActionValueType } from \"./e-shape-action-value-type\";\nimport { EShapeActionValues } from \"./e-shape-action-values\";\n\nexport type EShapeActionValueChangeTextSerialized = [\n\ttypeof EShapeActionValueType.CHANGE_TEXT,\n\tnumber,\n\tEShapeActionValueChangeTextType,\n\tnumber\n];\n\nexport class EShapeActionValueChangeText extends EShapeActionValueSubtyped<EShapeActionValueChangeTextType> {\n\treadonly value: string;\n\n\tconstructor(subtype: EShapeActionValueChangeTextType, condition: string, value: string) {\n\t\tsuper(EShapeActionValueType.CHANGE_TEXT, condition, subtype);\n\t\tthis.value = value;\n\t}\n\n\tisEquals(value: EShapeActionValue): boolean {\n\t\treturn (\n\t\t\tsuper.isEquals(value) &&\n\t\t\tvalue instanceof EShapeActionValueChangeText &&\n\t\t\tthis.value === value.value\n\t\t);\n\t}\n\n\ttoRuntime(): EShapeActionRuntimeChangeTextText | EShapeActionRuntimeChangeTextNumber {\n\t\tswitch (this.subtype) {\n\t\t\tcase EShapeActionValueChangeTextType.TEXT:\n\t\t\t\treturn new EShapeActionRuntimeChangeTextText(this);\n\t\t\tcase EShapeActionValueChangeTextType.NUMBER:\n\t\t\t\treturn new EShapeActionRuntimeChangeTextNumber(this);\n\t\t}\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\tconst conditionId = manager.addResource(this.condition);\n\t\tconst valueId = manager.addResource(this.value);\n\t\treturn manager.addResource(`[${this.type},${conditionId},${this.subtype},${valueId}]`);\n\t}\n\n\tstatic deserialize(\n\t\tserialized: EShapeActionValueChangeTextSerialized,\n\t\tmanager: EShapeResourceManagerDeserialization\n\t): EShapeActionValueChangeText {\n\t\tconst condition = EShapeActionValues.toResource(1, serialized, manager.resources);\n\t\tconst value = EShapeActionValues.toResource(3, serialized, manager.resources);\n\t\treturn new EShapeActionValueChangeText(serialized[2], condition, value);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBackgroundStateAware } from \"./d-background\";\nimport { DBaseOptions, DThemeBase } from \"./d-base\";\nimport { DBaseStateSet } from \"./d-base-state-set\";\nimport { DStateAwareOrValueMightBe } from \"./d-state-aware\";\nimport { isFunction } from \"./util/is-function\";\n\nexport class DBaseBackground implements DBackgroundStateAware {\n\tprotected _theme: DThemeBase;\n\tprotected _color?: DStateAwareOrValueMightBe<number | null>;\n\tprotected _alpha?: DStateAwareOrValueMightBe<number>;\n\tprotected _callback?: () => void;\n\n\tconstructor(theme: DThemeBase, options?: DBaseOptions<any>, callback?: () => void) {\n\t\tthis._theme = theme;\n\t\tthis._callback = callback;\n\t\tconst background = options?.background;\n\t\tif (background) {\n\t\t\tthis._color = background.color;\n\t\t\tthis._alpha = background.alpha;\n\t\t}\n\t}\n\n\tgetTheme(): DThemeBase {\n\t\treturn this._theme;\n\t}\n\n\tsetTheme(theme: DThemeBase): void {\n\t\tthis._theme = theme;\n\t}\n\n\tgetColor(state: DBaseStateSet): number | null {\n\t\tconst color = this._color;\n\t\tif (color !== undefined) {\n\t\t\tif (isFunction(color)) {\n\t\t\t\tconst result = color(state);\n\t\t\t\tif (result !== undefined) {\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn color;\n\t\t\t}\n\t\t}\n\t\treturn this._theme.getBackgroundColor(state);\n\t}\n\n\tget color(): DStateAwareOrValueMightBe<number | null> {\n\t\treturn this._color;\n\t}\n\n\tset color(color: DStateAwareOrValueMightBe<number | null>) {\n\t\tif (this._color !== color) {\n\t\t\tthis._color = color;\n\t\t\tthis.onChange();\n\t\t}\n\t}\n\n\tgetAlpha(state: DBaseStateSet): number {\n\t\tconst alpha = this._alpha;\n\t\tif (alpha !== undefined) {\n\t\t\tif (isFunction(alpha)) {\n\t\t\t\tconst result = alpha(state);\n\t\t\t\tif (result !== undefined) {\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn alpha;\n\t\t\t}\n\t\t}\n\t\treturn this._theme.getBackgroundAlpha(state);\n\t}\n\n\tget alpha(): DStateAwareOrValueMightBe<number> {\n\t\treturn this._alpha;\n\t}\n\n\tset alpha(alpha: DStateAwareOrValueMightBe<number>) {\n\t\tif (this._alpha !== alpha) {\n\t\t\tthis._alpha = alpha;\n\t\t\tthis.onChange();\n\t\t}\n\t}\n\n\tprotected onChange(): void {\n\t\tconst callback = this._callback;\n\t\tif (callback != null) {\n\t\t\tcallback();\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nconst TOP = 1;\nconst RIGHT = 2;\nconst BOTTOM = 4;\nconst LEFT = 8;\n\n/**\n * A border mask.\n * Borders on masked parts are not rendered.\n */\nexport const DBorderMask = {\n\tNONE: 0,\n\n\tTOP,\n\tRIGHT,\n\tBOTTOM,\n\tLEFT,\n\n\tTOP_RIGHT: TOP | RIGHT,\n\tTOP_BOTTOM: TOP | BOTTOM,\n\tTOP_LEFT: TOP | LEFT,\n\n\tRIGHT_BOTTOM: RIGHT | BOTTOM,\n\tRIGHT_LEFT: RIGHT | LEFT,\n\n\tBOTTOM_LEFT: BOTTOM | LEFT,\n\n\tNOT_TOP: RIGHT | BOTTOM | LEFT,\n\tNOT_RIGHT: TOP | BOTTOM | LEFT,\n\tNOT_BOTTOM: TOP | RIGHT | LEFT,\n\tNOT_LEFT: TOP | RIGHT | BOTTOM,\n\n\tALL: TOP | RIGHT | BOTTOM | LEFT\n} as const;\n\nexport type DBorderMask = number;\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { isString } from \"./is-string\";\n\nexport const toEnum = <T, TE>(target: T, te: TE): Exclude<T, keyof TE> => {\n\treturn isString(target) ? (te as any)[target] : target;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBaseOptions, DThemeBase } from \"./d-base\";\nimport { DBaseStateSet } from \"./d-base-state-set\";\nimport { DBorderStateAware } from \"./d-border\";\nimport { DBorderMask } from \"./d-border-mask\";\nimport { DStateAwareOrValueMightBe } from \"./d-state-aware\";\nimport { isFunction } from \"./util/is-function\";\nimport { toEnum } from \"./util/to-enum\";\n\nexport class DBaseBorder implements DBorderStateAware {\n\tprotected _theme: DThemeBase;\n\tprotected _color?: DStateAwareOrValueMightBe<number | null>;\n\tprotected _alpha?: DStateAwareOrValueMightBe<number>;\n\tprotected _width?: DStateAwareOrValueMightBe<number>;\n\tprotected _align?: DStateAwareOrValueMightBe<number>;\n\tprotected _mask?: DStateAwareOrValueMightBe<DBorderMask>;\n\tprotected _callback?: () => void;\n\n\tconstructor(theme: DThemeBase, options?: DBaseOptions<any>, callback?: () => void) {\n\t\tthis._theme = theme;\n\t\tthis._callback = callback;\n\t\tconst border = options?.border;\n\t\tif (border) {\n\t\t\tthis._color = border.color;\n\t\t\tthis._alpha = border.alpha;\n\t\t\tthis._width = border.width;\n\t\t\tthis._align = border.align;\n\t\t\tthis._mask = toEnum(border.mask, DBorderMask);\n\t\t}\n\t}\n\n\tgetTheme(): DThemeBase {\n\t\treturn this._theme;\n\t}\n\n\tsetTheme(theme: DThemeBase): void {\n\t\tthis._theme = theme;\n\t}\n\n\tgetColor(state: DBaseStateSet): number | null {\n\t\tconst color = this._color;\n\t\tif (color !== undefined) {\n\t\t\tif (isFunction(color)) {\n\t\t\t\tconst result = color(state);\n\t\t\t\tif (result !== undefined) {\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn color;\n\t\t\t}\n\t\t}\n\t\treturn this._theme.getBorderColor(state);\n\t}\n\n\tget color(): DStateAwareOrValueMightBe<number | null> {\n\t\treturn this._color;\n\t}\n\n\tset color(color: DStateAwareOrValueMightBe<number | null>) {\n\t\tif (this._color !== color) {\n\t\t\tthis._color = color;\n\t\t\tthis.onChange();\n\t\t}\n\t}\n\n\tgetAlpha(state: DBaseStateSet): number {\n\t\tconst alpha = this._alpha;\n\t\tif (alpha !== undefined) {\n\t\t\tif (isFunction(alpha)) {\n\t\t\t\tconst result = alpha(state);\n\t\t\t\tif (result !== undefined) {\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn alpha;\n\t\t\t}\n\t\t}\n\t\treturn this._theme.getBorderAlpha(state);\n\t}\n\n\tget alpha(): DStateAwareOrValueMightBe<number> {\n\t\treturn this._alpha;\n\t}\n\n\tset alpha(alpha: DStateAwareOrValueMightBe<number>) {\n\t\tif (this._alpha !== alpha) {\n\t\t\tthis._alpha = alpha;\n\t\t\tthis.onChange();\n\t\t}\n\t}\n\n\tgetWidth(state: DBaseStateSet): number {\n\t\tconst width = this._width;\n\t\tif (width !== undefined) {\n\t\t\tif (isFunction(width)) {\n\t\t\t\tconst result = width(state);\n\t\t\t\tif (result !== undefined) {\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn width;\n\t\t\t}\n\t\t}\n\t\treturn this._theme.getBorderWidth(state);\n\t}\n\n\tget width(): DStateAwareOrValueMightBe<number> {\n\t\treturn this._width;\n\t}\n\n\tset width(width: DStateAwareOrValueMightBe<number>) {\n\t\tif (this._width !== width) {\n\t\t\tthis._width = width;\n\t\t\tthis.onChange();\n\t\t}\n\t}\n\n\tgetAlign(state: DBaseStateSet): number {\n\t\tconst align = this._align;\n\t\tif (align !== undefined) {\n\t\t\tif (isFunction(align)) {\n\t\t\t\tconst result = align(state);\n\t\t\t\tif (result !== undefined) {\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn align;\n\t\t\t}\n\t\t}\n\t\treturn this._theme.getBorderAlign(state);\n\t}\n\n\tget align(): DStateAwareOrValueMightBe<number> {\n\t\treturn this._align;\n\t}\n\n\tset align(align: DStateAwareOrValueMightBe<number>) {\n\t\tif (this._align !== align) {\n\t\t\tthis._align = align;\n\t\t\tthis.onChange();\n\t\t}\n\t}\n\n\tgetMask(state: DBaseStateSet): number {\n\t\tconst mask = this._mask;\n\t\tif (mask !== undefined) {\n\t\t\tif (isFunction(mask)) {\n\t\t\t\tconst result = mask(state);\n\t\t\t\tif (result !== undefined) {\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn mask;\n\t\t\t}\n\t\t}\n\t\treturn this._theme.getBorderMask(state);\n\t}\n\n\tget mask(): DStateAwareOrValueMightBe<DBorderMask> {\n\t\treturn this._mask;\n\t}\n\n\tset mask(mask: DStateAwareOrValueMightBe<DBorderMask>) {\n\t\tif (this._mask !== mask) {\n\t\t\tthis._mask = mask;\n\t\t\tthis.onChange();\n\t\t}\n\t}\n\n\tprotected onChange(): void {\n\t\tconst callback = this._callback;\n\t\tif (callback != null) {\n\t\t\tcallback();\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nconst TOP_LEFT = 1;\nconst TOP_RIGHT = 2;\nconst BOTTOM_LEFT = 4;\nconst BOTTOM_RIGHT = 8;\n\n/**\n * A corner mask.\n * Masked corners are rendered as if the corner radius is zero.\n */\nexport const DCornerMask = {\n\tNONE: 0,\n\tTOP_LEFT,\n\tTOP_RIGHT,\n\tBOTTOM_LEFT,\n\tBOTTOM_RIGHT,\n\tTOP: TOP_LEFT | TOP_RIGHT,\n\tBOTTOM: BOTTOM_LEFT | BOTTOM_RIGHT,\n\tLEFT: TOP_LEFT | BOTTOM_LEFT,\n\tRIGHT: TOP_RIGHT | BOTTOM_RIGHT,\n\tALL: TOP_LEFT | TOP_RIGHT | BOTTOM_LEFT | BOTTOM_RIGHT\n} as const;\n\nexport type DCornerMask = number;\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBaseOptions, DThemeBase } from \"./d-base\";\nimport { DCorner } from \"./d-corner\";\nimport { DCornerMask } from \"./d-corner-mask\";\nimport { isNumber } from \"./util/is-number\";\nimport { toEnum } from \"./util/to-enum\";\n\nexport class DBaseCorner implements DCorner {\n\tprotected _theme: DThemeBase;\n\tprotected _radius?: number;\n\tprotected _mask?: DCornerMask;\n\tprotected _callback?: () => void;\n\n\tconstructor(theme: DThemeBase, options?: DBaseOptions<any>, callback?: () => void) {\n\t\tthis._theme = theme;\n\t\tthis._callback = callback;\n\t\tconst corner = options?.corner;\n\t\tif (corner) {\n\t\t\tif (isNumber(corner)) {\n\t\t\t\tthis._radius = corner;\n\t\t\t\tthis._mask = undefined;\n\t\t\t} else {\n\t\t\t\tthis._radius = corner.radius;\n\t\t\t\tthis._mask = toEnum(corner.mask, DCornerMask);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetTheme(): DThemeBase {\n\t\treturn this._theme;\n\t}\n\n\tsetTheme(theme: DThemeBase): void {\n\t\tthis._theme = theme;\n\t}\n\n\tgetRadius(): number {\n\t\treturn this._radius ?? this._theme.getCornerRadius();\n\t}\n\n\tget radius(): number | undefined {\n\t\treturn this._radius;\n\t}\n\n\tset radius(radius: number | undefined) {\n\t\tif (this._radius !== radius) {\n\t\t\tthis._radius = radius;\n\t\t\tconst callback = this._callback;\n\t\t\tif (callback != null) {\n\t\t\t\tcallback();\n\t\t\t}\n\t\t}\n\t}\n\n\tgetMask(): DCornerMask {\n\t\treturn this._mask ?? this._theme.getCornerMask();\n\t}\n\n\tget mask(): DCornerMask | undefined {\n\t\treturn this._mask;\n\t}\n\n\tset mask(mask: DCornerMask | undefined) {\n\t\tif (this._mask !== mask) {\n\t\t\tthis._mask = mask;\n\t\t\tconst callback = this._callback;\n\t\t\tif (callback != null) {\n\t\t\t\tcallback();\n\t\t\t}\n\t\t}\n\t}\n\n\tset(radius?: number, mask?: DCornerMask): void {\n\t\tlet isChanged = false;\n\n\t\tif (this._radius !== radius) {\n\t\t\tthis._radius = radius;\n\t\t\tisChanged = true;\n\t\t}\n\n\t\tif (this._mask !== mask) {\n\t\t\tthis._mask = mask;\n\t\t\tisChanged = true;\n\t\t}\n\n\t\tconst callback = this._callback;\n\t\tif (isChanged && callback != null) {\n\t\t\tcallback();\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nconst SELF = 1;\nconst CHILDREN = 2;\n\n/**\n * DBase interactivity.\n * Mouse / touch events are triggered only on interactive objects.\n */\nexport const DBaseInteractive = {\n\t/**\n\t * Not interactive.\n\t */\n\tNONE: 0,\n\n\t/**\n\t * Interactive.\n\t */\n\tSELF,\n\n\t/**\n\t * Children are interactive.\n\t */\n\tCHILDREN,\n\n\t/**\n\t * Interactive.\n\t * And also children are interactive.\n\t */\n\tBOTH: SELF | CHILDREN\n} as const;\n\nexport type DBaseInteractive = number;\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBaseOptions, DThemeBase } from \"./d-base\";\nimport { DBaseStateSet } from \"./d-base-state-set\";\nimport { DBorderMask } from \"./d-border-mask\";\nimport { DOutline } from \"./d-outline\";\nimport { DStateAwareOrValueMightBe } from \"./d-state-aware\";\nimport { isFunction } from \"./util/is-function\";\nimport { toEnum } from \"./util/to-enum\";\n\nexport class DBaseOutline implements DOutline {\n\tprotected _theme: DThemeBase;\n\tprotected _color?: DStateAwareOrValueMightBe<number | null>;\n\tprotected _alpha?: DStateAwareOrValueMightBe<number>;\n\tprotected _width?: DStateAwareOrValueMightBe<number>;\n\tprotected _offset?: DStateAwareOrValueMightBe<number>;\n\tprotected _align?: DStateAwareOrValueMightBe<number>;\n\tprotected _mask?: DStateAwareOrValueMightBe<DBorderMask>;\n\tprotected _callback?: () => void;\n\n\tconstructor(theme: DThemeBase, options?: DBaseOptions<any>, callback?: () => void) {\n\t\tthis._theme = theme;\n\t\tthis._callback = callback;\n\t\tconst outline = options?.outline;\n\t\tif (outline) {\n\t\t\tthis._color = outline.color;\n\t\t\tthis._alpha = outline.alpha;\n\t\t\tthis._width = outline.width;\n\t\t\tthis._offset = outline.offset;\n\t\t\tthis._align = outline.align;\n\t\t\tthis._mask = toEnum(outline.mask, DBorderMask);\n\t\t}\n\t}\n\n\tgetTheme(): DThemeBase {\n\t\treturn this._theme;\n\t}\n\n\tsetTheme(theme: DThemeBase): void {\n\t\tthis._theme = theme;\n\t}\n\n\tgetColor(state: DBaseStateSet): number | null {\n\t\tconst color = this._color;\n\t\tif (color !== undefined) {\n\t\t\tif (isFunction(color)) {\n\t\t\t\tconst result = color(state);\n\t\t\t\tif (result !== undefined) {\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn color;\n\t\t\t}\n\t\t}\n\t\treturn this._theme.getOutlineColor(state);\n\t}\n\n\tget color(): DStateAwareOrValueMightBe<number | null> {\n\t\treturn this._color;\n\t}\n\n\tset color(color: DStateAwareOrValueMightBe<number | null>) {\n\t\tif (this._color !== color) {\n\t\t\tthis._color = color;\n\t\t\tconst callback = this._callback;\n\t\t\tif (callback != null) {\n\t\t\t\tcallback();\n\t\t\t}\n\t\t}\n\t}\n\n\tgetAlpha(state: DBaseStateSet): number {\n\t\tconst alpha = this._alpha;\n\t\tif (alpha !== undefined) {\n\t\t\tif (isFunction(alpha)) {\n\t\t\t\tconst result = alpha(state);\n\t\t\t\tif (result !== undefined) {\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn alpha;\n\t\t\t}\n\t\t}\n\t\treturn this._theme.getOutlineAlpha(state);\n\t}\n\n\tget alpha(): DStateAwareOrValueMightBe<number> {\n\t\treturn this._alpha;\n\t}\n\n\tset alpha(alpha: DStateAwareOrValueMightBe<number>) {\n\t\tif (this._alpha !== alpha) {\n\t\t\tthis._alpha = alpha;\n\t\t\tconst callback = this._callback;\n\t\t\tif (callback != null) {\n\t\t\t\tcallback();\n\t\t\t}\n\t\t}\n\t}\n\n\tgetWidth(state: DBaseStateSet): number {\n\t\tconst width = this._width;\n\t\tif (width !== undefined) {\n\t\t\tif (isFunction(width)) {\n\t\t\t\tconst result = width(state);\n\t\t\t\tif (result !== undefined) {\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn width;\n\t\t\t}\n\t\t}\n\t\treturn this._theme.getOutlineWidth(state);\n\t}\n\n\tget width(): DStateAwareOrValueMightBe<number> {\n\t\treturn this._width;\n\t}\n\n\tset width(width: DStateAwareOrValueMightBe<number>) {\n\t\tif (this._width !== width) {\n\t\t\tthis._width = width;\n\t\t\tconst callback = this._callback;\n\t\t\tif (callback != null) {\n\t\t\t\tcallback();\n\t\t\t}\n\t\t}\n\t}\n\n\tgetOffset(state: DBaseStateSet): number {\n\t\tconst offset = this._offset;\n\t\tif (offset !== undefined) {\n\t\t\tif (isFunction(offset)) {\n\t\t\t\tconst result = offset(state);\n\t\t\t\tif (result !== undefined) {\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn offset;\n\t\t\t}\n\t\t}\n\t\treturn this._theme.getOutlineOffset(state);\n\t}\n\n\tget offset(): DStateAwareOrValueMightBe<number> {\n\t\treturn this._offset;\n\t}\n\n\tset offset(offset: DStateAwareOrValueMightBe<number>) {\n\t\tif (this._offset !== offset) {\n\t\t\tthis._offset = offset;\n\t\t\tconst callback = this._callback;\n\t\t\tif (callback != null) {\n\t\t\t\tcallback();\n\t\t\t}\n\t\t}\n\t}\n\n\tgetAlign(state: DBaseStateSet): number {\n\t\tconst align = this._align;\n\t\tif (align !== undefined) {\n\t\t\tif (isFunction(align)) {\n\t\t\t\tconst result = align(state);\n\t\t\t\tif (result !== undefined) {\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn align;\n\t\t\t}\n\t\t}\n\t\treturn this._theme.getOutlineAlign(state);\n\t}\n\n\tget align(): DStateAwareOrValueMightBe<number> {\n\t\treturn this._align;\n\t}\n\n\tset align(align: DStateAwareOrValueMightBe<number>) {\n\t\tif (this._align !== align) {\n\t\t\tthis._align = align;\n\t\t\tconst callback = this._callback;\n\t\t\tif (callback != null) {\n\t\t\t\tcallback();\n\t\t\t}\n\t\t}\n\t}\n\n\tgetMask(state: DBaseStateSet): number {\n\t\tconst mask = this._mask;\n\t\tif (mask !== undefined) {\n\t\t\tif (isFunction(mask)) {\n\t\t\t\tconst result = mask(state);\n\t\t\t\tif (result !== undefined) {\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn mask;\n\t\t\t}\n\t\t}\n\t\treturn this._theme.getOutlineMask(state);\n\t}\n\n\tget mask(): DStateAwareOrValueMightBe<DBorderMask> {\n\t\treturn this._mask;\n\t}\n\n\tset mask(mask: DStateAwareOrValueMightBe<DBorderMask>) {\n\t\tif (this._mask !== mask) {\n\t\t\tthis._mask = mask;\n\t\t\tconst callback = this._callback;\n\t\t\tif (callback != null) {\n\t\t\t\tcallback();\n\t\t\t}\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBaseOptions, DThemeBase } from \"./d-base\";\nimport { DPadding } from \"./d-padding\";\nimport { isNumber } from \"./util/is-number\";\n\nexport class DBasePadding implements DPadding {\n\tprotected _theme: DThemeBase;\n\tprotected _left?: number;\n\tprotected _top?: number;\n\tprotected _right?: number;\n\tprotected _bottom?: number;\n\tprotected _callback?: () => void;\n\n\tconstructor(theme: DThemeBase, options?: DBaseOptions<any>, callback?: () => void) {\n\t\tthis._theme = theme;\n\t\tthis._callback = callback;\n\t\tconst padding = options?.padding;\n\t\tif (padding != null) {\n\t\t\tif (isNumber(padding)) {\n\t\t\t\tthis._left = padding;\n\t\t\t\tthis._top = padding;\n\t\t\t\tthis._right = padding;\n\t\t\t\tthis._bottom = padding;\n\t\t\t} else {\n\t\t\t\tthis._left = padding.left;\n\t\t\t\tthis._top = padding.top;\n\t\t\t\tthis._right = padding.right;\n\t\t\t\tthis._bottom = padding.bottom;\n\t\t\t}\n\t\t}\n\t}\n\n\tgetTheme(): DThemeBase {\n\t\treturn this._theme;\n\t}\n\n\tsetTheme(theme: DThemeBase): void {\n\t\tthis._theme = theme;\n\t}\n\n\tgetCallback(): (() => void) | undefined {\n\t\treturn this._callback;\n\t}\n\n\tgetLeft(): number {\n\t\treturn this._left ?? this._theme.getPaddingLeft();\n\t}\n\n\tget left(): number | undefined {\n\t\treturn this._left;\n\t}\n\n\tset left(left: number | undefined) {\n\t\tif (this._left !== left) {\n\t\t\tthis._left = left;\n\t\t\tif (this._callback != null) {\n\t\t\t\tthis._callback();\n\t\t\t}\n\t\t}\n\t}\n\n\tgetTop(): number {\n\t\treturn this._top ?? this._theme.getPaddingTop();\n\t}\n\n\tget top(): number | undefined {\n\t\treturn this._top;\n\t}\n\n\tset top(top: number | undefined) {\n\t\tif (this._top !== top) {\n\t\t\tthis._top = top;\n\t\t\tif (this._callback != null) {\n\t\t\t\tthis._callback();\n\t\t\t}\n\t\t}\n\t}\n\n\tgetRight(): number {\n\t\treturn this._right ?? this._theme.getPaddingRight();\n\t}\n\n\tget right(): number | undefined {\n\t\treturn this._right;\n\t}\n\n\tset right(right: number | undefined) {\n\t\tif (this._right !== right) {\n\t\t\tthis._right = right;\n\t\t\tif (this._callback != null) {\n\t\t\t\tthis._callback();\n\t\t\t}\n\t\t}\n\t}\n\n\tgetBottom(): number {\n\t\treturn this._bottom ?? this._theme.getPaddingBottom();\n\t}\n\n\tget bottom(): number | undefined {\n\t\treturn this._bottom;\n\t}\n\n\tset bottom(bottom: number | undefined) {\n\t\tif (this._bottom !== bottom) {\n\t\t\tthis._bottom = bottom;\n\t\t\tif (this._callback != null) {\n\t\t\t\tthis._callback();\n\t\t\t}\n\t\t}\n\t}\n\n\tset(padding: number): void;\n\tset(topAndBottom: number, leftAndRight: number): void;\n\tset(top: number, leftAndRight: number, bottom: number): void;\n\tset(top: number, right: number, bottom: number, left: number): void;\n\tset(top: number, right?: number, bottom?: number, left?: number): void {\n\t\tif (right == null) {\n\t\t\tthis.top = top;\n\t\t\tthis.right = top;\n\t\t\tthis.bottom = top;\n\t\t\tthis.left = top;\n\t\t} else if (bottom == null) {\n\t\t\tthis.top = top;\n\t\t\tthis.right = right;\n\t\t\tthis.bottom = top;\n\t\t\tthis.left = right;\n\t\t} else if (left == null) {\n\t\t\tthis.top = top;\n\t\t\tthis.right = right;\n\t\t\tthis.bottom = bottom;\n\t\t\tthis.left = right;\n\t\t} else {\n\t\t\tthis.top = top;\n\t\t\tthis.right = right;\n\t\t\tthis.bottom = bottom;\n\t\t\tthis.left = left;\n\t\t}\n\t\tif (this._callback != null) {\n\t\t\tthis._callback();\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { IPoint } from \"pixi.js\";\n\nexport type DBasePointCallback = (newX: number, newY: number, oldX: number, oldY: number) => any;\n\nexport class DBasePoint {\n\tprotected _point: IPoint;\n\tprotected _onChange: DBasePointCallback;\n\n\tconstructor(point: IPoint, onChange: DBasePointCallback) {\n\t\tthis._point = point;\n\t\tthis._onChange = onChange;\n\t}\n\n\tget x(): number {\n\t\treturn this._point.x;\n\t}\n\n\tset x(x: number) {\n\t\tconst point = this._point;\n\t\tconst oldX = point.x;\n\t\tif (oldX !== x) {\n\t\t\tpoint.x = x;\n\t\t\tconst y = point.y;\n\t\t\tthis._onChange(x, y, oldX, y);\n\t\t}\n\t}\n\n\tget y(): number {\n\t\treturn this._point.y;\n\t}\n\n\tset y(y: number) {\n\t\tconst point = this._point;\n\t\tconst oldY = point.y;\n\t\tif (oldY !== y) {\n\t\t\tpoint.y = y;\n\t\t\tconst x = point.x;\n\t\t\tthis._onChange(x, y, x, oldY);\n\t\t}\n\t}\n\n\tset(x: number, y: number): this {\n\t\tconst point = this._point;\n\t\tconst oldX = point.x;\n\t\tconst oldY = point.y;\n\t\tif (oldX !== x || oldY !== y) {\n\t\t\tpoint.set(x, y);\n\t\t\tthis._onChange(x, y, oldX, oldY);\n\t\t}\n\t\treturn this;\n\t}\n\n\tcopyFrom(target: IPoint): this {\n\t\tconst x = target.x;\n\t\tconst y = target.y;\n\t\tconst point = this._point;\n\t\tconst oldX = point.x;\n\t\tconst oldY = point.y;\n\t\tif (oldX !== x || oldY !== y) {\n\t\t\tpoint.copyFrom(target);\n\t\t\tthis._onChange(x, y, oldX, oldY);\n\t\t}\n\t\treturn this;\n\t}\n\n\tcopyTo(target: IPoint): IPoint {\n\t\treturn target.copyFrom(this._point);\n\t}\n\n\tcopy(): this {\n\t\t// eslint-disable-next-line prefer-rest-params\n\t\treturn this.copyFrom(arguments[0]);\n\t}\n\n\tclone(onChange?: DBasePointCallback): DBasePoint {\n\t\treturn new DBasePoint(this._point, onChange || this._onChange);\n\t}\n\n\tequals(p: IPoint): boolean {\n\t\treturn this._point.equals(p);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Buffer, MeshGeometry } from \"pixi.js\";\nimport { DCornerMask } from \"./d-corner-mask\";\n\nexport interface DBaseMeshGeometryTable {\n\tcos: number[];\n\tsin: number[];\n}\n\nexport class DBaseMeshGeometry extends MeshGeometry {\n\tprotected static N = 4;\n\tprotected static TABLES?: DBaseMeshGeometryTable[];\n\n\tprotected _width: number;\n\tprotected _height: number;\n\tprotected _cornerRadius: number;\n\tprotected _cornerMask: DCornerMask;\n\tprotected _isDirty: boolean;\n\tprotected _vertices: Float32Array;\n\tprotected _uvs: Float32Array;\n\tprotected _indices: Uint16Array;\n\tprotected _vertexBuffer: Buffer;\n\tprotected _uvBuffer: Buffer;\n\tprotected _indexBuffer: Buffer;\n\tprotected _resolution: number;\n\n\tconstructor(\n\t\tvertices: Float32Array | number[],\n\t\tuvs: Float32Array | number[],\n\t\tindices: Uint16Array | number[]\n\t) {\n\t\tsuper(vertices, uvs, indices);\n\n\t\tthis._width = 100;\n\t\tthis._height = 100;\n\t\tthis._cornerRadius = 0;\n\t\tthis._cornerMask = DCornerMask.NONE;\n\t\tthis._isDirty = true;\n\t\tthis._resolution = 1;\n\n\t\tthis._vertexBuffer = this.getBuffer(\"aVertexPosition\");\n\t\tthis._vertices = this._vertexBuffer.data as Float32Array;\n\t\tthis._uvBuffer = this.getBuffer(\"aTextureCoord\");\n\t\tthis._uvs = this._uvBuffer.data as Float32Array;\n\t\tthis._indexBuffer = this.getIndex();\n\t\tthis._indices = this._indexBuffer.data as Uint16Array;\n\t}\n\n\tget width(): number {\n\t\treturn this._width;\n\t}\n\n\tset width(width: number) {\n\t\tif (this._width !== width) {\n\t\t\tthis._width = width;\n\t\t\tthis._isDirty = true;\n\t\t}\n\t}\n\n\tget height(): number {\n\t\treturn this._height;\n\t}\n\n\tset height(height: number) {\n\t\tif (this._height !== height) {\n\t\t\tthis._height = height;\n\t\t\tthis._isDirty = true;\n\t\t}\n\t}\n\n\tget cornerRadius(): number {\n\t\treturn this._cornerRadius;\n\t}\n\n\tset cornerRadius(borderSize: number) {\n\t\tif (this._cornerRadius !== borderSize) {\n\t\t\tthis._cornerRadius = borderSize;\n\t\t\tthis._isDirty = true;\n\t\t}\n\t}\n\n\tget cornerMask(): DCornerMask {\n\t\treturn this._cornerMask;\n\t}\n\n\tset cornerMask(cornerMask: DCornerMask) {\n\t\tif (this._cornerMask !== cornerMask) {\n\t\t\tthis._cornerMask = cornerMask;\n\t\t\tthis._isDirty = true;\n\t\t}\n\t}\n\n\tprotected getTables(): DBaseMeshGeometryTable[] {\n\t\tlet result = DBaseMeshGeometry.TABLES;\n\t\tif (result == null) {\n\t\t\tresult = this.newTables(DBaseMeshGeometry.N);\n\t\t\tDBaseMeshGeometry.TABLES = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected newTables(n: number): DBaseMeshGeometryTable[] {\n\t\tconst dp = 1.0 / (n - 1);\n\t\tconst da = 0.5 * dp;\n\t\treturn [\n\t\t\tthis.newTable(n, 1.0, da),\n\t\t\tthis.newTable(n, 0.5, da),\n\t\t\tthis.newTable(n, 0.0, da),\n\t\t\tthis.newTable(n, 1.5, da)\n\t\t];\n\t}\n\n\tprotected newTable(n: number, a0: number, da: number): DBaseMeshGeometryTable {\n\t\tconst cos: number[] = [];\n\t\tconst sin: number[] = [];\n\t\tconst pi = Math.PI;\n\t\tfor (let i = 0, a = a0; i < n; i += 1, a -= da) {\n\t\t\tconst t = a * pi;\n\t\t\tconst c = +Math.cos(t);\n\t\t\tconst s = -Math.sin(t);\n\t\t\tcos.push(c);\n\t\t\tsin.push(s);\n\t\t}\n\t\treturn {\n\t\t\tcos,\n\t\t\tsin\n\t\t};\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Renderer } from \"pixi.js\";\nimport { DBaseMeshGeometry, DBaseMeshGeometryTable } from \"./d-base-mesh-geometry\";\nimport { DCornerMask } from \"./d-corner-mask\";\n\nexport class DBaseBackgroundMeshGeometry extends DBaseMeshGeometry {\n\tconstructor() {\n\t\tsuper(\n\t\t\tnew Float32Array(16 * DBaseMeshGeometry.N),\n\t\t\tnew Float32Array(16 * DBaseMeshGeometry.N),\n\t\t\tnew Uint16Array(3 * (12 * DBaseMeshGeometry.N - 2))\n\t\t);\n\t}\n\n\tprotected fillVertices(\n\t\tvertices: Float32Array,\n\t\tuvs: Float32Array,\n\t\tiv: number,\n\t\tiuv: number,\n\t\tn: number,\n\t\tx: number,\n\t\ty: number,\n\t\tr: number,\n\t\tdr: number,\n\t\ttable: DBaseMeshGeometryTable\n\t): void {\n\t\tconst cos = table.cos;\n\t\tconst sin = table.sin;\n\t\tconst cos0 = cos[0];\n\t\tconst sin0 = sin[0];\n\t\tconst cos1 = cos[n - 1];\n\t\tconst sin1 = sin[n - 1];\n\t\tfor (let i = 0; i < n; ++i) {\n\t\t\tconst c = cos[i];\n\t\t\tconst s = sin[i];\n\n\t\t\tlet dro = dr;\n\t\t\tconst d0 = c * cos0 + s * sin0;\n\t\t\tif (0.0001 < d0) {\n\t\t\t\tdro = Math.min(dro, (1 / d0 - 1) * r);\n\t\t\t}\n\t\t\tconst d1 = c * cos1 + s * sin1;\n\t\t\tif (0.0001 < d1) {\n\t\t\t\tdro = Math.min(dro, (1 / d1 - 1) * r);\n\t\t\t}\n\t\t\tconst ro = r + dro;\n\n\t\t\tvertices[++iv] = x + c * r;\n\t\t\tvertices[++iv] = y + s * r;\n\t\t\tvertices[++iv] = x + c * ro;\n\t\t\tvertices[++iv] = y + s * ro;\n\t\t\tuvs[++iuv] = 0.5;\n\t\t\tuvs[++iuv] = 0.5;\n\t\t\tuvs[++iuv] = 0.5 * (1 + c);\n\t\t\tuvs[++iuv] = 0.5 * (1 + s);\n\t\t}\n\t}\n\n\tprotected fillIndices(indices: Uint16Array, ia: number, ii: number, n: number): void {\n\t\tfor (let i = 0; i < n; ++i) {\n\t\t\tindices[++ii] = ia + 0;\n\t\t\tindices[++ii] = ia + 1;\n\t\t\tindices[++ii] = ia + 2;\n\n\t\t\tindices[++ii] = ia + 2;\n\t\t\tindices[++ii] = ia + 1;\n\t\t\tindices[++ii] = ia + 3;\n\t\t\tia += 2;\n\t\t}\n\t}\n\n\tprotected fillIndicesEnd(indices: Uint16Array, ia: number, ii: number, n: number): void {\n\t\tfor (let i = 0, imax = n - 1; i < imax; ++i) {\n\t\t\tindices[++ii] = ia + 0;\n\t\t\tindices[++ii] = ia + 1;\n\t\t\tindices[++ii] = ia + 2;\n\n\t\t\tindices[++ii] = ia + 2;\n\t\t\tindices[++ii] = ia + 1;\n\t\t\tindices[++ii] = ia + 3;\n\t\t\tia += 2;\n\t\t}\n\n\t\tindices[++ii] = ia + 0;\n\t\tindices[++ii] = ia + 1;\n\t\tindices[++ii] = 0;\n\n\t\tindices[++ii] = 0;\n\t\tindices[++ii] = ia + 1;\n\t\tindices[++ii] = 1;\n\t\tia += 2;\n\t}\n\n\tupdate(renderer: Renderer): void {\n\t\tconst resolution = renderer.resolution;\n\t\tif (this._isDirty || this._resolution !== resolution) {\n\t\t\tthis._isDirty = false;\n\t\t\tthis._resolution = resolution;\n\n\t\t\tconst vertices = this._vertices;\n\t\t\tconst uvs = this._uvs;\n\t\t\tconst indices = this._indices;\n\n\t\t\tconst w = this._width;\n\t\t\tconst h = this._height;\n\t\t\tconst r = Math.min(0.5 * w, 0.5 * h, this._cornerRadius);\n\t\t\tconst a = 1 / resolution;\n\n\t\t\tconst x0 = 0;\n\t\t\tconst x1 = r;\n\t\t\tconst x2 = w - r;\n\t\t\tconst x3 = w;\n\n\t\t\tconst y0 = 0;\n\t\t\tconst y1 = r;\n\t\t\tconst y2 = h - r;\n\t\t\tconst y3 = h;\n\n\t\t\tconst cornerMask = this._cornerMask;\n\t\t\tconst ctl = !(cornerMask & DCornerMask.TOP_LEFT);\n\t\t\tconst ctr = !(cornerMask & DCornerMask.TOP_RIGHT);\n\t\t\tconst cbl = !(cornerMask & DCornerMask.BOTTOM_LEFT);\n\t\t\tconst cbr = !(cornerMask & DCornerMask.BOTTOM_RIGHT);\n\n\t\t\t// Vertices & UVs\n\t\t\tlet iv = -1;\n\t\t\tlet iuv = -1;\n\t\t\tlet ia = 0;\n\t\t\tlet ii = -1;\n\n\t\t\tconst n = DBaseMeshGeometry.N;\n\t\t\tconst n4 = n << 2;\n\t\t\tconst n2 = n << 1;\n\t\t\tconst n6 = 6 * n;\n\n\t\t\tconst tables = this.getTables();\n\t\t\tconst tlt = tables[0];\n\t\t\tconst ttr = tables[1];\n\t\t\tconst trb = tables[2];\n\t\t\tconst tbl = tables[3];\n\n\t\t\t// left -> top\n\t\t\tif (ctl) {\n\t\t\t\tthis.fillVertices(vertices, uvs, iv, iuv, n, x1, y1, r, a, tlt);\n\t\t\t} else {\n\t\t\t\tthis.fillVertices(vertices, uvs, iv, iuv, n, x0, y0, 0, 0, tlt);\n\t\t\t}\n\t\t\tthis.fillIndices(indices, ia, ii, n);\n\t\t\tiv += n4;\n\t\t\tiuv += n4;\n\t\t\tia += n2;\n\t\t\tii += n6;\n\n\t\t\t// top -> right\n\t\t\tif (ctr) {\n\t\t\t\tthis.fillVertices(vertices, uvs, iv, iuv, n, x2, y1, r, a, ttr);\n\t\t\t} else {\n\t\t\t\tthis.fillVertices(vertices, uvs, iv, iuv, n, x3, y0, 0, 0, ttr);\n\t\t\t}\n\t\t\tthis.fillIndices(indices, ia, ii, n);\n\t\t\tiv += n4;\n\t\t\tiuv += n4;\n\t\t\tia += n2;\n\t\t\tii += n6;\n\n\t\t\t// right -> bottom\n\t\t\tif (cbr) {\n\t\t\t\tthis.fillVertices(vertices, uvs, iv, iuv, n, x2, y2, r, a, trb);\n\t\t\t} else {\n\t\t\t\tthis.fillVertices(vertices, uvs, iv, iuv, n, x3, y3, 0, 0, trb);\n\t\t\t}\n\t\t\tthis.fillIndices(indices, ia, ii, n);\n\t\t\tiv += n4;\n\t\t\tiuv += n4;\n\t\t\tia += n2;\n\t\t\tii += n6;\n\n\t\t\t// bottom -> left\n\t\t\tif (cbl) {\n\t\t\t\tthis.fillVertices(vertices, uvs, iv, iuv, n, x1, y2, r, a, tbl);\n\t\t\t} else {\n\t\t\t\tthis.fillVertices(vertices, uvs, iv, iuv, n, x0, y3, 0, 0, tbl);\n\t\t\t}\n\t\t\tthis.fillIndicesEnd(indices, ia, ii, n);\n\t\t\tiv += n4;\n\t\t\tiuv += n4;\n\t\t\tia += n2;\n\t\t\tii += n6;\n\n\t\t\t// Center\n\t\t\tia = 2;\n\t\t\tfor (let i = 1, imax = 4 * n - 1; i < imax; i += 1, ia += 2) {\n\t\t\t\tindices[++ii] = 0;\n\t\t\t\tindices[++ii] = ia;\n\t\t\t\tindices[++ii] = ia + 2;\n\t\t\t}\n\n\t\t\tthis._vertexBuffer.update();\n\t\t\tthis._uvBuffer.update();\n\t\t\tthis._indexBuffer.update();\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Mesh, MeshMaterial, Renderer, Texture } from \"pixi.js\";\nimport { DApplications } from \"./d-applications\";\nimport { DBaseBackgroundMeshGeometry } from \"./d-base-background-mesh-geometry\";\nimport { DCornerMask } from \"./d-corner-mask\";\n\nexport class DBaseBackgroundMesh extends Mesh {\n\tgeometry!: DBaseBackgroundMeshGeometry;\n\tshader!: MeshMaterial;\n\n\tconstructor(texture: Texture) {\n\t\tsuper(new DBaseBackgroundMeshGeometry(), new MeshMaterial(texture));\n\t\ttexture.on(\"update\", (): void => {\n\t\t\tDApplications.update(this);\n\t\t});\n\t}\n\n\t// @ts-ignore\n\tget width(): number {\n\t\treturn this.geometry.width;\n\t}\n\n\tset width(width: number) {\n\t\tthis.geometry.width = width;\n\t}\n\n\t// @ts-ignore\n\tget height(): number {\n\t\treturn this.geometry.height;\n\t}\n\n\tset height(height: number) {\n\t\tthis.geometry.height = height;\n\t}\n\n\tget cornerRadius(): number {\n\t\treturn this.geometry.cornerRadius;\n\t}\n\n\tset cornerRadius(cornerRadius: number) {\n\t\tthis.geometry.cornerRadius = cornerRadius;\n\t}\n\n\tget cornerMask(): DCornerMask {\n\t\treturn this.geometry.cornerMask;\n\t}\n\n\tset cornerMask(cornerMask: DCornerMask) {\n\t\tthis.geometry.cornerMask = cornerMask;\n\t}\n\n\tprotected _render(renderer: Renderer): void {\n\t\tthis.geometry.update(renderer);\n\t\tsuper._render(renderer);\n\t}\n}\n","/*\n * Copyright (C) 2020 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBase, DThemeBase } from \"./d-base\";\nimport { DBaseBackgroundMesh } from \"./d-base-background-mesh\";\nimport { DBaseSnippet } from \"./d-base-snippet\";\nimport { DBaseStateSet } from \"./d-base-state-set\";\nimport { DCornerMask } from \"./d-corner-mask\";\n\nexport class DBaseBackgroundSnippet implements DBaseSnippet {\n\tprotected _mesh?: DBaseBackgroundMesh;\n\n\tprotected get(base: DBase, theme: DThemeBase): DBaseBackgroundMesh {\n\t\tlet result = this._mesh;\n\t\tif (result == null) {\n\t\t\tresult = new DBaseBackgroundMesh(theme.getBackgroundTexture());\n\t\t\t(result as any).parent = base;\n\t\t\tthis._mesh = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected hide(): void {\n\t\tconst mesh = this._mesh;\n\t\tif (mesh != null) {\n\t\t\tmesh.visible = false;\n\t\t}\n\t}\n\n\tonReflow(\n\t\tbase: DBase,\n\t\twidth: number,\n\t\theight: number,\n\t\ttheme: DThemeBase,\n\t\tstate: DBaseStateSet,\n\t\tcornerRadius: number,\n\t\tcornerMask: DCornerMask\n\t): void {\n\t\tconst background = base.background;\n\t\tconst backgroundColor = background.getColor(state);\n\t\tif (backgroundColor != null) {\n\t\t\tconst backgroundAlpha = background.getAlpha(state);\n\t\t\tif (0 < backgroundAlpha) {\n\t\t\t\tconst backgroundMesh = this.get(base, theme);\n\t\t\t\tbackgroundMesh.tint = backgroundColor;\n\t\t\t\tbackgroundMesh.alpha = backgroundAlpha;\n\t\t\t\tbackgroundMesh.width = width;\n\t\t\t\tbackgroundMesh.height = height;\n\t\t\t\tbackgroundMesh.cornerRadius = cornerRadius;\n\t\t\t\tbackgroundMesh.cornerMask = cornerMask;\n\t\t\t\tbackgroundMesh.visible = true;\n\t\t\t} else {\n\t\t\t\tthis.hide();\n\t\t\t}\n\t\t} else {\n\t\t\tthis.hide();\n\t\t}\n\t}\n\n\trender(renderer: PIXI.Renderer): void {\n\t\tthis._mesh?.render(renderer);\n\t}\n\n\tupdateTransform(): void {\n\t\tthis._mesh?.updateTransform();\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Renderer } from \"pixi.js\";\nimport { DBaseMeshGeometry, DBaseMeshGeometryTable } from \"./d-base-mesh-geometry\";\nimport { DBorderMask } from \"./d-border-mask\";\nimport { DCornerMask } from \"./d-corner-mask\";\n\nexport class DBaseBorderMeshGeometry extends DBaseMeshGeometry {\n\tprotected _borderWidth: number;\n\tprotected _borderMask: DBorderMask;\n\n\tconstructor() {\n\t\tsuper(\n\t\t\tnew Float32Array(32 * DBaseMeshGeometry.N),\n\t\t\tnew Float32Array(32 * DBaseMeshGeometry.N),\n\t\t\tnew Uint16Array(4 * 18 * DBaseMeshGeometry.N)\n\t\t);\n\n\t\tthis._borderWidth = 0;\n\t\tthis._borderMask = DBorderMask.NONE;\n\t}\n\n\tget borderWidth(): number {\n\t\treturn this._borderWidth;\n\t}\n\n\tset borderWidth(borderWidth: number) {\n\t\tif (this._borderWidth !== borderWidth) {\n\t\t\tthis._borderWidth = borderWidth;\n\t\t\tthis._isDirty = true;\n\t\t}\n\t}\n\n\tget borderMask(): DBorderMask {\n\t\treturn this._borderMask;\n\t}\n\n\tset borderMask(borderMask: DBorderMask) {\n\t\tif (this._borderMask !== borderMask) {\n\t\t\tthis._borderMask = borderMask;\n\t\t\tthis._isDirty = true;\n\t\t}\n\t}\n\n\tprotected fillVertices(\n\t\tvertices: Float32Array,\n\t\tuvs: Float32Array,\n\t\tiv: number,\n\t\tiuv: number,\n\t\tn: number,\n\t\tx: number,\n\t\ty: number,\n\t\tr: number,\n\t\tdr: number,\n\t\tborderWidth: number,\n\t\ttable: DBaseMeshGeometryTable\n\t): void {\n\t\tconst borderWidthHalf = 0.5 * borderWidth;\n\t\tconst r0 = r - borderWidthHalf;\n\t\tconst r2 = r + borderWidthHalf;\n\t\tconst cos = table.cos;\n\t\tconst sin = table.sin;\n\t\tconst cos0 = cos[0];\n\t\tconst sin0 = sin[0];\n\t\tconst cos1 = cos[n - 1];\n\t\tconst sin1 = sin[n - 1];\n\t\tconst x1 = x + (cos0 + cos1) * r0;\n\t\tconst y1 = y + (sin0 + sin1) * r0;\n\t\tfor (let i = 0; i < n; ++i) {\n\t\t\tconst c = cos[i];\n\t\t\tconst s = sin[i];\n\n\t\t\tlet dr1 = dr;\n\t\t\tlet dr2 = dr;\n\t\t\tconst d0 = c * cos0 + s * sin0;\n\t\t\tif (0.0001 < d0) {\n\t\t\t\tconst d0i = 1 / d0 - 1;\n\t\t\t\tdr1 = Math.min(dr1, d0i * r0);\n\t\t\t\tdr2 = Math.min(dr2, d0i * r2);\n\t\t\t}\n\t\t\tconst d1 = c * cos1 + s * sin1;\n\t\t\tif (0.0001 < d1) {\n\t\t\t\tconst d1i = 1 / d1 - 1;\n\t\t\t\tdr1 = Math.min(dr1, d1i * r0);\n\t\t\t\tdr2 = Math.min(dr2, d1i * r2);\n\t\t\t}\n\t\t\tconst r1 = r0 + dr1;\n\t\t\tconst r3 = r2 + dr2;\n\n\t\t\tif (0 < r0) {\n\t\t\t\tvertices[++iv] = x + c * r0;\n\t\t\t\tvertices[++iv] = y + s * r0;\n\t\t\t\tvertices[++iv] = x + c * r1;\n\t\t\t\tvertices[++iv] = y + s * r1;\n\t\t\t} else {\n\t\t\t\tvertices[++iv] = x1;\n\t\t\t\tvertices[++iv] = y1;\n\t\t\t\tvertices[++iv] = x1;\n\t\t\t\tvertices[++iv] = y1;\n\t\t\t}\n\t\t\tvertices[++iv] = x + c * r2;\n\t\t\tvertices[++iv] = y + s * r2;\n\t\t\tvertices[++iv] = x + c * r3;\n\t\t\tvertices[++iv] = y + s * r3;\n\t\t\tuvs[++iuv] = 0.5 * (1 + c);\n\t\t\tuvs[++iuv] = 0.5 * (1 + s);\n\t\t\tuvs[++iuv] = 0.5;\n\t\t\tuvs[++iuv] = 0.5;\n\t\t\tuvs[++iuv] = 0.5;\n\t\t\tuvs[++iuv] = 0.5;\n\t\t\tuvs[++iuv] = 0.5 * (1 + c);\n\t\t\tuvs[++iuv] = 0.5 * (1 + s);\n\t\t}\n\t}\n\n\tprotected fillIndices(\n\t\tindices: Uint16Array,\n\t\tia: number,\n\t\tii: number,\n\t\tn: number,\n\t\tend: boolean,\n\t\tloop: boolean\n\t): void {\n\t\tfor (let i = 0, imax = n - 1; i < imax; ++i) {\n\t\t\tindices[++ii] = ia + 0;\n\t\t\tindices[++ii] = ia + 1;\n\t\t\tindices[++ii] = ia + 4;\n\n\t\t\tindices[++ii] = ia + 4;\n\t\t\tindices[++ii] = ia + 1;\n\t\t\tindices[++ii] = ia + 5;\n\t\t\tia += 1;\n\n\t\t\tindices[++ii] = ia + 0;\n\t\t\tindices[++ii] = ia + 1;\n\t\t\tindices[++ii] = ia + 4;\n\n\t\t\tindices[++ii] = ia + 4;\n\t\t\tindices[++ii] = ia + 1;\n\t\t\tindices[++ii] = ia + 5;\n\t\t\tia += 1;\n\n\t\t\tindices[++ii] = ia + 0;\n\t\t\tindices[++ii] = ia + 1;\n\t\t\tindices[++ii] = ia + 4;\n\n\t\t\tindices[++ii] = ia + 4;\n\t\t\tindices[++ii] = ia + 1;\n\t\t\tindices[++ii] = ia + 5;\n\t\t\tia += 2;\n\t\t}\n\t\tif (end) {\n\t\t\tif (loop) {\n\t\t\t\tindices[++ii] = ia + 0;\n\t\t\t\tindices[++ii] = ia + 1;\n\t\t\t\tindices[++ii] = 0;\n\n\t\t\t\tindices[++ii] = 0;\n\t\t\t\tindices[++ii] = ia + 1;\n\t\t\t\tindices[++ii] = 1;\n\t\t\t\tia += 1;\n\n\t\t\t\tindices[++ii] = ia + 0;\n\t\t\t\tindices[++ii] = ia + 1;\n\t\t\t\tindices[++ii] = 1;\n\n\t\t\t\tindices[++ii] = 1;\n\t\t\t\tindices[++ii] = ia + 1;\n\t\t\t\tindices[++ii] = 2;\n\t\t\t\tia += 1;\n\n\t\t\t\tindices[++ii] = ia + 0;\n\t\t\t\tindices[++ii] = ia + 1;\n\t\t\t\tindices[++ii] = 2;\n\n\t\t\t\tindices[++ii] = 2;\n\t\t\t\tindices[++ii] = ia + 1;\n\t\t\t\tindices[++ii] = 3;\n\t\t\t\tia += 2;\n\t\t\t} else {\n\t\t\t\tindices[++ii] = ia + 0;\n\t\t\t\tindices[++ii] = ia + 1;\n\t\t\t\tindices[++ii] = ia + 4;\n\n\t\t\t\tindices[++ii] = ia + 4;\n\t\t\t\tindices[++ii] = ia + 1;\n\t\t\t\tindices[++ii] = ia + 5;\n\t\t\t\tia += 1;\n\n\t\t\t\tindices[++ii] = ia + 0;\n\t\t\t\tindices[++ii] = ia + 1;\n\t\t\t\tindices[++ii] = ia + 4;\n\n\t\t\t\tindices[++ii] = ia + 4;\n\t\t\t\tindices[++ii] = ia + 1;\n\t\t\t\tindices[++ii] = ia + 5;\n\t\t\t\tia += 1;\n\n\t\t\t\tindices[++ii] = ia + 0;\n\t\t\t\tindices[++ii] = ia + 1;\n\t\t\t\tindices[++ii] = ia + 4;\n\n\t\t\t\tindices[++ii] = ia + 4;\n\t\t\t\tindices[++ii] = ia + 1;\n\t\t\t\tindices[++ii] = ia + 5;\n\t\t\t\tia += 2;\n\t\t\t}\n\t\t} else {\n\t\t\tindices[++ii] = ia;\n\t\t\tindices[++ii] = ia;\n\t\t\tindices[++ii] = ia;\n\n\t\t\tindices[++ii] = ia;\n\t\t\tindices[++ii] = ia;\n\t\t\tindices[++ii] = ia;\n\t\t\tia += 1;\n\n\t\t\tindices[++ii] = ia;\n\t\t\tindices[++ii] = ia;\n\t\t\tindices[++ii] = ia;\n\n\t\t\tindices[++ii] = ia;\n\t\t\tindices[++ii] = ia;\n\t\t\tindices[++ii] = ia;\n\t\t\tia += 1;\n\n\t\t\tindices[++ii] = ia;\n\t\t\tindices[++ii] = ia;\n\t\t\tindices[++ii] = ia;\n\n\t\t\tindices[++ii] = ia;\n\t\t\tindices[++ii] = ia;\n\t\t\tindices[++ii] = ia;\n\t\t\tia += 2;\n\t\t}\n\t}\n\n\tupdate(renderer: Renderer): void {\n\t\tconst resolution = renderer.resolution;\n\t\tif (this._isDirty || this._resolution !== resolution) {\n\t\t\tthis._isDirty = false;\n\t\t\tthis._resolution = resolution;\n\n\t\t\tconst vrtcs = this._vertices;\n\t\t\tconst uvs = this._uvs;\n\t\t\tconst indices = this._indices;\n\n\t\t\tconst w = this._width;\n\t\t\tconst h = this._height;\n\t\t\tconst bw = this._borderWidth;\n\t\t\tconst r = Math.min(0.5 * w, 0.5 * h, this._cornerRadius);\n\t\t\tconst a = 1 / resolution;\n\n\t\t\tconst x0 = 0;\n\t\t\tconst x1 = r;\n\t\t\tconst x2 = w - r;\n\t\t\tconst x3 = w;\n\n\t\t\tconst y0 = 0;\n\t\t\tconst y1 = r;\n\t\t\tconst y2 = h - r;\n\t\t\tconst y3 = h;\n\n\t\t\tconst borderMask = this._borderMask;\n\t\t\tconst bt = !(borderMask & DBorderMask.TOP);\n\t\t\tconst bb = !(borderMask & DBorderMask.BOTTOM);\n\t\t\tconst bl = !(borderMask & DBorderMask.LEFT);\n\t\t\tconst br = !(borderMask & DBorderMask.RIGHT);\n\n\t\t\tconst cornerMask = this._cornerMask;\n\t\t\tconst ctl = !(cornerMask & DCornerMask.TOP_LEFT);\n\t\t\tconst ctr = !(cornerMask & DCornerMask.TOP_RIGHT);\n\t\t\tconst cbl = !(cornerMask & DCornerMask.BOTTOM_LEFT);\n\t\t\tconst cbr = !(cornerMask & DCornerMask.BOTTOM_RIGHT);\n\n\t\t\t// Vertices & UVs\n\t\t\tlet iv = -1;\n\t\t\tlet iuv = -1;\n\t\t\tlet ia = 0;\n\t\t\tlet ii = -1;\n\n\t\t\tconst n = DBaseMeshGeometry.N;\n\t\t\tconst n4 = n << 2;\n\t\t\tconst n8 = n << 3;\n\t\t\tconst n18 = 18 * n;\n\n\t\t\tconst tables = this.getTables();\n\t\t\tconst tlt = tables[0];\n\t\t\tconst ttr = tables[1];\n\t\t\tconst trb = tables[2];\n\t\t\tconst tbl = tables[3];\n\n\t\t\t// left -> top\n\t\t\tif (ctl) {\n\t\t\t\tif (bl || bt) {\n\t\t\t\t\tthis.fillVertices(vrtcs, uvs, iv, iuv, n, x1, y1, r, a, bw, tlt);\n\t\t\t\t} else {\n\t\t\t\t\tthis.fillVertices(vrtcs, uvs, iv, iuv, n, x1, y1, r, 0, 0, tlt);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (bl || bt) {\n\t\t\t\t\tthis.fillVertices(vrtcs, uvs, iv, iuv, n, x0, y0, 0, 0, bw, tlt);\n\t\t\t\t} else {\n\t\t\t\t\tthis.fillVertices(vrtcs, uvs, iv, iuv, n, x0, y0, 0, 0, 0, tlt);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.fillIndices(indices, ia, ii, n, bt, false);\n\t\t\tiv += n8;\n\t\t\tiuv += n8;\n\t\t\tia += n4;\n\t\t\tii += n18;\n\n\t\t\t// top -> right\n\t\t\tif (ctr) {\n\t\t\t\tif (bt || br) {\n\t\t\t\t\tthis.fillVertices(vrtcs, uvs, iv, iuv, n, x2, y1, r, a, bw, ttr);\n\t\t\t\t} else {\n\t\t\t\t\tthis.fillVertices(vrtcs, uvs, iv, iuv, n, x2, y1, r, 0, 0, ttr);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (bt || br) {\n\t\t\t\t\tthis.fillVertices(vrtcs, uvs, iv, iuv, n, x3, y0, 0, 0, bw, ttr);\n\t\t\t\t} else {\n\t\t\t\t\tthis.fillVertices(vrtcs, uvs, iv, iuv, n, x3, y0, 0, 0, 0, ttr);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.fillIndices(indices, ia, ii, n, br, false);\n\t\t\tiv += n8;\n\t\t\tiuv += n8;\n\t\t\tia += n4;\n\t\t\tii += n18;\n\n\t\t\t// right -> bottom\n\t\t\tif (cbr) {\n\t\t\t\tif (br || bb) {\n\t\t\t\t\tthis.fillVertices(vrtcs, uvs, iv, iuv, n, x2, y2, r, a, bw, trb);\n\t\t\t\t} else {\n\t\t\t\t\tthis.fillVertices(vrtcs, uvs, iv, iuv, n, x2, y2, r, 0, 0, trb);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (br || bb) {\n\t\t\t\t\tthis.fillVertices(vrtcs, uvs, iv, iuv, n, x3, y3, 0, 0, bw, trb);\n\t\t\t\t} else {\n\t\t\t\t\tthis.fillVertices(vrtcs, uvs, iv, iuv, n, x3, y3, 0, 0, 0, trb);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.fillIndices(indices, ia, ii, n, bb, false);\n\t\t\tiv += n8;\n\t\t\tiuv += n8;\n\t\t\tia += n4;\n\t\t\tii += n18;\n\n\t\t\t// bottom -> left\n\t\t\tif (cbl) {\n\t\t\t\tif (bb || bl) {\n\t\t\t\t\tthis.fillVertices(vrtcs, uvs, iv, iuv, n, x1, y2, r, a, bw, tbl);\n\t\t\t\t} else {\n\t\t\t\t\tthis.fillVertices(vrtcs, uvs, iv, iuv, n, x1, y2, r, 0, 0, tbl);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (bb || bl) {\n\t\t\t\t\tthis.fillVertices(vrtcs, uvs, iv, iuv, n, x0, y3, 0, 0, bw, tbl);\n\t\t\t\t} else {\n\t\t\t\t\tthis.fillVertices(vrtcs, uvs, iv, iuv, n, x0, y3, 0, 0, 0, tbl);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.fillIndices(indices, ia, ii, n, bl, true);\n\t\t\tiv += n8;\n\t\t\tiuv += n8;\n\t\t\tia += n4;\n\t\t\tii += n18;\n\n\t\t\tthis._vertexBuffer.update();\n\t\t\tthis._uvBuffer.update();\n\t\t\tthis._indexBuffer.update();\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Mesh, MeshMaterial, Renderer, Texture } from \"pixi.js\";\nimport { DApplications } from \"./d-applications\";\nimport { DBaseBorderMeshGeometry } from \"./d-base-border-mesh-geometry\";\nimport { DBorderMask } from \"./d-border-mask\";\nimport { DCornerMask } from \"./d-corner-mask\";\n\nexport class DBaseBorderMesh extends Mesh {\n\tgeometry!: DBaseBorderMeshGeometry;\n\tshader!: MeshMaterial;\n\n\tconstructor(texture: Texture) {\n\t\tsuper(new DBaseBorderMeshGeometry(), new MeshMaterial(texture));\n\t\ttexture.on(\"update\", (): void => {\n\t\t\tDApplications.update(this);\n\t\t});\n\t}\n\n\t// @ts-ignore\n\tget width(): number {\n\t\treturn this.geometry.width;\n\t}\n\n\tset width(width: number) {\n\t\tthis.geometry.width = width;\n\t}\n\n\t// @ts-ignore\n\tget height(): number {\n\t\treturn this.geometry.height;\n\t}\n\n\tset height(height: number) {\n\t\tthis.geometry.height = height;\n\t}\n\n\tget cornerRadius(): number {\n\t\treturn this.geometry.cornerRadius;\n\t}\n\n\tset cornerRadius(cornerRadius: number) {\n\t\tthis.geometry.cornerRadius = cornerRadius;\n\t}\n\n\tget cornerMask(): DCornerMask {\n\t\treturn this.geometry.cornerMask;\n\t}\n\n\tset cornerMask(cornerMask: DCornerMask) {\n\t\tthis.geometry.cornerMask = cornerMask;\n\t}\n\n\tget borderWidth(): number {\n\t\treturn this.geometry.borderWidth;\n\t}\n\n\tset borderWidth(borderWidth: number) {\n\t\tthis.geometry.borderWidth = borderWidth;\n\t}\n\n\tget borderMask(): DBorderMask {\n\t\treturn this.geometry.borderMask;\n\t}\n\n\tset borderMask(borderMask: DBorderMask) {\n\t\tthis.geometry.borderMask = borderMask;\n\t}\n\n\tprotected _render(renderer: Renderer): void {\n\t\tthis.geometry.update(renderer);\n\t\tsuper._render(renderer);\n\t}\n}\n","/*\n * Copyright (C) 2020 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBase, DThemeBase } from \"./d-base\";\nimport { DBaseBorderMesh } from \"./d-base-border-mesh\";\nimport { DBaseSnippet } from \"./d-base-snippet\";\nimport { DBaseStateSet } from \"./d-base-state-set\";\nimport { DCornerMask } from \"./d-corner-mask\";\n\nexport class DBaseBorderSnippet implements DBaseSnippet {\n\tprotected _mesh?: DBaseBorderMesh;\n\n\tprotected get(base: DBase, theme: DThemeBase): DBaseBorderMesh {\n\t\tlet result = this._mesh;\n\t\tif (result == null) {\n\t\t\tresult = new DBaseBorderMesh(theme.getBorderTexture());\n\t\t\t(result as any).parent = base;\n\t\t\tthis._mesh = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected hide(): void {\n\t\tconst mesh = this._mesh;\n\t\tif (mesh != null) {\n\t\t\tmesh.visible = false;\n\t\t}\n\t}\n\n\tonReflow(\n\t\tbase: DBase,\n\t\twidth: number,\n\t\theight: number,\n\t\ttheme: DThemeBase,\n\t\tstate: DBaseStateSet,\n\t\tcornerRadius: number,\n\t\tcornerMask: DCornerMask\n\t): void {\n\t\tconst border = base.border;\n\t\tconst borderColor = border.getColor(state);\n\t\tif (borderColor != null) {\n\t\t\tconst borderAlpha = border.getAlpha(state);\n\t\t\tif (0 < borderAlpha) {\n\t\t\t\tconst borderWidth = border.getWidth(state);\n\t\t\t\tconst borderMask = border.getMask(state);\n\t\t\t\tconst borderMesh = this.get(base, theme);\n\t\t\t\tconst borderOffset = (border.getAlign(state) - 0.5) * borderWidth;\n\t\t\t\tborderMesh.tint = borderColor;\n\t\t\t\tborderMesh.alpha = borderAlpha;\n\t\t\t\tborderMesh.x = -borderOffset;\n\t\t\t\tborderMesh.y = -borderOffset;\n\t\t\t\tborderMesh.width = width + borderOffset * 2;\n\t\t\t\tborderMesh.height = height + borderOffset * 2;\n\t\t\t\tborderMesh.cornerRadius = cornerRadius;\n\t\t\t\tborderMesh.cornerMask = cornerMask;\n\t\t\t\tborderMesh.borderWidth = borderWidth;\n\t\t\t\tborderMesh.borderMask = borderMask;\n\t\t\t\tborderMesh.visible = true;\n\t\t\t} else {\n\t\t\t\tthis.hide();\n\t\t\t}\n\t\t} else {\n\t\t\tthis.hide();\n\t\t}\n\t}\n\n\trender(renderer: PIXI.Renderer): void {\n\t\tthis._mesh?.render(renderer);\n\t}\n\n\tupdateTransform(): void {\n\t\tthis._mesh?.updateTransform();\n\t}\n}\n","/*\n * Copyright (C) 2020 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBase, DThemeBase } from \"./d-base\";\nimport { DBaseBorderMesh } from \"./d-base-border-mesh\";\nimport { DBaseSnippet } from \"./d-base-snippet\";\nimport { DBaseStateSet } from \"./d-base-state-set\";\nimport { DCornerMask } from \"./d-corner-mask\";\n\nexport class DBaseOutlineSnippet implements DBaseSnippet {\n\tprotected _mesh?: DBaseBorderMesh;\n\n\tprotected get(base: DBase, theme: DThemeBase): DBaseBorderMesh {\n\t\tlet result = this._mesh;\n\t\tif (result == null) {\n\t\t\tresult = new DBaseBorderMesh(theme.getBorderTexture());\n\t\t\t(result as any).parent = base;\n\t\t\tthis._mesh = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected hide(): void {\n\t\tconst mesh = this._mesh;\n\t\tif (mesh != null) {\n\t\t\tmesh.visible = false;\n\t\t}\n\t}\n\n\tonReflow(\n\t\tbase: DBase,\n\t\twidth: number,\n\t\theight: number,\n\t\ttheme: DThemeBase,\n\t\tstate: DBaseStateSet,\n\t\tcornerRadius: number,\n\t\tcornerMask: DCornerMask\n\t): void {\n\t\tconst outline = base.outline;\n\t\tconst outlineColor = outline.getColor(state);\n\t\tif (outlineColor != null) {\n\t\t\tconst outlineAlpha = outline.getAlpha(state);\n\t\t\tif (0 < outlineAlpha) {\n\t\t\t\tconst outlineWidth = outline.getWidth(state);\n\t\t\t\tconst outlineMask = outline.getMask(state);\n\t\t\t\tconst outlineMesh = this.get(base, theme);\n\t\t\t\tconst outlineOffset =\n\t\t\t\t\toutline.getOffset(state) + (outline.getAlign(state) - 0.5) * outlineWidth;\n\t\t\t\toutlineMesh.tint = outlineColor;\n\t\t\t\toutlineMesh.alpha = outlineAlpha;\n\t\t\t\toutlineMesh.x = -outlineOffset;\n\t\t\t\toutlineMesh.y = -outlineOffset;\n\t\t\t\toutlineMesh.width = width + outlineOffset * 2;\n\t\t\t\toutlineMesh.height = height + outlineOffset * 2;\n\t\t\t\toutlineMesh.cornerRadius = cornerRadius;\n\t\t\t\toutlineMesh.cornerMask = cornerMask;\n\t\t\t\toutlineMesh.borderWidth = outlineWidth;\n\t\t\t\toutlineMesh.borderMask = outlineMask;\n\t\t\t\toutlineMesh.visible = true;\n\t\t\t} else {\n\t\t\t\tthis.hide();\n\t\t\t}\n\t\t} else {\n\t\t\tthis.hide();\n\t\t}\n\t}\n\n\trender(renderer: PIXI.Renderer): void {\n\t\tthis._mesh?.render(renderer);\n\t}\n\n\tupdateTransform(): void {\n\t\tthis._mesh?.updateTransform();\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBase } from \"./d-base\";\nimport { DBaseBackgroundSnippet } from \"./d-base-background-snippet\";\nimport { DBaseBorderSnippet } from \"./d-base-border-snippet\";\nimport { DBaseOutlineSnippet } from \"./d-base-outline-snippet\";\nimport { DBaseReflowable } from \"./d-base-reflowable\";\n\nexport class DBaseReflowableImpl implements DBaseReflowable {\n\tprotected _background: DBaseBackgroundSnippet;\n\tprotected _border: DBaseBorderSnippet;\n\tprotected _outline: DBaseOutlineSnippet;\n\n\tconstructor(base: DBase) {\n\t\tconst background = new DBaseBackgroundSnippet();\n\t\tthis._background = background;\n\t\tbase.snippet.add(background, true);\n\n\t\tconst border = new DBaseBorderSnippet();\n\t\tthis._border = border;\n\t\tbase.snippet.add(border, true);\n\n\t\tconst outline = new DBaseOutlineSnippet();\n\t\tthis._outline = outline;\n\t\tbase.snippet.add(outline, false);\n\n\t\tbase.reflowable.add(this);\n\t}\n\n\tonReflow(base: DBase, width: number, height: number): void {\n\t\tconst theme = base.theme;\n\t\tconst state = base.state;\n\t\tconst corner = base.corner;\n\t\tconst cornerRadius = corner.getRadius();\n\t\tconst cornerMask = corner.getMask();\n\t\tthis._background.onReflow(base, width, height, theme, state, cornerRadius, cornerMask);\n\t\tthis._border.onReflow(base, width, height, theme, state, cornerRadius, cornerMask);\n\t\tthis._outline.onReflow(base, width, height, theme, state, cornerRadius, cornerMask);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nconst BEFORE = 1;\nconst AFTER = 2;\n\nexport const DLayoutClearType = {\n\tNONE: 0,\n\tBEFORE,\n\tAFTER,\n\tBOTH: BEFORE | AFTER\n} as const;\n\nexport type DLayoutClearType = number;\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DScalar } from \"./d-scalar\";\nimport { isNumber } from \"./util/is-number\";\n\nexport const DScalarExpressionNodeType = {\n\t// Parensesis\n\tOPEN: 0,\n\tCLOSE: 1,\n\tPARENSESIS: 2,\n\n\t// Operations\n\tADD_OR_PLUS: 3,\n\tSUB_OR_MINUS: 4,\n\n\tPLUS: 5,\n\tMINUS: 6,\n\n\tADD: 7,\n\tSUB: 8,\n\tMUL: 9,\n\tDIV: 10,\n\n\t// Functions\n\tMIN: 11,\n\tMAX: 12,\n\tCOMMA: 13,\n\n\t// Literals\n\tPARENT: 14,\n\tSELF: 15,\n\tPADDING: 16,\n\tCURRENT: 17,\n\tNUMBER: 18\n} as const;\n\nexport type DScalarExpressionNodeType =\n\ttypeof DScalarExpressionNodeType[keyof typeof DScalarExpressionNodeType];\n\nexport type DScalarExpressionNodeTypeOperator =\n\t| typeof DScalarExpressionNodeType.SUB_OR_MINUS\n\t| typeof DScalarExpressionNodeType.ADD_OR_PLUS\n\t| typeof DScalarExpressionNodeType.SUB\n\t| typeof DScalarExpressionNodeType.ADD\n\t| typeof DScalarExpressionNodeType.MUL\n\t| typeof DScalarExpressionNodeType.DIV\n\t| typeof DScalarExpressionNodeType.OPEN\n\t| typeof DScalarExpressionNodeType.CLOSE\n\t| typeof DScalarExpressionNodeType.MIN\n\t| typeof DScalarExpressionNodeType.MAX\n\t| typeof DScalarExpressionNodeType.COMMA;\n\nexport type DScalarExpressionNodeTypeLiteral =\n\t| typeof DScalarExpressionNodeType.NUMBER\n\t| typeof DScalarExpressionNodeType.PARENT\n\t| typeof DScalarExpressionNodeType.SELF\n\t| typeof DScalarExpressionNodeType.PADDING\n\t| typeof DScalarExpressionNodeType.CURRENT;\n\nexport type DScalarExpressionToken =\n\t| DScalarExpressionNodeTypeOperator\n\t| [DScalarExpressionNodeTypeLiteral, number];\n\nexport interface DScalarExpressionNodeOrTokenParensesis {\n\t[0]: typeof DScalarExpressionNodeType.PARENSESIS;\n\t[1]: DScalarExpressionNodeOrToken[];\n}\n\nexport interface DScalarExpressionNodeOrTokenUnary {\n\t[0]: typeof DScalarExpressionNodeType.PLUS | typeof DScalarExpressionNodeType.MINUS;\n\t[1]: DScalarExpressionNodeOrToken;\n}\n\nexport type DScalarExpressionNodeArithmeticOperator =\n\t| typeof DScalarExpressionNodeType.SUB\n\t| typeof DScalarExpressionNodeType.ADD\n\t| typeof DScalarExpressionNodeType.MUL\n\t| typeof DScalarExpressionNodeType.DIV;\n\nexport interface DScalarExpressionNodeOrTokenArithmetic {\n\t[0]: DScalarExpressionNodeArithmeticOperator;\n\t[1]: DScalarExpressionNodeOrToken;\n\t[2]: DScalarExpressionNodeOrToken;\n}\n\nexport interface DScalarExpressionNodeOrTokenFunction {\n\t[0]: typeof DScalarExpressionNodeType.MIN | typeof DScalarExpressionNodeType.MAX;\n\t[1]: DScalarExpressionNodeOrToken[];\n}\n\nexport type DScalarExpressionNodeOrToken =\n\t| DScalarExpressionToken\n\t| DScalarExpressionNodeOrTokenParensesis\n\t| DScalarExpressionNodeOrTokenUnary\n\t| DScalarExpressionNodeOrTokenArithmetic\n\t| DScalarExpressionNodeOrTokenFunction;\n\nexport interface DScalarExpressionNodeLiteral {\n\t[0]: DScalarExpressionNodeTypeLiteral;\n\t[1]: number;\n}\n\nexport interface DScalarExpressionNodeParensesis {\n\t[0]: typeof DScalarExpressionNodeType.PARENSESIS;\n\t[1]: DScalarExpressionNode[];\n}\n\nexport interface DScalarExpressionNodeUnary {\n\t[0]: typeof DScalarExpressionNodeType.PLUS | typeof DScalarExpressionNodeType.MINUS;\n\t[1]: DScalarExpressionNode;\n}\n\nexport interface DScalarExpressionNodeArithmetic {\n\t[0]: DScalarExpressionNodeArithmeticOperator;\n\t[1]: DScalarExpressionNode;\n\t[2]: DScalarExpressionNode;\n}\n\nexport interface DScalarExpressionNodeFunction {\n\t[0]: typeof DScalarExpressionNodeType.MIN | typeof DScalarExpressionNodeType.MAX;\n\t[1]: DScalarExpressionNode[];\n}\n\nexport type DScalarExpressionNode =\n\t| DScalarExpressionNodeParensesis\n\t| DScalarExpressionNodeUnary\n\t| DScalarExpressionNodeArithmetic\n\t| DScalarExpressionNodeFunction\n\t| DScalarExpressionNodeLiteral;\n\n/**\n * Parser and evaluator of the scalar expressions like `100% - 50s`.\n *\n * Literals\n *\n * * x%: 0.01 * x * parent value\n * * xs: 0.01 * x * self value\n * * xp: 0.01 * x * padding value\n * * xc: 0.01 * x * current value\n *\n * Operators\n *\n * * `+`\n * * `-`\n * * `*`\n * * `/`\n * * `(` and `)`\n *\n * Functions\n *\n * * min( a, b, ... )\n * * max( a, b, ... )\n *\n * Examples\n *\n * * `90%`: 0.9 * parent value\n * * `50s`: 0.5 * self value\n * * `90% - 50s`: 0.9 * parent value - 0.5 * self value\n * * `90% - (50s + 100) * 2`: 0.9 * parent value - ( 0.5 * self value + 100 ) * 2\n */\nexport class DScalarExpression implements DScalar {\n\tprotected static TOKEN_REGEX = /(?:\\+|-|\\*|\\/|\\(|\\)|min|max|,|(?:\\d+(?:\\.\\d*)?[%psc]?))/g;\n\tprotected _node: DScalarExpressionNode;\n\n\tconstructor(expression: string) {\n\t\tconst nodes: DScalarExpressionNodeOrToken[] = this.toToken(expression);\n\t\tlet i = 0;\n\t\tdo {\n\t\t\ti = this.toParensesis(nodes, i);\n\t\t} while (i < nodes.length);\n\t\tthis.toUnary(nodes);\n\t\tthis.toArithmetic(nodes, DScalarExpressionNodeType.MUL, DScalarExpressionNodeType.DIV);\n\t\tthis.toArithmetic(nodes, DScalarExpressionNodeType.ADD, DScalarExpressionNodeType.SUB);\n\t\tif (nodes.length === 1) {\n\t\t\tconst node = nodes[0];\n\t\t\tif (!isNumber(node)) {\n\t\t\t\tthis._node = node as any;\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tthrow new Error(`Failed to parse '${expression}'`);\n\t}\n\n\ttoParensesis(nodes: DScalarExpressionNodeOrToken[], ifrom: number): number {\n\t\tlet ito = nodes.length;\n\t\tfor (let i = ifrom; i < ito; ++i) {\n\t\t\tconst inode = nodes[i];\n\t\t\tif (inode === DScalarExpressionNodeType.OPEN) {\n\t\t\t\tlet istart = i;\n\t\t\t\tlet nodeType: DScalarExpressionNodeType = DScalarExpressionNodeType.PARENSESIS;\n\t\t\t\tif (0 < i) {\n\t\t\t\t\tconst nodeTypePrev = nodes[i - 1];\n\t\t\t\t\tif (\n\t\t\t\t\t\tnodeTypePrev === DScalarExpressionNodeType.MIN ||\n\t\t\t\t\t\tnodeTypePrev === DScalarExpressionNodeType.MAX\n\t\t\t\t\t) {\n\t\t\t\t\t\tistart -= 1;\n\t\t\t\t\t\tnodeType = nodeTypePrev;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor (let j = i + 1; j < ito; ++j) {\n\t\t\t\t\tconst jnode = nodes[j];\n\t\t\t\t\tif (jnode === DScalarExpressionNodeType.CLOSE) {\n\t\t\t\t\t\tnodes[istart] = [nodeType, this.toComma(nodes, i + 1, j)];\n\t\t\t\t\t\tnodes.splice(istart + 1, j - istart);\n\t\t\t\t\t\treturn istart + 1;\n\t\t\t\t\t} else if (jnode === DScalarExpressionNodeType.OPEN) {\n\t\t\t\t\t\tj = this.toParensesis(nodes, j) - 1;\n\t\t\t\t\t\tito = nodes.length;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthrow new Error(`Malformed parensesis`);\n\t\t\t}\n\t\t}\n\t\treturn ito;\n\t}\n\n\ttoCommaOf(\n\t\tnodes: DScalarExpressionNodeOrToken[],\n\t\tifrom: number,\n\t\tito: number\n\t): DScalarExpressionNodeOrToken {\n\t\tconst l = ito - ifrom;\n\t\tif (l <= 0) {\n\t\t\treturn [DScalarExpressionNodeType.NUMBER, 0];\n\t\t} else if (l <= 1) {\n\t\t\treturn nodes[ifrom];\n\t\t} else {\n\t\t\tconst operand: DScalarExpressionNodeOrToken[] = [];\n\t\t\tfor (let j = ifrom; j < ito; ++j) {\n\t\t\t\toperand.push(nodes[j]);\n\t\t\t}\n\t\t\treturn [DScalarExpressionNodeType.PARENSESIS, operand];\n\t\t}\n\t}\n\n\ttoComma(\n\t\tnodes: DScalarExpressionNodeOrToken[],\n\t\tifrom: number,\n\t\tito: number\n\t): DScalarExpressionNodeOrToken[] {\n\t\tlet result: DScalarExpressionNodeOrToken[] | null = null;\n\t\tlet iprev = ifrom;\n\t\tfor (let i = ifrom; i < ito; ++i) {\n\t\t\tconst node = nodes[i];\n\t\t\tif (node === DScalarExpressionNodeType.COMMA) {\n\t\t\t\tresult = result || [];\n\t\t\t\tresult.push(this.toCommaOf(nodes, iprev, i));\n\t\t\t\tiprev = i + 1;\n\t\t\t}\n\t\t}\n\t\tif (iprev < ito) {\n\t\t\tif (result == null) {\n\t\t\t\tconst operand: DScalarExpressionNodeOrToken[] = [];\n\t\t\t\tfor (let i = iprev; i < ito; ++i) {\n\t\t\t\t\toperand.push(nodes[i]);\n\t\t\t\t}\n\t\t\t\treturn operand;\n\t\t\t} else {\n\t\t\t\tresult.push(this.toCommaOf(nodes, iprev, ito));\n\t\t\t}\n\t\t}\n\t\treturn result || [];\n\t}\n\n\ttoUnaryNode(node: DScalarExpressionNodeOrToken): void {\n\t\tif (!isNumber(node)) {\n\t\t\tif (\n\t\t\t\tnode[0] === DScalarExpressionNodeType.PARENSESIS ||\n\t\t\t\tnode[0] === DScalarExpressionNodeType.MIN ||\n\t\t\t\tnode[0] === DScalarExpressionNodeType.MAX\n\t\t\t) {\n\t\t\t\tthis.toUnary(node[1]);\n\t\t\t}\n\t\t}\n\t}\n\n\ttoUnary(nodes: DScalarExpressionNodeOrToken[]): void {\n\t\tfor (let i = 0, imax = nodes.length; i < imax; ++i) {\n\t\t\tconst node = nodes[i];\n\t\t\tif (\n\t\t\t\tnode === DScalarExpressionNodeType.ADD_OR_PLUS ||\n\t\t\t\tnode === DScalarExpressionNodeType.SUB_OR_MINUS\n\t\t\t) {\n\t\t\t\tif (i <= 0 || isNumber(nodes[i - 1])) {\n\t\t\t\t\tif (i + 1 < imax && !isNumber(nodes[i + 1])) {\n\t\t\t\t\t\tconst operand = nodes.splice(i + 1, 1)[0];\n\t\t\t\t\t\tconst type =\n\t\t\t\t\t\t\tnode === DScalarExpressionNodeType.ADD_OR_PLUS\n\t\t\t\t\t\t\t\t? DScalarExpressionNodeType.PLUS\n\t\t\t\t\t\t\t\t: DScalarExpressionNodeType.MINUS;\n\t\t\t\t\t\tnodes[i] = [type, operand];\n\t\t\t\t\t\timax = nodes.length;\n\t\t\t\t\t\tthis.toUnaryNode(operand);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow new Error(\"Malformed unary operator\");\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconst type =\n\t\t\t\t\t\tnode === DScalarExpressionNodeType.ADD_OR_PLUS\n\t\t\t\t\t\t\t? DScalarExpressionNodeType.ADD\n\t\t\t\t\t\t\t: DScalarExpressionNodeType.SUB;\n\t\t\t\t\tnodes[i] = type;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.toUnaryNode(node);\n\t\t\t\timax = nodes.length;\n\t\t\t}\n\t\t}\n\t}\n\n\ttoArithmeticNode(\n\t\tnode: DScalarExpressionNodeOrToken,\n\t\toperatorA: DScalarExpressionNodeArithmeticOperator,\n\t\toperatorB: DScalarExpressionNodeArithmeticOperator\n\t): void {\n\t\tif (!isNumber(node)) {\n\t\t\tif (\n\t\t\t\tnode[0] === DScalarExpressionNodeType.PARENSESIS ||\n\t\t\t\tnode[0] === DScalarExpressionNodeType.MIN ||\n\t\t\t\tnode[0] === DScalarExpressionNodeType.MAX\n\t\t\t) {\n\t\t\t\tthis.toArithmetic(node[1], operatorA, operatorB);\n\t\t\t} else if (\n\t\t\t\tnode[0] === DScalarExpressionNodeType.PLUS ||\n\t\t\t\tnode[0] === DScalarExpressionNodeType.MINUS\n\t\t\t) {\n\t\t\t\tthis.toArithmeticNode(node[1], operatorA, operatorB);\n\t\t\t} else if (\n\t\t\t\tnode[0] === DScalarExpressionNodeType.ADD ||\n\t\t\t\tnode[0] === DScalarExpressionNodeType.SUB ||\n\t\t\t\tnode[0] === DScalarExpressionNodeType.MUL ||\n\t\t\t\tnode[0] === DScalarExpressionNodeType.DIV\n\t\t\t) {\n\t\t\t\tthis.toArithmeticNode(node[1], operatorA, operatorB);\n\t\t\t\tthis.toArithmeticNode(node[2], operatorA, operatorB);\n\t\t\t}\n\t\t}\n\t}\n\n\ttoArithmetic(\n\t\tnodes: DScalarExpressionNodeOrToken[],\n\t\toperatorA: DScalarExpressionNodeArithmeticOperator,\n\t\toperatorB: DScalarExpressionNodeArithmeticOperator\n\t): void {\n\t\tfor (let i = 0, imax = nodes.length; i < imax; ++i) {\n\t\t\tconst node = nodes[i];\n\t\t\tif (node === operatorA || node === operatorB) {\n\t\t\t\tif (0 < i && i + 1 < imax) {\n\t\t\t\t\tconst left = nodes[i - 1];\n\t\t\t\t\tconst right = nodes[i + 1];\n\t\t\t\t\tif (!isNumber(left) && !isNumber(right)) {\n\t\t\t\t\t\tnodes.splice(i, 2);\n\t\t\t\t\t\tnodes[i - 1] = [node, left, right];\n\t\t\t\t\t\ti -= 1;\n\t\t\t\t\t\timax = nodes.length;\n\t\t\t\t\t\tthis.toArithmeticNode(left, operatorA, operatorB);\n\t\t\t\t\t\tthis.toArithmeticNode(right, operatorA, operatorB);\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthrow new Error(`Malformed operands for the operator ${node}`);\n\t\t\t} else {\n\t\t\t\tthis.toArithmeticNode(node, operatorA, operatorB);\n\t\t\t\timax = nodes.length;\n\t\t\t}\n\t\t}\n\t}\n\n\ttoToken(expression: string): DScalarExpressionToken[] {\n\t\tconst tokens: DScalarExpressionToken[] = [];\n\t\twhile (true) {\n\t\t\tconst matched = DScalarExpression.TOKEN_REGEX.exec(expression);\n\t\t\tif (matched != null) {\n\t\t\t\tconst token = matched[0];\n\t\t\t\tconst tokenTypeOperator = this.toTokenOperator(token);\n\t\t\t\tif (tokenTypeOperator != null) {\n\t\t\t\t\ttokens.push(tokenTypeOperator);\n\t\t\t\t} else {\n\t\t\t\t\tconst parsedToken = parseFloat(token);\n\t\t\t\t\tif (parsedToken !== parsedToken) {\n\t\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t\t`Unexpected token '${token}' at ${matched.index} in '${expression}'`\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\tconst tokenTypeLiteral = this.toTokenLiteral(token);\n\t\t\t\t\tif (tokenTypeLiteral != null) {\n\t\t\t\t\t\ttokens.push([tokenTypeLiteral, parsedToken * 0.01]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttokens.push([DScalarExpressionNodeType.NUMBER, parsedToken]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn tokens;\n\t}\n\n\ttoTokenOperator(token: string): DScalarExpressionNodeTypeOperator | null {\n\t\tswitch (token) {\n\t\t\tcase \"+\":\n\t\t\t\treturn DScalarExpressionNodeType.ADD_OR_PLUS;\n\t\t\tcase \"-\":\n\t\t\t\treturn DScalarExpressionNodeType.SUB_OR_MINUS;\n\t\t\tcase \"*\":\n\t\t\t\treturn DScalarExpressionNodeType.MUL;\n\t\t\tcase \"/\":\n\t\t\t\treturn DScalarExpressionNodeType.DIV;\n\t\t\tcase \"(\":\n\t\t\t\treturn DScalarExpressionNodeType.OPEN;\n\t\t\tcase \")\":\n\t\t\t\treturn DScalarExpressionNodeType.CLOSE;\n\t\t\tcase \",\":\n\t\t\t\treturn DScalarExpressionNodeType.COMMA;\n\t\t\tcase \"min\":\n\t\t\t\treturn DScalarExpressionNodeType.MIN;\n\t\t\tcase \"max\":\n\t\t\t\treturn DScalarExpressionNodeType.MAX;\n\t\t}\n\t\treturn null;\n\t}\n\n\ttoTokenLiteral(token: string): DScalarExpressionNodeTypeLiteral | null {\n\t\tconst tokenLength = token.length;\n\t\tif (0 < tokenLength) {\n\t\t\tswitch (token[tokenLength - 1]) {\n\t\t\t\tcase \"%\":\n\t\t\t\t\treturn DScalarExpressionNodeType.PARENT;\n\t\t\t\tcase \"s\":\n\t\t\t\t\treturn DScalarExpressionNodeType.SELF;\n\t\t\t\tcase \"p\":\n\t\t\t\t\treturn DScalarExpressionNodeType.PADDING;\n\t\t\t\tcase \"c\":\n\t\t\t\t\treturn DScalarExpressionNodeType.CURRENT;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tprotected evaluate(\n\t\tnode: DScalarExpressionNode,\n\t\tparent: number,\n\t\tself: number,\n\t\tpadding: number,\n\t\tcurrent: number\n\t): number {\n\t\tswitch (node[0]) {\n\t\t\tcase DScalarExpressionNodeType.PARENSESIS:\n\t\t\t\tconst nodes = node[1];\n\t\t\t\treturn this.evaluate(nodes[nodes.length - 1], parent, self, padding, current);\n\n\t\t\t// Unary operators\n\t\t\tcase DScalarExpressionNodeType.PLUS:\n\t\t\t\treturn +this.evaluate(node[1], parent, self, padding, current);\n\n\t\t\tcase DScalarExpressionNodeType.MINUS:\n\t\t\t\treturn -this.evaluate(node[1], parent, self, padding, current);\n\n\t\t\t// Four arithmetic operators\n\t\t\tcase DScalarExpressionNodeType.ADD:\n\t\t\t\treturn (\n\t\t\t\t\tthis.evaluate(node[1], parent, self, padding, current) +\n\t\t\t\t\tthis.evaluate(node[2], parent, self, padding, current)\n\t\t\t\t);\n\t\t\tcase DScalarExpressionNodeType.SUB:\n\t\t\t\treturn (\n\t\t\t\t\tthis.evaluate(node[1], parent, self, padding, current) -\n\t\t\t\t\tthis.evaluate(node[2], parent, self, padding, current)\n\t\t\t\t);\n\t\t\tcase DScalarExpressionNodeType.MUL:\n\t\t\t\treturn (\n\t\t\t\t\tthis.evaluate(node[1], parent, self, padding, current) *\n\t\t\t\t\tthis.evaluate(node[2], parent, self, padding, current)\n\t\t\t\t);\n\t\t\tcase DScalarExpressionNodeType.DIV:\n\t\t\t\treturn (\n\t\t\t\t\tthis.evaluate(node[1], parent, self, padding, current) /\n\t\t\t\t\tthis.evaluate(node[2], parent, self, padding, current)\n\t\t\t\t);\n\n\t\t\t// Functions\n\t\t\tcase DScalarExpressionNodeType.MIN:\n\t\t\t\tif (0 < node[1].length) {\n\t\t\t\t\tconst args = node[1];\n\t\t\t\t\tlet result = this.evaluate(args[0], parent, self, padding, current);\n\t\t\t\t\tfor (let i = 1, imax = args.length; i < imax; ++i) {\n\t\t\t\t\t\tresult = Math.min(\n\t\t\t\t\t\t\tresult,\n\t\t\t\t\t\t\tthis.evaluate(args[i], parent, self, padding, current)\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t\treturn 0;\n\t\t\tcase DScalarExpressionNodeType.MAX:\n\t\t\t\tif (0 < node[1].length) {\n\t\t\t\t\tconst args = node[1];\n\t\t\t\t\tlet result = this.evaluate(args[0], parent, self, padding, current);\n\t\t\t\t\tfor (let i = 1, imax = args.length; i < imax; ++i) {\n\t\t\t\t\t\tresult = Math.max(\n\t\t\t\t\t\t\tresult,\n\t\t\t\t\t\t\tthis.evaluate(args[i], parent, self, padding, current)\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t\treturn 0;\n\n\t\t\t// Literals\n\t\t\tcase DScalarExpressionNodeType.PARENT:\n\t\t\t\treturn node[1] * parent;\n\t\t\tcase DScalarExpressionNodeType.SELF:\n\t\t\t\treturn node[1] * self;\n\t\t\tcase DScalarExpressionNodeType.PADDING:\n\t\t\t\treturn node[1] * padding;\n\t\t\tcase DScalarExpressionNodeType.CURRENT:\n\t\t\t\treturn node[1] * current;\n\t\t\tcase DScalarExpressionNodeType.NUMBER:\n\t\t\t\treturn node[1];\n\t\t}\n\n\t\treturn 0;\n\t}\n\n\tcalculate(parent: number, self: number, padding: number, current: number): number {\n\t\treturn this.evaluate(this._node, parent, self, padding, current);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DCoordinatePosition, DCoordinateSizeNoAuto } from \"./d-coordinate\";\nimport { DScalarExpression } from \"./d-scalar-expression\";\nimport { DScalarFunction } from \"./d-scalar-function\";\nimport { isFunction } from \"./util/is-function\";\nimport { isNumber } from \"./util/is-number\";\nimport { isString } from \"./util/is-string\";\n\nconst POSITION_CENTER = (p: number, s: number) => (p - s) * 0.5;\nconst POSITION_PADDING = (p: number, s: number, d: number) => d;\nconst SIZE_MAXIMIZED = (p: number) => p;\nconst SIZE_PADDING = (p: number, s: number, d: number) => p - d;\n\nexport class DScalarFunctions {\n\tstatic position(coordinate: DCoordinatePosition | undefined): DScalarFunction | null {\n\t\tif (coordinate == null || isNumber(coordinate)) {\n\t\t\treturn null;\n\t\t} else if (isString(coordinate)) {\n\t\t\tswitch (coordinate) {\n\t\t\t\tcase \"center\":\n\t\t\t\tcase \"CENTER\":\n\t\t\t\t\treturn POSITION_CENTER;\n\t\t\t\tcase \"padding\":\n\t\t\t\tcase \"PADDING\":\n\t\t\t\t\treturn POSITION_PADDING;\n\t\t\t}\n\n\t\t\tconst scalarExpression = new DScalarExpression(coordinate);\n\t\t\treturn (parent: number, self: number, padding: number, current: number): number => {\n\t\t\t\treturn scalarExpression.calculate(parent, self, padding, current);\n\t\t\t};\n\t\t} else if (isFunction(coordinate)) {\n\t\t\treturn coordinate;\n\t\t} else {\n\t\t\tconst scalar = coordinate;\n\t\t\treturn (parent: number, self: number, padding: number, current: number): number => {\n\t\t\t\treturn scalar.calculate(parent, self, padding, current);\n\t\t\t};\n\t\t}\n\t}\n\n\tstatic size(coordinate: DCoordinateSizeNoAuto | undefined): DScalarFunction | null {\n\t\tif (coordinate == null || isNumber(coordinate)) {\n\t\t\treturn null;\n\t\t} else if (isString(coordinate)) {\n\t\t\tswitch (coordinate) {\n\t\t\t\tcase \"100%\":\n\t\t\t\tcase \"maximized\":\n\t\t\t\tcase \"MAXIMIZED\":\n\t\t\t\t\treturn SIZE_MAXIMIZED;\n\t\t\t\tcase \"padding\":\n\t\t\t\tcase \"PADDING\":\n\t\t\t\t\treturn SIZE_PADDING;\n\t\t\t}\n\n\t\t\tconst scalarExpression = new DScalarExpression(coordinate);\n\t\t\treturn (parent: number, self: number, padding: number, current: number): number => {\n\t\t\t\treturn scalarExpression.calculate(parent, self, padding, current);\n\t\t\t};\n\t\t} else if (isFunction(coordinate)) {\n\t\t\treturn coordinate;\n\t\t} else {\n\t\t\tconst scalar = coordinate;\n\t\t\treturn (parent: number, self: number, padding: number, current: number): number => {\n\t\t\t\treturn scalar.calculate(parent, self, padding, current);\n\t\t\t};\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DisplayObject, interaction, Point } from \"pixi.js\";\nimport InteractionEvent = interaction.InteractionEvent;\nimport { DApplicationTarget } from \"../d-application-like\";\nimport { DApplications } from \"../d-applications\";\n\nexport type UtilPointerEventOnClick = (e: InteractionEvent, isSimulated: boolean) => void;\n\nexport type UtilPointerEventOnDblClick = (e: MouseEvent | TouchEvent, isSimulated: boolean) => void;\n\nexport interface UtilPointerEventClickTarget extends DApplicationTarget {\n\ton(name: string, handler: UtilPointerEventOnClick): void;\n}\n\nexport class UtilPointerEvent {\n\tstatic CLICK_DISTANCE_THRESHOLD: number = 10;\n\tstatic DBLCLICK_INTERVAL_THRESHOLD: number = 333;\n\tstatic LONG_CLICK_THRESHOLD: number = 750;\n\n\tstatic get touchable(): boolean {\n\t\treturn \"ontouchstart\" in document;\n\t}\n\n\tstatic get tap(): string {\n\t\treturn \"pointertap\";\n\t}\n\n\tstatic get down(): string {\n\t\treturn \"pointerdown\";\n\t}\n\n\tstatic get enter(): string {\n\t\treturn \"pointerenter\";\n\t}\n\n\tstatic get leave(): string {\n\t\treturn \"pointerleave\";\n\t}\n\n\tstatic get move(): string {\n\t\treturn \"pointermove\";\n\t}\n\n\tstatic get out(): string {\n\t\treturn \"pointerout\";\n\t}\n\n\tstatic get over(): string {\n\t\treturn \"pointerover\";\n\t}\n\n\tstatic get up(): string {\n\t\treturn \"pointerup\";\n\t}\n\n\tstatic get upoutside(): string {\n\t\treturn \"pointerupoutside\";\n\t}\n\n\tstatic get cancel(): string {\n\t\treturn \"pointercancel\";\n\t}\n\n\tstatic toGlobal(\n\t\te: MouseEvent | TouchEvent,\n\t\tinteractionManager: interaction.InteractionManager,\n\t\tresult: Point\n\t): Point {\n\t\tif (\"touches\" in e) {\n\t\t\tconst touches = e.changedTouches;\n\t\t\tconst touch = touches[touches.length - 1];\n\t\t\tif (touch != null) {\n\t\t\t\tinteractionManager.mapPositionToPoint(result, touch.clientX, touch.clientY);\n\t\t\t} else {\n\t\t\t\tinteractionManager.mapPositionToPoint(result, 0, 0);\n\t\t\t}\n\t\t} else {\n\t\t\tinteractionManager.mapPositionToPoint(result, e.clientX, e.clientY);\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected static isValidDistance(e: InteractionEvent, x: number, y: number): boolean {\n\t\tconst global = e.data.global;\n\t\tconst dx = Math.abs(x - global.x);\n\t\tconst dy = Math.abs(y - global.y);\n\t\tconst threshold = this.CLICK_DISTANCE_THRESHOLD;\n\t\treturn dx < threshold && dy < threshold;\n\t}\n\n\tstatic onClick(target: UtilPointerEventClickTarget, onClick: UtilPointerEventOnClick): void {\n\t\tlet isDowned = false;\n\t\tlet downX = 0;\n\t\tlet downY = 0;\n\t\tlet interactionManagerBound: interaction.InteractionManager | null = null;\n\t\tconst up = this.up;\n\t\tconst upoutside = this.upoutside;\n\t\tconst cancel = this.cancel;\n\t\tconst cleanup = (): void => {\n\t\t\tisDowned = false;\n\t\t\tif (interactionManagerBound) {\n\t\t\t\tinteractionManagerBound.off(up, onUp);\n\t\t\t\tinteractionManagerBound.off(upoutside, onCancel);\n\t\t\t\tinteractionManagerBound.off(cancel, onCancel);\n\t\t\t\tinteractionManagerBound = null;\n\t\t\t}\n\t\t};\n\t\ttarget.on(\"click\", (e: InteractionEvent): void => {\n\t\t\tif (isDowned) {\n\t\t\t\tcleanup();\n\t\t\t}\n\t\t\tonClick(e, false);\n\t\t});\n\t\tconst onUp = (e: InteractionEvent): void => {\n\t\t\tif (isDowned) {\n\t\t\t\tcleanup();\n\t\t\t\tif (this.contains(target, e.target)) {\n\t\t\t\t\tif (this.isValidDistance(e, downX, downY)) {\n\t\t\t\t\t\tonClick(e, true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tconst onCancel = (e: InteractionEvent): void => {\n\t\t\tif (isDowned) {\n\t\t\t\tcleanup();\n\t\t\t}\n\t\t};\n\t\ttarget.on(this.down, (e: InteractionEvent): void => {\n\t\t\tif (isDowned) {\n\t\t\t\tconst global = e.data.global;\n\t\t\t\tdownX = global.x;\n\t\t\t\tdownY = global.y;\n\t\t\t} else {\n\t\t\t\tisDowned = true;\n\t\t\t\tconst global = e.data.global;\n\t\t\t\tdownX = global.x;\n\t\t\t\tdownY = global.y;\n\t\t\t\tif (interactionManagerBound) {\n\t\t\t\t\tinteractionManagerBound.off(up, onUp);\n\t\t\t\t\tinteractionManagerBound.off(upoutside, onCancel);\n\t\t\t\t\tinteractionManagerBound.off(cancel, onCancel);\n\t\t\t\t\tinteractionManagerBound = null;\n\t\t\t\t}\n\t\t\t\tconst layer = DApplications.getLayer(target);\n\t\t\t\tif (layer) {\n\t\t\t\t\tinteractionManagerBound = layer.renderer.plugins.interaction;\n\t\t\t\t\tinteractionManagerBound.once(up, onUp);\n\t\t\t\t\tinteractionManagerBound.once(upoutside, onCancel);\n\t\t\t\t\tinteractionManagerBound.once(cancel, onCancel);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tstatic onDblClick(target: HTMLElement, onDblClick: UtilPointerEventOnDblClick): void {\n\t\ttarget.addEventListener(\"dblclick\", (e) => onDblClick(e, false));\n\n\t\tif (this.touchable) {\n\t\t\tlet isDowned = 0;\n\t\t\tlet downX = 0;\n\t\t\tlet downY = 0;\n\t\t\tlet clickTime = 0;\n\n\t\t\ttarget.addEventListener(\"touchstart\", (e: TouchEvent): void => {\n\t\t\t\tif (isDowned !== 0 && isDowned !== 2) {\n\t\t\t\t\tisDowned = 0;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst touches = e.touches;\n\t\t\t\tconst touchesLength = touches.length;\n\t\t\t\tif (touchesLength <= 0) {\n\t\t\t\t\tisDowned = 0;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst touch = touches.item(touchesLength - 1);\n\t\t\t\tif (touch == null) {\n\t\t\t\t\tisDowned = 0;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tisDowned += 1;\n\t\t\t\tdownX = touch.clientX;\n\t\t\t\tdownY = touch.clientY;\n\t\t\t});\n\n\t\t\ttarget.addEventListener(\"touchend\", (e: TouchEvent): void => {\n\t\t\t\tif (isDowned !== 1 && isDowned !== 3) {\n\t\t\t\t\tisDowned = 0;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst touches = e.changedTouches;\n\t\t\t\tconst touchesLength = touches.length;\n\t\t\t\tif (touchesLength <= 0) {\n\t\t\t\t\tisDowned = 0;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst touch = touches[touchesLength - 1];\n\t\t\t\tif (touch == null) {\n\t\t\t\t\tisDowned = 0;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst dx = downX - touch.clientX;\n\t\t\t\tconst dy = downY - touch.clientY;\n\t\t\t\tif (this.CLICK_DISTANCE_THRESHOLD <= Math.abs(dx) + Math.abs(dy)) {\n\t\t\t\t\tisDowned = 0;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (isDowned === 1) {\n\t\t\t\t\tclickTime = e.timeStamp;\n\t\t\t\t\tisDowned = 2;\n\t\t\t\t} else {\n\t\t\t\t\tconst elapsedTime = e.timeStamp - clickTime;\n\t\t\t\t\tif (elapsedTime < this.DBLCLICK_INTERVAL_THRESHOLD) {\n\t\t\t\t\t\tisDowned = 0;\n\t\t\t\t\t\tonDblClick(e, true);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tclickTime = e.timeStamp;\n\t\t\t\t\t\tisDowned = 2;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\ttarget.addEventListener(\"touchcancel\", (): void => {\n\t\t\t\tisDowned = 0;\n\t\t\t});\n\t\t}\n\t}\n\n\tstatic contains(target: unknown, targetOrChild: DisplayObject | null): boolean {\n\t\tlet current = targetOrChild;\n\t\twhile (current != null && current !== target) {\n\t\t\tcurrent = current.parent;\n\t\t}\n\t\treturn current === target;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DCoordinateSize } from \"./d-coordinate\";\n\nexport class DBaseAuto {\n\tprotected _isOn: boolean;\n\n\tconstructor() {\n\t\tthis._isOn = false;\n\t}\n\n\tget isOff(): boolean {\n\t\treturn !this._isOn;\n\t}\n\n\tget isOn(): boolean {\n\t\treturn this._isOn;\n\t}\n\n\ttoCoordinate(def: DCoordinateSize): DCoordinateSize {\n\t\treturn this._isOn ? \"auto\" : def;\n\t}\n\n\t/**\n\t * Update the auto settings by the given size.\n\t *\n\t * @param size a size\n\t * @returns True if the given size is \"auto\".\n\t */\n\tfrom(size: DCoordinateSize): boolean {\n\t\tif (size === \"auto\" || size === \"AUTO\") {\n\t\t\tthis._isOn = true;\n\t\t\treturn true;\n\t\t}\n\t\tthis._isOn = false;\n\t\treturn false;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBaseAuto } from \"./d-base-auto\";\n\nexport class DBaseAutoSet {\n\treadonly width: DBaseAuto;\n\treadonly height: DBaseAuto;\n\n\tconstructor() {\n\t\tthis.width = new DBaseAuto();\n\t\tthis.height = new DBaseAuto();\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Container, Renderer } from \"pixi.js\";\nimport { DBaseSnippet } from \"./d-base-snippet\";\n\nexport class DBaseSnippetContainer {\n\tprotected _parent: Container;\n\tprotected _befores: DBaseSnippet[];\n\tprotected _afters: DBaseSnippet[];\n\tprotected _renderable: boolean;\n\n\tconstructor(parent: Container) {\n\t\tthis._parent = parent;\n\t\tthis._befores = [];\n\t\tthis._afters = [];\n\t\tthis._renderable = true;\n\t}\n\n\tget renderable(): boolean {\n\t\treturn this._renderable;\n\t}\n\n\tset renderable(renderable: boolean) {\n\t\tthis._renderable = renderable;\n\t}\n\n\tadd(snippet: DBaseSnippet, phase: boolean): void {\n\t\tconst list = phase ? this._befores : this._afters;\n\t\tlist.push(snippet);\n\t\tif (\"parent\" in snippet) {\n\t\t\tsnippet.parent = this._parent;\n\t\t}\n\t}\n\n\taddAt(snippet: DBaseSnippet, phase: boolean, index: number): void {\n\t\tconst list = phase ? this._befores : this._afters;\n\t\tif (index === 0) {\n\t\t\tlist.unshift(snippet);\n\t\t} else if (0 < index && index < list.length) {\n\t\t\tlist.splice(index, 0, snippet);\n\t\t} else {\n\t\t\tlist.push(snippet);\n\t\t}\n\t\tif (\"parent\" in snippet) {\n\t\t\tsnippet.parent = this._parent;\n\t\t}\n\t}\n\n\tremove(snippet: DBaseSnippet, phase: boolean): void {\n\t\tconst list = phase ? this._befores : this._afters;\n\t\tconst index = list.indexOf(snippet);\n\t\tif (0 <= index) {\n\t\t\tlist.splice(index, 1);\n\t\t\tif (\"parent\" in snippet) {\n\t\t\t\tsnippet.parent = null;\n\t\t\t}\n\t\t}\n\t}\n\n\trender(renderer: Renderer, phase: boolean): void {\n\t\tif (this._renderable) {\n\t\t\tconst list = phase ? this._befores : this._afters;\n\t\t\tfor (let i = 0, imax = list.length; i < imax; ++i) {\n\t\t\t\tconst snippet = list[i];\n\t\t\t\tsnippet.updateTransform();\n\t\t\t\tsnippet.render(renderer);\n\t\t\t}\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBase } from \"./d-base\";\nimport { DBaseReflowable } from \"./d-base-reflowable\";\n\nexport class DBaseReflowableContainer implements DBaseReflowable {\n\tprotected _list: DBaseReflowable[];\n\n\tconstructor() {\n\t\tthis._list = [];\n\t}\n\n\tadd(reflowable: DBaseReflowable): void {\n\t\tthis._list.push(reflowable);\n\t}\n\n\tremove(reflowable: DBaseReflowable): void {\n\t\tconst list = this._list;\n\t\tconst index = list.indexOf(reflowable);\n\t\tif (0 <= index) {\n\t\t\tlist.splice(index, 1);\n\t\t}\n\t}\n\n\tonReflow(base: DBase, width: number, height: number): void {\n\t\tconst list = this._list;\n\t\tfor (let i = 0, imax = list.length; i < imax; ++i) {\n\t\t\tlist[i].onReflow(base, width, height);\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {\n\tContainer,\n\tDisplayObject,\n\tinteraction,\n\tPoint,\n\tRectangle,\n\tRenderer,\n\tTexture,\n\tTransform\n} from \"pixi.js\";\nimport InteractionEvent = interaction.InteractionEvent;\nimport InteractionManager = interaction.InteractionManager;\nimport { DApplications } from \"./d-applications\";\nimport { DBackgroundStateAware } from \"./d-background\";\nimport { DBaseBackground } from \"./d-base-background\";\nimport { DBaseBorder } from \"./d-base-border\";\nimport { DBaseCorner } from \"./d-base-corner\";\nimport { DBaseInteractive } from \"./d-base-interactive\";\nimport { DBaseOutline } from \"./d-base-outline\";\nimport { DBasePadding } from \"./d-base-padding\";\nimport { DBasePoint } from \"./d-base-point\";\nimport { DBaseReflowableImpl } from \"./d-base-reflowable-impl\";\nimport { DBaseStateSet } from \"./d-base-state-set\";\nimport { DBaseStateSetImplObservable } from \"./d-base-state-set-impl-observable\";\nimport { DBorderStateAware } from \"./d-border\";\nimport { DBorderMask } from \"./d-border-mask\";\nimport { DCoordinatePosition, DCoordinateSize } from \"./d-coordinate\";\nimport { DCorner } from \"./d-corner\";\nimport { DCornerMask } from \"./d-corner-mask\";\nimport { DThemeFont } from \"./d-font\";\nimport { DLayoutClearType } from \"./d-layout-clear-type\";\nimport { DOutline } from \"./d-outline\";\nimport { DPadding } from \"./d-padding\";\nimport { DScalarFunctions } from \"./d-scalar-functions\";\nimport { DScalarSet } from \"./d-scalar-set\";\nimport { DShadow } from \"./d-shadow\";\nimport { DStateAwareOrValueMightBe } from \"./d-state-aware\";\nimport { DThemes } from \"./theme/d-themes\";\nimport { isFunction } from \"./util/is-function\";\nimport { isNumber } from \"./util/is-number\";\nimport { isString } from \"./util/is-string\";\nimport { UtilKeyboardEvent, UtilKeyboardEventShortcut } from \"./util/util-keyboard-event\";\nimport { UtilPointerEvent } from \"./util/util-pointer-event\";\nimport { UtilWheelEventDeltas } from \"./util/util-wheel-event\";\nimport { DBaseAutoSet } from \"./d-base-auto-set\";\nimport { toEnum } from \"./util/to-enum\";\nimport { DOnOptions } from \"./d-on-options\";\nimport { DBaseSnippetContainer } from \"./d-base-snippet-container\";\nimport { DBaseReflowableContainer } from \"./d-base-reflowable-container\";\n\n/**\n * {@link DBase} padding options.\n */\nexport interface DBasePaddingOptions {\n\t/** A top padding */\n\ttop?: number;\n\n\t/** A right padding */\n\tright?: number;\n\n\t/** A bottom padding */\n\tbottom?: number;\n\n\t/** A left padding */\n\tleft?: number;\n}\n\n/**\n * {@link DBase} corner options.\n */\nexport interface DBaseCornerOptions {\n\t/** A radius */\n\tradius?: number;\n\n\t/** Masked corners get unrounded. */\n\tmask?: keyof typeof DCornerMask | DCornerMask;\n}\n\n/**\n * {@link DBase} events.\n */\nexport interface DBaseEvents<EMITTER> {\n\t/**\n\t * Triggered when an initialization is finished.\n\t *\n\t *     on( \"init\", ( emitter ) => {} )\n\t *\n\t * @param emitter an emitter\n\t */\n\tinit(emitter: EMITTER): void;\n\n\t/**\n\t * Triggered when added to a container.\n\t *\n\t * @param container a container added to\n\t */\n\tadded(container: Container): void;\n\n\t/**\n\t * Triggered when removed from a container.\n\t *\n\t * @param container a container removed from\n\t */\n\tremoved(container: Container): void;\n\n\t/**\n\t * Triggered when moved.\n\t *\n\t * @param newX a new x\n\t * @param newY a new y\n\t * @param oldX an old x\n\t * @param oldY an old y\n\t * @param emitter an emitter\n\t */\n\tmove(newX: number, newY: number, oldX: number, oldY: number, emitter: EMITTER): void;\n\n\t/**\n\t * Triggered when resized.\n\t *\n\t * @param newWidth a new width\n\t * @param newHeight a new height\n\t * @param oldWidth an old width\n\t * @param oldHeight an old height\n\t * @param emitter an emitter\n\t */\n\tresize(\n\t\tnewWidth: number,\n\t\tnewHeight: number,\n\t\toldWidth: number,\n\t\toldHeight: number,\n\t\temitter: EMITTER\n\t): void;\n\n\t/**\n\t * Triggered when scaled.\n\t *\n\t * @param newX a new x\n\t * @param newY a new y\n\t * @param oldX an old x\n\t * @param oldY an old y\n\t * @param emitter an emitter\n\t */\n\tscale(newX: number, newY: number, oldX: number, oldY: number, emitter: EMITTER): void;\n\n\t/**\n\t * Triggered when skewed.\n\t *\n\t * @param newX a new x\n\t * @param newY a new y\n\t * @param oldX an old x\n\t * @param oldY an old y\n\t * @param emitter an emitter\n\t */\n\tskew(newX: number, newY: number, oldX: number, oldY: number, emitter: EMITTER): void;\n\n\t/**\n\t * Triggered when a state is changed.\n\t *\n\t * @param newState a new state\n\t * @param oldState an old state\n\t * @param emitter an emitter\n\t */\n\tstatechange(newState: DBaseStateSet, oldState: DBaseStateSet, emitter: EMITTER): void;\n\n\t/**\n\t * Triggered when a wheel moves.\n\t *\n\t * @param e a wheel event\n\t * @param deltas wheel move amounts\n\t * @param global a point wheel moved\n\t * @param emitter an emitter\n\t */\n\twheel(e: WheelEvent, deltas: UtilWheelEventDeltas, global: Point, emitter: EMITTER): void;\n\n\t/**\n\t * Triggered when a key gets down.\n\t *\n\t * @param e a keyboard event\n\t * @param emitter an emitter\n\t */\n\tkeydown(e: KeyboardEvent, emitter: EMITTER): void;\n\n\t/**\n\t * Triggered when a key gets up.\n\t *\n\t * @param e a keyboard event\n\t * @param emitter an emitter\n\t */\n\tkeyup(e: KeyboardEvent, emitter: EMITTER): void;\n\n\t/**\n\t * Triggered when a pointer gets on an emitter.\n\t *\n\t * @param e an interaction event.\n\t * @param emitter an emitter\n\t */\n\tover(e: InteractionEvent, emitter: EMITTER): void;\n\n\t/**\n\t * Triggered when a pointer gets out of an emitter.\n\t *\n\t * @param e an interaction event\n\t * @param emitter an emitter\n\t */\n\tout(e: InteractionEvent, emitter: EMITTER): void;\n\n\t/**\n\t * Triggered when a pointer gets down on an emitter.\n\t *\n\t * @param e an interaction event.\n\t * @param emitter an emitter\n\t */\n\tdown(e: InteractionEvent, emitter: EMITTER): void;\n\n\t/**\n\t * Triggered when a pointer gets up on an emitter.\n\t *\n\t * @param e an interaction event\n\t * @param emitter an emitter\n\t */\n\tup(e: InteractionEvent, emitter: EMITTER): void;\n\n\t/**\n\t * Triggered when an emitter is double clicked.\n\t *\n\t * @param e an event\n\t * @param interactionManager an interaction manager\n\t * @param emitter an emitter\n\t */\n\tdblclick(\n\t\te: MouseEvent | TouchEvent,\n\t\tinteractionManager: InteractionManager,\n\t\temitter: EMITTER\n\t): void;\n}\n\n/**\n * {@link DBase} \"on\" options.\n */\nexport interface DBaseOnOptions<EMITTER> extends Partial<DBaseEvents<EMITTER>>, DOnOptions {}\n\n/**\n * {@link DBase} background options.\n */\nexport interface DBaseBackgroundOptions {\n\t/**\n\t * A color code or a function returning a color code.\n\t * If a computed value is undefined, falls back to the theme color.\n\t * If a computed value is null, a background is not rendered.\n\t */\n\tcolor?: DStateAwareOrValueMightBe<number | null>;\n\n\t/**\n\t * An alpha or a function returning an alpha.\n\t * If a computed value is undefined, falls back to an background alpha of a theme.\n\t */\n\talpha?: DStateAwareOrValueMightBe<number>;\n}\n\n/**\n * {@link DBase} border options.\n */\nexport interface DBaseBorderOptions {\n\t/**\n\t * A color code or a function returning a color code.\n\t * If a computed value is undefined, falls back to the theme color.\n\t * If a computed value is null, a background is not rendered.\n\t */\n\tcolor?: DStateAwareOrValueMightBe<number | null>;\n\n\t/**\n\t * An alpha or a function returning an alpha.\n\t * If a computed value is undefined, falls back to a border alpha of a theme.\n\t */\n\talpha?: DStateAwareOrValueMightBe<number>;\n\n\t/**\n\t * A width or a function returning a width.\n\t * If a computed value is undefined, falls back to a border width of a theme.\n\t */\n\twidth?: DStateAwareOrValueMightBe<number>;\n\n\t/**\n\t * An align or a function returning an align.\n\t * If a computed value is undefined, falls back to a border align of a theme.\n\t * If an align is 0, a border is rendered completely inside of a {@link DBase}.\n\t * If an align is 1, a border is rendered completely outside of a {@link DBase}.\n\t */\n\talign?: DStateAwareOrValueMightBe<number>;\n\n\t/** Masked borders get removed. */\n\tmask?: DStateAwareOrValueMightBe<DBorderMask> | keyof typeof DBorderMask;\n}\n\n/**\n * {@link DBase} outline optons.\n */\nexport interface DBaseOutlineOptions {\n\t/**\n\t * A color code or a function returning a color code.\n\t * If a computed value is undefined, falls back to the theme color.\n\t * If a computed value is null, a background is not rendered.\n\t */\n\tcolor?: DStateAwareOrValueMightBe<number | null>;\n\n\t/**\n\t * An alpha or a function returning an alpha.\n\t * If a computed value is undefined, falls back to an outline alpha of a theme.\n\t */\n\talpha?: DStateAwareOrValueMightBe<number>;\n\n\t/**\n\t * A width or a function returning a width.\n\t * If a computed value is undefined, falls back to an outline width of a theme.\n\t */\n\twidth?: DStateAwareOrValueMightBe<number>;\n\n\t/**\n\t * An offset or a function returning an offset.\n\t * If a computed value is undefined, falls back to an outline align of a theme.\n\t * A outline moves to outside when an offset gets larger.\n\t */\n\toffset?: DStateAwareOrValueMightBe<number>;\n\n\t/**\n\t * An align or a function returning an align.\n\t * If a computed value is undefined, falls back to an outline align of a theme.\n\t * If an align is 0, an outline is rendered completely inside.\n\t * If an align is 1, an outline is rendered completely outside.\n\t */\n\talign?: DStateAwareOrValueMightBe<number>;\n\n\t/** Masked outlines get removed. */\n\tmask?: DStateAwareOrValueMightBe<DBorderMask> | keyof typeof DBorderMask;\n}\n\nexport type DBaseShadow = \"NONE\" | \"WEAK\" | \"DEFAULT\" | DShadow;\n\n/**\n * {@link DBase} options.\n */\nexport interface DBaseOptions<THEME extends DThemeBase = DThemeBase, EMITTER = any> {\n\t/**\n\t * A parent.\n\t *\n\t * In the case of UI classes which pop up (e.g., {@link DDialog} and {@link DMenu}),\n\t * if multiple application instances are there, better to set\n\t * this to an `application.stage` so that they pick a right application.\n\t * By default, they assume the last created application is\n\t * the one they belong to at the time when they are created.\n\t */\n\tparent?: Container;\n\n\t/** Children. */\n\tchildren?: Array<DisplayObject | null>;\n\n\t/** A name. */\n\tname?: string;\n\n\t/**\n\t * One of the followings:\n\t * * A X position\n\t * * A position keyword\n\t * * A position expression (Parsed by {@link DScalarExpression})\n\t * * A function returning a X position ({@link DScalarFunction})\n\t * * An object returning a X position ({@link DScalar})\n\t */\n\tx?: DCoordinatePosition;\n\n\t/**\n\t * One of the followings:\n\t * * A Y position\n\t * * A position keyword\n\t * * A position expresion (Parsed by {@link DScalarExpression})\n\t * * A function returning a Y position ({@link DScalarFunction})\n\t * * An object returning a Y position ({@link DScalar})\n\t */\n\ty?: DCoordinatePosition;\n\n\t/**\n\t * One of the followings:\n\t * * A width\n\t * * A size keyword\n\t * * A size expression (Parsed by {@link DScalarExpression})\n\t * * A function returning a width ({@link DScalarFunction})\n\t * * An object returning a width ({@link DScalar})\n\t */\n\twidth?: DCoordinateSize;\n\n\t/**\n\t * One of the followings:\n\t * * A height\n\t * * A size keyword\n\t * * A size expression (Parsed by {@link DScalarExpression})\n\t * * A function returning a hight ({@link DScalarFunction})\n\t * * An object returning a hight ({@link DScalar})\n\t */\n\theight?: DCoordinateSize;\n\n\t/**\n\t * A visibility.\n\t * Set to true to make {@link DBase} visible.\n\t * Set to false to make {@link DBase} invisible.\n\t * The default values is true.\n\t */\n\tvisible?: boolean;\n\n\t/** A default state. */\n\tstate?: string | string[];\n\n\t/** An interactivity option. */\n\tinteractive?: keyof typeof DBaseInteractive | DBaseInteractive;\n\n\t/** A padding options. */\n\tpadding?: number | DBasePaddingOptions;\n\n\t/** A corner options. */\n\tcorner?: number | DBaseCornerOptions;\n\n\t/** A theme or a theme name. */\n\ttheme?: THEME | string;\n\n\t/**\n\t * Mappings of event names and event handlers.\n\t */\n\ton?: DBaseOnOptions<EMITTER>;\n\n\t/**\n\t * A weight used by {@link DLayoutVertical} and {@link DLayoutHorizontal}.\n\t */\n\tweight?: number;\n\n\t/** A tooltip text. */\n\ttitle?: string;\n\n\t/** A shortcut option. */\n\tshortcut?: string | UtilKeyboardEventShortcut;\n\n\t/** A shortcut options. */\n\tshortcuts?: Array<string | UtilKeyboardEventShortcut>;\n\n\t/** A background options. */\n\tbackground?: DBaseBackgroundOptions;\n\n\t/** A border options. */\n\tborder?: DBaseBorderOptions;\n\n\t/** An outline options. */\n\toutline?: DBaseOutlineOptions;\n\n\t/** A shadow. */\n\tshadow?: DBaseShadow | null;\n\n\t/** A clear type used by {@link DLayoutVertical} and {@link DLayoutHorizontal}. */\n\tclear?: keyof typeof DLayoutClearType | DLayoutClearType;\n\n\t/** A cursor shape. */\n\tcursor?: DStateAwareOrValueMightBe<string>;\n}\n\n/**\n * {@link DBase} theme.\n */\nexport interface DThemeBase extends DThemeFont {\n\t/**\n\t * Returns a X coordinate.\n\t */\n\tgetX(): DCoordinatePosition;\n\n\t/**\n\t * Returns a Y coordinate.\n\t */\n\tgetY(): DCoordinatePosition;\n\n\t/**\n\t * Returns a height.\n\t */\n\tgetHeight(): DCoordinateSize;\n\n\t/**\n\t * Returns a width.\n\t */\n\tgetWidth(): DCoordinateSize;\n\n\t/**\n\t * Returns a background color.\n\t * If the color is null, backgrounds are not be rendered.\n\t *\n\t * @param state a state\n\t */\n\tgetBackgroundColor(state: DBaseStateSet): number | null;\n\n\t/**\n\t * Returns a background alpha.\n\t *\n\t * @param state a state\n\t */\n\tgetBackgroundAlpha(state: DBaseStateSet): number;\n\n\t/**\n\t * Returns a background texture.\n\t */\n\tgetBackgroundTexture(): Texture;\n\n\t/**\n\t * Returns a border color.\n\t * If the color is null, borders are not be rendered.\n\t *\n\t * @param state a state\n\t */\n\tgetBorderColor(state: DBaseStateSet): number | null;\n\n\t/**\n\t * Returns a border alpha.\n\t *\n\t * @param state a state\n\t */\n\tgetBorderAlpha(state: DBaseStateSet): number;\n\n\t/**\n\t * Returns a border width.\n\t *\n\t * @param state a state\n\t */\n\tgetBorderWidth(state: DBaseStateSet): number;\n\n\t/**\n\t * Returns a border align.\n\t *\n\t * @param state a state\n\t */\n\tgetBorderAlign(state: DBaseStateSet): number;\n\n\t/**\n\t * Returns a border mask.\n\t *\n\t * @param state a mask\n\t */\n\tgetBorderMask(state: DBaseStateSet): DBorderMask;\n\n\t/**\n\t * Returns a border texture.\n\t */\n\tgetBorderTexture(): Texture;\n\n\t/**\n\t * Returns a left padding.\n\t */\n\tgetPaddingLeft(): number;\n\n\t/**\n\t * Returns a right padding.\n\t */\n\tgetPaddingRight(): number;\n\n\t/**\n\t * Returns a top padding.\n\t */\n\tgetPaddingTop(): number;\n\n\t/**\n\t * Returns a bottom padding.\n\t */\n\tgetPaddingBottom(): number;\n\n\t/**\n\t * Returns a corner radius.\n\t */\n\tgetCornerRadius(): number;\n\n\t/**\n\t * Returns a corner mask.\n\t */\n\tgetCornerMask(): DCornerMask;\n\n\t/**\n\t * Returns an outline color.\n\t * If the color is null, outlines are not be rendered.\n\t *\n\t * @param state a state\n\t */\n\tgetOutlineColor(state: DBaseStateSet): number | null;\n\n\t/**\n\t * Returns an outline alpha.\n\t *\n\t * @param state a state\n\t */\n\tgetOutlineAlpha(state: DBaseStateSet): number;\n\n\t/**\n\t * Returns an outline width.\n\t *\n\t * @param state a state\n\t */\n\tgetOutlineWidth(state: DBaseStateSet): number;\n\n\t/**\n\t * Returns an outline offset.\n\t *\n\t * @param state a state\n\t */\n\tgetOutlineOffset(state: DBaseStateSet): number;\n\n\t/**\n\t * Returns an outline align.\n\t *\n\t * @param state a state\n\t */\n\tgetOutlineAlign(state: DBaseStateSet): number;\n\n\t/**\n\t * Returns an outline mask.\n\t *\n\t * @param state a state\n\t */\n\tgetOutlineMask(state: DBaseStateSet): DBorderMask;\n\n\t/**\n\t * Returns a shadow.\n\t * If a shadow is null, no shadow is rendered.\n\t */\n\tgetShadow(): DShadow | null;\n\n\t/**\n\t * Returns an interactivity.\n\t */\n\tgetInteractive(): DBaseInteractive;\n\n\t/**\n\t * Returns true if focusable.\n\t */\n\tnewState(state: DBaseStateSet): void;\n\n\t/**\n\t * Returns a tooltip text.\n\t */\n\tgetTitle(): string;\n\n\t/**\n\t * Returns a clear type.\n\t * A clear type is for layout classes including {@link DLayoutVertical}.\n\t */\n\tgetClearType(): DLayoutClearType;\n\n\t/**\n\t * Returns a weight.\n\t * Weights are for layout classes including {@link DLayoutVertical}.\n\t * If a weight is less than or equals to zero, layout classes are supposed not to change a width / height.\n\t */\n\tgetWeight(): number;\n\n\t/**\n\t * Creates a new shadow.\n\t */\n\tnewShadow(): DShadow | null;\n\n\t/**\n\t * Creates a new weak shadow.\n\t */\n\tnewShadowWeak(): DShadow | null;\n\n\t/**\n\t * Returns a cursor.\n\t */\n\tgetCursor(state: DBaseStateSet): string;\n}\n\nconst toTheme = <THEME extends DThemeBase>(options?: DBaseOptions<THEME>): THEME | undefined => {\n\tconst theme = options?.theme;\n\tif (theme) {\n\t\tif (isString(theme)) {\n\t\t\treturn DThemes.getInstance().get(theme);\n\t\t}\n\t\treturn theme;\n\t}\n};\n\nexport interface DRefitable {\n\treadonly width: number;\n\treadonly height: number;\n}\n\nconst toShortcuts = <THEME extends DThemeBase>(\n\toptions?: DBaseOptions<THEME>\n): UtilKeyboardEventShortcut[] | undefined => {\n\tif (options) {\n\t\tconst shortcut = options.shortcut;\n\t\tconst shortcuts = options.shortcuts;\n\t\tif (shortcuts != null || shortcut != null) {\n\t\t\tconst result: UtilKeyboardEventShortcut[] = [];\n\t\t\tif (shortcut != null) {\n\t\t\t\tresult.push(UtilKeyboardEvent.toShortcut(shortcut));\n\t\t\t}\n\t\t\tif (shortcuts != null) {\n\t\t\t\tfor (let i = 0, imax = shortcuts.length; i < imax; ++i) {\n\t\t\t\t\tUtilKeyboardEvent.toShortcut(shortcuts[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn result;\n\t\t}\n\t}\n\treturn undefined;\n};\n\n/**\n * A base class for UI classes.\n * See {@link DBaseEvents} for event details.\n */\nexport class DBase<\n\tTHEME extends DThemeBase = DThemeBase,\n\tOPTIONS extends DBaseOptions<THEME> = DBaseOptions<THEME>\n> extends Container {\n\tprotected static WORK_CONTAINS_POINT: Point = new Point();\n\n\tprivate _state: DBaseStateSet;\n\tprivate _theme: THEME;\n\tprotected _options: OPTIONS | undefined;\n\tprivate _width: number;\n\tprivate _height: number;\n\tprotected _padding: DPadding;\n\tprotected _corner: DCorner;\n\tprivate _scalarSet: DScalarSet;\n\tprotected _auto: DBaseAutoSet;\n\tprivate _isDirty: boolean;\n\tprivate _hasDirty: boolean;\n\tprotected _isChildrenDirty: boolean;\n\tprivate _shadow: DShadow | null;\n\tprivate _onShadowUpdateBound: () => void;\n\tprivate _weight: number;\n\tprivate _position: DBasePoint;\n\tprivate _scale: DBasePoint;\n\tprivate _skew: DBasePoint;\n\tprotected _title: string;\n\tprotected _background: DBackgroundStateAware;\n\tprotected _border: DBorderStateAware;\n\tprotected _outline: DOutline;\n\tprotected _clearType: DLayoutClearType;\n\tprotected _shortcuts?: UtilKeyboardEventShortcut[];\n\tprotected _snippet: DBaseSnippetContainer;\n\tprotected _reflowable: DBaseReflowableContainer;\n\tprotected _lastDownPoint?: Point;\n\tprotected _cursor?: DStateAwareOrValueMightBe<string>;\n\n\tconstructor(options?: OPTIONS) {\n\t\tsuper();\n\n\t\t// Transform\n\t\tconst transform: Transform = this.transform;\n\t\tthis._position = new DBasePoint(transform.position, (newX, newY, oldX, oldY): void => {\n\t\t\tthis.onMove(newX, newY, oldX, oldY);\n\t\t});\n\t\tthis._scale = new DBasePoint(transform.scale, (newX, newY, oldX, oldY): void => {\n\t\t\tthis.onScale(newX, newY, oldX, oldY);\n\t\t});\n\t\tthis._skew = new DBasePoint(transform.skew, (newX, newY, oldX, oldY): void => {\n\t\t\tthis.onSkew(newX, newY, oldX, oldY);\n\t\t});\n\n\t\t//\n\t\tthis._options = options;\n\t\tconst scalarSet: DScalarSet = (this._scalarSet = {});\n\t\tthis._auto = new DBaseAutoSet();\n\t\tthis._isDirty = true;\n\t\tthis._hasDirty = false;\n\t\tthis._isChildrenDirty = false;\n\t\tthis._shadow = null;\n\t\tthis.name = options?.name ?? \"\";\n\t\tconst theme = toTheme(options) || this.getThemeDefault();\n\t\tthis._theme = theme;\n\t\tthis._snippet = new DBaseSnippetContainer(this);\n\t\tthis._reflowable = new DBaseReflowableContainer();\n\t\tthis._clearType = toEnum(options?.clear ?? theme.getClearType(), DLayoutClearType);\n\t\tthis._padding = new DBasePadding(theme, options, (): void => {\n\t\t\tthis.toParentResized();\n\t\t\tthis.toChildrenDirty();\n\t\t\tDApplications.update(this);\n\t\t});\n\t\tconst toDirtyAndUpdate = (): void => {\n\t\t\tthis.toDirty();\n\t\t\tDApplications.update(this);\n\t\t};\n\t\tthis._background = new DBaseBackground(theme, options, toDirtyAndUpdate);\n\t\tthis._border = new DBaseBorder(theme, options, toDirtyAndUpdate);\n\t\tthis._outline = new DBaseOutline(theme, options, toDirtyAndUpdate);\n\t\tthis._corner = new DBaseCorner(theme, options, toDirtyAndUpdate);\n\n\t\t// X\n\t\tconst position = transform.position;\n\t\tconst x = options?.x ?? theme.getX();\n\t\tif (isNumber(x)) {\n\t\t\tposition.x = x;\n\t\t} else {\n\t\t\tposition.x = 0;\n\t\t\tscalarSet.x = DScalarFunctions.position(x);\n\t\t}\n\n\t\t// Y\n\t\tconst y = options?.y ?? theme.getY();\n\t\tif (isNumber(y)) {\n\t\t\tposition.y = y;\n\t\t} else {\n\t\t\tposition.y = 0;\n\t\t\tscalarSet.y = DScalarFunctions.position(y);\n\t\t}\n\n\t\t// Width\n\t\tconst width = options?.width ?? theme.getWidth();\n\t\tif (!this._auto.width.from(width)) {\n\t\t\tif (isNumber(width)) {\n\t\t\t\tthis._width = width;\n\t\t\t} else {\n\t\t\t\tthis._width = 100;\n\t\t\t\tscalarSet.width = DScalarFunctions.size(width);\n\t\t\t}\n\t\t} else {\n\t\t\tthis._width = 100;\n\t\t}\n\n\t\t// Height\n\t\tconst height = options?.height ?? theme.getHeight();\n\t\tif (!this._auto.height.from(height)) {\n\t\t\tif (isNumber(height)) {\n\t\t\t\tthis._height = height;\n\t\t\t} else {\n\t\t\t\tthis._height = 100;\n\t\t\t\tscalarSet.height = DScalarFunctions.size(height);\n\t\t\t}\n\t\t} else {\n\t\t\tthis._height = 100;\n\t\t}\n\n\t\t// Visibility\n\t\tconst visible = options?.visible;\n\t\tif (visible != null) {\n\t\t\tthis.visible = visible;\n\t\t}\n\n\t\t// State\n\t\tthis._state = new DBaseStateSetImplObservable((newState, oldState): void => {\n\t\t\tthis.onStateChange(newState, oldState);\n\t\t});\n\n\t\t// Interactive\n\t\tconst interactive = toEnum(\n\t\t\toptions?.interactive ?? theme.getInteractive(),\n\t\t\tDBaseInteractive\n\t\t);\n\t\tthis.interactive = !!(interactive & DBaseInteractive.SELF);\n\t\tthis.interactiveChildren = !!(interactive & DBaseInteractive.CHILDREN);\n\n\t\t// Events\n\t\tconst on = options?.on;\n\t\tif (on) {\n\t\t\tfor (const name in on) {\n\t\t\t\tconst handler = on[name];\n\t\t\t\tif (handler) {\n\t\t\t\t\tthis.on(name, handler);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Title\n\t\tthis._title = options?.title ?? theme.getTitle();\n\n\t\t// Weight\n\t\tthis._weight = options?.weight ?? theme.getWeight();\n\n\t\t// Reflowable\n\t\tthis.initReflowable();\n\n\t\t// Shadow\n\t\tthis._onShadowUpdateBound = (): void => {\n\t\t\tDApplications.update(this);\n\t\t};\n\t\tlet shadow = options?.shadow;\n\t\tif (shadow === undefined) {\n\t\t\tshadow = theme.getShadow();\n\t\t}\n\t\tif (shadow) {\n\t\t\tif (isString(shadow)) {\n\t\t\t\tswitch (shadow) {\n\t\t\t\t\tcase \"WEAK\":\n\t\t\t\t\t\tthis.shadow = theme.newShadowWeak();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"DEFAULT\":\n\t\t\t\t\t\tthis.shadow = theme.newShadow();\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.shadow = shadow;\n\t\t\t}\n\t\t}\n\n\t\t// Event handlers\n\t\tthis.on(UtilPointerEvent.over, (e: InteractionEvent): void => {\n\t\t\tthis.onOver(e);\n\t\t});\n\n\t\tthis.on(UtilPointerEvent.out, (e: InteractionEvent): void => {\n\t\t\tthis.onOut(e);\n\t\t});\n\n\t\tthis.on(UtilPointerEvent.down, (e: InteractionEvent): void => {\n\t\t\tthis.onDown(e);\n\t\t});\n\n\t\tthis.on(UtilPointerEvent.up, (e: InteractionEvent): void => {\n\t\t\tthis.onUp(e);\n\t\t});\n\n\t\t// Children change detection\n\t\tthis.on(\"added\", (): void => {\n\t\t\tthis.toParentResized();\n\t\t\tif (this.isDirty() || this.hasDirty()) {\n\t\t\t\tthis.toParentHasDirty();\n\t\t\t}\n\t\t\tif (this._isChildrenDirty) {\n\t\t\t\tthis.toParentChildrenDirty();\n\t\t\t}\n\t\t\tconst newParent = this.parent;\n\t\t\tif (newParent instanceof DBase) {\n\t\t\t\tthis.state.parent = newParent.state;\n\t\t\t}\n\t\t\tDApplications.update(this);\n\t\t});\n\n\t\tthis.on(\"removed\", (): void => {\n\t\t\tthis.blur(true);\n\t\t\tthis.state.parent = null;\n\t\t\tDApplications.update(this);\n\t\t});\n\n\t\t// Shortcut\n\t\tconst shortcuts = toShortcuts(options);\n\t\tthis._shortcuts = shortcuts;\n\t\tif (shortcuts != null) {\n\t\t\tconst onShortcutBound = (e: KeyboardEvent): void => {\n\t\t\t\tthis.onShortcut(e);\n\t\t\t};\n\t\t\tfor (let i = 0, imax = shortcuts.length; i < imax; ++i) {\n\t\t\t\tUtilKeyboardEvent.on(this, shortcuts[i], onShortcutBound);\n\t\t\t}\n\t\t}\n\n\t\t// Other initialization\n\t\tthis.init(options);\n\n\t\t// State Override\n\t\ttheme.newState(this._state);\n\t\tconst state = options?.state;\n\t\tif (state != null) {\n\t\t\tif (isString(state)) {\n\t\t\t\tthis._state.add(state);\n\t\t\t} else {\n\t\t\t\tthis._state.addAll(state);\n\t\t\t}\n\t\t}\n\n\t\t// Parent\n\t\tconst parent = options?.parent;\n\t\tif (parent != null) {\n\t\t\tparent.addChild(this);\n\t\t}\n\n\t\t// Children\n\t\tconst children = options?.children;\n\t\tif (children != null) {\n\t\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\t\tconst child = children[i];\n\t\t\t\tif (child != null) {\n\t\t\t\t\tthis.addChild(child);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Cursor\n\t\tconst cursor = options?.cursor;\n\t\tthis._cursor = cursor;\n\t\tthis.cursor = this.toCursor(cursor, this._state);\n\n\t\t// Done\n\t\tthis.emit(\"init\", this);\n\t}\n\n\tprotected toCursor(\n\t\tcursor: DStateAwareOrValueMightBe<string> | undefined,\n\t\tstate: DBaseStateSet\n\t): string {\n\t\tif (cursor) {\n\t\t\tif (isFunction(cursor)) {\n\t\t\t\tconst result = cursor(state);\n\t\t\t\tif (result !== undefined) {\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t} else if (cursor !== undefined) {\n\t\t\t\treturn cursor;\n\t\t\t}\n\t\t}\n\t\treturn this.theme.getCursor(state);\n\t}\n\n\tget snippet(): DBaseSnippetContainer {\n\t\treturn this._snippet;\n\t}\n\n\tget reflowable(): DBaseReflowableContainer {\n\t\treturn this._reflowable;\n\t}\n\n\tprotected initReflowable(): void {\n\t\tnew DBaseReflowableImpl(this);\n\t}\n\n\tprotected onChildrenChange(): void {\n\t\tthis.toChildrenDirty();\n\t\tsuper.onChildrenChange();\n\t}\n\n\tprotected onShortcut(e: KeyboardEvent): void {\n\t\t// DO NOTHING\n\t}\n\n\tprotected init(options?: OPTIONS): void {\n\t\t// OTHER INITIALIZATIONS BEFORE `parent.addChild( this )`\n\t}\n\n\tget weight(): number {\n\t\treturn this._weight;\n\t}\n\n\tprotected onMove(newX: number, newY: number, oldX: number, oldY: number): void {\n\t\tconst children = this.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tconst child = children[i];\n\t\t\tif (child instanceof DBase) {\n\t\t\t\tchild.onParentMove(newX, newY, oldX, oldY);\n\t\t\t}\n\t\t}\n\t\tDApplications.update(this);\n\t\tthis.emit(\"move\", newX, newY, oldX, oldY, this);\n\t}\n\n\tresize(width: number, height: number): boolean {\n\t\tconst oldWidth = this._width;\n\t\tconst oldHeight = this._height;\n\t\tconst widthResized = oldWidth !== width;\n\t\tconst heightResized = oldHeight !== height;\n\n\t\tif (widthResized) {\n\t\t\tthis._width = width;\n\t\t}\n\n\t\tif (heightResized) {\n\t\t\tthis._height = height;\n\t\t}\n\n\t\tconst resized = widthResized || heightResized;\n\t\tif (resized) {\n\t\t\tthis.onResize(width, height, oldWidth, oldHeight);\n\t\t}\n\n\t\tif (widthResized) {\n\t\t\tconst scalarSet = this._scalarSet;\n\t\t\tif (scalarSet.x != null) {\n\t\t\t\tconst position = this.transform.position;\n\t\t\t\tconst parent = this.getParentOfSize();\n\t\t\t\tif (parent) {\n\t\t\t\t\tthis.x = scalarSet.x(parent.width, width, parent.padding.getLeft(), position.x);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (heightResized) {\n\t\t\tconst scalarSet = this._scalarSet;\n\t\t\tif (scalarSet.y != null) {\n\t\t\t\tconst position = this.transform.position;\n\t\t\t\tconst parent = this.getParentOfSize();\n\t\t\t\tif (parent) {\n\t\t\t\t\tthis.y = scalarSet.y(\n\t\t\t\t\t\tparent.height,\n\t\t\t\t\t\theight,\n\t\t\t\t\t\tparent.padding.getTop(),\n\t\t\t\t\t\tposition.y\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn resized;\n\t}\n\n\tgetClearType(): DLayoutClearType {\n\t\treturn this._clearType;\n\t}\n\n\tonResize(newWidth: number, newHeight: number, oldWidth: number, oldHeight: number): void {\n\t\tthis.toDirty();\n\t\tthis.toChildrenDirty();\n\n\t\tconst padding = this._padding;\n\t\tconst children = this.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tconst child = children[i];\n\t\t\tif (child instanceof DBase) {\n\t\t\t\tchild.onParentResize(newWidth, newHeight, padding);\n\t\t\t}\n\t\t}\n\n\t\tDApplications.update(this);\n\t\tthis.emit(\"resize\", newWidth, newHeight, oldWidth, oldHeight, this);\n\t}\n\n\tprotected onScale(newX: number, newY: number, oldX: number, oldY: number): void {\n\t\tDApplications.update(this);\n\t\tthis.emit(\"scale\", newX, newY, oldX, oldY, this);\n\t}\n\n\tprotected onSkew(newX: number, newY: number, oldX: number, oldY: number): void {\n\t\tDApplications.update(this);\n\t\tthis.emit(\"skew\", newX, newY, oldX, oldY, this);\n\t}\n\n\tget type(): string {\n\t\treturn this.getType();\n\t}\n\n\t// @ts-ignore\n\tget x(): number {\n\t\treturn this._position.x;\n\t}\n\n\tset x(x: number) {\n\t\tthis._position.x = x;\n\t}\n\n\tgetX(): DCoordinatePosition {\n\t\tconst scalarSet = this._scalarSet;\n\t\tif (scalarSet.x != null) {\n\t\t\treturn scalarSet.x;\n\t\t} else {\n\t\t\treturn this.x;\n\t\t}\n\t}\n\n\tsetX(x: DCoordinatePosition): void {\n\t\tif (isNumber(x)) {\n\t\t\tthis.x = x;\n\t\t} else {\n\t\t\tconst scalarSet = this._scalarSet;\n\t\t\tconst scalar = DScalarFunctions.position(x);\n\t\t\tif (scalarSet.x !== scalar) {\n\t\t\t\tscalarSet.x = scalar;\n\t\t\t\tthis.toParentResized();\n\t\t\t}\n\t\t}\n\t}\n\n\t// @ts-ignore\n\tget y(): number {\n\t\treturn this._position.y;\n\t}\n\n\tset y(y: number) {\n\t\tthis._position.y = y;\n\t}\n\n\tgetY(): DCoordinatePosition {\n\t\tconst scalarSet = this._scalarSet;\n\t\tif (scalarSet.y != null) {\n\t\t\treturn scalarSet.y;\n\t\t} else {\n\t\t\treturn this.y;\n\t\t}\n\t}\n\n\tsetY(y: DCoordinatePosition): void {\n\t\tif (isNumber(y)) {\n\t\t\tthis.y = y;\n\t\t} else {\n\t\t\tconst scalarSet = this._scalarSet;\n\t\t\tconst scalar = DScalarFunctions.position(y);\n\t\t\tif (scalarSet.y !== scalar) {\n\t\t\t\tscalarSet.y = scalar;\n\t\t\t\tthis.toParentResized();\n\t\t\t}\n\t\t}\n\t}\n\n\t// @ts-ignore\n\tget width(): number {\n\t\treturn this._width;\n\t}\n\n\tset width(width: number) {\n\t\tconst oldWidth = this._width;\n\t\tif (oldWidth !== width) {\n\t\t\tthis._width = width;\n\t\t\tconst height = this._height;\n\t\t\tthis.onResize(width, height, oldWidth, height);\n\n\t\t\t// Layout\n\t\t\tconst scalarSet = this._scalarSet;\n\t\t\tif (scalarSet.x != null) {\n\t\t\t\tconst position = this.transform.position;\n\t\t\t\tconst parent = this.getParentOfSize();\n\t\t\t\tif (parent) {\n\t\t\t\t\tthis.x = scalarSet.x(parent.width, width, parent.padding.getLeft(), position.x);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tgetWidth(): DCoordinateSize {\n\t\treturn this._auto.width.toCoordinate(this._scalarSet.width || this._width);\n\t}\n\n\tsetWidth(width: DCoordinateSize): void {\n\t\tconst auto = this._auto.width;\n\t\tconst isOn = auto.isOn;\n\t\tconst isAuto = auto.from(width);\n\t\tif (auto.isOn !== isOn) {\n\t\t\tthis.toChildrenDirty();\n\t\t\tDApplications.update(this);\n\t\t}\n\t\tif (!isAuto) {\n\t\t\tif (isNumber(width)) {\n\t\t\t\tthis.width = width;\n\t\t\t} else {\n\t\t\t\tconst scalarSet = this._scalarSet;\n\t\t\t\tconst scalar = DScalarFunctions.size(width);\n\t\t\t\tif (scalarSet.width !== scalar) {\n\t\t\t\t\tscalarSet.width = scalar;\n\t\t\t\t\tthis.toParentResized();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// @ts-ignore\n\tget height(): number {\n\t\treturn this._height;\n\t}\n\n\tset height(height: number) {\n\t\tconst oldHeight = this._height;\n\t\tif (oldHeight !== height) {\n\t\t\tthis._height = height;\n\t\t\tconst width = this._width;\n\t\t\tthis.onResize(width, height, width, oldHeight);\n\n\t\t\t// Layout\n\t\t\tconst scalarSet = this._scalarSet;\n\t\t\tif (scalarSet.y != null) {\n\t\t\t\tconst position = this.transform.position;\n\t\t\t\tconst parent = this.getParentOfSize();\n\t\t\t\tif (parent) {\n\t\t\t\t\tthis.y = scalarSet.y(\n\t\t\t\t\t\tparent.height,\n\t\t\t\t\t\theight,\n\t\t\t\t\t\tparent.padding.getTop(),\n\t\t\t\t\t\tposition.y\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tgetHeight(): DCoordinateSize {\n\t\treturn this._auto.height.toCoordinate(this._scalarSet.height || this._height);\n\t}\n\n\tsetHeight(height: DCoordinateSize): void {\n\t\tconst auto = this._auto.height;\n\t\tconst isOn = auto.isOn;\n\t\tconst isAuto = auto.from(height);\n\t\tif (auto.isOn !== isOn) {\n\t\t\tthis.toChildrenDirty();\n\t\t\tDApplications.update(this);\n\t\t}\n\t\tif (!isAuto) {\n\t\t\tif (isNumber(height)) {\n\t\t\t\tthis.height = height;\n\t\t\t} else {\n\t\t\t\tconst scalarSet = this._scalarSet;\n\t\t\t\tconst scalar = DScalarFunctions.size(height);\n\t\t\t\tif (scalarSet.height !== scalar) {\n\t\t\t\t\tscalarSet.height = scalar;\n\t\t\t\t\tthis.toParentResized();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// @ts-ignore\n\tget position(): DBasePoint {\n\t\treturn this._position;\n\t}\n\n\t// @ts-ignore\n\tget scale(): DBasePoint {\n\t\treturn this._scale;\n\t}\n\n\t// @ts-ignore\n\tget skew(): DBasePoint {\n\t\treturn this._skew;\n\t}\n\n\tget padding(): DPadding {\n\t\treturn this._padding;\n\t}\n\n\tget corner(): DCorner {\n\t\treturn this._corner;\n\t}\n\n\tget background(): DBackgroundStateAware {\n\t\treturn this._background;\n\t}\n\n\tget border(): DBorderStateAware {\n\t\treturn this._border;\n\t}\n\n\tget outline(): DOutline {\n\t\treturn this._outline;\n\t}\n\n\tget unsafe(): Transform {\n\t\treturn this.transform;\n\t}\n\n\tget title(): string {\n\t\treturn this._title;\n\t}\n\n\tset title(title: string) {\n\t\tif (this._title !== title) {\n\t\t\tthis._title = title;\n\t\t\tif (this.state.isHovered) {\n\t\t\t\tthis.applyTitle();\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected applyTitle(): void {\n\t\tconst layer = DApplications.getLayer(this);\n\t\tif (layer) {\n\t\t\tlayer.view.title = this._title;\n\t\t}\n\t}\n\n\tshow(): this {\n\t\tif (!this.visible) {\n\t\t\tthis.visible = true;\n\t\t\tthis.toParentChildrenDirty();\n\t\t\tDApplications.update(this);\n\t\t}\n\t\treturn this;\n\t}\n\n\tisShown(): boolean {\n\t\treturn this.visible;\n\t}\n\n\thide(): this {\n\t\tif (this.visible) {\n\t\t\tthis.visible = false;\n\t\t\tthis.toParentChildrenDirty();\n\t\t\tthis.blur(true);\n\t\t\tDApplications.update(this);\n\t\t}\n\t\treturn this;\n\t}\n\n\tisHidden(): boolean {\n\t\treturn !this.visible;\n\t}\n\n\ttoDirty(): boolean {\n\t\tif (!this._isDirty) {\n\t\t\tthis._isDirty = true;\n\t\t\tthis.toParentHasDirty();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\ttoHasDirty(): boolean {\n\t\tif (!this._hasDirty) {\n\t\t\tthis._hasDirty = true;\n\t\t\tthis.toParentHasDirty();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\ttoParentHasDirty(): void {\n\t\tconst parent = this.parent;\n\t\tif (parent instanceof DBase) {\n\t\t\tparent.toHasDirty();\n\t\t}\n\t}\n\n\ttoChildrenDirty(): boolean {\n\t\tif (!this._isChildrenDirty) {\n\t\t\tthis._isChildrenDirty = true;\n\t\t\tthis.onChildrenDirty();\n\t\t\tthis.toParentChildrenDirty();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\ttoParentChildrenDirty(): void {\n\t\tconst parent = this.parent;\n\t\tif (parent instanceof DBase) {\n\t\t\tparent.toChildrenDirty();\n\t\t}\n\t}\n\n\tisChildrenDirty(): boolean {\n\t\treturn this._isChildrenDirty;\n\t}\n\n\tprotected onChildrenDirty(): void {\n\t\t// DO NOTHING\n\t}\n\n\tisDirty(): boolean {\n\t\treturn this._isDirty;\n\t}\n\n\thasDirty(): boolean {\n\t\treturn this._hasDirty;\n\t}\n\n\tprotected setFocused(isFocused: boolean): this {\n\t\tif (this.state.isFocused !== isFocused) {\n\t\t\tconst layer = DApplications.getLayer(this);\n\t\t\tif (layer) {\n\t\t\t\tlayer.getFocusController().set(this, isFocused);\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n\n\tfocus(): this {\n\t\treturn this.setFocused(true);\n\t}\n\n\tblur(recursively?: boolean): this {\n\t\tif (recursively) {\n\t\t\tconst layer = DApplications.getLayer(this);\n\t\t\tif (layer) {\n\t\t\t\tconst focusController = layer.getFocusController();\n\t\t\t\tconst focused = focusController.get();\n\t\t\t\tif (focused instanceof DBase) {\n\t\t\t\t\tlet current: Container = focused;\n\t\t\t\t\twhile (current) {\n\t\t\t\t\t\tif (current === this) {\n\t\t\t\t\t\t\tfocused.setFocused(false);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcurrent = current.parent;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tthis.setFocused(false);\n\t\t}\n\t\treturn this;\n\t}\n\n\tprotected onStateChange(newState: DBaseStateSet, oldState: DBaseStateSet): void {\n\t\tthis.toDirty();\n\t\tDApplications.update(this);\n\t\tthis.emit(\"statechange\", newState, oldState, this);\n\n\t\tconst children = this.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tconst child = children[i];\n\t\t\tif (child instanceof DBase) {\n\t\t\t\tchild.state.onParentChange(newState, oldState);\n\t\t\t}\n\t\t}\n\n\t\tif (newState.isFocused) {\n\t\t\tif (!oldState.isFocused) {\n\t\t\t\tthis.onFocus();\n\t\t\t}\n\t\t} else if (oldState.isFocused) {\n\t\t\tthis.onBlur();\n\t\t}\n\n\t\tthis.cursor = this.toCursor(this._cursor, newState);\n\t}\n\n\tprotected onChildFocus(focused: DBase): void {\n\t\tconst parent = this.parent;\n\t\tif (parent instanceof DBase) {\n\t\t\tparent.onChildFocus(focused);\n\t\t}\n\t}\n\n\tprotected onFocus(): void {\n\t\tconst parent = this.parent;\n\t\tif (parent instanceof DBase) {\n\t\t\tparent.onChildFocus(this);\n\t\t}\n\t}\n\n\tprotected onChildBlur(blured: DBase): void {\n\t\tconst parent = this.parent;\n\t\tif (parent instanceof DBase) {\n\t\t\tparent.onChildBlur(blured);\n\t\t}\n\t}\n\n\tprotected onBlur(): void {\n\t\tconst parent = this.parent;\n\t\tif (parent instanceof DBase) {\n\t\t\tparent.onChildBlur(this);\n\t\t}\n\t}\n\n\tget state(): DBaseStateSet {\n\t\treturn this._state;\n\t}\n\n\tget theme(): THEME {\n\t\treturn this._theme;\n\t}\n\n\tset theme(theme: THEME) {\n\t\tconst result = this._theme;\n\t\tif (result !== theme) {\n\t\t\tthis._theme = theme;\n\t\t\tthis._padding.setTheme(theme);\n\t\t\tthis._background.setTheme(theme);\n\t\t\tthis._border.setTheme(theme);\n\t\t\tthis._outline.setTheme(theme);\n\t\t\tthis._corner.setTheme(theme);\n\t\t\tthis.toDirty();\n\t\t\tDApplications.update(this);\n\t\t}\n\t}\n\n\trefit(): void {\n\t\tif (this._isChildrenDirty) {\n\t\t\tthis._isChildrenDirty = false;\n\n\t\t\tconst children = this.children;\n\t\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\t\tconst child = children[i];\n\t\t\t\tif (child instanceof DBase) {\n\t\t\t\t\tchild.refit();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.onRefit();\n\t\t}\n\t}\n\n\tprotected onRefit(): void {\n\t\tconst auto = this._auto;\n\t\tconst isWidthAuto = auto.width.isOn;\n\t\tconst isHeightAuto = auto.height.isOn;\n\t\tif (isWidthAuto && isHeightAuto) {\n\t\t\tlet width = 0;\n\t\t\tlet height = 0;\n\t\t\tconst children = this.children;\n\t\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\t\tconst child = children[i];\n\t\t\t\tif (child.visible) {\n\t\t\t\t\tif (this.hasRefitableWidth(child)) {\n\t\t\t\t\t\twidth = Math.max(width, child.x + child.width);\n\t\t\t\t\t}\n\t\t\t\t\tif (this.hasRefitableHeight(child)) {\n\t\t\t\t\t\theight = Math.max(height, child.y + child.height);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst padding = this.padding;\n\t\t\tthis.resize(width + padding.getRight(), height + padding.getBottom());\n\t\t} else if (isWidthAuto) {\n\t\t\tlet width = 0;\n\t\t\tconst children = this.children;\n\t\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\t\tconst child = children[i];\n\t\t\t\tif (child.visible && this.hasRefitableWidth(child)) {\n\t\t\t\t\twidth = Math.max(width, child.x + child.width);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.width = width + this.padding.getRight();\n\t\t} else if (isHeightAuto) {\n\t\t\tlet height = 0;\n\t\t\tconst children = this.children;\n\t\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\t\tconst child = children[i];\n\t\t\t\tif (child.visible && this.hasRefitableHeight(child)) {\n\t\t\t\t\theight = Math.max(height, child.y + child.height);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.height = height + this.padding.getBottom();\n\t\t}\n\t}\n\n\tprotected isRefitable(target: any): target is DRefitable {\n\t\treturn target instanceof DBase;\n\t}\n\n\tprotected hasRefitableHeight(target: any): target is DRefitable {\n\t\treturn (\n\t\t\tthis.isRefitable(target) && !(target instanceof DBase && isFunction(target.getHeight()))\n\t\t);\n\t}\n\n\tprotected hasRefitableWidth(target: any): target is DBase<any, any> {\n\t\treturn (\n\t\t\tthis.isRefitable(target) && !(target instanceof DBase && isFunction(target.getWidth()))\n\t\t);\n\t}\n\n\treflow(): void {\n\t\tif (this._isDirty) {\n\t\t\tthis.onReflow();\n\t\t\tthis._isDirty = false;\n\t\t}\n\n\t\tif (this._hasDirty) {\n\t\t\tconst children = this.children;\n\t\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\t\tconst child = children[i];\n\t\t\t\tif (child instanceof DBase) {\n\t\t\t\t\tchild.reflow();\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._hasDirty = false;\n\t\t}\n\t}\n\n\tprotected onReflow(): void {\n\t\tthis._reflowable.onReflow(this, this._width, this._height);\n\t}\n\n\tget shadow(): DShadow | null {\n\t\treturn this._shadow;\n\t}\n\n\tset shadow(shadow: DShadow | null) {\n\t\tconst previous = this._shadow;\n\t\tif (previous !== shadow) {\n\t\t\tconst reflowable = this._reflowable;\n\t\t\tconst snippet = this._snippet;\n\t\t\tconst onShadowUpdateBound = this._onShadowUpdateBound;\n\t\t\tif (previous != null) {\n\t\t\t\tprevious.off(\"update\", onShadowUpdateBound);\n\t\t\t\treflowable.remove(previous);\n\t\t\t\tsnippet.remove(previous, true);\n\t\t\t}\n\n\t\t\tthis._shadow = shadow;\n\t\t\tif (shadow != null) {\n\t\t\t\tshadow.on(\"update\", onShadowUpdateBound);\n\t\t\t\treflowable.add(shadow);\n\t\t\t\tsnippet.addAt(shadow, true, 0);\n\t\t\t}\n\n\t\t\tDApplications.update(this);\n\t\t}\n\t}\n\n\tprotected toParentResized(): void {\n\t\tconst parent = this.getParentOfSize();\n\t\tif (parent) {\n\t\t\tthis.onParentResize(parent.width, parent.height, parent.padding);\n\t\t}\n\t}\n\n\tprotected getParentOfSize(): { width: number; height: number; padding: DPadding } | null {\n\t\tconst parent = this.parent;\n\t\tif (parent instanceof DBase) {\n\t\t\treturn parent;\n\t\t} else {\n\t\t\treturn DApplications.getLayer(this);\n\t\t}\n\t}\n\n\t/**\n\t * Called when a parent resized.\n\t *\n\t * @param parentWidth a parent's local width\n\t * @param parentHeight a parent's local height\n\t */\n\tonParentResize(parentWidth: number, parentHeight: number, parentPadding: DPadding): void {\n\t\tconst scalarSet = this._scalarSet;\n\t\tconst position = this.transform.position;\n\t\tconst x = position.x;\n\t\tconst y = position.y;\n\t\tconst width = this._width;\n\t\tconst height = this._height;\n\n\t\t// Width & height\n\t\tconst paddingWidth = parentPadding.getLeft() + parentPadding.getRight();\n\t\tconst paddingHeight = parentPadding.getTop() + parentPadding.getBottom();\n\t\tconst newWidth =\n\t\t\tscalarSet.width != null\n\t\t\t\t? scalarSet.width(parentWidth, width, paddingWidth, width)\n\t\t\t\t: width;\n\t\tconst newHeight =\n\t\t\tscalarSet.height != null\n\t\t\t\t? scalarSet.height(parentHeight, height, paddingHeight, height)\n\t\t\t\t: height;\n\t\tthis.resize(newWidth, newHeight);\n\n\t\t// X & Y\n\t\tconst newX =\n\t\t\tscalarSet.x != null\n\t\t\t\t? scalarSet.x(parentWidth, this._width, parentPadding.getLeft(), x)\n\t\t\t\t: x;\n\t\tconst newY =\n\t\t\tscalarSet.y != null\n\t\t\t\t? scalarSet.y(parentHeight, this._height, parentPadding.getTop(), y)\n\t\t\t\t: y;\n\t\tthis.position.set(newX, newY);\n\t}\n\n\t/**\n\t * Called when a parent moved.\n\t *\n\t * @param newX a new parent's local x position\n\t * @param newY a new parent's local y position\n\t * @param oldX an old parent's local x position\n\t * @param oldY an old parent's local y position\n\t */\n\tprotected onParentMove(newX: number, newY: number, oldX: number, oldY: number): void {\n\t\t// DO NOTHING\n\t}\n\n\t// Wheel\n\tonWheel(e: WheelEvent, deltas: UtilWheelEventDeltas, global: Point): boolean {\n\t\tthis.emit(\"wheel\", e, deltas, global, this);\n\t\treturn false;\n\t}\n\n\t// Keydown\n\tonKeyDown(e: KeyboardEvent): boolean {\n\t\tthis.emit(\"keydown\", e, this);\n\t\treturn false;\n\t}\n\n\tonKeyUp(e: KeyboardEvent): boolean {\n\t\tthis.emit(\"keyup\", e, this);\n\t\treturn false;\n\t}\n\n\t// Down\n\tprotected isEventTarget(e: InteractionEvent): boolean {\n\t\tconst target = e.target;\n\t\tif (target === this) {\n\t\t\treturn true;\n\t\t} else if (target != null && !(target instanceof DBase)) {\n\t\t\tlet parent = target.parent;\n\t\t\twhile (parent != null && !(parent instanceof DBase)) {\n\t\t\t\tparent = parent.parent;\n\t\t\t}\n\t\t\treturn parent === this;\n\t\t}\n\t\treturn false;\n\t}\n\n\tprotected onDown(e: InteractionEvent): void {\n\t\tif (this.isEventTarget(e)) {\n\t\t\tthis.onDownThis(e);\n\t\t}\n\t\tthis.emit(\"down\", e, this);\n\t}\n\n\tprotected onDownThis(e: InteractionEvent): void {\n\t\tconst oe = e.data.originalEvent;\n\t\tif (\"touches\" in oe) {\n\t\t\tconst lastDownPoint = this._lastDownPoint || new Point();\n\t\t\tthis._lastDownPoint = lastDownPoint;\n\t\t\tlastDownPoint.copyFrom(e.data.global);\n\t\t} else {\n\t\t\tthis.focusOnClosest();\n\t\t}\n\t}\n\n\tprotected onUp(e: InteractionEvent): void {\n\t\tif (this.isEventTarget(e)) {\n\t\t\tthis.onUpThis(e);\n\t\t}\n\t\tthis.emit(\"up\", e, this);\n\t}\n\n\tprotected onUpThis(e: InteractionEvent): void {\n\t\tconst oe = e.data.originalEvent;\n\t\tif (\"touches\" in oe) {\n\t\t\tconst lastDownPoint = this._lastDownPoint;\n\t\t\tif (lastDownPoint) {\n\t\t\t\tconst global = e.data.global;\n\t\t\t\tconst dx = Math.abs(global.x - lastDownPoint.x);\n\t\t\t\tconst dy = Math.abs(global.y - lastDownPoint.y);\n\t\t\t\tconst threshold = UtilPointerEvent.CLICK_DISTANCE_THRESHOLD;\n\t\t\t\tif (dx < threshold && dy < threshold) {\n\t\t\t\t\tthis.focusOnClosest();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected focusOnClosest(): void {\n\t\tconst layer = DApplications.getLayer(this);\n\t\tif (layer) {\n\t\t\tconst focusController = layer.getFocusController();\n\t\t\tfocusController.focus(focusController.findParent(this));\n\t\t}\n\t}\n\n\t// Over\n\tprotected onOver(e: InteractionEvent): void {\n\t\t// Update the hover state\n\t\tthis.state.isHovered = true;\n\n\t\t// Update the title\n\t\tif (e.target === this) {\n\t\t\tthis.applyTitle();\n\t\t}\n\n\t\t// Event\n\t\tthis.emit(\"over\", e, this);\n\t}\n\n\t// Out\n\tprotected onOut(e: InteractionEvent): void {\n\t\t// Update the hover state\n\t\tthis.state.isHovered = false;\n\n\t\t// Event\n\t\tthis.emit(\"out\", e, this);\n\t}\n\n\t// Double click\n\tonDblClick(e: MouseEvent | TouchEvent, interactionManager: InteractionManager): boolean {\n\t\tthis.emit(\"dblclick\", e, interactionManager, this);\n\t\treturn false;\n\t}\n\n\t//\n\trender(renderer: Renderer): void {\n\t\tif (this.visible && 0 < this.worldAlpha && this.renderable) {\n\t\t\tconst snippet = this._snippet;\n\t\t\tsnippet.render(renderer, true);\n\t\t\tsuper.render(renderer);\n\t\t\tsnippet.render(renderer, false);\n\t\t}\n\t}\n\n\t//\n\tprotected getThemeDefault(): THEME {\n\t\treturn DThemes.getInstance().get(this.getType());\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DBase\";\n\t}\n\n\t//\n\tprotected _calculateBounds(): void {\n\t\tconst worldTransform = this.transform.worldTransform;\n\t\tconst bounds = this._bounds;\n\n\t\tconst work = DBase.WORK_CONTAINS_POINT;\n\t\twork.set(0, 0);\n\t\tworldTransform.apply(work, work);\n\t\tbounds.addPoint(work);\n\n\t\twork.set(this._width, this._height);\n\t\tworldTransform.apply(work, work);\n\t\tbounds.addPoint(work);\n\n\t\tsuper._calculateBounds();\n\t}\n\n\tcontainsPoint(point: Point): boolean {\n\t\treturn (\n\t\t\tthis.containsGlobalPoint(point) ||\n\t\t\tthis.containsLocalPoint(\n\t\t\t\tthis.worldTransform.applyInverse(point, DBase.WORK_CONTAINS_POINT)\n\t\t\t)\n\t\t);\n\t}\n\n\tprotected containsGlobalPoint(point: Point): boolean {\n\t\treturn false;\n\t}\n\n\tprotected containsLocalPoint(point: Point): boolean {\n\t\tconst x = point.x;\n\t\tconst y = point.y;\n\t\tconst w = this._width;\n\t\tconst h = this._height;\n\t\treturn 0 <= x && x <= w && 0 <= y && y <= h;\n\t}\n\n\t/**\n\t * Returns a clipping rect.\n\t *\n\t * @param result a clipping rect\n\t */\n\tgetClippingRect(target: unknown, result: Rectangle): void {\n\t\tresult.x = 0;\n\t\tresult.y = 0;\n\t\tresult.width = this._width;\n\t\tresult.height = this._height;\n\t}\n\n\tdestroy(): void {\n\t\t// Layout\n\t\tconst scalarSet = this._scalarSet;\n\t\tscalarSet.x = null;\n\t\tscalarSet.y = null;\n\t\tscalarSet.width = null;\n\t\tscalarSet.height = null;\n\n\t\t// Shadow\n\t\tconst shadow = this._shadow;\n\t\tif (shadow) {\n\t\t\tthis._shadow = null;\n\t\t\tshadow.destroy();\n\t\t}\n\n\t\t// Children\n\t\tconst children = this.children;\n\t\tfor (let i = children.length - 1; 0 <= i; --i) {\n\t\t\tchildren[i].destroy();\n\t\t}\n\t\tchildren.length = 0;\n\n\t\t//\n\t\tsuper.destroy();\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Graphics, Renderer } from \"pixi.js\";\nimport { DBase } from \"./d-base\";\nimport { DBaseReflowable } from \"./d-base-reflowable\";\nimport { DCornerMask } from \"./d-corner-mask\";\n\nexport class DBaseOverflowMask extends Graphics implements DBaseReflowable {\n\tconstructor(parent: DBase) {\n\t\tsuper();\n\t\t(this as any).parent = parent;\n\t}\n\n\trender(renderer: Renderer): void {\n\t\tthis.updateTransform();\n\t\tsuper.render(renderer);\n\t}\n\n\tonReflow(base: DBase, width: number, height: number): void {\n\t\tconst x = 0;\n\t\tconst y = 0;\n\t\tconst corner = base.corner;\n\t\tconst cornerRadius = Math.max(0, corner.getRadius() - 0.5);\n\t\tconst cornerMask = corner.getMask();\n\t\tconst tl = cornerMask & DCornerMask.TOP_LEFT ? 0 : cornerRadius;\n\t\tconst tr = cornerMask & DCornerMask.TOP_RIGHT ? 0 : cornerRadius;\n\t\tconst bl = cornerMask & DCornerMask.BOTTOM_LEFT ? 0 : cornerRadius;\n\t\tconst br = cornerMask & DCornerMask.BOTTOM_RIGHT ? 0 : cornerRadius;\n\t\tthis.clear();\n\t\tthis.beginFill(0xffffff, 1);\n\t\tthis.lineStyle(0, 0, 0, 0, false);\n\t\tif (tl <= 0 && tr <= 0 && bl <= 0 && br <= 0) {\n\t\t\tthis.drawRect(x, y, width, height);\n\t\t} else {\n\t\t\tthis.moveTo(x + tl, y);\n\t\t\tif (0 < tr) {\n\t\t\t\tthis.arcTo(x + width, y, x + width, y + height, tr);\n\t\t\t} else {\n\t\t\t\tthis.lineTo(x + width, y);\n\t\t\t}\n\t\t\tif (0 < br) {\n\t\t\t\tthis.arcTo(x + width, y + height, x, y + height, br);\n\t\t\t} else {\n\t\t\t\tthis.lineTo(x + width, y + height);\n\t\t\t}\n\t\t\tif (0 < bl) {\n\t\t\t\tthis.arcTo(x, y + height, x, y, bl);\n\t\t\t} else {\n\t\t\t\tthis.lineTo(x, y + height);\n\t\t\t}\n\t\t\tif (0 < tl) {\n\t\t\t\tthis.arcTo(x, y, x + width, y, tl);\n\t\t\t} else {\n\t\t\t\tthis.lineTo(x, y);\n\t\t\t}\n\t\t}\n\t\tthis.endFill();\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nconst CTRL = 1;\nconst SHIFT = 2;\nconst ALT = 4;\n\nconst AND = 8;\nconst OR = 16;\n\nexport const UtilGestureModifier = {\n\tNONE: 0,\n\tCTRL,\n\tSHIFT,\n\tALT,\n\n\tAND,\n\tOR,\n\n\tNOT_NONE: CTRL | SHIFT | ALT | OR\n} as const;\n\nexport type UtilGestureModifier = number;\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction } from \"pixi.js\";\nimport { UtilGestureModifier } from \"./util-gesture-modifier\";\n\nexport type UtilGestureModifierEvent =\n\t| WheelEvent\n\t| MouseEvent\n\t| TouchEvent\n\t| interaction.InteractionEvent;\n\nexport class UtilGestureModifiers {\n\tstatic from(e: UtilGestureModifierEvent): UtilGestureModifier {\n\t\tconst oe = \"data\" in e ? e.data.originalEvent : e;\n\t\treturn (\n\t\t\t(oe.ctrlKey ? UtilGestureModifier.CTRL : UtilGestureModifier.NONE) |\n\t\t\t(oe.altKey ? UtilGestureModifier.ALT : UtilGestureModifier.NONE) |\n\t\t\t(oe.shiftKey ? UtilGestureModifier.SHIFT : UtilGestureModifier.NONE)\n\t\t);\n\t}\n\n\tstatic match(e: UtilGestureModifierEvent, modifier: UtilGestureModifier): boolean {\n\t\tif (modifier & UtilGestureModifier.OR) {\n\t\t\treturn !!(UtilGestureModifiers.from(e) & modifier);\n\t\t} else {\n\t\t\treturn UtilGestureModifiers.from(e) === modifier;\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const UtilGestureMode = {\n\tOFF: 0,\n\tON: 1,\n\tTOUCH: 2\n} as const;\n\nexport type UtilGestureMode = typeof UtilGestureMode[keyof typeof UtilGestureMode];\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction, Point } from \"pixi.js\";\nimport { UtilGestureEasing } from \"./util-gesture-easing\";\nimport { UtilPointerEvent } from \"./util-pointer-event\";\nimport InteractionEvent = interaction.InteractionEvent;\nimport InteractionManager = interaction.InteractionManager;\n\nexport class UtilGestureData<TARGET> {\n\ttarget?: TARGET;\n\tpointers: Map<number, PointerEvent>;\n\tinteractionManager?: InteractionManager;\n\tcenter: Point;\n\tscale: number;\n\ttime: number;\n\tonMove?: (e: InteractionEvent) => void;\n\tonEnd?: (e: InteractionEvent) => void;\n\teasing?: UtilGestureEasing;\n\n\tconstructor() {\n\t\tthis.pointers = new Map<number, PointerEvent>();\n\t\tthis.center = new Point();\n\t\tthis.scale = 0;\n\t\tthis.time = 0;\n\t}\n\n\tstart(e: InteractionEvent): void {\n\t\tconst oe = e.data.originalEvent;\n\t\tif (\"pointerId\" in oe) {\n\t\t\tthis.pointers.set(oe.pointerId, oe);\n\t\t}\n\t\tthis.doUpdate(e);\n\t}\n\n\tisUpdatable(e: InteractionEvent): boolean {\n\t\tconst oe = e.data.originalEvent;\n\t\tif (\"pointerId\" in oe) {\n\t\t\treturn this.pointers.has(oe.pointerId);\n\t\t}\n\t\treturn true;\n\t}\n\n\tupdate(e: InteractionEvent): void {\n\t\tconst oe = e.data.originalEvent;\n\t\tif (\"pointerId\" in oe) {\n\t\t\tthis.pointers.set(oe.pointerId, oe);\n\t\t}\n\t\tthis.doUpdate(e);\n\t}\n\n\tend(e: InteractionEvent): boolean {\n\t\tlet result = true;\n\t\tconst oe = e.data.originalEvent;\n\t\tif (\"touches\" in oe) {\n\t\t\tresult = oe.touches.length <= 0;\n\t\t} else if (\"pointerId\" in oe) {\n\t\t\tconst pointers = this.pointers;\n\t\t\tpointers.delete(oe.pointerId);\n\t\t\tresult = pointers.size <= 0;\n\t\t}\n\t\tthis.doUpdate(e);\n\t\treturn result;\n\t}\n\n\tbind(e: InteractionEvent): void {\n\t\tconst interactionManager = this.interactionManager;\n\t\tif (interactionManager) {\n\t\t\tconst onMove = this.onMove;\n\t\t\tif (onMove) {\n\t\t\t\tinteractionManager.on(UtilPointerEvent.move, onMove);\n\t\t\t}\n\t\t\tconst onEnd = this.onEnd;\n\t\t\tif (onEnd) {\n\t\t\t\tinteractionManager.on(UtilPointerEvent.up, onEnd);\n\t\t\t\tinteractionManager.on(UtilPointerEvent.upoutside, onEnd);\n\t\t\t\tinteractionManager.on(UtilPointerEvent.cancel, onEnd);\n\t\t\t}\n\t\t}\n\t}\n\n\tunbind(): void {\n\t\tconst interactionManager = this.interactionManager;\n\t\tif (interactionManager) {\n\t\t\tconst onMove = this.onMove;\n\t\t\tif (onMove) {\n\t\t\t\tinteractionManager.off(UtilPointerEvent.move, onMove);\n\t\t\t}\n\t\t\tconst onEnd = this.onEnd;\n\t\t\tif (onEnd) {\n\t\t\t\tinteractionManager.off(UtilPointerEvent.up, onEnd);\n\t\t\t\tinteractionManager.off(UtilPointerEvent.upoutside, onEnd);\n\t\t\t\tinteractionManager.off(UtilPointerEvent.cancel, onEnd);\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected doUpdate(e: InteractionEvent): void {\n\t\tconst interactionManager = this.interactionManager;\n\t\tconst center = this.center;\n\t\tconst oe = e.data.originalEvent;\n\t\tthis.scale = 0;\n\t\tthis.time = oe.timeStamp;\n\t\tif (\"touches\" in oe) {\n\t\t\tconst touches = oe.touches;\n\t\t\tconst touchesLength = touches.length;\n\t\t\tif (0 < touchesLength) {\n\t\t\t\t// Update the center\n\t\t\t\tlet centerX = 0;\n\t\t\t\tlet centerY = 0;\n\t\t\t\tfor (let i = 0, imax = touches.length; i < imax; ++i) {\n\t\t\t\t\tconst touch = touches[i];\n\t\t\t\t\tcenterX += touch.clientX;\n\t\t\t\t\tcenterY += touch.clientY;\n\t\t\t\t}\n\t\t\t\tcenterX /= touchesLength;\n\t\t\t\tcenterY /= touchesLength;\n\t\t\t\tif (interactionManager) {\n\t\t\t\t\tinteractionManager.mapPositionToPoint(center, centerX, centerY);\n\t\t\t\t} else {\n\t\t\t\t\tcenter.set(centerX, centerY);\n\t\t\t\t}\n\n\t\t\t\tif (1 < touchesLength) {\n\t\t\t\t\t// Calculate the maximum distance from the center\n\t\t\t\t\tlet squareDistance = 0;\n\t\t\t\t\tfor (let i = 1, imax = touches.length; i < imax; ++i) {\n\t\t\t\t\t\tconst touch = touches[i];\n\t\t\t\t\t\tconst dx = touch.clientX - centerX;\n\t\t\t\t\t\tconst dy = touch.clientY - centerY;\n\t\t\t\t\t\tsquareDistance = Math.max(squareDistance, dx * dx + dy * dy);\n\t\t\t\t\t}\n\t\t\t\t\tthis.scale = Math.sqrt(squareDistance);\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (\"pointerId\" in oe) {\n\t\t\tconst pointers = this.pointers;\n\t\t\tconst pointersSize = pointers.size;\n\t\t\tif (0 < pointersSize) {\n\t\t\t\t// Update the center\n\t\t\t\tlet centerX = 0;\n\t\t\t\tlet centerY = 0;\n\t\t\t\tpointers.forEach((pointer): void => {\n\t\t\t\t\tcenterX += pointer.clientX;\n\t\t\t\t\tcenterY += pointer.clientY;\n\t\t\t\t});\n\t\t\t\tcenterX /= pointersSize;\n\t\t\t\tcenterY /= pointersSize;\n\t\t\t\tif (interactionManager) {\n\t\t\t\t\tinteractionManager.mapPositionToPoint(center, centerX, centerY);\n\t\t\t\t} else {\n\t\t\t\t\tcenter.set(centerX, centerY);\n\t\t\t\t}\n\n\t\t\t\tif (1 < pointersSize) {\n\t\t\t\t\t// Calculate the maximum distance from the center\n\t\t\t\t\tlet squareDistance = 0;\n\t\t\t\t\tpointers.forEach((pointer): void => {\n\t\t\t\t\t\tconst dx = pointer.clientX - centerX;\n\t\t\t\t\t\tconst dy = pointer.clientY - centerY;\n\t\t\t\t\t\tsquareDistance = Math.max(squareDistance, dx * dx + dy * dy);\n\t\t\t\t\t});\n\t\t\t\t\tthis.scale = Math.sqrt(squareDistance);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tcenter.copyFrom(e.data.global);\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport class DAnimationTimings {\n\tstatic LINEAR(t: number): number {\n\t\treturn t;\n\t}\n\n\tstatic ELASTIC(t: number): number {\n\t\treturn t * (3 * (1 - t) * (1 - t) + t * (3 * (1 - t) + t));\n\t}\n\n\tstatic QUAD_IN_OUT(t: number): number {\n\t\treturn t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { utils } from \"pixi.js\";\nimport {\n\tDAnimation,\n\tDAnimationOnEnd,\n\tDAnimationOnTime,\n\tDAnimationOptions,\n\tDAnimationTiming\n} from \"./d-animation\";\nimport { DAnimationTimings } from \"./d-animation-timings\";\n\nexport class DAnimationBase<TARGET = unknown>\n\textends utils.EventEmitter\n\timplements DAnimation<TARGET>\n{\n\tprotected _id: number | null;\n\tprotected _startTime: number;\n\tprotected _duration: number;\n\tprotected _durationInverse: number;\n\tprotected _reverse: boolean;\n\tprotected _onTime: DAnimationOnTime<TARGET> | undefined;\n\tprotected _onTimeBaseBound: () => void;\n\tprotected _onStart: DAnimationOnEnd<TARGET> | undefined;\n\tprotected _onEnd: DAnimationOnEnd<TARGET> | undefined;\n\tprotected _timing: DAnimationTiming<TARGET>;\n\tprotected _target: TARGET | null;\n\n\tconstructor(options?: DAnimationOptions<TARGET>) {\n\t\tsuper();\n\n\t\tthis._id = null;\n\t\tthis._target = options?.target ?? null;\n\t\tthis._startTime = 0;\n\t\tthis._duration = options?.duration ?? 200;\n\t\tthis._durationInverse = 1 / Math.max(1, this._duration);\n\t\tthis._reverse = false;\n\t\tthis._onTime = options?.onTime;\n\t\tthis._onTimeBaseBound = () => {\n\t\t\tthis.onTimeBase();\n\t\t};\n\t\tthis._onStart = options?.onStart;\n\t\tthis._onEnd = options?.onEnd;\n\t\tthis._timing = options?.timing ?? DAnimationTimings.ELASTIC;\n\n\t\t// Events\n\t\tconst on = options?.on;\n\t\tif (on) {\n\t\t\tfor (const name in on) {\n\t\t\t\tconst handler = on[name];\n\t\t\t\tif (handler) {\n\t\t\t\t\tthis.on(name, handler);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tget target(): TARGET | null {\n\t\treturn this._target;\n\t}\n\n\tset target(target: TARGET | null) {\n\t\tthis._target = target;\n\t}\n\n\tget duration(): number {\n\t\treturn this._duration;\n\t}\n\n\tset duration(duration: number) {\n\t\tthis._duration = duration;\n\t\tthis._durationInverse = 1 / Math.max(1, duration);\n\t}\n\n\tstart(reverse: boolean = false): void {\n\t\tthis.stop();\n\t\tthis._startTime = Date.now();\n\t\tthis._reverse = reverse;\n\t\tthis._id = window.setTimeout(this._onTimeBaseBound, 0);\n\n\t\t// onStart\n\t\tthis.onStart(reverse);\n\n\t\t// onTime\n\t\tconst duration = this._duration;\n\t\tconst time = this.toTime(reverse ? duration : 0);\n\t\tthis.onTime(time, reverse, 0);\n\t}\n\n\tprotected onStart(isReverse: boolean): void {\n\t\tconst onStart = this._onStart;\n\t\tif (onStart != null) {\n\t\t\tonStart(isReverse, this);\n\t\t}\n\t\tthis.emit(\"start\", isReverse, this);\n\t}\n\n\tprotected onTime(time: number, isReverse: boolean, elapsedTime: number): void {\n\t\tconst onTime = this._onTime;\n\t\tif (onTime != null) {\n\t\t\tonTime(time, isReverse, elapsedTime, this);\n\t\t}\n\t\tthis.emit(\"time\", time, isReverse, elapsedTime, this);\n\t}\n\n\tprotected onEnd(isReverse: boolean): void {\n\t\tconst onEnd = this._onEnd;\n\t\tif (onEnd != null) {\n\t\t\tonEnd(isReverse, this);\n\t\t}\n\t\tthis.emit(\"end\", isReverse, this);\n\t}\n\n\tisStarted(): boolean {\n\t\treturn this._id != null;\n\t}\n\n\tisReverse(): boolean {\n\t\treturn this._reverse;\n\t}\n\n\tprotected onTimeBase(): void {\n\t\tconst id = this._id;\n\t\tif (id != null) {\n\t\t\tthis._id = null;\n\t\t\tconst elapsedTime = Date.now() - this._startTime;\n\t\t\tconst duration = this._duration;\n\t\t\tconst reverse = this._reverse;\n\t\t\tif (elapsedTime < duration) {\n\t\t\t\tthis._id = window.setTimeout(this._onTimeBaseBound, 0);\n\n\t\t\t\t// OnTime\n\t\t\t\tconst time = this.toTime(reverse ? duration - elapsedTime : elapsedTime);\n\t\t\t\tthis.onTime(time, reverse, elapsedTime);\n\t\t\t} else {\n\t\t\t\t// OnTime\n\t\t\t\tconst time = this.toTime(reverse ? 0 : duration);\n\t\t\t\tthis.onTime(time, reverse, elapsedTime);\n\n\t\t\t\t// OnEnd\n\t\t\t\tthis.onEnd(reverse);\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected toTime(elapsedTime: number): number {\n\t\treturn this._timing(elapsedTime * this._durationInverse, this);\n\t}\n\n\tstop(): void {\n\t\tconst id = this._id;\n\t\tif (id != null) {\n\t\t\tthis._id = null;\n\t\t\twindow.clearTimeout(id);\n\t\t}\n\t}\n\n\tend(): void {\n\t\tconst id = this._id;\n\t\tif (id != null) {\n\t\t\tthis._id = null;\n\t\t\twindow.clearTimeout(id);\n\n\t\t\t// OnTime\n\t\t\tconst reverse = this._reverse;\n\t\t\tconst elapsedTime = Date.now() - this._startTime;\n\t\t\tconst duration = this._duration;\n\t\t\tconst time = this.toTime(reverse ? 0 : duration);\n\t\t\tthis.onTime(time, reverse, elapsedTime);\n\n\t\t\t// OnEnd\n\t\t\tthis.onEnd(reverse);\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport class UtilGestureEasingHistory {\n\tdx: number;\n\tdy: number;\n\tds: number;\n\tdt: number;\n\n\tconstructor(dx: number, dy: number, ds: number, dt: number) {\n\t\tthis.dx = dx;\n\t\tthis.dy = dy;\n\t\tthis.ds = ds;\n\t\tthis.dt = dt;\n\t}\n\n\tset(dx: number, dy: number, ds: number, dt: number): void {\n\t\tthis.dx = dx;\n\t\tthis.dy = dy;\n\t\tthis.ds = ds;\n\t\tthis.dt = dt;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DAnimation } from \"../d-animation\";\nimport { DAnimationBase } from \"../d-animation-base\";\nimport { DAnimationTimings } from \"../d-animation-timings\";\nimport { UtilGestureEasingHistory } from \"./util-gesture-easing-history\";\n\nexport type UtilGestureEasingOnMove = (dx: number, dy: number, ds: number, time: number) => void;\nexport type UtilGestureEasingOnEnd = () => void;\n\nexport interface UtilGestureEasingOptions {\n\tduration?: number;\n}\n\nexport class UtilGestureEasing {\n\tprotected static HISTORY_CAPACITY = 5;\n\tprotected _histories: UtilGestureEasingHistory[];\n\tprotected _historiesSorted: UtilGestureEasingHistory[];\n\tprotected _historyBegin: number;\n\tprotected _historyEnd: number;\n\tprotected _animation: DAnimation;\n\tprotected _dx: number;\n\tprotected _dy: number;\n\tprotected _ds: number;\n\tprotected _dt: number;\n\tprotected _dtw: number;\n\tprotected _t: number;\n\tprotected _onMove: UtilGestureEasingOnMove;\n\tprotected _onEnd: UtilGestureEasingOnEnd;\n\n\tconstructor(\n\t\tonMove: UtilGestureEasingOnMove,\n\t\tonEnd: UtilGestureEasingOnEnd,\n\t\toptions?: UtilGestureEasingOptions\n\t) {\n\t\tthis._histories = [];\n\t\tthis._historiesSorted = [];\n\t\tthis._historyBegin = 0;\n\t\tthis._historyEnd = -1;\n\t\tthis._dx = 0;\n\t\tthis._dy = 0;\n\t\tthis._ds = 0;\n\t\tthis._dt = 0;\n\t\tthis._dtw = 0;\n\t\tthis._t = 0;\n\t\tthis._animation = new DAnimationBase({\n\t\t\tonTime: (t: number): void => {\n\t\t\t\tthis.onEase(t);\n\t\t\t},\n\t\t\tonEnd: (): void => {\n\t\t\t\tthis.onEaseEnd();\n\t\t\t},\n\t\t\ttiming: DAnimationTimings.LINEAR,\n\t\t\tduration: 333 * (options?.duration ?? 1)\n\t\t});\n\t\tthis._onMove = onMove;\n\t\tthis._onEnd = onEnd;\n\t}\n\n\tonStart(): void {\n\t\t// History\n\t\tconst histories = this._histories;\n\t\tfor (let i = histories.length, imax = UtilGestureEasing.HISTORY_CAPACITY; i < imax; ++i) {\n\t\t\thistories.push(new UtilGestureEasingHistory(0, 0, 1, 0));\n\t\t}\n\t\tthis._historyBegin = 0;\n\t\tthis._historyEnd = -1;\n\n\t\t// Stop animation\n\t\tthis._animation.stop();\n\t}\n\n\tonMove(dx: number, dy: number, ds: number, dt: number): void {\n\t\tconst capacity = UtilGestureEasing.HISTORY_CAPACITY;\n\n\t\tconst oldHistoryEnd = this._historyEnd;\n\t\tconst newHistoryEnd = (oldHistoryEnd + 1) % capacity;\n\t\tthis._historyEnd = newHistoryEnd;\n\n\t\tconst oldHistoryBegin = this._historyBegin;\n\t\tif (\n\t\t\tnewHistoryEnd < oldHistoryEnd ||\n\t\t\t(0 <= oldHistoryEnd && oldHistoryEnd < oldHistoryBegin)\n\t\t) {\n\t\t\tthis._historyBegin = (oldHistoryBegin + 1) % capacity;\n\t\t}\n\n\t\tthis._histories[newHistoryEnd].set(dx, dy, ds, dt);\n\t}\n\n\tprotected updateHistoriesSorted(dt: number): number {\n\t\tconst unsorted = this._histories;\n\t\tconst sorted = this._historiesSorted;\n\t\tconst begin = this._historyBegin;\n\t\tconst end = this._historyEnd;\n\t\tconst length = unsorted.length;\n\t\tconst threshold = 160;\n\t\tif (end < 0) {\n\t\t\tsorted.length = 0;\n\t\t\treturn dt;\n\t\t} else if (end < begin) {\n\t\t\tlet total = dt;\n\t\t\tsorted.length = 0;\n\t\t\tfor (let i = end; 0 <= i; --i) {\n\t\t\t\tconst history = unsorted[i];\n\t\t\t\tif (total + history.dt < threshold) {\n\t\t\t\t\ttotal += history.dt;\n\t\t\t\t\tsorted.push(history);\n\t\t\t\t} else {\n\t\t\t\t\treturn total;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (let i = length - 1; begin <= i; --i) {\n\t\t\t\tconst history = unsorted[i];\n\t\t\t\tif (total + history.dt < threshold) {\n\t\t\t\t\ttotal += history.dt;\n\t\t\t\t\tsorted.push(history);\n\t\t\t\t} else {\n\t\t\t\t\treturn total;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn total;\n\t\t} else {\n\t\t\tlet total = dt;\n\t\t\tsorted.length = 0;\n\t\t\tfor (let i = end; begin <= i; --i) {\n\t\t\t\tconst history = unsorted[i];\n\t\t\t\tif (total + history.dt < threshold) {\n\t\t\t\t\ttotal += history.dt;\n\t\t\t\t\tsorted.push(history);\n\t\t\t\t} else {\n\t\t\t\t\treturn total;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn total;\n\t\t}\n\t}\n\n\tonEnd(ldt: number): void {\n\t\tthis.updateHistoriesSorted(ldt);\n\t\tconst sorted = this._historiesSorted;\n\t\tconst sortedLength = sorted.length;\n\t\tif (sortedLength <= 0) {\n\t\t\treturn this.onEaseEnd();\n\t\t}\n\n\t\tlet dx = 0;\n\t\tlet dy = 0;\n\t\tlet ds = 0;\n\t\tlet dt = 0;\n\t\tfor (let i = 0; i < sortedLength; ++i) {\n\t\t\tconst history = sorted[i];\n\t\t\tdx += history.dx;\n\t\t\tdy += history.dy;\n\t\t\tds += history.ds;\n\t\t\tdt += history.dt;\n\t\t}\n\t\tif (dt <= 0) {\n\t\t\treturn this.onEaseEnd();\n\t\t}\n\n\t\tconst w = 1 / sortedLength;\n\t\tdx *= w;\n\t\tdy *= w;\n\t\tds *= w;\n\t\tdt *= w;\n\t\tthis._dx = dx;\n\t\tthis._dy = dy;\n\t\tthis._ds = ds;\n\t\tthis._dt = dt;\n\n\t\t// Start animation\n\t\tconst animation = this._animation;\n\t\tconst d = animation.duration;\n\t\tthis._t = -ldt / d;\n\t\tthis._dtw = d / dt;\n\t\tanimation.start();\n\t}\n\n\tprotected onEase(t: number): void {\n\t\tconst ot = this._t;\n\t\tthis._t = t;\n\t\t// Note: Integral of (1-x) is x (1 - 0.5 x) + c.\n\t\tconst w = (1 - 0.5 * (t + ot)) * (t - ot) * this._dtw;\n\t\tthis._onMove(this._dx * w, this._dy * w, 1 + (this._ds - 1) * w, t);\n\t}\n\n\tprotected onEaseEnd(): void {\n\t\tthis._onEnd();\n\t}\n\n\tstop(): void {\n\t\tthis._animation.stop();\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction, utils } from \"pixi.js\";\nimport { DApplicationTarget } from \"../d-application-like\";\nimport { DApplications } from \"../d-applications\";\nimport { DBaseStateSet } from \"../d-base-state-set\";\nimport { UtilGestureModifier } from \"./util-gesture-modifier\";\nimport { UtilGestureModifiers } from \"./util-gesture-modifiers\";\nimport { UtilGestureData } from \"./util-gesture-data\";\nimport { UtilGestureEasing, UtilGestureEasingOptions } from \"./util-gesture-easing\";\nimport { UtilPointerEvent } from \"./util-pointer-event\";\nimport InteractionEvent = interaction.InteractionEvent;\n\nexport interface UtilGestureTarget extends DApplicationTarget {\n\tstate: DBaseStateSet;\n}\nexport type UtilGestureOnMove<TARGET> = (\n\ttarget: TARGET,\n\tdx: number,\n\tdy: number,\n\tx: number,\n\ty: number,\n\tds: number\n) => void;\nexport type UtilGestureOnStart<TARGET> = (target: TARGET) => void;\nexport type UtilGestureOnEnd<TARGET> = (target: TARGET) => void;\nexport type UtilGestureChecker<TARGET> = (\n\te: InteractionEvent,\n\tmodifier: UtilGestureModifier,\n\ttarget: TARGET\n) => boolean;\n\nexport interface UtilGestureCheckerOptions<TARGET> {\n\tstart?: UtilGestureChecker<TARGET>;\n\tmove?: UtilGestureChecker<TARGET>;\n}\n\nexport interface UtilGestureOnOptions<TARGET> {\n\tstart?: UtilGestureOnStart<TARGET>;\n\tmove?: UtilGestureOnMove<TARGET>;\n\tend?: UtilGestureOnEnd<TARGET>;\n}\n\nexport interface UtilGestureOptions<TARGET> {\n\t/**\n\t * True to restrict to touch gestures only.\n\t */\n\ttouch?: boolean;\n\n\t/**\n\t * Expected mouse modifiers\n\t */\n\tmodifier?: UtilGestureModifier;\n\n\t/**\n\t * Checker options\n\t */\n\tchecker?: UtilGestureCheckerOptions<TARGET>;\n\n\t/**\n\t * Easing options\n\t */\n\teasing?: boolean | UtilGestureEasingOptions;\n\n\t/** Binds the pointerdown event of the given target. */\n\tbind?: TARGET & utils.EventEmitter;\n\n\t/** Event options */\n\ton?: UtilGestureOnOptions<TARGET>;\n}\n\nexport class UtilGesture<TARGET extends UtilGestureTarget> {\n\tprotected _onStart?: UtilGestureOnStart<TARGET>;\n\tprotected _onMove?: UtilGestureOnMove<TARGET>;\n\tprotected _onEnd?: UtilGestureOnEnd<TARGET>;\n\tprotected _modifier: UtilGestureModifier;\n\tprotected _checkerStart: UtilGestureChecker<TARGET>;\n\tprotected _checkerMove: UtilGestureChecker<TARGET>;\n\tprotected _easing?: boolean | UtilGestureEasingOptions;\n\tprotected _touch: boolean;\n\n\tprotected _unused: Array<UtilGestureData<TARGET>>;\n\tprotected _used: Map<TARGET, UtilGestureData<TARGET>>;\n\n\tconstructor(options: UtilGestureOptions<TARGET>) {\n\t\tconst on = options.on;\n\t\tif (on) {\n\t\t\tthis._onStart = on.start;\n\t\t\tthis._onMove = on.move;\n\t\t\tthis._onEnd = on.end;\n\t\t}\n\t\tthis._modifier = options?.modifier ?? UtilGestureModifier.NONE;\n\t\tconst checker = options.checker;\n\t\tconst defaultChecker = UtilGestureModifiers.match;\n\t\tthis._checkerStart = checker?.start ?? defaultChecker;\n\t\tthis._checkerMove = checker?.move ?? defaultChecker;\n\t\tthis._easing = options.easing;\n\t\tthis._touch = !!options.touch;\n\n\t\tthis._unused = [];\n\t\tthis._used = new Map<TARGET, UtilGestureData<TARGET>>();\n\n\t\tconst bind = options.bind;\n\t\tif (bind != null) {\n\t\t\tthis.bind(bind);\n\t\t}\n\t}\n\n\tprotected newData(target: TARGET): UtilGestureData<TARGET> {\n\t\tconst used = this._used;\n\t\tconst result = used.get(target);\n\t\tif (result != null) {\n\t\t\treturn result;\n\t\t}\n\t\tconst poped = this._unused.pop();\n\t\tif (poped != null) {\n\t\t\tused.set(target, poped);\n\t\t\treturn poped;\n\t\t}\n\t\tconst created = new UtilGestureData<TARGET>();\n\t\tcreated.easing = this.newEasing(created);\n\t\tcreated.onMove = this.newOnMove(created);\n\t\tcreated.onEnd = this.newOnEnd(created);\n\t\tused.set(target, created);\n\t\treturn created;\n\t}\n\n\tprotected newEasing(data: UtilGestureData<TARGET>): UtilGestureEasing | undefined {\n\t\tconst easing = this._easing;\n\t\tif (easing == null || easing !== false) {\n\t\t\tconst onEasingMoveBound = (dx: number, dy: number, ds: number, time: number): void => {\n\t\t\t\tthis.onEasingMove(dx, dy, ds, time, data);\n\t\t\t};\n\t\t\tconst onEasingEndBound = (): void => {\n\t\t\t\tthis.onEasingEnd(data);\n\t\t\t};\n\t\t\treturn new UtilGestureEasing(\n\t\t\t\tonEasingMoveBound,\n\t\t\t\tonEasingEndBound,\n\t\t\t\tthis.toEasingOptions(easing)\n\t\t\t);\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprotected toEasingOptions(\n\t\toptions?: true | UtilGestureEasingOptions\n\t): UtilGestureEasingOptions | undefined {\n\t\treturn options == null || options === true ? undefined : options;\n\t}\n\n\tprotected deleteData(data: UtilGestureData<TARGET>): void {\n\t\tconst target = data.target;\n\t\tif (target) {\n\t\t\tif (this._used.delete(target)) {\n\t\t\t\tdata.target = undefined;\n\t\t\t\tdata.pointers.clear();\n\t\t\t\tthis._unused.push(data);\n\t\t\t}\n\t\t}\n\t}\n\n\tbind(target: TARGET & utils.EventEmitter): this {\n\t\ttarget.on(UtilPointerEvent.down, (e: InteractionEvent): void => {\n\t\t\tthis.onDown(target, e);\n\t\t});\n\t\treturn this;\n\t}\n\n\tprotected isTouch(e: InteractionEvent): boolean {\n\t\tconst oe = e.data.originalEvent;\n\t\tif (\"touches\" in oe) {\n\t\t\treturn true;\n\t\t} else if (\"pointerId\" in oe) {\n\t\t\treturn oe.pointerType !== \"mouse\";\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tonDown(target: TARGET, e: InteractionEvent): void {\n\t\tif (this._touch && !this.isTouch(e)) {\n\t\t\treturn;\n\t\t}\n\t\tif (!this._checkerStart(e, this._modifier, target)) {\n\t\t\treturn;\n\t\t}\n\t\tconst layer = DApplications.getLayer(target);\n\t\tif (layer == null) {\n\t\t\treturn;\n\t\t}\n\n\t\te.stopPropagation();\n\t\tif (target.state.isGesturing) {\n\t\t\tthis._used.get(target)?.start(e);\n\t\t} else {\n\t\t\t// User-defined handler\n\t\t\tconst onStart = this._onStart;\n\t\t\tif (onStart != null) {\n\t\t\t\tonStart(target);\n\t\t\t}\n\n\t\t\tconst data = this.newData(target);\n\t\t\tdata.target = target;\n\t\t\ttarget.state.isGesturing = true;\n\n\t\t\t// Interaction manager\n\t\t\tconst interactionManager = layer.renderer.plugins.interaction;\n\t\t\tdata.interactionManager = interactionManager;\n\n\t\t\t// Update the center\n\t\t\tdata.start(e);\n\n\t\t\t// Easing util\n\t\t\tconst easing = data.easing;\n\t\t\tif (easing) {\n\t\t\t\teasing.onStart();\n\t\t\t}\n\n\t\t\t// Event handler\n\t\t\tdata.bind(e);\n\t\t}\n\t}\n\n\tprotected newOnMove(data: UtilGestureData<TARGET>): (e: InteractionEvent) => void {\n\t\treturn (e: InteractionEvent): void => {\n\t\t\tthis.onMove(e, data);\n\t\t};\n\t}\n\n\tprotected newOnEnd(data: UtilGestureData<TARGET>): (e: InteractionEvent) => void {\n\t\treturn (e: InteractionEvent): void => {\n\t\t\tthis.onEnd(e, data);\n\t\t};\n\t}\n\n\tprotected onMove(e: InteractionEvent, data: UtilGestureData<TARGET>): void {\n\t\tconst target = data.target;\n\t\tif (target == null || !target.state.isGesturing) {\n\t\t\treturn;\n\t\t}\n\t\tif (!data.isUpdatable(e) || !this._checkerMove(e, this._modifier, target)) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Update the center\n\t\tconst center = data.center;\n\t\tconst oldCenterX = center.x;\n\t\tconst oldCenterY = center.y;\n\t\tconst oldScale = data.scale;\n\t\tconst oldTime = data.time;\n\t\tdata.update(e);\n\t\tconst newCenterX = center.x;\n\t\tconst newCenterY = center.y;\n\t\tconst newScale = data.scale;\n\t\tconst newTime = data.time;\n\n\t\t// Calculate the position\n\t\tconst dx = newCenterX - oldCenterX;\n\t\tconst dy = newCenterY - oldCenterY;\n\t\tconst dt = newTime - oldTime;\n\t\tconst epsilon = 0.00001;\n\t\tconst ds = epsilon < oldScale && epsilon < newScale ? newScale / oldScale : 1;\n\n\t\t// Easing\n\t\tconst easing = data.easing;\n\t\tif (easing) {\n\t\t\teasing.onMove(dx, dy, ds, dt);\n\t\t}\n\n\t\t// Call the user-defined handler\n\t\tconst onMove = this._onMove;\n\t\tif (onMove != null) {\n\t\t\tif (dx !== 0 || dy !== 0 || ds !== 1) {\n\t\t\t\tonMove(target, dx, dy, newCenterX, newCenterY, ds);\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected onEnd(e: InteractionEvent, data: UtilGestureData<TARGET>): void {\n\t\tconst target = data.target;\n\t\tif (target == null || !target.state.isGesturing) {\n\t\t\treturn;\n\t\t}\n\t\tif (!data.end(e)) {\n\t\t\treturn;\n\t\t}\n\n\t\t// State\n\t\ttarget.state.isGesturing = false;\n\n\t\t// Remove event handlers\n\t\tconst interactionManager = data.interactionManager;\n\t\tdata.interactionManager = undefined;\n\t\tif (interactionManager) {\n\t\t\tconst onMoveBound = data.onMove;\n\t\t\tif (onMoveBound) {\n\t\t\t\tinteractionManager.off(UtilPointerEvent.move, onMoveBound);\n\t\t\t}\n\t\t\tconst onEndBound = data.onEnd;\n\t\t\tif (onEndBound) {\n\t\t\t\tinteractionManager.off(UtilPointerEvent.up, onEndBound);\n\t\t\t\tinteractionManager.off(UtilPointerEvent.cancel, onEndBound);\n\t\t\t}\n\t\t}\n\n\t\t// Call the user-defined handler\n\t\tconst onEnd = this._onEnd;\n\t\tif (onEnd != null) {\n\t\t\tonEnd(target);\n\t\t}\n\n\t\t// Start the Easing\n\t\tconst easing = data.easing;\n\t\tif (easing) {\n\t\t\teasing.onEnd(e.data.originalEvent.timeStamp - data.time);\n\t\t} else {\n\t\t\tthis.deleteData(data);\n\t\t}\n\t}\n\n\tprotected onEasingMove(\n\t\tdx: number,\n\t\tdy: number,\n\t\tds: number,\n\t\ttime: number,\n\t\tdata: UtilGestureData<TARGET>\n\t): void {\n\t\tconst target = data.target;\n\t\tif (target == null) {\n\t\t\treturn;\n\t\t}\n\t\tconst onMove = this._onMove;\n\t\tif (onMove == null) {\n\t\t\treturn;\n\t\t}\n\t\tif (dx === 0 && dy === 0 && ds === 1) {\n\t\t\treturn;\n\t\t}\n\t\tconst center = data.center;\n\t\tconst x = center.x + dx;\n\t\tconst y = center.y + dy;\n\t\tcenter.set(x, y);\n\t\tonMove(data.target!, dx, dy, x, y, ds);\n\t}\n\n\tprotected onEasingEnd(data: UtilGestureData<TARGET>): void {\n\t\tthis.deleteData(data);\n\t}\n\n\tstop(target: TARGET): void {\n\t\tconst data = this._used.get(target);\n\t\tif (data == null) {\n\t\t\treturn;\n\t\t}\n\t\tdata.easing?.stop();\n\t\tthis.deleteData(data);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction } from \"pixi.js\";\nimport { DBase } from \"./d-base\";\nimport { UtilGestureMode } from \"./util/util-gesture-mode\";\nimport { UtilGestureModifier } from \"./util/util-gesture-modifier\";\nimport { DThemeViewGesture, DViewGesture, DViewGestureOptions } from \"./d-view-gesture\";\nimport { DViewStopper } from \"./d-view-stopper\";\nimport { DViewTarget, DViewToTarget } from \"./d-view-to-target\";\nimport { toEnum } from \"./util/to-enum\";\nimport { UtilGesture } from \"./util/util-gesture\";\nimport { DViewConstraint } from \"./d-view-constraint\";\n\nexport class DViewGestureImpl implements DViewGesture {\n\tprotected _parent: DBase;\n\tprotected _stopper: DViewStopper;\n\tprotected _constraint: DViewConstraint;\n\tprotected _gestureUtil?: UtilGesture<DBase>;\n\n\tconstructor(\n\t\tparent: DBase,\n\t\ttoTarget: DViewToTarget,\n\t\tstopper: DViewStopper,\n\t\tconstraint: DViewConstraint,\n\t\ttheme: DThemeViewGesture,\n\t\toptions?: DViewGestureOptions\n\t) {\n\t\tthis._parent = parent;\n\t\tthis._stopper = stopper;\n\t\tthis._constraint = constraint;\n\n\t\tconst mode = toEnum(options?.mode ?? theme.getGestureMode(), UtilGestureMode);\n\t\tconst modifier = toEnum(\n\t\t\toptions?.modifier ?? theme.getGestureModifier(),\n\t\t\tUtilGestureModifier\n\t\t);\n\t\tif (mode === UtilGestureMode.ON || mode === UtilGestureMode.TOUCH) {\n\t\t\tthis._gestureUtil = new UtilGesture<DBase>({\n\t\t\t\ttouch: mode === UtilGestureMode.TOUCH,\n\t\t\t\tmodifier,\n\t\t\t\tchecker: options && options.checker,\n\t\t\t\teasing: {\n\t\t\t\t\tduration: options?.duration\n\t\t\t\t},\n\t\t\t\ton: {\n\t\t\t\t\tstart: (): void => {\n\t\t\t\t\t\tthis._stopper.stop();\n\t\t\t\t\t},\n\t\t\t\t\tmove: (\n\t\t\t\t\t\ttarget: DBase,\n\t\t\t\t\t\tdx: number,\n\t\t\t\t\t\tdy: number,\n\t\t\t\t\t\tx: number,\n\t\t\t\t\t\ty: number,\n\t\t\t\t\t\tds: number\n\t\t\t\t\t): void => {\n\t\t\t\t\t\tthis.onGestureMove(toTarget(parent), dx, dy, x, y, ds);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tprotected onGestureMove(\n\t\ttarget: DViewTarget | null,\n\t\tdx: number,\n\t\tdy: number,\n\t\tx: number,\n\t\ty: number,\n\t\tds: number\n\t): void {\n\t\tif (target) {\n\t\t\t// Scale\n\t\t\tconst stopper = this._stopper;\n\t\t\tconst oldScale = target.scale;\n\t\t\tconst oldScaleX = oldScale.x;\n\t\t\tconst oldScaleY = oldScale.y;\n\t\t\tlet newScaleX = stopper.toNormalizedScale(oldScaleX * ds);\n\t\t\tlet newScaleY = stopper.toNormalizedScale(oldScaleY * ds);\n\n\t\t\tconst scaleRatioX = newScaleX / oldScaleX;\n\t\t\tconst scaleRatioY = newScaleY / oldScaleY;\n\t\t\tconst scaleRatio =\n\t\t\t\tds < 1 ? Math.max(scaleRatioX, scaleRatioY) : Math.min(scaleRatioX, scaleRatioY);\n\t\t\tnewScaleX = scaleRatio * oldScaleX;\n\t\t\tnewScaleY = scaleRatio * oldScaleY;\n\n\t\t\t// Position\n\t\t\tconst cx = x - dx;\n\t\t\tconst cy = y - dy;\n\t\t\tconst position = target.position;\n\t\t\tconst newX = (position.x - cx) * scaleRatio + x;\n\t\t\tconst newY = (position.y - cy) * scaleRatio + y;\n\n\t\t\t// Update\n\t\t\tthis._constraint(target, newX, newY, newScaleX, newScaleY);\n\t\t}\n\t}\n\n\tstop(): void {\n\t\tthis._gestureUtil?.stop(this._parent);\n\t}\n\n\tonDown(e: interaction.InteractionEvent): void {\n\t\tthis._gestureUtil?.onDown(this._parent, e);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DAnimation } from \"./d-animation\";\nimport { DAnimationBase } from \"./d-animation-base\";\nimport { DBase } from \"./d-base\";\nimport { DViewConstraint } from \"./d-view-constraint\";\nimport { DViewStopper } from \"./d-view-stopper\";\nimport { DViewTarget, DViewToTarget } from \"./d-view-to-target\";\nimport { DViewTransform } from \"./d-view-transform\";\n\nexport class DViewTransformImpl implements DViewTransform {\n\tprotected _parent: DBase;\n\tprotected _toTarget: DViewToTarget;\n\tprotected _constraint: DViewConstraint;\n\tprotected _newX: number;\n\tprotected _newY: number;\n\tprotected _newScaleX: number;\n\tprotected _newScaleY: number;\n\tprotected _oldX: number;\n\tprotected _oldY: number;\n\tprotected _oldScaleX: number;\n\tprotected _oldScaleY: number;\n\tprotected _animation: DAnimation;\n\tprotected _stopper: DViewStopper;\n\tprotected _duration: number;\n\n\tconstructor(\n\t\tparent: DBase,\n\t\ttoTarget: DViewToTarget,\n\t\tstopper: DViewStopper,\n\t\tconstraint: DViewConstraint,\n\t\tduration: number\n\t) {\n\t\tthis._parent = parent;\n\t\tthis._toTarget = toTarget;\n\t\tthis._constraint = constraint;\n\t\tthis._newScaleX = 1;\n\t\tthis._newScaleY = 1;\n\t\tthis._newX = 0;\n\t\tthis._newY = 0;\n\t\tthis._oldScaleX = 1;\n\t\tthis._oldScaleY = 1;\n\t\tthis._oldX = 0;\n\t\tthis._oldY = 0;\n\t\tthis._animation = new DAnimationBase({\n\t\t\tonTime: (time: number): void => {\n\t\t\t\tthis.onTime(time);\n\t\t\t},\n\t\t\tduration\n\t\t});\n\t\tthis._stopper = stopper;\n\t\tthis._duration = duration;\n\t}\n\n\tprotected onTime(time: number): void {\n\t\tconst w0 = 1 - time;\n\t\tconst w1 = time;\n\n\t\tconst scaleX = this._oldScaleX * w0 + this._newScaleX * w1;\n\t\tconst scaleY = this._oldScaleY * w0 + this._newScaleY * w1;\n\t\tconst x = this._oldX * w0 + this._newX * w1;\n\t\tconst y = this._oldY * w0 + this._newY * w1;\n\n\t\tconst target = this._toTarget(this._parent);\n\t\tif (target != null) {\n\t\t\tthis._constraint(target, x, y, scaleX, scaleY);\n\t\t}\n\t}\n\n\tstart(\n\t\ttarget: DViewTarget,\n\t\tx: number,\n\t\ty: number,\n\t\tscaleX: number,\n\t\tscaleY: number,\n\t\tduration?: number,\n\t\tstop?: boolean\n\t): void {\n\t\tif (stop !== false) {\n\t\t\tthis._stopper.stop();\n\t\t}\n\t\tif (duration == null) {\n\t\t\tduration = this._duration;\n\t\t}\n\t\tif (duration <= 0) {\n\t\t\tthis._constraint(target, x, y, scaleX, scaleY);\n\t\t} else {\n\t\t\tconst position = target.position;\n\t\t\tconst scale = target.scale;\n\t\t\tthis._oldX = position.x;\n\t\t\tthis._oldY = position.y;\n\t\t\tthis._oldScaleX = scale.x;\n\t\t\tthis._oldScaleY = scale.y;\n\n\t\t\tthis._newX = x;\n\t\t\tthis._newY = y;\n\t\t\tthis._newScaleX = scaleX;\n\t\t\tthis._newScaleY = scaleY;\n\n\t\t\tthis._animation.duration = duration;\n\t\t\tthis._animation.start();\n\t\t}\n\t}\n\n\tstop(): void {\n\t\tthis._animation.stop();\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction, IPoint, Point, Rectangle } from \"pixi.js\";\nimport { DBase } from \"./d-base\";\nimport { UtilGestureModifier } from \"./util/util-gesture-modifier\";\nimport { UtilGestureModifiers } from \"./util/util-gesture-modifiers\";\nimport { DThemeView, DView, DViewChecker, DViewOptions } from \"./d-view\";\nimport { DViewGesture } from \"./d-view-gesture\";\nimport { DViewGestureImpl } from \"./d-view-gesture-impl\";\nimport { DViewTargetPoint, DViewToTarget } from \"./d-view-to-target\";\nimport { DViewTransformImpl } from \"./d-view-transform-impl\";\nimport { DThemes } from \"./theme/d-themes\";\nimport { isString } from \"./util/is-string\";\nimport { toEnum } from \"./util/to-enum\";\nimport { UtilPointerEvent } from \"./util/util-pointer-event\";\nimport { UtilWheelEventDeltas } from \"./util/util-wheel-event\";\nimport { DViewConstraint } from \"./d-view-constraint\";\n\nexport class DViewImpl implements DView {\n\tprotected static CONSTRAINT: DViewConstraint = (target, x, y, scaleX, scaleY): void => {\n\t\ttarget.scale.set(scaleX, scaleY);\n\t\ttarget.position.set(x, y);\n\t};\n\n\tprotected _parent: DBase;\n\tprotected _toTarget: DViewToTarget;\n\tprotected _constraint: DViewConstraint;\n\n\tprotected _zoomPoint: Point;\n\tprotected _zoomMin: number;\n\tprotected _zoomMax: number;\n\tprotected _zoomKeepRatio: boolean;\n\n\tprotected _isWheelZoomEnabled: boolean;\n\tprotected _wheelZoomSpeed: number;\n\tprotected _wheelZoomModifier: UtilGestureModifier;\n\tprotected _wheelZoomChecker: DViewChecker;\n\n\tprotected _isDblClickZoomEnabled: boolean;\n\tprotected _dblClickZoomSpeed: number;\n\tprotected _dblClickZoomModifier: UtilGestureModifier;\n\tprotected _dblClickZoomChecker: DViewChecker;\n\tprotected _dblclickZoomDuration: number;\n\n\tprotected _isWheelTranslationEnabled: boolean;\n\tprotected _wheelTranslationSpeed: number;\n\tprotected _wheelTranslationModifier: UtilGestureModifier;\n\tprotected _wheelTranslationChecker: DViewChecker;\n\n\tprotected _transform: DViewTransformImpl;\n\tprotected _gesture: DViewGestureImpl;\n\n\tprotected _workRect: Rectangle;\n\n\tconstructor(parent: DBase, toTarget: DViewToTarget, options: DViewOptions | undefined) {\n\t\tthis._parent = parent;\n\t\tthis._toTarget = toTarget;\n\t\tthis._constraint = (options && options.constraint) || DViewImpl.CONSTRAINT;\n\n\t\tthis._workRect = new Rectangle();\n\n\t\t// Theme\n\t\tconst theme = this.toTheme(options) || this.getThemeDefault();\n\n\t\t// Zoom\n\t\tconst zoom = options?.zoom;\n\t\tthis._zoomPoint = new Point();\n\t\tthis._zoomMin = zoom?.min ?? theme.getZoomMin();\n\t\tthis._zoomMax = zoom?.max ?? theme.getZoomMax();\n\t\tthis._zoomKeepRatio = zoom?.keepRatio ?? theme.getZoomKeepRatio();\n\n\t\t// Zoom: Wheel\n\t\tconst wheelZoom = zoom?.wheel;\n\t\tthis._isWheelZoomEnabled = wheelZoom?.enable ?? theme.isWheelZoomEnabled();\n\t\tthis._wheelZoomSpeed = wheelZoom?.speed ?? theme.getWheelZoomSpeed();\n\t\tthis._wheelZoomModifier = toEnum(\n\t\t\twheelZoom?.modifier ?? theme.getWheelZoomModifier(),\n\t\t\tUtilGestureModifier\n\t\t);\n\t\tthis._wheelZoomChecker = wheelZoom?.checker ?? UtilGestureModifiers.match;\n\n\t\t// Zoom: Dbl click\n\t\tconst dblClickZoom = zoom?.dblclick;\n\t\tthis._isDblClickZoomEnabled = dblClickZoom?.enable ?? theme.isDblClickZoomEnabled();\n\t\tthis._dblClickZoomSpeed = dblClickZoom?.amount ?? theme.getDblClickZoomSpeed();\n\t\tthis._dblClickZoomModifier = toEnum(\n\t\t\tdblClickZoom?.modifier ?? theme.getDblClickZoomModifier(),\n\t\t\tUtilGestureModifier\n\t\t);\n\t\tthis._dblClickZoomChecker = dblClickZoom?.checker ?? UtilGestureModifiers.match;\n\t\tthis._dblclickZoomDuration = dblClickZoom?.duration ?? theme.getDblClickZoomDuration();\n\n\t\t// Translation: Wheel\n\t\tconst wheelTranslation = options?.translation?.wheel;\n\t\tthis._isWheelTranslationEnabled =\n\t\t\twheelTranslation?.enable ?? theme.isWheelTranslationEnabled();\n\t\tthis._wheelTranslationSpeed = wheelTranslation?.speed ?? theme.getWheelTranslationSpeed();\n\t\tthis._wheelTranslationModifier = toEnum(\n\t\t\twheelTranslation?.modifier ?? theme.getWheelTranslationModifier(),\n\t\t\tUtilGestureModifier\n\t\t);\n\t\tthis._wheelTranslationChecker = wheelTranslation?.checker ?? UtilGestureModifiers.match;\n\n\t\t// Gesture\n\t\tthis._gesture = new DViewGestureImpl(\n\t\t\tparent,\n\t\t\ttoTarget,\n\t\t\tthis,\n\t\t\tthis._constraint,\n\t\t\ttheme,\n\t\t\toptions?.gesture\n\t\t);\n\n\t\t// Transform\n\t\tthis._transform = new DViewTransformImpl(\n\t\t\tparent,\n\t\t\ttoTarget,\n\t\t\tthis,\n\t\t\tthis._constraint,\n\t\t\tthis._dblclickZoomDuration\n\t\t);\n\t}\n\n\tget gesture(): DViewGesture {\n\t\treturn this._gesture;\n\t}\n\n\tstop(): void {\n\t\tthis._gesture.stop();\n\t\tthis._transform.stop();\n\t}\n\n\treset(duration?: number, stop?: boolean): void {\n\t\tconst parent = this._parent;\n\t\tconst target = this._toTarget(parent);\n\t\tif (target) {\n\t\t\tconst targetRect = target.getLocalBounds(this._workRect);\n\t\t\tconst newTargetX = (parent.width - targetRect.width) * 0.5 - targetRect.x;\n\t\t\tconst newTargetY = (parent.height - targetRect.height) * 0.5 - targetRect.y;\n\t\t\tthis._transform.start(target, newTargetX, newTargetY, 1, 1, duration, stop);\n\t\t}\n\t}\n\n\tfit(duration?: number, stop?: boolean): void {\n\t\tconst parent = this._parent;\n\t\tconst target = this._toTarget(parent) as any;\n\t\tif (target) {\n\t\t\tconst padding = parent.padding;\n\t\t\tconst width = parent.width;\n\t\t\tconst height = parent.height;\n\t\t\tconst targetRect = target.getLocalBounds(this._workRect);\n\t\t\tconst targetX = targetRect.x;\n\t\t\tconst targetY = targetRect.y;\n\t\t\tconst targetWidth = targetRect.width;\n\t\t\tconst targetHeight = targetRect.height;\n\t\t\tlet newTargetScaleX = (width - padding.getLeft() - padding.getRight()) / targetWidth;\n\t\t\tlet newTargetScaleY = (height - padding.getTop() - padding.getBottom()) / targetHeight;\n\t\t\tif (this._zoomKeepRatio) {\n\t\t\t\tconst newTargetScale = this.toNormalizedScale(\n\t\t\t\t\tMath.min(newTargetScaleX, newTargetScaleY)\n\t\t\t\t);\n\t\t\t\tnewTargetScaleX = newTargetScale;\n\t\t\t\tnewTargetScaleY = newTargetScale;\n\t\t\t} else {\n\t\t\t\tnewTargetScaleX = this.toNormalizedScale(newTargetScaleX);\n\t\t\t\tnewTargetScaleY = this.toNormalizedScale(newTargetScaleY);\n\t\t\t}\n\t\t\tconst newTargetWidth = targetWidth * newTargetScaleX;\n\t\t\tconst newTargetHeight = targetHeight * newTargetScaleY;\n\t\t\tconst newTargetX = (width - newTargetWidth) * 0.5 - targetX * newTargetScaleX;\n\t\t\tconst newTargetY = (height - newTargetHeight) * 0.5 - targetY * newTargetScaleY;\n\t\t\tthis._transform.start(\n\t\t\t\ttarget,\n\t\t\t\tnewTargetX,\n\t\t\t\tnewTargetY,\n\t\t\t\tnewTargetScaleX,\n\t\t\t\tnewTargetScaleY,\n\t\t\t\tduration,\n\t\t\t\tstop\n\t\t\t);\n\t\t}\n\t}\n\n\tzoomIn(duration?: number, stop?: boolean): void {\n\t\tconst target = this._toTarget(this._parent);\n\t\tif (target) {\n\t\t\tconst factor = this._dblClickZoomSpeed;\n\t\t\tconst targetScale = target.scale;\n\t\t\tthis.zoom(targetScale.x * factor, targetScale.y * factor, duration, stop);\n\t\t}\n\t}\n\n\tzoomOut(duration?: number, stop?: boolean): void {\n\t\tconst target = this._toTarget(this._parent);\n\t\tif (target) {\n\t\t\tconst factor = 1 / this._dblClickZoomSpeed;\n\t\t\tconst targetScale = target.scale;\n\t\t\tthis.zoom(targetScale.x * factor, targetScale.y * factor, duration, stop);\n\t\t}\n\t}\n\n\tzoomAt(\n\t\tx: number,\n\t\ty: number,\n\t\tscaleX: number,\n\t\tscaleY: number,\n\t\tduration?: number,\n\t\tstop?: boolean\n\t): void {\n\t\tconst target = this._toTarget(this._parent);\n\t\tif (target) {\n\t\t\t// Scale\n\t\t\tconst oldScaleX = target.scale.x;\n\t\t\tconst oldScaleY = target.scale.y;\n\t\t\tconst newScaleX = this.toNormalizedScale(scaleX);\n\t\t\tconst newScaleY = this.toNormalizedScale(scaleY);\n\t\t\tconst scaleRatioX = newScaleX / oldScaleX;\n\t\t\tconst scaleRatioY = newScaleY / oldScaleY;\n\n\t\t\t// Position\n\t\t\tconst newX = (target.position.x - x) * scaleRatioX + x;\n\t\t\tconst newY = (target.position.y - y) * scaleRatioY + y;\n\n\t\t\t// Start\n\t\t\tthis._transform.start(target, newX, newY, newScaleX, newScaleY, duration, stop);\n\t\t}\n\t}\n\n\tzoomAtGlobal(\n\t\tx: number,\n\t\ty: number,\n\t\tscaleX: number,\n\t\tscaleY: number,\n\t\tduration?: number,\n\t\tstop?: boolean\n\t): void {\n\t\tconst local = this._zoomPoint;\n\t\tlocal.set(x, y);\n\t\tthis.toLocal(local, local);\n\t\tthis.zoomAt(local.x, local.y, scaleX, scaleY, duration, stop);\n\t}\n\n\tzoom(scaleX: number, scaleY: number, duration?: number, stop?: boolean): void {\n\t\tconst parent = this._parent;\n\t\tthis.zoomAt(parent.width * 0.5, parent.height * 0.5, scaleX, scaleY, duration, stop);\n\t}\n\n\tget scale(): DViewTargetPoint {\n\t\tconst target = this._toTarget(this._parent);\n\t\tif (target) {\n\t\t\treturn target.scale;\n\t\t}\n\t\treturn new Point(1, 1);\n\t}\n\n\tset scale(scale: DViewTargetPoint) {\n\t\tconst target = this._toTarget(this._parent);\n\t\tif (target) {\n\t\t\tconst newScaleX = this.toNormalizedScale(scale.x);\n\t\t\tconst newScaleY = this.toNormalizedScale(scale.y);\n\t\t\tconst targetPosition = target.position;\n\t\t\tthis._constraint(target, targetPosition.x, targetPosition.y, newScaleX, newScaleY);\n\t\t}\n\t}\n\n\tmoveTo(x: number, y: number, duration?: number, stop?: boolean): void {\n\t\tconst target = this._toTarget(this._parent);\n\t\tif (target) {\n\t\t\tconst targetScale = target.scale;\n\t\t\tthis._transform.start(target, x, y, targetScale.x, targetScale.y, duration, stop);\n\t\t}\n\t}\n\n\tget position(): DViewTargetPoint {\n\t\tconst target = this._toTarget(this._parent);\n\t\tif (target) {\n\t\t\treturn target.position;\n\t\t}\n\t\treturn new Point(0, 0);\n\t}\n\n\tset position(position: DViewTargetPoint) {\n\t\tconst target = this._toTarget(this._parent);\n\t\tif (target) {\n\t\t\tconst targetScale = target.scale;\n\t\t\tthis._constraint(target, position.x, position.y, targetScale.x, targetScale.y);\n\t\t}\n\t}\n\n\ttransform(\n\t\tx: number,\n\t\ty: number,\n\t\tscaleX: number,\n\t\tscaleY: number,\n\t\tduration?: number,\n\t\tstop?: boolean\n\t): void {\n\t\tconst target = this._toTarget(this._parent);\n\t\tif (target) {\n\t\t\tthis._transform.start(target, x, y, scaleX, scaleY, duration, stop);\n\t\t}\n\t}\n\n\ttoLocal(global: IPoint, local: IPoint, skipUpdate?: boolean): IPoint {\n\t\treturn this._parent.toLocal(global, undefined, local, skipUpdate);\n\t}\n\n\ttoGlobal(local: IPoint, global: IPoint, skipUpdate?: boolean): IPoint {\n\t\treturn this._parent.toGlobal(local, global, skipUpdate);\n\t}\n\n\ttoNormalizedScale(scale: number): number {\n\t\treturn Math.min(this._zoomMax, Math.max(this._zoomMin, scale));\n\t}\n\n\tonWheel(e: WheelEvent, deltas: UtilWheelEventDeltas, global: Point): boolean {\n\t\tif (\n\t\t\tthis._isWheelZoomEnabled &&\n\t\t\tthis._wheelZoomChecker(e, this._wheelZoomModifier, this._parent)\n\t\t) {\n\t\t\tif (deltas.deltaY !== 0) {\n\t\t\t\tconst target = this._toTarget(this._parent);\n\t\t\t\tif (target) {\n\t\t\t\t\tconst speed = deltas.lowest * this._wheelZoomSpeed;\n\t\t\t\t\tconst factor = 1 + deltas.deltaY * speed;\n\t\t\t\t\tconst targetScale = target.scale;\n\t\t\t\t\tthis.zoomAtGlobal(\n\t\t\t\t\t\tglobal.x,\n\t\t\t\t\t\tglobal.y,\n\t\t\t\t\t\ttargetScale.x * factor,\n\t\t\t\t\t\ttargetScale.y * factor,\n\t\t\t\t\t\t0\n\t\t\t\t\t);\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (\n\t\t\tthis._isWheelTranslationEnabled &&\n\t\t\tthis._wheelTranslationChecker(e, this._wheelTranslationModifier, this._parent)\n\t\t) {\n\t\t\tconst target = this._toTarget(this._parent);\n\t\t\tif (target) {\n\t\t\t\tthis.stop();\n\t\t\t\tconst speed = deltas.lowest * this._wheelTranslationSpeed;\n\t\t\t\tconst targetPosition = target.position;\n\t\t\t\tconst newX = targetPosition.x - deltas.deltaX * speed;\n\t\t\t\tconst newY = targetPosition.y + deltas.deltaY * speed;\n\t\t\t\tconst targetScale = target.scale;\n\t\t\t\tthis._constraint(target, newX, newY, targetScale.x, targetScale.y);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tonDown(e: interaction.InteractionEvent): void {\n\t\tthis._gesture.onDown(e);\n\t}\n\n\tonDblClick(\n\t\te: MouseEvent | TouchEvent,\n\t\tinteractionManager: interaction.InteractionManager\n\t): boolean {\n\t\tif (\n\t\t\tthis._isDblClickZoomEnabled &&\n\t\t\tthis._dblClickZoomChecker(e, this._dblClickZoomModifier, this._parent)\n\t\t) {\n\t\t\tconst target = this._toTarget(this._parent);\n\t\t\tif (target) {\n\t\t\t\tconst global = this._zoomPoint;\n\t\t\t\tUtilPointerEvent.toGlobal(e, interactionManager, global);\n\t\t\t\tconst factor = this._dblClickZoomSpeed;\n\t\t\t\tconst targetScale = target.scale;\n\t\t\t\tthis.zoomAtGlobal(\n\t\t\t\t\tglobal.x,\n\t\t\t\t\tglobal.y,\n\t\t\t\t\ttargetScale.x * factor,\n\t\t\t\t\ttargetScale.y * factor,\n\t\t\t\t\tthis._dblclickZoomDuration\n\t\t\t\t);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tprotected toTheme(options?: DViewOptions): DThemeView | null {\n\t\tif (options && options.theme) {\n\t\t\tconst theme = options.theme;\n\t\t\tif (isString(theme)) {\n\t\t\t\treturn DThemes.getInstance().get(theme);\n\t\t\t} else {\n\t\t\t\treturn theme;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tprotected getThemeDefault(): DThemeView {\n\t\treturn DThemes.getInstance().get(this.getType());\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DView\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction, Point } from \"pixi.js\";\nimport { DApplications } from \"./d-applications\";\nimport { DBase, DBaseEvents, DBaseOptions, DThemeBase } from \"./d-base\";\nimport { DOnOptions } from \"./d-on-options\";\nimport { DBaseOverflowMask } from \"./d-base-overflow-mask\";\nimport { DCanvas } from \"./d-canvas\";\nimport { DView, DViewOptions } from \"./d-view\";\nimport { DViewImpl } from \"./d-view-impl\";\nimport { UtilWheelEventDeltas } from \"./util/util-wheel-event\";\n\n/**\n * {@link DCanvasContainer} events.\n */\nexport interface DCanvasContainerEvents<CANVAS, EMITTER> extends DBaseEvents<EMITTER> {\n\t/**\n\t * Triggered when a canvas is removed.\n\t *\n\t * @param canvas a removed canvas\n\t * @param emitter an emitter\n\t */\n\tunset(canvas: CANVAS, emitter: EMITTER): void;\n\n\t/**\n\t * Triggered when a canvas is set.\n\t *\n\t * @param canvas a new canvas\n\t * @param emitter an emitter\n\t */\n\tset(canvas: CANVAS, emitter: EMITTER): void;\n}\n\n/**\n * {@link DCanvasContainer} \"on\" options.\n */\nexport interface DCanvasContainerOnOptions<CANVAS, EMITTER>\n\textends Partial<DCanvasContainerEvents<CANVAS, EMITTER>>,\n\t\tDOnOptions {}\n\n/**\n * {@link DCanvasContainer} options.\n */\nexport interface DCanvasContainerOptions<\n\tCANVAS extends DBase = DCanvas,\n\tCANVAS_OPTIONS extends DBaseOptions = DBaseOptions,\n\tTHEME extends DThemeCanvasContainer = DThemeCanvasContainer,\n\tEMITTER = any\n> extends DBaseOptions<THEME> {\n\tmask?: boolean;\n\tview?: DViewOptions;\n\tcanvas?: CANVAS;\n\ton?: DCanvasContainerOnOptions<CANVAS, EMITTER>;\n}\n\n/**\n * {@link DCanvasContainer} theme.\n */\nexport interface DThemeCanvasContainer extends DThemeBase {\n\tisOverflowMaskEnabled(): boolean;\n}\n\n/**\n * A canvas container.\n */\nexport class DCanvasContainer<\n\tCANVAS extends DBase = DCanvas,\n\tCANVAS_OPTIONS extends DBaseOptions = DBaseOptions,\n\tTHEME extends DThemeCanvasContainer = DThemeCanvasContainer,\n\tOPTIONS extends DCanvasContainerOptions<\n\t\tCANVAS,\n\t\tCANVAS_OPTIONS,\n\t\tTHEME\n\t> = DCanvasContainerOptions<CANVAS, CANVAS_OPTIONS, THEME>\n> extends DBase<THEME, OPTIONS> {\n\tprotected _canvas!: CANVAS | null;\n\tprotected _overflowMask?: DBaseOverflowMask | null;\n\tprotected _view!: DViewImpl;\n\n\tprotected init(options?: OPTIONS): void {\n\t\tsuper.init(options);\n\n\t\tthis._canvas = null;\n\t\tconst theme = this.theme;\n\t\tthis._view = new DViewImpl(this, () => this._canvas, options?.view);\n\n\t\t// Canvas\n\t\tconst canvas = options?.canvas;\n\t\tif (canvas) {\n\t\t\tthis.canvas = canvas;\n\t\t}\n\n\t\t// Overflow mask\n\t\tconst mask = options?.mask ?? theme.isOverflowMaskEnabled();\n\t\tif (mask) {\n\t\t\tthis.mask = this.getOverflowMask();\n\t\t}\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DCanvasContainer\";\n\t}\n\n\tonResize(newWidth: number, newHeight: number, oldWidth: number, oldHeight: number): void {\n\t\tsuper.onResize(newWidth, newHeight, oldWidth, oldHeight);\n\t\tthis.updateContentSize(newWidth, newHeight, oldWidth, oldHeight);\n\t}\n\n\tget canvas(): CANVAS | null {\n\t\treturn this._canvas;\n\t}\n\n\tset canvas(canvas: CANVAS | null) {\n\t\tconst previous = this._canvas;\n\t\tif (previous != null) {\n\t\t\tthis._canvas = null;\n\t\t\tthis.removeChild(previous);\n\t\t\tthis.emit(\"unset\", previous, this);\n\t\t\tprevious.destroy();\n\t\t}\n\n\t\tthis._canvas = canvas;\n\t\tif (canvas != null) {\n\t\t\tthis.addChild(canvas);\n\t\t\tthis._view.reset(0);\n\t\t\tthis.emit(\"set\", canvas, this);\n\t\t} else {\n\t\t\tDApplications.update(this);\n\t\t}\n\t}\n\n\tprotected getOverflowMask(): DBaseOverflowMask {\n\t\tif (this._overflowMask == null) {\n\t\t\tthis._overflowMask = new DBaseOverflowMask(this);\n\t\t\tthis._reflowable.add(this._overflowMask);\n\t\t\tthis.toDirty();\n\t\t}\n\t\treturn this._overflowMask;\n\t}\n\n\tprotected updateContentSize(\n\t\tnewWidth: number,\n\t\tnewHeight: number,\n\t\toldWidth: number,\n\t\toldHeight: number\n\t): void {\n\t\tconst canvas = this._canvas;\n\t\tif (canvas != null) {\n\t\t\tconst canvasX = canvas.x + (newWidth - oldWidth) * 0.5;\n\t\t\tconst canvasY = canvas.y + (newHeight - oldHeight) * 0.5;\n\t\t\tcanvas.position.set(canvasX, canvasY);\n\t\t}\n\t}\n\n\tget view(): DView {\n\t\treturn this._view;\n\t}\n\n\tonWheel(e: WheelEvent, deltas: UtilWheelEventDeltas, global: Point): boolean {\n\t\tconst vresult = this._view.onWheel(e, deltas, global);\n\t\tconst sresult = super.onWheel(e, deltas, global);\n\t\treturn vresult || sresult;\n\t}\n\n\tonDblClick(\n\t\te: MouseEvent | TouchEvent,\n\t\tinteractionManager: interaction.InteractionManager,\n\t\tskipView?: boolean\n\t): boolean {\n\t\tif (skipView !== true) {\n\t\t\tconst vresult = this._view.onDblClick(e, interactionManager);\n\t\t\tconst sresult = super.onDblClick(e, interactionManager);\n\t\t\treturn vresult || sresult;\n\t\t} else {\n\t\t\treturn super.onDblClick(e, interactionManager);\n\t\t}\n\t}\n\n\tprotected onDown(e: interaction.InteractionEvent, skipView?: boolean): void {\n\t\tif (skipView !== true) {\n\t\t\tthis._view.onDown(e);\n\t\t}\n\t\tsuper.onDown(e);\n\t}\n\n\tdestroy(): void {\n\t\t// Overflow mask\n\t\tconst overflowMask = this._overflowMask;\n\t\tif (overflowMask != null) {\n\t\t\tthis._overflowMask = null;\n\t\t\toverflowMask.destroy();\n\t\t}\n\t\t(this as any).mask = null;\n\n\t\tsuper.destroy();\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DApplications } from \"../../d-applications\";\nimport { DCanvasContainer } from \"../../d-canvas-container\";\nimport { EShape } from \"../e-shape\";\n\nexport interface EShapeActionRuntimeContainerDataRemote {\n\tset(id: string, value: unknown, time: number): boolean;\n}\n\nexport interface EShapeActionRuntimeContainerData {\n\treadonly remote: EShapeActionRuntimeContainerDataRemote;\n\n\tset(\n\t\tid: string,\n\t\tvalue: unknown,\n\t\ttime?: number,\n\t\tfrom?: number | null,\n\t\tto?: number | null\n\t): boolean;\n}\n\nexport interface EShapeActionRuntimeContainerShape {\n\temit(name: string, ...args: unknown[]): void;\n}\n\nexport interface EShapeActionRuntimeContainer extends DCanvasContainer {\n\treadonly shape: EShapeActionRuntimeContainerShape;\n\treadonly data: EShapeActionRuntimeContainerData;\n\n\topenByName(target: string): void;\n}\n\nexport class EShapeActionRuntimes {\n\tstatic toContainer(shape?: EShape | null): EShapeActionRuntimeContainer | null {\n\t\tlet current: { parent: any } | null | undefined = shape;\n\t\twhile (current != null) {\n\t\t\tif (current instanceof DCanvasContainer) {\n\t\t\t\treturn current as EShapeActionRuntimeContainer;\n\t\t\t}\n\t\t\tcurrent = current.parent;\n\t\t}\n\t\treturn null;\n\t}\n\n\tstatic open(shape: EShape, target: string): void {\n\t\tconst container = this.toContainer(shape);\n\t\tif (container) {\n\t\t\tcontainer.openByName(target);\n\t\t}\n\t}\n\n\tstatic write(\n\t\tshape: EShape,\n\t\tid: string,\n\t\tvalue: unknown,\n\t\ttime: number,\n\t\tremote: boolean\n\t): boolean {\n\t\tconst container = this.toContainer(shape);\n\t\tif (container) {\n\t\t\tif (remote) {\n\t\t\t\treturn container.data.remote.set(id, value, time);\n\t\t\t} else {\n\t\t\t\tif (container.data.set(id, value, time)) {\n\t\t\t\t\tDApplications.update(container);\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tstatic emit(shape: EShape, name: string): void;\n\tstatic emit(shape: EShape, name: string, value: unknown, time: number): void;\n\tstatic emit(shape: EShape, name: string, value?: unknown, time?: number): void {\n\t\tconst container = EShapeActionRuntimes.toContainer(shape);\n\t\tif (time === undefined) {\n\t\t\tshape.emit(name, shape);\n\t\t\tif (container) {\n\t\t\t\tcontainer.shape.emit(name, shape);\n\t\t\t}\n\t\t} else {\n\t\t\tshape.emit(name, value, time, shape);\n\t\t\tif (container) {\n\t\t\t\tcontainer.shape.emit(name, value, time, shape);\n\t\t\t}\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\nimport { EShapeActionExpression } from \"./e-shape-action-expression\";\nimport { EShapeActionExpressions } from \"./e-shape-action-expressions\";\nimport { EShapeActionRuntimeConditional } from \"./e-shape-action-runtime-conditional\";\nimport { EShapeActionRuntimes } from \"./e-shape-action-runtimes\";\nimport { EShapeActionValueEmitEvent } from \"./e-shape-action-value-emit-event\";\n\nexport class EShapeActionRuntimeEmitEvent extends EShapeActionRuntimeConditional {\n\tprotected name: EShapeActionExpression<string | null>;\n\n\tconstructor(value: EShapeActionValueEmitEvent) {\n\t\tsuper(value, EShapeRuntimeReset.NONE);\n\t\tthis.name = EShapeActionExpressions.ofStringOrNull(value.name);\n\t}\n\n\texecute(shape: EShape, runtime: EShapeRuntime, time: number): void {\n\t\tif (this.condition(shape, time)) {\n\t\t\tconst name = this.name(shape, time);\n\t\t\tif (name != null) {\n\t\t\t\tEShapeActionRuntimes.emit(shape, name);\n\t\t\t}\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShapeActionRuntimeEmitEvent } from \"./e-shape-action-runtime-emit-event\";\nimport { EShapeActionValue } from \"./e-shape-action-value\";\nimport { EShapeActionValueBase } from \"./e-shape-action-value-base\";\nimport { EShapeActionValueType } from \"./e-shape-action-value-type\";\nimport { EShapeActionValues } from \"./e-shape-action-values\";\n\nexport type EShapeActionValueEmitEventSerialized = [\n\ttypeof EShapeActionValueType.EMIT_EVENT,\n\tnumber,\n\tnumber\n];\n\nexport class EShapeActionValueEmitEvent extends EShapeActionValueBase {\n\treadonly name: string;\n\n\tconstructor(condition: string, name: string) {\n\t\tsuper(EShapeActionValueType.EMIT_EVENT, condition);\n\t\tthis.name = name;\n\t}\n\n\tisEquals(value: EShapeActionValue): boolean {\n\t\treturn (\n\t\t\tsuper.isEquals(value) &&\n\t\t\tvalue instanceof EShapeActionValueEmitEvent &&\n\t\t\tthis.name === value.name\n\t\t);\n\t}\n\n\ttoRuntime(): EShapeActionRuntimeEmitEvent {\n\t\treturn new EShapeActionRuntimeEmitEvent(this);\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\tconst conditionId = manager.addResource(this.condition);\n\t\tconst nameId = manager.addResource(this.name);\n\t\treturn manager.addResource(`[${this.type},${conditionId},${nameId}]`);\n\t}\n\n\tstatic deserialize(\n\t\tserialized: EShapeActionValueEmitEventSerialized,\n\t\tmanager: EShapeResourceManagerDeserialization\n\t): EShapeActionValueEmitEvent {\n\t\tconst condition = EShapeActionValues.toResource(1, serialized, manager.resources);\n\t\tconst name = EShapeActionValues.toResource(2, serialized, manager.resources);\n\t\treturn new EShapeActionValueEmitEvent(condition, name);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\nimport { EShapeActionExpression } from \"./e-shape-action-expression\";\nimport { EShapeActionExpressions } from \"./e-shape-action-expressions\";\nimport { EShapeActionRuntimeConditional } from \"./e-shape-action-runtime-conditional\";\nimport { EShapeActionRuntimes } from \"./e-shape-action-runtimes\";\nimport { EShapeActionValueMisc } from \"./e-shape-action-value-misc\";\n\nexport class EShapeActionRuntimeMiscEmitEvent extends EShapeActionRuntimeConditional {\n\tprotected target: EShapeActionExpression<string | null>;\n\n\tconstructor(value: EShapeActionValueMisc) {\n\t\tsuper(value, EShapeRuntimeReset.NONE);\n\t\tthis.target = EShapeActionExpressions.ofStringOrNull(value.target);\n\t}\n\n\texecute(shape: EShape, runtime: EShapeRuntime, time: number): void {\n\t\tif (this.condition(shape, time)) {\n\t\t\tconst target = this.target(shape, time);\n\t\t\tif (target != null) {\n\t\t\t\tEShapeActionRuntimes.emit(shape, target);\n\t\t\t}\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2021 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const DHtmlElementState = {\n\tNO_POINTER_EVENTS: \"NO_POINTER_EVENTS\"\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * {@link DHtmlElement} option when to show a HTML element\n */\nexport const UtilHtmlElementWhen = {\n\t/**\n\t * Shows a HTML element when clicked.\n\t */\n\tCLICKED: 0,\n\n\t/**\n\t * Shows a HTML element when double clicked.\n\t */\n\tDOUBLE_CLICKED: 1,\n\n\t/**\n\t * Shows a HTML element when focused.\n\t * And also shows when clicked if focused.\n\t */\n\tFOCUSED: 2,\n\n\t/**\n\t * Always shows a HTML element.\n\t */\n\tALWAYS: 3\n} as const;\n\nexport type UtilHtmlElementWhen = typeof UtilHtmlElementWhen[keyof typeof UtilHtmlElementWhen];\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction, Matrix, Point, Rectangle, Renderer } from \"pixi.js\";\nimport { DApplications } from \"../d-applications\";\nimport { DBase } from \"../d-base\";\nimport { DBaseStateSet } from \"../d-base-state-set\";\nimport { DFocusableMightBe } from \"../d-controller-focus\";\nimport { toEnum } from \"./to-enum\";\nimport { UtilHtmlElementWhen } from \"./util-html-element-when\";\n\nexport interface UtilHtmlElementPaddingLTRB {\n\tgetLeft(): number;\n\tgetTop(): number;\n\tgetRight(): number;\n\tgetBottom(): number;\n}\n\nexport interface UtilHtmlElementPaddingVH {\n\treadonly horizontal: number;\n\treadonly vertical: number;\n}\n\nexport type UtilHtmlElementPadding = UtilHtmlElementPaddingVH | UtilHtmlElementPaddingLTRB;\n\nexport type UtilHtmlElementCreator<T extends HTMLElement> = (container: HTMLElement) => T | null;\nexport type UtilHtmlElementStyler<T extends HTMLElement> = (\n\ttarget: T,\n\tstate: DBaseStateSet,\n\tpadding: UtilHtmlElementPadding | null,\n\telementRect: Rectangle | null,\n\telementMatrix: Matrix | null,\n\tclipperRect: Rectangle | null\n) => void;\n\nexport type UtilHtmlElementStylerBefore = (target: HTMLDivElement) => void;\nexport type UtilHtmlElementStylerAfter = (target: HTMLDivElement) => void;\nexport type UtilHtmlElementToRect = (\n\tresolution: number,\n\twork: Point,\n\tresult: Rectangle\n) => Rectangle | null;\nexport type UtilHtmlElementToMatrix = () => Matrix | null;\n\nexport interface UtilHtmlElementElementOptions<ELEMENT extends HTMLElement> {\n\tcreator?: UtilHtmlElementCreator<ELEMENT>;\n\tstyler?: UtilHtmlElementStyler<ELEMENT>;\n}\n\nexport interface UtilHtmlElementClipperOptions {\n\tcreator?: UtilHtmlElementCreator<HTMLDivElement>;\n\tstyler?: UtilHtmlElementStyler<HTMLDivElement>;\n}\n\nexport interface UtilHtmlElementBeforeOptions {\n\tcreator?: UtilHtmlElementCreator<HTMLDivElement>;\n\tstyler?: UtilHtmlElementStylerBefore;\n}\n\nexport interface UtilHtmlElementAfterOptions {\n\tcreator?: UtilHtmlElementCreator<HTMLDivElement>;\n\tstyler?: UtilHtmlElementStylerAfter;\n}\n\nexport interface UtilHtmlElementOptions<ELEMENT extends HTMLElement = HTMLElement> {\n\telement?: UtilHtmlElementElementOptions<ELEMENT>;\n\tclipper?: UtilHtmlElementClipperOptions;\n\tbefore?: UtilHtmlElementBeforeOptions;\n\tafter?: UtilHtmlElementAfterOptions;\n\twhen?: UtilHtmlElementWhen | keyof typeof UtilHtmlElementWhen;\n\tselect?: boolean;\n}\n\nexport interface UtilThemeHtmlElement<ELEMENT extends HTMLElement> {\n\tgetElementCreator(): UtilHtmlElementCreator<ELEMENT>;\n\tsetElementStyle(\n\t\ttarget: ELEMENT,\n\t\tstate: DBaseStateSet,\n\t\tpadding: UtilHtmlElementPadding | null,\n\t\telementRect: Rectangle | null,\n\t\telementMatrix: Matrix | null,\n\t\tclipperRect: Rectangle | null\n\t): void;\n\tgetClipperCreator(): UtilHtmlElementCreator<HTMLDivElement>;\n\tsetClipperStyle(\n\t\ttarget: HTMLDivElement,\n\t\tstate: DBaseStateSet,\n\t\tpadding: UtilHtmlElementPadding | null,\n\t\telementRect: Rectangle | null,\n\t\telementMatrix: Matrix | null,\n\t\tclipperRect: Rectangle | null\n\t): void;\n\tgetBeforeCreator(): UtilHtmlElementCreator<HTMLDivElement>;\n\tsetBeforeStyle(target: HTMLDivElement): void;\n\tgetAfterCreator(): UtilHtmlElementCreator<HTMLDivElement>;\n\tsetAfterStyle(target: HTMLDivElement): void;\n\tgetWhen(): UtilHtmlElementWhen;\n\tgetSelect(): boolean;\n}\n\nexport interface UtilHtmlElementElementData<ELEMENT extends HTMLElement> {\n\tcreator: UtilHtmlElementCreator<ELEMENT>;\n\tstyler: UtilHtmlElementStyler<ELEMENT>;\n}\n\nexport interface UtilHtmlElementClipperData {\n\tcreator: UtilHtmlElementCreator<HTMLDivElement>;\n\tstyler: UtilHtmlElementStyler<HTMLDivElement>;\n}\n\nexport interface UtilHtmlElementBeforeData {\n\tcreator: UtilHtmlElementCreator<HTMLDivElement>;\n\tstyler: UtilHtmlElementStylerBefore;\n}\n\nexport interface UtilHtmlElementAfterData {\n\tcreator: UtilHtmlElementCreator<HTMLDivElement>;\n\tstyler: UtilHtmlElementStylerAfter;\n}\n\nexport interface UtilHtmlElementData<ELEMENT extends HTMLElement = HTMLElement> {\n\telement: UtilHtmlElementElementData<ELEMENT>;\n\tclipper: UtilHtmlElementClipperData;\n\tbefore: UtilHtmlElementBeforeData;\n\tafter: UtilHtmlElementAfterData;\n\twhen: UtilHtmlElementWhen;\n\tselect: boolean;\n}\n\nexport interface UtilHtmlElementTarget extends DFocusableMightBe {\n\treadonly state: DBaseStateSet;\n\treadonly cursor: string;\n\treadonly worldVisible: boolean;\n\n\tfocus(): void;\n}\n\nexport interface UtilHtmlElementOperation<ELEMENT extends HTMLElement> {\n\tgetElementRect(resolution: number, work: Point, result: Rectangle): Rectangle | null;\n\tgetElementMatrix(): Matrix | null;\n\tgetClipperRect(resolution: number, work: Point, result: Rectangle): Rectangle | null;\n\tgetPadding(): UtilHtmlElementPadding | null;\n\tcontainsPoint(point: Point): boolean;\n\tonStart(): void;\n\tonCancel(): void;\n\tonEnd(): void;\n}\n\nexport class UtilHtmlElement<\n\tELEMENT extends HTMLElement = HTMLElement,\n\tTARGET extends UtilHtmlElementTarget = UtilHtmlElementTarget,\n\tOPERATION extends UtilHtmlElementOperation<ELEMENT> = UtilHtmlElementOperation<ELEMENT>,\n\tTHEME extends UtilThemeHtmlElement<ELEMENT> = UtilThemeHtmlElement<ELEMENT>,\n\tOPTIONS extends UtilHtmlElementOptions<ELEMENT> = UtilHtmlElementOptions<ELEMENT>\n> {\n\tprotected _target: TARGET;\n\tprotected _operation: OPERATION;\n\tprotected _data: UtilHtmlElementData<ELEMENT>;\n\n\tprotected _point?: Point;\n\n\tprotected _clipper?: HTMLDivElement | null;\n\tprotected _clipperRectResult?: Rectangle;\n\n\tprotected _element?: ELEMENT | null;\n\tprotected _elementRectResult?: Rectangle;\n\tprotected _isElementShown: boolean;\n\tprotected _onElementFocusBound: (e: FocusEvent) => void;\n\n\tprotected _before?: HTMLDivElement | null;\n\tprotected _onBeforeFocusBound: (e: FocusEvent) => void;\n\n\tprotected _after?: HTMLDivElement | null;\n\tprotected _onAfterFocusBound!: (e: FocusEvent) => void;\n\n\tprotected _isStarted: boolean;\n\tprotected _wasStarted: boolean;\n\tprotected _doSelectBound: () => void;\n\tprotected _isStartRequested: boolean;\n\n\tprotected _rendererBound?: Renderer;\n\tprotected _onPostRenderBound: () => void;\n\n\tconstructor(target: TARGET, operation: OPERATION, theme: THEME, options?: OPTIONS) {\n\t\tthis._target = target;\n\t\tthis._operation = operation;\n\t\tconst data = this.toData(theme, options);\n\t\tthis._data = data;\n\n\t\tthis._isElementShown = false;\n\t\tthis._onElementFocusBound = (e: FocusEvent): void => {\n\t\t\tthis.onElementFocus(e);\n\t\t};\n\n\t\tthis._onBeforeFocusBound = (e: FocusEvent): void => {\n\t\t\tthis.onBeforeFocus(e);\n\t\t};\n\n\t\tthis._onAfterFocusBound = (e: FocusEvent): void => {\n\t\t\tthis.onAfterFocus(e);\n\t\t};\n\n\t\tthis._isStarted = false;\n\t\tthis._wasStarted = false;\n\t\tthis._doSelectBound = () => {\n\t\t\tthis.doSelect();\n\t\t};\n\t\tthis._isStartRequested = this._data.when === UtilHtmlElementWhen.ALWAYS;\n\t\tthis._onPostRenderBound = () => {\n\t\t\tthis.updateElement(this._rendererBound!);\n\t\t};\n\t}\n\n\tprotected toData(theme: THEME, options?: OPTIONS): UtilHtmlElementData<ELEMENT> {\n\t\treturn {\n\t\t\telement: this.toElementData(theme, options?.element),\n\t\t\tclipper: this.toClipperData(theme, options?.clipper),\n\t\t\tbefore: this.toBeforeData(theme, options?.before),\n\t\t\tafter: this.toAfterData(theme, options?.after),\n\t\t\twhen: toEnum(options?.when ?? theme.getWhen(), UtilHtmlElementWhen),\n\t\t\tselect: options?.select ?? theme.getSelect()\n\t\t};\n\t}\n\n\tprotected toElementData(\n\t\ttheme: THEME,\n\t\toptions?: OPTIONS[\"element\"]\n\t): UtilHtmlElementElementData<ELEMENT> {\n\t\treturn {\n\t\t\tcreator: options?.creator ?? theme.getElementCreator(),\n\t\t\tstyler: options?.styler ?? this.newElementStyler(theme)\n\t\t};\n\t}\n\n\tprotected newElementStyler(theme: THEME) {\n\t\treturn (\n\t\t\ttarget: ELEMENT,\n\t\t\tstate: DBaseStateSet,\n\t\t\tpadding: UtilHtmlElementPadding | null,\n\t\t\telementRect: Rectangle | null,\n\t\t\telementMatrix: Matrix | null,\n\t\t\tclipperRect: Rectangle | null\n\t\t): void => {\n\t\t\treturn theme.setElementStyle(\n\t\t\t\ttarget,\n\t\t\t\tstate,\n\t\t\t\tpadding,\n\t\t\t\telementRect,\n\t\t\t\telementMatrix,\n\t\t\t\tclipperRect\n\t\t\t);\n\t\t};\n\t}\n\n\tprotected toClipperData(\n\t\ttheme: THEME,\n\t\toptions?: OPTIONS[\"clipper\"]\n\t): UtilHtmlElementClipperData {\n\t\treturn {\n\t\t\tcreator: options?.creator ?? theme.getClipperCreator(),\n\t\t\tstyler: options?.styler ?? this.newClipperStyler(theme)\n\t\t};\n\t}\n\n\tprotected newClipperStyler(theme: THEME) {\n\t\treturn (\n\t\t\ttarget: HTMLDivElement,\n\t\t\tstate: DBaseStateSet,\n\t\t\tpadding: UtilHtmlElementPadding | null,\n\t\t\telementRect: Rectangle | null,\n\t\t\telementMatrix: Matrix | null,\n\t\t\tclipperRect: Rectangle | null\n\t\t): void => {\n\t\t\treturn theme.setClipperStyle(\n\t\t\t\ttarget,\n\t\t\t\tstate,\n\t\t\t\tpadding,\n\t\t\t\telementRect,\n\t\t\t\telementMatrix,\n\t\t\t\tclipperRect\n\t\t\t);\n\t\t};\n\t}\n\n\tprotected toBeforeData(theme: THEME, options?: OPTIONS[\"before\"]): UtilHtmlElementBeforeData {\n\t\treturn {\n\t\t\tcreator: options?.creator ?? theme.getBeforeCreator(),\n\t\t\tstyler: options?.styler ?? this.newBeforeStyler(theme)\n\t\t};\n\t}\n\n\tprotected newBeforeStyler(theme: THEME) {\n\t\treturn (target: HTMLDivElement): void => {\n\t\t\ttheme.setBeforeStyle(target);\n\t\t};\n\t}\n\n\tprotected toAfterData(theme: THEME, options?: OPTIONS[\"after\"]): UtilHtmlElementAfterData {\n\t\treturn {\n\t\t\tcreator: options?.creator ?? theme.getAfterCreator(),\n\t\t\tstyler: options?.styler ?? this.newAfterStyler(theme)\n\t\t};\n\t}\n\n\tprotected newAfterStyler(theme: THEME) {\n\t\treturn (target: HTMLDivElement): void => {\n\t\t\ttheme.setAfterStyle(target);\n\t\t};\n\t}\n\n\tget element(): ELEMENT | null {\n\t\treturn this._element ?? null;\n\t}\n\n\tget when(): UtilHtmlElementWhen {\n\t\treturn this._data.when;\n\t}\n\n\tonDowning(e: interaction.InteractionEvent | KeyboardEvent): void {\n\t\tthis._wasStarted = this._isStarted;\n\t\tswitch (this.when) {\n\t\t\tcase UtilHtmlElementWhen.CLICKED:\n\t\t\t\tthis.start();\n\t\t\t\tbreak;\n\t\t\tcase UtilHtmlElementWhen.FOCUSED:\n\t\t\t\tif (this._target.state.isFocused) {\n\t\t\t\t\tthis.start();\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tonDown(e: interaction.InteractionEvent | KeyboardEvent): void {\n\t\tif (!this._wasStarted && this._isStarted) {\n\t\t\tif (\"data\" in e) {\n\t\t\t\te.data.originalEvent.preventDefault();\n\t\t\t} else {\n\t\t\t\te.preventDefault();\n\t\t\t}\n\t\t}\n\t}\n\n\tonDblClick(\n\t\te: MouseEvent | TouchEvent | KeyboardEvent,\n\t\tinteractionManager: interaction.InteractionManager\n\t): void {\n\t\tswitch (this.when) {\n\t\t\tcase UtilHtmlElementWhen.DOUBLE_CLICKED:\n\t\t\t\tthis.start();\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tonFocus(): void {\n\t\tswitch (this.when) {\n\t\t\tcase UtilHtmlElementWhen.FOCUSED:\n\t\t\t\tthis.start();\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthis._element?.focus();\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tonBlur(): void {\n\t\tswitch (this.when) {\n\t\t\tcase UtilHtmlElementWhen.CLICKED:\n\t\t\tcase UtilHtmlElementWhen.DOUBLE_CLICKED:\n\t\t\tcase UtilHtmlElementWhen.FOCUSED:\n\t\t\t\tthis.onEndByBlur();\n\t\t\t\tthis.cancel();\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthis._element?.blur();\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tisStartable(): boolean {\n\t\tswitch (this.when) {\n\t\t\tcase UtilHtmlElementWhen.CLICKED:\n\t\t\tcase UtilHtmlElementWhen.DOUBLE_CLICKED:\n\t\t\tcase UtilHtmlElementWhen.FOCUSED:\n\t\t\t\treturn this._target.state.isActionable;\n\t\t\tdefault:\n\t\t\t\treturn true;\n\t\t}\n\t}\n\n\tstart(): void {\n\t\tif (!this._isStarted && this.isStartable()) {\n\t\t\tthis._isStarted = true;\n\t\t\tif (this._target.worldVisible) {\n\t\t\t\tthis.doStart();\n\t\t\t} else {\n\t\t\t\tthis._isStartRequested = true;\n\t\t\t}\n\t\t\tDApplications.update(this._target);\n\t\t}\n\t}\n\n\tisShown(): boolean {\n\t\treturn this._isElementShown;\n\t}\n\n\tonRender(renderer: Renderer): void {\n\t\tif (\n\t\t\tthis._isStartRequested ||\n\t\t\t(!this._isElementShown && this.when === UtilHtmlElementWhen.ALWAYS)\n\t\t) {\n\t\t\tthis._isStartRequested = false;\n\t\t\tthis.doStart(renderer);\n\t\t}\n\t\tif (this._isStarted) {\n\t\t\tthis._isStarted = false;\n\t\t}\n\t}\n\n\tprotected getElementRect(resolution: number): Rectangle | null {\n\t\tconst point = this._point || new Point(0, 0);\n\t\tthis._point = point;\n\t\tconst result = this._elementRectResult || new Rectangle();\n\t\tthis._elementRectResult = result;\n\t\treturn this._operation.getElementRect(resolution, point, result);\n\t}\n\n\tprotected getElementMatrix(): Matrix | null {\n\t\treturn this._operation.getElementMatrix();\n\t}\n\n\tprotected getClipperRect(resolution: number): Rectangle | null {\n\t\tconst point = this._point || new Point(0, 0);\n\t\tthis._point = point;\n\t\tconst result = this._clipperRectResult || new Rectangle();\n\t\tthis._clipperRectResult = result;\n\t\treturn this._operation.getClipperRect(resolution, point, result);\n\t}\n\n\tprotected doStart(renderer?: Renderer): void {\n\t\tif (!this._isElementShown) {\n\t\t\tthis._isElementShown = true;\n\n\t\t\tconst rendererBound = this._rendererBound;\n\t\t\tif (rendererBound != null) {\n\t\t\t\tthis._rendererBound = undefined;\n\t\t\t\trendererBound.off(\"postrender\", this._onPostRenderBound);\n\t\t\t}\n\n\t\t\tconst target = this._target;\n\t\t\tif (renderer == null) {\n\t\t\t\trenderer = DApplications.getLayer(target)?.renderer;\n\t\t\t}\n\t\t\tif (renderer) {\n\t\t\t\tthis._rendererBound = renderer;\n\t\t\t\trenderer.on(\"postrender\", this._onPostRenderBound);\n\t\t\t}\n\n\t\t\tthis.onStart();\n\n\t\t\tconst clipper = this.getClipper();\n\t\t\tif (clipper) {\n\t\t\t\tconst before = this.getBefore(clipper);\n\t\t\t\tconst element = this.getElement(clipper);\n\t\t\t\tconst after = this.getAfter(clipper);\n\t\t\t\tif (element) {\n\t\t\t\t\tconst resolution = renderer?.resolution ?? DApplications.getResolution(target);\n\t\t\t\t\tconst elementRect = this.getElementRect(resolution);\n\t\t\t\t\tconst elementMatrix = this.getElementMatrix();\n\t\t\t\t\tconst clipperRect = this.toClipperRectAdjusted(\n\t\t\t\t\t\telementRect,\n\t\t\t\t\t\telementMatrix,\n\t\t\t\t\t\tthis.getClipperRect(resolution)\n\t\t\t\t\t);\n\t\t\t\t\tconst state = target.state;\n\t\t\t\t\tconst padding = this._operation.getPadding();\n\t\t\t\t\tconst options = this._data;\n\t\t\t\t\toptions.clipper.styler(\n\t\t\t\t\t\tclipper,\n\t\t\t\t\t\tstate,\n\t\t\t\t\t\tpadding,\n\t\t\t\t\t\telementRect,\n\t\t\t\t\t\telementMatrix,\n\t\t\t\t\t\tclipperRect\n\t\t\t\t\t);\n\t\t\t\t\toptions.element.styler(\n\t\t\t\t\t\telement,\n\t\t\t\t\t\tstate,\n\t\t\t\t\t\tpadding,\n\t\t\t\t\t\telementRect,\n\t\t\t\t\t\telementMatrix,\n\t\t\t\t\t\tclipperRect\n\t\t\t\t\t);\n\t\t\t\t\tif (before) {\n\t\t\t\t\t\toptions.before.styler(before);\n\t\t\t\t\t}\n\t\t\t\t\tif (after) {\n\t\t\t\t\t\toptions.after.styler(after);\n\t\t\t\t\t}\n\t\t\t\t\tthis.onElementAttached(element, before, after);\n\n\t\t\t\t\t// Show HTML elements\n\t\t\t\t\tclipper.style.display = \"\";\n\t\t\t\t\tif (state.isFocused) {\n\t\t\t\t\t\tthis.toElementFocused(element);\n\t\t\t\t\t}\n\t\t\t\t\tclipper.scrollTop = 0;\n\t\t\t\t\tclipper.scrollLeft = 0;\n\n\t\t\t\t\t// Select the element if required.\n\t\t\t\t\t// Note that a selecting without the setTimeout causes a key stroke drop on Microsoft Edge.\n\t\t\t\t\tif (this._data.select) {\n\t\t\t\t\t\tsetTimeout(this._doSelectBound, 0);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected toElementFocused(element: ELEMENT): void {\n\t\telement.focus();\n\t}\n\n\tprotected onStart(): void {\n\t\tthis._operation.onStart();\n\t}\n\n\tprotected doSelect(): void {\n\t\tconst element = this._element;\n\t\tif (element) {\n\t\t\tif (element instanceof HTMLInputElement || element instanceof HTMLTextAreaElement) {\n\t\t\t\t// The following does not work on mobile devices.\n\t\t\t\t// I think selecting texts on a tap is annoying.\n\t\t\t\t// Therefore, I leave this untouched.\n\t\t\t\telement.select();\n\t\t\t}\n\t\t}\n\t}\n\n\tcancel(): void {\n\t\tif (this._isElementShown) {\n\t\t\tthis._isElementShown = false;\n\n\t\t\tconst rendererBound = this._rendererBound;\n\t\t\tif (rendererBound != null) {\n\t\t\t\tthis._rendererBound = undefined;\n\t\t\t\trendererBound.off(\"postrender\", this._onPostRenderBound);\n\t\t\t}\n\n\t\t\tthis.onCancel();\n\n\t\t\tconst target = this._target;\n\t\t\tconst layer = DApplications.getLayer(target);\n\t\t\tif (layer) {\n\t\t\t\tconst view = layer.view;\n\t\t\t\tswitch (this.when) {\n\t\t\t\t\tcase UtilHtmlElementWhen.CLICKED:\n\t\t\t\t\tcase UtilHtmlElementWhen.DOUBLE_CLICKED:\n\t\t\t\t\tcase UtilHtmlElementWhen.FOCUSED:\n\t\t\t\t\t\tif (document.activeElement === this._element) {\n\t\t\t\t\t\t\tview.focus();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tconst state = target.state;\n\t\t\t\tconst interactionManager = layer.renderer.plugins.interaction;\n\t\t\t\tif (\n\t\t\t\t\tthis._operation.containsPoint(interactionManager.mouse.global) &&\n\t\t\t\t\t!state.isHovered\n\t\t\t\t) {\n\t\t\t\t\tstate.isHovered = true;\n\t\t\t\t\tview.style.cursor = target.cursor;\n\t\t\t\t}\n\n\t\t\t\tlayer.update();\n\t\t\t}\n\n\t\t\tconst element = this._element;\n\t\t\tif (element != null) {\n\t\t\t\tthis.onElementDetached(element, this._before, this._after);\n\t\t\t}\n\n\t\t\tconst clipper = this._clipper;\n\t\t\tif (clipper != null) {\n\t\t\t\tclipper.style.display = \"none\";\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected onCancel(): void {\n\t\tthis._operation.onCancel();\n\t}\n\n\tprotected onElementAttached(\n\t\telement: ELEMENT,\n\t\tbefore?: HTMLDivElement | null,\n\t\tafter?: HTMLDivElement | null\n\t): void {\n\t\tbefore?.addEventListener(\"focus\", this._onBeforeFocusBound);\n\t\tafter?.addEventListener(\"focus\", this._onAfterFocusBound);\n\t\telement.addEventListener(\"focus\", this._onElementFocusBound, true);\n\t}\n\n\tprotected onElementDetached(\n\t\telement: ELEMENT,\n\t\tbefore?: HTMLDivElement | null,\n\t\tafter?: HTMLDivElement | null\n\t): void {\n\t\tbefore?.removeEventListener(\"focus\", this._onBeforeFocusBound);\n\t\tafter?.removeEventListener(\"focus\", this._onAfterFocusBound);\n\t\telement.removeEventListener(\"focus\", this._onElementFocusBound, true);\n\t}\n\n\tprotected getClipper(): HTMLDivElement | null {\n\t\tlet result = this._clipper;\n\t\tif (result == null) {\n\t\t\tconst layer = DApplications.getLayer(this._target);\n\t\t\tresult = layer ? this._data.clipper.creator(layer.getElementContainer()) : null;\n\t\t\tthis._clipper = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected getElement(clipper: HTMLDivElement): ELEMENT | null {\n\t\tlet result = this._element;\n\t\tif (result == null) {\n\t\t\tresult = this._data.element.creator(clipper);\n\t\t\tthis._element = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected getBefore(clipper: HTMLDivElement): HTMLDivElement | null {\n\t\tlet result = this._before;\n\t\tif (result == null) {\n\t\t\tresult = this._data.before.creator(clipper);\n\t\t\tthis._before = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected getAfter(clipper: HTMLDivElement): HTMLDivElement | null {\n\t\tlet result = this._after;\n\t\tif (result == null) {\n\t\t\tresult = this._data.after.creator(clipper);\n\t\t\tthis._after = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected onBeforeFocus(e: FocusEvent): void {\n\t\tconst target = this._target;\n\t\tconst layer = DApplications.getLayer(target);\n\t\tif (layer) {\n\t\t\tconst focusController = layer.getFocusController();\n\t\t\tconst focusable = focusController.find(target, false, false, false);\n\t\t\tlayer.view.focus();\n\t\t\tfocusController.focus(focusable);\n\t\t\te.preventDefault();\n\t\t\te.stopImmediatePropagation();\n\t\t}\n\t}\n\n\tprotected onAfterFocus(e: FocusEvent): void {\n\t\tconst target = this._target;\n\t\tconst layer = DApplications.getLayer(target);\n\t\tif (layer) {\n\t\t\tconst focusController = layer.getFocusController();\n\t\t\tconst focusable = focusController.find(target, false, false, true);\n\t\t\tlayer.view.focus();\n\t\t\tfocusController.focus(focusable);\n\t\t\te.preventDefault();\n\t\t\te.stopImmediatePropagation();\n\t\t}\n\t}\n\n\tprotected onElementFocus(e: FocusEvent): void {\n\t\tif (this.when === UtilHtmlElementWhen.ALWAYS) {\n\t\t\tconst target = this._target;\n\t\t\tif (!target.state.isFocused) {\n\t\t\t\ttarget.focus();\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected onEndByBlur(): void {\n\t\tthis.onEnd();\n\t}\n\n\tprotected onEnd(): void {\n\t\tthis._operation.onEnd();\n\t}\n\n\tend(): void {\n\t\tthis.onEnd();\n\t\tthis.cancel();\n\t}\n\n\tselect(): this {\n\t\tif (this._isElementShown && this._data.select) {\n\t\t\tthis.doSelect();\n\t\t}\n\t\treturn this;\n\t}\n\n\tprotected toClipperRectAdjusted(\n\t\telementRect: Rectangle | null,\n\t\telementMatrix: Matrix | null,\n\t\tclipperRect: Rectangle | null\n\t): Rectangle | null {\n\t\tif (clipperRect && elementRect && elementMatrix == null) {\n\t\t\tconst ex0 = elementRect.x;\n\t\t\tconst ey0 = elementRect.y;\n\t\t\tconst ex1 = ex0 + elementRect.width;\n\t\t\tconst ey1 = ey0 + elementRect.height;\n\t\t\tconst cx0 = clipperRect.x;\n\t\t\tconst cy0 = clipperRect.y;\n\t\t\tconst cx1 = cx0 + clipperRect.width;\n\t\t\tconst cy1 = cy0 + clipperRect.height;\n\t\t\tconst ncx0 = Math.min(Math.max(cx0, ex0), cx1);\n\t\t\tconst ncx1 = Math.min(Math.max(cx0, ex1), cx1);\n\t\t\tconst ncy0 = Math.min(Math.max(cy0, ey0), cy1);\n\t\t\tconst ncy1 = Math.min(Math.max(cy0, ey1), cy1);\n\t\t\tclipperRect.x = ncx0;\n\t\t\tclipperRect.y = ncy0;\n\t\t\tclipperRect.width = ncx1 - ncx0;\n\t\t\tclipperRect.height = ncy1 - ncy0;\n\t\t}\n\t\treturn clipperRect;\n\t}\n\n\tprotected updateElement(renderer: Renderer): void {\n\t\tif (this._isElementShown) {\n\t\t\tconst target = this._target;\n\t\t\tif (target.worldVisible) {\n\t\t\t\tconst element = this._element;\n\t\t\t\tconst clipper = this._clipper;\n\t\t\t\tif (element && clipper) {\n\t\t\t\t\tconst resolution = renderer.resolution;\n\t\t\t\t\tconst elementRect = this.getElementRect(resolution);\n\t\t\t\t\tconst elementMatrix = this.getElementMatrix();\n\t\t\t\t\tconst clipperRect = this.toClipperRectAdjusted(\n\t\t\t\t\t\telementRect,\n\t\t\t\t\t\telementMatrix,\n\t\t\t\t\t\tthis.getClipperRect(resolution)\n\t\t\t\t\t);\n\t\t\t\t\tconst state = target.state;\n\t\t\t\t\tconst padding = this._operation.getPadding();\n\t\t\t\t\tconst options = this._data;\n\t\t\t\t\toptions.clipper.styler(\n\t\t\t\t\t\tclipper,\n\t\t\t\t\t\tstate,\n\t\t\t\t\t\tpadding,\n\t\t\t\t\t\telementRect,\n\t\t\t\t\t\telementMatrix,\n\t\t\t\t\t\tclipperRect\n\t\t\t\t\t);\n\t\t\t\t\toptions.element.styler(\n\t\t\t\t\t\telement,\n\t\t\t\t\t\tstate,\n\t\t\t\t\t\tpadding,\n\t\t\t\t\t\telementRect,\n\t\t\t\t\t\telementMatrix,\n\t\t\t\t\t\tclipperRect\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tswitch (this.when) {\n\t\t\t\t\tcase UtilHtmlElementWhen.ALWAYS:\n\t\t\t\t\t\tconst clipper = this._clipper;\n\t\t\t\t\t\tif (clipper) {\n\t\t\t\t\t\t\tclipper.style.display = \"none\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tthis.cancel();\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic getClipperRect(\n\t\tparent: unknown,\n\t\ttarget: unknown,\n\t\tresolution: number,\n\t\tpoint: Point,\n\t\tresult: Rectangle\n\t): Rectangle | null {\n\t\tlet isFirst = true;\n\n\t\tlet x0 = 0;\n\t\tlet y0 = 0;\n\t\tlet x1 = 0;\n\t\tlet y1 = 0;\n\n\t\tlet current = parent;\n\t\twhile (current instanceof DBase) {\n\t\t\tcurrent.getClippingRect(target, result);\n\n\t\t\tpoint.set(result.x, result.y);\n\t\t\tcurrent.toGlobal(point, point, false);\n\t\t\tconst cx0 = ((point.x * resolution) | 0) / resolution;\n\t\t\tconst cy0 = ((point.y * resolution) | 0) / resolution;\n\n\t\t\tpoint.set(result.x + result.width, result.y + result.height);\n\t\t\tcurrent.toGlobal(point, point, true);\n\t\t\tconst cx1 = point.x;\n\t\t\tconst cy1 = point.y;\n\n\t\t\tconst dx0 = Math.min(cx0, cx1);\n\t\t\tconst dy0 = Math.min(cy0, cy1);\n\t\t\tconst dx1 = Math.max(cx0, cx1);\n\t\t\tconst dy1 = Math.max(cy0, cy1);\n\n\t\t\tif (isFirst) {\n\t\t\t\tisFirst = false;\n\t\t\t\tx0 = dx0;\n\t\t\t\ty0 = dy0;\n\t\t\t\tx1 = dx1;\n\t\t\t\ty1 = dy1;\n\t\t\t} else {\n\t\t\t\tx0 = Math.min(Math.max(x0, dx0), dx1);\n\t\t\t\ty0 = Math.min(Math.max(y0, dy0), dy1);\n\t\t\t\tx1 = Math.min(Math.max(x1, dx0), dx1);\n\t\t\t\ty1 = Math.min(Math.max(y1, dy0), dy1);\n\t\t\t}\n\n\t\t\tcurrent = current.parent;\n\t\t}\n\n\t\tif (isFirst) {\n\t\t\treturn null;\n\t\t}\n\n\t\tresult.x = x0;\n\t\tresult.y = y0;\n\t\tresult.width = x1 - x0;\n\t\tresult.height = y1 - y0;\n\t\treturn result;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction, Matrix, Point, Rectangle, Renderer } from \"pixi.js\";\nimport InteractionEvent = interaction.InteractionEvent;\nimport InteractionManager = interaction.InteractionManager;\nimport { DThemes } from \"../../theme/d-themes\";\nimport {\n\tUtilHtmlElement,\n\tUtilHtmlElementCreator,\n\tUtilHtmlElementOperation,\n\tUtilHtmlElementOptions,\n\tUtilHtmlElementPadding\n} from \"../../util/util-html-element\";\nimport { UtilHtmlElementWhen } from \"../../util/util-html-element-when\";\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime } from \"../e-shape-runtime\";\nimport { EShapeActionExpression } from \"./e-shape-action-expression\";\nimport { EShapeActionExpressions } from \"./e-shape-action-expressions\";\nimport { EShapeActionRuntime } from \"./e-shape-action-runtime\";\nimport { EShapeActionRuntimes } from \"./e-shape-action-runtimes\";\nimport { EShapeActionValueMisc } from \"./e-shape-action-value-misc\";\n\nexport abstract class EShapeActionRuntimeMiscHtmlElementBase<\n\tELEMENT extends HTMLElement = HTMLElement,\n\tUTIL extends UtilHtmlElement<ELEMENT> = UtilHtmlElement<ELEMENT>\n> extends EShapeActionRuntime {\n\tprotected static WORK?: Point;\n\tprotected readonly condition: EShapeActionExpression<string | null>;\n\tprotected utils: Map<EShape, UTIL>;\n\n\tconstructor(value: EShapeActionValueMisc) {\n\t\tsuper();\n\t\tthis.condition = EShapeActionExpressions.ofString(value.condition);\n\t\tthis.utils = new Map<EShape, UTIL>();\n\t}\n\n\tprotected getUtil(shape: EShape, runtime: EShapeRuntime): UTIL {\n\t\tconst utils = this.utils;\n\t\tlet result = utils.get(shape);\n\t\tif (result == null) {\n\t\t\tresult = this.newUtil(shape, runtime);\n\t\t\tutils.set(shape, result);\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected newUtil(shape: EShape, runtime: EShapeRuntime): UTIL {\n\t\treturn new UtilHtmlElement<ELEMENT>(\n\t\t\tshape,\n\t\t\tthis.newOperation(shape, runtime),\n\t\t\tDThemes.getInstance().get(\"DHtmlElement\"),\n\t\t\tthis.newUtilOptions(shape, runtime)\n\t\t) as any;\n\t}\n\n\tprotected newOperation(\n\t\tshape: EShape,\n\t\truntime: EShapeRuntime\n\t): UtilHtmlElementOperation<ELEMENT> {\n\t\treturn {\n\t\t\tgetElementRect: (\n\t\t\t\tresolution: number,\n\t\t\t\twork: Point,\n\t\t\t\tresult: Rectangle\n\t\t\t): Rectangle | null => {\n\t\t\t\treturn this.getElementRect(shape, runtime, resolution, work, result);\n\t\t\t},\n\n\t\t\tgetElementMatrix: (): Matrix | null => {\n\t\t\t\treturn this.getElementMatrix(shape, runtime);\n\t\t\t},\n\n\t\t\tgetClipperRect: (\n\t\t\t\tresolution: number,\n\t\t\t\twork: Point,\n\t\t\t\tresult: Rectangle\n\t\t\t): Rectangle | null => {\n\t\t\t\treturn this.getClipperToRect(shape, runtime, resolution, work, result);\n\t\t\t},\n\n\t\t\tgetPadding: (): UtilHtmlElementPadding | null => {\n\t\t\t\treturn this.getPadding(shape, runtime);\n\t\t\t},\n\n\t\t\tcontainsPoint: (point: Point): boolean => {\n\t\t\t\treturn this.containsPoint(shape, runtime, point);\n\t\t\t},\n\n\t\t\tonStart: (): void => {\n\t\t\t\t// DO NOTHING\n\t\t\t},\n\n\t\t\tonCancel: (): void => {\n\t\t\t\t// DO NOTHING\n\t\t\t},\n\n\t\t\tonEnd: (): void => {\n\t\t\t\t// DO NOTHING\n\t\t\t}\n\t\t};\n\t}\n\n\tprotected newUtilOptions(\n\t\tshape: EShape,\n\t\truntime: EShapeRuntime\n\t): UtilHtmlElementOptions<ELEMENT> {\n\t\treturn {\n\t\t\telement: {\n\t\t\t\tcreator: this.newElementCreator(shape, runtime)\n\t\t\t},\n\t\t\twhen: this.toWhen(shape, runtime)\n\t\t};\n\t}\n\n\tprotected abstract newElementCreator(\n\t\tshape: EShape,\n\t\truntime: EShapeRuntime\n\t): UtilHtmlElementCreator<ELEMENT> | undefined;\n\n\tprotected toWhen(shape: EShape, runtime: EShapeRuntime): UtilHtmlElementWhen | undefined {\n\t\tconst value = this.condition(shape, Date.now());\n\t\tif (value != null && value in UtilHtmlElementWhen) {\n\t\t\treturn UtilHtmlElementWhen[value as keyof typeof UtilHtmlElementWhen];\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprotected containsPoint(shape: EShape, runtime: EShapeRuntime, point: Point): boolean {\n\t\tif (shape.visible) {\n\t\t\tconst local = EShapeActionRuntimeMiscHtmlElementBase.WORK || new Point();\n\t\t\tEShapeActionRuntimeMiscHtmlElementBase.WORK = local;\n\t\t\tshape.toLocal(point, undefined, local);\n\t\t\treturn shape.contains(local.x, local.y) != null;\n\t\t}\n\t\treturn false;\n\t}\n\n\tprotected getPadding(shape: EShape, runtime: EShapeRuntime): UtilHtmlElementPadding | null {\n\t\treturn null;\n\t}\n\n\tprotected getElementRect(\n\t\tshape: EShape,\n\t\truntime: EShapeRuntime,\n\t\tresolution: number,\n\t\tpoint: Point,\n\t\tresult: Rectangle\n\t): Rectangle | null {\n\t\tconst pivot = shape.transform.pivot;\n\t\tconst size = shape.size;\n\t\tconst sizeX = size.x;\n\t\tconst sizeY = size.y;\n\t\tresult.x = -0.5 * sizeX + pivot.x;\n\t\tresult.y = -0.5 * sizeY + pivot.y;\n\t\tresult.width = sizeX;\n\t\tresult.height = sizeY;\n\t\treturn result;\n\t}\n\n\tprotected getElementMatrix(shape: EShape, runtime: EShapeRuntime): Matrix | null {\n\t\tshape.updateTransform();\n\t\treturn shape.transform.worldTransform;\n\t}\n\n\tprotected getClipperToRect(\n\t\tshape: EShape,\n\t\truntime: EShapeRuntime,\n\t\tresolution: number,\n\t\tpoint: Point,\n\t\tresult: Rectangle\n\t): Rectangle | null {\n\t\tconst container = EShapeActionRuntimes.toContainer(shape);\n\t\treturn UtilHtmlElement.getClipperRect(container, shape, resolution, point, result);\n\t}\n\n\tonRender(shape: EShape, runtime: EShapeRuntime, time: number, renderer: Renderer): void {\n\t\tthis.getUtil(shape, runtime).onRender(renderer);\n\t}\n\n\tonFocus(shape: EShape, runtime: EShapeRuntime): void {\n\t\tthis.getUtil(shape, runtime).onFocus();\n\t}\n\n\tonBlur(shape: EShape, runtime: EShapeRuntime): void {\n\t\tthis.getUtil(shape, runtime).onBlur();\n\t}\n\n\tonDowning(shape: EShape, runtime: EShapeRuntime, e: InteractionEvent | KeyboardEvent): void {\n\t\tthis.getUtil(shape, runtime).onDowning(e);\n\t}\n\n\tonDown(shape: EShape, runtime: EShapeRuntime, e: InteractionEvent | KeyboardEvent): void {\n\t\tthis.getUtil(shape, runtime).onDown(e);\n\t}\n\n\tonDblClick(\n\t\tshape: EShape,\n\t\truntime: EShapeRuntime,\n\t\te: MouseEvent | TouchEvent,\n\t\tinteractionManager: InteractionManager\n\t): void {\n\t\tthis.getUtil(shape, runtime).onDblClick(e, interactionManager);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const EShapeActionValueMiscType = {\n\tINPUT_TEXT: 0,\n\tINPUT_INTEGER: 1,\n\tINPUT_REAL: 2,\n\tEMIT_EVENT: 3,\n\tWRITE_BOTH: 4,\n\tWRITE_LOCAL: 5,\n\tWRITE_REMOTE: 6,\n\tHTML_ELEMENT: 7,\n\tHTML_ELEMENT_WITHOUT_POINTER_EVENTS: 8,\n\tLAYER_SHOW_HIDE: 9,\n\tLAYER_GESTURE: 10,\n\tGESTURE: 11\n} as const;\n\nexport type EShapeActionValueMiscType =\n\ttypeof EShapeActionValueMiscType[keyof typeof EShapeActionValueMiscType];\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DHtmlElementState } from \"../../d-html-element-state\";\nimport { UtilHtmlElement, UtilHtmlElementCreator } from \"../../util/util-html-element\";\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime } from \"../e-shape-runtime\";\nimport { EShapeActionExpressionWithParameter } from \"./e-shape-action-expression\";\nimport { EShapeActionExpressions } from \"./e-shape-action-expressions\";\nimport { EShapeActionRuntimeMiscHtmlElementBase } from \"./e-shape-action-runtime-misc-html-element-base\";\nimport { EShapeActionValueMisc } from \"./e-shape-action-value-misc\";\nimport { EShapeActionValueMiscType } from \"./e-shape-action-value-misc-type\";\n\nexport class EShapeActionRuntimeMiscHtmlElement<\n\tELEMENT extends HTMLElement = HTMLElement,\n\tUTIL extends UtilHtmlElement<ELEMENT> = UtilHtmlElement<ELEMENT>\n> extends EShapeActionRuntimeMiscHtmlElementBase<ELEMENT, UTIL> {\n\tprotected elementCreator?: EShapeActionExpressionWithParameter<ELEMENT | null, HTMLElement>;\n\tprotected noPointerEvent: boolean;\n\n\tconstructor(value: EShapeActionValueMisc) {\n\t\tsuper(value);\n\t\tthis.elementCreator = EShapeActionExpressions.ofElementOrNull(value.value);\n\t\tthis.noPointerEvent =\n\t\t\tvalue.subtype === EShapeActionValueMiscType.HTML_ELEMENT_WITHOUT_POINTER_EVENTS;\n\t}\n\n\tprotected newUtil(shape: EShape, runtime: EShapeRuntime): UTIL {\n\t\tif (this.noPointerEvent) {\n\t\t\tshape.state.add(DHtmlElementState.NO_POINTER_EVENTS);\n\t\t}\n\t\treturn super.newUtil(shape, runtime);\n\t}\n\n\tprotected newElementCreator(\n\t\tshape: EShape,\n\t\truntime: EShapeRuntime\n\t): UtilHtmlElementCreator<ELEMENT> | undefined {\n\t\tconst elementCreator = this.elementCreator;\n\t\tif (elementCreator) {\n\t\t\treturn (container: HTMLElement): ELEMENT | null => {\n\t\t\t\treturn elementCreator(shape, Date.now(), container);\n\t\t\t};\n\t\t}\n\t\treturn undefined;\n\t}\n}\n","/*\n * Copyright (C) 2021 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DApplications } from \"../d-applications\";\nimport { isString } from \"./is-string\";\nimport {\n\tUtilHtmlElement,\n\tUtilHtmlElementOperation,\n\tUtilHtmlElementOptions,\n\tUtilHtmlElementTarget,\n\tUtilThemeHtmlElement\n} from \"./util-html-element\";\nimport { UtilKeyboardEvent } from \"./util-keyboard-event\";\n\nexport interface UtilInputTarget extends UtilHtmlElementTarget {}\n\nexport interface UtilInputOperation<VALUE, ELEMENT extends HTMLInputElement | HTMLTextAreaElement>\n\textends UtilHtmlElementOperation<ELEMENT> {\n\tgetValue(): VALUE | undefined;\n\tapplyTitle(): void;\n\n\tonValueInput(newValue: VALUE): void;\n\tonValueChange(newValue: VALUE, oldValue: VALUE): void;\n\tonEnter(): void;\n}\n\nexport interface UtilInputEditingOptions<VALUE = unknown> {\n\tformatter?: (value: VALUE) => string;\n\tunformatter?: (text: string) => VALUE;\n\tvalidator?: (value: VALUE) => string | null;\n}\n\nexport interface UtilInputOptions<VALUE, ELEMENT extends HTMLInputElement | HTMLTextAreaElement>\n\textends UtilHtmlElementOptions<ELEMENT> {\n\tdescription?: string;\n\tediting?: UtilInputEditingOptions<VALUE>;\n}\n\nexport interface UtilThemeInput<VALUE, ELEMENT extends HTMLInputElement | HTMLTextAreaElement>\n\textends UtilThemeHtmlElement<ELEMENT> {\n\tgetEditingFormatter(): (value: VALUE, caller: any) => string;\n\tgetEditingUnformatter(): (text: string, caller: any) => VALUE;\n\tgetEditingValidator(): (value: VALUE, caller: any) => string | null;\n}\n\nexport abstract class UtilInput<\n\tVALUE = unknown,\n\tELEMENT extends HTMLInputElement | HTMLTextAreaElement = HTMLInputElement | HTMLTextAreaElement,\n\tTARGET extends UtilInputTarget = UtilInputTarget,\n\tOPERATION extends UtilInputOperation<VALUE, ELEMENT> = UtilInputOperation<VALUE, ELEMENT>,\n\tTHEME extends UtilThemeInput<VALUE, ELEMENT> = UtilThemeInput<VALUE, ELEMENT>,\n\tOPTIONS extends UtilInputOptions<VALUE, ELEMENT> = UtilInputOptions<VALUE, ELEMENT>\n> extends UtilHtmlElement<ELEMENT, TARGET, OPERATION, THEME, OPTIONS> {\n\tprotected _onInputKeyDownBound: (e: KeyboardEvent) => void;\n\tprotected _onInputChangeBound: (e: Event) => void;\n\tprotected _onInputInputBound: (e: Event) => void;\n\n\tprotected _description: string;\n\n\tprotected _editingFormatter: (value: VALUE, caller: any) => string;\n\tprotected _editingUnformatter: (text: string, caller: any) => VALUE;\n\tprotected _editingValidator: (value: VALUE, caller: any) => string | null;\n\tprotected _editingValidationResult?: string | null;\n\n\tconstructor(target: TARGET, operation: OPERATION, theme: THEME, options?: OPTIONS) {\n\t\tsuper(target, operation, theme, options);\n\n\t\tthis._operation = operation;\n\n\t\tthis._onInputKeyDownBound = (e: KeyboardEvent): void => {\n\t\t\tthis.onInputKeyDown(e);\n\t\t};\n\t\tthis._onInputChangeBound = (): void => {\n\t\t\tthis.onInputChange();\n\t\t};\n\t\tthis._onInputInputBound = (e: Event): void => {\n\t\t\tthis.onInputInput(e);\n\t\t};\n\n\t\tthis._description = options?.description ?? \"\";\n\n\t\tconst editing = options?.editing;\n\t\tthis._editingFormatter =\n\t\t\tediting?.formatter ?? (options as any)?.text?.formatter ?? theme.getEditingFormatter();\n\t\tthis._editingUnformatter = editing?.unformatter ?? theme.getEditingUnformatter();\n\t\tthis._editingValidator = editing?.validator ?? theme.getEditingValidator();\n\t}\n\n\tprotected onEnd(): void {\n\t\tsuper.onEnd();\n\t\tthis.onInputChange();\n\t}\n\n\tprotected onElementAttached(\n\t\telement: ELEMENT,\n\t\tbefore?: HTMLDivElement | null,\n\t\tafter?: HTMLDivElement | null\n\t): void {\n\t\telement.value = this.fromValue(this._operation.getValue());\n\t\telement.addEventListener(\"change\", this._onInputChangeBound);\n\t\telement.addEventListener(\"input\", this._onInputInputBound);\n\t\tsuper.onElementAttached(element, before, after);\n\t}\n\n\tprotected onElementDetached(\n\t\telement: ELEMENT,\n\t\tbefore?: HTMLDivElement | null,\n\t\tafter?: HTMLDivElement | null\n\t): void {\n\t\tsuper.onElementDetached(element, before, after);\n\t\telement.removeEventListener(\"change\", this._onInputChangeBound);\n\t\telement.removeEventListener(\"input\", this._onInputInputBound);\n\t}\n\n\tprotected onInputKeyDown(e: KeyboardEvent): void {\n\t\tif (UtilKeyboardEvent.isOkKey(e)) {\n\t\t\tthis.end();\n\t\t\tthis._operation.onEnter();\n\t\t} else if (UtilKeyboardEvent.isCancelKey(e)) {\n\t\t\tthis.cancel();\n\t\t}\n\t}\n\n\tprotected toElementFocused(element: ELEMENT): void {\n\t\tsuper.toElementFocused(element);\n\t\telement.scrollTop = 0;\n\t\telement.scrollLeft = 0;\n\t}\n\n\tprotected onInputChange(): void {\n\t\tif (this.isShown()) {\n\t\t\tconst element = this.element;\n\t\t\tif (element != null) {\n\t\t\t\tconst operation = this._operation;\n\t\t\t\tconst newValue = this.toValue(element.value);\n\t\t\t\tconst oldValue = operation.getValue()!;\n\t\t\t\tif (oldValue !== newValue) {\n\t\t\t\t\toperation.onValueChange(newValue, oldValue);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\ttoValue(valueAsString: string): VALUE {\n\t\treturn this._editingUnformatter(valueAsString, this);\n\t}\n\n\tfromValue(value: VALUE | undefined): string {\n\t\tif (value !== undefined) {\n\t\t\treturn this._editingFormatter(value, this);\n\t\t}\n\t\treturn \"\";\n\t}\n\n\tprotected onInputInput(e: Event): void {\n\t\tconst target = e.target;\n\t\tif (target instanceof HTMLInputElement) {\n\t\t\tthis._operation.onValueInput(this.toValue(target.value));\n\t\t}\n\t}\n\n\tvalidate(): string | null {\n\t\tconst value = this._operation.getValue();\n\t\tif (value !== undefined) {\n\t\t\tconst result = this._editingValidator(value, this);\n\t\t\tif (this._editingValidationResult !== result) {\n\t\t\t\tthis._editingValidationResult = result;\n\t\t\t\tconst state = this._target.state;\n\t\t\t\tstate.isInvalid = result != null;\n\t\t\t\tif (state.isHovered) {\n\t\t\t\t\tthis._operation.applyTitle();\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn result;\n\t\t}\n\t\treturn null;\n\t}\n\n\tapplyTitle(): boolean {\n\t\tconst editingValidationResult = this._editingValidationResult;\n\t\tif (isString(editingValidationResult)) {\n\t\t\tconst layer = DApplications.getLayer(this._target);\n\t\t\tif (layer) {\n\t\t\t\tlayer.view.title = editingValidationResult;\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n}\n","/*\n * Copyright (C) 2021 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {\n\tUtilInput,\n\tUtilInputOperation,\n\tUtilInputOptions,\n\tUtilInputTarget,\n\tUtilThemeInput\n} from \"./util-input\";\n\nexport interface UtilInputInputTarget extends UtilInputTarget {}\n\nexport interface UtilInputInputOperation<VALUE>\n\textends UtilInputOperation<VALUE, HTMLInputElement> {}\n\nexport interface UtilInputInputOptions<VALUE> extends UtilInputOptions<VALUE, HTMLInputElement> {}\n\nexport interface UtilThemeInputInput<VALUE> extends UtilThemeInput<VALUE, HTMLInputElement> {}\n\nexport class UtilInputInput<\n\tVALUE = unknown,\n\tTARGET extends UtilInputInputTarget = UtilInputInputTarget,\n\tOPERATION extends UtilInputInputOperation<VALUE> = UtilInputInputOperation<VALUE>,\n\tTHEME extends UtilThemeInputInput<VALUE> = UtilThemeInputInput<VALUE>,\n\tOPTIONS extends UtilInputInputOptions<VALUE> = UtilInputInputOptions<VALUE>\n> extends UtilInput<VALUE, HTMLInputElement, TARGET, OPERATION, THEME, OPTIONS> {\n\tprotected onElementAttached(\n\t\telement: HTMLInputElement,\n\t\tbefore?: HTMLDivElement | null,\n\t\tafter?: HTMLDivElement | null\n\t): void {\n\t\telement.addEventListener(\"keydown\", this._onInputKeyDownBound);\n\t\tsuper.onElementAttached(element, before, after);\n\t}\n\n\tprotected onElementDetached(\n\t\telement: HTMLInputElement,\n\t\tbefore?: HTMLDivElement | null,\n\t\tafter?: HTMLDivElement | null\n\t): void {\n\t\telement.removeEventListener(\"keydown\", this._onInputKeyDownBound);\n\t\tsuper.onElementDetached(element, before, after);\n\t}\n}\n","/*\n * Copyright (C) 2021 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {\n\tUtilInputInput,\n\tUtilInputInputOperation,\n\tUtilInputInputOptions,\n\tUtilInputInputTarget,\n\tUtilThemeInputInput\n} from \"./util-input-input\";\n\nexport interface UtilInputNumberTarget extends UtilInputInputTarget {}\n\nexport interface UtilInputNumberOperation extends UtilInputInputOperation<number> {}\n\nexport interface UtilInputNumberOptions extends UtilInputInputOptions<number> {\n\tstep?: number | null;\n\tmin?: number | null;\n\tmax?: number | null;\n}\n\nexport interface UtilThemeInputNumber extends UtilThemeInputInput<number> {\n\tgetStep(): number | null;\n\tgetMin(): number | null;\n\tgetMax(): number | null;\n}\n\nexport class UtilInputNumber<\n\tTARGET extends UtilInputNumberTarget = UtilInputNumberTarget,\n\tOPERATION extends UtilInputNumberOperation = UtilInputNumberOperation,\n\tTHEME extends UtilThemeInputNumber = UtilThemeInputNumber,\n\tOPTIONS extends UtilInputNumberOptions = UtilInputNumberOptions\n> extends UtilInputInput<number, TARGET, OPERATION, THEME, OPTIONS> {\n\tprotected _step: number | null;\n\tprotected _min: number | null;\n\tprotected _max: number | null;\n\n\tconstructor(target: TARGET, operation: OPERATION, theme: THEME, options?: OPTIONS) {\n\t\tsuper(target, operation, theme, options);\n\n\t\tthis._step = options?.step ?? theme.getStep();\n\t\tthis._min = options?.min ?? theme.getMin();\n\t\tthis._max = options?.max ?? theme.getMax();\n\t}\n\n\tget step(): number | null {\n\t\treturn this._step;\n\t}\n\n\tset step(step: number | null) {\n\t\tif (this._step !== step) {\n\t\t\tthis._step = step;\n\t\t\tthis.onStepChange();\n\t\t}\n\t}\n\n\tget min(): number | null {\n\t\treturn this._min;\n\t}\n\n\tset min(min: number | null) {\n\t\tif (this._min !== min) {\n\t\t\tthis._min = min;\n\t\t\tthis.onMinChange();\n\t\t}\n\t}\n\n\tget max(): number | null {\n\t\treturn this._max;\n\t}\n\n\tset max(max: number | null) {\n\t\tif (this._max !== max) {\n\t\t\tthis._max = max;\n\t\t\tthis.onMaxChange();\n\t\t}\n\t}\n\n\ttoValue(valueAsString: string): number {\n\t\tconst result = super.toValue(valueAsString);\n\t\tif (result === result /* NaN Check */) {\n\t\t\tconst min = this._min;\n\t\t\tif (min != null && result < min) {\n\t\t\t\treturn min;\n\t\t\t}\n\t\t\tconst max = this._max;\n\t\t\tif (max != null && max < result) {\n\t\t\t\treturn max;\n\t\t\t}\n\t\t\treturn result;\n\t\t}\n\t\treturn 0;\n\t}\n\n\tfromValue(value: number | undefined): string {\n\t\tif (value !== undefined) {\n\t\t\treturn this._editingFormatter(value, this);\n\t\t}\n\t\treturn \"0\";\n\t}\n\n\tprotected onStepChange(): void {\n\t\tif (this.isShown()) {\n\t\t\tconst element = this.element;\n\t\t\tif (element) {\n\t\t\t\tthis.updateStep(element);\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected onMinChange(): void {\n\t\tif (this.isShown()) {\n\t\t\tconst element = this.element;\n\t\t\tif (element) {\n\t\t\t\tthis.updateMin(element);\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected onMaxChange(): void {\n\t\tif (this.isShown()) {\n\t\t\tconst element = this.element;\n\t\t\tif (element) {\n\t\t\t\tthis.updateMax(element);\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected updateStep(input: HTMLInputElement): void {\n\t\tconst step = this.step;\n\t\tif (step != null) {\n\t\t\tinput.step = `${step}`;\n\t\t} else {\n\t\t\tinput.step = \"any\";\n\t\t}\n\t}\n\n\tprotected updateMin(input: HTMLInputElement): void {\n\t\tconst min = this.min;\n\t\tif (min != null) {\n\t\t\tinput.min = `${min}`;\n\t\t} else {\n\t\t\tinput.removeAttribute(\"min\");\n\t\t}\n\t}\n\n\tprotected updateMax(input: HTMLInputElement): void {\n\t\tconst max = this.max;\n\t\tif (max != null) {\n\t\t\tinput.max = `${max}`;\n\t\t} else {\n\t\t\tinput.removeAttribute(\"max\");\n\t\t}\n\t}\n\n\tprotected onElementAttached(\n\t\telement: HTMLInputElement,\n\t\tbefore?: HTMLDivElement | null,\n\t\tafter?: HTMLDivElement | null\n\t): void {\n\t\telement.type = \"number\";\n\t\tsuper.onElementAttached(element, before, after);\n\t\tthis.updateStep(element);\n\t\tthis.updateMin(element);\n\t\tthis.updateMax(element);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const EShapeActionValueOnInputAction = {\n\tEMIT_EVENT: 0,\n\tWRITE_BOTH: 1,\n\tWRITE_LOCAL: 2,\n\tWRITE_REMOTE: 3\n} as const;\n\nexport type EShapeActionValueOnInputAction =\n\ttypeof EShapeActionValueOnInputAction[keyof typeof EShapeActionValueOnInputAction];\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeActionRuntimes } from \"./e-shape-action-runtimes\";\nimport { EShapeActionValueOnInputAction } from \"./e-shape-action-value-on-input-action\";\n\nexport class EShapeActionValueOnInputActions {\n\tstatic execute<VALUE>(\n\t\tshape: EShape,\n\t\taction: EShapeActionValueOnInputAction,\n\t\ttarget: string,\n\t\tvalue: VALUE,\n\t\ttime: number\n\t): void {\n\t\tswitch (action) {\n\t\t\tcase EShapeActionValueOnInputAction.EMIT_EVENT:\n\t\t\t\tshape.emit(target, shape, value);\n\t\t\t\tEShapeActionRuntimes.emit(shape, target, value, time);\n\t\t\t\tbreak;\n\t\t\tcase EShapeActionValueOnInputAction.WRITE_LOCAL:\n\t\t\t\tEShapeActionRuntimes.write(shape, target, value, time, false);\n\t\t\t\tbreak;\n\t\t\tcase EShapeActionValueOnInputAction.WRITE_REMOTE:\n\t\t\t\tEShapeActionRuntimes.write(shape, target, value, time, true);\n\t\t\t\tbreak;\n\t\t\tcase EShapeActionValueOnInputAction.WRITE_BOTH:\n\t\t\t\tEShapeActionRuntimes.write(shape, target, value, time, false);\n\t\t\t\tEShapeActionRuntimes.write(shape, target, value, time, true);\n\t\t\t\tbreak;\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Matrix, Point, Rectangle } from \"pixi.js\";\nimport { UtilHtmlElementCreator, UtilHtmlElementPadding } from \"../../util/util-html-element\";\nimport { UtilInput, UtilInputOperation } from \"../../util/util-input\";\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime } from \"../e-shape-runtime\";\nimport { EShapeActionExpression } from \"./e-shape-action-expression\";\nimport { EShapeActionExpressions } from \"./e-shape-action-expressions\";\nimport { EShapeActionRuntimeMiscHtmlElementBase } from \"./e-shape-action-runtime-misc-html-element-base\";\nimport { EShapeActionValueMisc } from \"./e-shape-action-value-misc\";\nimport { EShapeActionValueOnInputAction } from \"./e-shape-action-value-on-input-action\";\nimport { EShapeActionValueOnInputActions } from \"./e-shape-action-value-on-input-actions\";\n\nexport abstract class EShapeActionRuntimeMiscInput<\n\tVALUE = unknown,\n\tELEMENT extends HTMLInputElement | HTMLTextAreaElement = HTMLInputElement | HTMLTextAreaElement,\n\tUTIL extends UtilInput<VALUE, ELEMENT> = UtilInput<VALUE, ELEMENT>\n> extends EShapeActionRuntimeMiscHtmlElementBase<ELEMENT, UTIL> {\n\tprotected readonly target: EShapeActionExpression<string | null>;\n\tprotected onInputAction: EShapeActionValueOnInputAction;\n\n\tconstructor(value: EShapeActionValueMisc) {\n\t\tsuper(value);\n\t\tthis.target = EShapeActionExpressions.ofStringOrNull(value.target);\n\t\tthis.onInputAction = value.onInputAction;\n\t}\n\n\tprotected newOperation(\n\t\tshape: EShape,\n\t\truntime: EShapeRuntime\n\t): UtilInputOperation<VALUE, ELEMENT> {\n\t\treturn {\n\t\t\tgetElementRect: (\n\t\t\t\tresolution: number,\n\t\t\t\twork: Point,\n\t\t\t\tresult: Rectangle\n\t\t\t): Rectangle | null => {\n\t\t\t\treturn this.getElementRect(shape, runtime, resolution, work, result);\n\t\t\t},\n\n\t\t\tgetElementMatrix: (): Matrix | null => {\n\t\t\t\treturn this.getElementMatrix(shape, runtime);\n\t\t\t},\n\n\t\t\tgetClipperRect: (\n\t\t\t\tresolution: number,\n\t\t\t\twork: Point,\n\t\t\t\tresult: Rectangle\n\t\t\t): Rectangle | null => {\n\t\t\t\treturn this.getClipperToRect(shape, runtime, resolution, work, result);\n\t\t\t},\n\n\t\t\tgetPadding: (): UtilHtmlElementPadding | null => {\n\t\t\t\treturn this.getPadding(shape, runtime);\n\t\t\t},\n\n\t\t\tcontainsPoint: (point: Point): boolean => {\n\t\t\t\treturn this.containsPoint(shape, runtime, point);\n\t\t\t},\n\n\t\t\tonStart: (): void => {\n\t\t\t\tshape.text.enable = false;\n\t\t\t},\n\n\t\t\tonCancel: (): void => {\n\t\t\t\tshape.text.enable = true;\n\t\t\t},\n\n\t\t\tonEnd: (): void => {\n\t\t\t\t// DO NOTHING\n\t\t\t},\n\n\t\t\tgetValue: (): VALUE | undefined => {\n\t\t\t\treturn this.getUtil(shape, runtime).toValue(shape.text.value);\n\t\t\t},\n\n\t\t\tonValueInput: (newValue: VALUE): void => {\n\t\t\t\t// DO NOTHING\n\t\t\t},\n\n\t\t\tonValueChange: (newValue: VALUE, oldValue: VALUE): void => {\n\t\t\t\tthis.onValueChange(shape, runtime, newValue, oldValue);\n\t\t\t},\n\n\t\t\tonEnter: (): void => {\n\t\t\t\t// DO NOTHING\n\t\t\t},\n\n\t\t\tapplyTitle: (): void => {\n\t\t\t\t// DO NOTHING\n\t\t\t}\n\t\t};\n\t}\n\n\tprotected newElementCreator(\n\t\tshape: EShape,\n\t\truntime: EShapeRuntime\n\t): UtilHtmlElementCreator<ELEMENT> | undefined {\n\t\treturn undefined;\n\t}\n\n\tprotected getPadding(shape: EShape, runtime: EShapeRuntime): UtilHtmlElementPadding | null {\n\t\treturn shape.text.padding;\n\t}\n\n\tprotected onValueChange(\n\t\tshape: EShape,\n\t\truntime: EShapeRuntime,\n\t\tnewValue: VALUE,\n\t\toldValue: VALUE\n\t): void {\n\t\tshape.text.value = this.getUtil(shape, runtime).fromValue(newValue);\n\t\tconst now = Date.now();\n\t\tconst target = this.target(shape, now);\n\t\tif (target != null) {\n\t\t\tEShapeActionValueOnInputActions.execute(\n\t\t\t\tshape,\n\t\t\t\tthis.onInputAction,\n\t\t\t\ttarget,\n\t\t\t\tnewValue,\n\t\t\t\tnow\n\t\t\t);\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { UtilInputInput } from \"../../util/util-input-input\";\nimport { EShapeActionRuntimeMiscInput } from \"./e-shape-action-runtime-misc-input\";\n\nexport abstract class EShapeActionRuntimeMiscInputInput<\n\tVALUE = unknown,\n\tUTIL extends UtilInputInput<VALUE> = UtilInputInput<VALUE>\n> extends EShapeActionRuntimeMiscInput<VALUE, HTMLInputElement, UTIL> {}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { UtilInputNumber } from \"../../util/util-input-number\";\nimport { EShapeActionRuntimeMiscInputInput } from \"./e-shape-action-runtime-misc-input-input\";\n\nexport class EShapeActionRuntimeMiscInputNumber extends EShapeActionRuntimeMiscInputInput<\n\tnumber,\n\tUtilInputNumber\n> {}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DThemeInputInteger } from \"../../d-input-integer\";\nimport { DThemes } from \"../../theme/d-themes\";\nimport { UtilInputNumber } from \"../../util/util-input-number\";\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime } from \"../e-shape-runtime\";\nimport { EShapeActionRuntimeMiscInputNumber } from \"./e-shape-action-runtime-misc-input-number\";\n\nexport class EShapeActionRuntimeMiscInputInteger extends EShapeActionRuntimeMiscInputNumber {\n\tprotected newUtil(shape: EShape, runtime: EShapeRuntime): UtilInputNumber {\n\t\treturn new UtilInputNumber(\n\t\t\tshape,\n\t\t\tthis.newOperation(shape, runtime),\n\t\t\tDThemes.getInstance().get<DThemeInputInteger>(\"DInputInteger\"),\n\t\t\tthis.newUtilOptions(shape, runtime)\n\t\t);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DThemeInputReal } from \"../../d-input-real\";\nimport { DThemes } from \"../../theme/d-themes\";\nimport { UtilInputNumber } from \"../../util/util-input-number\";\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime } from \"../e-shape-runtime\";\nimport { EShapeActionRuntimeMiscInputNumber } from \"./e-shape-action-runtime-misc-input-number\";\n\nexport class EShapeActionRuntimeMiscInputReal extends EShapeActionRuntimeMiscInputNumber {\n\tprotected newUtil(shape: EShape, runtime: EShapeRuntime): UtilInputNumber {\n\t\treturn new UtilInputNumber(\n\t\t\tshape,\n\t\t\tthis.newOperation(shape, runtime),\n\t\t\tDThemes.getInstance().get<DThemeInputReal>(\"DInputReal\"),\n\t\t\tthis.newUtilOptions(shape, runtime)\n\t\t);\n\t}\n}\n","/*\n * Copyright (C) 2021 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {\n\tUtilInputInput,\n\tUtilInputInputOperation,\n\tUtilInputInputOptions,\n\tUtilInputInputTarget,\n\tUtilThemeInputInput\n} from \"./util-input-input\";\n\nexport interface UtilInputTextTarget extends UtilInputInputTarget {}\n\nexport interface UtilInputTextOperation extends UtilInputInputOperation<string> {}\n\nexport interface UtilInputTextOptions extends UtilInputInputOptions<string> {}\n\nexport interface UtilThemeInputText extends UtilThemeInputInput<string> {}\n\nexport class UtilInputText<\n\tTARGET extends UtilInputTextTarget = UtilInputTextTarget,\n\tOPERATION extends UtilInputTextOperation = UtilInputTextOperation,\n\tTHEME extends UtilThemeInputText = UtilThemeInputText,\n\tOPTIONS extends UtilInputTextOptions = UtilInputTextOptions\n> extends UtilInputInput<string, TARGET, OPERATION, THEME, OPTIONS> {\n\tprotected onElementAttached(\n\t\telement: HTMLInputElement,\n\t\tbefore?: HTMLDivElement | null,\n\t\tafter?: HTMLDivElement | null\n\t): void {\n\t\telement.type = \"text\";\n\t\tsuper.onElementAttached(element, before, after);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DThemeInputText } from \"../../d-input-text\";\nimport { DThemes } from \"../../theme/d-themes\";\nimport { UtilInputText } from \"../../util/util-input-text\";\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime } from \"../e-shape-runtime\";\nimport { EShapeActionRuntimeMiscInputInput } from \"./e-shape-action-runtime-misc-input-input\";\n\nexport class EShapeActionRuntimeMiscInputText extends EShapeActionRuntimeMiscInputInput<\n\tstring,\n\tUtilInputText\n> {\n\tprotected newUtil(shape: EShape, runtime: EShapeRuntime): UtilInputText {\n\t\treturn new UtilInputText(\n\t\t\tshape,\n\t\t\tthis.newOperation(shape, runtime),\n\t\t\tDThemes.getInstance().get<DThemeInputText>(\"DInputText\"),\n\t\t\tthis.newUtilOptions(shape, runtime)\n\t\t);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\nimport { EShapeActionExpression } from \"./e-shape-action-expression\";\nimport { EShapeActionExpressions } from \"./e-shape-action-expressions\";\nimport { EShapeActionRuntimeConditional } from \"./e-shape-action-runtime-conditional\";\nimport { EShapeActionValueMisc } from \"./e-shape-action-value-misc\";\n\nexport abstract class EShapeActionRuntimeMiscWrite extends EShapeActionRuntimeConditional {\n\tprotected target: EShapeActionExpression<string | null>;\n\tprotected value: EShapeActionExpression<unknown>;\n\n\tconstructor(value: EShapeActionValueMisc) {\n\t\tsuper(value, EShapeRuntimeReset.NONE);\n\t\tthis.target = EShapeActionExpressions.ofStringOrNull(value.target);\n\t\tthis.value = EShapeActionExpressions.ofUnknown(value.value);\n\t}\n\n\texecute(shape: EShape, runtime: EShapeRuntime, time: number): void {\n\t\tif (this.condition(shape, time)) {\n\t\t\tconst target = this.target(shape, time);\n\t\t\tif (target != null) {\n\t\t\t\tthis.write(shape, target, this.value(shape, time), time);\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected abstract write(shape: EShape, target: string, value: unknown, time: number): void;\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeActionRuntimeMiscWrite } from \"./e-shape-action-runtime-misc-write\";\nimport { EShapeActionRuntimes } from \"./e-shape-action-runtimes\";\n\nexport class EShapeActionRuntimeMiscWriteBoth extends EShapeActionRuntimeMiscWrite {\n\tprotected write(shape: EShape, target: string, value: unknown, time: number): void {\n\t\tEShapeActionRuntimes.write(shape, target, value, time, false);\n\t\tEShapeActionRuntimes.write(shape, target, value, time, true);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeActionRuntimeMiscWrite } from \"./e-shape-action-runtime-misc-write\";\nimport { EShapeActionRuntimes } from \"./e-shape-action-runtimes\";\n\nexport class EShapeActionRuntimeMiscWriteLocal extends EShapeActionRuntimeMiscWrite {\n\tprotected write(shape: EShape, target: string, value: unknown, time: number): void {\n\t\tEShapeActionRuntimes.write(shape, target, value, time, false);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeActionRuntimeMiscWrite } from \"./e-shape-action-runtime-misc-write\";\nimport { EShapeActionRuntimes } from \"./e-shape-action-runtimes\";\n\nexport class EShapeActionRuntimeMiscWriteRemote extends EShapeActionRuntimeMiscWrite {\n\tprotected write(shape: EShape, target: string, value: unknown, time: number): void {\n\t\tEShapeActionRuntimes.write(shape, target, value, time, true);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShapeActionRuntime } from \"./e-shape-action-runtime\";\nimport { EShapeActionRuntimeMiscEmitEvent } from \"./e-shape-action-runtime-misc-emit-event\";\nimport { EShapeActionRuntimeMiscHtmlElement } from \"./e-shape-action-runtime-misc-html-element\";\nimport { EShapeActionRuntimeMiscInputInteger } from \"./e-shape-action-runtime-misc-input-integer\";\nimport { EShapeActionRuntimeMiscInputReal } from \"./e-shape-action-runtime-misc-input-real\";\nimport { EShapeActionRuntimeMiscInputText } from \"./e-shape-action-runtime-misc-input-text\";\nimport { EShapeActionRuntimeMiscWriteBoth } from \"./e-shape-action-runtime-misc-write-both\";\nimport { EShapeActionRuntimeMiscWriteLocal } from \"./e-shape-action-runtime-misc-write-local\";\nimport { EShapeActionRuntimeMiscWriteRemote } from \"./e-shape-action-runtime-misc-write-remote\";\nimport { EShapeActionValueMiscType } from \"./e-shape-action-value-misc-type\";\nimport { EShapeActionValueOnInputAction } from \"./e-shape-action-value-on-input-action\";\nimport { EShapeActionValueSubtyped } from \"./e-shape-action-value-subtyped\";\nimport { EShapeActionValueType } from \"./e-shape-action-value-type\";\nimport { EShapeActionValues } from \"./e-shape-action-values\";\n\nexport type EShapeActionValueMiscSubtype =\n\t| typeof EShapeActionValueMiscType.INPUT_TEXT\n\t| typeof EShapeActionValueMiscType.INPUT_INTEGER\n\t| typeof EShapeActionValueMiscType.INPUT_REAL\n\t| typeof EShapeActionValueMiscType.EMIT_EVENT\n\t| typeof EShapeActionValueMiscType.WRITE_BOTH\n\t| typeof EShapeActionValueMiscType.WRITE_LOCAL\n\t| typeof EShapeActionValueMiscType.WRITE_REMOTE\n\t| typeof EShapeActionValueMiscType.HTML_ELEMENT\n\t| typeof EShapeActionValueMiscType.HTML_ELEMENT_WITHOUT_POINTER_EVENTS;\n\nexport type EShapeActionValueMiscSerialized = [\n\ttypeof EShapeActionValueType.MISC,\n\tnumber,\n\tEShapeActionValueMiscSubtype,\n\tnumber,\n\tEShapeActionValueOnInputAction,\n\tnumber\n];\n\nexport class EShapeActionValueMisc extends EShapeActionValueSubtyped<EShapeActionValueMiscSubtype> {\n\treadonly target: string;\n\treadonly onInputAction: EShapeActionValueOnInputAction;\n\treadonly value: string;\n\n\tconstructor(\n\t\tsubtype: EShapeActionValueMiscSubtype,\n\t\tcondition: string,\n\t\ttarget: string,\n\t\tonInputAction: EShapeActionValueOnInputAction,\n\t\tvalue: string\n\t) {\n\t\tsuper(EShapeActionValueType.MISC, condition, subtype);\n\t\tthis.target = target;\n\t\tthis.onInputAction = onInputAction;\n\t\tthis.value = value;\n\t}\n\n\ttoRuntime(): EShapeActionRuntime {\n\t\tswitch (this.subtype) {\n\t\t\tcase EShapeActionValueMiscType.INPUT_TEXT:\n\t\t\t\treturn new EShapeActionRuntimeMiscInputText(this);\n\t\t\tcase EShapeActionValueMiscType.INPUT_INTEGER:\n\t\t\t\treturn new EShapeActionRuntimeMiscInputInteger(this);\n\t\t\tcase EShapeActionValueMiscType.INPUT_REAL:\n\t\t\t\treturn new EShapeActionRuntimeMiscInputReal(this);\n\t\t\tcase EShapeActionValueMiscType.EMIT_EVENT:\n\t\t\t\treturn new EShapeActionRuntimeMiscEmitEvent(this);\n\t\t\tcase EShapeActionValueMiscType.WRITE_BOTH:\n\t\t\t\treturn new EShapeActionRuntimeMiscWriteBoth(this);\n\t\t\tcase EShapeActionValueMiscType.WRITE_LOCAL:\n\t\t\t\treturn new EShapeActionRuntimeMiscWriteLocal(this);\n\t\t\tcase EShapeActionValueMiscType.WRITE_REMOTE:\n\t\t\t\treturn new EShapeActionRuntimeMiscWriteRemote(this);\n\t\t\tcase EShapeActionValueMiscType.HTML_ELEMENT:\n\t\t\tcase EShapeActionValueMiscType.HTML_ELEMENT_WITHOUT_POINTER_EVENTS:\n\t\t\t\treturn new EShapeActionRuntimeMiscHtmlElement(this);\n\t\t}\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\tconst conditionId = manager.addResource(this.condition);\n\t\tconst targetId = manager.addResource(this.target);\n\t\tconst valueId = manager.addResource(this.value);\n\t\treturn manager.addResource(\n\t\t\t`[${this.type},${conditionId},${this.subtype},${targetId},${this.onInputAction},${valueId}]`\n\t\t);\n\t}\n\n\tstatic deserialize(\n\t\tserialized: EShapeActionValueMiscSerialized,\n\t\tmanager: EShapeResourceManagerDeserialization\n\t): EShapeActionValueMisc {\n\t\tconst resources = manager.resources;\n\t\tconst condition = EShapeActionValues.toResource(1, serialized, resources);\n\t\tconst target = EShapeActionValues.toResource(3, serialized, resources);\n\t\tconst value = EShapeActionValues.toResource(5, serialized, resources);\n\t\treturn new EShapeActionValueMisc(serialized[2], condition, target, serialized[4], value);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nconst DRAG = 1;\nconst PINCH = 2;\n\nexport const EShapeActionValueMiscGestureType = {\n\tNONE: 0,\n\tDRAG,\n\tPINCH,\n\tALL: DRAG | PINCH\n} as const;\n\nexport type EShapeActionValueMiscGestureType = number;\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction, Point } from \"pixi.js\";\nimport InteractionEvent = interaction.InteractionEvent;\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\nimport { EShapeActionRuntimeConditional } from \"./e-shape-action-runtime-conditional\";\nimport { DApplications } from \"../../d-applications\";\nimport { UtilGesture } from \"../../util/util-gesture\";\nimport { EShapeActionValueMiscGesture } from \"./e-shape-action-value-misc-gesture\";\nimport { EShapeActionValueMiscGestureType } from \"./e-shape-action-value-misc-gesture-type\";\n\nexport class EShapeActionRuntimeMiscGesture extends EShapeActionRuntimeConditional {\n\tprotected static GESTURE_UTIL?: UtilGesture<EShape>;\n\tprotected _gestureType: EShapeActionValueMiscGestureType;\n\tprotected _scaleMin: number;\n\tprotected _scaleMax: number;\n\n\tconstructor(value: EShapeActionValueMiscGesture) {\n\t\tsuper(value, EShapeRuntimeReset.NONE);\n\t\tthis._gestureType = value.gestureType;\n\t\tthis._scaleMin = value.scaleMin;\n\t\tthis._scaleMax = value.scaleMax;\n\t}\n\n\tonDown(shape: EShape, runtime: EShapeRuntime, e: InteractionEvent | KeyboardEvent): void {\n\t\tsuper.onDown(shape, runtime, e);\n\n\t\tif (e instanceof InteractionEvent) {\n\t\t\tif (this.condition(shape, e.data.originalEvent.timeStamp)) {\n\t\t\t\tthis.getGestureUtil().onDown(shape, e);\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected getGestureUtil(): UtilGesture<EShape> {\n\t\treturn (EShapeActionRuntimeMiscGesture.GESTURE_UTIL ??= this.newGestureUtil());\n\t}\n\n\tprotected newGestureUtil(): UtilGesture<EShape> {\n\t\tconst work = new Point();\n\t\treturn new UtilGesture<EShape>({\n\t\t\ton: {\n\t\t\t\tmove: (\n\t\t\t\t\ttarget: EShape,\n\t\t\t\t\tdx: number,\n\t\t\t\t\tdy: number,\n\t\t\t\t\tx: number,\n\t\t\t\t\ty: number,\n\t\t\t\t\tds: number\n\t\t\t\t): void => {\n\t\t\t\t\tthis.onGestureMove(target, dx, dy, x, y, ds, work);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tprotected onGestureMove(\n\t\ttarget: EShape,\n\t\tdx: number,\n\t\tdy: number,\n\t\tx: number,\n\t\ty: number,\n\t\tds: number,\n\t\twork: Point\n\t): void {\n\t\tconst parent = target.parent;\n\t\tif (parent) {\n\t\t\tconst transform = target.transform;\n\t\t\tconst gestureType = this._gestureType;\n\t\t\tlet isChanged = false;\n\n\t\t\t// Scale\n\t\t\tlet scaleRatio = 1;\n\t\t\tif (gestureType & EShapeActionValueMiscGestureType.PINCH) {\n\t\t\t\tconst scale = transform.scale;\n\t\t\t\tconst oldScale = scale.y;\n\t\t\t\tconst newScale = Math.min(this._scaleMax, Math.max(this._scaleMin, oldScale * ds));\n\t\t\t\tscaleRatio = newScale / oldScale;\n\t\t\t\tscale.set(newScale, newScale);\n\t\t\t\tisChanged = true;\n\t\t\t}\n\n\t\t\t// Position\n\t\t\tif (gestureType & EShapeActionValueMiscGestureType.DRAG) {\n\t\t\t\tparent.toLocal(work.set(x, y), undefined, work);\n\t\t\t\tconst lx = work.x;\n\t\t\t\tconst ly = work.y;\n\t\t\t\tconst cx = x - dx;\n\t\t\t\tconst cy = y - dy;\n\t\t\t\tparent.toLocal(work.set(cx, cy), undefined, work);\n\t\t\t\tconst lcx = work.x;\n\t\t\t\tconst lcy = work.y;\n\t\t\t\tconst position = transform.position;\n\t\t\t\tconst newX = (position.x - lcx) * scaleRatio + lx;\n\t\t\t\tconst newY = (position.y - lcy) * scaleRatio + ly;\n\t\t\t\tposition.set(newX, newY);\n\t\t\t\tisChanged = true;\n\t\t\t}\n\n\t\t\t// Update\n\t\t\tif (isChanged) {\n\t\t\t\tDApplications.update(target);\n\t\t\t}\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShapeActionRuntime } from \"./e-shape-action-runtime\";\nimport { EShapeActionRuntimeMiscGesture } from \"./e-shape-action-runtime-misc-gesture\";\nimport { EShapeActionValueMiscGestureType } from \"./e-shape-action-value-misc-gesture-type\";\nimport { EShapeActionValueMiscType } from \"./e-shape-action-value-misc-type\";\nimport { EShapeActionValueSubtyped } from \"./e-shape-action-value-subtyped\";\nimport { EShapeActionValueType } from \"./e-shape-action-value-type\";\nimport { EShapeActionValues } from \"./e-shape-action-values\";\n\nexport type EShapeActionValueMiscGestureSerialized = [\n\ttypeof EShapeActionValueType.MISC,\n\tnumber,\n\ttypeof EShapeActionValueMiscType.GESTURE,\n\tEShapeActionValueMiscGestureType,\n\tnumber, // Minimum scale\n\tnumber // Maximum scale\n];\n\nexport class EShapeActionValueMiscGesture extends EShapeActionValueSubtyped<\n\ttypeof EShapeActionValueMiscType.GESTURE\n> {\n\treadonly gestureType: EShapeActionValueMiscGestureType;\n\treadonly scaleMin: number;\n\treadonly scaleMax: number;\n\n\tconstructor(\n\t\tcondition: string,\n\t\tgestureType: EShapeActionValueMiscGestureType,\n\t\tscaleMin: number,\n\t\tscaleMax: number\n\t) {\n\t\tsuper(EShapeActionValueType.MISC, condition, EShapeActionValueMiscType.GESTURE);\n\t\tthis.gestureType = gestureType;\n\t\tthis.scaleMin = scaleMin;\n\t\tthis.scaleMax = scaleMax;\n\t}\n\n\ttoRuntime(): EShapeActionRuntime {\n\t\treturn new EShapeActionRuntimeMiscGesture(this);\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\tconst conditionId = manager.addResource(this.condition);\n\t\treturn manager.addResource(\n\t\t\t`[${this.type},${conditionId},${this.subtype},${this.gestureType},${this.scaleMin},${this.scaleMax}]`\n\t\t);\n\t}\n\n\tstatic deserialize(\n\t\tserialized: EShapeActionValueMiscGestureSerialized,\n\t\tmanager: EShapeResourceManagerDeserialization\n\t): EShapeActionValueMiscGesture {\n\t\tconst condition = EShapeActionValues.toResource(1, serialized, manager.resources);\n\t\tconst scalingMode = serialized[3];\n\t\tconst scaleMin = serialized[4];\n\t\tconst scaleMax = serialized[5];\n\t\treturn new EShapeActionValueMiscGesture(condition, scalingMode, scaleMin, scaleMax);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { BaseTexture, Rectangle, Texture } from \"pixi.js\";\n\nexport abstract class DynamicAtlasItem {\n\tid: string;\n\tref: number;\n\tframe: Rectangle;\n\ttexture: Texture;\n\n\twidth: number;\n\theight: number;\n\tstrokeWidth: number;\n\n\tconstructor(\n\t\tid: string,\n\t\twidth: number,\n\t\theight: number,\n\t\tstrokeWidth: number,\n\t\tbaseTexture: BaseTexture\n\t) {\n\t\tthis.id = id;\n\t\tthis.ref = 0;\n\t\tconst resolution = baseTexture.resolution;\n\t\tthis.frame = new Rectangle(0, 0, width * resolution, height * resolution);\n\t\tthis.texture = new Texture(baseTexture, new Rectangle(0, 0, 1, 1));\n\n\t\tthis.width = width;\n\t\tthis.height = height;\n\t\tthis.strokeWidth = strokeWidth;\n\t}\n\n\tabstract render(context: CanvasRenderingContext2D): void;\n\n\tapplyFrame(): void {\n\t\tconst resolutionInverse = 1 / this.texture.baseTexture.resolution;\n\t\tthis.texture.frame.x = this.frame.x * resolutionInverse;\n\t\tthis.texture.frame.y = this.frame.y * resolutionInverse;\n\t\tthis.texture.frame.width = this.width;\n\t\tthis.texture.frame.height = this.height;\n\t\tthis.texture.updateUvs();\n\t\tthis.texture.emit(\"update\", this);\n\t}\n\n\tdestroy(): void {\n\t\tthis.texture.destroy();\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DynamicAtlasItem } from \"./dynamic-atlas-item\";\n\nexport class DynamicAtlasItemEmpty extends DynamicAtlasItem {\n\trender(context: CanvasRenderingContext2D): void {\n\t\t// DO NOTHING\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DynamicAtlasItem } from \"./dynamic-atlas-item\";\n\nexport class DynamicAtlasItemWhite extends DynamicAtlasItem {\n\trender(context: CanvasRenderingContext2D): void {\n\t\tconst frame = this.frame;\n\n\t\tcontext.save();\n\t\tcontext.fillStyle = \"#ffffff\";\n\t\tcontext.fillRect(frame.x - 1, frame.y - 1, frame.width + 2, frame.height + 2);\n\t\tcontext.restore();\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { BaseTexture, MIPMAP_MODES, Texture } from \"pixi.js\";\nimport { DynamicAtlasItem } from \"./dynamic-atlas-item\";\nimport { DynamicAtlasItemEmpty } from \"./dynamic-atlas-item-empty\";\nimport { DynamicAtlasItemWhite } from \"./dynamic-atlas-item-white\";\n\nconst MAXIMUM_TEXTURE_SIZE = 4096;\n\nexport class DynamicAtlas {\n\tprotected static INSTANCE: DynamicAtlas | null;\n\n\tprotected _canvas: HTMLCanvasElement;\n\tprotected _sortedData: DynamicAtlasItem[];\n\tprotected _idToDatum: Record<string, DynamicAtlasItem>;\n\tprotected _baseTexture: BaseTexture;\n\tprotected _isDirty: boolean;\n\tprotected _predefined: Record<string, DynamicAtlasItem>;\n\n\tconstructor(resolution: number) {\n\t\tconst canvas = (this._canvas = document.createElement(\"canvas\"));\n\t\tcanvas.width = canvas.height = 256;\n\n\t\tconst baseTexture = (this._baseTexture = BaseTexture.from(canvas, {\n\t\t\tmipmap: MIPMAP_MODES.OFF,\n\t\t\tresolution\n\t\t}));\n\n\t\tthis._idToDatum = {};\n\t\tthis._sortedData = [];\n\t\tthis._predefined = {\n\t\t\tempty: new DynamicAtlasItemEmpty(\"empty\", 10, 10, 0, baseTexture),\n\t\t\twhite: new DynamicAtlasItemWhite(\"white\", 10, 10, 0, baseTexture)\n\t\t};\n\n\t\tthis._isDirty = true;\n\t}\n\n\tupdateFrames(width: number, data: DynamicAtlasItem[]): number {\n\t\tconst padding = 4;\n\t\tlet x = padding;\n\t\tlet y = padding;\n\t\tlet maxRowHeight = 0;\n\t\tfor (let i = 0, imax = data.length; i < imax; ++i) {\n\t\t\tconst datum = data[i];\n\t\t\tif (width < x + datum.frame.width + padding) {\n\t\t\t\tx = padding;\n\t\t\t\ty += maxRowHeight + padding;\n\t\t\t\tmaxRowHeight = 0;\n\t\t\t}\n\t\t\tdatum.frame.x = x | 0;\n\t\t\tdatum.frame.y = y | 0;\n\t\t\tx += datum.frame.width + padding;\n\t\t\tmaxRowHeight = Math.max(maxRowHeight, datum.frame.height);\n\t\t}\n\n\t\tconst minHeight = y + maxRowHeight + padding;\n\t\tlet result = 256;\n\t\twhile (result < minHeight) {\n\t\t\tresult <<= 1;\n\t\t}\n\t\treturn Math.min(MAXIMUM_TEXTURE_SIZE, result);\n\t}\n\n\trenderFrames(width: number, height: number, data: DynamicAtlasItem[]): void {\n\t\tconst canvas = this._canvas;\n\t\tcanvas.width = width;\n\t\tcanvas.height = height;\n\t\tconst context = canvas.getContext(\"2d\");\n\t\tif (context != null) {\n\t\t\tfor (let i = 0, imax = data.length; i < imax; ++i) {\n\t\t\t\tconst datum = data[i];\n\t\t\t\tdatum.render(context);\n\t\t\t}\n\t\t}\n\t}\n\n\tapplyFrames(data: DynamicAtlasItem[]): void {\n\t\tfor (let i = 0, imax = data.length; i < imax; ++i) {\n\t\t\tconst datum = data[i];\n\t\t\tdatum.applyFrame();\n\t\t}\n\t}\n\n\tcalcCanvasWidth(data: DynamicAtlasItem[]): number {\n\t\tlet result = 128;\n\t\tfor (let i = data.length - 1; 0 <= i; --i) {\n\t\t\tconst datum = data[i];\n\t\t\tconst size = Math.max(datum.frame.width, datum.frame.height);\n\t\t\twhile (result < size) {\n\t\t\t\tresult <<= 1;\n\t\t\t}\n\t\t}\n\t\treturn Math.min(MAXIMUM_TEXTURE_SIZE, result << 1);\n\t}\n\n\tcleanup(data: DynamicAtlasItem[]): void {\n\t\tdata.sort(DynamicAtlas.ITEM_COMPARATOR);\n\t\tfor (let i = data.length - 1; 0 <= i; --i) {\n\t\t\tconst datum = data[i];\n\t\t\tif (0 < datum.ref) {\n\t\t\t\tdata.length = i + 1;\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tdata.length = 0;\n\t}\n\n\tbegin(): void {\n\t\tconst data = this._sortedData;\n\t\tfor (let i = 0, imax = data.length; i < imax; ++i) {\n\t\t\tconst datum = data[i];\n\t\t\tdatum.ref = 0;\n\t\t}\n\n\t\tthis._isDirty = false;\n\t}\n\n\tend(): void {\n\t\tconst idToDatum = this._idToDatum;\n\t\tconst data = this._sortedData;\n\t\tfor (let i = 0, imax = data.length; i < imax; ++i) {\n\t\t\tconst datum = data[i];\n\t\t\tif (datum.ref <= 0) {\n\t\t\t\tif (!(datum.id in this._predefined)) {\n\t\t\t\t\tdatum.destroy();\n\t\t\t\t}\n\t\t\t\tdelete idToDatum[datum.id];\n\t\t\t\tthis._isDirty = true;\n\t\t\t}\n\t\t}\n\t}\n\n\trepack(forcibly?: boolean): void {\n\t\tif (forcibly === true || this._isDirty) {\n\t\t\tthis._isDirty = false;\n\t\t\tconst data = this._sortedData;\n\t\t\tthis.cleanup(data);\n\t\t\tconst canvasWidth = this.calcCanvasWidth(data);\n\t\t\tconst canvasHeight = this.updateFrames(canvasWidth, data);\n\t\t\tthis.renderFrames(canvasWidth, canvasHeight, data);\n\t\t\tthis._baseTexture.setRealSize(canvasWidth, canvasHeight);\n\t\t\tthis.applyFrames(data);\n\t\t}\n\t}\n\n\tget(id: string): DynamicAtlasItem | null {\n\t\tconst idToDatum = this._idToDatum;\n\t\tconst datum = idToDatum[id];\n\t\tif (datum != null) {\n\t\t\tdatum.ref += 1;\n\t\t\treturn datum;\n\t\t} else {\n\t\t\tconst predefined = this._predefined[id];\n\t\t\tif (predefined != null) {\n\t\t\t\tthis.set(id, predefined);\n\t\t\t\treturn predefined;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tset(id: string, item: DynamicAtlasItem): DynamicAtlasItem | undefined {\n\t\tconst result = this._idToDatum[id];\n\t\titem.ref += 1;\n\t\tthis._idToDatum[id] = item;\n\t\tthis._sortedData.push(item);\n\t\tthis._isDirty = true;\n\t\treturn result;\n\t}\n\n\ttoDirty(): void {\n\t\tthis._isDirty = true;\n\t}\n\n\tgetDefaultTexture(): Texture {\n\t\treturn this.get(\"white\")!.texture;\n\t}\n\n\tgetBaseTexture(): BaseTexture {\n\t\treturn this._baseTexture;\n\t}\n\n\trelease(id: string): void {\n\t\tconst idToDatum = this._idToDatum;\n\t\tconst datum = idToDatum[id];\n\t\tif (datum != null) {\n\t\t\tdatum.ref -= 1;\n\t\t\tif (datum.ref <= 0) {\n\t\t\t\tif (!(datum.id in this._predefined)) {\n\t\t\t\t\tdatum.destroy();\n\t\t\t\t}\n\t\t\t\tdelete idToDatum[id];\n\t\t\t\tthis._isDirty = true;\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic ITEM_COMPARATOR = (a: DynamicAtlasItem, b: DynamicAtlasItem): number => {\n\t\tif (a.ref <= 0) {\n\t\t\tif (b.ref <= 0) {\n\t\t\t\treturn 0;\n\t\t\t} else {\n\t\t\t\treturn +1;\n\t\t\t}\n\t\t} else {\n\t\t\tif (b.ref <= 0) {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t}\n\n\t\tif (a.frame.height < b.frame.height) {\n\t\t\treturn -1;\n\t\t} else if (b.frame.height < a.frame.height) {\n\t\t\treturn +1;\n\t\t} else {\n\t\t\treturn a.frame.width - b.frame.width;\n\t\t}\n\t};\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { BaseTexture } from \"pixi.js\";\nimport { DynamicAtlasItem } from \"./dynamic-atlas-item\";\nimport { DynamicSDFFontAtlas } from \"./dynamic-sdf-font-atlas\";\n\nexport class DynamicAtlasItemFontAtlas extends DynamicAtlasItem {\n\tcanvas: HTMLCanvasElement | null;\n\n\tconstructor(atlas: DynamicSDFFontAtlas, baseTexture: BaseTexture) {\n\t\tsuper(\n\t\t\tatlas.id,\n\t\t\tatlas.width / baseTexture.resolution,\n\t\t\tatlas.height / baseTexture.resolution,\n\t\t\t0,\n\t\t\tbaseTexture\n\t\t);\n\t\tthis.canvas = atlas.canvas;\n\t}\n\n\trender(context: CanvasRenderingContext2D): void {\n\t\tconst canvas = this.canvas;\n\t\tif (canvas != null) {\n\t\t\tconst frame = this.frame;\n\t\t\tcontext.drawImage(canvas, frame.x, frame.y, frame.width, frame.height);\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const ASCII_CHARACTERS =\n\t\"!\\\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\\\]^_`abcdefghijklmnopqrstuvwxyz{|}~\";\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport class DynamicFontAtlasCharacterOrigin {\n\tx: number;\n\ty: number;\n\n\tconstructor(x: number, y: number) {\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DynamicFontAtlasCharacterOrigin } from \"./dynamic-font-atlas-chaaracter-origin\";\nimport { DynamicFontAtlasCharacterType } from \"./dynamic-font-atlas-character-type\";\n\nexport class DynamicFontAtlasCharacter {\n\tref: number;\n\tlife: number;\n\tcharacter: string;\n\tx: number;\n\ty: number;\n\twidth: number;\n\theight: number;\n\tadvance: number;\n\torigin: DynamicFontAtlasCharacterOrigin;\n\ttype: DynamicFontAtlasCharacterType;\n\n\tconstructor(\n\t\tcharacter: string,\n\t\tadvance: number,\n\t\twidth: number,\n\t\theight: number,\n\t\ttype: DynamicFontAtlasCharacterType\n\t) {\n\t\tthis.ref = 1;\n\t\tthis.life = 10;\n\t\tthis.character = character;\n\t\tthis.x = 0;\n\t\tthis.y = 0;\n\t\tthis.width = width;\n\t\tthis.height = height;\n\t\tthis.advance = advance;\n\t\tthis.origin = new DynamicFontAtlasCharacterOrigin(0, 0);\n\t\tthis.type = type;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nconst RESERVED = 1;\nconst NON_BREAKING = 2;\n\nconst SPACE = 4;\nconst SPACE_R = SPACE | RESERVED;\nconst SPACE_NB = SPACE | NON_BREAKING;\nconst SPACE_RNB = SPACE | RESERVED | NON_BREAKING;\n\nconst LETTER = 8;\nconst LETTER_R = LETTER | RESERVED;\nconst LETTER_NB = LETTER | NON_BREAKING;\nconst LETTER_RNB = LETTER | RESERVED | NON_BREAKING;\n\nexport const DynamicFontAtlasCharacterType = {\n\tRESERVED,\n\tNON_BREAKING,\n\n\tSPACE,\n\tSPACE_R,\n\tSPACE_NB,\n\tSPACE_RNB,\n\n\tLETTER,\n\tLETTER_R,\n\tLETTER_NB,\n\tLETTER_RNB\n} as const;\n\nexport type DynamicFontAtlasCharacterType = number;\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nconst VERTEX_SHADER = `\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nvarying mediump vec2 vTextureCoord;\nvoid main(void) {\n\tgl_Position = vec4(aVertexPosition, 0.0, 1.0);\n\tvTextureCoord = aTextureCoord;\n}\n`;\n\nconst FRAGMENT_SHADER = `\nprecision mediump float;\n\nvarying mediump vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec2 uSize;\n\nfloat calcDistance( float x, float y, float dx, float dy ) {\n\tfloat xd = x + dx;\n\tfloat yd = y + dy;\n\tfloat u = xd / uSize.x;\n\tfloat v = yd / uSize.y;\n\tfloat ul = (xd - 1.0) / uSize.x;\n\tfloat vt = (yd - 1.0) / uSize.y;\n\n\tfloat m = texture2D(uSampler, vec2(u , v )).a;\n\tfloat l = texture2D(uSampler, vec2(ul, v )).a;\n\tfloat t = texture2D(uSampler, vec2(u , vt)).a;\n\n\tfloat xl = mix( xd - 1.0, xd, (0.5 - l) / (m - l) );\n\tfloat yt = mix( yd - 1.0, yd, (0.5 - t) / (m - t) );\n\n\tbool bl = ( min(l, m) < 0.5 && 0.5 <= max(l, m) );\n\tbool bt = ( min(t, m) < 0.5 && 0.5 <= max(t, m) );\n\n\tfloat ll = (bl ? length( vec2( xl - x, yd - y ) ) : 100.0);\n\tfloat lt = (bt ? length( vec2( xd - x, yt - y ) ) : 100.0);\n\n\treturn min( ll, lt );\n}\n\nfloat calcDistancesY( float x, float y, float dx ) {\n\tfloat d = 100.0;\n\tfor( float dy=-6.0; dy<6.5; dy++ ) {\n\t\td = min( d, calcDistance( x, y, dx, dy ) );\n\t}\n\treturn d;\n}\n\nfloat calcDistances( float x, float y ) {\n\tfloat d = 100.0;\n\tfor( float dx=-6.0; dx<6.5; dx++ ) {\n\t\td = min( d, calcDistancesY( x, y, dx ) );\n\t}\n\treturn d;\n}\n\nvoid main(void) {\n\tfloat t = texture2D(uSampler, vTextureCoord).a;\n\tfloat x = vTextureCoord.x * uSize.x;\n\tfloat y = vTextureCoord.y * uSize.y;\n\tfloat d = min( 6.0, calcDistances( x, y ) ) / 12.0;\n\td = clamp( mix( 0.5 - d, 0.5 + d, step( 0.5, t ) ), 0.0, 1.0 );\n\tgl_FragColor = vec4(1.0, 1.0, 1.0, d);\n}\n`;\n\nexport class DynamicSDFFontGenerator {\n\tprotected static _INSTANCE: DynamicSDFFontGenerator | null = null;\n\n\tprotected _canvas: HTMLCanvasElement | null;\n\tprotected _onLostBound: EventListener;\n\tprotected _onRestoreBound: EventListener;\n\tprotected _onUnloadBound: EventListener;\n\tprotected _gl: WebGLRenderingContext | null;\n\tprotected _texture: WebGLTexture | null;\n\tprotected _shaderProgram: WebGLProgram | null;\n\tprotected _vertexPositionAttribute: number;\n\tprotected _textureCoordAttribute: number;\n\tprotected _samplerUniform: WebGLUniformLocation | null;\n\tprotected _sizeUniform: WebGLUniformLocation | null;\n\tprotected _vb: WebGLBuffer | null;\n\tprotected _uvb: WebGLBuffer | null;\n\n\tconstructor() {\n\t\tthis._gl = null;\n\t\tthis._texture = null;\n\t\tthis._shaderProgram = null;\n\t\tthis._vertexPositionAttribute = NaN;\n\t\tthis._textureCoordAttribute = NaN;\n\t\tthis._samplerUniform = NaN;\n\t\tthis._sizeUniform = NaN;\n\t\tthis._vb = null;\n\t\tthis._uvb = null;\n\n\t\tconst canvas = (this._canvas = document.createElement(\"canvas\"));\n\t\tcanvas.width = 64;\n\t\tcanvas.height = 64;\n\t\tthis._onLostBound = (e: Event): void => {\n\t\t\te.preventDefault();\n\t\t};\n\t\tthis._onRestoreBound = (): void => {\n\t\t\tthis.restore();\n\t\t};\n\t\tthis._onUnloadBound = (): void => {\n\t\t\tthis.destroy();\n\t\t};\n\t\tcanvas.addEventListener(\"webglcontextlost\", this._onLostBound, false);\n\t\tcanvas.addEventListener(\"webglcontextrestored\", this._onRestoreBound, false);\n\t\twindow.addEventListener(\"unload\", this._onUnloadBound, false);\n\t}\n\n\tinit(): this {\n\t\tconst canvas = this._canvas;\n\t\tif (canvas != null && (this._gl == null || this._gl.isContextLost())) {\n\t\t\tconst config: WebGLContextAttributes = {\n\t\t\t\talpha: true,\n\t\t\t\tantialias: false,\n\t\t\t\tdepth: false,\n\t\t\t\tstencil: false,\n\t\t\t\tpremultipliedAlpha: false\n\t\t\t};\n\t\t\tconst gl =\n\t\t\t\tcanvas.getContext(\"webgl\", config) ||\n\t\t\t\t(canvas.getContext(\"experimental-webgl\", config) as WebGLRenderingContext | null);\n\t\t\tthis._gl = gl;\n\t\t\tif (gl != null) {\n\t\t\t\tgl.clearColor(1.0, 1.0, 1.0, 0.0);\n\t\t\t\tthis.makeVertexBuffer();\n\t\t\t\tthis.makeUvBuffer();\n\t\t\t\tthis.makeShaders();\n\t\t\t\tthis._texture = null;\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n\n\trestore(): void {\n\t\tthis.init();\n\t}\n\n\tgetCanvas(): HTMLCanvasElement | null {\n\t\treturn this._canvas;\n\t}\n\n\tgetShader(gl: WebGLRenderingContext, code: string, type: boolean): WebGLShader | null {\n\t\tconst shader = type\n\t\t\t? gl.createShader(gl.FRAGMENT_SHADER)\n\t\t\t: gl.createShader(gl.VERTEX_SHADER);\n\t\tif (shader != null) {\n\t\t\tgl.shaderSource(shader, code);\n\t\t\tgl.compileShader(shader);\n\t\t\tif (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n\t\t\t\tconsole &&\n\t\t\t\t\tconsole.error(`Failed to compile the shader: ${gl.getShaderInfoLog(shader)}`);\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\t\treturn shader;\n\t}\n\n\tmakeShaders(): WebGLShader | null {\n\t\tconst gl = this._gl;\n\t\tif (gl != null && gl.isContextLost() !== true) {\n\t\t\tconst vertexShader = this.getShader(gl, VERTEX_SHADER, false);\n\t\t\tif (vertexShader != null) {\n\t\t\t\tconst fragmentShader = this.getShader(gl, FRAGMENT_SHADER, true);\n\t\t\t\tif (fragmentShader != null) {\n\t\t\t\t\tconst shaderProgram = (this._shaderProgram = gl.createProgram());\n\t\t\t\t\tif (shaderProgram != null) {\n\t\t\t\t\t\tgl.attachShader(shaderProgram, vertexShader);\n\t\t\t\t\t\tgl.attachShader(shaderProgram, fragmentShader);\n\t\t\t\t\t\tgl.linkProgram(shaderProgram);\n\t\t\t\t\t\tif (!gl.getProgramParameter(shaderProgram, gl.LINK_STATUS)) {\n\t\t\t\t\t\t\tconsole &&\n\t\t\t\t\t\t\t\tconsole.error(`Failed to link the program: ${gl.getError()}`);\n\t\t\t\t\t\t\tgl.deleteShader(vertexShader);\n\t\t\t\t\t\t\tgl.deleteShader(fragmentShader);\n\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tgl.deleteShader(vertexShader);\n\t\t\t\t\t\t\tgl.deleteShader(fragmentShader);\n\n\t\t\t\t\t\t\tgl.useProgram(shaderProgram);\n\t\t\t\t\t\t\tthis._vertexPositionAttribute = gl.getAttribLocation(\n\t\t\t\t\t\t\t\tshaderProgram,\n\t\t\t\t\t\t\t\t\"aVertexPosition\"\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tthis._textureCoordAttribute = gl.getAttribLocation(\n\t\t\t\t\t\t\t\tshaderProgram,\n\t\t\t\t\t\t\t\t\"aTextureCoord\"\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tthis._samplerUniform = gl.getUniformLocation(shaderProgram, \"uSampler\");\n\t\t\t\t\t\t\tthis._sizeUniform = gl.getUniformLocation(shaderProgram, \"uSize\");\n\t\t\t\t\t\t\tgl.useProgram(null);\n\t\t\t\t\t\t\treturn shaderProgram;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tgl.deleteShader(vertexShader);\n\t\t\t\t\t\tgl.deleteShader(fragmentShader);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tgl.deleteShader(vertexShader);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tdestroyShaders(): void {\n\t\tconst gl = this._gl;\n\t\tif (gl != null && gl.isContextLost() !== true) {\n\t\t\tconst shaderProgram = this._shaderProgram;\n\t\t\tif (shaderProgram != null) {\n\t\t\t\tthis._shaderProgram = null;\n\t\t\t\tgl.useProgram(null);\n\t\t\t\tgl.deleteProgram(shaderProgram);\n\t\t\t}\n\t\t}\n\t}\n\n\tupdateTexture(source: TexImageSource): WebGLTexture | null {\n\t\tconst gl = this._gl;\n\t\tconst canvas = this._canvas;\n\t\tif (gl != null && gl.isContextLost() !== true && canvas != null) {\n\t\t\tconst width = source.width;\n\t\t\tconst height = source.height;\n\t\t\tif (canvas.width !== width || canvas.height !== height) {\n\t\t\t\tcanvas.width = width;\n\t\t\t\tcanvas.height = height;\n\t\t\t\tgl.viewport(0, 0, width, height);\n\t\t\t}\n\n\t\t\tlet texture = this._texture;\n\t\t\tif (texture == null) {\n\t\t\t\ttexture = this._texture = gl.createTexture();\n\t\t\t\tgl.bindTexture(gl.TEXTURE_2D, texture);\n\t\t\t\tgl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, source);\n\t\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n\t\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\t\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n\t\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n\t\t\t\tgl.bindTexture(gl.TEXTURE_2D, null);\n\t\t\t} else {\n\t\t\t\tgl.bindTexture(gl.TEXTURE_2D, texture);\n\t\t\t\tgl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, source);\n\t\t\t\tgl.bindTexture(gl.TEXTURE_2D, null);\n\t\t\t}\n\t\t\treturn texture;\n\t\t}\n\t\treturn null;\n\t}\n\n\tdestroyTexture(): void {\n\t\tconst gl = this._gl;\n\t\tconst texture = this._texture;\n\t\tif (gl != null && gl.isContextLost() !== true && texture != null) {\n\t\t\tthis._texture = null;\n\t\t\tgl.bindTexture(gl.TEXTURE_2D, null);\n\t\t\tgl.deleteTexture(texture);\n\t\t}\n\t}\n\n\tmakeVertexBuffer(): WebGLBuffer | null {\n\t\tconst gl = this._gl;\n\t\tif (gl != null && gl.isContextLost() !== true) {\n\t\t\tconst vb = (this._vb = gl.createBuffer());\n\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, vb);\n\n\t\t\tconst vertices = [-1.0, +1.0, +1.0, +1.0, -1.0, -1.0, +1.0, -1.0];\n\n\t\t\tgl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertices), gl.STATIC_DRAW);\n\t\t\treturn vb;\n\t\t}\n\t\treturn null;\n\t}\n\n\tdestroyVertexBuffer(): void {\n\t\tconst gl = this._gl;\n\t\tconst vb = this._vb;\n\t\tif (gl != null && gl.isContextLost() !== true && vb != null) {\n\t\t\tthis._vb = null;\n\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, null);\n\t\t\tgl.deleteBuffer(vb);\n\t\t}\n\t}\n\n\tmakeUvBuffer(): WebGLBuffer | null {\n\t\tconst gl = this._gl;\n\t\tif (gl != null && gl.isContextLost() !== true) {\n\t\t\tconst uvb = (this._uvb = gl.createBuffer());\n\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, uvb);\n\n\t\t\tconst uvs = [0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 1.0, 1.0];\n\n\t\t\tgl.bufferData(gl.ARRAY_BUFFER, new Float32Array(uvs), gl.STATIC_DRAW);\n\t\t\treturn uvb;\n\t\t}\n\t\treturn null;\n\t}\n\n\tdestroyUvBuffer(): void {\n\t\tconst gl = this._gl;\n\t\tconst uvb = this._uvb;\n\t\tif (gl != null && gl.isContextLost() !== true && uvb != null) {\n\t\t\tthis._uvb = null;\n\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, null);\n\t\t\tgl.deleteBuffer(uvb);\n\t\t}\n\t}\n\n\trender(): void {\n\t\tconst gl = this._gl;\n\t\tconst canvas = this._canvas;\n\t\tconst shaderProgram = this._shaderProgram;\n\t\tconst vb = this._vb;\n\t\tconst uvb = this._uvb;\n\t\tconst texture = this._texture;\n\t\tif (\n\t\t\tgl != null &&\n\t\t\tgl.isContextLost() !== true &&\n\t\t\tcanvas != null &&\n\t\t\tshaderProgram != null &&\n\t\t\tvb != null &&\n\t\t\tuvb != null &&\n\t\t\ttexture != null\n\t\t) {\n\t\t\tgl.clear(gl.COLOR_BUFFER_BIT);\n\n\t\t\tgl.useProgram(shaderProgram);\n\n\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, vb);\n\t\t\tconst vertexPositionAttribute = this._vertexPositionAttribute;\n\t\t\tgl.enableVertexAttribArray(vertexPositionAttribute);\n\t\t\tgl.vertexAttribPointer(vertexPositionAttribute, 2, gl.FLOAT, false, 0, 0);\n\n\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, uvb);\n\t\t\tconst textureCoordAttribute = this._textureCoordAttribute;\n\t\t\tgl.enableVertexAttribArray(textureCoordAttribute);\n\t\t\tgl.vertexAttribPointer(textureCoordAttribute, 2, gl.FLOAT, false, 0, 0);\n\n\t\t\tgl.activeTexture(gl.TEXTURE0);\n\t\t\tgl.bindTexture(gl.TEXTURE_2D, texture);\n\t\t\tgl.uniform1i(this._samplerUniform, 0);\n\t\t\tgl.uniform2f(this._sizeUniform, canvas.width, canvas.height);\n\n\t\t\tgl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n\n\t\t\tgl.bindTexture(gl.TEXTURE_2D, null);\n\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, null);\n\t\t\tgl.useProgram(null);\n\t\t}\n\t}\n\n\tread(copyCanvas: HTMLCanvasElement): void {\n\t\tconst gl = this._gl;\n\t\tconst canvas = this._canvas;\n\t\tif (gl != null && gl.isContextLost() !== true && canvas != null) {\n\t\t\tconst width = canvas.width;\n\t\t\tconst height = canvas.height;\n\t\t\tcopyCanvas.width = width;\n\t\t\tcopyCanvas.height = height;\n\t\t\tconst copyContext = copyCanvas.getContext(\"2d\");\n\t\t\tif (copyContext != null) {\n\t\t\t\tcopyContext.drawImage(canvas, 0, 0);\n\t\t\t}\n\t\t}\n\t}\n\n\tdestroy(): void {\n\t\tthis.destroyVertexBuffer();\n\t\tthis.destroyUvBuffer();\n\t\tthis.destroyShaders();\n\n\t\tconst canvas = this._canvas;\n\t\tif (canvas != null) {\n\t\t\tthis._canvas = null;\n\t\t\tcanvas.removeEventListener(\"webglcontextlost\", this._onLostBound, false);\n\t\t\tcanvas.removeEventListener(\"webglcontextrestored\", this._onRestoreBound, false);\n\t\t\twindow.removeEventListener(\"unload\", this._onUnloadBound, false);\n\t\t}\n\n\t\tconst gl = this._gl;\n\t\tif (gl != null) {\n\t\t\tthis._gl = null;\n\t\t\tconst WebGLLoseContext = gl.getExtension(\"WEBGL_lose_context\");\n\t\t\tif (WebGLLoseContext != null) {\n\t\t\t\tWebGLLoseContext.loseContext();\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic getInstance(): DynamicSDFFontGenerator {\n\t\tif (DynamicSDFFontGenerator._INSTANCE == null) {\n\t\t\tDynamicSDFFontGenerator._INSTANCE = new DynamicSDFFontGenerator();\n\t\t}\n\t\treturn DynamicSDFFontGenerator._INSTANCE;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DThemes } from \"../theme/d-themes\";\nimport { ASCII_CHARACTERS } from \"./ascii\";\nimport { DynamicFontAtlasCharacter } from \"./dynamic-font-atlas-character\";\nimport { DynamicFontAtlasCharacterType } from \"./dynamic-font-atlas-character-type\";\nimport { DynamicFontAtlasCharacters } from \"./dynamic-font-atlas-characters\";\nimport { DynamicSDFFontGenerator } from \"./dynamic-sdf-font-generator\";\nimport { UtilCharacterIterator } from \"./util-character-iterator\";\n\nexport interface DynamicSDFFontAtlasFont {\n\tfamily: string;\n\tsize: number;\n\titalic: boolean;\n}\n\nexport interface DynamicSDFFontAtlasJson {\n\twidth: number;\n\theight: number;\n\tfont: DynamicSDFFontAtlasFont;\n\tcharacters: DynamicFontAtlasCharacters;\n}\n\nexport class DynamicSDFFontAtlas {\n\tprotected static FONT_FAMILY_AUTO: string | null = null;\n\n\tprotected _id: string;\n\tprotected _generator: DynamicSDFFontGenerator | null;\n\tprotected _canvas: HTMLCanvasElement | null;\n\tprotected _font: DynamicSDFFontAtlasFont;\n\tprotected _characters: DynamicFontAtlasCharacters;\n\tprotected _length: number;\n\tprotected _width: number;\n\tprotected _height: number;\n\tprotected _isDirty: boolean;\n\n\tconstructor(fontFamily: string) {\n\t\tthis._id = `font-atlas:${fontFamily}`;\n\t\tthis._generator = DynamicSDFFontGenerator.getInstance().init();\n\t\tthis._canvas = document.createElement(\"canvas\");\n\t\tthis._font = {\n\t\t\tfamily: DynamicSDFFontAtlas.toFontFamily(fontFamily),\n\t\t\tsize: 32,\n\t\t\titalic: false\n\t\t};\n\t\tthis._characters = {};\n\t\tthis._length = 0;\n\t\tthis._width = 1;\n\t\tthis._height = 1;\n\t\tthis._isDirty = true;\n\t}\n\n\tget id(): string {\n\t\treturn this._id;\n\t}\n\n\tget font(): DynamicSDFFontAtlasFont {\n\t\treturn this._font;\n\t}\n\n\tset font(font: DynamicSDFFontAtlasFont) {\n\t\tthis._font.family = font.family;\n\t\tthis._font.size = font.size;\n\t\tthis._font.italic = font.italic;\n\t}\n\n\tget width(): number {\n\t\treturn this._width;\n\t}\n\n\tget height(): number {\n\t\treturn this._height;\n\t}\n\n\tget canvas(): HTMLCanvasElement | null {\n\t\treturn this._canvas;\n\t}\n\n\tget generator(): DynamicSDFFontGenerator | null {\n\t\treturn this._generator;\n\t}\n\n\tget characters(): DynamicFontAtlasCharacters {\n\t\treturn this._characters;\n\t}\n\n\tbegin(): void {\n\t\tthis._length = 0;\n\t\tconst characters = this._characters;\n\t\tfor (const id in characters) {\n\t\t\tcharacters[id].ref = 0;\n\t\t}\n\t}\n\n\tend(): void {\n\t\tconst characters = this._characters;\n\t\tfor (const id in characters) {\n\t\t\tconst data = characters[id];\n\t\t\tif (data.ref <= 0) {\n\t\t\t\tdata.life -= 1;\n\t\t\t\tif (data.life <= 0) {\n\t\t\t\t\tdelete characters[id];\n\t\t\t\t\tthis._isDirty = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\taddAscii(): void {\n\t\tthis.addChar(\" \", \" \", DynamicFontAtlasCharacterType.SPACE_R);\n\t\tthis.addChar(\"\\t\", \"    \", DynamicFontAtlasCharacterType.SPACE_R);\n\t\tthis.addChar(\"...\", \"...\", DynamicFontAtlasCharacterType.LETTER_RNB);\n\t\tfor (let i = 0, imax = ASCII_CHARACTERS.length; i < imax; ++i) {\n\t\t\tconst char = ASCII_CHARACTERS[i];\n\t\t\tthis.addChar(char, char, DynamicFontAtlasCharacterType.LETTER_RNB);\n\t\t}\n\t}\n\n\taddChar(id: string, character: string, type: DynamicFontAtlasCharacterType): void {\n\t\tconst characters = this._characters;\n\t\tif (!this.isIgnored(character)) {\n\t\t\tconst data = characters[id];\n\t\t\tif (data != null) {\n\t\t\t\tif (data.ref <= 0) {\n\t\t\t\t\tthis._length += 1;\n\t\t\t\t}\n\t\t\t\tdata.ref += 1;\n\t\t\t} else {\n\t\t\t\tcharacters[id] = new DynamicFontAtlasCharacter(character, 0, 1, 1, type);\n\t\t\t\tthis._length += 1;\n\t\t\t\tthis._isDirty = true;\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected isIgnored(character: string): boolean {\n\t\tswitch (character) {\n\t\t\tcase \"\\n\": // Line feed\n\t\t\t\treturn true;\n\t\t\tcase \"\\r\": // Carriage return\n\t\t\t\treturn true;\n\t\t\tcase \"\\v\": // Vertical tab\n\t\t\t\treturn true;\n\t\t\tcase \"\\f\": // Form feed\n\t\t\t\treturn true;\n\t\t\tcase \"\\u0085\": // Next line\n\t\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tadd(\n\t\tcharacters: string,\n\t\ttype: DynamicFontAtlasCharacterType = DynamicFontAtlasCharacterType.LETTER\n\t): void {\n\t\tconst iterator = UtilCharacterIterator.from(characters);\n\t\twhile (iterator.hasNext()) {\n\t\t\tconst character = iterator.next();\n\t\t\tthis.addChar(character, character, type);\n\t\t}\n\t}\n\n\tget(id: string): DynamicFontAtlasCharacter | undefined {\n\t\treturn this._characters[id];\n\t}\n\n\tupdate(): boolean {\n\t\tif (this._isDirty) {\n\t\t\tconst canvas = this._canvas;\n\t\t\tconst generator = this._generator;\n\t\t\tif (canvas != null && generator != null) {\n\t\t\t\tconst context = canvas.getContext(\"2d\");\n\t\t\t\tif (context != null) {\n\t\t\t\t\tthis._isDirty = false;\n\n\t\t\t\t\tconst font = this._font;\n\t\t\t\t\tconst characters = this._characters;\n\t\t\t\t\tconst characterSize = font.size + 14;\n\t\t\t\t\tconst width = DynamicSDFFontAtlas.toPowerOf2(\n\t\t\t\t\t\tMath.ceil(Math.sqrt(this._length)) * characterSize\n\t\t\t\t\t);\n\t\t\t\t\tthis._width = width;\n\t\t\t\t\tconst fontStyle =\n\t\t\t\t\t\t(font.italic ? \"italic \" : \"\") + (font.size + \"px \") + font.family;\n\n\t\t\t\t\tcontext.font = fontStyle;\n\t\t\t\t\tcontext.textAlign = \"left\";\n\t\t\t\t\tcontext.textBaseline = \"middle\";\n\t\t\t\t\tcontext.lineWidth = 0;\n\t\t\t\t\tcontext.lineCap = \"round\";\n\t\t\t\t\tcontext.lineJoin = \"miter\";\n\t\t\t\t\tcontext.miterLimit = 0;\n\t\t\t\t\tcontext.fillStyle = \"#FFFFFF\";\n\n\t\t\t\t\tconst offsetX = 7;\n\t\t\t\t\tconst offsetY = characterSize >> 1;\n\t\t\t\t\tlet x = 0;\n\t\t\t\t\tlet y = 0;\n\t\t\t\t\tfor (const id in characters) {\n\t\t\t\t\t\tconst data = characters[id];\n\t\t\t\t\t\tconst advance = context.measureText(data.character).width;\n\t\t\t\t\t\tconst characterWidth = Math.ceil(offsetX + advance + offsetX);\n\t\t\t\t\t\tconst characterHeight = characterSize;\n\t\t\t\t\t\tif (width <= x + characterWidth) {\n\t\t\t\t\t\t\tx = 0;\n\t\t\t\t\t\t\ty += characterSize;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdata.x = x;\n\t\t\t\t\t\tdata.y = y;\n\t\t\t\t\t\tdata.width = characterWidth;\n\t\t\t\t\t\tdata.height = characterHeight;\n\t\t\t\t\t\tdata.advance = advance;\n\t\t\t\t\t\tdata.origin.x = x + offsetX;\n\t\t\t\t\t\tdata.origin.y = y + offsetY;\n\n\t\t\t\t\t\tx += characterWidth;\n\t\t\t\t\t}\n\t\t\t\t\tconst height = (this._height = y + characterSize);\n\n\t\t\t\t\t// Make a input canvas\n\t\t\t\t\t// Here, we need to reset the context because\n\t\t\t\t\t// context settings will be lost when we set the width/height.\n\t\t\t\t\tcanvas.width = width;\n\t\t\t\t\tcanvas.height = height;\n\t\t\t\t\tcontext.font = fontStyle;\n\t\t\t\t\tcontext.textAlign = \"left\";\n\t\t\t\t\tcontext.textBaseline = \"middle\";\n\t\t\t\t\tcontext.lineWidth = 0;\n\t\t\t\t\tcontext.lineCap = \"round\";\n\t\t\t\t\tcontext.lineJoin = \"miter\";\n\t\t\t\t\tcontext.miterLimit = 4;\n\t\t\t\t\tcontext.fillStyle = \"#FFFFFF\";\n\t\t\t\t\tcontext.clearRect(0, 0, width, height);\n\t\t\t\t\tfor (const id in characters) {\n\t\t\t\t\t\tconst data = characters[id];\n\t\t\t\t\t\tcontext.fillText(data.character, data.origin.x, data.origin.y);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Convert to SDF font texture\n\t\t\t\t\tgenerator.updateTexture(canvas);\n\t\t\t\t\tgenerator.render();\n\t\t\t\t\tgenerator.read(canvas);\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tget length(): number {\n\t\treturn this._length;\n\t}\n\n\ttoJson(): DynamicSDFFontAtlasJson {\n\t\treturn {\n\t\t\twidth: this._width,\n\t\t\theight: this._height,\n\t\t\tfont: this._font,\n\t\t\tcharacters: this._characters\n\t\t};\n\t}\n\n\ttoString(): string {\n\t\treturn JSON.stringify(this.toJson());\n\t}\n\n\tdestroy(): void {\n\t\tconst generator = this._generator;\n\t\tif (generator != null) {\n\t\t\tthis._generator = null;\n\t\t}\n\n\t\tconst canvas = this._canvas;\n\t\tif (canvas != null) {\n\t\t\tthis._canvas = null;\n\t\t}\n\n\t\tconst characters = this._characters;\n\t\tfor (const id in characters) {\n\t\t\tdelete characters[id];\n\t\t}\n\t}\n\n\tstatic toFontFamily(fontFamily: string): string {\n\t\treturn fontFamily === \"auto\" ? DynamicSDFFontAtlas.getAutoFontFamily() : fontFamily;\n\t}\n\n\tstatic toPowerOf2(size: number): number {\n\t\tlet result = 32;\n\t\twhile (result < size) {\n\t\t\tresult <<= 1;\n\t\t}\n\t\treturn result;\n\t}\n\n\tstatic getAutoFontFamily(): string {\n\t\tif (DynamicSDFFontAtlas.FONT_FAMILY_AUTO == null) {\n\t\t\tDynamicSDFFontAtlas.FONT_FAMILY_AUTO = DThemes.getInstance()\n\t\t\t\t.get<any>(\"DBase\")\n\t\t\t\t.getFontFamilly() as string;\n\t\t}\n\t\treturn DynamicSDFFontAtlas.FONT_FAMILY_AUTO;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DynamicAtlas } from \"./dynamic-atlas\";\nimport { DynamicAtlasItemFontAtlas } from \"./dynamic-atlas-item-font-atlas\";\nimport { DynamicSDFFontAtlas } from \"./dynamic-sdf-font-atlas\";\n\nexport class DynamicSDFFontAtlases {\n\tprotected _atlases: Record<string, DynamicSDFFontAtlas>;\n\n\tconstructor() {\n\t\tthis._atlases = {};\n\t}\n\n\tbegin(): void {\n\t\tconst atlases = this._atlases;\n\t\tfor (const family in atlases) {\n\t\t\tconst atlas = atlases[family];\n\t\t\tatlas.begin();\n\t\t}\n\t}\n\n\tend(): void {\n\t\tconst atlases = this._atlases;\n\t\tfor (const family in atlases) {\n\t\t\tconst atlas = atlases[family];\n\t\t\tif (0 < atlas.length) {\n\t\t\t\tatlas.addAscii();\n\t\t\t}\n\t\t\tatlas.end();\n\t\t\tif (atlas.length <= 0) {\n\t\t\t\tatlas.destroy();\n\t\t\t\tdelete atlases[family];\n\t\t\t}\n\t\t}\n\t}\n\n\tadd(family: string, targets: string): void {\n\t\tconst atlas = this._atlases[family];\n\t\tif (atlas != null) {\n\t\t\tatlas.add(targets);\n\t\t} else {\n\t\t\tconst newAtlas = new DynamicSDFFontAtlas(family);\n\t\t\tnewAtlas.add(targets);\n\t\t\tthis._atlases[family] = newAtlas;\n\t\t}\n\t}\n\n\tget(family: string): DynamicSDFFontAtlas | null {\n\t\tconst atlas = this._atlases[family];\n\t\tif (atlas != null) {\n\t\t\treturn atlas;\n\t\t}\n\t\treturn null;\n\t}\n\n\tupdate(baseAtlas: DynamicAtlas): void {\n\t\tconst atlases = this._atlases;\n\t\tconst baseTexture = baseAtlas.getBaseTexture();\n\t\tfor (const family in atlases) {\n\t\t\tconst atlas = atlases[family];\n\t\t\tif (atlas.update()) {\n\t\t\t\tconst atlasId = atlas.id;\n\t\t\t\tconst item = baseAtlas.get(atlasId);\n\t\t\t\tif (item != null) {\n\t\t\t\t\tconst width = atlas.width;\n\t\t\t\t\tconst height = atlas.height;\n\t\t\t\t\tconst resolution = baseTexture.resolution;\n\t\t\t\t\titem.frame.width = width;\n\t\t\t\t\titem.frame.height = height;\n\t\t\t\t\titem.width = width / resolution;\n\t\t\t\t\titem.height = height / resolution;\n\t\t\t\t\tbaseAtlas.toDirty();\n\t\t\t\t} else {\n\t\t\t\t\tbaseAtlas.set(atlasId, new DynamicAtlasItemFontAtlas(atlas, baseTexture));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tdestroy(): void {\n\t\tconst atlases = this._atlases;\n\t\tfor (const family in atlases) {\n\t\t\tconst atlas = atlases[family];\n\t\t\tatlas.destroy();\n\t\t}\n\t\tthis._atlases = {};\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { BaseTexture } from \"pixi.js\";\nimport { DynamicAtlasItem } from \"./dynamic-atlas-item\";\n\nexport class DynamicAtlasItemImage extends DynamicAtlasItem {\n\timage: HTMLImageElement;\n\n\tconstructor(image: HTMLImageElement, baseTexture: BaseTexture) {\n\t\tsuper(\n\t\t\timage.src,\n\t\t\timage.width / baseTexture.resolution,\n\t\t\timage.height / baseTexture.resolution,\n\t\t\t0,\n\t\t\tbaseTexture\n\t\t);\n\t\tthis.image = image;\n\t}\n\n\trender(context: CanvasRenderingContext2D): void {\n\t\tconst frame = this.frame;\n\t\tconst x = frame.x;\n\t\tconst y = frame.y;\n\t\tconst w = frame.width;\n\t\tconst h = frame.height;\n\t\tconst image = this.image;\n\n\t\tcontext.drawImage(image, x, y, w, h);\n\n\t\tcontext.drawImage(image, 0, 0, 1, h, x - 1, y - 1, 1, h + 2);\n\t\tcontext.drawImage(image, 0, 0, w, 1, x, y - 1, w, 1);\n\t\tcontext.drawImage(image, w - 1, 0, 1, h, x + w, y - 1, 1, h + 2);\n\t\tcontext.drawImage(image, 0, h - 1, w, 1, x, y + h, w, 1);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Texture } from \"pixi.js\";\n\nexport class EShapeBufferUnit {\n\ttexture: Texture;\n\tindexOffset: number;\n\n\tconstructor(texture: Texture, indexOffset: number) {\n\t\tthis.texture = texture;\n\t\tthis.indexOffset = indexOffset;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { BaseTexture, Texture } from \"pixi.js\";\nimport { EShapeBufferUnit } from \"./e-shape-buffer-unit\";\n\nexport class EShapeBufferUnitBuilder {\n\tindex: number;\n\tbaseTexture: BaseTexture | null;\n\tunits: EShapeBufferUnit[];\n\n\tconstructor() {\n\t\tthis.index = 0;\n\t\tthis.baseTexture = null;\n\t\tthis.units = [];\n\t}\n\n\tbegin(): void {\n\t\tthis.index = 0;\n\t\tthis.baseTexture = null;\n\t}\n\n\tpush(texture: Texture, indexOffset: number): void {\n\t\tif (this.index < this.units.length) {\n\t\t\tconst unit = this.units[this.index];\n\t\t\tunit.texture = texture;\n\t\t\tunit.indexOffset = indexOffset;\n\t\t} else {\n\t\t\tthis.units.push(new EShapeBufferUnit(texture, indexOffset));\n\t\t}\n\t\tthis.index += 1;\n\t}\n\n\tend(): void {\n\t\tif (this.units.length !== this.index) {\n\t\t\tthis.units.length = this.index;\n\t\t}\n\t}\n\n\tdestroy(): void {\n\t\tthis.units.length = 0;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Buffer, DRAW_MODES, Geometry, Renderer, Shader, Texture } from \"pixi.js\";\nimport { EShape } from \"./e-shape\";\nimport { EShapeBufferUnitBuilder } from \"./e-shape-buffer-unit-builder\";\nimport { EShapeRendererIterator } from \"./e-shape-renderer-iterator\";\nimport { EShapeType } from \"./e-shape-type\";\nimport { EShapeUploaded } from \"./e-shape-uploaded\";\nimport { EShapeUploadeds } from \"./e-shape-uploadeds\";\n\nexport class EShapeBuffer {\n\tvertices: Float32Array;\n\tprotected _vertexCapacity: number;\n\tprotected _vertexCount: number;\n\tprotected _vertexBuffer: Buffer | null;\n\n\tclippings: Float32Array;\n\tprotected _clippingBuffer: Buffer | null;\n\n\tsteps: Float32Array;\n\tprotected _stepBuffer: Buffer | null;\n\n\tcolorFills: Float32Array;\n\tprotected _colorFillBuffer: Buffer | null;\n\n\tcolorStrokes: Float32Array;\n\tprotected _colorStrokeBuffer: Buffer | null;\n\n\tuvs: Float32Array;\n\tprotected _uvBuffer: Buffer | null;\n\n\tindices: Uint16Array | Uint32Array;\n\tprotected _indexCapacity: number;\n\tprotected _indexCount: number;\n\tindexCountRequested: number;\n\tprotected _indexBuffer: Buffer | null;\n\n\tprotected _renderer: Renderer;\n\tprotected _geometry: Geometry | null;\n\n\tprotected _builder: EShapeBufferUnitBuilder;\n\n\tconstructor(ntriangles: number, renderer: Renderer) {\n\t\tconst nindices = ntriangles * 3;\n\t\tconst nvertices = nindices;\n\n\t\tthis.vertices = new Float32Array(nvertices * 2);\n\t\tthis._vertexCapacity = nvertices;\n\t\tthis._vertexCount = 0;\n\t\tthis._vertexBuffer = null;\n\n\t\tthis.clippings = new Float32Array(nvertices * 3);\n\t\tthis._clippingBuffer = null;\n\n\t\tthis.steps = new Float32Array(nvertices * 6);\n\t\tthis._stepBuffer = null;\n\n\t\tthis.colorFills = new Float32Array(nvertices * 4);\n\t\tthis._colorFillBuffer = null;\n\n\t\tthis.colorStrokes = new Float32Array(nvertices * 4);\n\t\tthis._colorStrokeBuffer = null;\n\n\t\tthis.uvs = new Float32Array(nvertices * 2);\n\t\tthis._uvBuffer = null;\n\n\t\tconst isIndicesShort = nvertices <= 65535;\n\t\tthis.indices = isIndicesShort ? new Uint16Array(nindices) : new Uint32Array(nindices);\n\t\tthis._indexCapacity = ntriangles;\n\t\tthis._indexCount = 0;\n\t\tthis.indexCountRequested = 0;\n\t\tthis._indexBuffer = null;\n\n\t\tthis._renderer = renderer;\n\n\t\tthis._builder = new EShapeBufferUnitBuilder();\n\n\t\tthis._geometry = null;\n\t}\n\n\tupdateVertices(): void {\n\t\tconst vertexBuffer = this._vertexBuffer;\n\t\tif (vertexBuffer) {\n\t\t\tvertexBuffer.update();\n\t\t}\n\t}\n\n\tupdateClippings(): void {\n\t\tconst clippingBuffer = this._clippingBuffer;\n\t\tif (clippingBuffer) {\n\t\t\tclippingBuffer.update();\n\t\t}\n\t}\n\n\tupdateSteps(): void {\n\t\tconst stepBuffer = this._stepBuffer;\n\t\tif (stepBuffer) {\n\t\t\tstepBuffer.update();\n\t\t}\n\t}\n\n\tupdateColorFills(): void {\n\t\tconst colorFillBuffer = this._colorFillBuffer;\n\t\tif (colorFillBuffer) {\n\t\t\tcolorFillBuffer.update();\n\t\t}\n\t}\n\n\tupdateColorStrokes(): void {\n\t\tconst colorStrokeBuffer = this._colorStrokeBuffer;\n\t\tif (colorStrokeBuffer) {\n\t\t\tcolorStrokeBuffer.update();\n\t\t}\n\t}\n\n\tupdateUvs(): void {\n\t\tconst uvBuffer = this._uvBuffer;\n\t\tif (uvBuffer) {\n\t\t\tuvBuffer.update();\n\t\t}\n\t}\n\n\tupdateIndices(): void {\n\t\tconst indexBuffer = this._indexBuffer;\n\t\tif (indexBuffer) {\n\t\t\tindexBuffer.update();\n\t\t}\n\t}\n\n\tprotected getGeometry(): Geometry {\n\t\tlet result = this._geometry;\n\t\tif (result == null) {\n\t\t\tthis._vertexBuffer = new Buffer(this.vertices, false, false);\n\t\t\tthis._clippingBuffer = new Buffer(this.clippings, false, false);\n\t\t\tthis._stepBuffer = new Buffer(this.steps, false, false);\n\t\t\tthis._colorFillBuffer = new Buffer(this.colorFills, false, false);\n\t\t\tthis._colorStrokeBuffer = new Buffer(this.colorStrokes, false, false);\n\t\t\tthis._uvBuffer = new Buffer(this.uvs, false, false);\n\t\t\tthis._indexBuffer = new Buffer(this.indices, false, true);\n\n\t\t\tthis._geometry = result = new Geometry()\n\t\t\t\t.addIndex(this._indexBuffer)\n\t\t\t\t.addAttribute(\"aPosition\", this._vertexBuffer, 2)\n\t\t\t\t.addAttribute(\"aClipping\", this._clippingBuffer, 3)\n\t\t\t\t.addAttribute(\"aStep\", this._stepBuffer, 2)\n\t\t\t\t.addAttribute(\"aAntialias\", this._stepBuffer, 4)\n\t\t\t\t.addAttribute(\"aColorFill\", this._colorFillBuffer, 4)\n\t\t\t\t.addAttribute(\"aColorStroke\", this._colorStrokeBuffer, 4)\n\t\t\t\t.addAttribute(\"aUv\", this._uvBuffer, 2);\n\t\t}\n\t\treturn result;\n\t}\n\n\tupload(): void {\n\t\tthis._renderer.geometry.bind(this.getGeometry());\n\t}\n\n\trender(shader: Shader): void {\n\t\tconst renderer = this._renderer;\n\t\trenderer.geometry.bind(this.getGeometry());\n\n\t\tconst units = this._builder.units;\n\t\tconst unitCount = units.length;\n\t\tif (0 < unitCount) {\n\t\t\tconst type = DRAW_MODES.TRIANGLES;\n\n\t\t\tlet unit0 = null;\n\t\t\tlet unit1 = units[0];\n\t\t\tlet ioffset0 = 0;\n\t\t\tlet ioffset1 = unit1.indexOffset * 3;\n\t\t\tlet vcount = 0;\n\t\t\tlet texture = Texture.WHITE;\n\t\t\tfor (let i = 0, imax = unitCount - 1; i < imax; ++i) {\n\t\t\t\tunit0 = unit1;\n\t\t\t\tunit1 = units[i + 1];\n\t\t\t\tioffset0 = ioffset1;\n\t\t\t\tioffset1 = unit1.indexOffset * 3;\n\t\t\t\tvcount = ioffset1 - ioffset0;\n\t\t\t\ttexture = unit0.texture || Texture.WHITE;\n\t\t\t\tif (0 < vcount && texture.valid) {\n\t\t\t\t\tshader.uniforms.sampler = renderer.texture.bind(texture);\n\t\t\t\t\trenderer.geometry.draw(type, vcount, ioffset0);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvcount = this._indexCount * 3 - ioffset1;\n\t\t\ttexture = unit1.texture || Texture.WHITE;\n\t\t\tif (0 < vcount && texture.valid) {\n\t\t\t\tshader.uniforms.sampler = renderer.texture.bind(texture);\n\t\t\t\trenderer.geometry.draw(type, vcount, ioffset1);\n\t\t\t}\n\t\t}\n\t}\n\n\tisCompatible(shape: EShape, uploaded: EShapeUploaded, vindex: number, iindex: number): boolean {\n\t\treturn (\n\t\t\tuploaded.getBuffer() === this &&\n\t\t\tuploaded.getVertexOffset() === vindex &&\n\t\t\tuploaded.getIndexOffset() === iindex &&\n\t\t\tuploaded.isCompatible(shape)\n\t\t);\n\t}\n\n\tupdate(\n\t\titerator: EShapeRendererIterator,\n\t\tantialiasWeight: number,\n\t\tnoMoreThanOne: boolean\n\t): boolean {\n\t\tconst builder = this._builder;\n\t\tbuilder.begin();\n\n\t\tlet vindex = 0;\n\t\tlet iindex = 0;\n\t\tlet shape = iterator.get();\n\t\tfor (; shape != null; shape = iterator.next()) {\n\t\t\tconst uploaded = shape.uploaded;\n\t\t\tif (uploaded == null || !this.isCompatible(shape, uploaded, vindex, iindex)) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tuploaded.update(shape);\n\t\t\tuploaded.buildUnit(builder);\n\n\t\t\tvindex += uploaded.getVertexCount();\n\t\t\tiindex += uploaded.getIndexCount();\n\n\t\t\tif (noMoreThanOne) {\n\t\t\t\titerator.next();\n\t\t\t\tbuilder.end();\n\t\t\t\tthis._vertexCount = vindex;\n\t\t\t\tthis._indexCount = iindex;\n\t\t\t\treturn 0 < builder.units.length;\n\t\t\t}\n\t\t}\n\n\t\tfor (; shape != null; shape = iterator.next()) {\n\t\t\tconst creater = EShapeUploadeds[shape.type] || EShapeUploadeds[EShapeType.GROUP];\n\t\t\tif (creater == null) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tconst uploaded = creater(this, shape, vindex, iindex, antialiasWeight);\n\t\t\tif (uploaded == null) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tuploaded.buildUnit(builder);\n\t\t\tvindex += uploaded.getVertexCount();\n\t\t\tiindex += uploaded.getIndexCount();\n\n\t\t\tif (noMoreThanOne) {\n\t\t\t\titerator.next();\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tbuilder.end();\n\t\tthis._vertexCount = vindex;\n\t\tthis._indexCount = iindex;\n\t\treturn 0 < builder.units.length;\n\t}\n\n\tcheck(vindex: number, ioffset: number, vcount: number, icount: number): boolean {\n\t\tthis.indexCountRequested = icount;\n\t\treturn vindex + vcount <= this._vertexCapacity && ioffset + icount <= this._indexCapacity;\n\t}\n\n\tdestroy(): void {\n\t\tconst geometry = this._geometry;\n\t\tif (geometry) {\n\t\t\tgeometry.destroy();\n\t\t}\n\t\tthis._builder.destroy();\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"./e-shape\";\n\nconst DUMMY_SHAPES: EShape[] = [];\n\nexport class EShapeRendererIteratorDatum {\n\tprotected index: number;\n\tprotected shapes: EShape[];\n\n\tconstructor() {\n\t\tthis.index = 0;\n\t\tthis.shapes = DUMMY_SHAPES;\n\t}\n\n\treset(shapes: EShape[]): void {\n\t\tthis.index = -1;\n\t\tthis.shapes = shapes;\n\t}\n\n\tnext(): EShape | null {\n\t\tconst index = this.index + 1;\n\t\tthis.index = index;\n\t\tconst shapes = this.shapes;\n\t\tif (index < shapes.length) {\n\t\t\treturn shapes[index];\n\t\t}\n\t\treturn null;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"./e-shape\";\nimport { EShapeRendererIteratorDatum } from \"./e-shape-renderer-iterator-datum\";\n\nexport class EShapeRendererIterator {\n\tprotected _index: number;\n\tprotected _data: EShapeRendererIteratorDatum[];\n\tprotected _datum: EShapeRendererIteratorDatum;\n\tprotected _current: EShape | null;\n\n\tconstructor() {\n\t\tthis._index = -1;\n\t\tthis._datum = new EShapeRendererIteratorDatum();\n\t\tthis._data = [this._datum];\n\t\tthis._current = null;\n\t}\n\n\treset(shape: EShape | null, shapes: EShape[]): EShape | null {\n\t\tthis._index = 0;\n\t\tconst current = this._data[0];\n\t\tthis._datum = current;\n\t\tcurrent.reset(shapes);\n\t\tif (shape != null) {\n\t\t\tthis._current = shape;\n\t\t\treturn shape;\n\t\t}\n\t\treturn this.next();\n\t}\n\n\tget(): EShape | null {\n\t\treturn this._current;\n\t}\n\n\tnext(): EShape | null {\n\t\tconst datum = this._datum;\n\t\tconst shape = datum.next();\n\t\tif (shape != null) {\n\t\t\tthis._current = shape;\n\t\t\tconst children = shape.children;\n\t\t\tif (0 < children.length) {\n\t\t\t\tconst datumIndex = (this._index = this._index + 1);\n\t\t\t\tconst data = this._data;\n\t\t\t\tif (datumIndex < data.length) {\n\t\t\t\t\tconst newDatum = data[datumIndex];\n\t\t\t\t\tnewDatum.reset(children);\n\t\t\t\t\tthis._datum = newDatum;\n\t\t\t\t} else {\n\t\t\t\t\tconst newDatum = new EShapeRendererIteratorDatum();\n\t\t\t\t\tdata.push(newDatum);\n\t\t\t\t\tnewDatum.reset(children);\n\t\t\t\t\tthis._datum = newDatum;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn shape;\n\t\t} else {\n\t\t\tconst datumIndex = (this._index = this._index - 1);\n\t\t\tconst data = this._data;\n\t\t\tif (0 <= datumIndex) {\n\t\t\t\tthis._datum = data[datumIndex];\n\t\t\t\tthis._current = null;\n\t\t\t\treturn this.next();\n\t\t\t} else {\n\t\t\t\tthis._current = null;\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {\n\tBaseTexture,\n\tBLEND_MODES,\n\tObjectRenderer,\n\tRenderer,\n\tShader,\n\tTexture,\n\tutils\n} from \"pixi.js\";\nimport { DynamicAtlas } from \"../util/dynamic-atlas\";\nimport { DynamicAtlasItemImage } from \"../util/dynamic-atlas-item-image\";\nimport { DynamicSDFFontAtlases } from \"../util/dynamic-sdf-font-atlases\";\nimport { EShape } from \"./e-shape\";\nimport { EShapeBuffer } from \"./e-shape-buffer\";\nimport { EShapeContainer } from \"./e-shape-container\";\nimport { EShapeRendererIterator } from \"./e-shape-renderer-iterator\";\n\nconst VERTEX_SHADER = `\nattribute vec2 aPosition;\nattribute vec3 aClipping;\nattribute vec2 aStep;\nattribute vec4 aAntialias;\nattribute vec4 aColorFill;\nattribute vec4 aColorStroke;\nattribute vec2 aUv;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mediump float shapeScale;\nuniform mediump float pixelScale;\nuniform mediump float antialiasWeight;\n\nvarying mediump vec3 vClipping;\nvarying mediump vec2 vStep;\nvarying mediump vec4 vAntialias;\nvarying mediump vec4 vColorFill;\nvarying mediump vec4 vColorStroke;\nvarying mediump vec2 vUv;\n\nvec2 toInverse( in vec2 v ) {\n\treturn vec2( -v.y, v.x );\n}\n\nvec2 toTransformedPosition( in vec2 v ) {\n\treturn (projectionMatrix * translationMatrix * vec3(v, 1.0)).xy;\n}\n\nvec4 toAntialias01( in vec4 antialias ) {\n\t// Taylor series of 1 / ( 1 - a ) = 1 + a + a^2 + ....\n\treturn 1.0 + min( vec4( 1.0 ), antialias * pixelScale );\n}\n\nvec4 toAntialias2( in vec4 antialias, in float strokeWidth ) {\n\tfloat x = min( 0.4, 0.4 / 12.0 * antialias.x * pixelScale * antialiasWeight );\n\tfloat w = clamp( strokeWidth / antialias.y, 0.0, 1.0 ) * 0.4;\n\tfloat p = w * antialias.z + antialias.w;\n\tfloat y = 0.5 - p;\n\tfloat z = 0.5 - p - w;\n\treturn vec4( y, z, y - max( 0.01, y - x ), z - max( 0.01, z - x ) );\n}\n\nvec2 toPosition3456( in float type, in vec2 p, in vec2 pprev, in vec2 pnext, in float strokeWidth, out float shift ) {\n\tvec2 d0 = p - pprev;\n\tvec2 d1 = pnext - p;\n\tfloat l0 = dot( d0, d0 );\n\tfloat l1 = dot( d1, d1 );\n\tvec2 nd0 = normalize( toInverse( d0 ) );\n\tvec2 nd1 = normalize( toInverse( d1 ) );\n\tvec2 nd2 = 0.00001 < l1 ? nd1 : vec2(0.0, 0.0);\n\tvec2 n0 = 0.00001 < l0 ? nd0 : nd2;\n\tvec2 n1 = 0.00001 < l1 ? nd1 : n0;\n\tvec2 n0i = toInverse( n0 );\n\tvec2 n1i = toInverse( n1 );\n\tfloat direction = sign( 4.5 - type );\n\n\t// Offset\n\tfloat cross = dot( n0i, n1 );\n\tfloat crossInverse = ( 0.00001 < abs( cross ) ? 1.0 / cross : 0.0 );\n\tfloat b = dot(n1 - n0, n0) * crossInverse;\n\tfloat offsetSize = direction * strokeWidth * 0.5;\n\tvec2 offset = n1 + n1i * b;\n\n\t// Miter\n\tvec2 pmiter = p + offsetSize * offset;\n\tfloat miterAngle0 = dot( n0i, pmiter - pprev );\n\tfloat miterAngle1 = dot( n1i, pmiter - pnext );\n\tfloat miterLength = dot( offset, offset );\n\tfloat miterSide = direction * cross;\n\n\t// Bevel\n\tvec2 n = ( type == 4.0 || type == 6.0 ? n1 : n0 );\n\tvec2 pbevel = p + offsetSize * n;\n\n\t//\n\tvec2 presult = (\n\t\t0.0 <= miterSide ?\n\t\t( miterAngle0 < 0.0 && 0.0 <= miterAngle1 ? pmiter : pbevel ) :\n\t\t( miterLength < 6.0 ? pmiter : pbevel )\n\t);\n\tvec2 ni = ( type == 4.0 || type == 6.0 ? n1i : n0i );\n\tshift = dot( ni, p - presult );\n\treturn toTransformedPosition( presult );\n}\n\nvec2 toStep3456( in float type ) {\n\treturn ( type < 4.5 ? vec2( 1.0, 0.0 ) : vec2( 0.0, 1.0 ) );\n}\n\nvec4 toAntialias3456( in float strokeWidth ) {\n\tfloat a = antialiasWeight / max( 0.0001, strokeWidth );\n\treturn toAntialias01( vec4( a, a, a, a ) );\n}\n\nfloat toDotAndDashScale( in float scale, in float strokeWidthScale ) {\n\treturn (\n\t\tscale == 4.0 || scale == 5.0 || scale == 6.0 || scale == 7.0 ?\n\t\tstrokeWidthScale : 1.0\n\t);\n}\n\nvec4 toColorStroke3456( in float shift, in float scale ) {\n\tfloat x = aColorFill.x + shift;\n\tfloat y = scale * aColorFill.y;\n\tfloat z = scale * aColorFill.z;\n\tfloat w = aColorFill.w;\n\treturn vec4( x, y, z, w );\n}\n\nfloat toStrokeWidthScale( in float scale ) {\n\treturn (\n\t\tscale == 3.0 || scale == 7.0 ?\n\t\tshapeScale : (\n\t\t\tscale == 1.0 || scale == 5.0 ?\n\t\t\tmin( 1.0, shapeScale ) : (\n\t\t\t\tscale == 2.0 || scale == 6.0 ?\n\t\t\t\tmax( 1.0, shapeScale ) : 1.0\n\t\t\t)\n\t\t)\n\t);\n}\n\nvec2 toStep01(in vec2 size, in vec2 weight, in vec2 strokeWidth) {\n\treturn weight / max(vec2(0.00001), vec2(1.0) - strokeWidth / size);\n}\n\nvec4 toAntialias01b(in vec2 size, in vec2 strokeWidth) {\n\treturn antialiasWeight / max(vec4(0.00001), vec4(size - strokeWidth, size));\n}\n\nvoid main(void) {\n\tvec2 p012 = toTransformedPosition( aPosition );\n\n\tfloat type = aClipping.z;\n\tfloat strokeWidthScale = toStrokeWidthScale( aStep.y );\n\tfloat strokeWidth = strokeWidthScale * aStep.x;\n\n\t// type === 0 or 1\n\tvec2 size01 = aAntialias.xy;\n\tvec2 weight01 = abs(aAntialias.zw - sign(aAntialias.zw));\n\tvec2 strokeWidth01 = step(vec2(0.0), aAntialias.zw) * strokeWidth;\n\tvec2 step01 = toStep01( size01, weight01, strokeWidth01 );\n\tvec4 a01 = toAntialias01( toAntialias01b( size01, strokeWidth01 ) );\n\n\t// type === 2\n\tvec4 a2 = toAntialias2( aAntialias, strokeWidth );\n\n\t// type === 3, 4, 5 or 6\n\tfloat shift3456 = 0.0;\n\tvec2 p3456 = toPosition3456( type, aPosition, aAntialias.xy, aAntialias.zw, strokeWidth, shift3456 );\n\tvec2 step3456 = toStep3456( type );\n\tvec4 a3456 = toAntialias3456( strokeWidth );\n\tvec4 colorStroke3456 = toColorStroke3456( shift3456, toDotAndDashScale( aStep.y, strokeWidthScale ) );\n\n\t//\n\tgl_Position = vec4( ( 2.5 < type ? p3456 : p012 ), 0.0, 1.0 );\n\tvAntialias = ( 1.5 < type ? ( 2.5 < type ? a3456 : a2 ) : a01 );\n\tvClipping = aClipping;\n\tvStep = ( 2.5 < type ? step3456 : step01 );\n\tvColorFill = ( 2.5 < type ? aColorStroke : aColorFill );\n\tvColorStroke = ( 2.5 < type ? colorStroke3456 : aColorStroke );\n\tvUv = aUv;\n}`;\n\nconst FRAGMENT_SHADER = `\nvarying mediump vec3 vClipping;\nvarying mediump vec2 vStep;\nvarying mediump vec4 vAntialias;\nvarying mediump vec4 vColorFill;\nvarying mediump vec4 vColorStroke;\nvarying mediump vec2 vUv;\n\nuniform sampler2D sampler;\nuniform mediump float pixelScale;\n\nvoid main(void) {\n\tvec4 texture = texture2D(sampler, vUv);\n\tfloat type = vClipping.z;\n\tvec2 v0 = vStep;\n\tvec2 v1 = vClipping.xy;\n\tvec2 v2 = v0 * vAntialias.xy;\n\tvec2 v3 = v1 * vAntialias.zw;\n\tvec2 d01 = ( v0.x < v0.y ? vec2( v0.y, v2.y ) : vec2( v0.x, v2.x ) );\n\tvec2 d02 = ( v1.x < v1.y ? vec2( v1.y, v3.y ) : vec2( v1.x, v3.x ) );\n\tvec4 d0 = vec4( d01.x, d02.x, d01.y, d02.y );\n\tvec4 d1 = vec4( dot( v0, v0 ), dot( v1, v1 ), dot( v2, v2 ), dot( v3, v3 ) );\n\tvec4 d = ( type == 1.0 ? d1 : d0 );\n\tvec2 s = smoothstep( 1.0 - (d.zw - d.xy), vec2( 1.0 ), d.xy );\n\tvec4 color01 = texture * (vColorStroke * (s.x - s.y) + vColorFill * (1.0 - s.x));\n\n\tfloat l = vColorStroke.x;\n\tfloat lp0 = vColorStroke.y;\n\tfloat lp1 = vColorStroke.z;\n\tfloat lt = vColorStroke.w;\n\tfloat ld = 0.5 * pixelScale;\n\tfloat lm = mod( l, lp0 + lp1 );\n\tfloat ls0 = ( 0.0 < lp1 ? smoothstep( 0.0, ld, lm ) - smoothstep( lp0, lp0 + ld, lm ) : 1.0 );\n\tfloat ls1 = ( 0.0 <= lt ? smoothstep( 0.0, ld, l ) - smoothstep( lt - ld, lt, l ) : 1.0 );\n\tvec4 color3456 = color01 * ls0 * ls1;\n\n\tvec2 a0 = vAntialias.xy;\n\tvec2 a1 = vAntialias.zw;\n\tvec2 a2 = vec2( texture.a );\n\tvec2 a = smoothstep( a0 - a1, a0 + a1, a2 );\n\tvec4 color2 = a.x * vColorFill + ( a.y - a.x ) * vColorStroke;\n\tgl_FragColor = ( type == 2.0 ? color2 : (2.5 < type ? color3456 : color01) );\n}`;\n\nexport class EShapeRenderer extends ObjectRenderer {\n\tstatic SHADER: Shader | null = null;\n\n\tprotected _shader: Shader | null;\n\tprotected _iterator: EShapeRendererIterator;\n\tprotected _bufferSizeMax: number;\n\n\tconstructor(renderer: Renderer) {\n\t\tsuper(renderer);\n\t\tEShapeRenderer.SHADER =\n\t\t\tEShapeRenderer.SHADER || Shader.from(VERTEX_SHADER, FRAGMENT_SHADER);\n\t\tthis._shader = EShapeRenderer.SHADER;\n\t\tthis._iterator = new EShapeRendererIterator();\n\t\tthis._bufferSizeMax = this.getBufferSizeMax(renderer);\n\t}\n\n\tprotected getBufferSizeMax(renderer: Renderer): number {\n\t\tconst context = renderer.context;\n\t\tconst extensions = context.extensions as any;\n\t\tif (1 < context.webGLVersion || !!extensions.uint32ElementIndex) {\n\t\t\treturn 1431655765; // 2^32 / 3\n\t\t}\n\t\treturn 21845; // 2^16 / 3\n\t}\n\n\tupdateAtlas(\n\t\tshape: EShape,\n\t\tatlas: DynamicAtlas,\n\t\tfontAtlases: DynamicSDFFontAtlases,\n\t\tdefaultTexture: Texture,\n\t\tbaseTexture: BaseTexture\n\t): void {\n\t\t// Texture\n\t\t// Do not access the shape.image.src here.\n\t\t// It slows down the rendering speed significantly.\n\t\tconst imageSrc = shape.imageSrc;\n\t\tif (imageSrc != null) {\n\t\t\tconst textureItem = atlas.get(imageSrc);\n\t\t\tif (textureItem != null) {\n\t\t\t\tshape.texture = textureItem.texture;\n\t\t\t} else {\n\t\t\t\tconst image = shape.image;\n\t\t\t\tif (image != null) {\n\t\t\t\t\tconst newTextureItem = new DynamicAtlasItemImage(image, baseTexture);\n\t\t\t\t\tshape.texture = newTextureItem.texture;\n\t\t\t\t\tatlas.set(newTextureItem.id, newTextureItem);\n\t\t\t\t} else {\n\t\t\t\t\tshape.texture = defaultTexture;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tshape.texture = defaultTexture;\n\t\t}\n\n\t\t// Font texture atlas\n\t\tconst text = shape.text;\n\t\tconst textValue = text.value;\n\t\tif (0 < textValue.length) {\n\t\t\tfontAtlases.add(text.family, textValue);\n\t\t}\n\t}\n\n\tupdateAtlases(\n\t\tshapes: EShape[],\n\t\tatlas: DynamicAtlas,\n\t\tfontAtlases: DynamicSDFFontAtlases,\n\t\tdefaultTexture: Texture,\n\t\tbaseTexture: BaseTexture\n\t): void {\n\t\tfor (let i = 0, imax = shapes.length; i < imax; ++i) {\n\t\t\tconst shape = shapes[i];\n\t\t\tthis.updateAtlas(shape, atlas, fontAtlases, defaultTexture, baseTexture);\n\t\t\tconst children = shape.children;\n\t\t\tfor (let j = 0, jmax = children.length; j < jmax; ++j) {\n\t\t\t\tconst child = children[j];\n\t\t\t\tthis.updateAtlas(child, atlas, fontAtlases, defaultTexture, baseTexture);\n\t\t\t\tthis.updateAtlases(child.children, atlas, fontAtlases, defaultTexture, baseTexture);\n\t\t\t}\n\t\t}\n\t}\n\n\tupdateFontAtlas(\n\t\tshape: EShape,\n\t\tatlas: DynamicAtlas,\n\t\tfontAtlases: DynamicSDFFontAtlases,\n\t\tdefaultTexture: Texture\n\t): void {\n\t\tconst text = shape.text;\n\t\tconst fontAtlas = fontAtlases.get(text.family);\n\t\tif (fontAtlas != null) {\n\t\t\tconst textureItem = atlas.get(fontAtlas.id);\n\t\t\tif (textureItem != null) {\n\t\t\t\ttext.atlas = fontAtlas;\n\t\t\t\ttext.texture = textureItem.texture;\n\t\t\t} else {\n\t\t\t\ttext.atlas = undefined;\n\t\t\t\ttext.texture = defaultTexture;\n\t\t\t}\n\t\t} else {\n\t\t\ttext.atlas = undefined;\n\t\t\ttext.texture = defaultTexture;\n\t\t}\n\t}\n\n\tupdateFontAtlases(\n\t\tshapes: EShape[],\n\t\tatlas: DynamicAtlas,\n\t\tfontAtlases: DynamicSDFFontAtlases,\n\t\tdefaultTexture: Texture\n\t): void {\n\t\tfor (let i = 0, imax = shapes.length; i < imax; ++i) {\n\t\t\tconst shape = shapes[i];\n\t\t\tthis.updateFontAtlas(shape, atlas, fontAtlases, defaultTexture);\n\t\t\tconst children = shape.children;\n\t\t\tfor (let j = 0, jmax = children.length; j < jmax; ++j) {\n\t\t\t\tconst child = children[j];\n\t\t\t\tthis.updateFontAtlas(child, atlas, fontAtlases, defaultTexture);\n\t\t\t\tthis.updateFontAtlases(child.children, atlas, fontAtlases, defaultTexture);\n\t\t\t}\n\t\t}\n\t}\n\n\trender_(\n\t\tcontainer: EShapeContainer,\n\t\tshape: EShape | null,\n\t\tshapes: EShape[],\n\t\tisDirty: boolean\n\t): void {\n\t\tconst renderer = this.renderer;\n\t\tconst shader = this._shader;\n\n\t\tif (shader != null && (shape != null || 0 < shapes.length)) {\n\t\t\tconst resolution = renderer.resolution;\n\t\t\tconst buffers = container.getBuffers();\n\t\t\tconst antialiasWeight = container.getAntialiasWeight(resolution);\n\n\t\t\t// Update textures\n\t\t\tif (isDirty) {\n\t\t\t\t// Atlases\n\t\t\t\tconst atlas = container.getAtlas(resolution);\n\t\t\t\tconst fontAtlases = container.getFontAtlases();\n\t\t\t\tatlas.begin();\n\t\t\t\tfontAtlases.begin();\n\t\t\t\tconst defaultTexture = atlas.getDefaultTexture();\n\t\t\t\tconst baseTexture: BaseTexture = atlas.getBaseTexture();\n\t\t\t\tthis.updateAtlases(shapes, atlas, fontAtlases, defaultTexture, baseTexture);\n\t\t\t\tfontAtlases.end();\n\t\t\t\tfontAtlases.update(atlas);\n\t\t\t\tthis.updateFontAtlases(shapes, atlas, fontAtlases, defaultTexture);\n\t\t\t\tatlas.end();\n\t\t\t\tatlas.repack();\n\n\t\t\t\t// Update buffers\n\t\t\t\tthis.updateBuffers(shape, shapes, buffers, renderer, antialiasWeight);\n\t\t\t}\n\n\t\t\t// Render buffers\n\t\t\tshader.uniforms.shapeScale = container.toShapeScale();\n\t\t\tshader.uniforms.pixelScale = container.toPixelScale(resolution);\n\t\t\tshader.uniforms.antialiasWeight = antialiasWeight;\n\t\t\tshader.uniforms.translationMatrix = container.worldTransform.toArray(true);\n\t\t\trenderer.shader.bind(shader, false);\n\t\t\trenderer.state.setBlendMode(utils.correctBlendMode(BLEND_MODES.NORMAL, true));\n\t\t\tconst buffersLength = buffers.length;\n\t\t\tif (1 < buffersLength) {\n\t\t\t\tfor (let i = 0; i < buffersLength; ++i) {\n\t\t\t\t\tbuffers[i].upload();\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (let i = 0; i < buffersLength; ++i) {\n\t\t\t\tbuffers[i].render(shader);\n\t\t\t}\n\t\t}\n\t}\n\n\tupdateBuffers(\n\t\tshape: EShape | null,\n\t\tshapes: EShape[],\n\t\tbuffers: EShapeBuffer[],\n\t\trenderer: Renderer,\n\t\tantialiasWeight: number\n\t): void {\n\t\tconst iterator = this._iterator;\n\t\titerator.reset(shape, shapes);\n\n\t\tlet ib = 0;\n\t\tlet bufferSize = 0;\n\t\tconst bufferSizeBase = 5000;\n\t\tconst bufferSizeMax = this._bufferSizeMax;\n\t\twhile (iterator.get() != null) {\n\t\t\tlet buffer: EShapeBuffer | null = null;\n\t\t\tlet noMoreThanOne = false;\n\t\t\tif (0 < bufferSize) {\n\t\t\t\tbuffer = new EShapeBuffer(bufferSize, renderer);\n\t\t\t\tbuffers.splice(ib, 0, buffer);\n\t\t\t\tnoMoreThanOne = true;\n\t\t\t} else if (ib < buffers.length) {\n\t\t\t\tbuffer = buffers[ib];\n\t\t\t\tnoMoreThanOne = false;\n\t\t\t} else {\n\t\t\t\tbuffer = new EShapeBuffer(bufferSizeBase, renderer);\n\t\t\t\tbuffers.push(buffer);\n\t\t\t\tnoMoreThanOne = false;\n\t\t\t}\n\t\t\tif (buffer.update(iterator, antialiasWeight, noMoreThanOne)) {\n\t\t\t\tbufferSize = 0;\n\t\t\t\tib += 1;\n\t\t\t} else {\n\t\t\t\tbufferSize = buffer.indexCountRequested;\n\t\t\t\tif (bufferSize <= bufferSizeMax) {\n\t\t\t\t\tbufferSize = Math.ceil(bufferSize / bufferSizeBase) * bufferSizeBase;\n\t\t\t\t\tbufferSize = Math.min(bufferSize, bufferSizeMax);\n\t\t\t\t} else {\n\t\t\t\t\t// No way to render\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (ib < buffers.length) {\n\t\t\tfor (let jb = ib, ibmax = buffers.length; jb < ibmax; ++jb) {\n\t\t\t\tbuffers[jb].destroy();\n\t\t\t}\n\t\t\tbuffers.length = ib;\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DisplayObject, IPoint, Point, Renderer } from \"pixi.js\";\nimport { DynamicAtlas } from \"../util/dynamic-atlas\";\nimport { DynamicSDFFontAtlases } from \"../util/dynamic-sdf-font-atlases\";\nimport { EShape } from \"./e-shape\";\nimport { EShapeBuffer } from \"./e-shape-buffer\";\nimport { EShapeRenderer } from \"./e-shape-renderer\";\n\nexport class EShapeContainer extends DisplayObject {\n\tprotected _shapeRenderer: EShapeRenderer | null = null;\n\n\treadonly children: EShape[];\n\tprotected _shape: EShape | null;\n\tprotected _childrenId: number;\n\tprotected _childrenIdRendered: number;\n\n\tprotected _atlas: DynamicAtlas | null;\n\tprotected _fontAtlases: DynamicSDFFontAtlases;\n\n\tprotected _pixelScale: number;\n\tprotected _pixelScaleId: number;\n\tprotected _shapeScale: number;\n\tprotected _shapeScaleId: number;\n\n\tprotected _work: Point;\n\n\tprotected _buffers: EShapeBuffer[];\n\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.children = [];\n\t\tthis._shape = null;\n\t\tthis._childrenId = 0;\n\t\tthis._childrenIdRendered = -1;\n\n\t\tthis._atlas = null;\n\t\tthis._fontAtlases = new DynamicSDFFontAtlases();\n\n\t\tthis._pixelScale = 1;\n\t\tthis._pixelScaleId = NaN;\n\t\tthis._shapeScale = 1;\n\t\tthis._shapeScaleId = NaN;\n\n\t\tthis._work = new Point();\n\n\t\tthis._buffers = [];\n\t}\n\n\tcalculateBounds(): void {\n\t\tthis._bounds.clear();\n\t}\n\n\tonChildTransformChange(): void {\n\t\t// DO NOTHING\n\t}\n\n\ttoDirty(): number {\n\t\treturn (this._childrenId += 1);\n\t}\n\n\tisDirty(): boolean {\n\t\treturn this._childrenIdRendered < this._childrenId;\n\t}\n\n\trender(renderer: Renderer): void {\n\t\tif (!this.visible || this.worldAlpha <= 0 || !this.renderable) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst childrenId = this._childrenId;\n\t\tconst childrenIdRendered = this._childrenIdRendered;\n\t\tthis._childrenIdRendered = childrenId;\n\t\tconst isChildrenDirty = childrenIdRendered < childrenId;\n\n\t\tlet shapeRenderer: EShapeRenderer | null = this._shapeRenderer;\n\t\tif (shapeRenderer == null) {\n\t\t\tshapeRenderer = this._shapeRenderer = new EShapeRenderer(renderer);\n\t\t}\n\t\trenderer.batch.setObjectRenderer(shapeRenderer);\n\n\t\tconst mask = this.mask;\n\t\tconst shape = this._shape;\n\t\tconst shapes = this.children;\n\t\tif (mask) {\n\t\t\trenderer.mask.push(this, mask);\n\t\t\tshapeRenderer.render_(this, shape, shapes, isChildrenDirty);\n\t\t\trenderer.mask.pop(this);\n\t\t} else {\n\t\t\tshapeRenderer.render_(this, shape, shapes, isChildrenDirty);\n\t\t}\n\t}\n\n\tcontainsPoint(point: Point): boolean {\n\t\treturn false;\n\t}\n\n\tgetFontAtlases(): DynamicSDFFontAtlases {\n\t\treturn this._fontAtlases;\n\t}\n\n\tgetAtlas(resolution: number): DynamicAtlas {\n\t\tlet atlas = this._atlas;\n\t\tif (atlas == null) {\n\t\t\tatlas = new DynamicAtlas(resolution);\n\t\t\tthis._atlas = atlas;\n\t\t}\n\t\treturn atlas;\n\t}\n\n\tgetBuffers(): EShapeBuffer[] {\n\t\treturn this._buffers;\n\t}\n\n\ttoShapeScale(): number {\n\t\tthis.updateTransform();\n\t\tconst transform = this.transform;\n\t\tconst worldID = (transform as any)._worldID;\n\t\tif (worldID !== this._shapeScaleId) {\n\t\t\tthis._shapeScaleId = worldID;\n\t\t\tconst worldTransform = transform.worldTransform;\n\t\t\tconst a = worldTransform.a;\n\t\t\tconst b = worldTransform.b;\n\t\t\tthis._shapeScale = 1 / Math.sqrt(a * a + b * b);\n\t\t}\n\t\treturn this._shapeScale;\n\t}\n\n\tgetShapeScale(): number {\n\t\treturn this._shapeScale;\n\t}\n\n\ttoPixelScale(resolution: number): number {\n\t\tconst shapeScale = this.toShapeScale();\n\t\tconst shapeScaleId = this._shapeScaleId;\n\t\tif (this._pixelScaleId !== shapeScaleId) {\n\t\t\tthis._pixelScaleId = shapeScaleId;\n\t\t\tthis._pixelScale = (1 / resolution) * shapeScale;\n\t\t}\n\t\treturn this._pixelScale;\n\t}\n\n\tgetPixelScale(): number {\n\t\treturn this._pixelScale;\n\t}\n\n\tgetAntialiasWeight(resolution: number): number {\n\t\treturn 1.25 / resolution;\n\t}\n\n\thitTest(global: IPoint, onHit?: (shape: EShape) => boolean): EShape | null {\n\t\tconst local = this._work;\n\t\tconst children = this.children;\n\t\tfor (let i = children.length - 1; 0 <= i; --i) {\n\t\t\tconst child = children[i];\n\t\t\tif (child.visible) {\n\t\t\t\tchild.toLocal(global, undefined, local);\n\t\t\t\tconst result = child.contains(local.x, local.y);\n\t\t\t\tif (result != null) {\n\t\t\t\t\tif (onHit == null || onHit(result)) {\n\t\t\t\t\t\treturn result;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\thitTestBBox(global: IPoint, onHit?: (shape: EShape) => boolean): EShape | null {\n\t\tconst local = this._work;\n\t\tconst children = this.children;\n\t\tfor (let i = children.length - 1; 0 <= i; --i) {\n\t\t\tconst child = children[i];\n\t\t\tif (child.visible) {\n\t\t\t\tchild.toLocal(global, undefined, local);\n\t\t\t\tif (child.containsBBox(local.x, local.y)) {\n\t\t\t\t\tif (onHit == null || onHit(child)) {\n\t\t\t\t\t\treturn child;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tdestroy(): void {\n\t\t// Buffer\n\t\tconst buffers = this._buffers;\n\t\tif (buffers != null) {\n\t\t\tfor (let i = 0, imax = buffers.length; i < imax; ++i) {\n\t\t\t\tbuffers[i].destroy();\n\t\t\t}\n\t\t}\n\t\tthis._buffers.length = 0;\n\n\t\t// Shapes\n\t\tconst children = this.children;\n\t\tfor (let i = children.length - 1; 0 <= i; --i) {\n\t\t\tchildren[i].destroy();\n\t\t}\n\t\tchildren.length = 0;\n\n\t\t//\n\t\tsuper.destroy();\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBaseStateSet } from \"./d-base-state-set\";\nimport { EShape } from \"./shape/e-shape\";\nimport { EShapeContainer } from \"./shape/e-shape-container\";\nimport { EShapeType } from \"./shape/e-shape-type\";\n\nexport interface DDiagramLayersShape {\n\tparent: EShapeContainer | EShape | null;\n}\n\nexport interface DDiagramLayersShapeContainer extends EShapeContainer {\n\tstate: DBaseStateSet;\n}\n\nexport type DDiagramLayersLayer = DDiagramLayersShapeContainer | EShape;\n\nexport class DDiagramLayers {\n\tstatic toLayers(shape: DDiagramLayersShape, indices: number[]): DDiagramLayersLayer[] {\n\t\tconst result: DDiagramLayersLayer[] = [];\n\t\tconst layer = this.toLayer(shape);\n\t\tif (layer) {\n\t\t\tconst container = layer.parent;\n\t\t\tif (container) {\n\t\t\t\tconst children = container.children as DDiagramLayersLayer[];\n\t\t\t\tconst childrenLength = children.length;\n\t\t\t\tfor (let i = 0, imax = indices.length; i < imax; ++i) {\n\t\t\t\t\tconst index = indices[i];\n\t\t\t\t\tif (0 <= index && index < childrenLength) {\n\t\t\t\t\t\tresult.push(children[index]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tstatic toLayer(shape: DDiagramLayersShape): DDiagramLayersLayer | null | undefined {\n\t\tlet parent = shape.parent;\n\t\twhile (parent != null) {\n\t\t\tif (parent instanceof EShapeContainer) {\n\t\t\t\treturn parent as DDiagramLayersShapeContainer;\n\t\t\t}\n\t\t\tif (parent.type === EShapeType.EMBEDDED_LAYER) {\n\t\t\t\treturn parent;\n\t\t\t}\n\t\t\tparent = parent.parent;\n\t\t}\n\t\treturn null;\n\t}\n\n\tstatic show(target: DDiagramLayersLayer): boolean {\n\t\tif (!target.visible) {\n\t\t\ttarget.visible = true;\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tstatic showAll(targets: DDiagramLayersLayer[]): boolean {\n\t\tlet isChanged = false;\n\t\tfor (let i = 0, imax = targets.length; i < imax; ++i) {\n\t\t\tconst layer = targets[i];\n\t\t\tif (!layer.visible) {\n\t\t\t\tlayer.visible = true;\n\t\t\t\tisChanged = true;\n\t\t\t}\n\t\t}\n\t\treturn isChanged;\n\t}\n\n\tstatic hide(target: DDiagramLayersLayer): boolean {\n\t\tif (target.visible) {\n\t\t\ttarget.visible = false;\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tstatic hideAll(targets: DDiagramLayersLayer[]): boolean {\n\t\tlet isChanged = false;\n\t\tfor (let i = 0, imax = targets.length; i < imax; ++i) {\n\t\t\tconst layer = targets[i];\n\t\t\tif (layer.visible) {\n\t\t\t\tlayer.visible = false;\n\t\t\t\tisChanged = true;\n\t\t\t}\n\t\t}\n\t\treturn isChanged;\n\t}\n\n\tstatic bringToFront(target: DDiagramLayersLayer): boolean {\n\t\tconst parent = target.parent;\n\t\tif (parent) {\n\t\t\treturn this.doBringToFront(target, parent.children, 0);\n\t\t}\n\t\treturn false;\n\t}\n\n\tstatic bringAllToFront(targets: DDiagramLayersLayer[]): boolean {\n\t\tconst targetsLength = targets.length;\n\t\tif (0 < targetsLength) {\n\t\t\tconst parent = targets[0].parent;\n\t\t\tif (parent) {\n\t\t\t\tlet isChanged = false;\n\t\t\t\tconst layers = parent.children;\n\t\t\t\tfor (let i = 0; i < targetsLength; ++i) {\n\t\t\t\t\tconst layer = targets[targetsLength - 1 - i];\n\t\t\t\t\tif (this.doBringToFront(layer, layers, i)) {\n\t\t\t\t\t\tisChanged = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn isChanged;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tprotected static doBringToFront(target: unknown, layers: unknown[], offset: number): boolean {\n\t\tconst layersLength = layers.length;\n\t\tconst ito = layersLength - 1 - offset;\n\t\tfor (let i = ito; 0 <= i; --i) {\n\t\t\tconst child = layers[i];\n\t\t\tif (child === target) {\n\t\t\t\tif (i !== ito) {\n\t\t\t\t\tfor (let j = i + 1; j <= ito; ++j) {\n\t\t\t\t\t\tlayers[j - 1] = layers[j];\n\t\t\t\t\t}\n\t\t\t\t\tlayers[ito] = child;\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction, Point } from \"pixi.js\";\nimport InteractionEvent = interaction.InteractionEvent;\nimport { DDiagramLayers, DDiagramLayersLayer } from \"../../d-diagram-layers\";\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\nimport { EShapeActionRuntimeConditional } from \"./e-shape-action-runtime-conditional\";\nimport { EShapeActionValueMiscLayerGesture } from \"./e-shape-action-value-misc-layer-gesture\";\nimport { DApplications } from \"../../d-applications\";\nimport { UtilGesture } from \"../../util/util-gesture\";\nimport { EShapeActionValueMiscGestureType } from \"./e-shape-action-value-misc-gesture-type\";\n\nexport class EShapeActionRuntimeMiscLayerGesture extends EShapeActionRuntimeConditional {\n\tprotected static GESTURE_UTIL?: UtilGesture<DDiagramLayersLayer>;\n\tprotected _layers: Map<EShape, DDiagramLayersLayer>;\n\tprotected _gestureType: EShapeActionValueMiscGestureType;\n\tprotected _scaleMin: number;\n\tprotected _scaleMax: number;\n\n\tconstructor(value: EShapeActionValueMiscLayerGesture) {\n\t\tsuper(value, EShapeRuntimeReset.NONE);\n\t\tthis._layers = new Map<EShape, DDiagramLayersLayer>();\n\t\tthis._gestureType = value.gestureType;\n\t\tthis._scaleMin = value.scaleMin;\n\t\tthis._scaleMax = value.scaleMax;\n\t}\n\n\tinitialize(shape: EShape, runtime: EShapeRuntime): void {\n\t\tsuper.initialize(shape, runtime);\n\n\t\tconst layers = this._layers;\n\t\tconst layer = layers.get(shape);\n\t\tif (layer == null) {\n\t\t\tconst newLayer = DDiagramLayers.toLayer(shape);\n\t\t\tif (newLayer != null) {\n\t\t\t\tthis._layers.set(shape, newLayer);\n\t\t\t}\n\t\t}\n\t}\n\n\tonDown(shape: EShape, runtime: EShapeRuntime, e: InteractionEvent | KeyboardEvent): void {\n\t\tsuper.onDown(shape, runtime, e);\n\n\t\tif (e instanceof InteractionEvent) {\n\t\t\tconst layer = this._layers.get(shape);\n\t\t\tif (layer && this.condition(shape, e.data.originalEvent.timeStamp)) {\n\t\t\t\tthis.getGestureUtil().onDown(layer, e);\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected getGestureUtil(): UtilGesture<DDiagramLayersLayer> {\n\t\treturn (EShapeActionRuntimeMiscLayerGesture.GESTURE_UTIL ??= this.newGestureUtil());\n\t}\n\n\tprotected newGestureUtil(): UtilGesture<DDiagramLayersLayer> {\n\t\tconst work = new Point();\n\t\treturn new UtilGesture<DDiagramLayersLayer>({\n\t\t\ton: {\n\t\t\t\tmove: (\n\t\t\t\t\ttarget: DDiagramLayersLayer,\n\t\t\t\t\tdx: number,\n\t\t\t\t\tdy: number,\n\t\t\t\t\tx: number,\n\t\t\t\t\ty: number,\n\t\t\t\t\tds: number\n\t\t\t\t): void => {\n\t\t\t\t\tthis.onGestureMove(target, dx, dy, x, y, ds, work);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tprotected onGestureMove(\n\t\tlayer: DDiagramLayersLayer,\n\t\tdx: number,\n\t\tdy: number,\n\t\tx: number,\n\t\ty: number,\n\t\tds: number,\n\t\twork: Point\n\t): void {\n\t\tconst parent = layer.parent;\n\t\tif (parent) {\n\t\t\tconst transform = layer.transform;\n\t\t\tconst gestureType = this._gestureType;\n\t\t\tlet isChanged = false;\n\n\t\t\t// Scale\n\t\t\tlet scaleRatio = 1;\n\t\t\tif (gestureType & EShapeActionValueMiscGestureType.PINCH) {\n\t\t\t\tconst scale = transform.scale;\n\t\t\t\tconst oldScale = scale.y;\n\t\t\t\tconst newScale = Math.min(this._scaleMax, Math.max(this._scaleMin, oldScale * ds));\n\t\t\t\tscaleRatio = newScale / oldScale;\n\t\t\t\tscale.set(newScale, newScale);\n\t\t\t\tisChanged = true;\n\t\t\t}\n\n\t\t\t// Position\n\t\t\tif (gestureType & EShapeActionValueMiscGestureType.DRAG) {\n\t\t\t\tparent.toLocal(work.set(x, y), undefined, work);\n\t\t\t\tconst lx = work.x;\n\t\t\t\tconst ly = work.y;\n\t\t\t\tconst cx = x - dx;\n\t\t\t\tconst cy = y - dy;\n\t\t\t\tparent.toLocal(work.set(cx, cy), undefined, work);\n\t\t\t\tconst lcx = work.x;\n\t\t\t\tconst lcy = work.y;\n\t\t\t\tconst position = transform.position;\n\t\t\t\tconst newX = (position.x - lcx) * scaleRatio + lx;\n\t\t\t\tconst newY = (position.y - lcy) * scaleRatio + ly;\n\t\t\t\tposition.set(newX, newY);\n\t\t\t\tisChanged = true;\n\t\t\t}\n\n\t\t\t// Update\n\t\t\tif (isChanged) {\n\t\t\t\tDApplications.update(layer);\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected toSize(layer: DDiagramLayersLayer, result: Point): Point {\n\t\tif (\"size\" in layer) {\n\t\t\tresult.copyFrom(layer.size);\n\t\t} else {\n\t\t\tresult.set((layer as any).width, (layer as any).height);\n\t\t}\n\t\treturn result;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShapeActionRuntime } from \"./e-shape-action-runtime\";\nimport { EShapeActionRuntimeMiscLayerGesture } from \"./e-shape-action-runtime-misc-layer-gesture\";\nimport { EShapeActionValueMiscGestureType } from \"./e-shape-action-value-misc-gesture-type\";\nimport { EShapeActionValueMiscType } from \"./e-shape-action-value-misc-type\";\nimport { EShapeActionValueSubtyped } from \"./e-shape-action-value-subtyped\";\nimport { EShapeActionValueType } from \"./e-shape-action-value-type\";\nimport { EShapeActionValues } from \"./e-shape-action-values\";\n\nexport type EShapeActionValueMiscLayerGestureSerialized = [\n\ttypeof EShapeActionValueType.MISC,\n\tnumber,\n\ttypeof EShapeActionValueMiscType.LAYER_GESTURE,\n\tEShapeActionValueMiscGestureType,\n\tnumber, // Minimum scale\n\tnumber // Maximum scale\n];\n\nexport class EShapeActionValueMiscLayerGesture extends EShapeActionValueSubtyped<\n\ttypeof EShapeActionValueMiscType.LAYER_GESTURE\n> {\n\treadonly gestureType: EShapeActionValueMiscGestureType;\n\treadonly scaleMin: number;\n\treadonly scaleMax: number;\n\n\tconstructor(\n\t\tcondition: string = \"\",\n\t\tgestureType: EShapeActionValueMiscGestureType = EShapeActionValueMiscGestureType.ALL,\n\t\tscaleMin: number = 0.05,\n\t\tscaleMax: number = 20\n\t) {\n\t\tsuper(EShapeActionValueType.MISC, condition, EShapeActionValueMiscType.LAYER_GESTURE);\n\t\tthis.gestureType = gestureType;\n\t\tthis.scaleMin = scaleMin;\n\t\tthis.scaleMax = scaleMax;\n\t}\n\n\ttoRuntime(): EShapeActionRuntime {\n\t\treturn new EShapeActionRuntimeMiscLayerGesture(this);\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\tconst conditionId = manager.addResource(this.condition);\n\t\treturn manager.addResource(\n\t\t\t`[${this.type},${conditionId},${this.subtype},${this.gestureType},${this.scaleMin},${this.scaleMax}]`\n\t\t);\n\t}\n\n\tstatic deserialize(\n\t\tserialized: EShapeActionValueMiscLayerGestureSerialized,\n\t\tmanager: EShapeResourceManagerDeserialization\n\t): EShapeActionValueMiscLayerGesture {\n\t\tconst condition = EShapeActionValues.toResource(1, serialized, manager.resources);\n\t\tconst gestureType = serialized[3];\n\t\tconst scaleMin = serialized[4];\n\t\tconst scaleMax = serialized[5];\n\t\treturn new EShapeActionValueMiscLayerGesture(condition, gestureType, scaleMin, scaleMax);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDiagramLayers, DDiagramLayersLayer } from \"../../d-diagram-layers\";\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\nimport { EShapeActionRuntimeConditional } from \"./e-shape-action-runtime-conditional\";\nimport { EShapeActionValueMiscLayerShowHide } from \"./e-shape-action-value-misc-layer-show-hide\";\n\nexport interface EShapeActionRuntimeMiscLayerShowHideData {\n\tlayers: DDiagramLayersLayer[];\n\tbringToFront: boolean;\n\tcondition: boolean | null;\n}\n\nexport class EShapeActionRuntimeMiscLayerShowHide extends EShapeActionRuntimeConditional {\n\tprotected _data: Map<EShape, EShapeActionRuntimeMiscLayerShowHideData>;\n\tprotected _layers: number[];\n\tprotected _bringToFront: boolean;\n\n\tconstructor(value: EShapeActionValueMiscLayerShowHide) {\n\t\tsuper(value, EShapeRuntimeReset.NONE);\n\t\tthis._data = new Map<EShape, EShapeActionRuntimeMiscLayerShowHideData>();\n\t\tthis._layers = value.layers;\n\t\tthis._bringToFront = value.bringToFront;\n\t}\n\n\tinitialize(shape: EShape, runtime: EShapeRuntime): void {\n\t\tsuper.initialize(shape, runtime);\n\t\tlet data = this._data.get(shape);\n\t\tif (data == null) {\n\t\t\tdata = this.newData(shape);\n\t\t\tif (data != null) {\n\t\t\t\tthis._data.set(shape, data);\n\t\t\t}\n\t\t}\n\t}\n\n\texecute(shape: EShape, runtime: EShapeRuntime, time: number): void {\n\t\tconst data = this._data.get(shape);\n\t\tif (data) {\n\t\t\tconst newCondition = this.condition(shape, time);\n\t\t\tif (data.condition !== newCondition) {\n\t\t\t\tdata.condition = newCondition;\n\t\t\t\tconst layers = data.layers;\n\t\t\t\tif (newCondition) {\n\t\t\t\t\tif (data.bringToFront) {\n\t\t\t\t\t\tDDiagramLayers.bringAllToFront(layers);\n\t\t\t\t\t\tDDiagramLayers.showAll(layers);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tDDiagramLayers.showAll(layers);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tDDiagramLayers.hideAll(layers);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected newData(shape: EShape): EShapeActionRuntimeMiscLayerShowHideData | undefined {\n\t\tconst layers = DDiagramLayers.toLayers(shape, this._layers);\n\t\tif (0 < layers.length) {\n\t\t\treturn {\n\t\t\t\tlayers: layers,\n\t\t\t\tbringToFront: this._bringToFront,\n\t\t\t\tcondition: null\n\t\t\t};\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShapeActionRuntime } from \"./e-shape-action-runtime\";\nimport { EShapeActionRuntimeMiscLayerShowHide } from \"./e-shape-action-runtime-misc-layer-show-hide\";\nimport { EShapeActionValueMiscType } from \"./e-shape-action-value-misc-type\";\nimport { EShapeActionValueSubtyped } from \"./e-shape-action-value-subtyped\";\nimport { EShapeActionValueType } from \"./e-shape-action-value-type\";\nimport { EShapeActionValues } from \"./e-shape-action-values\";\n\nexport type EShapeActionValueMiscLayerShowHideSerialized = [\n\ttypeof EShapeActionValueType.MISC,\n\tnumber,\n\ttypeof EShapeActionValueMiscType.LAYER_SHOW_HIDE,\n\tnumber,\n\tnumber\n];\n\nexport class EShapeActionValueMiscLayerShowHide extends EShapeActionValueSubtyped<\n\ttypeof EShapeActionValueMiscType.LAYER_SHOW_HIDE\n> {\n\treadonly layers: number[];\n\treadonly bringToFront: boolean;\n\n\tconstructor(condition: string, layers: number[], bringToFront: boolean) {\n\t\tsuper(EShapeActionValueType.MISC, condition, EShapeActionValueMiscType.LAYER_SHOW_HIDE);\n\t\tthis.layers = layers;\n\t\tthis.bringToFront = bringToFront;\n\t}\n\n\ttoRuntime(): EShapeActionRuntime {\n\t\treturn new EShapeActionRuntimeMiscLayerShowHide(this);\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\tconst conditionId = manager.addResource(this.condition);\n\t\tconst layersId = this.serializeLayers(manager);\n\t\tconst bringToFrontId = this.bringToFront ? 1 : 0;\n\t\treturn manager.addResource(\n\t\t\t`[${this.type},${conditionId},${this.subtype},${layersId},${bringToFrontId}]`\n\t\t);\n\t}\n\n\tprotected serializeLayers(manager: EShapeResourceManagerSerialization): number {\n\t\tconst layers = this.layers;\n\t\tlet result = \"[\";\n\t\tlet delimiter = \"\";\n\t\tfor (let i = 0, imax = layers.length; i < imax; ++i) {\n\t\t\tresult += delimiter + layers[i];\n\t\t\tdelimiter = \",\";\n\t\t}\n\t\tresult += \"]\";\n\t\treturn manager.addResource(result);\n\t}\n\n\tstatic deserialize(\n\t\tserialized: EShapeActionValueMiscLayerShowHideSerialized,\n\t\tmanager: EShapeResourceManagerDeserialization\n\t): EShapeActionValueMiscLayerShowHide {\n\t\tconst condition = EShapeActionValues.toResource(1, serialized, manager.resources);\n\t\tconst layers = this.deserializeLayers(serialized[3], manager);\n\t\tconst bringToFront = !!serialized[4];\n\t\treturn new EShapeActionValueMiscLayerShowHide(condition, layers, bringToFront);\n\t}\n\n\tstatic deserializeLayers(\n\t\ttarget: number,\n\t\tmanager: EShapeResourceManagerDeserialization\n\t): number[] {\n\t\tconst resources = manager.resources;\n\t\tconst resourcesLength = resources.length;\n\t\tif (0 <= target && target < resourcesLength) {\n\t\t\treturn JSON.parse(resources[target]) as number[];\n\t\t}\n\t\treturn [];\n\t}\n}\n","/*\n * Copyright (C) 2021 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * {@link DButtonBase} option when to activate a button.\n */\nexport const DButtonBaseWhen = {\n\t/** Activates when clicked */\n\tCLICKED: 0,\n\n\t/** Activates when double clicked */\n\tDOUBLE_CLICKED: 1\n} as const;\n\nexport type DButtonBaseWhen = typeof DButtonBaseWhen[keyof typeof DButtonBaseWhen];\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const DAlignHorizontal = {\n\tLEFT: 0,\n\tCENTER: 1,\n\tRIGHT: 2\n} as const;\n\nexport type DAlignHorizontal = typeof DAlignHorizontal[keyof typeof DAlignHorizontal];\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const DAlignVertical = {\n\tTOP: 0,\n\tMIDDLE: 1,\n\tBOTTOM: 2\n} as const;\n\nexport type DAlignVertical = typeof DAlignVertical[keyof typeof DAlignVertical];\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const DAlignWith = {\n\tTEXT: 0,\n\tPADDING: 1,\n\tBORDER: 2\n} as const;\n\nexport type DAlignWith = typeof DAlignWith[keyof typeof DAlignWith];\n","import { DisplayObject, Texture } from \"pixi.js\";\nimport { DAlignHorizontal } from \"./d-align-horizontal\";\nimport { DAlignVertical } from \"./d-align-vertical\";\nimport { DAlignWith } from \"./d-align-with\";\nimport { DBaseStateSet } from \"./d-base-state-set\";\nimport { DThemeImagePiece } from \"./d-image-piece\";\n\nexport interface DThemeImageBaseSecondary {\n\tgetSecondaryImageAlignHorizontal(): DAlignHorizontal;\n\tgetSecondaryImageAlignVertical(): DAlignVertical;\n\tgetSecondaryImageAlignWith(): DAlignWith;\n\tgetSecondaryImageMarginHorizontal(): number;\n\tgetSecondaryImageMarginVertial(): number;\n\tgetSecondaryImageTintColor(state: DBaseStateSet): number | null;\n\tgetSecondaryImageTintAlpha(state: DBaseStateSet): number;\n\tgetSecondaryImageSource(state: DBaseStateSet): Texture | DisplayObject | null;\n}\n\nexport class DImageBaseThemeWrapperSecondary implements DThemeImagePiece {\n\tprotected _theme: DThemeImageBaseSecondary;\n\n\tconstructor(theme: DThemeImageBaseSecondary) {\n\t\tthis._theme = theme;\n\t}\n\n\tgetImageAlignHorizontal(): DAlignHorizontal {\n\t\treturn this._theme.getSecondaryImageAlignHorizontal();\n\t}\n\n\tgetImageAlignVertical(): DAlignVertical {\n\t\treturn this._theme.getSecondaryImageAlignVertical();\n\t}\n\n\tgetImageAlignWith(): DAlignWith {\n\t\treturn this._theme.getSecondaryImageAlignWith();\n\t}\n\n\tgetImageMarginHorizontal(): number {\n\t\treturn this._theme.getSecondaryImageMarginHorizontal();\n\t}\n\n\tgetImageMarginVertial(): number {\n\t\treturn this._theme.getSecondaryImageMarginVertial();\n\t}\n\n\tgetImageTintColor(state: DBaseStateSet): number | null {\n\t\treturn this._theme.getSecondaryImageTintColor(state);\n\t}\n\n\tgetImageTintAlpha(state: DBaseStateSet): number {\n\t\treturn this._theme.getSecondaryImageTintAlpha(state);\n\t}\n\n\tgetImageSource(state: DBaseStateSet): Texture | DisplayObject | null {\n\t\treturn this._theme.getSecondaryImageSource(state);\n\t}\n}\n","import { DisplayObject, Texture } from \"pixi.js\";\nimport { DAlignHorizontal } from \"./d-align-horizontal\";\nimport { DAlignVertical } from \"./d-align-vertical\";\nimport { DAlignWith } from \"./d-align-with\";\nimport { DBaseStateSet } from \"./d-base-state-set\";\nimport { DThemeImagePiece } from \"./d-image-piece\";\n\nexport interface DThemeImageBaseTertiary {\n\tgetTertiaryImageAlignHorizontal(): DAlignHorizontal;\n\tgetTertiaryImageAlignVertical(): DAlignVertical;\n\tgetTertiaryImageAlignWith(): DAlignWith;\n\tgetTertiaryImageMarginHorizontal(): number;\n\tgetTertiaryImageMarginVertial(): number;\n\tgetTertiaryImageTintColor(state: DBaseStateSet): number | null;\n\tgetTertiaryImageTintAlpha(state: DBaseStateSet): number;\n\tgetTertiaryImageSource(state: DBaseStateSet): Texture | DisplayObject | null;\n}\n\nexport class DImageBaseThemeWrapperTertiary implements DThemeImagePiece {\n\tprotected _theme: DThemeImageBaseTertiary;\n\n\tconstructor(theme: DThemeImageBaseTertiary) {\n\t\tthis._theme = theme;\n\t}\n\n\tgetImageAlignHorizontal(): DAlignHorizontal {\n\t\treturn this._theme.getTertiaryImageAlignHorizontal();\n\t}\n\n\tgetImageAlignVertical(): DAlignVertical {\n\t\treturn this._theme.getTertiaryImageAlignVertical();\n\t}\n\n\tgetImageAlignWith(): DAlignWith {\n\t\treturn this._theme.getTertiaryImageAlignWith();\n\t}\n\n\tgetImageMarginHorizontal(): number {\n\t\treturn this._theme.getTertiaryImageMarginHorizontal();\n\t}\n\n\tgetImageMarginVertial(): number {\n\t\treturn this._theme.getTertiaryImageMarginVertial();\n\t}\n\n\tgetImageTintColor(state: DBaseStateSet): number | null {\n\t\treturn this._theme.getTertiaryImageTintColor(state);\n\t}\n\n\tgetImageTintAlpha(state: DBaseStateSet): number {\n\t\treturn this._theme.getTertiaryImageTintAlpha(state);\n\t}\n\n\tgetImageSource(state: DBaseStateSet): Texture | DisplayObject | null {\n\t\treturn this._theme.getTertiaryImageSource(state);\n\t}\n}\n","import { DisplayObject, Graphics, Rectangle, Sprite, Texture } from \"pixi.js\";\nimport { DAlignHorizontal } from \"./d-align-horizontal\";\nimport { DAlignVertical } from \"./d-align-vertical\";\nimport { DAlignWith } from \"./d-align-with\";\nimport { DApplicationTarget } from \"./d-application-like\";\nimport { DApplications } from \"./d-applications\";\nimport { DBaseStateSet } from \"./d-base-state-set\";\nimport { DStateAwareOrValueMightBe } from \"./d-state-aware\";\nimport { isFunction } from \"./util/is-function\";\nimport { toEnum } from \"./util/to-enum\";\n\nexport interface DImagePieceTintOptions {\n\tcolor?: DStateAwareOrValueMightBe<number | null>;\n\talpha?: DStateAwareOrValueMightBe<number>;\n}\n\nexport interface DImagePieceAlignOptions {\n\twith?: keyof typeof DAlignWith | DAlignWith;\n\tvertical?: keyof typeof DAlignVertical | DAlignVertical;\n\thorizontal?: keyof typeof DAlignHorizontal | DAlignHorizontal;\n}\n\nexport interface DImagePieceMarginOptions {\n\tvertical?: number;\n\thorizontal?: number;\n}\n\nexport interface DImagePieceOptions {\n\tsource?: DStateAwareOrValueMightBe<Texture | DisplayObject | null>;\n\ttint?: DImagePieceTintOptions;\n\talign?: DImagePieceAlignOptions;\n\tmargin?: DImagePieceMarginOptions;\n}\n\nexport interface DImagePieceAlign {\n\twith: DAlignWith;\n\tvertical: DAlignVertical;\n\thorizontal: DAlignHorizontal;\n}\n\nexport interface DImagePieceMargin {\n\tvertical: number;\n\thorizontal: number;\n}\n\nexport interface DImagePieceTextAlign {\n\tvertical: DAlignVertical;\n\thorizontal: DAlignHorizontal;\n}\n\nexport interface DImagePieceParent extends DApplicationTarget {\n\treadonly state: DBaseStateSet;\n\taddChild(displayObject: DisplayObject): void;\n\tremoveChild(displayObject: DisplayObject): void;\n\ttoDirty(): void;\n\tgetOverflowMask(): Graphics | null;\n}\n\nexport interface DThemeImagePiece {\n\tgetImageAlignHorizontal(): DAlignHorizontal;\n\tgetImageAlignVertical(): DAlignVertical;\n\tgetImageAlignWith(): DAlignWith;\n\tgetImageMarginHorizontal(): number;\n\tgetImageMarginVertial(): number;\n\tgetImageTintColor(state: DBaseStateSet): number | null;\n\tgetImageTintAlpha(state: DBaseStateSet): number;\n\tgetImageSource(state: DBaseStateSet): Texture | DisplayObject | null;\n}\n\nconst toImageAlign = (theme: DThemeImagePiece, options?: DImagePieceOptions): DImagePieceAlign => {\n\tconst align = options?.align;\n\treturn {\n\t\twith: toEnum(align?.with ?? theme.getImageAlignWith(), DAlignWith),\n\t\tvertical: toEnum(align?.vertical ?? theme.getImageAlignVertical(), DAlignVertical),\n\t\thorizontal: toEnum(align?.horizontal ?? theme.getImageAlignHorizontal(), DAlignHorizontal)\n\t};\n};\n\nconst toImageMargin = (\n\ttheme: DThemeImagePiece,\n\toptions?: DImagePieceOptions\n): DImagePieceMargin => {\n\tconst margin = options?.margin;\n\treturn {\n\t\tvertical: margin?.vertical ?? theme.getImageMarginVertial(),\n\t\thorizontal: margin?.horizontal ?? theme.getImageMarginHorizontal()\n\t};\n};\n\nexport class DImagePiece {\n\tprotected _parent: DImagePieceParent;\n\tprotected _theme: DThemeImagePiece;\n\tprotected _textAlign: DImagePieceTextAlign;\n\n\tprotected _image: DisplayObject | null;\n\tprotected _computed: Texture | DisplayObject | null;\n\tprotected _source: DStateAwareOrValueMightBe<Texture | DisplayObject | null>;\n\tprotected _align: DImagePieceAlign;\n\tprotected _margin: DImagePieceMargin;\n\tprotected _tint: DImagePieceTintOptions | undefined;\n\tprotected _bound: Rectangle;\n\n\tprotected _onUpdateBound: () => void;\n\n\tconstructor(\n\t\tparent: DImagePieceParent,\n\t\ttheme: DThemeImagePiece,\n\t\ttextAlign: DImagePieceTextAlign,\n\t\toptions?: DImagePieceOptions\n\t) {\n\t\tthis._parent = parent;\n\t\tthis._theme = theme;\n\t\tthis._textAlign = textAlign;\n\n\t\tthis._image = null;\n\t\tthis._align = toImageAlign(theme, options);\n\t\tthis._margin = toImageMargin(theme, options);\n\t\tthis._tint = options?.tint;\n\t\tthis._bound = new Rectangle();\n\t\tthis._source = options?.source;\n\t\tthis._computed = null;\n\n\t\tthis._onUpdateBound = () => {\n\t\t\tthis.onUpdate();\n\t\t};\n\t}\n\n\tget image(): DisplayObject | null {\n\t\treturn this._image;\n\t}\n\n\tget align(): DImagePieceAlign {\n\t\treturn this._align;\n\t}\n\n\tget margin(): DImagePieceMargin {\n\t\treturn this._margin;\n\t}\n\n\tget bound(): Rectangle {\n\t\treturn this._bound;\n\t}\n\n\tget source(): DStateAwareOrValueMightBe<Texture | DisplayObject | null> {\n\t\treturn this._source;\n\t}\n\n\tset source(source: DStateAwareOrValueMightBe<Texture | DisplayObject | null>) {\n\t\tif (this._source !== source) {\n\t\t\tthis._source = source;\n\t\t\tthis.onUpdate();\n\t\t}\n\t}\n\n\tprotected computeSource(): Texture | DisplayObject | null {\n\t\tconst source = this._source;\n\t\tif (source !== undefined) {\n\t\t\tif (isFunction(source)) {\n\t\t\t\tconst result = source(this._parent.state);\n\t\t\t\tif (result !== undefined) {\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn source;\n\t\t\t}\n\t\t}\n\t\treturn this._theme.getImageSource(this._parent.state);\n\t}\n\n\tonStateChange(newState: DBaseStateSet, oldState: DBaseStateSet): void {\n\t\tthis.updateTint();\n\t}\n\n\tupdateBound(): void {\n\t\tconst bound = this._bound;\n\t\tconst image = this._image;\n\t\tif (image != null) {\n\t\t\timage.updateTransform();\n\t\t\timage.getLocalBounds(bound);\n\t\t\tconst bl = bound.left;\n\t\t\tconst bt = bound.top;\n\t\t\tconst br = bound.right;\n\t\t\tconst bb = bound.bottom;\n\n\t\t\tconst localTransform = image.localTransform;\n\t\t\tconst a = localTransform.a;\n\t\t\tconst b = localTransform.b;\n\t\t\tconst c = localTransform.c;\n\t\t\tconst d = localTransform.d;\n\n\t\t\tconst x0 = a * bl + c * bt;\n\t\t\tconst y0 = b * bl + d * bt;\n\t\t\tconst x1 = a * br + c * bt;\n\t\t\tconst y1 = b * br + d * bt;\n\t\t\tconst x2 = a * br + c * bb;\n\t\t\tconst y2 = b * br + d * bb;\n\t\t\tconst x3 = a * bl + c * bb;\n\t\t\tconst y3 = b * bl + d * bb;\n\n\t\t\tconst xmin = Math.min(x0, x1, x2, x3);\n\t\t\tconst xmax = Math.max(x0, x1, x2, x3);\n\t\t\tconst ymin = Math.min(y0, y1, y2, y3);\n\t\t\tconst ymax = Math.max(y0, y1, y2, y3);\n\n\t\t\tbound.x = xmin + localTransform.tx;\n\t\t\tbound.y = ymin + localTransform.ty;\n\t\t\tbound.width = xmax - xmin;\n\t\t\tbound.height = ymax - ymin;\n\t\t} else {\n\t\t\tbound.x = 0;\n\t\t\tbound.y = 0;\n\t\t\tbound.width = 0;\n\t\t\tbound.height = 0;\n\t\t}\n\t}\n\n\tprotected isTintAware(\n\t\ttarget: DisplayObject | null\n\t): target is DisplayObject & { tint: number } {\n\t\treturn target != null && \"tint\" in target;\n\t}\n\n\tprotected toTintColor(theme: DThemeImagePiece, state: DBaseStateSet): number | null {\n\t\tconst tint = this._tint;\n\t\tif (tint) {\n\t\t\tconst color = tint.color;\n\t\t\tif (color !== undefined) {\n\t\t\t\tif (isFunction(color)) {\n\t\t\t\t\tconst result = color(state);\n\t\t\t\t\tif (result !== undefined) {\n\t\t\t\t\t\treturn result;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\treturn color;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn theme.getImageTintColor(state);\n\t}\n\n\tprotected toTintAlpha(theme: DThemeImagePiece, state: DBaseStateSet): number {\n\t\tconst tint = this._tint;\n\t\tif (tint) {\n\t\t\tconst alpha = tint.alpha;\n\t\t\tif (alpha !== undefined) {\n\t\t\t\tif (isFunction(alpha)) {\n\t\t\t\t\tconst result = alpha(state);\n\t\t\t\t\tif (result !== undefined) {\n\t\t\t\t\t\treturn result;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\treturn alpha;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn theme.getImageTintAlpha(state);\n\t}\n\n\t/**\n\t * Updates the tint.\n\t *\n\t * @returns True if the tint is changed.\n\t */\n\tupdateTint(): boolean {\n\t\tconst image = this._image;\n\t\tif (image) {\n\t\t\tif (this.isTintAware(image)) {\n\t\t\t\tconst theme = this._theme;\n\t\t\t\tconst state = this._parent.state;\n\t\t\t\tconst color = this.toTintColor(theme, state);\n\t\t\t\tif (color != null) {\n\t\t\t\t\tlet result = false;\n\t\t\t\t\tif (image.tint !== color) {\n\t\t\t\t\t\timage.tint = color;\n\t\t\t\t\t\tresult = true;\n\t\t\t\t\t}\n\t\t\t\t\tconst alpha = this.toTintAlpha(theme, state);\n\t\t\t\t\tif (image.alpha !== alpha) {\n\t\t\t\t\t\timage.alpha = alpha;\n\t\t\t\t\t\tresult = true;\n\t\t\t\t\t}\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\t/**\n\t * Updates the computed source.\n\t *\n\t * @returns True if the computed source is changed\n\t */\n\tupdateSource(): boolean {\n\t\tconst newComputed = this.computeSource();\n\t\tconst oldComputed = this._computed;\n\t\tif (newComputed !== oldComputed) {\n\t\t\tthis._computed = newComputed;\n\n\t\t\tconst parent = this._parent;\n\t\t\tconst oldImage = this._image;\n\t\t\tconst onUpdateBound = this._onUpdateBound;\n\t\t\tif (newComputed instanceof Texture) {\n\t\t\t\tif (oldComputed instanceof Texture) {\n\t\t\t\t\toldComputed.off(\"update\", onUpdateBound);\n\t\t\t\t\tif (oldImage instanceof Sprite) {\n\t\t\t\t\t\toldImage.texture = newComputed;\n\t\t\t\t\t\tnewComputed.on(\"update\", onUpdateBound);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (oldImage != null) {\n\t\t\t\t\t\tparent.removeChild(oldImage);\n\t\t\t\t\t}\n\n\t\t\t\t\tconst newImage = new Sprite(newComputed);\n\t\t\t\t\tconst overflowMask = parent.getOverflowMask();\n\t\t\t\t\tif (overflowMask) {\n\t\t\t\t\t\tnewImage.mask = overflowMask;\n\t\t\t\t\t}\n\t\t\t\t\tnewComputed.on(\"update\", onUpdateBound);\n\t\t\t\t\tparent.addChild(newImage);\n\t\t\t\t\tthis._image = newImage;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (oldComputed instanceof Texture) {\n\t\t\t\t\toldComputed.off(\"update\", onUpdateBound);\n\t\t\t\t\tif (oldImage != null) {\n\t\t\t\t\t\tparent.removeChild(oldImage);\n\t\t\t\t\t\toldImage.destroy();\n\t\t\t\t\t}\n\t\t\t\t} else if (oldImage != null) {\n\t\t\t\t\tparent.removeChild(oldImage);\n\t\t\t\t}\n\n\t\t\t\tif (newComputed != null) {\n\t\t\t\t\tconst overflowMask = parent.getOverflowMask();\n\t\t\t\t\tif (overflowMask) {\n\t\t\t\t\t\tnewComputed.mask = overflowMask;\n\t\t\t\t\t}\n\t\t\t\t\tparent.addChild(newComputed);\n\t\t\t\t}\n\t\t\t\tthis._image = newComputed;\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tisRefitable(target: any): boolean {\n\t\treturn target != null && target === this._image;\n\t}\n\n\tdestroy(): void {\n\t\tconst image = this._image;\n\t\tif (image) {\n\t\t\tthis._image = null;\n\t\t\tconst computed = this._computed;\n\t\t\tif (computed instanceof Texture) {\n\t\t\t\tcomputed.off(\"update\", this._onUpdateBound, this);\n\t\t\t\timage.destroy();\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected onUpdate(): void {\n\t\tthis._parent.toDirty();\n\t\tDApplications.update(this._parent);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Graphics, Renderer } from \"pixi.js\";\nimport { DBase } from \"./d-base\";\nimport { DBaseReflowable } from \"./d-base-reflowable\";\n\nexport class DBaseOverflowMaskSimple extends Graphics implements DBaseReflowable {\n\tconstructor(parent: DBase) {\n\t\tsuper();\n\t\t(this as any).parent = parent;\n\t}\n\n\trender(renderer: Renderer): void {\n\t\tthis.updateTransform();\n\t\tsuper.render(renderer);\n\t}\n\n\tonReflow(base: DBase, width: number, height: number): void {\n\t\tthis.clear();\n\t\tthis.beginFill(0xffffff, 1);\n\t\tthis.drawRect(0, 0, width, height);\n\t\tthis.endFill();\n\t}\n}\n","import { DynamicFontAtlasCharacter } from \"./util/dynamic-font-atlas-character\";\n\nexport class DDynamicTextMeasureResultCharacter {\n\tx: number;\n\ty: number;\n\tcharacter: DynamicFontAtlasCharacter;\n\twrappable: boolean;\n\n\tconstructor(x: number, y: number, character: DynamicFontAtlasCharacter, wrappable: boolean) {\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t\tthis.character = character;\n\t\tthis.wrappable = wrappable;\n\t}\n\n\tset(x: number, y: number, character: DynamicFontAtlasCharacter, isWrappable: boolean): void {\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t\tthis.character = character;\n\t\tthis.wrappable = isWrappable;\n\t}\n}\n","import { DDynamicTextMeasureResultCharacter } from \"./d-dynamic-text-measure-result-character\";\nimport { DynamicFontAtlasCharacter } from \"./util/dynamic-font-atlas-character\";\nimport { DynamicFontAtlasCharacterType } from \"./util/dynamic-font-atlas-character-type\";\n\nexport class DDynamicTextMeasureResult {\n\tcount: number;\n\tcountPerLine: number;\n\twidth: number;\n\theight: number;\n\tcharacters: DDynamicTextMeasureResultCharacter[];\n\tclipped: boolean;\n\n\tx: number;\n\ty: number;\n\n\tconstructor() {\n\t\tthis.count = 0;\n\t\tthis.countPerLine = 0;\n\t\tthis.width = 0;\n\t\tthis.height = 0;\n\t\tthis.characters = [];\n\t\tthis.clipped = false;\n\n\t\tthis.x = 0;\n\t\tthis.y = 0;\n\t}\n\n\tstart(lineHeight: number, fontHeight: number): void {\n\t\tthis.count = 0;\n\t\tthis.countPerLine = 0;\n\t\tthis.width = 0;\n\t\tthis.height = 0;\n\t\tthis.clipped = false;\n\n\t\tthis.x = 0;\n\t\tthis.y = 0.5 * (lineHeight - fontHeight);\n\t}\n\n\tisPushable(width: number, character: DynamicFontAtlasCharacter): boolean {\n\t\tconst x = this.x + character.advance;\n\t\tif (width < x) {\n\t\t\tif (character.type & DynamicFontAtlasCharacterType.SPACE) {\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\tisPushableAtNewLine(height: number, lineHeight: number, fontHeight: number): boolean {\n\t\treturn this.y + 1.5 * lineHeight + 0.5 * fontHeight <= height;\n\t}\n\n\tpush(character: DynamicFontAtlasCharacter, isWrappable: boolean): void {\n\t\tconst x = this.x;\n\t\tthis.x += character.advance;\n\t\tconst y = this.y;\n\t\tconst count = this.count;\n\t\tconst characters = this.characters;\n\t\tif (count < characters.length) {\n\t\t\tcharacters[count].set(x, y, character, isWrappable);\n\t\t} else {\n\t\t\tcharacters.push(new DDynamicTextMeasureResultCharacter(x, y, character, isWrappable));\n\t\t}\n\t\tthis.count += 1;\n\t\tthis.countPerLine += 1;\n\t}\n\n\tnewLine(lineHeight: number): void {\n\t\tthis.width = Math.max(this.width, this.x);\n\t\tthis.x = 0;\n\t\tthis.y += lineHeight;\n\t\tthis.countPerLine = 0;\n\t}\n\n\twordWrap(lineHeight: number): boolean {\n\t\tconst countPerLine = this.countPerLine;\n\t\tconst characters = this.characters;\n\t\tif (0 < countPerLine) {\n\t\t\tconst count = this.count;\n\t\t\tfor (let i = count - 1, imin = count - countPerLine; imin < i; --i) {\n\t\t\t\tlet character = characters[i];\n\t\t\t\tif (character.wrappable) {\n\t\t\t\t\tlet x = character.character.advance;\n\t\t\t\t\tconst y = character.y + lineHeight;\n\t\t\t\t\tcharacter.x = 0;\n\t\t\t\t\tcharacter.y = y;\n\t\t\t\t\tfor (let j = i + 1; j < count; ++j) {\n\t\t\t\t\t\tcharacter = characters[j];\n\t\t\t\t\t\tcharacter.x = x;\n\t\t\t\t\t\tcharacter.y = y;\n\t\t\t\t\t\tx += character.character.advance;\n\t\t\t\t\t}\n\t\t\t\t\tthis.x = x;\n\t\t\t\t\tthis.y = y;\n\t\t\t\t\tthis.countPerLine = count - i;\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst last = characters[count - 1];\n\t\t\tlast.x = 0;\n\t\t\tlast.y = last.y + lineHeight;\n\t\t\tthis.x = last.character.advance;\n\t\t\tthis.y = last.y;\n\t\t\tthis.countPerLine = 1;\n\t\t\treturn false;\n\t\t}\n\t\treturn false;\n\t}\n\n\tpop(): boolean {\n\t\tconst countPerLine = this.countPerLine;\n\t\tconst characters = this.characters;\n\t\tif (0 < countPerLine) {\n\t\t\tconst character = characters[this.count - 1];\n\t\t\tthis.x -= character.character.advance;\n\t\t\tthis.count -= 1;\n\t\t\tthis.countPerLine -= 1;\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tend(lineHeight: number, fontHeight: number): void {\n\t\tthis.newLine(lineHeight);\n\t\tthis.y -= 0.5 * (lineHeight - fontHeight);\n\t\tthis.height = this.y;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const DDynamicTextStyleWordWrap = {\n\tNONE: 0,\n\tNORMAL: 1,\n\tBREAK_ALL: 2\n} as const;\n\nexport type DDynamicTextStyleWordWrap =\n\ttypeof DDynamicTextStyleWordWrap[keyof typeof DDynamicTextStyleWordWrap];\n","import { DDynamicTextMeasureResult } from \"./d-dynamic-text-measure-result\";\nimport { DynamicFontAtlas } from \"./util/dynamic-font-atlas\";\nimport { UtilCharacterIterator } from \"./util/util-character-iterator\";\nimport type { LineBreaker } from \"css-line-break\";\nimport { LineBreak } from \"css-line-break/dist/types/LineBreak\";\nimport { DDynamicTextStyleWordWrap } from \"./d-dynamic-text-style-word-wrap\";\nimport { DynamicFontAtlasCharacter } from \"./util/dynamic-font-atlas-character\";\nimport { DynamicFontAtlasCharacterType } from \"./util/dynamic-font-atlas-character-type\";\n\nexport interface DDynamicTextMeasureClipping {\n\tenable: boolean;\n\twordWrap: DDynamicTextStyleWordWrap;\n\twidth: number;\n\theight: number;\n\tlineHeight: number;\n}\n\nconst NEW_LINE = \"\\n\";\n\nexport class DDynamicTextMeasure {\n\tprotected static RESULT: DDynamicTextMeasureResult | null = null;\n\n\tstatic measure(\n\t\ttext: string,\n\t\tatlas: DynamicFontAtlas | null,\n\t\tclipping: DDynamicTextMeasureClipping\n\t): DDynamicTextMeasureResult {\n\t\tconst result = DDynamicTextMeasure.RESULT || new DDynamicTextMeasureResult();\n\t\tDDynamicTextMeasure.RESULT = result;\n\t\tif (atlas != null) {\n\t\t\tconst itr = UtilCharacterIterator.from(text);\n\t\t\tconst fh = atlas.font.height;\n\t\t\tconst lh = clipping.lineHeight;\n\t\t\tconst ce = clipping.enable;\n\t\t\tconst cw = clipping.width;\n\t\t\tconst ch = clipping.height;\n\t\t\tconst cp = clipping.wordWrap;\n\t\t\tresult.start(lh, fh);\n\t\t\tswitch (cp) {\n\t\t\t\tcase DDynamicTextStyleWordWrap.BREAK_ALL:\n\t\t\t\t\tif (ce) {\n\t\t\t\t\t\tthis.measure1(itr, cw, ch, fh, lh, atlas, result);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.measure2(itr, cw, lh, atlas, result);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase DDynamicTextStyleWordWrap.NORMAL:\n\t\t\t\t\tconst lb = this.newLineBreaker(text);\n\t\t\t\t\tif (lb) {\n\t\t\t\t\t\tif (ce) {\n\t\t\t\t\t\t\tthis.measure1a(lb, itr, cw, ch, fh, lh, atlas, result);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.measure2a(lb, itr, cw, lh, atlas, result);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (ce) {\n\t\t\t\t\t\t\tthis.measure1b(itr, cw, ch, fh, lh, atlas, result);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.measure2b(itr, cw, lh, atlas, result);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tif (ce) {\n\t\t\t\t\t\tthis.measure3(itr, cw, lh, atlas, result);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.measure4(itr, lh, atlas, result);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tresult.end(lh, fh);\n\t\t} else {\n\t\t\tresult.start(0, 0);\n\t\t\tresult.end(0, 0);\n\t\t}\n\t\treturn result;\n\t}\n\n\tprivate static measure1a(\n\t\tlineBreaker: ReturnType<typeof LineBreaker>,\n\t\titerator: UtilCharacterIterator,\n\t\tclippingWidth: number,\n\t\tclippingHeight: number,\n\t\tfontHeight: number,\n\t\tlineHeight: number,\n\t\tatlas: DynamicFontAtlas,\n\t\tresult: DDynamicTextMeasureResult\n\t): void {\n\t\tlet lineBreak = lineBreaker.next();\n\t\twhile (iterator.hasNext()) {\n\t\t\tconst characterPosition = iterator.position;\n\t\t\tconst character = iterator.next();\n\t\t\tif (character === NEW_LINE) {\n\t\t\t\tresult.newLine(lineHeight);\n\t\t\t} else {\n\t\t\t\tconst a = atlas.get(character);\n\t\t\t\tif (a == null) continue;\n\n\t\t\t\tlineBreak = this.advance(characterPosition, lineBreak, lineBreaker);\n\t\t\t\tconst isWrappable = this.isWrappable1(characterPosition, lineBreak);\n\n\t\t\t\tif (result.isPushable(clippingWidth, a)) {\n\t\t\t\t\tresult.push(a, isWrappable);\n\t\t\t\t} else {\n\t\t\t\t\tif (result.isPushableAtNewLine(clippingHeight, lineHeight, fontHeight)) {\n\t\t\t\t\t\tresult.push(a, isWrappable);\n\t\t\t\t\t\tresult.wordWrap(lineHeight);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.measure5(iterator, clippingWidth, lineHeight, atlas, result, true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate static measure1b(\n\t\titerator: UtilCharacterIterator,\n\t\tclippingWidth: number,\n\t\tclippingHeight: number,\n\t\tfontHeight: number,\n\t\tlineHeight: number,\n\t\tatlas: DynamicFontAtlas,\n\t\tresult: DDynamicTextMeasureResult\n\t): void {\n\t\twhile (iterator.hasNext()) {\n\t\t\tconst character = iterator.next();\n\t\t\tif (character === NEW_LINE) {\n\t\t\t\tresult.newLine(lineHeight);\n\t\t\t} else {\n\t\t\t\tconst a = atlas.get(character);\n\t\t\t\tif (a == null) continue;\n\n\t\t\t\tconst isWrappable = this.isWrappable2(result, a);\n\t\t\t\tif (result.isPushable(clippingWidth, a)) {\n\t\t\t\t\tresult.push(a, isWrappable);\n\t\t\t\t} else {\n\t\t\t\t\tif (result.isPushableAtNewLine(clippingHeight, lineHeight, fontHeight)) {\n\t\t\t\t\t\tresult.push(a, isWrappable);\n\t\t\t\t\t\tresult.wordWrap(lineHeight);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.measure5(iterator, clippingWidth, lineHeight, atlas, result, true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate static measure1(\n\t\titerator: UtilCharacterIterator,\n\t\tclippingWidth: number,\n\t\tclippingHeight: number,\n\t\tfontHeight: number,\n\t\tlineHeight: number,\n\t\tatlas: DynamicFontAtlas,\n\t\tresult: DDynamicTextMeasureResult\n\t): void {\n\t\twhile (iterator.hasNext()) {\n\t\t\tconst character = iterator.next();\n\t\t\tif (character === NEW_LINE) {\n\t\t\t\tresult.newLine(lineHeight);\n\t\t\t} else {\n\t\t\t\tconst a = atlas.get(character);\n\t\t\t\tif (a == null) continue;\n\n\t\t\t\tif (result.isPushable(clippingWidth, a)) {\n\t\t\t\t\tresult.push(a, true);\n\t\t\t\t} else {\n\t\t\t\t\tif (result.isPushableAtNewLine(clippingHeight, lineHeight, fontHeight)) {\n\t\t\t\t\t\tresult.newLine(lineHeight);\n\t\t\t\t\t\tresult.push(a, true);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.measure5(iterator, clippingWidth, lineHeight, atlas, result, true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate static measure2a(\n\t\tlineBreaker: ReturnType<typeof LineBreaker>,\n\t\titerator: UtilCharacterIterator,\n\t\tclippingWidth: number,\n\t\tlineHeight: number,\n\t\tatlas: DynamicFontAtlas,\n\t\tresult: DDynamicTextMeasureResult\n\t): void {\n\t\tlet lineBreak = lineBreaker.next();\n\t\twhile (iterator.hasNext()) {\n\t\t\tconst characterPosition = iterator.position;\n\t\t\tconst character = iterator.next();\n\t\t\tif (character === NEW_LINE) {\n\t\t\t\tresult.newLine(lineHeight);\n\t\t\t} else {\n\t\t\t\tconst a = atlas.get(character);\n\t\t\t\tif (a == null) continue;\n\n\t\t\t\tlineBreak = this.advance(characterPosition, lineBreak, lineBreaker);\n\t\t\t\tconst isWrappable = this.isWrappable1(characterPosition, lineBreak);\n\n\t\t\t\tif (result.isPushable(clippingWidth, a)) {\n\t\t\t\t\tresult.push(a, isWrappable);\n\t\t\t\t} else {\n\t\t\t\t\tresult.push(a, isWrappable);\n\t\t\t\t\tresult.wordWrap(lineHeight);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate static measure2b(\n\t\titerator: UtilCharacterIterator,\n\t\tclippingWidth: number,\n\t\tlineHeight: number,\n\t\tatlas: DynamicFontAtlas,\n\t\tresult: DDynamicTextMeasureResult\n\t): void {\n\t\twhile (iterator.hasNext()) {\n\t\t\tconst character = iterator.next();\n\t\t\tif (character === NEW_LINE) {\n\t\t\t\tresult.newLine(lineHeight);\n\t\t\t} else {\n\t\t\t\tconst a = atlas.get(character);\n\t\t\t\tif (a == null) continue;\n\n\t\t\t\tconst isWrappable = this.isWrappable2(result, a);\n\n\t\t\t\tif (result.isPushable(clippingWidth, a)) {\n\t\t\t\t\tresult.push(a, isWrappable);\n\t\t\t\t} else {\n\t\t\t\t\tresult.push(a, isWrappable);\n\t\t\t\t\tresult.wordWrap(lineHeight);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate static measure2(\n\t\titerator: UtilCharacterIterator,\n\t\tclippingWidth: number,\n\t\tlineHeight: number,\n\t\tatlas: DynamicFontAtlas,\n\t\tresult: DDynamicTextMeasureResult\n\t): void {\n\t\twhile (iterator.hasNext()) {\n\t\t\tconst character = iterator.next();\n\t\t\tif (character === NEW_LINE) {\n\t\t\t\tresult.newLine(lineHeight);\n\t\t\t} else {\n\t\t\t\tconst a = atlas.get(character);\n\t\t\t\tif (a == null) continue;\n\n\t\t\t\tif (result.isPushable(clippingWidth, a)) {\n\t\t\t\t\tresult.push(a, false);\n\t\t\t\t} else {\n\t\t\t\t\tresult.newLine(lineHeight);\n\t\t\t\t\tresult.push(a, false);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate static measure3(\n\t\titerator: UtilCharacterIterator,\n\t\tclippingWidth: number,\n\t\tlineHeight: number,\n\t\tatlas: DynamicFontAtlas,\n\t\tresult: DDynamicTextMeasureResult\n\t): void {\n\t\twhile (iterator.hasNext()) {\n\t\t\tconst character = iterator.next();\n\t\t\tif (character === NEW_LINE) {\n\t\t\t\tresult.newLine(lineHeight);\n\t\t\t} else {\n\t\t\t\tconst a = atlas.get(character);\n\t\t\t\tif (a == null) continue;\n\n\t\t\t\tif (result.isPushable(clippingWidth, a)) {\n\t\t\t\t\tresult.push(a, false);\n\t\t\t\t} else {\n\t\t\t\t\tthis.measure5(iterator, clippingWidth, lineHeight, atlas, result, false);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate static measure4(\n\t\titerator: UtilCharacterIterator,\n\t\tlineHeight: number,\n\t\tatlas: DynamicFontAtlas,\n\t\tresult: DDynamicTextMeasureResult\n\t): void {\n\t\twhile (iterator.hasNext()) {\n\t\t\tconst character = iterator.next();\n\t\t\tif (character === NEW_LINE) {\n\t\t\t\tresult.newLine(lineHeight);\n\t\t\t} else {\n\t\t\t\tconst a = atlas.get(character);\n\t\t\t\tif (a == null) continue;\n\t\t\t\tresult.push(a, false);\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic measure5(\n\t\titerator: UtilCharacterIterator,\n\t\tclippingWidth: number,\n\t\tlineHeight: number,\n\t\tatlas: DynamicFontAtlas,\n\t\tresult: DDynamicTextMeasureResult,\n\t\tclose: boolean\n\t): void {\n\t\tresult.clipped = true;\n\t\tconst dots = atlas.get(\"...\");\n\t\tif (dots != null) {\n\t\t\twhile (!result.isPushable(clippingWidth, dots)) {\n\t\t\t\tif (!result.pop()) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (result.isPushable(clippingWidth, dots)) {\n\t\t\t\tresult.push(dots, false);\n\t\t\t}\n\t\t}\n\t\tif (close) {\n\t\t\titerator.close();\n\t\t} else {\n\t\t\twhile (iterator.hasNext()) {\n\t\t\t\tif (iterator.next() === NEW_LINE) {\n\t\t\t\t\tresult.newLine(lineHeight);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate static isWrappable2(\n\t\tresult: DDynamicTextMeasureResult,\n\t\tcharacter: DynamicFontAtlasCharacter\n\t): boolean {\n\t\tif (result.countPerLine <= 0) {\n\t\t\treturn false;\n\t\t}\n\t\tconst last = result.characters[result.count - 1];\n\t\tconst lastType = last.character.type;\n\t\tconst type = character.type;\n\t\tif (lastType & DynamicFontAtlasCharacterType.SPACE) {\n\t\t\tif (type & DynamicFontAtlasCharacterType.SPACE) {\n\t\t\t\treturn false;\n\t\t\t} else {\n\t\t\t\tif (lastType & DynamicFontAtlasCharacterType.NON_BREAKING) {\n\t\t\t\t\treturn false;\n\t\t\t\t} else {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tif (type & DynamicFontAtlasCharacterType.SPACE) {\n\t\t\t\treturn false;\n\t\t\t} else {\n\t\t\t\tif (lastType & DynamicFontAtlasCharacterType.NON_BREAKING) {\n\t\t\t\t\tif (type & DynamicFontAtlasCharacterType.NON_BREAKING) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate static advance(\n\t\tposition: number,\n\t\tlineBreak: LineBreak,\n\t\tlineBreaker: ReturnType<typeof LineBreaker>\n\t): LineBreak {\n\t\tif (lineBreak.done) {\n\t\t\treturn lineBreak;\n\t\t}\n\t\tif (position <= lineBreak.value.end) {\n\t\t\treturn lineBreak;\n\t\t}\n\t\tlineBreak = lineBreaker.next();\n\t\treturn lineBreak;\n\t}\n\n\tprivate static isWrappable1(position: number, lineBreak: LineBreak): boolean {\n\t\tif (lineBreak.done) {\n\t\t\treturn false;\n\t\t}\n\t\tconst value = lineBreak.value;\n\t\treturn value.start === position || value.end === position;\n\t}\n\n\tprivate static newLineBreaker(target: string): ReturnType<typeof LineBreaker> | null {\n\t\tif (\"css-line-break\" in window) {\n\t\t\tconst cssLineBreak = (window as any)[\"css-line-break\"] as {\n\t\t\t\tLineBreaker: typeof LineBreaker;\n\t\t\t};\n\t\t\treturn cssLineBreak.LineBreaker(target, {\n\t\t\t\tlineBreak: \"strict\",\n\t\t\t\twordBreak: \"normal\"\n\t\t\t});\n\t\t}\n\t\treturn null;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { MeshGeometry } from \"pixi.js\";\nimport { DDynamicTextMeasure } from \"./d-dynamic-text-measure\";\nimport { DDynamicTextStyleWordWrap } from \"./d-dynamic-text-style-word-wrap\";\nimport { DynamicFontAtlas } from \"./util/dynamic-font-atlas\";\nimport { DynamicFontAtlasCharacter } from \"./util/dynamic-font-atlas-character\";\n\nexport interface DDynamicTextGeometryClipping {\n\tenable: boolean;\n\twordWrap: DDynamicTextStyleWordWrap;\n\twidth: number;\n\theight: number;\n\tlineHeight: number;\n}\n\nexport class DDynamicTextGeometry extends MeshGeometry {\n\twidth: number;\n\theight: number;\n\tclipped: boolean;\n\n\tconstructor() {\n\t\tsuper(new Float32Array(64), new Float32Array(64), new Uint16Array(48));\n\t\tthis.width = 0;\n\t\tthis.height = 0;\n\t\tthis.clipped = false;\n\t}\n\n\tupdate(\n\t\ttext: string,\n\t\tatlas: DynamicFontAtlas | null,\n\t\tclipping: DDynamicTextGeometryClipping\n\t): void {\n\t\tconst vertexBuffer = this.getBuffer(\"aVertexPosition\");\n\t\tconst uvBuffer = this.getBuffer(\"aTextureCoord\");\n\t\tconst indexBuffer = this.getIndex();\n\n\t\tconst result = DDynamicTextMeasure.measure(text, atlas, clipping);\n\t\tconst requiredTextSize = Math.ceil(result.count / 8) << 3;\n\t\tconst requiredVertexSize = requiredTextSize << 3;\n\t\tif ((vertexBuffer.data as Float32Array).length < requiredVertexSize) {\n\t\t\tvertexBuffer.data = new Float32Array(requiredVertexSize);\n\t\t\tuvBuffer.data = new Float32Array(requiredVertexSize);\n\t\t}\n\t\tconst requiredIndexSize = requiredTextSize * 6;\n\t\tif ((indexBuffer.data as Uint16Array).length < requiredIndexSize) {\n\t\t\tindexBuffer.data = new Uint16Array(requiredIndexSize);\n\t\t}\n\n\t\tconst vertices = vertexBuffer.data as Float32Array;\n\t\tconst uvs = uvBuffer.data as Float32Array;\n\t\tconst indices = indexBuffer.data as Uint16Array;\n\n\t\tif (atlas != null) {\n\t\t\tconst count = result.count;\n\t\t\tconst characters = result.characters;\n\t\t\tfor (let i = 0; i < count; ++i) {\n\t\t\t\tconst character = characters[i];\n\t\t\t\tconst cx = character.x;\n\t\t\t\tconst cy = character.y;\n\t\t\t\tconst cc = character.character;\n\t\t\t\tconst w = atlas.width;\n\t\t\t\tconst h = atlas.height;\n\t\t\t\tthis.writeCharacter(vertices, uvs, indices, i, cx, cy, cc, w, h);\n\t\t\t}\n\t\t\tfor (let i = count, imax = vertices.length >> 3; i < imax; ++i) {\n\t\t\t\tthis.writeCharacterEmpty(vertices, uvs, indices, i);\n\t\t\t}\n\t\t\tthis.width = result.width;\n\t\t\tthis.height = result.height;\n\t\t\tthis.clipped = result.clipped;\n\t\t} else {\n\t\t\tfor (let i = 0, imax = vertices.length >> 3; i < imax; ++i) {\n\t\t\t\tthis.writeCharacterEmpty(vertices, uvs, indices, i);\n\t\t\t}\n\t\t\tthis.width = 0;\n\t\t\tthis.height = 0;\n\t\t\tthis.clipped = false;\n\t\t}\n\n\t\tvertexBuffer.update();\n\t\tuvBuffer.update();\n\t\tindexBuffer.update();\n\t}\n\n\tprotected writeCharacter(\n\t\tvertices: Float32Array,\n\t\tuvs: Float32Array,\n\t\tindices: Uint16Array,\n\t\tindex: number,\n\t\tx: number,\n\t\ty: number,\n\t\tcharacter: DynamicFontAtlasCharacter,\n\t\twidth: number,\n\t\theight: number\n\t): void {\n\t\tconst cx = character.x;\n\t\tconst cy = character.y;\n\t\tconst cw = character.width;\n\t\tconst ch = character.height;\n\t\tconst cox = character.origin.x;\n\n\t\tconst x0 = x + (cx - cox);\n\t\tconst y0 = y;\n\t\tconst x1 = x0 + cw;\n\t\tconst y1 = y0 + ch;\n\n\t\tconst iv = index << 3;\n\t\tvertices[iv + 0] = x0;\n\t\tvertices[iv + 1] = y0;\n\t\tvertices[iv + 2] = x1;\n\t\tvertices[iv + 3] = y0;\n\t\tvertices[iv + 4] = x1;\n\t\tvertices[iv + 5] = y1;\n\t\tvertices[iv + 6] = x0;\n\t\tvertices[iv + 7] = y1;\n\n\t\tconst u0 = cx / width;\n\t\tconst v0 = cy / height;\n\t\tconst u1 = (cx + cw) / width;\n\t\tconst v1 = (cy + ch) / height;\n\t\tuvs[iv + 0] = u0;\n\t\tuvs[iv + 1] = v0;\n\t\tuvs[iv + 2] = u1;\n\t\tuvs[iv + 3] = v0;\n\t\tuvs[iv + 4] = u1;\n\t\tuvs[iv + 5] = v1;\n\t\tuvs[iv + 6] = u0;\n\t\tuvs[iv + 7] = v1;\n\n\t\tconst ii = index * 6;\n\t\tconst vo = index << 2;\n\t\tindices[ii + 0] = vo + 0;\n\t\tindices[ii + 1] = vo + 1;\n\t\tindices[ii + 2] = vo + 3;\n\t\tindices[ii + 3] = vo + 1;\n\t\tindices[ii + 4] = vo + 2;\n\t\tindices[ii + 5] = vo + 3;\n\t}\n\n\tprotected writeCharacterEmpty(\n\t\tvertices: Float32Array,\n\t\tuvs: Float32Array,\n\t\tindices: Uint16Array,\n\t\tindex: number\n\t): void {\n\t\tconst iv = index << 3;\n\t\tvertices[iv + 0] = 0;\n\t\tvertices[iv + 1] = 0;\n\t\tvertices[iv + 2] = 0;\n\t\tvertices[iv + 3] = 0;\n\t\tvertices[iv + 4] = 0;\n\t\tvertices[iv + 5] = 0;\n\t\tvertices[iv + 6] = 0;\n\t\tvertices[iv + 7] = 0;\n\n\t\tuvs[iv + 0] = 0;\n\t\tuvs[iv + 1] = 0;\n\t\tuvs[iv + 2] = 0;\n\t\tuvs[iv + 3] = 0;\n\t\tuvs[iv + 4] = 0;\n\t\tuvs[iv + 5] = 0;\n\t\tuvs[iv + 6] = 0;\n\t\tuvs[iv + 7] = 0;\n\n\t\tconst ii = index * 6;\n\t\tconst vo = index << 2;\n\t\tindices[ii + 0] = vo + 0;\n\t\tindices[ii + 1] = vo + 1;\n\t\tindices[ii + 2] = vo + 3;\n\t\tindices[ii + 3] = vo + 1;\n\t\tindices[ii + 4] = vo + 2;\n\t\tindices[ii + 5] = vo + 3;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBaseStateSetImpl } from \"./d-base-state-set-impl\";\nimport { DDynamicTextStyleWordWrap } from \"./d-dynamic-text-style-word-wrap\";\nimport { DFontStyle, DFontVariant, DFontWeight, DThemeFont } from \"./d-font\";\nimport { DThemes } from \"./theme/d-themes\";\nimport { toEnum } from \"./util/to-enum\";\n\nexport type DDynamicTextAlign = \"left\" | \"center\" | \"right\";\n\nexport interface DDynamicTextStyleOptions {\n\talign?: DDynamicTextAlign;\n\tfontFamily?: string;\n\tfontSize?: number;\n\tfontStyle?: DFontStyle;\n\tfontVariant?: DFontVariant;\n\tfontWeight?: DFontWeight;\n\tfill?: number;\n\tclipping?: boolean;\n\twordWrap?: DDynamicTextStyleWordWrap | keyof typeof DDynamicTextStyleWordWrap;\n\tlineHeight?: number;\n}\n\nexport class DDynamicTextStyle {\n\tprotected static DEFAULT_OPTIONS?: Required<DDynamicTextStyleOptions>;\n\n\tprotected _id: number;\n\tprotected _idApproved: number;\n\tprotected _fontIdId: number;\n\tprotected _fontId: string;\n\tprotected _fontIdApproved: string;\n\tprotected _align: DDynamicTextAlign;\n\tprotected _fontFamily: string;\n\tprotected _fontSize: number;\n\tprotected _fontStyle: DFontStyle;\n\tprotected _fontVariant: DFontVariant;\n\tprotected _fontWeight: DFontWeight;\n\tprotected _fill: number;\n\tprotected _fillApproved: number;\n\tprotected _clipping: boolean;\n\tprotected _wordWrap: DDynamicTextStyleWordWrap;\n\tprotected _lineHeight: number;\n\tprotected _onChange: () => void;\n\n\tconstructor(options: DDynamicTextStyleOptions | undefined, onChange: () => void) {\n\t\tthis._id = 0;\n\t\tthis._idApproved = -1;\n\n\t\tconst defaultOptions = this.getDefaultOptions();\n\t\tif (options) {\n\t\t\tthis._align = options.align ?? defaultOptions.align;\n\t\t\tthis._fontFamily = options.fontFamily ?? defaultOptions.fontFamily;\n\t\t\tthis._fontSize = options.fontSize ?? defaultOptions.fontSize;\n\t\t\tthis._fontStyle = options.fontStyle ?? defaultOptions.fontStyle;\n\t\t\tthis._fontVariant = options.fontVariant ?? defaultOptions.fontVariant;\n\t\t\tthis._fontWeight = options.fontWeight ?? defaultOptions.fontWeight;\n\t\t\tthis._fill = options.fill ?? defaultOptions.fill;\n\t\t\tthis._clipping = options.clipping ?? defaultOptions.clipping;\n\t\t\tthis._wordWrap = toEnum(\n\t\t\t\toptions.wordWrap ?? defaultOptions.wordWrap,\n\t\t\t\tDDynamicTextStyleWordWrap\n\t\t\t);\n\t\t\tthis._lineHeight = options.lineHeight ?? defaultOptions.lineHeight;\n\t\t} else {\n\t\t\tthis._align = defaultOptions.align;\n\t\t\tthis._fontFamily = defaultOptions.fontFamily;\n\t\t\tthis._fontSize = defaultOptions.fontSize;\n\t\t\tthis._fontStyle = defaultOptions.fontStyle;\n\t\t\tthis._fontVariant = defaultOptions.fontVariant;\n\t\t\tthis._fontWeight = defaultOptions.fontWeight;\n\t\t\tthis._fill = defaultOptions.fill;\n\t\t\tthis._clipping = defaultOptions.clipping;\n\t\t\tthis._wordWrap = toEnum(defaultOptions.wordWrap, DDynamicTextStyleWordWrap);\n\t\t\tthis._lineHeight = defaultOptions.lineHeight;\n\t\t}\n\n\t\tthis._fontIdId = -1;\n\t\tthis._fontId = \"\";\n\t\tthis._fontIdApproved = \"\";\n\t\tthis._fillApproved = 0x000000;\n\n\t\tthis._onChange = onChange;\n\t}\n\n\tprotected getDefaultOptions(): Required<DDynamicTextStyleOptions> {\n\t\tlet result = DDynamicTextStyle.DEFAULT_OPTIONS;\n\t\tif (result == null) {\n\t\t\tresult = this.newDefaultOptions();\n\t\t\tDDynamicTextStyle.DEFAULT_OPTIONS = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected newDefaultOptions(): Required<DDynamicTextStyleOptions> {\n\t\tconst theme = DThemes.getInstance().get(\"DBase\") as DThemeFont;\n\t\treturn {\n\t\t\talign: \"left\",\n\t\t\tfontFamily: theme.getFontFamilly(),\n\t\t\tfontSize: theme.getFontSize(),\n\t\t\tfontStyle: \"normal\",\n\t\t\tfontVariant: \"normal\",\n\t\t\tfontWeight: \"normal\",\n\t\t\tfill: theme.getColor(new DBaseStateSetImpl()),\n\t\t\tclipping: true,\n\t\t\twordWrap: DDynamicTextStyleWordWrap.NONE,\n\t\t\tlineHeight: theme.getLineHeight()\n\t\t};\n\t}\n\n\tget id(): number {\n\t\treturn this._id;\n\t}\n\n\tget idApproved(): number {\n\t\treturn this._idApproved;\n\t}\n\n\tget fontId(): string {\n\t\tthis.update();\n\t\treturn this._fontId;\n\t}\n\n\tget fontIdApproved(): string {\n\t\treturn this._fontIdApproved;\n\t}\n\n\tget fill(): number {\n\t\treturn this._fill;\n\t}\n\n\tset fill(fill: number) {\n\t\tif (this._fill !== fill) {\n\t\t\tthis._fill = fill;\n\t\t\tthis.onChange();\n\t\t}\n\t}\n\n\tprotected onChange(): void {\n\t\tthis._id += 1;\n\t\tthis._onChange();\n\t}\n\n\tget fillApproved(): number {\n\t\treturn this._fillApproved;\n\t}\n\n\tapprove(): void {\n\t\tthis.update();\n\t\tthis._idApproved = this._id;\n\t\tthis._fontIdApproved = this._fontId;\n\t\tthis._fillApproved = this._fill;\n\t}\n\n\tget fontFamily(): string {\n\t\treturn this._fontFamily;\n\t}\n\n\tset fontFamily(fontFamily: string) {\n\t\tif (this._fontFamily !== fontFamily) {\n\t\t\tthis._fontFamily = fontFamily;\n\t\t\tthis.onChange();\n\t\t}\n\t}\n\n\tget fontSize(): number {\n\t\treturn this._fontSize;\n\t}\n\n\tset fontSize(fontSize: number) {\n\t\tif (this._fontSize !== fontSize) {\n\t\t\tthis._fontSize = fontSize;\n\t\t\tthis.onChange();\n\t\t}\n\t}\n\n\tget fontStyle(): DFontStyle {\n\t\treturn this._fontStyle;\n\t}\n\n\tset fontStyle(fontStyle: DFontStyle) {\n\t\tif (this._fontStyle !== fontStyle) {\n\t\t\tthis._fontStyle = fontStyle;\n\t\t\tthis.onChange();\n\t\t}\n\t}\n\n\tget fontVariant(): DFontVariant {\n\t\treturn this._fontVariant;\n\t}\n\n\tset fontVariant(fontVariant: DFontVariant) {\n\t\tif (this._fontVariant !== fontVariant) {\n\t\t\tthis._fontVariant = fontVariant;\n\t\t\tthis.onChange();\n\t\t}\n\t}\n\n\tget fontWeight(): DFontWeight {\n\t\treturn this._fontWeight;\n\t}\n\n\tset fontWeight(fontWeight: DFontWeight) {\n\t\tif (this._fontWeight !== fontWeight) {\n\t\t\tthis._fontWeight = fontWeight;\n\t\t\tthis.onChange();\n\t\t}\n\t}\n\n\tprotected update(): void {\n\t\tif (this._fontIdId !== this._id) {\n\t\t\tthis._fontIdId = this._id;\n\t\t\tthis._fontId = this.newFontId();\n\t\t}\n\t}\n\n\tprotected newFontId(): string {\n\t\treturn `${this._fontStyle} ${this._fontVariant} ${this._fontWeight} ${this._fontSize}px ${this._fontFamily}`;\n\t}\n\n\tget clipping(): boolean {\n\t\treturn this._clipping;\n\t}\n\n\tset clipping(clipping: boolean) {\n\t\tif (this._clipping !== clipping) {\n\t\t\tthis._clipping = clipping;\n\t\t\tthis.onChange();\n\t\t}\n\t}\n\n\tget wordWrap(): DDynamicTextStyleWordWrap {\n\t\treturn this._wordWrap;\n\t}\n\n\tset wordWrap(wordWrap: DDynamicTextStyleWordWrap) {\n\t\tif (this._wordWrap !== wordWrap) {\n\t\t\tthis._wordWrap = wordWrap;\n\t\t\tthis.onChange();\n\t\t}\n\t}\n\n\tget lineHeight(): number {\n\t\treturn this._lineHeight;\n\t}\n\n\tset lineHeight(lineHeight: number) {\n\t\tif (this._lineHeight !== lineHeight) {\n\t\t\tthis._lineHeight = lineHeight;\n\t\t\tthis.onChange();\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Mesh, MeshMaterial, Renderer, Texture } from \"pixi.js\";\nimport { DApplications } from \"./d-applications\";\nimport { DBase } from \"./d-base\";\nimport { DDynamicTextGeometry } from \"./d-dynamic-text-geometry\";\nimport { DDynamicTextStyle, DDynamicTextStyleOptions } from \"./d-dynamic-text-style\";\nimport { DDynamicTextStyleWordWrap } from \"./d-dynamic-text-style-word-wrap\";\nimport { DynamicFontAtlas } from \"./util/dynamic-font-atlas\";\n\nexport interface DDynamicTextClippingDelta {\n\twidth: number;\n\theight: number;\n}\n\nexport interface DDynamicTextClipping {\n\tenable: boolean;\n\twordWrap: DDynamicTextStyleWordWrap;\n\twidth: number;\n\theight: number;\n\tlineHeight: number;\n\tdelta: DDynamicTextClippingDelta;\n}\n\nexport class DDynamicText extends Mesh {\n\tprotected _style: DDynamicTextStyle;\n\tprotected _text: string;\n\tprotected _textApproved: string;\n\tprotected _isDirty: boolean;\n\tprotected _isGeometryDirty: boolean;\n\tprotected _atlas: DynamicFontAtlas | null;\n\tprotected _atlasRevisionUpdated: number;\n\tprotected _width: number;\n\tprotected _height: number;\n\tprotected _clipping: DDynamicTextClipping;\n\n\treadonly geometry!: DDynamicTextGeometry;\n\n\tconstructor(text: string, options?: DDynamicTextStyleOptions) {\n\t\tsuper(new DDynamicTextGeometry(), new MeshMaterial(Texture.EMPTY));\n\n\t\tthis._style = new DDynamicTextStyle(options, (): void => {\n\t\t\tthis._isDirty = true;\n\t\t\tthis._isGeometryDirty = true;\n\t\t\tthis._atlas = null;\n\t\t\tthis.update_();\n\t\t});\n\t\tthis._text = text;\n\t\tthis._textApproved = \"\";\n\t\tthis._isDirty = true;\n\t\tthis._isGeometryDirty = true;\n\t\tthis._atlas = null;\n\t\tthis._atlasRevisionUpdated = 0;\n\t\tthis._width = 0;\n\t\tthis._height = 0;\n\t\tthis._clipping = {\n\t\t\tenable: false,\n\t\t\twordWrap: DDynamicTextStyleWordWrap.NONE,\n\t\t\twidth: 0,\n\t\t\theight: 0,\n\t\t\tlineHeight: 0,\n\t\t\tdelta: {\n\t\t\t\twidth: 0,\n\t\t\t\theight: 0\n\t\t\t}\n\t\t};\n\t\tthis.update_();\n\t}\n\n\tprotected update_(): void {\n\t\tconst layer = DApplications.getLayer(this);\n\t\tif (layer) {\n\t\t\tconst style = this._style;\n\t\t\tif (this._isDirty) {\n\t\t\t\tthis._isDirty = false;\n\n\t\t\t\tconst text = this._text;\n\t\t\t\tconst textApproved = this._textApproved;\n\t\t\t\tthis._textApproved = text;\n\t\t\t\tconst fontId = style.fontId;\n\t\t\t\tconst fontIdApproved = style.fontIdApproved;\n\t\t\t\tconst fontSize = style.fontSize;\n\t\t\t\tconst fill = style.fill;\n\t\t\t\tconst fillApproved = style.fillApproved;\n\t\t\t\tstyle.approve();\n\n\t\t\t\tconst atlases = layer.getDynamicFontAtlases();\n\t\t\t\tif (text !== textApproved || fontId !== fontIdApproved || fill !== fillApproved) {\n\t\t\t\t\tatlases.add(fontId, fontSize, fill, text);\n\t\t\t\t\tatlases.remove(fontIdApproved, fillApproved, textApproved);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tget text(): string {\n\t\treturn this._text;\n\t}\n\n\tset text(text: string) {\n\t\tif (this._text !== text) {\n\t\t\tthis._text = text;\n\t\t\tthis._isDirty = true;\n\t\t\tthis._isGeometryDirty = true;\n\t\t\tthis.update_();\n\t\t}\n\t}\n\n\t// @ts-ignore\n\tget width(): number {\n\t\tthis.update();\n\t\treturn Math.abs(this.scale.x) * this.geometry.width;\n\t}\n\n\tset width(width: number) {\n\t\tthis.update();\n\t\tconst geometryWidth = this.geometry.width;\n\t\tif (+1e-4 < geometryWidth) {\n\t\t\tconst newScale = width / geometryWidth;\n\t\t\tthis.scale.x = 0 <= this.scale.x ? +newScale : -newScale;\n\t\t}\n\t}\n\n\t// @ts-ignore\n\tget height(): number {\n\t\tthis.update();\n\t\treturn Math.abs(this.scale.y) * this.geometry.height;\n\t}\n\n\tset height(height: number) {\n\t\tthis.update();\n\t\tconst geometryHeight = this.geometry.height;\n\t\tif (+1e-4 < geometryHeight) {\n\t\t\tconst newScale = height / geometryHeight;\n\t\t\tthis.scale.y = 0 <= this.scale.y ? +newScale : -newScale;\n\t\t}\n\t}\n\n\tget clipped(): boolean {\n\t\treturn this.geometry.clipped;\n\t}\n\n\tget style(): DDynamicTextStyle {\n\t\treturn this._style;\n\t}\n\n\tupdate(): void {\n\t\tthis.update_();\n\n\t\tlet atlas = this._atlas;\n\t\tif (atlas == null) {\n\t\t\tconst layer = DApplications.getLayer(this);\n\t\t\tif (layer) {\n\t\t\t\tconst style = this._style;\n\t\t\t\tatlas = layer.getDynamicFontAtlases().get(style.fontId, style.fill);\n\t\t\t\tif (atlas != null) {\n\t\t\t\t\tthis._atlasRevisionUpdated = atlas.getRevisionUpdate();\n\t\t\t\t\tthis._atlas = atlas;\n\t\t\t\t\tthis.texture = atlas.texture;\n\t\t\t\t\tthis._isGeometryDirty = true;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tconst revisionUpdate = atlas.getRevisionUpdate();\n\t\t\tif (revisionUpdate !== this._atlasRevisionUpdated) {\n\t\t\t\tthis._atlasRevisionUpdated = revisionUpdate;\n\t\t\t\tthis._isGeometryDirty = true;\n\t\t\t}\n\t\t}\n\n\t\tconst style = this._style;\n\t\tconst clipping = this._clipping;\n\t\tif (this.updateClipping(style, clipping)) {\n\t\t\tthis._isGeometryDirty = true;\n\t\t}\n\n\t\tif (this._isGeometryDirty) {\n\t\t\tthis._isGeometryDirty = false;\n\t\t\tthis.geometry.update(this._text, atlas, clipping);\n\t\t}\n\t}\n\n\tprotected updateClipping(style: DDynamicTextStyle, clipping: DDynamicTextClipping): boolean {\n\t\tlet isChanged = false;\n\n\t\tconst styleClipping = style.clipping;\n\t\tif (clipping.enable !== styleClipping) {\n\t\t\tclipping.enable = styleClipping;\n\t\t\tisChanged = true;\n\t\t}\n\n\t\tconst styleWordWrap = style.wordWrap;\n\t\tif (clipping.wordWrap !== styleWordWrap) {\n\t\t\tclipping.wordWrap = styleWordWrap;\n\t\t\tisChanged = true;\n\t\t}\n\n\t\tconst styleLineHeight = style.lineHeight;\n\t\tif (clipping.lineHeight !== styleLineHeight) {\n\t\t\tclipping.lineHeight = styleLineHeight;\n\t\t\tisChanged = true;\n\t\t}\n\n\t\tif (styleClipping || styleWordWrap) {\n\t\t\tconst parent = this.parent;\n\t\t\tif (parent instanceof DBase) {\n\t\t\t\tconst width =\n\t\t\t\t\tparent.width -\n\t\t\t\t\tparent.padding.getLeft() -\n\t\t\t\t\tparent.padding.getRight() -\n\t\t\t\t\tclipping.delta.width;\n\t\t\t\tif (clipping.width !== width) {\n\t\t\t\t\tclipping.width = width;\n\t\t\t\t\tisChanged = true;\n\t\t\t\t}\n\n\t\t\t\tconst height =\n\t\t\t\t\tparent.height -\n\t\t\t\t\tparent.padding.getTop() -\n\t\t\t\t\tparent.padding.getBottom() -\n\t\t\t\t\tclipping.delta.height;\n\t\t\t\tif (clipping.height !== height) {\n\t\t\t\t\tclipping.height = height;\n\t\t\t\t\tisChanged = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn isChanged;\n\t}\n\n\tsetClippingDelta(width: number, height: number): void {\n\t\tconst delta = this._clipping.delta;\n\t\tdelta.width = width;\n\t\tdelta.height = height;\n\t}\n\n\t_calculateBounds(): void {\n\t\tthis.update();\n\t\tsuper._calculateBounds();\n\t}\n\n\t_render(renderer?: Renderer): void {\n\t\tthis.update();\n\t\t(super._render as any)(renderer);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Graphics } from \"pixi.js\";\nimport { DAlignHorizontal } from \"./d-align-horizontal\";\nimport { DAlignVertical } from \"./d-align-vertical\";\nimport { DApplications } from \"./d-applications\";\nimport { DBase, DBaseEvents, DBaseOptions, DRefitable, DThemeBase } from \"./d-base\";\nimport { DBaseOverflowMaskSimple } from \"./d-base-overflow-mask-simple\";\nimport { DBaseStateSet } from \"./d-base-state-set\";\nimport { DDynamicText } from \"./d-dynamic-text\";\nimport { DDynamicTextStyleOptions } from \"./d-dynamic-text-style\";\nimport { DDynamicTextStyleWordWrap } from \"./d-dynamic-text-style-word-wrap\";\nimport { DOnOptions } from \"./d-on-options\";\nimport { DStateAwareOrValueMightBe } from \"./d-state-aware\";\nimport { isFunction } from \"./util/is-function\";\nimport { toEnum } from \"./util/to-enum\";\n\n/**\n * {@link DTextBase} text align options.\n */\nexport interface DTextBaseTextAlignOptions {\n\tvertical?: keyof typeof DAlignVertical | DAlignVertical;\n\thorizontal?: keyof typeof DAlignHorizontal | DAlignHorizontal;\n}\n\n/**\n * {@link DTextBase} text options.\n */\nexport interface DTextBaseTextOptions<VALUE = unknown> {\n\tvalue?: DStateAwareOrValueMightBe<VALUE>;\n\tcolor?: DStateAwareOrValueMightBe<number>;\n\talpha?: DStateAwareOrValueMightBe<number>;\n\tstyle?: DDynamicTextStyleOptions;\n\talign?: DTextBaseTextAlignOptions;\n\tformatter?: (value: VALUE, caller: any) => string;\n}\n\n/**\n * {@link DTextBase} events.\n */\nexport interface DTextBaseEvents<VALUE, EMITTER> extends DBaseEvents<EMITTER> {}\n\n/**\n * {@link DTextBase} \"on\" options.\n */\nexport interface DTextBaseOnOptions<VALUE, EMITTER>\n\textends Partial<DTextBaseEvents<VALUE, EMITTER>>,\n\t\tDOnOptions {}\n\n/**\n * {@link DTextBase} options.\n */\nexport interface DTextBaseOptions<\n\tVALUE = unknown,\n\tTHEME extends DThemeTextBase<VALUE> = DThemeTextBase<VALUE>,\n\tEMITTER = any\n> extends DBaseOptions<THEME, EMITTER> {\n\ttext?: DTextBaseTextOptions<VALUE>;\n\tmask?: boolean;\n\ton?: DTextBaseOnOptions<VALUE, EMITTER>;\n}\n\n/**\n * {@link DTextBase} theme.\n */\nexport interface DThemeTextBase<VALUE = unknown> extends DThemeBase {\n\tgetTextFormatter(): (value: VALUE, caller: any) => string;\n\n\t/**\n\t * Returns a new text value.\n\t * Called to initialize a text value if a text value is not given.\n\t */\n\tnewTextValue(): DStateAwareOrValueMightBe<VALUE>;\n\n\t/**\n\t * Returns a text value.\n\t * Called to get a text vale if there is no text value.\n\t *\n\t * @param state a state\n\t */\n\tgetTextValue(state: DBaseStateSet): VALUE | undefined;\n\n\tgetTextAlignVertical(): DAlignVertical;\n\tgetTextAlignHorizontal(): DAlignHorizontal;\n\tgetTextStyleClipping(): boolean;\n\tgetTextStyleWordWrap(): DDynamicTextStyleWordWrap;\n\tisOverflowMaskEnabled(): boolean;\n}\n\nconst toTextStyle = <VALUE, THEME extends DThemeTextBase<VALUE>>(\n\ttheme: THEME,\n\toptions: DTextBaseOptions<VALUE, THEME> | undefined,\n\tstate: DBaseStateSet\n): DDynamicTextStyleOptions => {\n\tconst style = options?.text?.style;\n\tif (style != null) {\n\t\tconst fill = style.fill ?? theme.getColor(state);\n\t\tconst fontSize = style.fontSize ?? theme.getFontSize();\n\t\tconst fontFamily = style.fontFamily ?? theme.getFontFamilly();\n\t\tconst fontWeight = style.fontWeight ?? theme.getFontWeight();\n\t\tconst fontStyle = style.fontStyle ?? theme.getFontStyle();\n\t\tconst fontVariant = style.fontVariant ?? theme.getFontVariant();\n\t\tconst clipping = style.clipping ?? theme.getTextStyleClipping();\n\t\tconst wordWrap = style.wordWrap ?? theme.getTextStyleWordWrap();\n\t\tconst lineHeight = style.lineHeight ?? theme.getLineHeight();\n\t\treturn {\n\t\t\tfill,\n\t\t\tfontSize,\n\t\t\tfontFamily,\n\t\t\tfontWeight,\n\t\t\tfontStyle,\n\t\t\tfontVariant,\n\t\t\tclipping,\n\t\t\twordWrap,\n\t\t\tlineHeight\n\t\t};\n\t}\n\n\treturn {\n\t\tfill: theme.getColor(state),\n\t\tfontSize: theme.getFontSize(),\n\t\tfontFamily: theme.getFontFamilly(),\n\t\tfontWeight: theme.getFontWeight(),\n\t\tfontStyle: theme.getFontStyle(),\n\t\tfontVariant: theme.getFontVariant(),\n\t\tclipping: theme.getTextStyleClipping(),\n\t\twordWrap: theme.getTextStyleWordWrap(),\n\t\tlineHeight: theme.getLineHeight()\n\t};\n};\n\nconst toTextAlign = <VALUE, THEME extends DThemeTextBase<VALUE>>(\n\ttheme: THEME,\n\toptions?: DTextBaseOptions<VALUE, THEME>\n): { vertical: DAlignVertical; horizontal: DAlignHorizontal } => {\n\tconst align = options?.text?.align;\n\treturn {\n\t\tvertical: toEnum(align?.vertical ?? theme.getTextAlignVertical(), DAlignVertical),\n\t\thorizontal: toEnum(align?.horizontal ?? theme.getTextAlignHorizontal(), DAlignHorizontal)\n\t};\n};\n\n/**\n * A base class for UI classes with a text support.\n * See {@link DTextBaseEvents} for event defaults.\n */\nexport class DTextBase<\n\tVALUE = unknown,\n\tTHEME extends DThemeTextBase<VALUE> = DThemeTextBase<VALUE>,\n\tOPTIONS extends DTextBaseOptions<VALUE, THEME> = DTextBaseOptions<VALUE, THEME>\n> extends DBase<THEME, OPTIONS> {\n\tprotected _text?: DDynamicText | null;\n\tprotected _textValue?: DStateAwareOrValueMightBe<VALUE>;\n\tprotected _textValueComputed?: VALUE;\n\tprotected _textColor!: DStateAwareOrValueMightBe<number>;\n\tprotected _textAlpha!: DStateAwareOrValueMightBe<number>;\n\tprotected _textStyle!: DDynamicTextStyleOptions;\n\tprotected _textAlign!: {\n\t\tvertical: DAlignVertical;\n\t\thorizontal: DAlignHorizontal;\n\t};\n\tprotected _textFormatter!: (value: VALUE, caller: any) => string;\n\tprotected _isOverflowMaskEnabled!: boolean;\n\tprotected _overflowMask?: DBaseOverflowMaskSimple | null;\n\tprotected _isTextVisible!: boolean;\n\n\tprotected init(options?: OPTIONS): void {\n\t\tsuper.init(options);\n\n\t\tconst theme = this.theme;\n\t\tthis._textValue = options?.text?.value ?? theme.newTextValue();\n\t\tthis._textValueComputed = this.computeTextValue();\n\t\tconst text = options?.text;\n\t\tthis._textColor = text?.color;\n\t\tthis._textAlpha = text?.alpha;\n\t\tthis._textStyle = toTextStyle(theme, options, this.state);\n\t\tthis._textAlign = toTextAlign(theme, options);\n\t\tthis._textFormatter = text?.formatter ?? theme.getTextFormatter();\n\t\tthis._isTextVisible = true;\n\t\tthis._isOverflowMaskEnabled = options?.mask ?? theme.isOverflowMaskEnabled();\n\t\tthis.onTextChange();\n\t\tthis.createOrUpdateText();\n\t}\n\n\tset text(text: DStateAwareOrValueMightBe<VALUE>) {\n\t\tif (this._textValue !== text) {\n\t\t\tthis._textValue = text;\n\t\t\tthis.updateTextValue();\n\t\t}\n\t}\n\n\tget text(): DStateAwareOrValueMightBe<VALUE> {\n\t\treturn this._textValue;\n\t}\n\n\tprotected onTextChange(): void {\n\t\t// DO NOTHING\n\t}\n\n\tprotected computeTextValue(): VALUE | undefined {\n\t\tconst textValue = this._textValue;\n\t\tif (textValue !== undefined) {\n\t\t\tif (isFunction(textValue)) {\n\t\t\t\tconst result = textValue(this.state);\n\t\t\t\tif (result !== undefined) {\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn textValue;\n\t\t\t}\n\t\t}\n\t\treturn this.theme.getTextValue(this.state);\n\t}\n\n\tprotected createOrUpdateText(): void {\n\t\tconst textValueComputed = this._textValueComputed;\n\t\tif (textValueComputed !== undefined) {\n\t\t\tconst formatted = this._textFormatter(textValueComputed, this);\n\t\t\tconst text = this._text;\n\t\t\tif (text == null) {\n\t\t\t\tif (0 < formatted.length) {\n\t\t\t\t\tconst newText = this.createText(formatted);\n\t\t\t\t\tnewText.visible = this._isTextVisible;\n\t\t\t\t\tthis._text = newText;\n\t\t\t\t\tthis.addChild(newText);\n\t\t\t\t\tthis.updateTextPosition(newText);\n\t\t\t\t\tconst overflowMask = this.getOverflowMask();\n\t\t\t\t\tif (overflowMask) {\n\t\t\t\t\t\tnewText.mask = overflowMask;\n\t\t\t\t\t}\n\t\t\t\t\tthis.toDirty();\n\t\t\t\t\tDApplications.update(this);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\ttext.text = formatted;\n\t\t\t\tthis.toDirty();\n\t\t\t\tDApplications.update(this);\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected createText(formatted: string): DDynamicText {\n\t\treturn new DDynamicText(formatted, this._textStyle);\n\t}\n\n\tgetOverflowMask(): Graphics | null {\n\t\tif (this._isOverflowMaskEnabled) {\n\t\t\tif (this._overflowMask == null) {\n\t\t\t\tthis._overflowMask = new DBaseOverflowMaskSimple(this);\n\t\t\t\tthis._reflowable.add(this._overflowMask);\n\t\t\t\tthis.toDirty();\n\t\t\t}\n\t\t\treturn this._overflowMask;\n\t\t}\n\t\treturn null;\n\t}\n\n\tprotected updateTextPosition(text: DDynamicText): void {\n\t\tconst align = this._textAlign;\n\t\tconst padding = this._padding;\n\t\tconst toRounded = this.toRounded;\n\n\t\tswitch (align.horizontal) {\n\t\t\tcase DAlignHorizontal.LEFT:\n\t\t\t\ttext.x = toRounded(padding.getLeft());\n\t\t\t\tbreak;\n\t\t\tcase DAlignHorizontal.CENTER:\n\t\t\t\ttext.x = toRounded((this.width - text.width) * 0.5);\n\t\t\t\tbreak;\n\t\t\tcase DAlignHorizontal.RIGHT:\n\t\t\t\ttext.x = toRounded(this.width - text.width - padding.getRight());\n\t\t\t\tbreak;\n\t\t}\n\n\t\tswitch (align.vertical) {\n\t\t\tcase DAlignVertical.TOP:\n\t\t\t\ttext.y = toRounded(padding.getTop());\n\t\t\t\tbreak;\n\t\t\tcase DAlignVertical.MIDDLE:\n\t\t\t\ttext.y = toRounded((this.height - text.height) * 0.5);\n\t\t\t\tbreak;\n\t\t\tcase DAlignVertical.BOTTOM:\n\t\t\t\ttext.y = toRounded(this.height - text.height - padding.getBottom());\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tprotected toRounded(this: unknown, value: number): number {\n\t\treturn Math.round(value);\n\t}\n\n\tprotected getTextColor(theme: THEME, state: DBaseStateSet): number {\n\t\tconst color = this._textColor;\n\t\tif (color !== undefined) {\n\t\t\tif (isFunction(color)) {\n\t\t\t\tconst result = color(state);\n\t\t\t\tif (result !== undefined) {\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn color;\n\t\t\t}\n\t\t}\n\t\treturn theme.getColor(state);\n\t}\n\n\tprotected getTextAlpha(theme: THEME, state: DBaseStateSet): number {\n\t\tconst alpha = this._textAlpha;\n\t\tif (alpha !== undefined) {\n\t\t\tif (isFunction(alpha)) {\n\t\t\t\tconst result = alpha(state);\n\t\t\t\tif (result !== undefined) {\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn alpha;\n\t\t\t}\n\t\t}\n\t\treturn theme.getAlpha(state);\n\t}\n\n\tprotected updateTextColor(text: DDynamicText): void {\n\t\tconst theme = this.theme;\n\t\tconst state = this.state;\n\t\ttext.style.fill = this.getTextColor(theme, state);\n\t\ttext.alpha = this.getTextAlpha(theme, state);\n\t}\n\n\tprotected updateTextValue(): void {\n\t\tconst newTextValueComputed = this.computeTextValue();\n\t\tif (this._textValueComputed !== newTextValueComputed) {\n\t\t\tthis._textValueComputed = newTextValueComputed;\n\t\t\tthis.onTextChange();\n\t\t\tthis.createOrUpdateText();\n\t\t}\n\t}\n\n\tprotected updateText(): void {\n\t\tconst text = this._text;\n\t\tif (text) {\n\t\t\tthis.updateTextValue();\n\t\t\tthis.updateTextPosition(text);\n\t\t\tthis.updateTextColor(text);\n\t\t}\n\t}\n\n\tprotected showText(): void {\n\t\tconst text = this._text;\n\t\tif (text) {\n\t\t\ttext.visible = true;\n\t\t}\n\t\tthis._isTextVisible = true;\n\t}\n\n\tprotected hideText(): void {\n\t\tconst text = this._text;\n\t\tif (text) {\n\t\t\ttext.visible = false;\n\t\t}\n\t\tthis._isTextVisible = false;\n\t}\n\n\tprotected onReflow(): void {\n\t\tsuper.onReflow();\n\t\tthis.updateText();\n\t}\n\n\tprotected isRefitable(target: any): target is DRefitable {\n\t\treturn super.isRefitable(target) || (target != null && target === this._text);\n\t}\n\n\tprotected applyTitle(): void {\n\t\tconst text = this._text;\n\t\tif (this._title.length <= 0 && text && \"clipped\" in text && text.clipped) {\n\t\t\tconst layer = DApplications.getLayer(this);\n\t\t\tif (layer) {\n\t\t\t\tlayer.view.title = text.text;\n\t\t\t}\n\t\t} else {\n\t\t\tsuper.applyTitle();\n\t\t}\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DTextBase\";\n\t}\n\n\tdestroy(): void {\n\t\t// Text\n\t\tconst text = this._text;\n\t\tif (text) {\n\t\t\tthis._text = null;\n\t\t\ttext.destroy();\n\t\t}\n\n\t\t// Overflow mask\n\t\tconst overflowMask = this._overflowMask;\n\t\tif (overflowMask) {\n\t\t\tthis._overflowMask = null;\n\t\t\toverflowMask.destroy();\n\t\t}\n\n\t\tsuper.destroy();\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DisplayObject, Texture } from \"pixi.js\";\nimport { DAlignHorizontal } from \"./d-align-horizontal\";\nimport { DAlignVertical } from \"./d-align-vertical\";\nimport { DAlignWith } from \"./d-align-with\";\nimport { DRefitable } from \"./d-base\";\nimport { DBaseStateSet } from \"./d-base-state-set\";\nimport {\n\tDImageBaseThemeWrapperSecondary,\n\tDThemeImageBaseSecondary\n} from \"./d-image-base-theme-wrapper-secondary\";\nimport {\n\tDImageBaseThemeWrapperTertiary,\n\tDThemeImageBaseTertiary\n} from \"./d-image-base-theme-wrapper-tertiary\";\nimport { DImagePiece, DImagePieceOptions, DThemeImagePiece } from \"./d-image-piece\";\nimport { DOnOptions } from \"./d-on-options\";\nimport { DStateAwareOrValueMightBe } from \"./d-state-aware\";\nimport { DTextBase, DTextBaseEvents, DTextBaseOptions, DThemeTextBase } from \"./d-text-base\";\n\n/**\n * {@link DImageBase} events.\n */\nexport interface DImageBaseEvents<VALUE, EMITTER> extends DTextBaseEvents<VALUE, EMITTER> {}\n\n/**\n * {@link DImageBase} \"on\" options.\n */\nexport interface DImageBaseOnOptions<VALUE, EMITTER>\n\textends Partial<DImageBaseEvents<VALUE, EMITTER>>,\n\t\tDOnOptions {}\n\n/**\n * {@link DImageBase} options.\n */\nexport interface DImageBaseOptions<\n\tVALUE = unknown,\n\tTHEME extends DThemeImageBase<VALUE> = DThemeImageBase<VALUE>,\n\tEMITTER = any\n> extends DTextBaseOptions<VALUE, THEME, EMITTER> {\n\timage?: DImagePieceOptions;\n\ton?: DImageBaseOnOptions<VALUE, EMITTER>;\n}\n\n/**\n * {@link DImageBase} theme.\n */\nexport interface DThemeImageBase<VALUE = unknown> extends DThemeTextBase<VALUE>, DThemeImagePiece {\n\tgetSecondaryImageAlignHorizontal(): DAlignHorizontal;\n\tgetSecondaryImageAlignVertical(): DAlignVertical;\n\tgetSecondaryImageAlignWith(): DAlignWith;\n\tgetSecondaryImageMarginHorizontal(): number;\n\tgetSecondaryImageMarginVertial(): number;\n\tgetSecondaryImageTintColor(state: DBaseStateSet): number | null;\n\tgetSecondaryImageTintAlpha(state: DBaseStateSet): number;\n\tgetSecondaryImageSource?(state: DBaseStateSet): Texture | DisplayObject | null;\n\n\tgetTertiaryImageAlignHorizontal(): DAlignHorizontal;\n\tgetTertiaryImageAlignVertical(): DAlignVertical;\n\tgetTertiaryImageAlignWith(): DAlignWith;\n\tgetTertiaryImageMarginHorizontal(): number;\n\tgetTertiaryImageMarginVertial(): number;\n\tgetTertiaryImageTintColor(state: DBaseStateSet): number | null;\n\tgetTertiaryImageTintAlpha(state: DBaseStateSet): number;\n\tgetTertiaryImageSource?(state: DBaseStateSet): Texture | DisplayObject | null;\n}\n\nconst hasSecondaryImageSource = <VALUE>(\n\ttheme: DThemeImageBase<VALUE>\n): theme is DThemeImageBase<VALUE> & DThemeImageBaseSecondary => {\n\treturn !!theme.getSecondaryImageSource;\n};\n\nconst hasTertiaryImageSource = <VALUE>(\n\ttheme: DThemeImageBase<VALUE>\n): theme is DThemeImageBase<VALUE> & DThemeImageBaseTertiary => {\n\treturn !!theme.getTertiaryImageSource;\n};\n\n/**\n * A base class for UI classes with an image support.\n * See {@link DImageBaseEvents} for event details.\n */\nexport class DImageBase<\n\tVALUE = unknown,\n\tTHEME extends DThemeImageBase<VALUE> = DThemeImageBase<VALUE>,\n\tOPTIONS extends DImageBaseOptions<VALUE, THEME> = DImageBaseOptions<VALUE, THEME>\n> extends DTextBase<VALUE, THEME, OPTIONS> {\n\tprotected _images!: DImagePiece[];\n\n\tprotected init(options?: OPTIONS): void {\n\t\tthis._images = this.newImages(this.theme, options);\n\t\tsuper.init(options);\n\t}\n\n\tprotected newImages(theme: THEME, options?: OPTIONS): DImagePiece[] {\n\t\tconst images: DImagePiece[] = [];\n\t\timages.push(this.newImage(theme, this.toImageOptions(theme, options?.image)));\n\t\tif (hasSecondaryImageSource(theme)) {\n\t\t\timages.push(this.newImage(new DImageBaseThemeWrapperSecondary(theme)));\n\t\t}\n\t\tif (hasTertiaryImageSource(theme)) {\n\t\t\timages.push(this.newImage(new DImageBaseThemeWrapperTertiary(theme)));\n\t\t}\n\t\treturn images;\n\t}\n\n\tprotected toImageOptions(\n\t\ttheme: THEME,\n\t\toptions?: DImagePieceOptions\n\t): DImagePieceOptions | undefined {\n\t\treturn options;\n\t}\n\n\tprotected newImage(theme: DThemeImagePiece, options?: DImagePieceOptions): DImagePiece {\n\t\treturn new DImagePiece(this, theme, this._textAlign, options);\n\t}\n\n\tget image(): DStateAwareOrValueMightBe<Texture | DisplayObject | null> {\n\t\treturn this._images[0].source;\n\t}\n\n\tset image(imageSource: DStateAwareOrValueMightBe<Texture | DisplayObject | null>) {\n\t\tthis._images[0].source = imageSource;\n\t}\n\n\tprotected onStateChange(newState: DBaseStateSet, oldState: DBaseStateSet): void {\n\t\tsuper.onStateChange(newState, oldState);\n\n\t\tconst images = this._images;\n\t\tfor (let i = 0, imax = images.length; i < imax; ++i) {\n\t\t\timages[i].onStateChange(newState, oldState);\n\t\t}\n\t}\n\n\tprotected updateText(): void {\n\t\tthis.updateTextValue();\n\t\tthis.updateTextAndImage();\n\t}\n\n\tprotected updateTextAndImage(): void {\n\t\tconst text = this._text;\n\t\tconst images = this._images;\n\t\tconst padding = this._padding;\n\n\t\tconst toRounded = this.toRounded;\n\n\t\tconst width = this.width;\n\t\tconst height = this.height;\n\n\t\tconst pl = padding.getLeft();\n\t\tconst pr = padding.getRight();\n\t\tconst pt = padding.getTop();\n\t\tconst pb = padding.getBottom();\n\n\t\tconst noText = text == null;\n\n\t\tlet textLeftFirst = noText;\n\t\tlet textTopFirst = noText;\n\n\t\tlet textRightLastMargin = 0;\n\t\tlet textBottomLastMargin = 0;\n\n\t\tlet textLeft = 0;\n\t\tlet textRight = 0;\n\t\tlet textTop = 0;\n\t\tlet textBottom = 0;\n\n\t\tlet paddingLeft = pl;\n\t\tlet paddingRight = width - pr;\n\t\tlet paddingTop = pt;\n\t\tlet paddingBottom = height - pb;\n\n\t\tlet borderLeft = 0;\n\t\tlet borderRight = width;\n\t\tlet borderTop = 0;\n\t\tlet borderBottom = height;\n\n\t\tfor (let i = 0, imax = images.length; i < imax; ++i) {\n\t\t\tconst image = images[i];\n\t\t\timage.updateSource();\n\t\t\timage.updateTint();\n\t\t\timage.updateBound();\n\n\t\t\tconst imageImage = image.image;\n\t\t\tif (imageImage) {\n\t\t\t\tconst imageBound = image.bound;\n\t\t\t\tconst imageBoundWidth = imageBound.width;\n\t\t\t\tconst imageBoundHeight = imageBound.height;\n\t\t\t\tconst imageMargin = image.margin;\n\t\t\t\tconst imageMarginHorizontal = imageMargin.horizontal;\n\t\t\t\tconst imageMarginVertical = imageMargin.vertical;\n\n\t\t\t\t// Text\n\t\t\t\tif (image.align.with === DAlignWith.TEXT) {\n\t\t\t\t\tswitch (image.align.horizontal) {\n\t\t\t\t\t\tcase DAlignHorizontal.LEFT:\n\t\t\t\t\t\t\timageImage.x = textLeft;\n\t\t\t\t\t\t\ttextLeft += imageBoundWidth;\n\t\t\t\t\t\t\tif (textLeftFirst) {\n\t\t\t\t\t\t\t\ttextLeftFirst = false;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\ttextLeft += imageMarginHorizontal;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase DAlignHorizontal.CENTER:\n\t\t\t\t\t\t\t// DO NOTHING\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase DAlignHorizontal.RIGHT:\n\t\t\t\t\t\t\ttextRight -= imageBoundWidth;\n\t\t\t\t\t\t\timageImage.x = textRight;\n\t\t\t\t\t\t\ttextRight -= imageMarginHorizontal;\n\t\t\t\t\t\t\ttextRightLastMargin = imageMarginHorizontal;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tswitch (image.align.vertical) {\n\t\t\t\t\t\tcase DAlignVertical.TOP:\n\t\t\t\t\t\t\timageImage.y = textTop;\n\t\t\t\t\t\t\ttextTop += imageBoundHeight;\n\t\t\t\t\t\t\tif (textTopFirst) {\n\t\t\t\t\t\t\t\ttextTopFirst = false;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\ttextTop += imageMarginVertical;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase DAlignVertical.MIDDLE:\n\t\t\t\t\t\t\t// DO NOTHING\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase DAlignVertical.BOTTOM:\n\t\t\t\t\t\t\ttextBottom -= imageBoundHeight;\n\t\t\t\t\t\t\timageImage.y = textBottom;\n\t\t\t\t\t\t\ttextBottom -= imageMarginVertical;\n\t\t\t\t\t\t\ttextBottomLastMargin = imageMarginVertical;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Padding\n\t\t\t\tif (image.align.with === DAlignWith.PADDING) {\n\t\t\t\t\tswitch (image.align.horizontal) {\n\t\t\t\t\t\tcase DAlignHorizontal.LEFT:\n\t\t\t\t\t\t\tpaddingLeft += imageMarginHorizontal;\n\t\t\t\t\t\t\timageImage.x = toRounded(paddingLeft);\n\t\t\t\t\t\t\tpaddingLeft += imageBoundWidth;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase DAlignHorizontal.CENTER:\n\t\t\t\t\t\t\t// DO NOTHING\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase DAlignHorizontal.RIGHT:\n\t\t\t\t\t\t\tpaddingRight -= imageBoundWidth + imageMarginHorizontal;\n\t\t\t\t\t\t\timageImage.x = toRounded(paddingRight);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tswitch (image.align.vertical) {\n\t\t\t\t\t\tcase DAlignVertical.TOP:\n\t\t\t\t\t\t\tpaddingTop += imageMarginVertical;\n\t\t\t\t\t\t\timageImage.y = toRounded(paddingTop);\n\t\t\t\t\t\t\tpaddingTop += imageBoundHeight;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase DAlignVertical.MIDDLE:\n\t\t\t\t\t\t\t// DO NOTHING\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase DAlignVertical.BOTTOM:\n\t\t\t\t\t\t\tpaddingBottom -= imageBoundHeight + imageMarginVertical;\n\t\t\t\t\t\t\timageImage.y = toRounded(paddingBottom);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Border\n\t\t\t\tif (image.align.with === DAlignWith.BORDER) {\n\t\t\t\t\tswitch (image.align.horizontal) {\n\t\t\t\t\t\tcase DAlignHorizontal.LEFT:\n\t\t\t\t\t\t\tborderLeft += imageMarginHorizontal;\n\t\t\t\t\t\t\timageImage.x = toRounded(borderLeft);\n\t\t\t\t\t\t\tborderLeft += imageBoundWidth;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase DAlignHorizontal.CENTER:\n\t\t\t\t\t\t\t// DO NOTHING\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase DAlignHorizontal.RIGHT:\n\t\t\t\t\t\t\tborderRight -= imageBoundWidth + imageMarginHorizontal;\n\t\t\t\t\t\t\timageImage.x = toRounded(borderRight);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tswitch (image.align.vertical) {\n\t\t\t\t\t\tcase DAlignVertical.TOP:\n\t\t\t\t\t\t\tborderTop += imageMarginVertical;\n\t\t\t\t\t\t\timageImage.y = toRounded(borderTop);\n\t\t\t\t\t\t\tborderTop += imageBoundHeight;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase DAlignVertical.MIDDLE:\n\t\t\t\t\t\t\t// DO NOTHING\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase DAlignVertical.BOTTOM:\n\t\t\t\t\t\t\tborderBottom -= imageBoundHeight + imageMarginVertical;\n\t\t\t\t\t\t\timageImage.y = toRounded(borderBottom);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (noText) {\n\t\t\ttextRight += textRightLastMargin;\n\t\t\ttextBottom += textBottomLastMargin;\n\t\t}\n\n\t\t// Text\n\t\tlet textLeftAdjust = 0;\n\t\tlet textCenterAdjust = 0;\n\t\tlet textRightAdjust = 0;\n\t\tlet textTopAdjust = 0;\n\t\tlet textMiddleAdjust = 0;\n\t\tlet textBottomAdjust = 0;\n\n\t\tif (text != null) {\n\t\t\tthis.updateTextColor(text);\n\t\t\ttext.setClippingDelta(textLeft - textRight, textTop - textBottom);\n\n\t\t\tconst textAlign = this._textAlign;\n\t\t\tconst textWidth = text.width;\n\t\t\tconst textHeight = text.height;\n\t\t\tswitch (textAlign.horizontal) {\n\t\t\t\tcase DAlignHorizontal.LEFT:\n\t\t\t\t\ttextLeftAdjust = pl;\n\t\t\t\t\ttextRightAdjust = textLeftAdjust + textLeft + textWidth - textRight;\n\t\t\t\t\tbreak;\n\t\t\t\tcase DAlignHorizontal.CENTER:\n\t\t\t\t\ttextLeftAdjust = (width - textLeft + textRight - textWidth) * 0.5;\n\t\t\t\t\ttextRightAdjust = textLeftAdjust + textLeft + textWidth - textRight;\n\t\t\t\t\tbreak;\n\t\t\t\tcase DAlignHorizontal.RIGHT:\n\t\t\t\t\ttextRightAdjust = width - pr;\n\t\t\t\t\ttextLeftAdjust = textRightAdjust + textRight - textWidth - textLeft;\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\ttext.x = toRounded(textLeftAdjust + textLeft);\n\t\t\ttextCenterAdjust = textLeftAdjust + textLeft + textWidth * 0.5;\n\n\t\t\tswitch (textAlign.vertical) {\n\t\t\t\tcase DAlignVertical.TOP:\n\t\t\t\t\ttextTopAdjust = pt;\n\t\t\t\t\ttextBottomAdjust = textTopAdjust + textTop + textHeight - textBottom;\n\t\t\t\t\tbreak;\n\t\t\t\tcase DAlignVertical.MIDDLE:\n\t\t\t\t\ttextTopAdjust = (height - textTop + textBottom - textHeight) * 0.5;\n\t\t\t\t\ttextBottomAdjust = textTopAdjust + textTop + textHeight - textBottom;\n\t\t\t\t\tbreak;\n\t\t\t\tcase DAlignVertical.BOTTOM:\n\t\t\t\t\ttextBottomAdjust = height - pb;\n\t\t\t\t\ttextTopAdjust = textBottomAdjust + textBottom - textHeight - textTop;\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\ttext.y = toRounded(textTopAdjust + textTop);\n\t\t\ttextMiddleAdjust = textTopAdjust + textTop + textHeight * 0.5;\n\t\t} else {\n\t\t\ttextLeftAdjust = (width - textLeft + textRight) * 0.5;\n\t\t\ttextRightAdjust = textLeftAdjust + textLeft - textRight;\n\t\t\ttextCenterAdjust = textLeftAdjust + textLeft;\n\n\t\t\ttextTopAdjust = (height - textTop + textBottom) * 0.5;\n\t\t\ttextBottomAdjust = textTopAdjust + textTop - textBottom;\n\t\t\ttextMiddleAdjust = textTopAdjust + textTop;\n\t\t}\n\n\t\tconst paddingCenterAdjust = width * 0.5;\n\t\tconst paddingMiddleAdjust = height * 0.5;\n\n\t\tconst borderCenterAdjust = width * 0.5;\n\t\tconst borderMiddleAdjust = height * 0.5;\n\n\t\tfor (let i = 0, imax = images.length; i < imax; ++i) {\n\t\t\tconst image = images[i];\n\t\t\tconst imageImage = image.image;\n\t\t\tif (imageImage) {\n\t\t\t\tconst imageBound = image.bound;\n\t\t\t\tconst imageBoundWidth = imageBound.width;\n\t\t\t\tconst imageBoundHeight = imageBound.height;\n\n\t\t\t\t// Text\n\t\t\t\tif (image.align.with === DAlignWith.TEXT) {\n\t\t\t\t\tswitch (image.align.horizontal) {\n\t\t\t\t\t\tcase DAlignHorizontal.LEFT:\n\t\t\t\t\t\t\timageImage.x = toRounded(imageImage.x + textLeftAdjust);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase DAlignHorizontal.CENTER:\n\t\t\t\t\t\t\timageImage.x = toRounded(textCenterAdjust - imageBoundWidth * 0.5);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase DAlignHorizontal.RIGHT:\n\t\t\t\t\t\t\timageImage.x = toRounded(imageImage.x + textRightAdjust);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tswitch (image.align.vertical) {\n\t\t\t\t\t\tcase DAlignVertical.TOP:\n\t\t\t\t\t\t\timageImage.y = toRounded(imageImage.y + textTopAdjust);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase DAlignVertical.MIDDLE:\n\t\t\t\t\t\t\timageImage.y = toRounded(textMiddleAdjust - imageBoundHeight * 0.5);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase DAlignVertical.BOTTOM:\n\t\t\t\t\t\t\timageImage.y = toRounded(imageImage.y + textBottomAdjust);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Padding\n\t\t\t\tif (image.align.with === DAlignWith.PADDING) {\n\t\t\t\t\tswitch (image.align.horizontal) {\n\t\t\t\t\t\tcase DAlignHorizontal.CENTER:\n\t\t\t\t\t\t\timageImage.x = toRounded(paddingCenterAdjust - imageBoundWidth * 0.5);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tswitch (image.align.vertical) {\n\t\t\t\t\t\tcase DAlignVertical.MIDDLE:\n\t\t\t\t\t\t\timageImage.y = toRounded(paddingMiddleAdjust - imageBoundHeight * 0.5);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Border\n\t\t\t\tif (image.align.with === DAlignWith.BORDER) {\n\t\t\t\t\tswitch (image.align.horizontal) {\n\t\t\t\t\t\tcase DAlignHorizontal.CENTER:\n\t\t\t\t\t\t\timageImage.x = toRounded(borderCenterAdjust - imageBoundWidth * 0.5);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tswitch (image.align.vertical) {\n\t\t\t\t\t\tcase DAlignVertical.MIDDLE:\n\t\t\t\t\t\t\timageImage.y = toRounded(borderMiddleAdjust - imageBoundHeight * 0.5);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected isRefitable(target: any): target is DRefitable {\n\t\tif (super.isRefitable(target)) {\n\t\t\treturn true;\n\t\t}\n\n\t\tconst images = this._images;\n\t\tfor (let i = 0, imax = images.length; i < imax; ++i) {\n\t\t\tif (images[i].isRefitable(target)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DImageBase\";\n\t}\n\n\tdestroy(): void {\n\t\tconst images = this._images;\n\t\tfor (let i = 0, imax = images.length; i < imax; ++i) {\n\t\t\timages[i].destroy();\n\t\t}\n\t\tsuper.destroy();\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction } from \"pixi.js\";\nimport { DApplications } from \"./d-applications\";\nimport { DButtonBaseWhen } from \"./d-button-base-when\";\nimport { DButtonGroup } from \"./d-button-group\";\nimport { DImageBase, DImageBaseEvents, DImageBaseOptions, DThemeImageBase } from \"./d-image-base\";\nimport { DOnOptions } from \"./d-on-options\";\nimport { toEnum } from \"./util/to-enum\";\nimport { UtilKeyboardEvent } from \"./util/util-keyboard-event\";\nimport { UtilPointerEvent } from \"./util/util-pointer-event\";\n\n/**\n * {@link DButtonBase} events.\n */\nexport interface DButtonBaseEvents<VALUE, EMITTER> extends DImageBaseEvents<VALUE, EMITTER> {\n\t/**\n\t * Triggered when the button is activated.\n\t *\n\t * @param emitter an emitter\n\t */\n\tactive(emitter: EMITTER): void;\n\n\t/**\n\t * Triggered when the button is inactivated.\n\t *\n\t * @param emitter an emitter\n\t */\n\tinactive(emitter: EMITTER): void;\n}\n\n/**\n * {@link DButtonBase} \"on\" options.\n */\nexport interface DButtonBaseOnOptions<VALUE, EMITTER>\n\textends Partial<DButtonBaseEvents<VALUE, EMITTER>>,\n\t\tDOnOptions {}\n\n/**\n * {@link DButtonBase} options.\n */\nexport interface DButtonBaseOptions<\n\tVALUE = unknown,\n\tTHEME extends DThemeButtonBase<VALUE> = DThemeButtonBase<VALUE>,\n\tEMITTER = any\n> extends DImageBaseOptions<VALUE, THEME, EMITTER> {\n\t/**\n\t * True to turn a toggle mode on.\n\t */\n\ttoggle?: boolean;\n\n\t/**\n\t * A button group.\n\t */\n\tgroup?: DButtonGroup;\n\n\t/**\n\t * An option when to activate a button.\n\t */\n\twhen?: DButtonBaseWhen | keyof typeof DButtonBaseWhen;\n\n\t/**\n\t * Mappings of event names and handlers.\n\t */\n\ton?: DButtonBaseOnOptions<VALUE, EMITTER>;\n}\n\n/**\n * {@link DButtonBase} theme.\n */\nexport interface DThemeButtonBase<VALUE = unknown> extends DThemeImageBase<VALUE> {\n\t/**\n\t * Returns true to turn a toggle mode on.\n\t */\n\tisToggle(): boolean;\n\n\t/**\n\t * Returns when to activate a button.\n\t */\n\tgetWhen(): DButtonBaseWhen;\n}\n\n/**\n * A base class for button classes.\n * See {@link DButtonBaseEvents} for event details.\n */\nexport class DButtonBase<\n\tVALUE = unknown,\n\tTHEME extends DThemeButtonBase<VALUE> = DThemeButtonBase<VALUE>,\n\tOPTIONS extends DButtonBaseOptions<VALUE, THEME> = DButtonBaseOptions<VALUE, THEME>\n> extends DImageBase<VALUE, THEME, OPTIONS> {\n\tprotected _isToggle!: boolean;\n\tprotected _when!: DButtonBaseWhen;\n\n\tprotected init(options?: OPTIONS): void {\n\t\tsuper.init(options);\n\n\t\tconst theme = this.theme;\n\t\tthis._isToggle = options?.toggle ?? theme.isToggle();\n\t\tconst when = toEnum(options?.when ?? theme.getWhen(), DButtonBaseWhen);\n\t\tthis._when = when;\n\n\t\t// Event handlers\n\t\tthis.initOnClick(when, theme, options);\n\t\tthis.initOnPress(when, theme, options);\n\n\t\t// Group\n\t\tconst group = options?.group;\n\t\tif (group) {\n\t\t\tgroup.add(this);\n\t\t}\n\t}\n\n\tprotected onShortcut(e: KeyboardEvent): void {\n\t\tsuper.onShortcut(e);\n\t\tthis.onClick(e);\n\t}\n\n\tget isToggle(): boolean {\n\t\treturn this._isToggle;\n\t}\n\n\tprotected initOnClick(when: DButtonBaseWhen, theme: THEME, options?: OPTIONS): void {\n\t\tUtilPointerEvent.onClick(this, (e: interaction.InteractionEvent): void => {\n\t\t\tif (when === DButtonBaseWhen.CLICKED) {\n\t\t\t\tthis.onClick(e);\n\t\t\t}\n\t\t});\n\t}\n\n\tprotected initOnPress(when: DButtonBaseWhen, theme: THEME, options?: OPTIONS): void {\n\t\tlet interactionManager: interaction.InteractionManager | null = null;\n\n\t\tconst onUp = (): void => {\n\t\t\tthis.state.isPressed = false;\n\t\t\tif (interactionManager != null) {\n\t\t\t\tinteractionManager.off(UtilPointerEvent.up, onUp);\n\t\t\t\tinteractionManager.off(UtilPointerEvent.upoutside, onUp);\n\t\t\t\tinteractionManager.off(UtilPointerEvent.cancel, onUp);\n\t\t\t\tinteractionManager = null;\n\t\t\t}\n\t\t};\n\n\t\tthis.on(UtilPointerEvent.down, (): void => {\n\t\t\tthis.state.isPressed = true;\n\t\t\tconst layer = DApplications.getLayer(this);\n\t\t\tif (layer) {\n\t\t\t\tinteractionManager = layer.renderer.plugins.interaction;\n\t\t\t\tinteractionManager.on(UtilPointerEvent.up, onUp);\n\t\t\t\tinteractionManager.on(UtilPointerEvent.upoutside, onUp);\n\t\t\t\tinteractionManager.on(UtilPointerEvent.cancel, onUp);\n\t\t\t}\n\t\t});\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DButton\";\n\t}\n\n\tonClick(e?: interaction.InteractionEvent | KeyboardEvent | MouseEvent | TouchEvent): void {\n\t\tif (this.state.isActionable) {\n\t\t\tif (this.isToggle) {\n\t\t\t\tthis.onToggleStart(e);\n\t\t\t\tthis.onToggleEnd(e);\n\t\t\t} else {\n\t\t\t\tthis.onActivate(e);\n\t\t\t}\n\t\t}\n\t}\n\n\tonDblClick(\n\t\te: MouseEvent | TouchEvent,\n\t\tinteractionManager: interaction.InteractionManager\n\t): boolean {\n\t\tif (this._when === DButtonBaseWhen.DOUBLE_CLICKED) {\n\t\t\tthis.onClick(e);\n\t\t}\n\t\treturn super.onDblClick(e, interactionManager);\n\t}\n\n\tprotected onActivate(\n\t\te?: interaction.InteractionEvent | KeyboardEvent | MouseEvent | TouchEvent\n\t): void {\n\t\tthis.emit(\"active\", this);\n\t}\n\n\tprotected onInactivate(\n\t\te?: interaction.InteractionEvent | KeyboardEvent | MouseEvent | TouchEvent\n\t): void {\n\t\tthis.emit(\"inactive\", this);\n\t}\n\n\ttoggle(): void {\n\t\tif (this.state.isActionable) {\n\t\t\tif (this.isToggle) {\n\t\t\t\tthis.onToggleStart();\n\t\t\t\tthis.onToggleEnd();\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected onToggleStart(\n\t\te?: interaction.InteractionEvent | KeyboardEvent | MouseEvent | TouchEvent\n\t): void {\n\t\tthis.state.isActive = !this.state.isActive;\n\t}\n\n\tprotected onToggleEnd(\n\t\te?: interaction.InteractionEvent | KeyboardEvent | MouseEvent | TouchEvent\n\t): void {\n\t\tif (this.state.isActive) {\n\t\t\tthis.onActivate(e);\n\t\t} else {\n\t\t\tthis.onInactivate(e);\n\t\t}\n\t}\n\n\tprotected onActivateKeyDown(e: KeyboardEvent): void {\n\t\tif (this.state.isActionable) {\n\t\t\tif (this.isToggle) {\n\t\t\t\tthis.onToggleStart(e);\n\t\t\t} else {\n\t\t\t\tthis.state.isPressed = true;\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected onActivateKeyUp(e: KeyboardEvent): void {\n\t\tif (this.state.isActionable) {\n\t\t\tif (this.isToggle) {\n\t\t\t\tthis.onToggleEnd(e);\n\t\t\t} else {\n\t\t\t\tif (this.state.isPressed) {\n\t\t\t\t\tthis.onActivate(e);\n\t\t\t\t}\n\t\t\t\tthis.state.isPressed = false;\n\t\t\t}\n\t\t}\n\t}\n\n\tonKeyDown(e: KeyboardEvent): boolean {\n\t\tif (UtilKeyboardEvent.isActivateKey(e)) {\n\t\t\tthis.onActivateKeyDown(e);\n\t\t}\n\n\t\treturn super.onKeyDown(e);\n\t}\n\n\tonKeyUp(e: KeyboardEvent): boolean {\n\t\tif (UtilKeyboardEvent.isActivateKey(e)) {\n\t\t\tthis.onActivateKeyUp(e);\n\t\t}\n\n\t\treturn super.onKeyUp(e);\n\t}\n\n\tdestroy(): void {\n\t\tthis._options?.group?.remove(this);\n\t\tsuper.destroy();\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {\n\tDButtonBase,\n\tDButtonBaseEvents,\n\tDButtonBaseOptions,\n\tDThemeButtonBase\n} from \"./d-button-base\";\nimport { DOnOptions } from \"./d-on-options\";\n\n/**\n * {@link DButton} events.\n */\nexport interface DButtonEvents<VALUE, EMITTER> extends DButtonBaseEvents<VALUE, EMITTER> {}\n\n/**\n * {@link DButton} \"on\" options.\n */\nexport interface DButtonOnOptions<VALUE, EMITTER>\n\textends Partial<DButtonEvents<VALUE, EMITTER>>,\n\t\tDOnOptions {}\n\n/**\n * {@link DButton} options.\n */\nexport interface DButtonOptions<\n\tVALUE = unknown,\n\tTHEME extends DThemeButton<VALUE> = DThemeButton<VALUE>,\n\tEMITTER = any\n> extends DButtonBaseOptions<VALUE, THEME, EMITTER> {\n\ton?: DButtonOnOptions<VALUE, EMITTER>;\n}\n\n/**\n * {@link DButton} theme.\n */\nexport interface DThemeButton<VALUE = unknown> extends DThemeButtonBase<VALUE> {}\n\n/**\n * A button class.\n */\nexport class DButton<\n\tVALUE = unknown,\n\tTHEME extends DThemeButton<VALUE> = DThemeButton<VALUE>,\n\tOPTIONS extends DButtonOptions<VALUE, THEME> = DButtonOptions<VALUE, THEME>\n> extends DButtonBase<VALUE, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DButton\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DButton, DButtonOptions, DThemeButton } from \"./d-button\";\n\nexport interface DButtonPrimaryOptions<\n\tVALUE = unknown,\n\tTHEME extends DThemeButtonPrimary<VALUE> = DThemeButtonPrimary<VALUE>\n> extends DButtonOptions<VALUE, THEME> {}\n\nexport interface DThemeButtonPrimary<VALUE = unknown> extends DThemeButton<VALUE> {}\n\nexport class DButtonPrimary<\n\tVALUE = unknown,\n\tTHEME extends DThemeButtonPrimary<VALUE> = DThemeButtonPrimary<VALUE>,\n\tOPTIONS extends DButtonPrimaryOptions<VALUE, THEME> = DButtonPrimaryOptions<VALUE, THEME>\n> extends DButton<VALUE, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DButtonPrimary\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DAnimationOptions } from \"./d-animation\";\nimport { DAnimationBase } from \"./d-animation-base\";\nimport { DApplicationLayerLike } from \"./d-application-layer-like\";\nimport { DApplications } from \"./d-applications\";\nimport { DBase } from \"./d-base\";\n\nexport interface DAnimationFadeInShiftOptions {\n\tx?: number | null;\n\ty?: number | null;\n}\n\nexport interface DAnimationFadeInOptions<TARGET> extends DAnimationOptions<TARGET> {\n\tshift?: DAnimationFadeInShiftOptions;\n}\n\nexport class DAnimationFadeIn<TARGET extends DBase = DBase> extends DAnimationBase<TARGET> {\n\tprotected _shiftX: number;\n\tprotected _shiftY: number;\n\n\tprotected _storedX: number = 0;\n\tprotected _storedY: number = 0;\n\tprotected _storedAlpha: number = 0;\n\tprotected _storedTime: number = 0;\n\tprotected _storedTarget: TARGET | null = null;\n\n\tprotected _layer: DApplicationLayerLike | null = null;\n\n\tprotected _onPrerenderBound: () => void;\n\tprotected _onPostrenderBound: () => void;\n\n\tconstructor(options?: DAnimationFadeInOptions<TARGET>) {\n\t\tsuper(options);\n\n\t\t// Shifts\n\t\tconst shift = options?.shift;\n\t\tthis._shiftX = shift?.x ?? 0;\n\t\tthis._shiftY = shift?.y ?? 15;\n\n\t\tthis._onPrerenderBound = () => {\n\t\t\tthis.onPrerender();\n\t\t};\n\n\t\tthis._onPostrenderBound = () => {\n\t\t\tthis.onPostrender();\n\t\t};\n\t}\n\n\tstop(): void {\n\t\tthis._storedTime = 0;\n\t\tthis.removeEventListeners();\n\t\tsuper.stop();\n\t}\n\n\tprotected addEventListeners(target: TARGET): void {\n\t\tconst layer = DApplications.getLayer(target);\n\t\tif (layer) {\n\t\t\tthis._layer = layer;\n\t\t\tconst renderer = layer.renderer;\n\t\t\trenderer.on(\"prerender\", this._onPrerenderBound);\n\t\t\trenderer.on(\"postrender\", this._onPostrenderBound);\n\t\t}\n\t}\n\n\tprotected removeEventListeners(): void {\n\t\tconst layer = this._layer;\n\t\tif (layer) {\n\t\t\tthis._layer = null;\n\t\t\tconst renderer = layer.renderer;\n\t\t\trenderer.off(\"prerender\", this._onPrerenderBound);\n\t\t\trenderer.off(\"postrender\", this._onPostrenderBound);\n\t\t}\n\t}\n\n\tprotected onStart(isReverse: boolean): void {\n\t\tconst target = (this._storedTarget = this._target);\n\t\tif (target != null) {\n\t\t\tthis._storedTime = 0;\n\t\t\tthis.removeEventListeners();\n\t\t\tthis.addEventListeners(target);\n\t\t\tif (!isReverse) {\n\t\t\t\ttarget.visible = true;\n\t\t\t}\n\t\t\tsuper.onStart(isReverse);\n\t\t}\n\t}\n\n\tprotected onTime(time: number, isReverse: boolean, elapsedTime: number): void {\n\t\tconst target = this._storedTarget;\n\t\tif (target != null) {\n\t\t\tconst layer = this._layer;\n\t\t\tif (layer) {\n\t\t\t\tthis._storedTime = time;\n\t\t\t\tsuper.onTime(time, isReverse, elapsedTime);\n\t\t\t\tlayer.update();\n\t\t\t} else {\n\t\t\t\tthis._storedTime = time;\n\t\t\t\tsuper.onTime(time, isReverse, elapsedTime);\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected onEnd(isReverse: boolean): void {\n\t\tconst target = this._storedTarget;\n\t\tif (target != null) {\n\t\t\tthis.removeEventListeners();\n\t\t\tif (isReverse) {\n\t\t\t\ttarget.visible = false;\n\t\t\t}\n\t\t\tsuper.onEnd(isReverse);\n\t\t}\n\t}\n\n\tprotected onPrerender(): void {\n\t\tconst target = this._storedTarget;\n\t\tif (target != null) {\n\t\t\tconst storedTime = this._storedTime;\n\n\t\t\t// Position\n\t\t\tconst position = target.unsafe.position;\n\t\t\tthis._storedX = position.x;\n\t\t\tthis._storedY = position.y;\n\t\t\tposition.set(\n\t\t\t\tposition.x - this._shiftX * (1 - storedTime),\n\t\t\t\tposition.y - this._shiftY * (1 - storedTime)\n\t\t\t);\n\n\t\t\t// Alpha\n\t\t\tthis._storedAlpha = target.alpha;\n\t\t\ttarget.alpha = storedTime;\n\t\t}\n\t}\n\n\tprotected onPostrender(): void {\n\t\tconst target = this._storedTarget;\n\t\tif (target != null) {\n\t\t\t// Position\n\t\t\tconst position = target.unsafe.position;\n\t\t\tposition.set(this._storedX, this._storedY);\n\n\t\t\t// Alpha\n\t\t\ttarget.alpha = this._storedAlpha;\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { IPoint, Rectangle } from \"pixi.js\";\n\nexport interface UtilAttachTarget {\n\treadonly width: number;\n\treadonly height: number;\n\treadonly position: IPoint;\n}\n\nexport const UtilAttachAlign = {\n\tTOP: 0,\n\tTOP_LEFT: 1,\n\tTOP_CENTER: 2,\n\tTOP_RIGHT: 3,\n\n\tLEFT: 4,\n\tLEFT_TOP: 5,\n\tLEFT_MIDDLE: 6,\n\tLEFT_BOTTOM: 7,\n\n\tRIGHT: 8,\n\tRIGHT_TOP: 9,\n\tRIGHT_MIDDLE: 10,\n\tRIGHT_BOTTOM: 11,\n\n\tBOTTOM: 12,\n\tBOTTOM_LEFT: 13,\n\tBOTTOM_CENTER: 14,\n\tBOTTOM_RIGHT: 15,\n\n\tOVER: 16\n} as const;\n\nexport type UtilAttachAlign = typeof UtilAttachAlign[keyof typeof UtilAttachAlign];\n\nexport class UtilAttach {\n\tstatic attach(\n\t\ttarget: UtilAttachTarget,\n\t\tbounds: Rectangle,\n\t\toffsetX: number,\n\t\toffsetY: number,\n\t\tclippingWidth: number,\n\t\tclippingHeight: number,\n\t\talign: UtilAttachAlign\n\t): void {\n\t\tconst width = target.width;\n\t\tconst height = target.height;\n\n\t\tlet x = 0;\n\t\tswitch (align) {\n\t\t\tcase UtilAttachAlign.LEFT:\n\t\t\tcase UtilAttachAlign.LEFT_TOP:\n\t\t\tcase UtilAttachAlign.LEFT_MIDDLE:\n\t\t\tcase UtilAttachAlign.LEFT_BOTTOM:\n\t\t\t\tx = bounds.left - width - offsetX;\n\t\t\t\tif (x < offsetX) {\n\t\t\t\t\tx = bounds.right + offsetX;\n\t\t\t\t\tif (clippingWidth - offsetX < x + width) {\n\t\t\t\t\t\tx = offsetX;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase UtilAttachAlign.RIGHT:\n\t\t\tcase UtilAttachAlign.RIGHT_TOP:\n\t\t\tcase UtilAttachAlign.RIGHT_MIDDLE:\n\t\t\tcase UtilAttachAlign.RIGHT_BOTTOM:\n\t\t\t\tx = bounds.right + offsetX;\n\t\t\t\tif (clippingWidth - offsetX < x + width) {\n\t\t\t\t\tx = bounds.left - width - offsetX;\n\t\t\t\t\tif (x < offsetX) {\n\t\t\t\t\t\tx = clippingWidth - width - offsetX;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase UtilAttachAlign.TOP:\n\t\t\tcase UtilAttachAlign.TOP_LEFT:\n\t\t\tcase UtilAttachAlign.BOTTOM:\n\t\t\tcase UtilAttachAlign.BOTTOM_LEFT:\n\t\t\t\tx = this.adjust(bounds.left, width, offsetX, clippingWidth);\n\t\t\t\tbreak;\n\t\t\tcase UtilAttachAlign.TOP_RIGHT:\n\t\t\tcase UtilAttachAlign.BOTTOM_RIGHT:\n\t\t\t\tx = this.adjust(bounds.right - width, width, offsetX, clippingWidth);\n\t\t\t\tbreak;\n\t\t\tcase UtilAttachAlign.TOP_CENTER:\n\t\t\tcase UtilAttachAlign.BOTTOM_CENTER:\n\t\t\tcase UtilAttachAlign.OVER:\n\t\t\t\tx = this.adjust(\n\t\t\t\t\t(bounds.left + bounds.right - width) * 0.5,\n\t\t\t\t\twidth,\n\t\t\t\t\toffsetX,\n\t\t\t\t\tclippingWidth\n\t\t\t\t);\n\t\t\t\tbreak;\n\t\t}\n\n\t\tlet y = 0;\n\t\tswitch (align) {\n\t\t\tcase UtilAttachAlign.LEFT:\n\t\t\tcase UtilAttachAlign.LEFT_TOP:\n\t\t\tcase UtilAttachAlign.RIGHT:\n\t\t\tcase UtilAttachAlign.RIGHT_TOP:\n\t\t\t\ty = this.adjust(bounds.top, height, offsetY, clippingHeight);\n\t\t\t\tbreak;\n\t\t\tcase UtilAttachAlign.LEFT_MIDDLE:\n\t\t\tcase UtilAttachAlign.RIGHT_MIDDLE:\n\t\t\tcase UtilAttachAlign.OVER:\n\t\t\t\ty = this.adjust(\n\t\t\t\t\t(bounds.top + bounds.bottom - height) * 0.5,\n\t\t\t\t\theight,\n\t\t\t\t\toffsetY,\n\t\t\t\t\tclippingHeight\n\t\t\t\t);\n\t\t\t\tbreak;\n\t\t\tcase UtilAttachAlign.LEFT_BOTTOM:\n\t\t\tcase UtilAttachAlign.RIGHT_BOTTOM:\n\t\t\t\ty = this.adjust(bounds.bottom, height, offsetY, clippingHeight);\n\t\t\t\tbreak;\n\t\t\tcase UtilAttachAlign.TOP:\n\t\t\tcase UtilAttachAlign.TOP_LEFT:\n\t\t\tcase UtilAttachAlign.TOP_RIGHT:\n\t\t\tcase UtilAttachAlign.TOP_CENTER:\n\t\t\t\ty = bounds.top - height - offsetY;\n\t\t\t\tif (y < offsetY) {\n\t\t\t\t\ty = bounds.bottom + offsetY;\n\t\t\t\t\tif (clippingHeight < y + height) {\n\t\t\t\t\t\ty = offsetY;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase UtilAttachAlign.BOTTOM:\n\t\t\tcase UtilAttachAlign.BOTTOM_LEFT:\n\t\t\tcase UtilAttachAlign.BOTTOM_RIGHT:\n\t\t\tcase UtilAttachAlign.BOTTOM_CENTER:\n\t\t\t\ty = bounds.bottom + offsetY;\n\t\t\t\tif (clippingHeight - offsetY < y + height) {\n\t\t\t\t\ty = bounds.top - height - offsetY;\n\t\t\t\t\tif (y < offsetY) {\n\t\t\t\t\t\ty = clippingHeight - height - offsetY;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\n\t\ttarget.position.set(x, y);\n\t}\n\n\tstatic adjust(position: number, size: number, offset: number, clippingSize: number): number {\n\t\tif (position < offset) {\n\t\t\tif (clippingSize - offset < position + size) {\n\t\t\t\treturn (clippingSize - size) * 0.5;\n\t\t\t} else {\n\t\t\t\treturn offset;\n\t\t\t}\n\t\t} else if (clippingSize - offset < position + size) {\n\t\t\tif (clippingSize < size) {\n\t\t\t\treturn (clippingSize - size) * 0.5;\n\t\t\t} else {\n\t\t\t\treturn clippingSize - size - offset;\n\t\t\t}\n\t\t}\n\t\treturn position;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const DDialogCloseOn = {\n\tNONE: 0,\n\tESC: 1,\n\tCLICK_OUTSIDE: 2\n} as const;\n\nexport type DDialogCloseOn = number;\n","/*\n * Copyright (C) 2021 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * {@link DDialog} mode options.\n */\nexport const DDialogMode = {\n\tMODAL: 0,\n\tMODELESS: 1,\n\tMENU: 2\n} as const;\n\nexport type DDialogMode = typeof DDialogMode[keyof typeof DDialogMode];\n","/*\n * Copyright (C) 2021 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const DDialogState = {\n\tMODAL: \"MODAL\",\n\tMODELESS: \"MODELESS\",\n\tMENU: \"MENU\"\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction, Point } from \"pixi.js\";\nimport InteractionEvent = interaction.InteractionEvent;\nimport { DBase } from \"../d-base\";\nimport { UtilPointerEvent } from \"./util-pointer-event\";\n\nexport type UtilClickOutsideOnClick = (e: InteractionEvent) => void;\n\nexport class UtilClickOutside {\n\tprotected static point = new Point();\n\n\tstatic apply(target: DBase, onClick: UtilClickOutsideOnClick): void {\n\t\ttarget.on(UtilPointerEvent.down, (e: InteractionEvent): void => {\n\t\t\tif (e.target === target) {\n\t\t\t\tconst point = this.point;\n\t\t\t\tpoint.copyFrom(e.data.global);\n\t\t\t\ttarget.toLocal(point, undefined, point, true);\n\t\t\t\tconst x = point.x;\n\t\t\t\tconst y = point.y;\n\t\t\t\tif (x < 0 || y < 0 || target.width < x || target.height < y) {\n\t\t\t\t\t// If dialogs / menus are being rendered on the overlay layer, closing them before\n\t\t\t\t\t// the default pointerdown event handler causes the base layer to lose its focus.\n\t\t\t\t\t// Therefore, onClick needed to be delayed.\n\t\t\t\t\tsetTimeout((): void => {\n\t\t\t\t\t\tonClick(e);\n\t\t\t\t\t}, 0);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n}\n","import { DApplicationLayerLike } from \"../d-application-layer-like\";\nimport { DApplicationLike, DApplicationTarget } from \"../d-application-like\";\nimport { DApplications } from \"../d-applications\";\n\nexport class UtilOverlay {\n\tprotected _layer: DApplicationLayerLike | null;\n\tprotected _application: DApplicationLike | null;\n\n\tconstructor(options?: { parent?: unknown }) {\n\t\tthis._layer = null;\n\t\tthis._application = options?.parent == null ? DApplications.last() : null;\n\t}\n\n\tget picked(): DApplicationLayerLike | null {\n\t\treturn this._layer;\n\t}\n\n\tpick(target: DApplicationTarget): DApplicationLayerLike {\n\t\tlet layer = this._layer;\n\t\tif (layer == null) {\n\t\t\tlayer = DApplications.getLayerOverlay(target);\n\t\t\tif (!layer) {\n\t\t\t\tconst application = this._application;\n\t\t\t\tif (application) {\n\t\t\t\t\tlayer = application.getLayerOverlay();\n\t\t\t\t} else {\n\t\t\t\t\tlayer = DApplications.last().getLayerOverlay();\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._layer = layer;\n\t\t}\n\t\treturn layer;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Point } from \"pixi.js\";\nimport { DAnimation } from \"./d-animation\";\nimport { DAnimationFadeIn } from \"./d-animation-fade-in\";\nimport { DApplications } from \"./d-applications\";\nimport { DBase, DBaseEvents, DBaseOptions, DThemeBase } from \"./d-base\";\nimport { DFocusable } from \"./d-controller-focus\";\nimport { DDialogAlign } from \"./d-dialog-align\";\nimport { DDialogCloseOn } from \"./d-dialog-close-on\";\nimport { DDialogMode } from \"./d-dialog-mode\";\nimport { DDialogState } from \"./d-dialog-state\";\nimport { DOnOptions } from \"./d-on-options\";\nimport { toEnum } from \"./util/to-enum\";\nimport { UtilAttach } from \"./util/util-attach\";\nimport { UtilClickOutside } from \"./util/util-click-outside\";\nimport { UtilKeyboardEvent } from \"./util/util-keyboard-event\";\nimport { UtilOverlay } from \"./util/util-overlay\";\n\n/**\n * {@link DDialog} events.\n */\nexport interface DDialogEvents<EMITTER> extends DBaseEvents<EMITTER> {\n\t/**\n\t * Triggered when a dialog is opened.\n\t *\n\t * @param emitter this\n\t */\n\topen(emitter: EMITTER): void;\n\n\t/**\n\t * Triggered when a dialog is closed.\n\t *\n\t * @param emitter this\n\t */\n\tclose(emitter: EMITTER): void;\n}\n\n/**\n * {@link DDialog} `on` options.\n */\nexport interface DDialogOnOptions<EMITTER> extends Partial<DDialogEvents<EMITTER>>, DOnOptions {}\n\n/**\n * {@link DDialog} options.\n */\nexport interface DDialogOptions<THEME extends DThemeDialog = DThemeDialog, EMITTER = any>\n\textends DBaseOptions<THEME> {\n\tcloseOn?: DDialogCloseOn;\n\tanimation?: DAnimation<DBase>;\n\n\t/**\n\t * A dialog mode.\n\t */\n\tmode?: DDialogMode | keyof typeof DDialogMode;\n\n\tsticky?: boolean;\n\n\talign?: DDialogAlign;\n\n\t/**\n\t * Mappings of event names and handlers.\n\t */\n\ton?: DDialogOnOptions<EMITTER>;\n}\n\n/**\n * {@link DDialog} theme.\n */\nexport interface DThemeDialog extends DThemeBase {\n\tgetMode(): DDialogMode;\n\tcloseOn(): DDialogCloseOn;\n\tisSticky(): boolean;\n\tgetOffsetX(): number;\n\tgetOffsetY(): number;\n}\n\n/**\n * A dialog class.\n *\n * If multiple application instances are there, better to set the constructor\n * option `parent` to an `application.stage` so that the dialog picks a right\n * application. By default, the dialog assumes the last created application is\n * the one it belongs to at the time when it is created.\n */\nexport class DDialog<\n\tVALUE = void,\n\tTHEME extends DThemeDialog = DThemeDialog,\n\tOPTIONS extends DDialogOptions<THEME> = DDialogOptions<THEME>\n> extends DBase<THEME, OPTIONS> {\n\tprotected _promise?: Promise<VALUE>;\n\tprotected _resolve?: (value: VALUE | PromiseLike<VALUE>) => void;\n\tprotected _reject?: (reason?: any) => void;\n\n\tprotected _animation?: DAnimation<DBase> | null;\n\tprotected _closeOn!: DDialogCloseOn;\n\tprotected _focused?: DFocusable | null;\n\tprotected _overlay!: UtilOverlay;\n\tprotected _mode!: DDialogMode;\n\tprotected _sticky!: boolean;\n\tprotected _onPrerenderBound!: () => void;\n\tprotected _align!: DDialogAlign;\n\tprotected _owner?: DBase<any, any> | null;\n\n\tprotected init(options?: OPTIONS): void {\n\t\tsuper.init(options);\n\n\t\tthis._onPrerenderBound = (): void => {\n\t\t\tthis.onPrerender();\n\t\t};\n\n\t\t// Modeless\n\t\tconst theme = this.theme;\n\t\tconst mode = toEnum(options?.mode ?? theme.getMode(), DDialogMode);\n\t\tthis._mode = mode;\n\n\t\t// Sticky\n\t\tthis._sticky = options?.sticky ?? theme.isSticky();\n\n\t\t// Close On\n\t\tconst closeOn = options?.closeOn ?? theme.closeOn();\n\t\tthis._closeOn = closeOn;\n\n\t\t// Align\n\t\tthis._align = toEnum(options?.align ?? DDialogAlign.BOTTOM, DDialogAlign);\n\n\t\t// Overlay\n\t\tthis._overlay = new UtilOverlay();\n\n\t\t// Others\n\t\tswitch (mode) {\n\t\t\tcase DDialogMode.MODAL:\n\t\t\tcase DDialogMode.MENU:\n\t\t\t\tthis.visible = false;\n\t\t\t\tconst state = this.state;\n\t\t\t\tstate.lock();\n\t\t\t\tstate.isFocusRoot = true;\n\t\t\t\tstate.add(mode === DDialogMode.MODAL ? DDialogState.MODAL : DDialogState.MENU);\n\t\t\t\tstate.unlock();\n\t\t\t\tif (closeOn & DDialogCloseOn.CLICK_OUTSIDE) {\n\t\t\t\t\tUtilClickOutside.apply(this, (): void => {\n\t\t\t\t\t\tthis.onCloseOn();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase DDialogMode.MODELESS:\n\t\t\t\tthis.state.add(DDialogState.MODELESS);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tprotected getAnimation(): DAnimation | null {\n\t\tlet result = this._animation;\n\t\tif (result === undefined) {\n\t\t\tswitch (this._mode) {\n\t\t\t\tcase DDialogMode.MODAL:\n\t\t\t\t\tresult = this._options?.animation ?? new DAnimationFadeIn();\n\t\t\t\t\tbreak;\n\t\t\t\tcase DDialogMode.MODELESS:\n\t\t\t\t\tresult = null;\n\t\t\t\t\tbreak;\n\t\t\t\tcase DDialogMode.MENU:\n\t\t\t\t\tresult = this._options?.animation ?? null;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (result) {\n\t\t\t\tresult.target = this;\n\t\t\t\tresult.on(\"end\", (isReverse: boolean): void => {\n\t\t\t\t\tthis.onAnimationEnd(isReverse);\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis._animation = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected onAnimationEnd(isReverse: boolean): void {\n\t\tif (isReverse) {\n\t\t\tconst parent = this.parent;\n\t\t\tif (parent) {\n\t\t\t\tparent.removeChild(this);\n\t\t\t}\n\t\t} else {\n\t\t\tconst layer = DApplications.getLayer(this);\n\t\t\tif (layer) {\n\t\t\t\tconst focusController = layer.getFocusController();\n\t\t\t\tthis._focused = focusController.get();\n\t\t\t\tconst firstFocusable = focusController.find(this, false, true, true);\n\t\t\t\tfocusController.focus(firstFocusable || this);\n\t\t\t}\n\t\t}\n\t}\n\n\topen(owner?: DBase<any, any>): Promise<VALUE> {\n\t\tlet result = this._promise;\n\t\tif (result == null) {\n\t\t\tresult = new Promise<VALUE>((resolve, reject): void => {\n\t\t\t\tthis._resolve = resolve;\n\t\t\t\tthis._reject = reject;\n\t\t\t});\n\t\t\tthis._promise = result;\n\n\t\t\tthis._owner = owner;\n\n\t\t\tswitch (this._mode) {\n\t\t\t\tcase DDialogMode.MODAL:\n\t\t\t\t\t{\n\t\t\t\t\t\tconst layer = this._overlay.pick(this);\n\t\t\t\t\t\tlayer.stage.addChild(this);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase DDialogMode.MODELESS:\n\t\t\t\t\tbreak;\n\t\t\t\tcase DDialogMode.MENU:\n\t\t\t\t\t{\n\t\t\t\t\t\tconst layer = this._overlay.pick(this);\n\t\t\t\t\t\tlayer.stage.addChild(this);\n\n\t\t\t\t\t\t// Position & size\n\t\t\t\t\t\tconst renderer = layer.renderer;\n\t\t\t\t\t\tconst onPrerenderBound = this._onPrerenderBound;\n\t\t\t\t\t\tif (this._sticky) {\n\t\t\t\t\t\t\trenderer.on(\"prerender\", onPrerenderBound);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trenderer.once(\"prerender\", onPrerenderBound);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tthis.onOpen();\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected onPrerender(): void {\n\t\tconst owner = this._owner;\n\t\tif (owner) {\n\t\t\tconst bounds = owner.getBounds();\n\t\t\tif (bounds) {\n\t\t\t\tconst layer = this._overlay.picked;\n\t\t\t\tif (layer) {\n\t\t\t\t\tconst theme = this.theme;\n\t\t\t\t\tUtilAttach.attach(\n\t\t\t\t\t\tthis,\n\t\t\t\t\t\tbounds,\n\t\t\t\t\t\ttheme.getOffsetX(),\n\t\t\t\t\t\ttheme.getOffsetY(),\n\t\t\t\t\t\tlayer.width,\n\t\t\t\t\t\tlayer.height,\n\t\t\t\t\t\tthis._align\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected onOpen(): void {\n\t\tthis.emit(\"open\", this);\n\n\t\t// Animation\n\t\tconst animation = this.getAnimation();\n\t\tif (animation) {\n\t\t\tanimation.start();\n\t\t} else if (this._mode === DDialogMode.MENU) {\n\t\t\tthis.visible = true;\n\t\t\tthis.onAnimationEnd(false);\n\t\t}\n\t}\n\n\tisOpened(): boolean {\n\t\treturn this._promise != null;\n\t}\n\n\tclose(): void {\n\t\tthis.doReject();\n\t}\n\n\tprotected doResolve(value: VALUE | PromiseLike<VALUE>): void {\n\t\tconst resolve = this._resolve;\n\t\tif (resolve) {\n\t\t\tthis._promise = undefined;\n\t\t\tthis._resolve = undefined;\n\t\t\tthis._reject = undefined;\n\n\t\t\tthis.onClose();\n\n\t\t\tresolve(value);\n\t\t}\n\t}\n\n\tprotected doReject(reason?: any): void {\n\t\tconst reject = this._reject;\n\t\tif (reject) {\n\t\t\tthis._promise = undefined;\n\t\t\tthis._resolve = undefined;\n\t\t\tthis._reject = undefined;\n\n\t\t\tthis.onClose();\n\n\t\t\treject(reason);\n\t\t}\n\t}\n\n\tprotected onClose(): void {\n\t\t// Focus\n\t\tconst layer = this._overlay.picked;\n\t\tconst focused = this._focused;\n\t\tif (focused != null) {\n\t\t\tthis._focused = null;\n\t\t\tif (layer) {\n\t\t\t\tconst focusedLayer = DApplications.getLayer(focused);\n\t\t\t\tif (focusedLayer != null && layer !== focusedLayer) {\n\t\t\t\t\tfocusedLayer.view.focus();\n\t\t\t\t}\n\t\t\t\tlayer.getFocusController().focus(focused);\n\t\t\t} else {\n\t\t\t\tthis.blur(true);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.blur(true);\n\t\t}\n\n\t\t// Remove the prerender event handler\n\t\tswitch (this._mode) {\n\t\t\tcase DDialogMode.MODAL:\n\t\t\t\tbreak;\n\t\t\tcase DDialogMode.MODELESS:\n\t\t\t\tbreak;\n\t\t\tcase DDialogMode.MENU:\n\t\t\t\tif (layer) {\n\t\t\t\t\tlayer.renderer.off(\"prerender\", this._onPrerenderBound);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\n\t\t// Forget the owner\n\t\tthis._owner = null;\n\n\t\t// Animation\n\t\tconst animation = this.getAnimation();\n\t\tif (animation) {\n\t\t\tanimation.start(true);\n\t\t} else if (this._mode === DDialogMode.MENU) {\n\t\t\tthis.visible = false;\n\t\t\tthis.onAnimationEnd(true);\n\t\t}\n\n\t\tthis.emit(\"close\", this);\n\t}\n\n\tonKeyDown(e: KeyboardEvent): boolean {\n\t\tswitch (this._mode) {\n\t\t\tcase DDialogMode.MODAL:\n\t\t\tcase DDialogMode.MENU:\n\t\t\t\tif (this._closeOn & DDialogCloseOn.ESC) {\n\t\t\t\t\tif (UtilKeyboardEvent.isCancelKey(e)) {\n\t\t\t\t\t\tthis.onCloseOn();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase DDialogMode.MODELESS:\n\t\t\t\tbreak;\n\t\t}\n\t\treturn super.onKeyDown(e);\n\t}\n\n\tprotected onCloseOn(): void {\n\t\tthis.close();\n\t}\n\n\tprotected containsGlobalPoint(point: Point): boolean {\n\t\tswitch (this._mode) {\n\t\t\tcase DDialogMode.MODAL:\n\t\t\tcase DDialogMode.MENU:\n\t\t\t\treturn true;\n\t\t\tcase DDialogMode.MODELESS:\n\t\t\t\treturn super.containsGlobalPoint(point);\n\t\t}\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DDialog\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const DLayoutDirection = {\n\tVERTICAL: 0,\n\tHORIZONTAL: 1\n} as const;\n\nexport type DLayoutDirection = typeof DLayoutDirection[keyof typeof DLayoutDirection];\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBase, DBaseOptions, DThemeBase } from \"./d-base\";\n\nexport interface DLayoutSpaceOptions<THEME extends DThemeLayoutSpace = DThemeLayoutSpace>\n\textends DBaseOptions<THEME> {}\n\nexport interface DThemeLayoutSpace extends DThemeBase {}\n\nexport class DLayoutSpace<\n\tTHEME extends DThemeLayoutSpace = DThemeLayoutSpace,\n\tOPTIONS extends DLayoutSpaceOptions<THEME> = DLayoutSpaceOptions<THEME>\n> extends DBase<THEME, OPTIONS> {\n\tconstructor(options?: OPTIONS) {\n\t\tsuper(options);\n\t\tthis.visible = false;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DLayoutSpace\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DisplayObject } from \"pixi.js\";\nimport { DBase, DBaseCornerOptions, DBaseOptions, DThemeBase } from \"./d-base\";\nimport { DCornerMask } from \"./d-corner-mask\";\nimport { DLayoutClearType } from \"./d-layout-clear-type\";\nimport { DLayoutDirection } from \"./d-layout-direction\";\nimport { DLayoutSpace, DLayoutSpaceOptions } from \"./d-layout-space\";\nimport { isNumber } from \"./util/is-number\";\nimport { isString } from \"./util/is-string\";\n\nexport interface DLayoutMargin {\n\thorizontal: number;\n\tvertical: number;\n}\n\nexport interface DLayoutMarginOptions {\n\thorizontal?: number;\n\tvertical?: number;\n}\n\nexport interface DLayoutCornerOptions extends DBaseCornerOptions {\n\tadjust?: boolean;\n}\n\nexport interface DLayoutOptions<THEME extends DThemeLayout = DThemeLayout>\n\textends DBaseOptions<THEME> {\n\tmargin?: number | DLayoutMarginOptions;\n\tcorner?: number | DLayoutCornerOptions;\n\trow?: number;\n\tcolumn?: number;\n\tdirection?: keyof typeof DLayoutDirection | DLayoutDirection;\n\treverse?: boolean;\n}\n\nexport interface DThemeLayout extends DThemeBase {\n\tgetMargin(): number;\n\tgetDirection(): DLayoutDirection;\n\tgetCornerAdjust(): boolean;\n\tgetMultiplicity(): number;\n\tgetReverse(): boolean;\n}\n\nconst isVisible = (child: DisplayObject): child is DBase => {\n\treturn child instanceof DBase && (child.visible || child instanceof DLayoutSpace);\n};\n\nconst toMultiplicity = (theme: DThemeLayout, options?: DLayoutOptions<DThemeLayout>): number => {\n\tif (options) {\n\t\tconst row = options.row;\n\t\tif (row != null) {\n\t\t\treturn row;\n\t\t}\n\t\tconst column = options.column;\n\t\tif (column != null) {\n\t\t\treturn column;\n\t\t}\n\t}\n\treturn theme.getMultiplicity();\n};\n\nconst toMargin = (theme: DThemeLayout, options?: DLayoutOptions<DThemeLayout>): DLayoutMargin => {\n\tconst margin = options?.margin;\n\tif (margin != null) {\n\t\tif (isNumber(margin)) {\n\t\t\treturn {\n\t\t\t\thorizontal: margin,\n\t\t\t\tvertical: margin\n\t\t\t};\n\t\t} else {\n\t\t\tconst themeMargin = theme.getMargin();\n\t\t\treturn {\n\t\t\t\thorizontal: margin.horizontal ?? themeMargin,\n\t\t\t\tvertical: margin.vertical ?? themeMargin\n\t\t\t};\n\t\t}\n\t} else {\n\t\tconst themeMargin = theme.getMargin();\n\t\treturn {\n\t\t\thorizontal: themeMargin,\n\t\t\tvertical: themeMargin\n\t\t};\n\t}\n};\n\nconst toDirection = (\n\ttheme: DThemeLayout,\n\toptions?: DLayoutOptions<DThemeLayout>\n): DLayoutDirection => {\n\tconst direction = options?.direction;\n\tif (direction != null) {\n\t\tif (isString(direction)) {\n\t\t\treturn DLayoutDirection[direction];\n\t\t} else {\n\t\t\treturn direction;\n\t\t}\n\t}\n\treturn theme.getDirection();\n};\n\nconst toCornerAdjust = (theme: DThemeLayout, options?: DLayoutOptions<DThemeLayout>): boolean => {\n\tconst corner = options?.corner;\n\tif (corner != null && !isNumber(corner)) {\n\t\tconst adjust = corner.adjust;\n\t\tif (adjust != null) {\n\t\t\treturn adjust;\n\t\t}\n\t}\n\treturn theme.getCornerAdjust();\n};\n\nconst toReverse = (theme: DThemeLayout, options?: DLayoutOptions<DThemeLayout>): boolean => {\n\treturn options?.reverse ?? theme.getReverse();\n};\n\nexport abstract class DLayout<\n\tTHEME extends DThemeLayout,\n\tOPTIONS extends DLayoutOptions<THEME>\n> extends DBase<THEME, OPTIONS> {\n\tstatic CORNER_ADJUST_WORK: Float32Array | null = null;\n\n\tprotected _margin!: DLayoutMargin;\n\tprotected _cornerAdjust!: boolean;\n\tprotected _multiplicity!: number;\n\tprotected _direction!: DLayoutDirection;\n\tprotected _reverse!: boolean;\n\n\tprotected init(options?: OPTIONS): void {\n\t\tsuper.init(options);\n\n\t\tconst theme = this.theme;\n\t\tthis._margin = toMargin(theme, options);\n\t\tthis._direction = toDirection(theme, options);\n\t\tthis._cornerAdjust = toCornerAdjust(theme, options);\n\t\tthis._multiplicity = toMultiplicity(theme, options);\n\t\tthis._reverse = toReverse(theme, options);\n\t}\n\n\tget margin(): DLayoutMargin {\n\t\treturn this._margin;\n\t}\n\n\tget multiplicity(): number {\n\t\treturn this._multiplicity;\n\t}\n\n\tprotected getWeightTotal(): number {\n\t\tconst children = this.children;\n\t\tlet result = 0;\n\t\tconst multiplicity = this._multiplicity;\n\t\tconst reverse = this._reverse;\n\t\tfor (let i = 0, imax = children.length; i < imax; ) {\n\t\t\tlet weight = -1;\n\t\t\tlet j = 0;\n\t\t\tfor (; j < multiplicity && i + j < imax; ++j) {\n\t\t\t\tconst child = children[reverse ? imax - 1 - (i + j) : i + j];\n\t\t\t\tif (isVisible(child)) {\n\t\t\t\t\tconst clearType = child.getClearType();\n\t\t\t\t\tif (j !== 0 && clearType & DLayoutClearType.BEFORE) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tweight = Math.max(weight, child.weight);\n\t\t\t\t\t\tif (clearType && DLayoutClearType.AFTER) {\n\t\t\t\t\t\t\tj += 1;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\ti += 1;\n\t\t\t\t\tj -= 1;\n\t\t\t\t}\n\t\t\t}\n\t\t\ti += j;\n\t\t\tif (0 <= weight) {\n\t\t\t\tresult += weight;\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected getSpaceLeft(baseSize: number, margin: number): number {\n\t\tconst children = this.children;\n\t\tconst multiplicity = this._multiplicity;\n\t\tconst reverse = this._reverse;\n\t\tif (this._direction === DLayoutDirection.VERTICAL) {\n\t\t\tlet result = baseSize;\n\t\t\tlet marginNext = 0;\n\t\t\tfor (let i = 0, imax = children.length; i < imax; ) {\n\t\t\t\tlet height = 0;\n\t\t\t\tlet weight = -1;\n\t\t\t\tlet j = 0;\n\t\t\t\tfor (; j < multiplicity && i + j < imax; ++j) {\n\t\t\t\t\tconst child = children[reverse ? imax - 1 - (i + j) : i + j];\n\t\t\t\t\tif (isVisible(child)) {\n\t\t\t\t\t\tconst clearType = child.getClearType();\n\t\t\t\t\t\tif (j !== 0 && clearType & DLayoutClearType.BEFORE) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tweight = Math.max(weight, child.weight);\n\t\t\t\t\t\t\tif (weight < 0) {\n\t\t\t\t\t\t\t\theight = Math.max(height, child.height + marginNext);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\theight = marginNext;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (clearType & DLayoutClearType.AFTER) {\n\t\t\t\t\t\t\t\tj += 1;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\ti += 1;\n\t\t\t\t\t\tj -= 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\ti += j;\n\t\t\t\tresult -= height;\n\t\t\t\tmarginNext = margin;\n\t\t\t}\n\t\t\treturn Math.max(0, result);\n\t\t} else {\n\t\t\tlet result = baseSize;\n\t\t\tlet marginNext = 0;\n\t\t\tfor (let i = 0, imax = children.length; i < imax; ) {\n\t\t\t\tlet width = 0;\n\t\t\t\tlet weight = -1;\n\t\t\t\tlet j = 0;\n\t\t\t\tfor (; j < multiplicity && i + j < imax; ++j) {\n\t\t\t\t\tconst child = children[reverse ? imax - 1 - (i + j) : i + j];\n\t\t\t\t\tif (isVisible(child)) {\n\t\t\t\t\t\tconst clearType = child.getClearType();\n\t\t\t\t\t\tif (j !== 0 && clearType & DLayoutClearType.BEFORE) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tweight = Math.max(weight, child.weight);\n\t\t\t\t\t\t\tif (weight < 0) {\n\t\t\t\t\t\t\t\twidth = Math.max(width, child.width + marginNext);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\twidth = marginNext;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (clearType & DLayoutClearType.AFTER) {\n\t\t\t\t\t\t\t\tj += 1;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\ti += 1;\n\t\t\t\t\t\tj -= 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\ti += j;\n\t\t\t\tresult -= width;\n\t\t\t\tmarginNext = margin;\n\t\t\t}\n\t\t\treturn Math.max(0, result);\n\t\t}\n\t}\n\n\tprotected calcSpaceLeft(isOn: boolean, size: number, padding: number, margin: number): number {\n\t\treturn isOn ? 0 : this.getSpaceLeft(size - padding, margin);\n\t}\n\n\tprotected onRefit(): void {\n\t\tconst children = this.children;\n\t\tconst padding = this._padding;\n\t\tconst paddingTop = padding.getTop();\n\t\tconst paddingBottom = padding.getBottom();\n\t\tconst paddingLeft = padding.getLeft();\n\t\tconst paddingRight = padding.getRight();\n\t\tconst margin = this._margin;\n\t\tconst marginVertical = margin.vertical;\n\t\tconst marginHorizontal = margin.horizontal;\n\t\tconst weightTotal = this.getWeightTotal();\n\t\tconst multiplicity = this._multiplicity;\n\t\tconst reverse = this._reverse;\n\t\tconst auto = this._auto;\n\n\t\tlet cornerAdjustWork = null;\n\t\tif (this._cornerAdjust) {\n\t\t\tconst requiredSize = 4 + (children.length << 1);\n\t\t\tif (\n\t\t\t\tDLayout.CORNER_ADJUST_WORK == null ||\n\t\t\t\tDLayout.CORNER_ADJUST_WORK.length < requiredSize\n\t\t\t) {\n\t\t\t\tDLayout.CORNER_ADJUST_WORK = new Float32Array(requiredSize);\n\t\t\t}\n\t\t\tcornerAdjustWork = DLayout.CORNER_ADJUST_WORK;\n\t\t\tcornerAdjustWork[0] = -2;\n\t\t\tcornerAdjustWork[1] = -2;\n\t\t\tcornerAdjustWork[requiredSize - 2] = -3;\n\t\t\tcornerAdjustWork[requiredSize - 1] = -3;\n\t\t}\n\n\t\tif (this._direction === DLayoutDirection.VERTICAL) {\n\t\t\tlet irow = 0;\n\t\t\tlet y = paddingTop - marginVertical;\n\t\t\tif (0 < weightTotal) {\n\t\t\t\tconst weightTotalInverse = 1 / weightTotal;\n\t\t\t\tconst spaceLeft = this.calcSpaceLeft(\n\t\t\t\t\tauto.height.isOn,\n\t\t\t\t\tthis.height,\n\t\t\t\t\tpaddingTop + paddingBottom,\n\t\t\t\t\tmarginVertical\n\t\t\t\t);\n\t\t\t\tfor (let i = 0, imax = children.length; i < imax; ) {\n\t\t\t\t\tlet x = paddingLeft - marginHorizontal;\n\t\t\t\t\tlet height = 0;\n\t\t\t\t\tlet j = 0;\n\t\t\t\t\tfor (; j < multiplicity && i + j < imax; ++j) {\n\t\t\t\t\t\tconst child = children[reverse ? imax - 1 - (i + j) : i + j];\n\t\t\t\t\t\tif (isVisible(child)) {\n\t\t\t\t\t\t\tconst clearType = child.getClearType();\n\t\t\t\t\t\t\tif (j !== 0 && clearType & DLayoutClearType.BEFORE) {\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tchild.position.set(marginHorizontal + x, marginVertical + y);\n\t\t\t\t\t\t\t\tconst weight = child.weight;\n\t\t\t\t\t\t\t\tif (0 <= weight) {\n\t\t\t\t\t\t\t\t\tchild.height = spaceLeft * (weight * weightTotalInverse);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tx += marginHorizontal + child.width;\n\t\t\t\t\t\t\t\theight = Math.max(height, child.height);\n\t\t\t\t\t\t\t\tif (clearType & DLayoutClearType.AFTER) {\n\t\t\t\t\t\t\t\t\tif (cornerAdjustWork != null) {\n\t\t\t\t\t\t\t\t\t\tconst k = (i + j + 1) << 1;\n\t\t\t\t\t\t\t\t\t\tcornerAdjustWork[k + 0] = j;\n\t\t\t\t\t\t\t\t\t\tcornerAdjustWork[k + 1] = irow;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tj += 1;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tif (cornerAdjustWork != null) {\n\t\t\t\t\t\t\t\t\t\tconst k = (i + j + 1) << 1;\n\t\t\t\t\t\t\t\t\t\tcornerAdjustWork[k + 0] = j;\n\t\t\t\t\t\t\t\t\t\tcornerAdjustWork[k + 1] = irow;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (cornerAdjustWork != null) {\n\t\t\t\t\t\t\t\tconst k = (i + j + 1) << 1;\n\t\t\t\t\t\t\t\tcornerAdjustWork[k + 0] = j - 1;\n\t\t\t\t\t\t\t\tcornerAdjustWork[k + 1] = irow;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\ti += 1;\n\t\t\t\t\t\t\tj -= 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\ty += marginVertical + height;\n\t\t\t\t\ti += j;\n\t\t\t\t\tirow += 1;\n\t\t\t\t}\n\n\t\t\t\tif (cornerAdjustWork != null) {\n\t\t\t\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\t\t\t\tconst child = children[reverse ? imax - 1 - i : i];\n\t\t\t\t\t\tif (isVisible(child)) {\n\t\t\t\t\t\t\tconst i1 = 2 + (i << 1);\n\t\t\t\t\t\t\tconst icolumn1 = cornerAdjustWork[i1 + 0];\n\t\t\t\t\t\t\tconst irow1 = cornerAdjustWork[i1 + 1];\n\t\t\t\t\t\t\tconst clearType = child.getClearType();\n\n\t\t\t\t\t\t\tlet icolumn0 = -2;\n\t\t\t\t\t\t\tif (!(clearType & DLayoutClearType.BEFORE)) {\n\t\t\t\t\t\t\t\tconst i0 = this.findRowIndexPrevious(i1, irow1, cornerAdjustWork);\n\t\t\t\t\t\t\t\tif (!this.hasClearTypeAfter(children, i0)) {\n\t\t\t\t\t\t\t\t\ticolumn0 = cornerAdjustWork[i0];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tlet icolumn2 = -2;\n\t\t\t\t\t\t\tif (!(clearType & DLayoutClearType.AFTER)) {\n\t\t\t\t\t\t\t\tconst i2 = this.findRowIndexNext(i1, irow1, cornerAdjustWork);\n\t\t\t\t\t\t\t\tif (!this.hasClearTypeBefore(children, i2)) {\n\t\t\t\t\t\t\t\t\ticolumn2 = cornerAdjustWork[i2];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst ncolumn = this.countColumn(i1, irow1, cornerAdjustWork);\n\t\t\t\t\t\t\tchild.corner.mask = this.toCornerMaskColumn(\n\t\t\t\t\t\t\t\ticolumn0,\n\t\t\t\t\t\t\t\ticolumn1,\n\t\t\t\t\t\t\t\ticolumn2,\n\t\t\t\t\t\t\t\tncolumn\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (let i = 0, imax = children.length; i < imax; ) {\n\t\t\t\t\tlet x = paddingLeft - marginHorizontal;\n\t\t\t\t\tlet height = 0;\n\t\t\t\t\tlet j = 0;\n\t\t\t\t\tfor (; j < multiplicity && i + j < imax; ++j) {\n\t\t\t\t\t\tconst child = children[reverse ? imax - 1 - (i + j) : i + j];\n\t\t\t\t\t\tif (isVisible(child)) {\n\t\t\t\t\t\t\tconst clearType = child.getClearType();\n\t\t\t\t\t\t\tif (j !== 0 && clearType & DLayoutClearType.BEFORE) {\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tchild.position.set(marginHorizontal + x, marginVertical + y);\n\t\t\t\t\t\t\t\tconst weight = child.weight;\n\t\t\t\t\t\t\t\tif (0 <= weight) {\n\t\t\t\t\t\t\t\t\tchild.height = 0;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tx += marginHorizontal + child.width;\n\t\t\t\t\t\t\t\theight = Math.max(height, child.height);\n\t\t\t\t\t\t\t\tif (clearType & DLayoutClearType.AFTER) {\n\t\t\t\t\t\t\t\t\tif (cornerAdjustWork != null) {\n\t\t\t\t\t\t\t\t\t\tconst k = (i + j + 1) << 1;\n\t\t\t\t\t\t\t\t\t\tcornerAdjustWork[k + 0] = j;\n\t\t\t\t\t\t\t\t\t\tcornerAdjustWork[k + 1] = irow;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tj += 1;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tif (cornerAdjustWork != null) {\n\t\t\t\t\t\t\t\t\t\tconst k = (i + j + 1) << 1;\n\t\t\t\t\t\t\t\t\t\tcornerAdjustWork[k + 0] = j;\n\t\t\t\t\t\t\t\t\t\tcornerAdjustWork[k + 1] = irow;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (cornerAdjustWork != null) {\n\t\t\t\t\t\t\t\tconst k = (i + j + 1) << 1;\n\t\t\t\t\t\t\t\tcornerAdjustWork[k + 0] = j - 1;\n\t\t\t\t\t\t\t\tcornerAdjustWork[k + 1] = irow;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\ti += 1;\n\t\t\t\t\t\t\tj -= 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\ty += marginVertical + height;\n\t\t\t\t\ti += j;\n\t\t\t\t\tirow += 1;\n\t\t\t\t}\n\n\t\t\t\tif (cornerAdjustWork != null) {\n\t\t\t\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\t\t\t\tconst child = children[reverse ? imax - 1 - i : i];\n\t\t\t\t\t\tif (isVisible(child)) {\n\t\t\t\t\t\t\tconst i1 = 2 + (i << 1);\n\t\t\t\t\t\t\tconst icolumn1 = cornerAdjustWork[i1 + 0];\n\t\t\t\t\t\t\tconst irow1 = cornerAdjustWork[i1 + 1];\n\t\t\t\t\t\t\tconst clearType = child.getClearType();\n\n\t\t\t\t\t\t\tlet icolumn0 = -2;\n\t\t\t\t\t\t\tif (!(clearType & DLayoutClearType.BEFORE)) {\n\t\t\t\t\t\t\t\tconst i0 = this.findRowIndexPrevious(i1, irow1, cornerAdjustWork);\n\t\t\t\t\t\t\t\tif (!this.hasClearTypeAfter(children, i0)) {\n\t\t\t\t\t\t\t\t\ticolumn0 = cornerAdjustWork[i0];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tlet icolumn2 = -2;\n\t\t\t\t\t\t\tif (!(clearType & DLayoutClearType.AFTER)) {\n\t\t\t\t\t\t\t\tconst i2 = this.findRowIndexNext(i1, irow1, cornerAdjustWork);\n\t\t\t\t\t\t\t\tif (!this.hasClearTypeBefore(children, i2)) {\n\t\t\t\t\t\t\t\t\ticolumn2 = cornerAdjustWork[i2];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst ncolumn = this.countColumn(i1, irow1, cornerAdjustWork);\n\t\t\t\t\t\t\tchild.corner.mask = this.toCornerMaskColumn(\n\t\t\t\t\t\t\t\ticolumn0,\n\t\t\t\t\t\t\t\ticolumn1,\n\t\t\t\t\t\t\t\ticolumn2,\n\t\t\t\t\t\t\t\tncolumn\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tlet icolumn = 0;\n\t\t\tlet x = paddingLeft - marginHorizontal;\n\t\t\tif (0 < weightTotal) {\n\t\t\t\tconst weightTotalInverse = 1 / weightTotal;\n\t\t\t\tconst spaceLeft = this.calcSpaceLeft(\n\t\t\t\t\tauto.width.isOn,\n\t\t\t\t\tthis.width,\n\t\t\t\t\tpaddingLeft + paddingRight,\n\t\t\t\t\tmarginHorizontal\n\t\t\t\t);\n\t\t\t\tfor (let i = 0, imax = children.length; i < imax; ) {\n\t\t\t\t\tlet y = paddingTop - marginVertical;\n\t\t\t\t\tlet width = 0;\n\t\t\t\t\tlet j = 0;\n\t\t\t\t\tfor (; j < multiplicity && i + j < imax; ++j) {\n\t\t\t\t\t\tconst child = children[reverse ? imax - 1 - (i + j) : i + j];\n\t\t\t\t\t\tif (isVisible(child)) {\n\t\t\t\t\t\t\tconst clearType = child.getClearType();\n\t\t\t\t\t\t\tif (j !== 0 && clearType & DLayoutClearType.BEFORE) {\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tchild.position.set(marginHorizontal + x, marginVertical + y);\n\t\t\t\t\t\t\t\tconst weight = child.weight;\n\t\t\t\t\t\t\t\tif (0 <= weight) {\n\t\t\t\t\t\t\t\t\tchild.width = spaceLeft * (weight * weightTotalInverse);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\twidth = Math.max(width, child.width);\n\t\t\t\t\t\t\t\ty += marginVertical + child.height;\n\t\t\t\t\t\t\t\tif (clearType & DLayoutClearType.AFTER) {\n\t\t\t\t\t\t\t\t\tif (cornerAdjustWork != null) {\n\t\t\t\t\t\t\t\t\t\tconst k = (i + j + 1) << 1;\n\t\t\t\t\t\t\t\t\t\tcornerAdjustWork[k + 0] = icolumn;\n\t\t\t\t\t\t\t\t\t\tcornerAdjustWork[k + 1] = j;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tj += 1;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tif (cornerAdjustWork != null) {\n\t\t\t\t\t\t\t\t\t\tconst k = (i + j + 1) << 1;\n\t\t\t\t\t\t\t\t\t\tcornerAdjustWork[k + 0] = icolumn;\n\t\t\t\t\t\t\t\t\t\tcornerAdjustWork[k + 1] = j;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (cornerAdjustWork != null) {\n\t\t\t\t\t\t\t\tconst k = (i + j + 1) << 1;\n\t\t\t\t\t\t\t\tcornerAdjustWork[k + 0] = icolumn;\n\t\t\t\t\t\t\t\tcornerAdjustWork[k + 1] = j - 1;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\ti += 1;\n\t\t\t\t\t\t\tj -= 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tx += marginHorizontal + width;\n\t\t\t\t\ti += j;\n\t\t\t\t\ticolumn += 1;\n\t\t\t\t}\n\n\t\t\t\tif (cornerAdjustWork != null) {\n\t\t\t\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\t\t\t\tconst child = children[reverse ? imax - 1 - i : i];\n\t\t\t\t\t\tif (isVisible(child)) {\n\t\t\t\t\t\t\tconst i1 = 2 + (i << 1);\n\t\t\t\t\t\t\tconst icolumn1 = cornerAdjustWork[i1 + 0];\n\t\t\t\t\t\t\tconst irow1 = cornerAdjustWork[i1 + 1];\n\t\t\t\t\t\t\tconst clearType = child.getClearType();\n\n\t\t\t\t\t\t\tlet irow0 = -2;\n\t\t\t\t\t\t\tif (!(clearType & DLayoutClearType.BEFORE)) {\n\t\t\t\t\t\t\t\tconst i0 = this.findColumnIndexPrevious(\n\t\t\t\t\t\t\t\t\ti1,\n\t\t\t\t\t\t\t\t\ticolumn1,\n\t\t\t\t\t\t\t\t\tcornerAdjustWork\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tif (!this.hasClearTypeAfter(children, i0)) {\n\t\t\t\t\t\t\t\t\tirow0 = cornerAdjustWork[i0 + 1];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tlet irow2 = -2;\n\t\t\t\t\t\t\tif (!(clearType & DLayoutClearType.AFTER)) {\n\t\t\t\t\t\t\t\tconst i2 = this.findColumnIndexNext(i1, icolumn1, cornerAdjustWork);\n\t\t\t\t\t\t\t\tif (!this.hasClearTypeBefore(children, i2)) {\n\t\t\t\t\t\t\t\t\tirow2 = cornerAdjustWork[i2 + 1];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst nrow = this.countRow(i1, icolumn1, cornerAdjustWork);\n\t\t\t\t\t\t\tchild.corner.mask = this.toCornerMaskRow(irow0, irow1, irow2, nrow);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (let i = 0, imax = children.length; i < imax; ) {\n\t\t\t\t\tlet y = paddingTop - marginVertical;\n\t\t\t\t\tlet width = 0;\n\t\t\t\t\tlet j = 0;\n\t\t\t\t\tfor (; j < multiplicity && i + j < imax; ++j) {\n\t\t\t\t\t\tconst child = children[reverse ? imax - 1 - (i + j) : i + j];\n\t\t\t\t\t\tif (isVisible(child)) {\n\t\t\t\t\t\t\tconst clearType = child.getClearType();\n\t\t\t\t\t\t\tif (j !== 0 && clearType & DLayoutClearType.BEFORE) {\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tchild.position.set(marginHorizontal + x, marginVertical + y);\n\t\t\t\t\t\t\t\tconst weight = child.weight;\n\t\t\t\t\t\t\t\tif (0 <= weight) {\n\t\t\t\t\t\t\t\t\tchild.width = 0;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\twidth = Math.max(width, child.width);\n\t\t\t\t\t\t\t\ty += marginVertical + child.height;\n\t\t\t\t\t\t\t\tif (clearType & DLayoutClearType.AFTER) {\n\t\t\t\t\t\t\t\t\tif (cornerAdjustWork != null) {\n\t\t\t\t\t\t\t\t\t\tconst k = (i + j + 1) << 1;\n\t\t\t\t\t\t\t\t\t\tcornerAdjustWork[k + 0] = icolumn;\n\t\t\t\t\t\t\t\t\t\tcornerAdjustWork[k + 1] = j;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tj += 1;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tif (cornerAdjustWork != null) {\n\t\t\t\t\t\t\t\t\t\tconst k = (i + j + 1) << 1;\n\t\t\t\t\t\t\t\t\t\tcornerAdjustWork[k + 0] = icolumn;\n\t\t\t\t\t\t\t\t\t\tcornerAdjustWork[k + 1] = j;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (cornerAdjustWork != null) {\n\t\t\t\t\t\t\t\tconst k = (i + j + 1) << 1;\n\t\t\t\t\t\t\t\tcornerAdjustWork[k + 0] = icolumn;\n\t\t\t\t\t\t\t\tcornerAdjustWork[k + 1] = j - 1;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\ti += 1;\n\t\t\t\t\t\t\tj -= 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tx += marginHorizontal + width;\n\t\t\t\t\ti += j;\n\t\t\t\t\ticolumn += 1;\n\t\t\t\t}\n\n\t\t\t\tif (cornerAdjustWork != null) {\n\t\t\t\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\t\t\t\tconst child = children[reverse ? imax - 1 - i : i];\n\t\t\t\t\t\tif (isVisible(child)) {\n\t\t\t\t\t\t\tconst i1 = 2 + (i << 1);\n\t\t\t\t\t\t\tconst icolumn1 = cornerAdjustWork[i1 + 0];\n\t\t\t\t\t\t\tconst irow1 = cornerAdjustWork[i1 + 1];\n\t\t\t\t\t\t\tconst clearType = child.getClearType();\n\n\t\t\t\t\t\t\tlet irow0 = -2;\n\t\t\t\t\t\t\tif (!(clearType & DLayoutClearType.BEFORE)) {\n\t\t\t\t\t\t\t\tconst i0 = this.findColumnIndexPrevious(\n\t\t\t\t\t\t\t\t\ti1,\n\t\t\t\t\t\t\t\t\ticolumn1,\n\t\t\t\t\t\t\t\t\tcornerAdjustWork\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tif (!this.hasClearTypeAfter(children, i0)) {\n\t\t\t\t\t\t\t\t\tirow0 = cornerAdjustWork[i0 + 1];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tlet irow2 = -2;\n\t\t\t\t\t\t\tif (!(clearType & DLayoutClearType.AFTER)) {\n\t\t\t\t\t\t\t\tconst i2 = this.findColumnIndexNext(i1, icolumn1, cornerAdjustWork);\n\t\t\t\t\t\t\t\tif (!this.hasClearTypeBefore(children, i2)) {\n\t\t\t\t\t\t\t\t\tirow2 = cornerAdjustWork[i2 + 1];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst nrow = this.countRow(i1, icolumn1, cornerAdjustWork);\n\t\t\t\t\t\t\tchild.corner.mask = this.toCornerMaskRow(irow0, irow1, irow2, nrow);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tsuper.onRefit();\n\t}\n\n\tprotected hasClearTypeBefore(children: DisplayObject[], index: number): boolean {\n\t\treturn this.hasClearType(children, index, DLayoutClearType.BEFORE);\n\t}\n\n\tprotected hasClearTypeAfter(children: DisplayObject[], index: number): boolean {\n\t\treturn this.hasClearType(children, index, DLayoutClearType.AFTER);\n\t}\n\n\tprotected hasClearType(\n\t\tchildren: DisplayObject[],\n\t\tindex: number,\n\t\tclearType: DLayoutClearType\n\t): boolean {\n\t\tif (2 <= index) {\n\t\t\tconst i = (index - 2) >> 1;\n\t\t\tif (0 <= i && i < children.length) {\n\t\t\t\tconst child = children[i];\n\t\t\t\tif (child instanceof DBase) {\n\t\t\t\t\treturn !!(child.getClearType() & clearType);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tprotected findColumnIndexPrevious(\n\t\tistart: number,\n\t\ticolumn: number,\n\t\tcornerAdjustWork: Float32Array\n\t): number {\n\t\tfor (let i = istart - 2; 0 <= i; i -= 2) {\n\t\t\tif (cornerAdjustWork[i] !== icolumn) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\t\treturn 0;\n\t}\n\n\tprotected findColumnIndexNext(\n\t\tistart: number,\n\t\ticolumn: number,\n\t\tcornerAdjustWork: Float32Array\n\t): number {\n\t\tfor (let i = istart + 2, imax = cornerAdjustWork.length; i < imax; i += 2) {\n\t\t\tconst icolumn2 = cornerAdjustWork[i];\n\t\t\tif (icolumn2 !== icolumn) {\n\t\t\t\tfor (let j = i + 2; j < imax; j += 2) {\n\t\t\t\t\tif (cornerAdjustWork[j] !== icolumn2) {\n\t\t\t\t\t\treturn j - 2;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\t\treturn cornerAdjustWork.length - 2;\n\t}\n\n\tprotected countRow(istart: number, icolumn: number, cornerAdjustWork: Float32Array): number {\n\t\tfor (let i = istart + 2, imax = cornerAdjustWork.length; i < imax; i += 2) {\n\t\t\tconst icolumn2 = cornerAdjustWork[i];\n\t\t\tif (icolumn2 !== icolumn) {\n\t\t\t\treturn cornerAdjustWork[i - 2 + 1] + 1;\n\t\t\t}\n\t\t}\n\t\treturn 0;\n\t}\n\n\tprotected findRowIndexPrevious(\n\t\tistart: number,\n\t\tirow: number,\n\t\tcornerAdjustWork: Float32Array\n\t): number {\n\t\tfor (let i = istart - 2; 0 <= i; i -= 2) {\n\t\t\tif (cornerAdjustWork[i + 1] !== irow) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\t\treturn 0;\n\t}\n\n\tprotected findRowIndexNext(\n\t\tistart: number,\n\t\tirow: number,\n\t\tcornerAdjustWork: Float32Array\n\t): number {\n\t\tfor (let i = istart + 2, imax = cornerAdjustWork.length; i < imax; i += 2) {\n\t\t\tconst irow2 = cornerAdjustWork[i + 1];\n\t\t\tif (irow2 !== irow) {\n\t\t\t\tfor (let j = i + 2; j < imax; j += 2) {\n\t\t\t\t\tif (cornerAdjustWork[j + 1] !== irow2) {\n\t\t\t\t\t\treturn j - 2;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\t\treturn cornerAdjustWork.length - 2;\n\t}\n\n\tprotected countColumn(istart: number, irow: number, cornerAdjustWork: Float32Array): number {\n\t\tfor (let i = istart + 2, imax = cornerAdjustWork.length; i < imax; i += 2) {\n\t\t\tconst irow2 = cornerAdjustWork[i + 1];\n\t\t\tif (irow2 !== irow) {\n\t\t\t\treturn cornerAdjustWork[i - 2 + 0] + 1;\n\t\t\t}\n\t\t}\n\t\treturn 0;\n\t}\n\n\tprotected toCornerMaskColumn(i0: number, i1: number, i2: number, n: number): DCornerMask {\n\t\tlet result = DCornerMask.NONE;\n\t\tif (i0 + 1 < i1 && i1 === 0) {\n\t\t\tresult |= DCornerMask.TOP_LEFT;\n\t\t}\n\t\tif (i2 + 1 < i1 && i1 === 0) {\n\t\t\tresult |= DCornerMask.BOTTOM_LEFT;\n\t\t}\n\t\tif (i0 < i1 && i1 + 1 === n) {\n\t\t\tresult |= DCornerMask.TOP_RIGHT;\n\t\t}\n\t\tif (i2 < i1 && i1 + 1 === n) {\n\t\t\tresult |= DCornerMask.BOTTOM_RIGHT;\n\t\t}\n\t\treturn DCornerMask.ALL & ~result;\n\t}\n\n\tprotected toCornerMaskRow(i0: number, i1: number, i2: number, n: number): DCornerMask {\n\t\tlet result = DCornerMask.NONE;\n\t\tif (i0 + 1 < i1 && i1 === 0) {\n\t\t\tresult |= DCornerMask.TOP_LEFT;\n\t\t}\n\t\tif (i2 + 1 < i1 && i1 === 0) {\n\t\t\tresult |= DCornerMask.TOP_RIGHT;\n\t\t}\n\t\tif (i0 < i1 && i1 + 1 === n) {\n\t\t\tresult |= DCornerMask.BOTTOM_LEFT;\n\t\t}\n\t\tif (i2 < i1 && i1 + 1 === n) {\n\t\t\tresult |= DCornerMask.BOTTOM_RIGHT;\n\t\t}\n\t\treturn DCornerMask.ALL & ~result;\n\t}\n\n\taddSpace(options?: DLayoutSpaceOptions): DLayoutSpace {\n\t\treturn this.addChild(new DLayoutSpace(options));\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DLayout\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DLayout, DLayoutOptions, DThemeLayout } from \"./d-layout\";\n\nexport interface DLayoutHorizontalOptions<\n\tTHEME extends DThemeLayoutHorizontal = DThemeLayoutHorizontal\n> extends DLayoutOptions<THEME> {}\n\nexport interface DThemeLayoutHorizontal extends DThemeLayout {}\n\nexport class DLayoutHorizontal<\n\tTHEME extends DThemeLayoutHorizontal = DThemeLayoutHorizontal,\n\tOPTIONS extends DLayoutHorizontalOptions<THEME> = DLayoutHorizontalOptions<THEME>\n> extends DLayout<THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DLayoutHorizontal\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DLayout, DLayoutOptions, DThemeLayout } from \"./d-layout\";\n\nexport interface DLayoutVerticalOptions<THEME extends DThemeLayoutVertical = DThemeLayoutVertical>\n\textends DLayoutOptions<THEME> {}\n\nexport interface DThemeLayoutVertical extends DThemeLayout {}\n\nexport class DLayoutVertical<\n\tTHEME extends DThemeLayoutVertical = DThemeLayoutVertical,\n\tOPTIONS extends DLayoutVerticalOptions<THEME> = DLayoutVerticalOptions<THEME>\n> extends DLayout<THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DLayoutVertical\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DButton } from \"./d-button\";\nimport { DButtonPrimary } from \"./d-button-primary\";\nimport { DCoordinatePosition, DCoordinateSize } from \"./d-coordinate\";\nimport { DDialog, DDialogEvents, DDialogOptions, DThemeDialog } from \"./d-dialog\";\nimport { DDialogMode } from \"./d-dialog-mode\";\nimport { DLayoutHorizontal } from \"./d-layout-horizontal\";\nimport { DLayoutSpace } from \"./d-layout-space\";\nimport { DLayoutVertical, DLayoutVerticalOptions } from \"./d-layout-vertical\";\nimport { DOnOptions } from \"./d-on-options\";\n\n/**\n * {@link DDialogCommand} events.\n */\nexport interface DDialogCommandEvents<VALUE, EMITTER> extends DDialogEvents<EMITTER> {\n\t/**\n\t * Triggered when a dialog is successfully finished.\n\t *\n\t * @param value a value\n\t * @param emitter an emitter\n\t */\n\tok(value: VALUE, emitter: EMITTER): void;\n\n\t/**\n\t * Triggered when a dialog is canceled.\n\t *\n\t * @param reason a reason why canceled\n\t * @param emitter an emitter\n\t */\n\tcancel(reason: any, emitter: EMITTER): void;\n}\n\n/**\n * {@link DDialogCommand} \"on\" options.\n */\nexport interface DDialogCommandOnOptions<VALUE, EMITTER>\n\textends Partial<DDialogCommandEvents<VALUE, EMITTER>>,\n\t\tDOnOptions {}\n\n/**\n * {@link DDialogCommand} options.\n */\nexport interface DDialogCommandOptions<\n\tVALUE = unknown,\n\tTHEME extends DThemeDialogCommand = DThemeDialogCommand,\n\tEMITTER = any\n> extends DDialogOptions<THEME> {\n\t/**\n\t * A ok button label.\n\t */\n\tok?: string;\n\n\t/**\n\t * A cancel button label.\n\t */\n\tcancel?: string;\n\n\t/**\n\t * Mappings of event names and handlers.\n\t */\n\ton?: DDialogCommandOnOptions<VALUE, EMITTER>;\n\n\t/**\n\t * Layout options.\n\t */\n\tlayout?: DLayoutVerticalOptions;\n}\n\n/**\n * {@link DDialogCommand} theme.\n */\nexport interface DThemeDialogCommand extends DThemeDialog {\n\tgetOk(): string | null;\n\tgetCancel(): string | null;\n\tgetLayoutX(): DCoordinatePosition;\n\tgetLayoutY(): DCoordinatePosition;\n\tgetLayoutWidth(): DCoordinateSize;\n\tgetLayoutHeight(): DCoordinateSize;\n\tgetLayoutMargin(): number | undefined;\n}\n\n/**\n * A dialog with \"ok\" and \"cancel\" buttons.\n */\nexport abstract class DDialogCommand<\n\tVALUE = void,\n\tTHEME extends DThemeDialogCommand = DThemeDialogCommand,\n\tOPTIONS extends DDialogCommandOptions<VALUE, THEME> = DDialogCommandOptions<VALUE, THEME>\n> extends DDialog<VALUE, THEME, OPTIONS> {\n\tprotected _buttonLayout?: DLayoutHorizontal;\n\tprotected _buttonOk?: DButton;\n\tprotected _buttonCancel?: DButton;\n\n\tprotected init(options?: OPTIONS): void {\n\t\tsuper.init(options);\n\n\t\tconst theme = this.theme;\n\t\tconst layout = this.newLayout(theme, options);\n\t\tthis.onInit(layout, options);\n\n\t\t// Buttons\n\t\tconst ok = options?.ok ?? theme.getOk();\n\t\tconst cancel = options?.cancel ?? theme.getCancel();\n\t\tif (ok != null || cancel != null) {\n\t\t\tconst buttonLayout = new DLayoutHorizontal({\n\t\t\t\tparent: layout,\n\t\t\t\twidth: \"padding\",\n\t\t\t\theight: \"auto\",\n\t\t\t\tpadding: {\n\t\t\t\t\ttop: Math.max(0, this.padding.getTop() - layout.margin.vertical)\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis._buttonLayout = buttonLayout;\n\t\t\tnew DLayoutSpace({\n\t\t\t\tparent: buttonLayout,\n\t\t\t\tweight: 1\n\t\t\t});\n\t\t\tif (ok != null && cancel != null) {\n\t\t\t\tthis._buttonCancel = new DButtonPrimary({\n\t\t\t\t\tparent: buttonLayout,\n\t\t\t\t\ttext: {\n\t\t\t\t\t\tvalue: cancel\n\t\t\t\t\t},\n\t\t\t\t\ton: {\n\t\t\t\t\t\tactive: (): void => {\n\t\t\t\t\t\t\tthis.cancel();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tthis._buttonOk = new DButton({\n\t\t\t\t\tparent: buttonLayout,\n\t\t\t\t\ttext: {\n\t\t\t\t\t\tvalue: ok\n\t\t\t\t\t},\n\t\t\t\t\ton: {\n\t\t\t\t\t\tactive: (): void => {\n\t\t\t\t\t\t\tthis.ok();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else if (ok != null) {\n\t\t\t\tthis._buttonOk = new DButtonPrimary({\n\t\t\t\t\tparent: buttonLayout,\n\t\t\t\t\ttext: {\n\t\t\t\t\t\tvalue: ok\n\t\t\t\t\t},\n\t\t\t\t\ton: {\n\t\t\t\t\t\tactive: (): void => {\n\t\t\t\t\t\t\tthis.ok();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else if (cancel != null) {\n\t\t\t\tthis._buttonCancel = new DButtonPrimary({\n\t\t\t\t\tparent: buttonLayout,\n\t\t\t\t\ttext: {\n\t\t\t\t\t\tvalue: cancel\n\t\t\t\t\t},\n\t\t\t\t\ton: {\n\t\t\t\t\t\tactive: (): void => {\n\t\t\t\t\t\t\tthis.cancel();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\tnew DLayoutSpace({\n\t\t\t\tparent: buttonLayout,\n\t\t\t\tweight: 1\n\t\t\t});\n\t\t}\n\t}\n\n\tprotected newLayout(theme: THEME, options?: OPTIONS): DLayoutVertical {\n\t\treturn new DLayoutVertical(this.toLayoutOptions(theme, options?.layout));\n\t}\n\n\tprotected toLayoutOptions(\n\t\ttheme: THEME,\n\t\toptions?: DLayoutVerticalOptions\n\t): DLayoutVerticalOptions {\n\t\toptions ??= {};\n\t\toptions.parent = this;\n\t\toptions.x ??= theme.getLayoutX();\n\t\toptions.y ??= theme.getLayoutY();\n\t\toptions.width ??= theme.getLayoutWidth();\n\t\toptions.height ??= theme.getLayoutHeight();\n\t\toptions.margin ??= theme.getLayoutMargin();\n\t\treturn options;\n\t}\n\n\tprotected onInit(layout: DLayoutVertical, options?: OPTIONS): void {\n\t\t// OVERRIDE THIS\n\t}\n\n\tok(): void {\n\t\tthis.onOk(this.getResolvedValue());\n\t}\n\n\tprotected onOk(value: VALUE | PromiseLike<VALUE>): void {\n\t\tif (this._mode !== DDialogMode.MODELESS) {\n\t\t\tthis.doResolve(value);\n\t\t}\n\t\tthis.emit(\"ok\", value, this);\n\t}\n\n\tcancel(): void {\n\t\tthis.onCancel(this.getRejectReason());\n\t}\n\n\tprotected onCancel(reason: any): void {\n\t\tif (this._mode !== DDialogMode.MODELESS) {\n\t\t\tthis.doReject(reason);\n\t\t}\n\t\tthis.emit(\"cancel\", reason, this);\n\t}\n\n\tprotected abstract getResolvedValue(): VALUE | PromiseLike<VALUE>;\n\n\tprotected getRejectReason(): any {\n\t\treturn undefined;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DDialogCommand\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DTextBase, DTextBaseOptions, DThemeTextBase } from \"./d-text-base\";\n\nexport interface DTextOptions<VALUE = unknown, THEME extends DThemeText<VALUE> = DThemeText<VALUE>>\n\textends DTextBaseOptions<VALUE, THEME> {}\n\nexport interface DThemeText<VALUE = unknown> extends DThemeTextBase<VALUE> {}\n\nexport class DText<\n\tVALUE = unknown,\n\tTHEME extends DThemeText<VALUE> = DThemeText<VALUE>,\n\tOPTIONS extends DTextOptions<VALUE, THEME> = DTextOptions<VALUE, THEME>\n> extends DTextBase<VALUE, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DText\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBase, DBaseOptions } from \"./d-base\";\nimport { DDialogCommand, DDialogCommandOptions, DThemeDialogCommand } from \"./d-dialog-command\";\nimport { DLayoutHorizontal } from \"./d-layout-horizontal\";\nimport { DLayoutSpace } from \"./d-layout-space\";\nimport { DLayoutVertical } from \"./d-layout-vertical\";\nimport { DText, DTextOptions } from \"./d-text\";\nimport { isNumber } from \"./util/is-number\";\nimport { isString } from \"./util/is-string\";\n\nexport interface DDialogInputMargin {\n\thorizontal: number;\n\tvertical: number;\n}\n\nexport interface DDialogInputMarginOptions extends Partial<DDialogInputMargin> {}\n\nexport interface DDialogInputOptions<\n\tVALUE = void,\n\tINPUT_OPTIONS extends DBaseOptions = DBaseOptions,\n\tTHEME extends DThemeDialogInput = DThemeDialogInput\n> extends DDialogCommandOptions<VALUE, THEME> {\n\tlabel?: string | DTextOptions<string>;\n\tinput?: INPUT_OPTIONS;\n\tmargin?: number | DDialogInputMarginOptions;\n}\n\nexport interface DThemeDialogInput extends DThemeDialogCommand {\n\tgetMarginVertical(): number;\n\tgetMarginHorizontal(): number;\n\tgetLabel(): string;\n}\n\nexport abstract class DDialogInput<\n\tVALUE = void,\n\tINPUT extends DBase & { value: VALUE } = any,\n\tINPUT_OPTIONS extends DBaseOptions = DBaseOptions,\n\tTHEME extends DThemeDialogInput = DThemeDialogInput,\n\tOPTIONS extends DDialogInputOptions<VALUE, INPUT_OPTIONS, THEME> = DDialogInputOptions<\n\t\tVALUE,\n\t\tINPUT_OPTIONS,\n\t\tTHEME\n\t>\n> extends DDialogCommand<VALUE, THEME, OPTIONS> {\n\tprotected _label?: DText<string>;\n\tprotected _input?: INPUT;\n\n\tprotected onInit(layout: DLayoutVertical, options?: OPTIONS): void {\n\t\tsuper.onInit(layout, options);\n\n\t\tconst theme = this.theme;\n\t\tconst margin = this.toMargin(theme, options);\n\t\tconst marginHorizontal = margin.horizontal;\n\t\tconst marginVertical = margin.vertical;\n\t\tconst labelOptions = this.toLabelOptions(theme, options);\n\t\tif (labelOptions) {\n\t\t\tthis._label = new DText<string>(labelOptions);\n\t\t\tnew DLayoutHorizontal({\n\t\t\t\tparent: layout,\n\t\t\t\twidth: \"padding\",\n\t\t\t\theight: \"auto\",\n\t\t\t\tmargin: 0,\n\t\t\t\tchildren: [new DLayoutSpace({ width: marginHorizontal }), this._label]\n\t\t\t});\n\t\t}\n\t\tnew DLayoutHorizontal({\n\t\t\tparent: layout,\n\t\t\twidth: \"padding\",\n\t\t\theight: \"auto\",\n\t\t\tmargin: 0,\n\t\t\tpadding: labelOptions ? { top: marginVertical } : undefined,\n\t\t\tchildren: [\n\t\t\t\tnew DLayoutSpace({ width: marginHorizontal }),\n\t\t\t\tthis.input,\n\t\t\t\tnew DLayoutSpace({ width: marginHorizontal })\n\t\t\t]\n\t\t});\n\t}\n\n\tprotected toMargin(theme: THEME, options?: OPTIONS): Required<DDialogInputMarginOptions> {\n\t\tconst margin = options?.margin;\n\t\tif (margin != null) {\n\t\t\tif (isNumber(margin)) {\n\t\t\t\treturn {\n\t\t\t\t\thorizontal: margin,\n\t\t\t\t\tvertical: margin\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tconst horizontal = margin.horizontal;\n\t\t\t\tconst vertical = margin.vertical;\n\t\t\t\treturn {\n\t\t\t\t\thorizontal: horizontal ?? theme.getMarginHorizontal(),\n\t\t\t\t\tvertical: vertical ?? theme.getMarginVertical()\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t\treturn {\n\t\t\thorizontal: theme.getMarginHorizontal(),\n\t\t\tvertical: theme.getMarginVertical()\n\t\t};\n\t}\n\n\tprotected toLabelOptions(\n\t\ttheme: THEME,\n\t\toptions: OPTIONS | undefined\n\t): DTextOptions<string> | null {\n\t\tconst label = options?.label;\n\t\tif (label == null) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif (isString(label)) {\n\t\t\treturn {\n\t\t\t\tweight: 1,\n\t\t\t\ttext: {\n\t\t\t\t\tvalue: label\n\t\t\t\t}\n\t\t\t};\n\t\t} else {\n\t\t\t// Text\n\t\t\tconst text = label.text || {};\n\t\t\tlabel.text = text;\n\t\t\tif (text.value === undefined) {\n\t\t\t\ttext.value = theme.getLabel();\n\t\t\t}\n\n\t\t\t// Margin\n\t\t\tif (label.width === undefined && label.weight === undefined) {\n\t\t\t\tlabel.weight = 1;\n\t\t\t}\n\n\t\t\treturn label;\n\t\t}\n\t}\n\n\tget label(): DText<string> | undefined {\n\t\treturn this._label;\n\t}\n\n\tprotected abstract newInput(options?: INPUT_OPTIONS): INPUT;\n\n\tget input(): INPUT {\n\t\tlet result = this._input;\n\t\tif (result == null) {\n\t\t\tconst options = this._options;\n\t\t\tresult = this.newInput(options?.input);\n\t\t\tthis._input = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tget value(): VALUE {\n\t\treturn this.input.value;\n\t}\n\n\tset value(value: VALUE) {\n\t\tthis.input.value = value;\n\t}\n\n\tprotected getResolvedValue(): VALUE | PromiseLike<VALUE> {\n\t\treturn this.input.value;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DDialogInput\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { utils } from \"pixi.js\";\nimport { DButtonBase } from \"./d-button-base\";\nimport { DOnOptions } from \"./d-on-options\";\n\n/**\n * {@link DButtonGroup} events.\n */\nexport interface DButtonGroupEvents<BUTTON, EMITTER> {\n\t/**\n\t * Triggered when the active button is changed.\n\t *\n\t * @param emitter an emitter\n\t */\n\tactive(newActive: BUTTON | null, oldActive: BUTTON | null, emitter: EMITTER): void;\n}\n\n/**\n * {@link DButtonGroup} \"on\" options.\n */\nexport interface DButtonGroupOnOptions<BUTTON, EMITTER>\n\textends Partial<DButtonGroupEvents<BUTTON, EMITTER>>,\n\t\tDOnOptions {}\n\nexport interface DButtonGroupOptions<\n\tBUTTON extends DButtonBase<any, any, any> = DButtonBase<any, any, any>,\n\tEMITTER = any\n> {\n\ton?: DButtonGroupOnOptions<BUTTON, EMITTER>;\n}\n\nexport class DButtonGroup<\n\tBUTTON extends DButtonBase<any, any, any> = DButtonBase<any, any, any>,\n\tOPTIONS extends DButtonGroupOptions<BUTTON> = DButtonGroupOptions<BUTTON>\n> extends utils.EventEmitter {\n\tprotected _buttons: BUTTON[];\n\tprotected _active: BUTTON | null;\n\tprotected _onActiveBound: (button: BUTTON) => void;\n\tprotected _isEnabled?: boolean;\n\n\tconstructor(options?: OPTIONS) {\n\t\tsuper();\n\n\t\tthis._buttons = [];\n\t\tthis._active = null;\n\t\tthis._onActiveBound = (button: BUTTON): void => {\n\t\t\tthis.active = button;\n\t\t};\n\n\t\t// Events\n\t\tconst on = options?.on;\n\t\tif (on != null) {\n\t\t\tfor (const name in on) {\n\t\t\t\tconst handler = on[name];\n\t\t\t\tif (handler) {\n\t\t\t\t\tthis.on(name, handler);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Done\n\t\tthis.emit(\"init\", this);\n\t}\n\n\tadd(button: BUTTON): void {\n\t\tconst buttons = this._buttons;\n\t\tconst index = buttons.indexOf(button);\n\t\tif (index < 0) {\n\t\t\tthis._buttons.push(button);\n\t\t\tconst isEnabled = this._isEnabled;\n\t\t\tif (isEnabled != null) {\n\t\t\t\tbutton.state.isEnabled = isEnabled;\n\t\t\t}\n\t\t\tbutton.on(\"active\", this._onActiveBound);\n\t\t\tif (button.state.isActive) {\n\t\t\t\tthis.active = button;\n\t\t\t}\n\t\t}\n\t}\n\n\tget active(): BUTTON | null {\n\t\treturn this._active;\n\t}\n\n\tset active(newActive: BUTTON | null) {\n\t\tif ((newActive == null || newActive.isToggle) && this._active !== newActive) {\n\t\t\tconst oldActive = this._active;\n\t\t\tthis._active = null;\n\t\t\tconst buttons = this._buttons;\n\t\t\tfor (let i = 0, imax = buttons.length; i < imax; ++i) {\n\t\t\t\tconst button = buttons[i];\n\t\t\t\tif (button !== newActive && button.isToggle && button.state.isActive) {\n\t\t\t\t\tbutton.toggle();\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.emit(\"active\", newActive, oldActive, this);\n\t\t}\n\t}\n\n\tremove(button: BUTTON): void {\n\t\tconst buttons = this._buttons;\n\t\tconst index = buttons.indexOf(button);\n\t\tif (0 <= index) {\n\t\t\tbuttons.splice(index, 1);\n\t\t\tbutton.off(\"active\", this._onActiveBound);\n\t\t\tif (this._active === button) {\n\t\t\t\tthis.active = null;\n\t\t\t}\n\t\t}\n\t}\n\n\tcontains(button: BUTTON): boolean {\n\t\tconst buttons = this._buttons;\n\t\tconst index = buttons.indexOf(button);\n\t\treturn 0 <= index;\n\t}\n\n\tclear(): void {\n\t\tthis._buttons.length = 0;\n\t\tthis.active = null;\n\t}\n\n\tsize(): number {\n\t\treturn this._buttons.length;\n\t}\n\n\teach(iteratee: (button: BUTTON) => boolean | void): void {\n\t\tconst buttons = this._buttons;\n\t\tfor (let i = 0, imax = buttons.length; i < imax; ++i) {\n\t\t\tconst button = buttons[i];\n\t\t\tif (iteratee(button) === false) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tdisable(): void {\n\t\tconst buttons = this._buttons;\n\t\tfor (let i = 0, imax = buttons.length; i < imax; ++i) {\n\t\t\tbuttons[i].state.isDisabled = true;\n\t\t}\n\t\tthis._isEnabled = false;\n\t}\n\n\tenable(): void {\n\t\tconst buttons = this._buttons;\n\t\tfor (let i = 0, imax = buttons.length; i < imax; ++i) {\n\t\t\tbuttons[i].state.isDisabled = false;\n\t\t}\n\t\tthis._isEnabled = true;\n\t}\n\n\tdestroy(): void {\n\t\tthis.clear();\n\t}\n}\n","/*\n * Copyright (C) 2021 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DButton, DButtonOptions, DThemeButton } from \"./d-button\";\n\nexport interface DInputBooleanButtonOffOptions<\n\tTHEME extends DThemeInputBooleanButtonOff = DThemeInputBooleanButtonOff,\n\tEMITTER = any\n> extends DButtonOptions<string, THEME, EMITTER> {}\n\nexport interface DThemeInputBooleanButtonOff extends DThemeButton<string> {}\n\nexport class DInputBooleanButtonOff<\n\tTHEME extends DThemeInputBooleanButtonOff = DThemeInputBooleanButtonOff,\n\tOPTIONS extends DInputBooleanButtonOffOptions<THEME> = DInputBooleanButtonOffOptions<THEME>\n> extends DButton<string, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DInputBooleanButtonOff\";\n\t}\n}\n","/*\n * Copyright (C) 2021 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DButton, DButtonOptions, DThemeButton } from \"./d-button\";\n\nexport interface DInputBooleanButtonOnOptions<\n\tTHEME extends DThemeInputBooleanButtonOn = DThemeInputBooleanButtonOn,\n\tEMITTER = any\n> extends DButtonOptions<string, THEME, EMITTER> {}\n\nexport interface DThemeInputBooleanButtonOn extends DThemeButton<string> {}\n\nexport class DInputBooleanButtonOn<\n\tTHEME extends DThemeInputBooleanButtonOn = DThemeInputBooleanButtonOn,\n\tOPTIONS extends DInputBooleanButtonOnOptions<THEME> = DInputBooleanButtonOnOptions<THEME>\n> extends DButton<string, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DInputBooleanButtonOn\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBaseState } from \"./d-base-state\";\nimport { DButtonGroup } from \"./d-button-group\";\nimport { DInputBooleanButtonOff } from \"./d-input-boolean-button-off\";\nimport { DInputBooleanButtonOn } from \"./d-input-boolean-button-on\";\nimport { DLayoutOptions } from \"./d-layout\";\nimport { DLayoutHorizontal, DThemeLayoutHorizontal } from \"./d-layout-horizontal\";\n\nexport interface DInputBooleanOptions<THEME extends DThemeInputBoolean = DThemeInputBoolean>\n\textends DLayoutOptions<THEME> {\n\tvalue?: boolean;\n}\n\nexport interface DThemeInputBoolean extends DThemeLayoutHorizontal {}\n\nexport class DInputBoolean<\n\tTHEME extends DThemeInputBoolean = DThemeInputBoolean,\n\tOPTIONS extends DInputBooleanOptions<THEME> = DInputBooleanOptions<THEME>\n> extends DLayoutHorizontal<THEME, OPTIONS> {\n\tprotected _buttonGroup?: DButtonGroup;\n\tprotected _buttonOn?: DInputBooleanButtonOn;\n\tprotected _buttonOff?: DInputBooleanButtonOff;\n\n\tconstructor(options?: OPTIONS) {\n\t\tsuper(options);\n\t\tthis.addChild(this.getButtonOff());\n\t\tthis.addChild(this.getButtonOn());\n\n\t\tconst value = options?.value;\n\t\tif (value != null) {\n\t\t\tthis.value = value;\n\t\t}\n\n\t\tthis.getButtonGroup().on(\"active\", (): void => {\n\t\t\tconst newValue = this.value;\n\t\t\tthis.emit(\"change\", newValue, !newValue, this);\n\t\t});\n\t}\n\n\tprotected getButtonGroup(): DButtonGroup {\n\t\tlet result = this._buttonGroup;\n\t\tif (result == null) {\n\t\t\tresult = this.newButtonGroup();\n\t\t\tthis._buttonGroup = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected newButtonGroup(): DButtonGroup {\n\t\treturn new DButtonGroup();\n\t}\n\n\tprotected getButtonOn(): DInputBooleanButtonOn {\n\t\tlet result = this._buttonOn;\n\t\tif (result == null) {\n\t\t\tresult = this.newButtonOn();\n\t\t\tthis._buttonOn = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected newButtonOn(): DInputBooleanButtonOn {\n\t\treturn new DInputBooleanButtonOn({\n\t\t\tweight: 1,\n\t\t\tgroup: this.getButtonGroup()\n\t\t});\n\t}\n\n\tprotected getButtonOff(): DInputBooleanButtonOff {\n\t\tlet result = this._buttonOff;\n\t\tif (result == null) {\n\t\t\tresult = this.newButtonOff();\n\t\t\tthis._buttonOff = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected newButtonOff(): DInputBooleanButtonOff {\n\t\treturn new DInputBooleanButtonOff({\n\t\t\tweight: 1,\n\t\t\tgroup: this.getButtonGroup(),\n\t\t\tstate: DBaseState.ACTIVE\n\t\t});\n\t}\n\n\tget value(): boolean {\n\t\treturn this.getButtonOn().state.isActive;\n\t}\n\n\tset value(value: boolean) {\n\t\tif (this.value !== value) {\n\t\t\tif (value) {\n\t\t\t\tthis.getButtonOn().onClick();\n\t\t\t} else {\n\t\t\t\tthis.getButtonOff().onClick();\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DInputBoolean\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDialogInput, DDialogInputOptions, DThemeDialogInput } from \"./d-dialog-input\";\nimport { DInputBoolean, DInputBooleanOptions } from \"./d-input-boolean\";\n\nexport interface DDialogInputBooleanOptions<THEME extends DThemeDialogInputBoolean>\n\textends DDialogInputOptions<boolean, DInputBooleanOptions, THEME> {}\n\nexport interface DThemeDialogInputBoolean extends DThemeDialogInput {}\n\nexport class DDialogInputBoolean<\n\tTHEME extends DThemeDialogInputBoolean = DThemeDialogInputBoolean,\n\tOPTIONS extends DDialogInputBooleanOptions<THEME> = DDialogInputBooleanOptions<THEME>\n> extends DDialogInput<boolean, DInputBoolean, DInputBooleanOptions, THEME, OPTIONS> {\n\tprotected newInput(options?: DInputBooleanOptions): DInputBoolean {\n\t\treturn new DInputBoolean(this.toInputOptions(options));\n\t}\n\n\tprotected toInputOptions(options?: DInputBooleanOptions): DInputBooleanOptions {\n\t\tif (options) {\n\t\t\tif (options.weight === undefined) {\n\t\t\t\toptions.weight = 1;\n\t\t\t}\n\t\t\treturn options;\n\t\t}\n\t\treturn {\n\t\t\tweight: 1\n\t\t};\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DDialogInputBoolean\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeRuntimeReset } from \"../e-shape-runtime\";\nimport { EShapeActionExpression } from \"./e-shape-action-expression\";\nimport { EShapeActionExpressions } from \"./e-shape-action-expressions\";\nimport { EShapeActionRuntimeConditional } from \"./e-shape-action-runtime-conditional\";\nimport { EShapeActionValueOpen } from \"./e-shape-action-value-open\";\n\nexport class EShapeActionRuntimeOpen extends EShapeActionRuntimeConditional {\n\tprotected readonly target: EShapeActionExpression<string | null>;\n\n\tconstructor(value: EShapeActionValueOpen, reset: EShapeRuntimeReset) {\n\t\tsuper(value, reset);\n\t\tthis.target = EShapeActionExpressions.ofStringOrNull(value.target);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\nimport { EShapeActionExpression } from \"./e-shape-action-expression\";\nimport { EShapeActionRuntimeOpen } from \"./e-shape-action-runtime-open\";\nimport { EShapeActionValueOnInputAction } from \"./e-shape-action-value-on-input-action\";\nimport { EShapeActionValueOnInputActions } from \"./e-shape-action-value-on-input-actions\";\nimport { EShapeActionValueOpen } from \"./e-shape-action-value-open\";\n\nexport abstract class EShapeActionRuntimeOpenDialog<\n\tVALUE = unknown,\n\tINITIAL = VALUE\n> extends EShapeActionRuntimeOpen {\n\tprotected onInputAction: EShapeActionValueOnInputAction;\n\tprotected isOpened: boolean;\n\tprotected abstract initial: EShapeActionExpression<INITIAL>;\n\n\tconstructor(value: EShapeActionValueOpen) {\n\t\tsuper(value, EShapeRuntimeReset.NONE);\n\t\tthis.onInputAction = value.onInputAction;\n\t\tthis.isOpened = false;\n\t}\n\n\texecute(shape: EShape, runtime: EShapeRuntime, time: number): void {\n\t\tif (!this.isOpened) {\n\t\t\tif (this.condition(shape, time)) {\n\t\t\t\tconst target = this.target(shape, time);\n\t\t\t\tif (target != null) {\n\t\t\t\t\tconst initial = this.initial(shape, time);\n\t\t\t\t\tthis.isOpened = true;\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tthis.open(target, initial).then(\n\t\t\t\t\t\t\t(value) => {\n\t\t\t\t\t\t\t\tthis.isOpened = false;\n\t\t\t\t\t\t\t\tEShapeActionValueOnInputActions.execute(\n\t\t\t\t\t\t\t\t\tshape,\n\t\t\t\t\t\t\t\t\tthis.onInputAction,\n\t\t\t\t\t\t\t\t\ttarget,\n\t\t\t\t\t\t\t\t\tvalue,\n\t\t\t\t\t\t\t\t\ttime\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\tthis.isOpened = false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t);\n\t\t\t\t\t}, 0);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected abstract open(target: string, initial: INITIAL): Promise<VALUE>;\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDialogInputBoolean } from \"../../d-dialog-input-boolean\";\nimport { EShapeActionExpression } from \"./e-shape-action-expression\";\nimport { EShapeActionExpressions } from \"./e-shape-action-expressions\";\nimport { EShapeActionRuntimeOpenDialog } from \"./e-shape-action-runtime-open-dialog\";\nimport { EShapeActionValueOpen } from \"./e-shape-action-value-open\";\n\nexport class EShapeActionRuntimeOpenDialogBoolean extends EShapeActionRuntimeOpenDialog<boolean> {\n\tprotected static DIALOG?: DDialogInputBoolean;\n\tprotected initial: EShapeActionExpression<boolean>;\n\n\tconstructor(value: EShapeActionValueOpen) {\n\t\tsuper(value);\n\t\tthis.initial = EShapeActionExpressions.ofBooleanOrFalse(value.initial);\n\t}\n\n\tprotected open(target: string, initial: boolean): Promise<boolean> {\n\t\tlet dialog = EShapeActionRuntimeOpenDialogBoolean.DIALOG;\n\t\tif (dialog == null) {\n\t\t\tdialog = new DDialogInputBoolean({\n\t\t\t\tlabel: target\n\t\t\t});\n\t\t\tEShapeActionRuntimeOpenDialogBoolean.DIALOG = dialog;\n\t\t} else {\n\t\t\tconst label = dialog.label;\n\t\t\tif (label) {\n\t\t\t\tlabel.text = target;\n\t\t\t}\n\t\t}\n\t\tdialog.value = initial;\n\t\treturn dialog.open();\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction, Matrix, Point, Rectangle, Renderer } from \"pixi.js\";\nimport { DImageBase, DImageBaseOptions, DThemeImageBase } from \"./d-image-base\";\nimport { UtilKeyboardEvent } from \"./util/util-keyboard-event\";\nimport {\n\tUtilHtmlElement,\n\tUtilHtmlElementOperation,\n\tUtilHtmlElementOptions,\n\tUtilHtmlElementPadding,\n\tUtilThemeHtmlElement\n} from \"./util/util-html-element\";\n\nexport interface DHtmlElementOptions<\n\tVALUE = unknown,\n\tELEMENT extends HTMLElement = HTMLElement,\n\tTHEME extends DThemeHtmlElement<VALUE, ELEMENT> = DThemeHtmlElement<VALUE, ELEMENT>\n> extends DImageBaseOptions<VALUE, THEME>,\n\t\tUtilHtmlElementOptions<ELEMENT> {}\n\nexport interface DThemeHtmlElement<VALUE = unknown, ELEMENT extends HTMLElement = HTMLElement>\n\textends DThemeImageBase<VALUE>,\n\t\tUtilThemeHtmlElement<ELEMENT> {}\n\nexport class DHtmlElement<\n\tVALUE = unknown,\n\tELEMENT extends HTMLElement = HTMLElement,\n\tTHEME extends DThemeHtmlElement<VALUE, ELEMENT> = DThemeHtmlElement<VALUE, ELEMENT>,\n\tOPTIONS extends DHtmlElementOptions<VALUE, ELEMENT, THEME> = DHtmlElementOptions<\n\t\tVALUE,\n\t\tELEMENT,\n\t\tTHEME\n\t>,\n\tUTIL extends UtilHtmlElement<ELEMENT> = UtilHtmlElement<ELEMENT>\n> extends DImageBase<VALUE, THEME, OPTIONS> {\n\tprotected _util?: UTIL;\n\n\tprotected getUtil(): UTIL {\n\t\tlet result = this._util;\n\t\tif (result == null) {\n\t\t\tresult = this.newUtil();\n\t\t\tthis._util = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected newUtil(): UTIL {\n\t\treturn new UtilHtmlElement<ELEMENT>(\n\t\t\tthis,\n\t\t\tthis.newOperation(),\n\t\t\tthis.theme,\n\t\t\tthis._options\n\t\t) as any;\n\t}\n\n\tprotected newOperation(): UtilHtmlElementOperation<ELEMENT> {\n\t\treturn {\n\t\t\tgetElementRect: (\n\t\t\t\tresolution: number,\n\t\t\t\twork: Point,\n\t\t\t\tresult: Rectangle\n\t\t\t): Rectangle | null => {\n\t\t\t\treturn this.getElementRect(resolution, work, result);\n\t\t\t},\n\n\t\t\tgetElementMatrix: (): Matrix | null => {\n\t\t\t\treturn null;\n\t\t\t},\n\n\t\t\tgetClipperRect: (\n\t\t\t\tresolution: number,\n\t\t\t\twork: Point,\n\t\t\t\tresult: Rectangle\n\t\t\t): Rectangle | null => {\n\t\t\t\treturn this.getClipperRect(resolution, work, result);\n\t\t\t},\n\n\t\t\tgetPadding: (): UtilHtmlElementPadding | null => {\n\t\t\t\treturn this.padding;\n\t\t\t},\n\n\t\t\tcontainsPoint: (point: Point): boolean => {\n\t\t\t\treturn this.containsPoint(point);\n\t\t\t},\n\n\t\t\tonStart: (): void => {\n\t\t\t\t// DO NOTHING\n\t\t\t},\n\n\t\t\tonCancel: (): void => {\n\t\t\t\t// DO NOTHING\n\t\t\t},\n\n\t\t\tonEnd: (): void => {\n\t\t\t\t// DO NOTHING\n\t\t\t}\n\t\t};\n\t}\n\n\tget element(): ELEMENT | null {\n\t\treturn this.getUtil().element;\n\t}\n\n\tprotected onDownThis(e: interaction.InteractionEvent): void {\n\t\tconst util = this.getUtil();\n\t\tutil.onDowning(e);\n\t\tsuper.onDownThis(e);\n\t\tutil.onDown(e);\n\t}\n\n\tonDblClick(\n\t\te: MouseEvent | TouchEvent,\n\t\tinteractionManager: interaction.InteractionManager\n\t): boolean {\n\t\tthis.getUtil().onDblClick(e, interactionManager);\n\t\treturn super.onDblClick(e, interactionManager);\n\t}\n\n\tprotected onFocus(): void {\n\t\tsuper.onFocus();\n\t\tthis.getUtil().onFocus();\n\t}\n\n\tprotected onBlur(): void {\n\t\tsuper.onBlur();\n\t\tthis.getUtil().onBlur();\n\t}\n\n\tstart(): void {\n\t\tthis.getUtil().start();\n\t}\n\n\trender(renderer: Renderer): void {\n\t\tthis.getUtil().onRender(renderer);\n\t\tsuper.render(renderer);\n\t}\n\n\t/**\n\t * Please note that this method does not update transforms.\n\t *\n\t * @param resolution\n\t */\n\tprotected getElementRect(\n\t\tresolution: number,\n\t\tpoint: Point,\n\t\tresult: Rectangle\n\t): Rectangle | null {\n\t\tpoint.set(0, 0);\n\t\tthis.toGlobal(point, point, false);\n\t\tresult.x = point.x;\n\t\tresult.y = point.y;\n\n\t\tpoint.set(this.width, this.height);\n\t\tthis.toGlobal(point, point, true);\n\t\tresult.width = point.x - result.x;\n\t\tresult.height = point.y - result.y;\n\n\t\t// Rounds pixels as Pixi.js does\n\t\tresult.x = ((result.x * resolution) | 0) / resolution;\n\t\tresult.y = ((result.y * resolution) | 0) / resolution;\n\n\t\treturn result;\n\t}\n\n\tprotected getClipperRect(\n\t\tresolution: number,\n\t\tpoint: Point,\n\t\tresult: Rectangle\n\t): Rectangle | null {\n\t\treturn UtilHtmlElement.getClipperRect(this.parent, this, resolution, point, result);\n\t}\n\n\tcancel(): void {\n\t\tthis.getUtil().cancel();\n\t}\n\n\tend(): void {\n\t\tthis.getUtil().end();\n\t}\n\n\tselect(): this {\n\t\tthis.getUtil().select();\n\t\treturn this;\n\t}\n\n\tprotected onActivateKeyDown(e: KeyboardEvent): void {\n\t\tif (this.state.isActionable) {\n\t\t\tthis.state.isPressed = true;\n\t\t}\n\t}\n\n\tprotected onActivateKeyUp(e: KeyboardEvent): void {\n\t\tif (this.state.isActionable) {\n\t\t\tif (this.state.isPressed) {\n\t\t\t\tthis.start();\n\t\t\t}\n\t\t\tthis.state.isPressed = false;\n\t\t}\n\t}\n\n\tonKeyDown(e: KeyboardEvent): boolean {\n\t\tif (UtilKeyboardEvent.isActivateKey(e)) {\n\t\t\tthis.onActivateKeyDown(e);\n\t\t}\n\t\treturn super.onKeyDown(e);\n\t}\n\n\tonKeyUp(e: KeyboardEvent): boolean {\n\t\tif (UtilKeyboardEvent.isActivateKey(e)) {\n\t\t\tthis.onActivateKeyUp(e);\n\t\t}\n\t\treturn super.onKeyUp(e);\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DHtmlElement\";\n\t}\n}\n","/*\n * Copyright (C) 2021 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Matrix, Point, Rectangle } from \"pixi.js\";\nimport { DHtmlElement, DHtmlElementOptions, DThemeHtmlElement } from \"./d-html-element\";\nimport { UtilHtmlElementPadding } from \"./util/util-html-element\";\nimport { UtilInput, UtilInputOperation, UtilInputOptions, UtilThemeInput } from \"./util/util-input\";\n\nexport interface DInputOptions<\n\tVALUE = unknown,\n\tELEMENT extends HTMLInputElement | HTMLTextAreaElement = HTMLInputElement | HTMLTextAreaElement,\n\tTHEME extends DThemeInput<VALUE, ELEMENT> = DThemeInput<VALUE, ELEMENT>\n> extends DHtmlElementOptions<VALUE, ELEMENT, THEME>,\n\t\tUtilInputOptions<VALUE, ELEMENT> {}\n\nexport interface DThemeInput<\n\tVALUE = unknown,\n\tELEMENT extends HTMLInputElement | HTMLTextAreaElement = HTMLInputElement | HTMLTextAreaElement\n> extends DThemeHtmlElement<VALUE, ELEMENT>,\n\t\tUtilThemeInput<VALUE, ELEMENT> {}\n\nexport abstract class DInput<\n\tVALUE = unknown,\n\tELEMENT extends HTMLInputElement | HTMLTextAreaElement = HTMLInputElement | HTMLTextAreaElement,\n\tTHEME extends DThemeInput<VALUE, ELEMENT> = DThemeInput<VALUE, ELEMENT>,\n\tOPTIONS extends DInputOptions<VALUE, ELEMENT, THEME> = DInputOptions<VALUE, ELEMENT, THEME>,\n\tUTIL extends UtilInput<VALUE, ELEMENT> = UtilInput<VALUE, ELEMENT>\n> extends DHtmlElement<VALUE, ELEMENT, THEME, OPTIONS, UTIL> {\n\tprotected newOperation(): UtilInputOperation<VALUE, ELEMENT> {\n\t\treturn {\n\t\t\tgetElementRect: (\n\t\t\t\tresolution: number,\n\t\t\t\twork: Point,\n\t\t\t\tresult: Rectangle\n\t\t\t): Rectangle | null => {\n\t\t\t\treturn this.getElementRect(resolution, work, result);\n\t\t\t},\n\n\t\t\tgetElementMatrix: (): Matrix | null => {\n\t\t\t\treturn null;\n\t\t\t},\n\n\t\t\tgetClipperRect: (\n\t\t\t\tresolution: number,\n\t\t\t\twork: Point,\n\t\t\t\tresult: Rectangle\n\t\t\t): Rectangle | null => {\n\t\t\t\treturn this.getClipperRect(resolution, work, result);\n\t\t\t},\n\n\t\t\tgetPadding: (): UtilHtmlElementPadding | null => {\n\t\t\t\treturn this.padding;\n\t\t\t},\n\n\t\t\tcontainsPoint: (point: Point): boolean => {\n\t\t\t\treturn this.containsPoint(point);\n\t\t\t},\n\n\t\t\tonStart: (): void => {\n\t\t\t\tthis.hideText();\n\t\t\t},\n\n\t\t\tonCancel: (): void => {\n\t\t\t\tthis.showText();\n\t\t\t},\n\n\t\t\tonEnd: (): void => {\n\t\t\t\t// DO NOTHING\n\t\t\t},\n\n\t\t\tgetValue: (): VALUE | undefined => {\n\t\t\t\treturn this._textValueComputed;\n\t\t\t},\n\n\t\t\tonValueInput: (newValue: VALUE): void => {\n\t\t\t\tthis.onValueInput(newValue);\n\t\t\t},\n\n\t\t\tonValueChange: (newValue: VALUE, oldValue: VALUE): void => {\n\t\t\t\tthis.text = newValue;\n\t\t\t\tthis.onValueChange(newValue, oldValue);\n\t\t\t},\n\n\t\t\tonEnter: (): void => {\n\t\t\t\tthis.onEnter();\n\t\t\t},\n\n\t\t\tapplyTitle: (): void => {\n\t\t\t\tthis.applyTitle();\n\t\t\t}\n\t\t};\n\t}\n\n\tget value(): VALUE {\n\t\treturn this._textValueComputed!;\n\t}\n\n\tset value(value: VALUE) {\n\t\tthis.text = value;\n\t}\n\n\tprotected onTextChange(): void {\n\t\tsuper.onTextChange();\n\t\tthis.validate();\n\t}\n\n\tprotected onValueChange(newValue: VALUE, oldValue: VALUE): void {\n\t\tthis.emit(\"change\", newValue, oldValue, this);\n\t}\n\n\tprotected onValueInput(newValue: VALUE): void {\n\t\tthis.emit(\"input\", newValue, this);\n\t}\n\n\tprotected onEnter(): void {\n\t\tthis.emit(\"enter\", this);\n\t}\n\n\tvalidate(): string | null {\n\t\treturn this.getUtil().validate();\n\t}\n\n\tprotected applyTitle(): void {\n\t\tif (!this.getUtil().applyTitle()) {\n\t\t\tsuper.applyTitle();\n\t\t}\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DInput\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DInput, DInputOptions, DThemeInput } from \"./d-input\";\nimport {\n\tUtilInputInput,\n\tUtilInputInputOptions,\n\tUtilThemeInputInput\n} from \"./util/util-input-input\";\n\nexport interface DInputInputOptions<\n\tVALUE = unknown,\n\tTHEME extends DThemeInputInput<VALUE> = DThemeInputInput<VALUE>\n> extends DInputOptions<VALUE, HTMLInputElement, THEME>,\n\t\tUtilInputInputOptions<VALUE> {}\n\nexport interface DThemeInputInput<VALUE>\n\textends DThemeInput<VALUE, HTMLInputElement>,\n\t\tUtilThemeInputInput<VALUE> {}\n\nexport abstract class DInputInput<\n\tVALUE = unknown,\n\tTHEME extends DThemeInputInput<VALUE> = DThemeInputInput<VALUE>,\n\tOPTIONS extends DInputInputOptions<VALUE, THEME> = DInputInputOptions<VALUE, THEME>,\n\tUTIL extends UtilInputInput<VALUE> = UtilInputInput<VALUE>\n> extends DInput<VALUE, HTMLInputElement, THEME, OPTIONS, UTIL> {\n\tprotected getType(): string {\n\t\treturn \"DInputInput\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DInputInput, DInputInputOptions, DThemeInputInput } from \"./d-input-input\";\nimport {\n\tUtilInputNumber,\n\tUtilInputNumberOptions,\n\tUtilThemeInputNumber\n} from \"./util/util-input-number\";\n\nexport interface DInputNumberOptions<THEME extends DThemeInputNumber = DThemeInputNumber>\n\textends DInputInputOptions<number, THEME>,\n\t\tUtilInputNumberOptions {}\n\nexport interface DThemeInputNumber extends DThemeInputInput<number>, UtilThemeInputNumber {}\n\nexport abstract class DInputNumber<\n\tTHEME extends DThemeInputNumber = DThemeInputNumber,\n\tOPTIONS extends DInputNumberOptions<THEME> = DInputNumberOptions<THEME>\n> extends DInputInput<number, THEME, OPTIONS, UtilInputNumber> {\n\tprotected newUtil(): UtilInputNumber {\n\t\treturn new UtilInputNumber(this, this.newOperation(), this.theme, this._options);\n\t}\n\n\tget step(): number | null {\n\t\treturn this.getUtil().step;\n\t}\n\n\tset step(step: number | null) {\n\t\tthis.getUtil().step = step;\n\t}\n\n\tget min(): number | null {\n\t\treturn this.getUtil().min;\n\t}\n\n\tset min(min: number | null) {\n\t\tthis.getUtil().min = min;\n\t}\n\n\tget max(): number | null {\n\t\treturn this.getUtil().max;\n\t}\n\n\tset max(max: number | null) {\n\t\tthis.getUtil().max = max;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DInputNumber, DInputNumberOptions, DThemeInputNumber } from \"./d-input-number\";\n\nexport interface DInputIntegerOptions<THEME extends DThemeInputInteger = DThemeInputInteger>\n\textends DInputNumberOptions<THEME> {}\n\nexport interface DThemeInputInteger extends DThemeInputNumber {}\n\nexport class DInputInteger<\n\tTHEME extends DThemeInputInteger = DThemeInputInteger,\n\tOPTIONS extends DInputIntegerOptions<THEME> = DInputIntegerOptions<THEME>\n> extends DInputNumber<THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DInputInteger\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDialogInput, DDialogInputOptions, DThemeDialogInput } from \"./d-dialog-input\";\nimport { DInputInteger, DInputIntegerOptions } from \"./d-input-integer\";\n\nexport interface DDialogInputIntegerOptions<THEME extends DThemeDialogInputInteger>\n\textends DDialogInputOptions<number, DInputIntegerOptions, THEME> {}\n\nexport interface DThemeDialogInputInteger extends DThemeDialogInput {}\n\nexport class DDialogInputInteger<\n\tTHEME extends DThemeDialogInputInteger = DThemeDialogInputInteger,\n\tOPTIONS extends DDialogInputIntegerOptions<THEME> = DDialogInputIntegerOptions<THEME>\n> extends DDialogInput<number, DInputInteger, DInputIntegerOptions, THEME, OPTIONS> {\n\tprotected newInput(options?: DInputIntegerOptions): DInputInteger {\n\t\tconst result = new DInputInteger(this.toInputOptions(options));\n\t\tresult.on(\"enter\", () => {\n\t\t\tthis.ok();\n\t\t});\n\t\treturn result;\n\t}\n\n\tprotected toInputOptions(options?: DInputIntegerOptions): DInputIntegerOptions {\n\t\tif (options) {\n\t\t\tif (options.weight === undefined) {\n\t\t\t\toptions.weight = 1;\n\t\t\t}\n\t\t\treturn options;\n\t\t}\n\t\treturn {\n\t\t\tweight: 1\n\t\t};\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DDialogInputInteger\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDialogInputInteger } from \"../../d-dialog-input-integer\";\nimport { EShapeActionExpression } from \"./e-shape-action-expression\";\nimport { EShapeActionExpressions } from \"./e-shape-action-expressions\";\nimport { EShapeActionRuntimeOpenDialog } from \"./e-shape-action-runtime-open-dialog\";\nimport { EShapeActionValueOpen } from \"./e-shape-action-value-open\";\n\nexport class EShapeActionRuntimeOpenDialogInteger extends EShapeActionRuntimeOpenDialog<number> {\n\tprotected static DIALOG?: DDialogInputInteger;\n\tprotected initial: EShapeActionExpression<number>;\n\n\tconstructor(value: EShapeActionValueOpen) {\n\t\tsuper(value);\n\t\tthis.initial = EShapeActionExpressions.ofNumber(value.initial);\n\t}\n\n\tprotected open(target: string, initial: number): Promise<number> {\n\t\tlet dialog = EShapeActionRuntimeOpenDialogInteger.DIALOG;\n\t\tif (dialog == null) {\n\t\t\tdialog = new DDialogInputInteger({\n\t\t\t\tlabel: target\n\t\t\t});\n\t\t\tEShapeActionRuntimeOpenDialogInteger.DIALOG = dialog;\n\t\t} else {\n\t\t\tconst label = dialog.label;\n\t\t\tif (label) {\n\t\t\t\tlabel.text = target;\n\t\t\t}\n\t\t}\n\t\tdialog.value = initial;\n\t\treturn dialog.open();\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DInputNumber, DInputNumberOptions, DThemeInputNumber } from \"./d-input-number\";\n\nexport interface DInputRealOptions<THEME extends DThemeInputReal = DThemeInputReal>\n\textends DInputNumberOptions<THEME> {}\n\nexport interface DThemeInputReal extends DThemeInputNumber {}\n\nexport class DInputReal<\n\tTHEME extends DThemeInputReal = DThemeInputReal,\n\tOPTIONS extends DInputRealOptions<THEME> = DInputRealOptions<THEME>\n> extends DInputNumber<THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DInputReal\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDialogInput, DDialogInputOptions, DThemeDialogInput } from \"./d-dialog-input\";\nimport { DInputReal, DInputRealOptions } from \"./d-input-real\";\n\nexport interface DDialogInputRealOptions<THEME extends DThemeDialogInputReal>\n\textends DDialogInputOptions<number, DInputRealOptions, THEME> {}\n\nexport interface DThemeDialogInputReal extends DThemeDialogInput {}\n\nexport class DDialogInputReal<\n\tTHEME extends DThemeDialogInputReal = DThemeDialogInputReal,\n\tOPTIONS extends DDialogInputRealOptions<THEME> = DDialogInputRealOptions<THEME>\n> extends DDialogInput<number, DInputReal, DInputRealOptions, THEME, OPTIONS> {\n\tprotected newInput(options?: DInputRealOptions): DInputReal {\n\t\tconst result = new DInputReal(this.toInputOptions(options));\n\t\tresult.on(\"enter\", () => {\n\t\t\tthis.ok();\n\t\t});\n\t\treturn result;\n\t}\n\n\tprotected toInputOptions(options?: DInputRealOptions): DInputRealOptions | undefined {\n\t\tif (options) {\n\t\t\tif (options.weight === undefined) {\n\t\t\t\toptions.weight = 1;\n\t\t\t}\n\t\t\treturn options;\n\t\t}\n\t\treturn {\n\t\t\tweight: 1\n\t\t};\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DDialogInputReal\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDialogInputReal } from \"../../d-dialog-input-real\";\nimport { EShapeActionExpression } from \"./e-shape-action-expression\";\nimport { EShapeActionExpressions } from \"./e-shape-action-expressions\";\nimport { EShapeActionRuntimeOpenDialog } from \"./e-shape-action-runtime-open-dialog\";\nimport { EShapeActionValueOpen } from \"./e-shape-action-value-open\";\n\nexport class EShapeActionRuntimeOpenDialogReal extends EShapeActionRuntimeOpenDialog<number> {\n\tprotected static DIALOG?: DDialogInputReal;\n\tprotected initial: EShapeActionExpression<number>;\n\n\tconstructor(value: EShapeActionValueOpen) {\n\t\tsuper(value);\n\t\tthis.initial = EShapeActionExpressions.ofNumber(value.initial);\n\t}\n\n\tprotected open(target: string, initial: number): Promise<number> {\n\t\tlet dialog = EShapeActionRuntimeOpenDialogReal.DIALOG;\n\t\tif (dialog == null) {\n\t\t\tdialog = new DDialogInputReal({\n\t\t\t\tlabel: target\n\t\t\t});\n\t\t\tEShapeActionRuntimeOpenDialogReal.DIALOG = dialog;\n\t\t} else {\n\t\t\tconst label = dialog.label;\n\t\t\tif (label) {\n\t\t\t\tlabel.text = target;\n\t\t\t}\n\t\t}\n\t\tdialog.value = initial;\n\t\treturn dialog.open();\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DInputInput, DInputInputOptions, DThemeInputInput } from \"./d-input-input\";\nimport { UtilInputText, UtilInputTextOptions, UtilThemeInputText } from \"./util/util-input-text\";\n\nexport interface DInputTextOptions<THEME extends DThemeInputText = DThemeInputText>\n\textends DInputInputOptions<string, THEME>,\n\t\tUtilInputTextOptions {}\n\nexport interface DThemeInputText extends DThemeInputInput<string>, UtilThemeInputText {}\n\nexport class DInputText<\n\tTHEME extends DThemeInputText = DThemeInputText,\n\tOPTIONS extends DInputTextOptions<THEME> = DInputTextOptions<THEME>\n> extends DInputInput<string, THEME, OPTIONS, UtilInputText> {\n\tprotected newUtil(): UtilInputText {\n\t\treturn new UtilInputText(this, this.newOperation(), this.theme, this._options);\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DInputText\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDialogInput, DDialogInputOptions, DThemeDialogInput } from \"./d-dialog-input\";\nimport { DInputText, DInputTextOptions } from \"./d-input-text\";\n\nexport interface DDialogInputTextOptions<THEME extends DThemeDialogInputText>\n\textends DDialogInputOptions<string, DInputTextOptions, THEME> {}\n\nexport interface DThemeDialogInputText extends DThemeDialogInput {}\n\nexport class DDialogInputText<\n\tTHEME extends DThemeDialogInputText = DThemeDialogInputText,\n\tOPTIONS extends DDialogInputTextOptions<THEME> = DDialogInputTextOptions<THEME>\n> extends DDialogInput<string, DInputText, DInputTextOptions, THEME, OPTIONS> {\n\tprotected newInput(options?: DInputTextOptions): DInputText {\n\t\tconst result = new DInputText(this.toInputOptions(options));\n\t\tresult.on(\"enter\", () => {\n\t\t\tthis.ok();\n\t\t});\n\t\treturn result;\n\t}\n\n\tprotected toInputOptions(options?: DInputTextOptions): DInputTextOptions {\n\t\tif (options) {\n\t\t\tif (options.weight === undefined) {\n\t\t\t\toptions.weight = 1;\n\t\t\t}\n\t\t\treturn options;\n\t\t}\n\t\treturn {\n\t\t\tweight: 1\n\t\t};\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DDialogInputText\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDialogInputText } from \"../../d-dialog-input-text\";\nimport { EShapeActionExpression } from \"./e-shape-action-expression\";\nimport { EShapeActionExpressions } from \"./e-shape-action-expressions\";\nimport { EShapeActionRuntimeOpenDialog } from \"./e-shape-action-runtime-open-dialog\";\nimport { EShapeActionValueOpen } from \"./e-shape-action-value-open\";\n\nexport class EShapeActionRuntimeOpenDialogText extends EShapeActionRuntimeOpenDialog<string> {\n\tprotected static DIALOG?: DDialogInputText;\n\tprotected initial: EShapeActionExpression<string>;\n\n\tconstructor(value: EShapeActionValueOpen) {\n\t\tsuper(value);\n\t\tthis.initial = EShapeActionExpressions.ofString(value.initial);\n\t}\n\n\tprotected open(target: string, initial: string): Promise<string> {\n\t\tlet dialog = EShapeActionRuntimeOpenDialogText.DIALOG;\n\t\tif (dialog == null) {\n\t\t\tdialog = new DDialogInputText({\n\t\t\t\tlabel: target\n\t\t\t});\n\t\t\tEShapeActionRuntimeOpenDialogText.DIALOG = dialog;\n\t\t} else {\n\t\t\tconst label = dialog.label;\n\t\t\tif (label) {\n\t\t\t\tlabel.text = target;\n\t\t\t}\n\t\t}\n\t\tdialog.value = initial;\n\t\treturn dialog.open();\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\nimport { EShapeActionRuntimeOpen } from \"./e-shape-action-runtime-open\";\nimport { EShapeActionRuntimes } from \"./e-shape-action-runtimes\";\nimport { EShapeActionValueOpen } from \"./e-shape-action-value-open\";\n\nexport class EShapeActionRuntimeOpenDiagram extends EShapeActionRuntimeOpen {\n\tconstructor(value: EShapeActionValueOpen) {\n\t\tsuper(value, EShapeRuntimeReset.NONE);\n\t}\n\n\texecute(shape: EShape, runtime: EShapeRuntime, time: number): void {\n\t\tif (this.condition(shape, time)) {\n\t\t\tconst target = this.target(shape, time);\n\t\t\tif (target != null) {\n\t\t\t\tEShapeActionRuntimes.open(shape, target);\n\t\t\t}\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\nimport { EShapeActionRuntimeOpen } from \"./e-shape-action-runtime-open\";\nimport { EShapeActionValueOpen } from \"./e-shape-action-value-open\";\n\nexport class EShapeActionRuntimeOpenPage extends EShapeActionRuntimeOpen {\n\tconstructor(value: EShapeActionValueOpen) {\n\t\tsuper(value, EShapeRuntimeReset.NONE);\n\t}\n\n\texecute(shape: EShape, runtime: EShapeRuntime, time: number): void {\n\t\tif (this.condition(shape, time)) {\n\t\t\tconst target = this.target(shape, time);\n\t\t\tif (target != null) {\n\t\t\t\twindow.open(target);\n\t\t\t}\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\nimport { EShapeActionRuntimeOpen } from \"./e-shape-action-runtime-open\";\nimport { EShapeActionValueOpen } from \"./e-shape-action-value-open\";\n\nexport class EShapeActionRuntimeOpenPageInplace extends EShapeActionRuntimeOpen {\n\tconstructor(value: EShapeActionValueOpen) {\n\t\tsuper(value, EShapeRuntimeReset.NONE);\n\t}\n\n\texecute(shape: EShape, runtime: EShapeRuntime, time: number): void {\n\t\tif (this.condition(shape, time)) {\n\t\t\tconst target = this.target(shape, time);\n\t\t\tif (target != null) {\n\t\t\t\twindow.location.href = target;\n\t\t\t}\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const EShapeActionValueOpenType = {\n\tDIAGRAM: 0,\n\tPAGE: 1,\n\tPAGE_INPLACE: 2,\n\tDIALOG_TEXT: 3,\n\tDIALOG_INTEGER: 4,\n\tDIALOG_REAL: 5,\n\tDIALOG_BOOLEAN: 6,\n\tDIALOG_DATE: 7,\n\tDIALOG_TIME: 8,\n\tDIALOG_DATETIME: 9\n} as const;\n\nexport type EShapeActionValueOpenType =\n\ttypeof EShapeActionValueOpenType[keyof typeof EShapeActionValueOpenType];\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DButton, DButtonOptions, DThemeButton } from \"./d-button\";\n\nexport interface DButtonAmbientOptions<\n\tVALUE = unknown,\n\tTHEME extends DThemeButtonAmbient<VALUE> = DThemeButtonAmbient<VALUE>\n> extends DButtonOptions<VALUE, THEME> {}\n\nexport interface DThemeButtonAmbient<VALUE = unknown> extends DThemeButton<VALUE> {}\n\nexport class DButtonAmbient<\n\tVALUE = unknown,\n\tTHEME extends DThemeButtonAmbient<VALUE> = DThemeButtonAmbient<VALUE>,\n\tOPTIONS extends DButtonAmbientOptions<VALUE, THEME> = DButtonAmbientOptions<VALUE, THEME>\n> extends DButton<VALUE, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DButtonAmbient\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DButtonAmbient, DButtonAmbientOptions, DThemeButtonAmbient } from \"./d-button-ambient\";\n\nexport interface DPickerDatetimeButtonBackOptions<\n\tVALUE = unknown,\n\tTHEME extends DThemePickerDatetimeButtonBack<VALUE> = DThemePickerDatetimeButtonBack<VALUE>\n> extends DButtonAmbientOptions<VALUE, THEME> {}\n\nexport interface DThemePickerDatetimeButtonBack<VALUE = unknown>\n\textends DThemeButtonAmbient<VALUE> {}\n\nexport class DPickerDatetimeButtonBack<\n\tVALUE = unknown,\n\tTHEME extends DThemePickerDatetimeButtonBack<VALUE> = DThemePickerDatetimeButtonBack<VALUE>,\n\tOPTIONS extends DPickerDatetimeButtonBackOptions<\n\t\tVALUE,\n\t\tTHEME\n\t> = DPickerDatetimeButtonBackOptions<VALUE, THEME>\n> extends DButtonAmbient<VALUE, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DPickerDatetimeButtonBack\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DButtonAmbient, DButtonAmbientOptions, DThemeButtonAmbient } from \"./d-button-ambient\";\n\nexport interface DPickerDatetimeButtonDateOptions<\n\tVALUE = unknown,\n\tTHEME extends DThemePickerDatetimeButtonDate<VALUE> = DThemePickerDatetimeButtonDate<VALUE>\n> extends DButtonAmbientOptions<VALUE, THEME> {}\n\nexport interface DThemePickerDatetimeButtonDate<VALUE = unknown>\n\textends DThemeButtonAmbient<VALUE> {}\n\nexport class DPickerDatetimeButtonDate<\n\tVALUE = unknown,\n\tTHEME extends DThemePickerDatetimeButtonDate<VALUE> = DThemePickerDatetimeButtonDate<VALUE>,\n\tOPTIONS extends DPickerDatetimeButtonDateOptions<\n\t\tVALUE,\n\t\tTHEME\n\t> = DPickerDatetimeButtonDateOptions<VALUE, THEME>\n> extends DButtonAmbient<VALUE, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DPickerDatetimeButtonDate\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DButtonAmbient, DButtonAmbientOptions, DThemeButtonAmbient } from \"./d-button-ambient\";\n\nexport interface DPickerDatetimeButtonNextOptions<\n\tVALUE = unknown,\n\tTHEME extends DThemePickerDatetimeButtonNext<VALUE> = DThemePickerDatetimeButtonNext<VALUE>\n> extends DButtonAmbientOptions<VALUE, THEME> {}\n\nexport interface DThemePickerDatetimeButtonNext<VALUE = unknown>\n\textends DThemeButtonAmbient<VALUE> {}\n\nexport class DPickerDatetimeButtonNext<\n\tVALUE = unknown,\n\tTHEME extends DThemePickerDatetimeButtonNext<VALUE> = DThemePickerDatetimeButtonNext<VALUE>,\n\tOPTIONS extends DPickerDatetimeButtonNextOptions<\n\t\tVALUE,\n\t\tTHEME\n\t> = DPickerDatetimeButtonNextOptions<VALUE, THEME>\n> extends DButtonAmbient<VALUE, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DPickerDatetimeButtonNext\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DText, DTextOptions, DThemeText } from \"./d-text\";\n\nexport interface DPickerDatetimeLabelOptions<\n\tTHEME extends DThemePickerDatetimeLabel = DThemePickerDatetimeLabel\n> extends DTextOptions<Date, THEME> {}\n\nexport interface DThemePickerDatetimeLabel extends DThemeText<Date> {}\n\nexport class DPickerDatetimeLabel<\n\tTHEME extends DThemePickerDatetimeLabel = DThemePickerDatetimeLabel,\n\tOPTIONS extends DPickerDatetimeLabelOptions<THEME> = DPickerDatetimeLabelOptions<THEME>\n> extends DText<Date, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DPickerDatetimeLabel\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DText, DTextOptions, DThemeText } from \"./d-text\";\n\nexport interface DPickerDatetimeLabelDateOptions<\n\tVALUE = unknown,\n\tTHEME extends DThemePickerDatetimeLabelDate<VALUE> = DThemePickerDatetimeLabelDate<VALUE>\n> extends DTextOptions<VALUE, THEME> {}\n\nexport interface DThemePickerDatetimeLabelDate<VALUE = unknown> extends DThemeText<VALUE> {}\n\nexport class DPickerDatetimeLabelDate<\n\tVALUE = unknown,\n\tTHEME extends DThemePickerDatetimeLabelDate<VALUE> = DThemePickerDatetimeLabelDate<VALUE>,\n\tOPTIONS extends DPickerDatetimeLabelDateOptions<VALUE, THEME> = DPickerDatetimeLabelDateOptions<\n\t\tVALUE,\n\t\tTHEME\n\t>\n> extends DText<VALUE, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DPickerDatetimeLabelDate\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBase, DBaseOptions, DThemeBase } from \"./d-base\";\n\nexport interface DPickerDatetimeSpaceOptions<\n\tTHEME extends DThemePickerDatetimeSpace = DThemePickerDatetimeSpace\n> extends DBaseOptions<THEME> {}\n\nexport interface DThemePickerDatetimeSpace extends DThemeBase {}\n\nexport class DPickerDatetimeSpace<\n\tTHEME extends DThemePickerDatetimeSpace = DThemePickerDatetimeSpace,\n\tOPTIONS extends DPickerDatetimeSpaceOptions<THEME> = DPickerDatetimeSpaceOptions<THEME>\n> extends DBase<THEME, OPTIONS> {\n\tconstructor(options?: OPTIONS) {\n\t\tsuper(options);\n\t\tthis.renderable = false;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DPickerDatetimeSpace\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nconst DATE = 1;\nconst HOURS = 2;\nconst MINUTES = 4;\nconst SECONDS = 8;\n\nexport const DPickerDatetimeMask = {\n\tNONE: 0,\n\tDATE,\n\tHOURS,\n\tMINUTES,\n\tSECONDS,\n\tTIME: HOURS | MINUTES | SECONDS,\n\tALL: DATE | HOURS | MINUTES | SECONDS\n} as const;\n\nexport type DPickerDatetimeMask = number;\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DPickerDatetimeMask } from \"./d-picker-datetime-mask\";\nimport { DThemes } from \"./theme/d-themes\";\nimport { isNumber } from \"./util/is-number\";\nimport { isString } from \"./util/is-string\";\n\nexport interface DPickerDatetimeMaskOptions {\n\tmask?:\n\t\t| keyof typeof DPickerDatetimeMask\n\t\t| Array<keyof typeof DPickerDatetimeMask>\n\t\t| DPickerDatetimeMask;\n}\n\nexport interface DPickerDatetimeMaskTheme {\n\tgetMask(): DPickerDatetimeMask;\n}\n\nexport class DPickerDatetimeMasks {\n\tstatic from(\n\t\tthemeOrThemeName?: DPickerDatetimeMaskTheme | string,\n\t\toptions?: DPickerDatetimeMaskOptions\n\t): DPickerDatetimeMask {\n\t\tconst mask = options?.mask;\n\t\tif (mask == null) {\n\t\t\tif (isString(themeOrThemeName)) {\n\t\t\t\tconst theme = DThemes.getInstance().get<DPickerDatetimeMaskTheme>(themeOrThemeName);\n\t\t\t\tif (theme != null) {\n\t\t\t\t\treturn theme.getMask();\n\t\t\t\t}\n\t\t\t} else if (themeOrThemeName != null) {\n\t\t\t\treturn themeOrThemeName.getMask();\n\t\t\t}\n\t\t\treturn DPickerDatetimeMask.NONE;\n\t\t} else if (isString(mask)) {\n\t\t\treturn DPickerDatetimeMask[mask];\n\t\t} else if (isNumber(mask)) {\n\t\t\treturn mask;\n\t\t}\n\t\tlet result = DPickerDatetimeMask.NONE;\n\t\tfor (let i = 0, imax = mask.length; i < imax; ++i) {\n\t\t\tresult |= DPickerDatetimeMask[mask[i]];\n\t\t}\n\t\treturn result;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport interface DPickerTimeBoundOptions {\n\tdate?: Date | null;\n\tinclusive?: boolean;\n}\n\nexport class DPickerTimeBound {\n\tprotected _date: Date | null;\n\tprotected _inclusive: boolean;\n\tprotected _onChange: () => void;\n\n\tconstructor(options: DPickerTimeBoundOptions | undefined, onChange: () => void) {\n\t\tthis._date = options?.date ?? null;\n\t\tthis._inclusive = options?.inclusive ?? false;\n\t\tthis._onChange = onChange;\n\t}\n\n\tget date(): Date | null {\n\t\treturn this._date;\n\t}\n\n\tset date(date: Date | null) {\n\t\tif (this._date !== date) {\n\t\t\tthis._date = date;\n\t\t\tthis._onChange();\n\t\t}\n\t}\n\n\tget inclusive(): boolean {\n\t\treturn this._inclusive;\n\t}\n\n\tset inclusive(inclusive: boolean) {\n\t\tif (this._inclusive !== inclusive) {\n\t\t\tthis._inclusive = inclusive;\n\t\t\tthis._onChange();\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DPickerDatetimeMask } from \"./d-picker-datetime-mask\";\nimport { DPickerTimeBound } from \"./d-picker-time-bound\";\nimport { DPickerTimeBoundConstant } from \"./d-picker-time-bound-constant\";\n\nexport interface DPickerTimeBoundHoursParent {\n\tlower: DPickerTimeBound;\n\tupper: DPickerTimeBound;\n\tmask: DPickerDatetimeMask;\n\tconstant: DPickerTimeBoundConstant;\n}\n\nexport class DPickerTimeBoundHours {\n\tprotected _parent: DPickerTimeBoundHoursParent;\n\n\tconstructor(parent: DPickerTimeBoundHoursParent) {\n\t\tthis._parent = parent;\n\t}\n\n\tmin(date: Date): number {\n\t\tconst parent = this._parent;\n\t\tconst lower = parent.lower;\n\t\tconst lowerDate = lower.date;\n\t\tconst constant = parent.constant;\n\t\tif (lowerDate != null) {\n\t\t\tconst mask = parent.mask;\n\t\t\tif (mask & DPickerDatetimeMask.DATE) {\n\t\t\t\tif (lowerDate.getFullYear() < date.getFullYear()) {\n\t\t\t\t\treturn constant.hour.min;\n\t\t\t\t}\n\t\t\t\tif (lowerDate.getMonth() < date.getMonth()) {\n\t\t\t\t\treturn constant.hour.min;\n\t\t\t\t}\n\t\t\t\tif (lowerDate.getDate() < date.getDate()) {\n\t\t\t\t\treturn constant.hour.min;\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst lowerDateHours = lowerDate.getHours();\n\t\t\tif (lower.inclusive) {\n\t\t\t\treturn lowerDateHours;\n\t\t\t} else {\n\t\t\t\tif (mask & DPickerDatetimeMask.SECONDS) {\n\t\t\t\t\tif (lowerDate.getSeconds() < constant.second.max) {\n\t\t\t\t\t\treturn lowerDateHours;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (mask & DPickerDatetimeMask.MINUTES) {\n\t\t\t\t\tif (lowerDate.getMinutes() < constant.minute.max) {\n\t\t\t\t\t\treturn lowerDateHours;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn lowerDateHours + 1;\n\t\t\t}\n\t\t}\n\t\treturn constant.hour.min;\n\t}\n\n\tmax(date: Date): number {\n\t\tconst parent = this._parent;\n\t\tconst upper = parent.upper;\n\t\tconst upperDate = upper.date;\n\t\tconst constant = parent.constant;\n\t\tif (upperDate != null) {\n\t\t\tconst mask = parent.mask;\n\t\t\tif (mask & DPickerDatetimeMask.DATE) {\n\t\t\t\tif (date.getFullYear() < upperDate.getFullYear()) {\n\t\t\t\t\treturn constant.hour.max;\n\t\t\t\t}\n\t\t\t\tif (date.getMonth() < upperDate.getMonth()) {\n\t\t\t\t\treturn constant.hour.max;\n\t\t\t\t}\n\t\t\t\tif (date.getDate() < upperDate.getDate()) {\n\t\t\t\t\treturn constant.hour.max;\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst upperDateHours = upperDate.getHours();\n\t\t\tif (upper.inclusive) {\n\t\t\t\treturn upperDateHours;\n\t\t\t} else {\n\t\t\t\tif (mask & DPickerDatetimeMask.SECONDS) {\n\t\t\t\t\tif (constant.second.min < upperDate.getSeconds()) {\n\t\t\t\t\t\treturn upperDateHours;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (mask & DPickerDatetimeMask.MINUTES) {\n\t\t\t\t\tif (constant.minute.min < upperDate.getMinutes()) {\n\t\t\t\t\t\treturn upperDateHours;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn upperDateHours - 1;\n\t\t\t}\n\t\t}\n\t\treturn constant.hour.max;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DPickerDatetimeMask } from \"./d-picker-datetime-mask\";\nimport { DPickerTimeBound } from \"./d-picker-time-bound\";\nimport { DPickerTimeBoundConstant } from \"./d-picker-time-bound-constant\";\n\nexport interface DPickerTimeBoundMinutesParent {\n\tlower: DPickerTimeBound;\n\tupper: DPickerTimeBound;\n\tmask: DPickerDatetimeMask;\n\tconstant: DPickerTimeBoundConstant;\n}\n\nexport class DPickerTimeBoundMinutes {\n\tprotected _parent: DPickerTimeBoundMinutesParent;\n\n\tconstructor(parent: DPickerTimeBoundMinutesParent) {\n\t\tthis._parent = parent;\n\t}\n\n\tmin(date: Date): number {\n\t\tconst parent = this._parent;\n\t\tconst lower = parent.lower;\n\t\tconst lowerDate = lower.date;\n\t\tconst constant = parent.constant;\n\t\tif (lowerDate != null) {\n\t\t\tconst mask = parent.mask;\n\t\t\tif (mask & DPickerDatetimeMask.DATE) {\n\t\t\t\tif (lowerDate.getFullYear() < date.getFullYear()) {\n\t\t\t\t\treturn constant.minute.min;\n\t\t\t\t}\n\t\t\t\tif (lowerDate.getMonth() < date.getMonth()) {\n\t\t\t\t\treturn constant.minute.min;\n\t\t\t\t}\n\t\t\t\tif (lowerDate.getDate() < date.getDate()) {\n\t\t\t\t\treturn constant.minute.min;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (mask & DPickerDatetimeMask.HOURS) {\n\t\t\t\tif (lowerDate.getHours() < date.getHours()) {\n\t\t\t\t\treturn constant.minute.min;\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst lowerDateMinutes = lowerDate.getMinutes();\n\t\t\tif (lower.inclusive) {\n\t\t\t\treturn lowerDateMinutes;\n\t\t\t} else {\n\t\t\t\tif (mask & DPickerDatetimeMask.SECONDS) {\n\t\t\t\t\tif (lowerDate.getSeconds() < constant.second.max) {\n\t\t\t\t\t\treturn lowerDateMinutes;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn lowerDateMinutes + 1;\n\t\t\t}\n\t\t}\n\t\treturn constant.minute.min;\n\t}\n\n\tmax(date: Date): number {\n\t\tconst parent = this._parent;\n\t\tconst upper = parent.upper;\n\t\tconst upperDate = upper.date;\n\t\tconst constant = parent.constant;\n\t\tif (upperDate != null) {\n\t\t\tconst mask = parent.mask;\n\t\t\tif (mask & DPickerDatetimeMask.DATE) {\n\t\t\t\tif (date.getFullYear() < upperDate.getFullYear()) {\n\t\t\t\t\treturn constant.minute.max;\n\t\t\t\t}\n\t\t\t\tif (date.getMonth() < upperDate.getMonth()) {\n\t\t\t\t\treturn constant.minute.max;\n\t\t\t\t}\n\t\t\t\tif (date.getDate() < upperDate.getDate()) {\n\t\t\t\t\treturn constant.minute.max;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (mask & DPickerDatetimeMask.HOURS) {\n\t\t\t\tif (date.getHours() < upperDate.getHours()) {\n\t\t\t\t\treturn constant.minute.max;\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst upperDateMinutes = upperDate.getMinutes();\n\t\t\tif (upper.inclusive) {\n\t\t\t\treturn upperDateMinutes;\n\t\t\t} else {\n\t\t\t\tif (mask & DPickerDatetimeMask.SECONDS) {\n\t\t\t\t\tif (constant.second.min < upperDate.getSeconds()) {\n\t\t\t\t\t\treturn upperDateMinutes;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn upperDateMinutes - 1;\n\t\t\t}\n\t\t}\n\t\treturn constant.minute.max;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DPickerDatetimeMask } from \"./d-picker-datetime-mask\";\nimport { DPickerTimeBound } from \"./d-picker-time-bound\";\nimport { DPickerTimeBoundConstant } from \"./d-picker-time-bound-constant\";\n\nexport interface DPickerTimeBoundSecondsParent {\n\tlower: DPickerTimeBound;\n\tupper: DPickerTimeBound;\n\tmask: DPickerDatetimeMask;\n\tconstant: DPickerTimeBoundConstant;\n}\n\nexport class DPickerTimeBoundSeconds {\n\tprotected _parent: DPickerTimeBoundSecondsParent;\n\n\tconstructor(parent: DPickerTimeBoundSecondsParent) {\n\t\tthis._parent = parent;\n\t}\n\n\tmin(date: Date): number {\n\t\tconst parent = this._parent;\n\t\tconst lower = parent.lower;\n\t\tconst lowerDate = lower.date;\n\t\tconst constant = parent.constant;\n\t\tif (lowerDate != null) {\n\t\t\tconst mask = parent.mask;\n\t\t\tif (mask & DPickerDatetimeMask.DATE) {\n\t\t\t\tif (lowerDate.getFullYear() < date.getFullYear()) {\n\t\t\t\t\treturn constant.second.min;\n\t\t\t\t}\n\t\t\t\tif (lowerDate.getMonth() < date.getMonth()) {\n\t\t\t\t\treturn constant.second.min;\n\t\t\t\t}\n\t\t\t\tif (lowerDate.getDate() < date.getDate()) {\n\t\t\t\t\treturn constant.second.min;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (mask & DPickerDatetimeMask.HOURS) {\n\t\t\t\tif (lowerDate.getHours() < date.getHours()) {\n\t\t\t\t\treturn constant.second.min;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (mask & DPickerDatetimeMask.MINUTES) {\n\t\t\t\tif (lowerDate.getMinutes() < date.getMinutes()) {\n\t\t\t\t\treturn constant.second.min;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn lowerDate.getSeconds() + (lower.inclusive ? 0 : 1);\n\t\t}\n\t\treturn constant.second.min;\n\t}\n\n\tmax(date: Date): number {\n\t\tconst parent = this._parent;\n\t\tconst upper = parent.upper;\n\t\tconst upperDate = upper.date;\n\t\tconst constant = parent.constant;\n\t\tif (upperDate != null) {\n\t\t\tconst mask = parent.mask;\n\t\t\tif (mask & DPickerDatetimeMask.DATE) {\n\t\t\t\tif (date.getFullYear() < upperDate.getFullYear()) {\n\t\t\t\t\treturn constant.second.max;\n\t\t\t\t}\n\t\t\t\tif (date.getMonth() < upperDate.getMonth()) {\n\t\t\t\t\treturn constant.second.max;\n\t\t\t\t}\n\t\t\t\tif (date.getDate() < upperDate.getDate()) {\n\t\t\t\t\treturn constant.second.max;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (mask & DPickerDatetimeMask.HOURS) {\n\t\t\t\tif (date.getHours() < upperDate.getHours()) {\n\t\t\t\t\treturn constant.second.max;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (mask & DPickerDatetimeMask.MINUTES) {\n\t\t\t\tif (date.getMinutes() < upperDate.getMinutes()) {\n\t\t\t\t\treturn constant.second.max;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn upperDate.getSeconds() - (upper.inclusive ? 0 : 1);\n\t\t}\n\t\treturn constant.second.max;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DPickerDatetimeMask } from \"./d-picker-datetime-mask\";\nimport { DPickerTimeBound, DPickerTimeBoundOptions } from \"./d-picker-time-bound\";\nimport { DPickerTimeBoundConstant } from \"./d-picker-time-bound-constant\";\nimport { DPickerTimeBoundHours } from \"./d-picker-time-bound-hours\";\nimport { DPickerTimeBoundMinutes } from \"./d-picker-time-bound-minutes\";\nimport { DPickerTimeBoundSeconds } from \"./d-picker-time-bound-seconds\";\n\nexport interface DPickerTimeBoundsOptions {\n\tlower?: DPickerTimeBoundOptions;\n\tupper?: DPickerTimeBoundOptions;\n}\n\nexport class DPickerTimeBounds {\n\tlower: DPickerTimeBound;\n\tupper: DPickerTimeBound;\n\tmask: DPickerDatetimeMask;\n\thours: DPickerTimeBoundHours;\n\tminutes: DPickerTimeBoundMinutes;\n\tseconds: DPickerTimeBoundSeconds;\n\tconstant: DPickerTimeBoundConstant;\n\n\tconstructor(options: DPickerTimeBoundsOptions | undefined, onChange: () => void) {\n\t\tthis.constant = this.newConstant();\n\t\tthis.lower = new DPickerTimeBound(options && options.lower, onChange);\n\t\tthis.upper = new DPickerTimeBound(options && options.upper, onChange);\n\t\tthis.mask = DPickerDatetimeMask.ALL;\n\t\tthis.hours = new DPickerTimeBoundHours(this);\n\t\tthis.minutes = new DPickerTimeBoundMinutes(this);\n\t\tthis.seconds = new DPickerTimeBoundSeconds(this);\n\t}\n\n\tnewConstant(): DPickerTimeBoundConstant {\n\t\treturn {\n\t\t\tsecond: {\n\t\t\t\tmin: 0,\n\t\t\t\tmax: 59\n\t\t\t},\n\n\t\t\tminute: {\n\t\t\t\tmin: 0,\n\t\t\t\tmax: 59\n\t\t\t},\n\n\t\t\thour: {\n\t\t\t\tmin: 0,\n\t\t\t\tmax: 23\n\t\t\t}\n\t\t};\n\t}\n\n\tadjust(date: Date): boolean {\n\t\tconst result = this.test(date);\n\t\tif (result < 0) {\n\t\t\tconst lower = this.lower;\n\t\t\tconst lowerDate = lower.date;\n\t\t\tif (lowerDate) {\n\t\t\t\tdate.setTime(lowerDate.getTime());\n\t\t\t\tif (!lower.inclusive) {\n\t\t\t\t\tconst mask = this.mask;\n\t\t\t\t\tif (mask & DPickerDatetimeMask.SECONDS) {\n\t\t\t\t\t\tdate.setSeconds(lowerDate.getSeconds() + 1);\n\t\t\t\t\t} else if (mask & DPickerDatetimeMask.MINUTES) {\n\t\t\t\t\t\tdate.setMinutes(lowerDate.getMinutes() + 1);\n\t\t\t\t\t} else if (mask & DPickerDatetimeMask.HOURS) {\n\t\t\t\t\t\tdate.setHours(lowerDate.getHours() + 1);\n\t\t\t\t\t} else if (mask & DPickerDatetimeMask.DATE) {\n\t\t\t\t\t\tdate.setDate(lowerDate.getDate() + 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t}\n\t\t} else if (0 < result) {\n\t\t\tconst upper = this.upper;\n\t\t\tconst upperDate = upper.date;\n\t\t\tif (upperDate) {\n\t\t\t\tdate.setTime(upperDate.getTime());\n\t\t\t\tif (!upper.inclusive) {\n\t\t\t\t\tconst mask = this.mask;\n\t\t\t\t\tif (mask & DPickerDatetimeMask.SECONDS) {\n\t\t\t\t\t\tdate.setSeconds(upperDate.getSeconds() - 1);\n\t\t\t\t\t} else if (mask & DPickerDatetimeMask.MINUTES) {\n\t\t\t\t\t\tdate.setMinutes(upperDate.getMinutes() - 1);\n\t\t\t\t\t} else if (mask & DPickerDatetimeMask.HOURS) {\n\t\t\t\t\t\tdate.setHours(upperDate.getHours() - 1);\n\t\t\t\t\t} else if (mask & DPickerDatetimeMask.DATE) {\n\t\t\t\t\t\tdate.setDate(upperDate.getDate() - 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tcompare(a: Date, b: Date): number {\n\t\tconst mask = this.mask;\n\t\tif (mask & DPickerDatetimeMask.DATE) {\n\t\t\tconst ay = a.getFullYear();\n\t\t\tconst by = b.getFullYear();\n\t\t\tif (ay !== by) {\n\t\t\t\treturn ay < by ? -1 : +1;\n\t\t\t}\n\n\t\t\tconst am = a.getMonth();\n\t\t\tconst bm = b.getMonth();\n\t\t\tif (am !== bm) {\n\t\t\t\treturn am < bm ? -1 : +1;\n\t\t\t}\n\n\t\t\tconst ad = a.getDate();\n\t\t\tconst bd = b.getDate();\n\t\t\tif (ad !== bd) {\n\t\t\t\treturn ad < bd ? -1 : +1;\n\t\t\t}\n\t\t}\n\t\tif (mask & DPickerDatetimeMask.HOURS) {\n\t\t\tconst ah = a.getHours();\n\t\t\tconst bh = b.getHours();\n\t\t\tif (ah !== bh) {\n\t\t\t\treturn ah < bh ? -1 : +1;\n\t\t\t}\n\t\t}\n\t\tif (mask & DPickerDatetimeMask.MINUTES) {\n\t\t\tconst am = a.getMinutes();\n\t\t\tconst bm = b.getMinutes();\n\t\t\tif (am !== bm) {\n\t\t\t\treturn am < bm ? -1 : +1;\n\t\t\t}\n\t\t}\n\t\tif (mask & DPickerDatetimeMask.SECONDS) {\n\t\t\tconst ad = a.getSeconds();\n\t\t\tconst bd = b.getSeconds();\n\t\t\tif (ad !== bd) {\n\t\t\t\treturn ad < bd ? -1 : +1;\n\t\t\t}\n\t\t}\n\t\treturn 0;\n\t}\n\n\ttest(date: Date): number {\n\t\t// Lower bound\n\t\tconst lower = this.lower;\n\t\tconst lowerDate = lower.date;\n\t\tif (lowerDate != null) {\n\t\t\tconst result = this.compare(lowerDate, date);\n\t\t\tif (lower.inclusive) {\n\t\t\t\treturn result <= 0 ? 0 : -1;\n\t\t\t} else {\n\t\t\t\treturn result < 0 ? 0 : -1;\n\t\t\t}\n\t\t}\n\n\t\t// Upper bound\n\t\tconst upper = this.upper;\n\t\tconst upperDate = upper.date;\n\t\tif (upperDate != null) {\n\t\t\tconst result = this.compare(date, upperDate);\n\t\t\tif (upper.inclusive) {\n\t\t\t\treturn result <= 0 ? 0 : +1;\n\t\t\t} else {\n\t\t\t\treturn result < 0 ? 0 : +1;\n\t\t\t}\n\t\t}\n\n\t\treturn 0;\n\t}\n\n\tcontains(date: Date): boolean {\n\t\treturn this.test(date) === 0;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DisplayObject } from \"pixi.js\";\nimport { DBase, DBaseOptions, DThemeBase } from \"./d-base\";\nimport { DCoordinateSize } from \"./d-coordinate\";\nimport { DInputInteger, DInputIntegerOptions } from \"./d-input-integer\";\nimport { DLayoutHorizontal } from \"./d-layout-horizontal\";\nimport { DLayoutVertical } from \"./d-layout-vertical\";\nimport { DPickerDatetimeMask } from \"./d-picker-datetime-mask\";\nimport { DPickerDatetimeMasks } from \"./d-picker-datetime-masks\";\nimport { DPickerTimeBoundOptions } from \"./d-picker-time-bound\";\nimport { DPickerTimeBounds, DPickerTimeBoundsOptions } from \"./d-picker-time-bounds\";\nimport { DText } from \"./d-text\";\n\nexport interface DPickerTimeOptions<THEME extends DThemePickerTime = DThemePickerTime>\n\textends DBaseOptions<THEME> {\n\tmargin?: number;\n\thours?: DInputIntegerOptions;\n\tminutes?: DInputIntegerOptions;\n\tseconds?: DInputIntegerOptions;\n\tmask?:\n\t\t| keyof typeof DPickerDatetimeMask\n\t\t| Array<keyof typeof DPickerDatetimeMask>\n\t\t| DPickerDatetimeMask;\n\tbounds?: DPickerTimeBoundsOptions;\n}\n\nexport interface DThemePickerTime extends DThemeBase {\n\tgetMargin(): number;\n\tgetHoursOptions(): DInputIntegerOptions;\n\tgetMinutesOptions(): DInputIntegerOptions;\n\tgetSecondsOptions(): DInputIntegerOptions;\n\tgetMask(): DPickerDatetimeMask;\n\tgetLowerBound(): Date | null;\n\tisLowerBoundInclusive(): boolean;\n\tgetUpperBound(): Date | null;\n\tisUpperBoundInclusive(): boolean;\n}\n\nconst toBoundOptions = (\n\toptions: DPickerTimeBoundOptions | undefined,\n\tdefaultDate: Date | null,\n\tdefaultInclusive: boolean\n): DPickerTimeBoundOptions => {\n\tif (options) {\n\t\tconst date = options.date;\n\t\tconst inclusive = options.inclusive;\n\t\treturn {\n\t\t\tdate: date !== undefined ? date : defaultDate,\n\t\t\tinclusive: inclusive !== undefined ? inclusive : defaultInclusive\n\t\t};\n\t}\n\treturn {\n\t\tdate: defaultDate,\n\t\tinclusive: defaultInclusive\n\t};\n};\n\nconst toBoundsOptions = (\n\ttheme: DThemePickerTime,\n\toptions: DPickerTimeBoundsOptions | undefined\n): DPickerTimeBoundsOptions => {\n\tif (options) {\n\t\treturn {\n\t\t\tlower: toBoundOptions(\n\t\t\t\toptions.lower,\n\t\t\t\ttheme.getLowerBound(),\n\t\t\t\ttheme.isLowerBoundInclusive()\n\t\t\t),\n\t\t\tupper: toBoundOptions(\n\t\t\t\toptions.upper,\n\t\t\t\ttheme.getUpperBound(),\n\t\t\t\ttheme.isUpperBoundInclusive()\n\t\t\t)\n\t\t};\n\t}\n\treturn {\n\t\tlower: {\n\t\t\tdate: theme.getLowerBound(),\n\t\t\tinclusive: theme.isLowerBoundInclusive()\n\t\t},\n\t\tupper: {\n\t\t\tdate: theme.getUpperBound(),\n\t\t\tinclusive: theme.isUpperBoundInclusive()\n\t\t}\n\t};\n};\n\nexport class DPickerTime<\n\tTHEME extends DThemePickerTime = DThemePickerTime,\n\tOPTIONS extends DPickerTimeOptions<THEME> = DPickerTimeOptions<THEME>\n> extends DBase<THEME, OPTIONS> {\n\tprotected _dateBounds!: DPickerTimeBounds;\n\tprotected _dateCurrent!: Date;\n\tprotected _dateNew!: Date;\n\tprotected _inputHours!: DInputInteger | null;\n\tprotected _inputMinutes!: DInputInteger | null;\n\tprotected _inputSeconds!: DInputInteger | null;\n\n\tconstructor(options?: OPTIONS) {\n\t\tsuper(options);\n\t\tthis.onNewChange();\n\t}\n\n\tprotected init(options?: OPTIONS): void {\n\t\tsuper.init(options);\n\n\t\tconst theme = this.theme;\n\t\tthis._dateCurrent = new Date();\n\t\tconst dateCurrentTime = this._dateCurrent.getTime();\n\t\tthis._dateNew = new Date(dateCurrentTime);\n\t\tthis._dateBounds = new DPickerTimeBounds(\n\t\t\ttoBoundsOptions(theme, options?.bounds),\n\t\t\t(): void => {\n\t\t\t\tthis.onNewChange();\n\t\t\t}\n\t\t);\n\t\tconst margin = options?.margin ?? theme.getMargin();\n\t\tnew DLayoutVertical({\n\t\t\tparent: this,\n\t\t\tx: \"padding\",\n\t\t\ty: \"padding\",\n\t\t\twidth: \"auto\",\n\t\t\theight: \"auto\",\n\t\t\tmargin,\n\t\t\tchildren: this.newChildren(theme, options, margin)\n\t\t});\n\t}\n\n\tget current(): Date {\n\t\treturn this._dateCurrent;\n\t}\n\n\tset current(dateCurrent: Date) {\n\t\tif (this._dateCurrent.getTime() !== dateCurrent.getTime()) {\n\t\t\tthis._dateCurrent = dateCurrent;\n\t\t}\n\t}\n\n\tget new(): Date {\n\t\treturn this._dateNew;\n\t}\n\n\tset new(dateNew: Date) {\n\t\tif (this._dateNew.getTime() !== dateNew.getTime()) {\n\t\t\tthis._dateNew = dateNew;\n\t\t\tthis.onNewChange();\n\t\t}\n\t}\n\n\tget bounds(): DPickerTimeBounds {\n\t\treturn this._dateBounds;\n\t}\n\n\thasHours(): boolean {\n\t\treturn this._inputHours != null;\n\t}\n\n\thasMinutes(): boolean {\n\t\treturn this._inputMinutes != null;\n\t}\n\n\thasSeconds(): boolean {\n\t\treturn this._inputSeconds != null;\n\t}\n\n\treset(): void {\n\t\tconst currentTime = this._dateCurrent.getTime();\n\t\tthis._dateNew.setTime(currentTime);\n\t\tthis.onReset();\n\t}\n\n\tprotected onReset(): void {\n\t\tthis.onNewChange();\n\t}\n\n\tprotected onNewChange(): void {\n\t\tconst dateNew = this._dateNew;\n\t\tconst dateBounds = this._dateBounds;\n\t\tdateBounds.adjust(this._dateNew);\n\n\t\tconst inputHours = this._inputHours;\n\t\tif (inputHours) {\n\t\t\tconst hours = dateBounds.hours;\n\t\t\tinputHours.value = dateNew.getHours();\n\t\t\tinputHours.min = hours.min(dateNew);\n\t\t\tinputHours.max = hours.max(dateNew);\n\t\t}\n\n\t\tconst inputMinutes = this._inputMinutes;\n\t\tif (inputMinutes) {\n\t\t\tconst minutes = dateBounds.minutes;\n\t\t\tinputMinutes.value = dateNew.getMinutes();\n\t\t\tinputMinutes.min = minutes.min(dateNew);\n\t\t\tinputMinutes.max = minutes.max(dateNew);\n\t\t}\n\n\t\tconst inputSeconds = this._inputSeconds;\n\t\tif (inputSeconds) {\n\t\t\tconst seconds = dateBounds.seconds;\n\t\t\tinputSeconds.value = dateNew.getSeconds();\n\t\t\tinputSeconds.min = seconds.min(dateNew);\n\t\t\tinputSeconds.max = seconds.max(dateNew);\n\t\t}\n\t}\n\n\tprotected newChildren(\n\t\ttheme: THEME,\n\t\toptions: OPTIONS | undefined,\n\t\tmargin: number\n\t): Array<DisplayObject | null> {\n\t\tconst mask = DPickerDatetimeMasks.from(theme, options);\n\t\tthis._dateBounds.mask = mask;\n\t\tthis._inputHours =\n\t\t\tmask & DPickerDatetimeMask.HOURS ? this.newInputHours(theme, options) : null;\n\t\tthis._inputMinutes =\n\t\t\tmask & DPickerDatetimeMask.MINUTES ? this.newInputMinutes(theme, options) : null;\n\t\tthis._inputSeconds =\n\t\t\tmask & DPickerDatetimeMask.SECONDS ? this.newInputSeconds(theme, options) : null;\n\t\treturn [\n\t\t\tthis.newTimeLayout(this._inputHours, this._inputMinutes, this._inputSeconds, margin)\n\t\t];\n\t}\n\n\tprotected newTimeLayout(\n\t\thours: DInputInteger | null,\n\t\tminutes: DInputInteger | null,\n\t\tseconds: DInputInteger | null,\n\t\tmargin: number\n\t): DLayoutHorizontal | null {\n\t\tconst children = this.newTimeLayoutChildren(hours, minutes, seconds);\n\t\tif (0 < children.length) {\n\t\t\treturn new DLayoutHorizontal({\n\t\t\t\twidth: this.getTimeLayoutWidth(),\n\t\t\t\theight: this.getTimeLayoutHeight(),\n\t\t\t\tmargin,\n\t\t\t\tchildren\n\t\t\t});\n\t\t}\n\t\treturn null;\n\t}\n\n\tprotected getTimeLayoutWidth(): DCoordinateSize {\n\t\treturn \"auto\";\n\t}\n\n\tprotected getTimeLayoutHeight(): DCoordinateSize {\n\t\treturn \"auto\";\n\t}\n\n\tprotected newTimeLayoutChildren(\n\t\thours: DInputInteger | null,\n\t\tminutes: DInputInteger | null,\n\t\tseconds: DInputInteger | null\n\t): Array<DisplayObject | null> {\n\t\tconst result = [];\n\t\tif (hours != null) {\n\t\t\tresult.push(hours);\n\t\t}\n\t\tif (minutes != null) {\n\t\t\tif (0 < result.length) {\n\t\t\t\tresult.push(this.newMinuteSeparator());\n\t\t\t}\n\t\t\tresult.push(minutes);\n\t\t}\n\t\tif (seconds != null) {\n\t\t\tif (0 < result.length) {\n\t\t\t\tresult.push(this.newSecondSeparator());\n\t\t\t}\n\t\t\tresult.push(seconds);\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected newMinuteSeparator(): DText | null {\n\t\treturn new DText({\n\t\t\twidth: \"auto\",\n\t\t\ttext: {\n\t\t\t\tvalue: this.getMinuteSeparator()\n\t\t\t}\n\t\t});\n\t}\n\n\tgetMinuteSeparator(): string {\n\t\treturn \":\";\n\t}\n\n\tprotected newSecondSeparator(): DText | null {\n\t\treturn new DText({\n\t\t\twidth: \"auto\",\n\t\t\ttext: {\n\t\t\t\tvalue: this.getSecondSeparator()\n\t\t\t}\n\t\t});\n\t}\n\n\tgetSecondSeparator(): string {\n\t\treturn \":\";\n\t}\n\n\tprotected adjustInputOptions(\n\t\ttheme: THEME,\n\t\toptions: DInputIntegerOptions,\n\t\tmax: number\n\t): DInputIntegerOptions {\n\t\tif (options.step == null) {\n\t\t\toptions.step = 1;\n\t\t}\n\t\tif (options.min == null) {\n\t\t\toptions.min = 0;\n\t\t}\n\t\tif (options.max == null) {\n\t\t\toptions.max = max;\n\t\t}\n\t\treturn options;\n\t}\n\n\tprotected newInputHours(theme: THEME, options?: OPTIONS): DInputInteger | null {\n\t\tconst inputOptions = options?.hours ?? theme.getHoursOptions();\n\t\tconst max = this._dateBounds.constant.hour.max;\n\t\tconst input = new DInputInteger(this.adjustInputOptions(theme, inputOptions, max));\n\t\tinput.on(\"change\", (value: number): void => {\n\t\t\tthis.onHoursChange(value);\n\t\t});\n\t\treturn input;\n\t}\n\n\tprotected onHoursChange(value: number): void {\n\t\tconst dateNew = this._dateNew;\n\t\tdateNew.setHours(value);\n\t\tthis.onNewChange();\n\t}\n\n\tprotected newInputMinutes(theme: THEME, options?: OPTIONS): DInputInteger | null {\n\t\tconst inputOptions = options?.minutes || theme.getMinutesOptions();\n\t\tconst max = this._dateBounds.constant.minute.max;\n\t\tconst input = new DInputInteger(this.adjustInputOptions(theme, inputOptions, max));\n\t\tinput.on(\"change\", (value: number): void => {\n\t\t\tthis.onMinutesChange(value);\n\t\t});\n\t\treturn input;\n\t}\n\n\tprotected onMinutesChange(value: number): void {\n\t\tconst dateNew = this._dateNew;\n\t\tdateNew.setMinutes(value);\n\t\tthis.onNewChange();\n\t}\n\n\tprotected newInputSeconds(theme: THEME, options?: OPTIONS): DInputInteger | null {\n\t\tconst inputOptions = options?.seconds || theme.getSecondsOptions();\n\t\tconst max = this._dateBounds.constant.second.max;\n\t\tconst input = new DInputInteger(this.adjustInputOptions(theme, inputOptions, max));\n\t\tinput.on(\"change\", (value: number): void => {\n\t\t\tthis.onSecondsChange(value);\n\t\t});\n\t\treturn input;\n\t}\n\n\tprotected onSecondsChange(value: number): void {\n\t\tthis._dateNew.setSeconds(value);\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DPickerTime\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DisplayObject } from \"pixi.js\";\nimport { DCoordinateSize } from \"./d-coordinate\";\nimport { DInputIntegerOptions } from \"./d-input-integer\";\nimport { DLayoutHorizontal } from \"./d-layout-horizontal\";\nimport { DLayoutVertical } from \"./d-layout-vertical\";\nimport {\n\tDPickerDatetimeButtonBack,\n\tDPickerDatetimeButtonBackOptions\n} from \"./d-picker-datetime-button-back\";\nimport { DPickerDatetimeButtonDate } from \"./d-picker-datetime-button-date\";\nimport {\n\tDPickerDatetimeButtonNext,\n\tDPickerDatetimeButtonNextOptions\n} from \"./d-picker-datetime-button-next\";\nimport { DPickerDatetimeLabel, DPickerDatetimeLabelOptions } from \"./d-picker-datetime-label\";\nimport { DPickerDatetimeLabelDate } from \"./d-picker-datetime-label-date\";\nimport { DPickerDatetimeSpace } from \"./d-picker-datetime-space\";\nimport { DPickerTime, DPickerTimeOptions, DThemePickerTime } from \"./d-picker-time\";\n\nexport type DPickerDatetimeLabelFormatter = (date: Date) => string;\nexport type DPickerDatetimeDateDecorator = (date: Date, button: DPickerDatetimeButtonDate) => void;\nexport type DPickerDatetimeDayLabels = [string, string, string, string, string, string, string];\n\nexport interface DPickerDatetimeDayOptions {\n\tstart?: number;\n\tlabels?: DPickerDatetimeDayLabels;\n}\n\nexport interface DPickerDatetimeDateOptions {\n\tdecorator?: DPickerDatetimeDateDecorator;\n}\n\nexport interface DPickerDatetimeOptions<THEME extends DThemePickerDatetime = DThemePickerDatetime>\n\textends DPickerTimeOptions<THEME> {\n\tback?: DPickerDatetimeButtonBackOptions | null;\n\tnext?: DPickerDatetimeButtonNextOptions | null;\n\tday?: DPickerDatetimeDayOptions;\n\tlabel?: DPickerDatetimeLabelOptions;\n\tdate?: DPickerDatetimeDateOptions;\n}\n\nexport interface DThemePickerDatetime extends DThemePickerTime {\n\tgetDayLabels(): DPickerDatetimeDayLabels;\n\tgetDayStart(): number;\n\tgetLabelFormatter(): DPickerDatetimeLabelFormatter;\n\tgetDateDecorator(): DPickerDatetimeDateDecorator;\n\tgetBackButtonOptions(): DPickerDatetimeButtonBackOptions | null;\n\tgetNextButtonOptions(): DPickerDatetimeButtonNextOptions | null;\n}\n\nexport class DPickerDatetime<\n\tTHEME extends DThemePickerDatetime = DThemePickerDatetime,\n\tOPTIONS extends DPickerDatetimeOptions<THEME> = DPickerDatetimeOptions<THEME>\n> extends DPickerTime<THEME, OPTIONS> {\n\tprotected _datePage!: Date;\n\tprotected _dateButtons!: Array<DPickerDatetimeSpace | DPickerDatetimeButtonDate>;\n\tprotected _dateDecorator!: DPickerDatetimeDateDecorator;\n\tprotected _label!: DPickerDatetimeLabel;\n\n\tprotected init(options?: OPTIONS): void {\n\t\tsuper.init(options);\n\t\tthis._datePage = new Date(this._dateCurrent.getTime());\n\t}\n\n\tprotected newChildren(\n\t\ttheme: THEME,\n\t\toptions: OPTIONS | undefined,\n\t\tmargin: number\n\t): Array<DisplayObject | null> {\n\t\tthis._dateButtons = this.newDateButtons(theme, options);\n\t\tthis._dateDecorator = options?.date?.decorator ?? theme.getDateDecorator();\n\t\tthis._label = this.newLabel(theme, options);\n\t\tconst result = super.newChildren(theme, options, margin);\n\t\tresult.unshift(\n\t\t\tnew DLayoutHorizontal({\n\t\t\t\twidth: \"100%\",\n\t\t\t\theight: \"auto\",\n\t\t\t\tchildren: [\n\t\t\t\t\tthis.newBackButton(theme, options),\n\t\t\t\t\tthis._label,\n\t\t\t\t\tthis.newNextButton(theme, options)\n\t\t\t\t]\n\t\t\t}),\n\t\t\tnew DLayoutHorizontal({\n\t\t\t\twidth: \"auto\",\n\t\t\t\theight: \"auto\",\n\t\t\t\tmargin,\n\t\t\t\tchildren: this.newDateLabels(theme, options)\n\t\t\t}),\n\t\t\tnew DLayoutVertical({\n\t\t\t\twidth: \"auto\",\n\t\t\t\theight: \"auto\",\n\t\t\t\tmargin,\n\t\t\t\tcolumn: 7,\n\t\t\t\tchildren: this._dateButtons\n\t\t\t})\n\t\t);\n\t\treturn result;\n\t}\n\n\tget page(): Date {\n\t\treturn this._datePage;\n\t}\n\n\tset page(datePage: Date) {\n\t\tif (this._datePage.getTime() !== datePage.getTime()) {\n\t\t\tthis._datePage = datePage;\n\t\t\tthis.onPageChange();\n\t\t}\n\t}\n\n\tprotected onReset(): void {\n\t\tthis._datePage.setTime(this._dateCurrent.getTime());\n\t\tsuper.onReset();\n\t}\n\n\tnext(): void {\n\t\tconst work = this._datePage;\n\t\twork.setFullYear(work.getFullYear(), work.getMonth() + 1, 1);\n\t\twork.setHours(0, 0, 0, 0);\n\t\tthis.onPageChange();\n\t}\n\n\tback(): void {\n\t\tconst work = this._datePage;\n\t\twork.setFullYear(work.getFullYear(), work.getMonth() - 1, 1);\n\t\twork.setHours(0, 0, 0, 0);\n\t\tthis.onPageChange();\n\t}\n\n\tonNewChange(): void {\n\t\tthis._dateBounds.adjust(this._datePage);\n\t\tsuper.onNewChange();\n\t\tthis.onPageChange();\n\t}\n\n\tprotected onPageChange(): void {\n\t\tconst buttons = this._dateButtons;\n\t\tconst bounds = this._dateBounds;\n\t\tconst datePage = this._datePage;\n\t\tconst dateNew = this._dateNew;\n\n\t\tconst tmp = new Date(datePage.getTime());\n\t\ttmp.setDate(1);\n\t\ttmp.setHours(0, 0, 0, 0);\n\n\t\t// Spaces\n\t\tconst theme = this.theme;\n\t\tconst spaceCount = (tmp.getDay() - theme.getDayStart() + 7) % 7;\n\t\tfor (let i = 0; i < spaceCount; ++i) {\n\t\t\tbuttons[i].show();\n\t\t}\n\t\tfor (let i = spaceCount; i < 7; ++i) {\n\t\t\tbuttons[i].hide();\n\t\t}\n\n\t\t// Date buttons\n\t\tconst dateDecorator = this._dateDecorator;\n\t\ttmp.setFullYear(tmp.getFullYear(), tmp.getMonth() + 1, 0);\n\t\tconst dateCount = tmp.getDate();\n\t\tconst dateNewDate =\n\t\t\tdateNew.getFullYear() === tmp.getFullYear() && dateNew.getMonth() === tmp.getMonth()\n\t\t\t\t? dateNew.getDate()\n\t\t\t\t: 0;\n\t\tfor (let i = 0; i < dateCount; ++i) {\n\t\t\ttmp.setDate(i + 1);\n\n\t\t\tconst button = buttons[i + 7];\n\t\t\tbutton.state.isActive = dateNewDate === i + 1;\n\t\t\tbutton.state.isDisabled = !bounds.contains(tmp);\n\t\t\tbutton.show();\n\n\t\t\tdateDecorator(tmp, button as DPickerDatetimeButtonDate);\n\t\t}\n\t\tfor (let i = dateCount; i < 31; ++i) {\n\t\t\tconst button = buttons[i + 7];\n\t\t\tbutton.state.isActive = false;\n\t\t\tbutton.hide();\n\t\t}\n\n\t\t// Label\n\t\ttmp.setTime(datePage.getTime());\n\t\tthis._label.text = tmp;\n\t}\n\n\tprotected adjustInputOptions(\n\t\ttheme: THEME,\n\t\toptions: DInputIntegerOptions,\n\t\tmax: number\n\t): DInputIntegerOptions {\n\t\tif (options.weight == null) {\n\t\t\toptions.weight = 1;\n\t\t}\n\t\treturn super.adjustInputOptions(theme, options, max);\n\t}\n\n\tprotected getTimeLayoutWidth(): DCoordinateSize {\n\t\treturn \"100%\";\n\t}\n\n\tprotected toLabelOptions(\n\t\ttheme: THEME,\n\t\toptions?: DPickerDatetimeOptions\n\t): DPickerDatetimeLabelOptions {\n\t\tconst result = (options && options.label) || {};\n\t\tif (result.weight === undefined) {\n\t\t\tresult.weight = 1;\n\t\t}\n\n\t\tif (result.padding === undefined) {\n\t\t\tresult.padding = 0;\n\t\t}\n\n\t\tconst labelText = (result.text = result.text || {});\n\t\tconst labelTextAlign = (labelText.align = labelText.align || {});\n\t\tif (labelTextAlign.horizontal === undefined) {\n\t\t\tlabelTextAlign.horizontal = \"CENTER\";\n\t\t}\n\n\t\tif (labelText.formatter === undefined) {\n\t\t\tlabelText.formatter = theme.getLabelFormatter();\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected newLabel(theme: THEME, options?: DPickerDatetimeOptions): DPickerDatetimeLabel {\n\t\treturn new DPickerDatetimeLabel(this.toLabelOptions(theme, options));\n\t}\n\n\tprotected newBackButton(theme: THEME, options?: OPTIONS): DPickerDatetimeButtonBack | null {\n\t\tlet buttonOptions = options?.back;\n\t\tif (buttonOptions === undefined) {\n\t\t\tbuttonOptions = theme.getBackButtonOptions();\n\t\t}\n\t\tif (buttonOptions != null) {\n\t\t\tconst button = new DPickerDatetimeButtonBack(buttonOptions);\n\t\t\tbutton.on(\"active\", (): void => {\n\t\t\t\tthis.back();\n\t\t\t});\n\t\t\treturn button;\n\t\t}\n\t\treturn null;\n\t}\n\n\tprotected newNextButton(theme: THEME, options?: OPTIONS): DPickerDatetimeButtonNext | null {\n\t\tlet buttonOptions = options?.next;\n\t\tif (buttonOptions === undefined) {\n\t\t\tbuttonOptions = theme.getNextButtonOptions();\n\t\t}\n\t\tif (buttonOptions != null) {\n\t\t\tconst button = new DPickerDatetimeButtonNext(buttonOptions);\n\t\t\tbutton.on(\"active\", (): void => {\n\t\t\t\tthis.next();\n\t\t\t});\n\t\t\treturn button;\n\t\t}\n\t\treturn null;\n\t}\n\n\tprotected newDateLabels(\n\t\ttheme: THEME,\n\t\toptions: OPTIONS | undefined\n\t): DPickerDatetimeLabelDate[] {\n\t\tconst dateLabels = theme.getDayLabels();\n\t\tconst dayStart = theme.getDayStart();\n\t\tconst result: DPickerDatetimeLabelDate[] = [];\n\t\tfor (let i = 0; i < 7; ++i) {\n\t\t\tconst label = dateLabels[(dayStart + i) % 7];\n\t\t\tresult.push(this.newDateLabel(theme, options, label));\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected newDateLabel(\n\t\ttheme: THEME,\n\t\toptions: OPTIONS | undefined,\n\t\tlabel: string\n\t): DPickerDatetimeLabelDate {\n\t\treturn new DPickerDatetimeLabelDate({\n\t\t\ttext: {\n\t\t\t\tvalue: label\n\t\t\t}\n\t\t});\n\t}\n\n\tprotected newDateButtons(\n\t\ttheme: THEME,\n\t\toptions: OPTIONS | undefined\n\t): Array<DPickerDatetimeSpace | DPickerDatetimeButtonDate> {\n\t\tconst result: Array<DPickerDatetimeSpace | DPickerDatetimeButtonDate> = [];\n\t\tfor (let i = 0; i < 7; ++i) {\n\t\t\tresult.push(this.newSpace(theme, options));\n\t\t}\n\t\tfor (let i = 1; i <= 31; ++i) {\n\t\t\tresult.push(this.newDateButton(theme, options, i));\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected newSpace(theme: THEME, options: OPTIONS | undefined): DPickerDatetimeSpace {\n\t\treturn new DPickerDatetimeSpace();\n\t}\n\n\tprotected newDateButton(\n\t\ttheme: THEME,\n\t\toptions: OPTIONS | undefined,\n\t\tdate: number\n\t): DPickerDatetimeButtonDate {\n\t\treturn new DPickerDatetimeButtonDate({\n\t\t\ttext: {\n\t\t\t\tvalue: String(date)\n\t\t\t},\n\t\t\ton: {\n\t\t\t\tactive: (): void => {\n\t\t\t\t\tthis.onDateButtonClicked(date);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tprotected onDateButtonClicked(date: number): void {\n\t\tconst dateNew = this._dateNew;\n\t\tif (dateNew.getDate() !== date) {\n\t\t\tconst datePage = this._datePage;\n\t\t\tdateNew.setFullYear(datePage.getFullYear());\n\t\t\tdateNew.setMonth(datePage.getMonth());\n\t\t\tdateNew.setDate(date);\n\t\t\tthis.onNewChange();\n\t\t}\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DPickerDatetime\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDialogCommand, DDialogCommandOptions, DThemeDialogCommand } from \"./d-dialog-command\";\nimport { DLayoutVertical } from \"./d-layout-vertical\";\nimport { DPickerDatetime, DPickerDatetimeOptions } from \"./d-picker-datetime\";\n\nexport interface DDialogDatetimeOptions<THEME extends DThemeDialogDatetime = DThemeDialogDatetime>\n\textends DDialogCommandOptions<Date, THEME> {\n\tpicker?: DPickerDatetimeOptions;\n}\n\nexport interface DThemeDialogDatetime extends DThemeDialogCommand {}\n\nexport class DDialogDatetime<\n\tTHEME extends DThemeDialogDatetime = DThemeDialogDatetime,\n\tOPTIONS extends DDialogDatetimeOptions<THEME> = DDialogDatetimeOptions<THEME>\n> extends DDialogCommand<Date, THEME, OPTIONS> {\n\tprotected _picker?: DPickerDatetime;\n\n\tprotected onInit(layout: DLayoutVertical, options?: OPTIONS): void {\n\t\tsuper.onInit(layout, options);\n\t\tlayout.addChild(this.picker);\n\t}\n\n\tget current(): Date {\n\t\treturn this.picker.current;\n\t}\n\n\tset current(dateCurrent: Date) {\n\t\tthis.picker.current = dateCurrent;\n\t}\n\n\tget new(): Date {\n\t\treturn this.picker.new;\n\t}\n\n\tset new(value: Date) {\n\t\tthis.picker.new = value;\n\t}\n\n\tget page(): Date {\n\t\treturn this.picker.new;\n\t}\n\n\tset page(page: Date) {\n\t\tthis.picker.page = page;\n\t}\n\n\tget picker(): DPickerDatetime {\n\t\tlet result = this._picker;\n\t\tif (result == null) {\n\t\t\tresult = new DPickerDatetime(this._options?.picker);\n\t\t\tthis._picker = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected getResolvedValue(): Date | PromiseLike<Date> {\n\t\treturn this.picker.new;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DDialogDatetime\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDialogDatetime } from \"../../d-dialog-datetime\";\nimport { isNumber } from \"../../util/is-number\";\nimport { isString } from \"../../util/is-string\";\nimport { EShapeActionExpression } from \"./e-shape-action-expression\";\nimport { EShapeActionExpressions } from \"./e-shape-action-expressions\";\nimport { EShapeActionRuntimeOpenDialog } from \"./e-shape-action-runtime-open-dialog\";\nimport { EShapeActionValueOpen } from \"./e-shape-action-value-open\";\n\nexport class EShapeActionRuntimeOpenDialogDatetime extends EShapeActionRuntimeOpenDialog<\n\tstring,\n\tunknown\n> {\n\tprotected static DIALOG?: DDialogDatetime;\n\n\tprotected initial: EShapeActionExpression<unknown>;\n\n\tconstructor(value: EShapeActionValueOpen) {\n\t\tsuper(value);\n\t\tthis.initial = EShapeActionExpressions.ofUnknown(value.initial);\n\t}\n\n\tprotected open(target: string, initial: unknown): Promise<string> {\n\t\tlet dialog = EShapeActionRuntimeOpenDialogDatetime.DIALOG;\n\t\tif (dialog == null) {\n\t\t\tdialog = new DDialogDatetime();\n\t\t\tEShapeActionRuntimeOpenDialogDatetime.DIALOG = dialog;\n\t\t}\n\t\tdialog.new = dialog.current = this.toDate(initial);\n\t\treturn dialog.open().then((value) => {\n\t\t\treturn value.toISOString();\n\t\t});\n\t}\n\n\tprotected toDate(value: unknown): Date {\n\t\tif (isString(value) || isNumber(value)) {\n\t\t\treturn new Date(value);\n\t\t} else if (value instanceof Date) {\n\t\t\treturn value;\n\t\t} else {\n\t\t\treturn new Date();\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDialogCommand, DDialogCommandOptions, DThemeDialogCommand } from \"./d-dialog-command\";\nimport { DLayoutVertical } from \"./d-layout-vertical\";\nimport { DPickerTime, DPickerTimeOptions } from \"./d-picker-time\";\n\nexport interface DDialogTimeOptions<THEME extends DThemeDialogTime = DThemeDialogTime>\n\textends DDialogCommandOptions<Date, THEME> {\n\tpicker?: DPickerTimeOptions;\n}\n\nexport interface DThemeDialogTime extends DThemeDialogCommand {}\n\nexport class DDialogTime<\n\tTHEME extends DThemeDialogTime = DThemeDialogTime,\n\tOPTIONS extends DDialogTimeOptions<THEME> = DDialogTimeOptions<THEME>\n> extends DDialogCommand<Date, THEME, OPTIONS> {\n\tprotected _picker?: DPickerTime;\n\n\tprotected onInit(layout: DLayoutVertical, options?: OPTIONS): void {\n\t\tsuper.onInit(layout, options);\n\t\tlayout.addChild(this.picker);\n\t}\n\n\tget current(): Date {\n\t\treturn this.picker.current;\n\t}\n\n\tset current(dateCurrent: Date) {\n\t\tthis.picker.current = dateCurrent;\n\t}\n\n\tget new(): Date {\n\t\treturn this.picker.new;\n\t}\n\n\tset new(dateNew: Date) {\n\t\tthis.picker.new = dateNew;\n\t}\n\n\tget picker(): DPickerTime {\n\t\tlet result = this._picker;\n\t\tif (result == null) {\n\t\t\tresult = new DPickerTime(this._options?.picker);\n\t\t\tthis._picker = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected getResolvedValue(): Date | PromiseLike<Date> {\n\t\treturn this.picker.new;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DDialogTime\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const isNaN = (target: number): boolean => {\n\treturn target !== target;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDialogTime } from \"../../d-dialog-time\";\nimport { isNaN } from \"../../util/is-nan\";\nimport { isNumber } from \"../../util/is-number\";\nimport { isString } from \"../../util/is-string\";\nimport { NumberFormatter } from \"../../util/number-formatter\";\nimport { NumberFormatters } from \"../../util/number-formatters\";\nimport { EShapeActionExpression } from \"./e-shape-action-expression\";\nimport { EShapeActionExpressions } from \"./e-shape-action-expressions\";\nimport { EShapeActionRuntimeOpenDialog } from \"./e-shape-action-runtime-open-dialog\";\nimport { EShapeActionValueOpen } from \"./e-shape-action-value-open\";\n\nexport class EShapeActionRuntimeOpenDialogTime extends EShapeActionRuntimeOpenDialog<\n\tstring,\n\tunknown\n> {\n\tprotected static DIALOG?: DDialogTime;\n\tprotected static PATTERN?: RegExp;\n\tprotected static FORMATTER?: NumberFormatter;\n\n\tprotected initial: EShapeActionExpression<unknown>;\n\n\tconstructor(value: EShapeActionValueOpen) {\n\t\tsuper(value);\n\t\tthis.initial = EShapeActionExpressions.ofUnknown(value.initial);\n\t}\n\n\tprotected open(target: string, initial: unknown): Promise<string> {\n\t\tlet dialog = EShapeActionRuntimeOpenDialogTime.DIALOG;\n\t\tif (dialog == null) {\n\t\t\tdialog = new DDialogTime();\n\t\t\tEShapeActionRuntimeOpenDialogTime.DIALOG = dialog;\n\t\t}\n\t\tdialog.new = dialog.current = this.toDate(initial);\n\t\treturn dialog.open().then((value) => {\n\t\t\treturn this.getFormatter().format(value.getTime(), 0);\n\t\t});\n\t}\n\n\tprotected toDate(value: unknown): Date {\n\t\tif (isNumber(value)) {\n\t\t\treturn new Date(value);\n\t\t} else if (isString(value)) {\n\t\t\tconst result = new Date();\n\t\t\tconst pattern = this.getPattern();\n\t\t\tconst matched = pattern.exec(value);\n\t\t\tif (matched != null) {\n\t\t\t\tconst hours = this.toHours(matched[1]);\n\t\t\t\tif (hours != null) {\n\t\t\t\t\tresult.setHours(hours);\n\t\t\t\t}\n\t\t\t\tconst minutes = this.toMinutes(matched[2]);\n\t\t\t\tif (minutes != null) {\n\t\t\t\t\tresult.setMinutes(minutes);\n\t\t\t\t}\n\t\t\t\tconst seconds = this.toSeconds(matched[3]);\n\t\t\t\tif (seconds != null) {\n\t\t\t\t\tresult.setSeconds(seconds);\n\t\t\t\t}\n\t\t\t\tconst milliseconds = this.toMilliseconds(matched[4]);\n\t\t\t\tif (milliseconds != null) {\n\t\t\t\t\tresult.setMilliseconds(milliseconds);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn result;\n\t\t} else if (value instanceof Date) {\n\t\t\treturn value;\n\t\t} else {\n\t\t\treturn new Date();\n\t\t}\n\t}\n\n\tprotected toHours(value: string): number | null {\n\t\treturn this.toNumber(value, 0, 23);\n\t}\n\n\tprotected toMinutes(value: string): number | null {\n\t\treturn this.toNumber(value, 0, 59);\n\t}\n\n\tprotected toSeconds(value: string): number | null {\n\t\treturn this.toNumber(value, 0, 59);\n\t}\n\n\tprotected toMilliseconds(value: string): number | null {\n\t\tconst result = this.toNumber(value, 0, 999);\n\t\tif (result != null) {\n\t\t\tconst length = value.length;\n\t\t\tif (length === 1) {\n\t\t\t\treturn result * 100;\n\t\t\t} else if (length === 2) {\n\t\t\t\treturn result * 10;\n\t\t\t} else {\n\t\t\t\treturn result;\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected toNumber(value: string, min: number, max: number): number | null {\n\t\tif (value != null) {\n\t\t\tconst num = +value;\n\t\t\tif (!isNaN(num)) {\n\t\t\t\treturn Math.min(max, Math.max(min, num));\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tprotected getPattern(): RegExp {\n\t\tlet result = EShapeActionRuntimeOpenDialogTime.PATTERN;\n\t\tif (result == null) {\n\t\t\tresult = this.newPattern();\n\t\t\tEShapeActionRuntimeOpenDialogTime.PATTERN = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected newPattern(): RegExp {\n\t\treturn /^\\s*(?:(\\d+)(?::(\\d+)(?::(\\d+))?)?)?(?:\\.(\\d+))?\\s*$/;\n\t}\n\n\tprotected getFormatter(): NumberFormatter {\n\t\tlet result = EShapeActionRuntimeOpenDialogTime.FORMATTER;\n\t\tif (result == null) {\n\t\t\tresult = this.newFormatter();\n\t\t\tEShapeActionRuntimeOpenDialogTime.FORMATTER = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected newFormatter(): NumberFormatter {\n\t\treturn NumberFormatters.create(\"%Hm\");\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DPickerDatetime, DPickerDatetimeOptions, DThemePickerDatetime } from \"./d-picker-datetime\";\n\nexport interface DPickerDateOptions<THEME extends DThemePickerDate = DThemePickerDate>\n\textends DPickerDatetimeOptions<THEME> {}\n\nexport interface DThemePickerDate extends DThemePickerDatetime {}\n\nexport class DPickerDate<\n\tTHEME extends DThemePickerDate = DThemePickerDate,\n\tOPTIONS extends DPickerDateOptions<THEME> = DPickerDateOptions<THEME>\n> extends DPickerDatetime<THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DPickerDate\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDialogCommand, DDialogCommandOptions, DThemeDialogCommand } from \"./d-dialog-command\";\nimport { DLayoutVertical } from \"./d-layout-vertical\";\nimport { DPickerDate, DPickerDateOptions } from \"./d-picker-date\";\n\nexport interface DDialogDateOptions<THEME extends DThemeDialogDate = DThemeDialogDate>\n\textends DDialogCommandOptions<Date, THEME> {\n\tpicker?: DPickerDateOptions;\n}\n\nexport interface DThemeDialogDate extends DThemeDialogCommand {}\n\nexport class DDialogDate<\n\tTHEME extends DThemeDialogDate = DThemeDialogDate,\n\tOPTIONS extends DDialogDateOptions<THEME> = DDialogDateOptions<THEME>\n> extends DDialogCommand<Date, THEME, OPTIONS> {\n\tprotected _picker?: DPickerDate;\n\n\tprotected onInit(layout: DLayoutVertical, options?: OPTIONS): void {\n\t\tsuper.onInit(layout, options);\n\t\tlayout.addChild(this.picker);\n\t}\n\n\tget current(): Date {\n\t\treturn this.picker.current;\n\t}\n\n\tset current(dateCurrent: Date) {\n\t\tthis.picker.current = dateCurrent;\n\t}\n\n\tget new(): Date {\n\t\treturn this.picker.new;\n\t}\n\n\tset new(value: Date) {\n\t\tthis.picker.new = value;\n\t}\n\n\tget page(): Date {\n\t\treturn this.picker.new;\n\t}\n\n\tset page(page: Date) {\n\t\tthis.picker.page = page;\n\t}\n\n\tget picker(): DPickerDate {\n\t\tlet result = this._picker;\n\t\tif (result == null) {\n\t\t\tresult = new DPickerDate(this._options?.picker);\n\t\t\tthis._picker = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected getResolvedValue(): Date | PromiseLike<Date> {\n\t\treturn this.picker.new;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DDialogDate\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDialogDate } from \"../../d-dialog-date\";\nimport { isNumber } from \"../../util/is-number\";\nimport { isString } from \"../../util/is-string\";\nimport { NumberFormatter } from \"../../util/number-formatter\";\nimport { NumberFormatters } from \"../../util/number-formatters\";\nimport { EShapeActionExpression } from \"./e-shape-action-expression\";\nimport { EShapeActionExpressions } from \"./e-shape-action-expressions\";\nimport { EShapeActionRuntimeOpenDialog } from \"./e-shape-action-runtime-open-dialog\";\nimport { EShapeActionValueOpen } from \"./e-shape-action-value-open\";\n\nexport class EShapeActionRuntimeOpenDialogDate extends EShapeActionRuntimeOpenDialog<\n\tstring,\n\tunknown\n> {\n\tprotected static DIALOG?: DDialogDate;\n\tprotected static FORMATTER?: NumberFormatter;\n\n\tprotected initial: EShapeActionExpression<unknown>;\n\n\tconstructor(value: EShapeActionValueOpen) {\n\t\tsuper(value);\n\t\tthis.initial = EShapeActionExpressions.ofUnknown(value.initial);\n\t}\n\n\tprotected open(target: string, initial: unknown): Promise<string> {\n\t\tlet dialog = EShapeActionRuntimeOpenDialogDate.DIALOG;\n\t\tif (dialog == null) {\n\t\t\tdialog = new DDialogDate();\n\t\t\tEShapeActionRuntimeOpenDialogDate.DIALOG = dialog;\n\t\t}\n\t\tdialog.new = dialog.current = this.toDate(initial);\n\t\treturn dialog.open().then((value) => {\n\t\t\treturn this.getFormatter().format(value.getTime(), 0);\n\t\t});\n\t}\n\n\tprotected toDate(value: unknown): Date {\n\t\tif (isString(value) || isNumber(value)) {\n\t\t\treturn new Date(value);\n\t\t} else if (value instanceof Date) {\n\t\t\treturn value;\n\t\t} else {\n\t\t\treturn new Date();\n\t\t}\n\t}\n\n\tprotected getFormatter(): NumberFormatter {\n\t\tlet result = EShapeActionRuntimeOpenDialogDate.FORMATTER;\n\t\tif (result == null) {\n\t\t\tresult = this.newFormatter();\n\t\t\tEShapeActionRuntimeOpenDialogDate.FORMATTER = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected newFormatter(): NumberFormatter {\n\t\treturn NumberFormatters.create(\"%Y-%M-%D\");\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShapeActionRuntimeOpen } from \"./e-shape-action-runtime-open\";\nimport { EShapeActionRuntimeOpenDialogBoolean } from \"./e-shape-action-runtime-open-dialog-boolean\";\nimport { EShapeActionRuntimeOpenDialogInteger } from \"./e-shape-action-runtime-open-dialog-integer\";\nimport { EShapeActionRuntimeOpenDialogReal } from \"./e-shape-action-runtime-open-dialog-real\";\nimport { EShapeActionRuntimeOpenDialogText } from \"./e-shape-action-runtime-open-dialog-text\";\nimport { EShapeActionRuntimeOpenDiagram } from \"./e-shape-action-runtime-open-diagram\";\nimport { EShapeActionRuntimeOpenPage } from \"./e-shape-action-runtime-open-page\";\nimport { EShapeActionRuntimeOpenPageInplace } from \"./e-shape-action-runtime-open-page-inplace\";\nimport { EShapeActionValue } from \"./e-shape-action-value\";\nimport { EShapeActionValueOnInputAction } from \"./e-shape-action-value-on-input-action\";\nimport { EShapeActionValueOpenType } from \"./e-shape-action-value-open-type\";\nimport { EShapeActionValueSubtyped } from \"./e-shape-action-value-subtyped\";\nimport { EShapeActionValueType } from \"./e-shape-action-value-type\";\nimport { EShapeActionValues } from \"./e-shape-action-values\";\nimport { EShapeActionRuntimeOpenDialogDatetime } from \"./e-shape-action-runtime-open-dialog-datetime\";\nimport { EShapeActionRuntimeOpenDialogTime } from \"./e-shape-action-runtime-open-dialog-time\";\nimport { EShapeActionRuntimeOpenDialogDate } from \"./e-shape-action-runtime-open-dialog-date\";\n\nexport type EShapeActionValueOpenSerialized = [\n\ttypeof EShapeActionValueType.OPEN,\n\tnumber,\n\tEShapeActionValueOpenType,\n\tnumber,\n\tEShapeActionValueOnInputAction,\n\tnumber\n];\n\nexport class EShapeActionValueOpen extends EShapeActionValueSubtyped<EShapeActionValueOpenType> {\n\treadonly target: string;\n\treadonly onInputAction: EShapeActionValueOnInputAction;\n\treadonly initial: string;\n\n\tconstructor(\n\t\tsubtype: EShapeActionValueOpenType,\n\t\tcondition: string,\n\t\ttarget: string,\n\t\tonInputAction: EShapeActionValueOnInputAction,\n\t\tinitial: string\n\t) {\n\t\tsuper(EShapeActionValueType.OPEN, condition, subtype);\n\t\tthis.target = target;\n\t\tthis.onInputAction = onInputAction;\n\t\tthis.initial = initial;\n\t}\n\n\tisEquals(value: EShapeActionValue): boolean {\n\t\treturn (\n\t\t\tsuper.isEquals(value) &&\n\t\t\tvalue instanceof EShapeActionValueOpen &&\n\t\t\tthis.target === value.target\n\t\t);\n\t}\n\n\ttoRuntime(): EShapeActionRuntimeOpen {\n\t\tswitch (this.subtype) {\n\t\t\tcase EShapeActionValueOpenType.DIAGRAM:\n\t\t\t\treturn new EShapeActionRuntimeOpenDiagram(this);\n\t\t\tcase EShapeActionValueOpenType.PAGE:\n\t\t\t\treturn new EShapeActionRuntimeOpenPage(this);\n\t\t\tcase EShapeActionValueOpenType.PAGE_INPLACE:\n\t\t\t\treturn new EShapeActionRuntimeOpenPageInplace(this);\n\t\t\tcase EShapeActionValueOpenType.DIALOG_TEXT:\n\t\t\t\treturn new EShapeActionRuntimeOpenDialogText(this);\n\t\t\tcase EShapeActionValueOpenType.DIALOG_INTEGER:\n\t\t\t\treturn new EShapeActionRuntimeOpenDialogInteger(this);\n\t\t\tcase EShapeActionValueOpenType.DIALOG_REAL:\n\t\t\t\treturn new EShapeActionRuntimeOpenDialogReal(this);\n\t\t\tcase EShapeActionValueOpenType.DIALOG_BOOLEAN:\n\t\t\t\treturn new EShapeActionRuntimeOpenDialogBoolean(this);\n\t\t\tcase EShapeActionValueOpenType.DIALOG_DATE:\n\t\t\t\treturn new EShapeActionRuntimeOpenDialogDate(this);\n\t\t\tcase EShapeActionValueOpenType.DIALOG_TIME:\n\t\t\t\treturn new EShapeActionRuntimeOpenDialogTime(this);\n\t\t\tcase EShapeActionValueOpenType.DIALOG_DATETIME:\n\t\t\t\treturn new EShapeActionRuntimeOpenDialogDatetime(this);\n\t\t}\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\tconst conditionId = manager.addResource(this.condition);\n\t\tconst targetId = manager.addResource(this.target);\n\t\tconst initialId = manager.addResource(this.initial);\n\t\treturn manager.addResource(\n\t\t\t`[${this.type},${conditionId},${this.subtype},${targetId},${this.onInputAction},${initialId}]`\n\t\t);\n\t}\n\n\tstatic deserialize(\n\t\tserialized: EShapeActionValueOpenSerialized,\n\t\tmanager: EShapeResourceManagerDeserialization\n\t): EShapeActionValueOpen {\n\t\tconst condition = EShapeActionValues.toResource(1, serialized, manager.resources);\n\t\tconst target = EShapeActionValues.toResource(3, serialized, manager.resources);\n\t\tconst initial = EShapeActionValues.toResource(5, serialized, manager.resources);\n\t\treturn new EShapeActionValueOpen(serialized[2], condition, target, serialized[4], initial);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const EShapeActionValueShowHideType = {\n\tSHOW: 0,\n\tHIDE: 1\n} as const;\n\nexport type EShapeActionValueShowHideType =\n\ttypeof EShapeActionValueShowHideType[keyof typeof EShapeActionValueShowHideType];\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\nimport { EShapeActionRuntimeConditional } from \"./e-shape-action-runtime-conditional\";\nimport { EShapeActionValueShowHide } from \"./e-shape-action-value-show-hide\";\nimport { EShapeActionValueShowHideType } from \"./e-shape-action-value-show-hide-type\";\n\nexport class EShapeActionRuntimeShowHide extends EShapeActionRuntimeConditional {\n\tvisibility: boolean;\n\n\tconstructor(value: EShapeActionValueShowHide) {\n\t\tsuper(value, EShapeRuntimeReset.VISIBILITY);\n\t\tthis.visibility = value.subtype === EShapeActionValueShowHideType.SHOW;\n\t}\n\n\texecute(shape: EShape, runtime: EShapeRuntime, time: number): void {\n\t\tif (this.condition(shape, time)) {\n\t\t\tshape.visible = this.visibility;\n\t\t\truntime.written |= this.reset;\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShapeActionRuntimeShowHide } from \"./e-shape-action-runtime-show-hide\";\nimport { EShapeActionValueShowHideType } from \"./e-shape-action-value-show-hide-type\";\nimport { EShapeActionValueSubtyped } from \"./e-shape-action-value-subtyped\";\nimport { EShapeActionValueType } from \"./e-shape-action-value-type\";\nimport { EShapeActionValues } from \"./e-shape-action-values\";\n\nexport type EShapeActionValueShowHideSerialized = [\n\ttypeof EShapeActionValueType.SHOW_HIDE,\n\tnumber,\n\tEShapeActionValueShowHideType\n];\n\nexport class EShapeActionValueShowHide extends EShapeActionValueSubtyped<EShapeActionValueShowHideType> {\n\tconstructor(subtype: EShapeActionValueShowHideType, condition: string) {\n\t\tsuper(EShapeActionValueType.SHOW_HIDE, condition, subtype);\n\t}\n\n\ttoRuntime(): EShapeActionRuntimeShowHide {\n\t\treturn new EShapeActionRuntimeShowHide(this);\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\tconst conditionId = manager.addResource(this.condition);\n\t\treturn manager.addResource(`[${this.type},${conditionId},${this.subtype}]`);\n\t}\n\n\tstatic deserialize(\n\t\tserialized: EShapeActionValueShowHideSerialized,\n\t\tmanager: EShapeResourceManagerDeserialization\n\t): EShapeActionValueShowHide {\n\t\tconst condition = EShapeActionValues.toResource(1, serialized, manager.resources);\n\t\treturn new EShapeActionValueShowHide(serialized[2], condition);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeRuntimeReset } from \"../e-shape-runtime\";\nimport { EShapeActionExpression } from \"./e-shape-action-expression\";\nimport { EShapeActionExpressions } from \"./e-shape-action-expressions\";\nimport { EShapeActionRuntimeConditional } from \"./e-shape-action-runtime-conditional\";\nimport { EShapeActionValueTransformMove } from \"./e-shape-action-value-transform-move\";\n\nexport class EShapeActionRuntimeTransformMove extends EShapeActionRuntimeConditional {\n\tprotected readonly amount: EShapeActionExpression<number>;\n\n\tconstructor(value: EShapeActionValueTransformMove, reset: EShapeRuntimeReset) {\n\t\tsuper(value, reset);\n\t\tthis.amount = EShapeActionExpressions.ofNumber(value.amount);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\nimport { EShapeActionRuntimeTransformMove } from \"./e-shape-action-runtime-transform-move\";\nimport { EShapeActionValueTransformMove } from \"./e-shape-action-value-transform-move\";\n\nexport class EShapeActionRuntimeTransformMoveAbsoluteX extends EShapeActionRuntimeTransformMove {\n\tconstructor(value: EShapeActionValueTransformMove) {\n\t\tsuper(value, EShapeRuntimeReset.POSITION_X);\n\t}\n\n\texecute(shape: EShape, runtime: EShapeRuntime, time: number): void {\n\t\tif (this.condition(shape, time)) {\n\t\t\tconst amount = this.amount(shape, time);\n\t\t\tshape.transform.position.x = amount;\n\t\t\truntime.written |= this.reset;\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\nimport { EShapeActionRuntimeTransformMove } from \"./e-shape-action-runtime-transform-move\";\nimport { EShapeActionValueTransformMove } from \"./e-shape-action-value-transform-move\";\n\nexport class EShapeActionRuntimeTransformMoveAbsoluteY extends EShapeActionRuntimeTransformMove {\n\tconstructor(value: EShapeActionValueTransformMove) {\n\t\tsuper(value, EShapeRuntimeReset.POSITION_Y);\n\t}\n\n\texecute(shape: EShape, runtime: EShapeRuntime, time: number): void {\n\t\tif (this.condition(shape, time)) {\n\t\t\tconst amount = this.amount(shape, time);\n\t\t\tshape.transform.position.y = amount;\n\t\t\truntime.written |= this.reset;\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\nimport { EShapeActionRuntimeTransformMove } from \"./e-shape-action-runtime-transform-move\";\nimport { EShapeActionValueTransformMove } from \"./e-shape-action-value-transform-move\";\n\nexport class EShapeActionRuntimeTransformMoveForwardOrBackward extends EShapeActionRuntimeTransformMove {\n\tconstructor(value: EShapeActionValueTransformMove) {\n\t\tsuper(value, EShapeRuntimeReset.POSITION);\n\t}\n\n\texecute(shape: EShape, runtime: EShapeRuntime, time: number): void {\n\t\tif (this.condition(shape, time)) {\n\t\t\tconst amount = this.amount(shape, time);\n\t\t\tconst transform = shape.transform;\n\t\t\tconst position = transform.position;\n\t\t\tconst writtenPositionX = !!(runtime.written & EShapeRuntimeReset.POSITION_X);\n\t\t\tconst writtenPositionY = !!(runtime.written & EShapeRuntimeReset.POSITION_Y);\n\t\t\tconst oldPositionX = writtenPositionX ? position.x : runtime.x;\n\t\t\tconst oldPositionY = writtenPositionY ? position.y : runtime.y;\n\t\t\tshape.updateTransform();\n\t\t\tconst localTransform = transform.localTransform;\n\t\t\tposition.set(\n\t\t\t\toldPositionX - localTransform.c * amount,\n\t\t\t\toldPositionY - localTransform.d * amount\n\t\t\t);\n\t\t\truntime.written |= this.reset;\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\nimport { EShapeActionRuntimeTransformMove } from \"./e-shape-action-runtime-transform-move\";\nimport { EShapeActionValueTransformMove } from \"./e-shape-action-value-transform-move\";\n\nexport class EShapeActionRuntimeTransformMoveLeftOrRight extends EShapeActionRuntimeTransformMove {\n\tconstructor(value: EShapeActionValueTransformMove) {\n\t\tsuper(value, EShapeRuntimeReset.POSITION);\n\t}\n\n\texecute(shape: EShape, runtime: EShapeRuntime, time: number): void {\n\t\tif (this.condition(shape, time)) {\n\t\t\tconst amount = this.amount(shape, time);\n\t\t\tconst transform = shape.transform;\n\t\t\tconst position = transform.position;\n\t\t\tconst writtenPositionX = !!(runtime.written & EShapeRuntimeReset.POSITION_X);\n\t\t\tconst writtenPositionY = !!(runtime.written & EShapeRuntimeReset.POSITION_Y);\n\t\t\tconst oldPositionX = writtenPositionX ? position.x : runtime.x;\n\t\t\tconst oldPositionY = writtenPositionY ? position.y : runtime.y;\n\t\t\tshape.updateTransform();\n\t\t\tconst localTransform = transform.localTransform;\n\t\t\tposition.set(\n\t\t\t\toldPositionX + localTransform.a * amount,\n\t\t\t\toldPositionY + localTransform.b * amount\n\t\t\t);\n\t\t\truntime.written |= this.reset;\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\nimport { EShapeActionRuntimeTransformMove } from \"./e-shape-action-runtime-transform-move\";\nimport { EShapeActionValueTransformMove } from \"./e-shape-action-value-transform-move\";\n\nexport class EShapeActionRuntimeTransformMoveRelativeX extends EShapeActionRuntimeTransformMove {\n\tconstructor(value: EShapeActionValueTransformMove) {\n\t\tsuper(value, EShapeRuntimeReset.POSITION_X);\n\t}\n\n\texecute(shape: EShape, runtime: EShapeRuntime, time: number): void {\n\t\tif (this.condition(shape, time)) {\n\t\t\tconst amount = this.amount(shape, time);\n\t\t\tconst writtenPositionX = !!(runtime.written & EShapeRuntimeReset.POSITION_X);\n\t\t\tconst position = shape.transform.position;\n\t\t\tconst oldPositionX = writtenPositionX ? position.x : runtime.x;\n\t\t\tposition.x = oldPositionX + amount;\n\t\t\truntime.written |= this.reset;\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\nimport { EShapeActionRuntimeTransformMove } from \"./e-shape-action-runtime-transform-move\";\nimport { EShapeActionValueTransformMove } from \"./e-shape-action-value-transform-move\";\n\nexport class EShapeActionRuntimeTransformMoveRelativeY extends EShapeActionRuntimeTransformMove {\n\tconstructor(action: EShapeActionValueTransformMove) {\n\t\tsuper(action, EShapeRuntimeReset.POSITION_Y);\n\t}\n\n\texecute(shape: EShape, runtime: EShapeRuntime, time: number): void {\n\t\tif (this.condition(shape, time)) {\n\t\t\tconst amount = this.amount(shape, time);\n\t\t\tconst writtenPositionY = !!(runtime.written & EShapeRuntimeReset.POSITION_Y);\n\t\t\tconst position = shape.transform.position;\n\t\t\tconst oldPositionY = writtenPositionY ? position.y : runtime.y;\n\t\t\tposition.y = oldPositionY + amount;\n\t\t\truntime.written |= this.reset;\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeActionValue } from \"./e-shape-action-value\";\nimport { EShapeActionValueSubtyped } from \"./e-shape-action-value-subtyped\";\nimport { EShapeActionValueType } from \"./e-shape-action-value-type\";\n\nexport abstract class EShapeActionValueOpetyped<\n\tSUBTYPE extends number,\n\tOPETYPE extends number\n> extends EShapeActionValueSubtyped<SUBTYPE> {\n\treadonly opetype: OPETYPE;\n\n\tconstructor(\n\t\ttype: EShapeActionValueType,\n\t\tcondition: string,\n\t\tsubtype: SUBTYPE,\n\t\topetype: OPETYPE\n\t) {\n\t\tsuper(type, condition, subtype);\n\t\tthis.opetype = opetype;\n\t}\n\n\tisEquals(value: EShapeActionValue): boolean {\n\t\treturn (\n\t\t\tsuper.isEquals(value) &&\n\t\t\tvalue instanceof EShapeActionValueOpetyped &&\n\t\t\tthis.opetype === value.opetype\n\t\t);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const EShapeActionValueTransformMoveType = {\n\tRELATIVE_X: 0,\n\tRELATIVE_Y: 1,\n\tABSOLUTE_X: 2,\n\tABSOLUTE_Y: 3,\n\tFORWARD_OR_BACKWARD: 4,\n\tLEFT_OR_RIGHT: 5\n} as const;\n\nexport type EShapeActionValueTransformMoveType =\n\ttypeof EShapeActionValueTransformMoveType[keyof typeof EShapeActionValueTransformMoveType];\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const EShapeActionValueTransformType = {\n\tRESIZE: 0,\n\tMOVE: 1,\n\tROTATE: 2\n} as const;\n\nexport type EShapeActionValueTransformType =\n\ttypeof EShapeActionValueTransformType[keyof typeof EShapeActionValueTransformType];\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShapeActionRuntimeTransformMove } from \"./e-shape-action-runtime-transform-move\";\nimport { EShapeActionRuntimeTransformMoveAbsoluteX } from \"./e-shape-action-runtime-transform-move-absolute-x\";\nimport { EShapeActionRuntimeTransformMoveAbsoluteY } from \"./e-shape-action-runtime-transform-move-absolute-y\";\nimport { EShapeActionRuntimeTransformMoveForwardOrBackward } from \"./e-shape-action-runtime-transform-move-forward-or-backward\";\nimport { EShapeActionRuntimeTransformMoveLeftOrRight } from \"./e-shape-action-runtime-transform-move-left-or-right\";\nimport { EShapeActionRuntimeTransformMoveRelativeX } from \"./e-shape-action-runtime-transform-move-relative-x\";\nimport { EShapeActionRuntimeTransformMoveRelativeY } from \"./e-shape-action-runtime-transform-move-relative-y\";\nimport { EShapeActionValue } from \"./e-shape-action-value\";\nimport { EShapeActionValueOpetyped } from \"./e-shape-action-value-opetyped\";\nimport { EShapeActionValueTransformMoveType } from \"./e-shape-action-value-transform-move-type\";\nimport { EShapeActionValueTransformType } from \"./e-shape-action-value-transform-type\";\nimport { EShapeActionValueType } from \"./e-shape-action-value-type\";\nimport { EShapeActionValues } from \"./e-shape-action-values\";\n\nexport type EShapeActionValueTransformMoveSerialized = [\n\ttypeof EShapeActionValueType.TRANSFORM,\n\tnumber,\n\ttypeof EShapeActionValueTransformType.MOVE,\n\tEShapeActionValueTransformMoveType,\n\tnumber\n];\n\nexport class EShapeActionValueTransformMove extends EShapeActionValueOpetyped<\n\tEShapeActionValueTransformType,\n\tEShapeActionValueTransformMoveType\n> {\n\treadonly amount: string;\n\n\tconstructor(opetype: EShapeActionValueTransformMoveType, condition: string, amount: string) {\n\t\tsuper(\n\t\t\tEShapeActionValueType.TRANSFORM,\n\t\t\tcondition,\n\t\t\tEShapeActionValueTransformType.MOVE,\n\t\t\topetype\n\t\t);\n\t\tthis.amount = amount;\n\t}\n\n\tisEquals(value: EShapeActionValue): boolean {\n\t\treturn (\n\t\t\tsuper.isEquals(value) &&\n\t\t\tvalue instanceof EShapeActionValueTransformMove &&\n\t\t\tthis.amount === value.amount\n\t\t);\n\t}\n\n\ttoRuntime(): EShapeActionRuntimeTransformMove {\n\t\tswitch (this.opetype) {\n\t\t\tcase EShapeActionValueTransformMoveType.ABSOLUTE_X:\n\t\t\t\treturn new EShapeActionRuntimeTransformMoveAbsoluteX(this);\n\t\t\tcase EShapeActionValueTransformMoveType.ABSOLUTE_Y:\n\t\t\t\treturn new EShapeActionRuntimeTransformMoveAbsoluteY(this);\n\t\t\tcase EShapeActionValueTransformMoveType.FORWARD_OR_BACKWARD:\n\t\t\t\treturn new EShapeActionRuntimeTransformMoveForwardOrBackward(this);\n\t\t\tcase EShapeActionValueTransformMoveType.LEFT_OR_RIGHT:\n\t\t\t\treturn new EShapeActionRuntimeTransformMoveLeftOrRight(this);\n\t\t\tcase EShapeActionValueTransformMoveType.RELATIVE_X:\n\t\t\t\treturn new EShapeActionRuntimeTransformMoveRelativeX(this);\n\t\t\tcase EShapeActionValueTransformMoveType.RELATIVE_Y:\n\t\t\t\treturn new EShapeActionRuntimeTransformMoveRelativeY(this);\n\t\t}\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\tconst conditionId = manager.addResource(this.condition);\n\t\tconst amountId = manager.addResource(this.amount);\n\t\treturn manager.addResource(\n\t\t\t`[${this.type},${conditionId},${this.subtype},${this.opetype},${amountId}]`\n\t\t);\n\t}\n\n\tstatic deserialize(\n\t\tserialized: EShapeActionValueTransformMoveSerialized,\n\t\tmanager: EShapeResourceManagerDeserialization\n\t): EShapeActionValueTransformMove {\n\t\tconst condition = EShapeActionValues.toResource(1, serialized, manager.resources);\n\t\tconst amount = EShapeActionValues.toResource(4, serialized, manager.resources);\n\t\treturn new EShapeActionValueTransformMove(serialized[3], condition, amount);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const toSizeNormalized = (size: number): number => {\n\tconst THRESHOLD = 0.001;\n\tif (Math.abs(size) < THRESHOLD) {\n\t\treturn size < 0 ? -THRESHOLD : +THRESHOLD;\n\t}\n\treturn size;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const EShapeActionValueTransformResizeType = {\n\tRELATIVE_SIZE: 0,\n\tRELATIVE_HEIGHT: 1,\n\tRELATIVE_WIDTH: 2,\n\tABSOLUTE_SIZE: 3,\n\tABSOLUTE_HEIGHT: 4,\n\tABSOLUTE_WIDTH: 5\n} as const;\n\nexport type EShapeActionValueTransformResizeType =\n\ttypeof EShapeActionValueTransformResizeType[keyof typeof EShapeActionValueTransformResizeType];\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\nimport { EShapeActionExpression } from \"./e-shape-action-expression\";\nimport { EShapeActionExpressions } from \"./e-shape-action-expressions\";\nimport { EShapeActionRuntimeConditional } from \"./e-shape-action-runtime-conditional\";\nimport { EShapeActionValueTransformResize } from \"./e-shape-action-value-transform-resize\";\nimport { EShapeActionValueTransformResizeType } from \"./e-shape-action-value-transform-resize-type\";\n\nexport class EShapeActionRuntimeTransformResize extends EShapeActionRuntimeConditional {\n\tprotected readonly size: EShapeActionExpression<number>;\n\n\tconstructor(value: EShapeActionValueTransformResize, reset: EShapeRuntimeReset) {\n\t\tsuper(value, reset);\n\t\tswitch (value.opetype) {\n\t\t\tcase EShapeActionValueTransformResizeType.RELATIVE_SIZE:\n\t\t\t\tthis.size = EShapeActionExpressions.ofNumberOrOne(value.amount);\n\t\t\t\tbreak;\n\t\t\tcase EShapeActionValueTransformResizeType.ABSOLUTE_SIZE:\n\t\t\t\tthis.size = EShapeActionExpressions.ofNumberOrOneHundred(value.amount);\n\t\t\t\tbreak;\n\t\t\tcase EShapeActionValueTransformResizeType.RELATIVE_HEIGHT:\n\t\t\t\tthis.size = EShapeActionExpressions.ofNumberOrOne(value.amount);\n\t\t\t\tbreak;\n\t\t\tcase EShapeActionValueTransformResizeType.ABSOLUTE_HEIGHT:\n\t\t\t\tthis.size = EShapeActionExpressions.ofNumberOrOneHundred(value.amount);\n\t\t\t\tbreak;\n\t\t\tcase EShapeActionValueTransformResizeType.RELATIVE_WIDTH:\n\t\t\t\tthis.size = EShapeActionExpressions.ofNumberOrOne(value.amount);\n\t\t\t\tbreak;\n\t\t\tcase EShapeActionValueTransformResizeType.ABSOLUTE_WIDTH:\n\t\t\t\tthis.size = EShapeActionExpressions.ofNumberOrOneHundred(value.amount);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthis.size = EShapeActionExpressions.ONE;\n\t\t}\n\t}\n\n\tprotected adjustPosition(\n\t\tshape: EShape,\n\t\truntime: EShapeRuntime,\n\t\tdsx: number,\n\t\tdsy: number,\n\t\toriginX: number,\n\t\toriginY: number\n\t): void {\n\t\tconst dx = (-0.5 + originX) * dsx;\n\t\tconst dy = (-0.5 + originY) * dsy;\n\t\tshape.updateTransform();\n\t\tconst transform = shape.transform;\n\t\tconst position = transform.position;\n\t\tconst localTransform = transform.localTransform;\n\t\tconst writtenPositionX = !!(runtime.written & EShapeRuntimeReset.POSITION_X);\n\t\tconst writtenPositionY = !!(runtime.written & EShapeRuntimeReset.POSITION_Y);\n\t\tconst oldPositionX = writtenPositionX ? position.x : runtime.x;\n\t\tconst oldPositionY = writtenPositionY ? position.y : runtime.y;\n\t\truntime.written |= EShapeRuntimeReset.POSITION;\n\t\tposition.set(\n\t\t\toldPositionX + dx * localTransform.a + dy * localTransform.c,\n\t\t\toldPositionY + dx * localTransform.b + dy * localTransform.d\n\t\t);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\nimport { toSizeNormalized } from \"../variant/to-size-normalized\";\nimport { EShapeActionRuntimeTransformResize } from \"./e-shape-action-runtime-transform-resize\";\nimport { EShapeActionValueTransformResize } from \"./e-shape-action-value-transform-resize\";\n\nexport class EShapeActionRuntimeTransformResizeHeightAbsolute extends EShapeActionRuntimeTransformResize {\n\tprotected origin: number;\n\n\tconstructor(value: EShapeActionValueTransformResize) {\n\t\tsuper(value, EShapeRuntimeReset.HEIGHT);\n\t\tthis.origin = value.originY;\n\t\tthis.reset |= EShapeRuntimeReset.POSITION;\n\t}\n\n\texecute(shape: EShape, runtime: EShapeRuntime, time: number): void {\n\t\tif (this.condition(shape, time)) {\n\t\t\tconst sizeAbsolute = this.size(shape, time);\n\t\t\tconst size = shape.size;\n\t\t\tconst writtenHeight = !!(runtime.written & EShapeRuntimeReset.HEIGHT);\n\t\t\tconst oldSizeY = writtenHeight ? size.y : runtime.size.y;\n\t\t\tsize.y = toSizeNormalized(sizeAbsolute);\n\t\t\truntime.written |= EShapeRuntimeReset.HEIGHT;\n\t\t\tthis.adjustPosition(shape, runtime, 0, oldSizeY - size.y, 0.5, this.origin);\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\nimport { toSizeNormalized } from \"../variant/to-size-normalized\";\nimport { EShapeActionRuntimeTransformResize } from \"./e-shape-action-runtime-transform-resize\";\nimport { EShapeActionValueTransformResize } from \"./e-shape-action-value-transform-resize\";\n\nexport class EShapeActionRuntimeTransformResizeHeightRelative extends EShapeActionRuntimeTransformResize {\n\tprotected origin: number;\n\n\tconstructor(value: EShapeActionValueTransformResize) {\n\t\tsuper(value, EShapeRuntimeReset.HEIGHT);\n\t\tthis.origin = value.originY;\n\t\tthis.reset |= EShapeRuntimeReset.POSITION;\n\t}\n\n\texecute(shape: EShape, runtime: EShapeRuntime, time: number): void {\n\t\tif (this.condition(shape, time)) {\n\t\t\tconst sizeRelative = this.size(shape, time);\n\t\t\tconst size = shape.size;\n\t\t\tconst writtenHeight = !!(runtime.written & EShapeRuntimeReset.HEIGHT);\n\t\t\tconst oldSizeY = writtenHeight ? size.y : runtime.size.y;\n\t\t\tsize.y = toSizeNormalized(oldSizeY * sizeRelative);\n\t\t\truntime.written |= EShapeRuntimeReset.HEIGHT;\n\t\t\tthis.adjustPosition(shape, runtime, 0, oldSizeY - size.y, 0.5, this.origin);\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\nimport { toSizeNormalized } from \"../variant/to-size-normalized\";\nimport { EShapeActionRuntimeTransformResize } from \"./e-shape-action-runtime-transform-resize\";\nimport { EShapeActionValueTransformResize } from \"./e-shape-action-value-transform-resize\";\n\nexport class EShapeActionRuntimeTransformResizeSizeAbsolute extends EShapeActionRuntimeTransformResize {\n\tprotected originX: number;\n\tprotected originY: number;\n\n\tconstructor(value: EShapeActionValueTransformResize) {\n\t\tsuper(value, EShapeRuntimeReset.SIZE);\n\t\tthis.originX = value.originX;\n\t\tthis.originY = value.originY;\n\t\tthis.reset |= EShapeRuntimeReset.POSITION;\n\t}\n\n\texecute(shape: EShape, runtime: EShapeRuntime, time: number): void {\n\t\tif (this.condition(shape, time)) {\n\t\t\tconst sizeAbsolute = toSizeNormalized(this.size(shape, time));\n\t\t\tconst size = shape.size;\n\t\t\tconst writtenWidth = !!(runtime.written & EShapeRuntimeReset.WIDTH);\n\t\t\tconst writtenHeight = !!(runtime.written & EShapeRuntimeReset.HEIGHT);\n\t\t\tconst oldSizeX = writtenWidth ? size.x : runtime.size.x;\n\t\t\tconst oldSizeY = writtenHeight ? size.y : runtime.size.y;\n\t\t\tsize.set(sizeAbsolute, sizeAbsolute);\n\t\t\truntime.written |= EShapeRuntimeReset.SIZE;\n\t\t\tthis.adjustPosition(\n\t\t\t\tshape,\n\t\t\t\truntime,\n\t\t\t\toldSizeX - size.x,\n\t\t\t\toldSizeY - size.y,\n\t\t\t\tthis.originX,\n\t\t\t\tthis.originY\n\t\t\t);\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\nimport { toSizeNormalized } from \"../variant/to-size-normalized\";\nimport { EShapeActionRuntimeTransformResize } from \"./e-shape-action-runtime-transform-resize\";\nimport { EShapeActionValueTransformResize } from \"./e-shape-action-value-transform-resize\";\n\nexport class EShapeActionRuntimeTransformResizeSizeRelative extends EShapeActionRuntimeTransformResize {\n\tprotected originX: number;\n\tprotected originY: number;\n\n\tconstructor(value: EShapeActionValueTransformResize) {\n\t\tsuper(value, EShapeRuntimeReset.SIZE);\n\t\tthis.originX = value.originX;\n\t\tthis.originY = value.originY;\n\t\tthis.reset |= EShapeRuntimeReset.POSITION;\n\t}\n\n\texecute(shape: EShape, runtime: EShapeRuntime, time: number): void {\n\t\tif (this.condition(shape, time)) {\n\t\t\tconst sizeRelative = this.size(shape, time);\n\t\t\tconst size = shape.size;\n\t\t\tconst writtenWidth = !!(runtime.written & EShapeRuntimeReset.WIDTH);\n\t\t\tconst writtenHeight = !!(runtime.written & EShapeRuntimeReset.HEIGHT);\n\t\t\tconst oldSizeX = writtenWidth ? size.x : runtime.size.x;\n\t\t\tconst oldSizeY = writtenHeight ? size.y : runtime.size.y;\n\t\t\tsize.set(\n\t\t\t\ttoSizeNormalized(oldSizeX * sizeRelative),\n\t\t\t\ttoSizeNormalized(oldSizeY * sizeRelative)\n\t\t\t);\n\t\t\truntime.written |= EShapeRuntimeReset.SIZE;\n\t\t\tthis.adjustPosition(\n\t\t\t\tshape,\n\t\t\t\truntime,\n\t\t\t\toldSizeX - size.x,\n\t\t\t\toldSizeY - size.y,\n\t\t\t\tthis.originX,\n\t\t\t\tthis.originY\n\t\t\t);\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\nimport { toSizeNormalized } from \"../variant/to-size-normalized\";\nimport { EShapeActionRuntimeTransformResize } from \"./e-shape-action-runtime-transform-resize\";\nimport { EShapeActionValueTransformResize } from \"./e-shape-action-value-transform-resize\";\n\nexport class EShapeActionRuntimeTransformResizeWidthAbsolute extends EShapeActionRuntimeTransformResize {\n\tprotected origin: number;\n\n\tconstructor(value: EShapeActionValueTransformResize) {\n\t\tsuper(value, EShapeRuntimeReset.WIDTH);\n\t\tthis.origin = value.originX;\n\t\tthis.reset |= EShapeRuntimeReset.POSITION;\n\t}\n\n\texecute(shape: EShape, runtime: EShapeRuntime, time: number): void {\n\t\tif (this.condition(shape, time)) {\n\t\t\tconst sizeAbsolute = this.size(shape, time);\n\t\t\tconst size = shape.size;\n\t\t\tconst writtenWidth = !!(runtime.written & EShapeRuntimeReset.WIDTH);\n\t\t\tconst oldSizeX = writtenWidth ? size.x : runtime.size.x;\n\t\t\tsize.x = toSizeNormalized(sizeAbsolute);\n\t\t\truntime.written |= EShapeRuntimeReset.WIDTH;\n\t\t\tthis.adjustPosition(shape, runtime, oldSizeX - size.x, 0, this.origin, 0.5);\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\nimport { toSizeNormalized } from \"../variant/to-size-normalized\";\nimport { EShapeActionRuntimeTransformResize } from \"./e-shape-action-runtime-transform-resize\";\nimport { EShapeActionValueTransformResize } from \"./e-shape-action-value-transform-resize\";\n\nexport class EShapeActionRuntimeTransformResizeWidthRelative extends EShapeActionRuntimeTransformResize {\n\tprotected origin: number;\n\n\tconstructor(value: EShapeActionValueTransformResize) {\n\t\tsuper(value, EShapeRuntimeReset.WIDTH);\n\t\tthis.origin = value.originX;\n\t\tthis.reset |= EShapeRuntimeReset.POSITION;\n\t}\n\n\texecute(shape: EShape, runtime: EShapeRuntime, time: number): void {\n\t\tif (this.condition(shape, time)) {\n\t\t\tconst sizeRelative = this.size(shape, time);\n\t\t\tconst size = shape.size;\n\t\t\tconst writtenWidth = !!(runtime.written & EShapeRuntimeReset.WIDTH);\n\t\t\tconst oldSizeX = writtenWidth ? size.x : runtime.size.x;\n\t\t\tsize.x = toSizeNormalized(oldSizeX * sizeRelative);\n\t\t\truntime.written |= EShapeRuntimeReset.WIDTH;\n\t\t\tthis.adjustPosition(shape, runtime, oldSizeX - size.x, 0, this.origin, 0.5);\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShapeActionRuntimeTransformResize } from \"./e-shape-action-runtime-transform-resize\";\nimport { EShapeActionRuntimeTransformResizeHeightAbsolute } from \"./e-shape-action-runtime-transform-resize-height-absolute\";\nimport { EShapeActionRuntimeTransformResizeHeightRelative } from \"./e-shape-action-runtime-transform-resize-height-relative\";\nimport { EShapeActionRuntimeTransformResizeSizeAbsolute } from \"./e-shape-action-runtime-transform-resize-size-absolute\";\nimport { EShapeActionRuntimeTransformResizeSizeRelative } from \"./e-shape-action-runtime-transform-resize-size-relative\";\nimport { EShapeActionRuntimeTransformResizeWidthAbsolute } from \"./e-shape-action-runtime-transform-resize-width-absolute\";\nimport { EShapeActionRuntimeTransformResizeWidthRelative } from \"./e-shape-action-runtime-transform-resize-width-relative\";\nimport { EShapeActionValue } from \"./e-shape-action-value\";\nimport { EShapeActionValueOpetyped } from \"./e-shape-action-value-opetyped\";\nimport { EShapeActionValueTransformResizeType } from \"./e-shape-action-value-transform-resize-type\";\nimport { EShapeActionValueTransformType } from \"./e-shape-action-value-transform-type\";\nimport { EShapeActionValueType } from \"./e-shape-action-value-type\";\nimport { EShapeActionValues } from \"./e-shape-action-values\";\n\nexport type EShapeActionValueTransformResizeSerialized = [\n\ttypeof EShapeActionValueType.TRANSFORM,\n\tnumber,\n\ttypeof EShapeActionValueTransformType.RESIZE,\n\tEShapeActionValueTransformResizeType,\n\tnumber,\n\tnumber,\n\tnumber\n];\n\nexport class EShapeActionValueTransformResize extends EShapeActionValueOpetyped<\n\tEShapeActionValueTransformType,\n\tEShapeActionValueTransformResizeType\n> {\n\treadonly originX: number;\n\treadonly originY: number;\n\treadonly amount: string;\n\n\tconstructor(\n\t\topetype: EShapeActionValueTransformResizeType,\n\t\tcondition: string,\n\t\toriginX: number,\n\t\toriginY: number,\n\t\tamount: string\n\t) {\n\t\tsuper(\n\t\t\tEShapeActionValueType.TRANSFORM,\n\t\t\tcondition,\n\t\t\tEShapeActionValueTransformType.RESIZE,\n\t\t\topetype\n\t\t);\n\t\tthis.originX = originX;\n\t\tthis.originY = originY;\n\t\tthis.amount = amount;\n\t}\n\n\tisEquals(value: EShapeActionValue): boolean {\n\t\treturn (\n\t\t\tsuper.isEquals(value) &&\n\t\t\tvalue instanceof EShapeActionValueTransformResize &&\n\t\t\tthis.originX === value.originX &&\n\t\t\tthis.originY === value.originY &&\n\t\t\tthis.amount === value.amount\n\t\t);\n\t}\n\n\ttoRuntime(): EShapeActionRuntimeTransformResize {\n\t\tswitch (this.opetype) {\n\t\t\tcase EShapeActionValueTransformResizeType.ABSOLUTE_HEIGHT:\n\t\t\t\treturn new EShapeActionRuntimeTransformResizeHeightAbsolute(this);\n\t\t\tcase EShapeActionValueTransformResizeType.ABSOLUTE_WIDTH:\n\t\t\t\treturn new EShapeActionRuntimeTransformResizeWidthAbsolute(this);\n\t\t\tcase EShapeActionValueTransformResizeType.ABSOLUTE_SIZE:\n\t\t\t\treturn new EShapeActionRuntimeTransformResizeSizeAbsolute(this);\n\t\t\tcase EShapeActionValueTransformResizeType.RELATIVE_HEIGHT:\n\t\t\t\treturn new EShapeActionRuntimeTransformResizeHeightRelative(this);\n\t\t\tcase EShapeActionValueTransformResizeType.RELATIVE_WIDTH:\n\t\t\t\treturn new EShapeActionRuntimeTransformResizeWidthRelative(this);\n\t\t\tcase EShapeActionValueTransformResizeType.RELATIVE_SIZE:\n\t\t\t\treturn new EShapeActionRuntimeTransformResizeSizeRelative(this);\n\t\t}\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\tconst conditionId = manager.addResource(this.condition);\n\t\tconst amountId = manager.addResource(this.amount);\n\t\treturn manager.addResource(\n\t\t\t`[${this.type},${conditionId},${this.subtype},${this.opetype},${this.originX},${this.originY},${amountId}]`\n\t\t);\n\t}\n\n\tstatic deserialize(\n\t\tserialized: EShapeActionValueTransformResizeSerialized,\n\t\tmanager: EShapeResourceManagerDeserialization\n\t): EShapeActionValueTransformResize {\n\t\tconst condition = EShapeActionValues.toResource(1, serialized, manager.resources);\n\t\tconst amount = EShapeActionValues.toResource(6, serialized, manager.resources);\n\t\treturn new EShapeActionValueTransformResize(\n\t\t\tserialized[3],\n\t\t\tcondition,\n\t\t\tserialized[4],\n\t\t\tserialized[5],\n\t\t\tamount\n\t\t);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\nimport { EShapeActionExpression } from \"./e-shape-action-expression\";\nimport { EShapeActionExpressions } from \"./e-shape-action-expressions\";\nimport { EShapeActionRuntimeConditional } from \"./e-shape-action-runtime-conditional\";\nimport { EShapeActionValueTransformRotate } from \"./e-shape-action-value-transform-rotate\";\n\nexport class EShapeActionRuntimeTransformRotate extends EShapeActionRuntimeConditional {\n\tprotected originY: number;\n\tprotected originX: number;\n\tprotected readonly amount: EShapeActionExpression<number>;\n\n\tconstructor(value: EShapeActionValueTransformRotate, reset: EShapeRuntimeReset) {\n\t\tsuper(value, reset);\n\t\tthis.originX = value.originX;\n\t\tthis.originY = value.originY;\n\t\tthis.amount = EShapeActionExpressions.ofNumber(`(${value.amount}) * (Math.PI / 180)`);\n\t}\n\n\tprotected adjustPosition(\n\t\tshape: EShape,\n\t\truntime: EShapeRuntime,\n\t\toldRotation: number,\n\t\tnewRotation: number,\n\t\toriginX: number,\n\t\toriginY: number\n\t): void {\n\t\tconst writtenWidth = !!(runtime.written & EShapeRuntimeReset.WIDTH);\n\t\tconst writtenHeight = !!(runtime.written & EShapeRuntimeReset.HEIGHT);\n\t\tconst dx = (-0.5 + originX) * (writtenWidth ? shape.size.x : runtime.size.x);\n\t\tconst dy = (-0.5 + originY) * (writtenHeight ? shape.size.y : runtime.size.y);\n\t\tconst s = Math.sin(oldRotation) - Math.sin(newRotation);\n\t\tconst c = Math.cos(oldRotation) - Math.cos(newRotation);\n\t\tconst position = shape.transform.position;\n\t\tconst writtenPositionX = !!(runtime.written & EShapeRuntimeReset.POSITION_X);\n\t\tconst writtenPositionY = !!(runtime.written & EShapeRuntimeReset.POSITION_Y);\n\t\tconst oldPositionX = writtenPositionX ? position.x : runtime.x;\n\t\tconst oldPositionY = writtenPositionY ? position.y : runtime.y;\n\t\truntime.written |= EShapeRuntimeReset.POSITION;\n\t\tposition.set(oldPositionX + dx * c - dy * s, oldPositionY + dx * s + dy * c);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\nimport { EShapeActionRuntimeTransformRotate } from \"./e-shape-action-runtime-transform-rotate\";\nimport { EShapeActionValueTransformRotate } from \"./e-shape-action-value-transform-rotate\";\n\nexport class EShapeActionRuntimeTransformRotateAbsolute extends EShapeActionRuntimeTransformRotate {\n\tconstructor(value: EShapeActionValueTransformRotate) {\n\t\tsuper(value, EShapeRuntimeReset.ROTATION);\n\t\tthis.reset |= EShapeRuntimeReset.POSITION;\n\t}\n\n\texecute(shape: EShape, runtime: EShapeRuntime, time: number): void {\n\t\tif (this.condition(shape, time)) {\n\t\t\tconst amount = this.amount(shape, time);\n\t\t\tconst transform = shape.transform;\n\t\t\tconst writtenRotation = !!(runtime.written & EShapeRuntimeReset.ROTATION);\n\t\t\tconst oldRotation = writtenRotation ? transform.rotation : runtime.rotation;\n\t\t\ttransform.rotation = amount;\n\t\t\truntime.written |= EShapeRuntimeReset.ROTATION;\n\t\t\tthis.adjustPosition(shape, runtime, oldRotation, amount, this.originX, this.originY);\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\nimport { EShapeActionRuntimeTransformRotate } from \"./e-shape-action-runtime-transform-rotate\";\nimport { EShapeActionValueTransformRotate } from \"./e-shape-action-value-transform-rotate\";\n\nexport class EShapeActionRuntimeTransformRotateRelative extends EShapeActionRuntimeTransformRotate {\n\tconstructor(value: EShapeActionValueTransformRotate) {\n\t\tsuper(value, EShapeRuntimeReset.ROTATION);\n\t\tthis.reset |= EShapeRuntimeReset.POSITION;\n\t}\n\n\texecute(shape: EShape, runtime: EShapeRuntime, time: number): void {\n\t\tif (this.condition(shape, time)) {\n\t\t\tconst amount = this.amount(shape, time);\n\t\t\tconst transform = shape.transform;\n\t\t\tconst writtenRotation = !!(runtime.written & EShapeRuntimeReset.ROTATION);\n\t\t\tconst oldRotation = writtenRotation ? transform.rotation : runtime.rotation;\n\t\t\ttransform.rotation = oldRotation + amount;\n\t\t\truntime.written |= EShapeRuntimeReset.ROTATION;\n\t\t\tthis.adjustPosition(\n\t\t\t\tshape,\n\t\t\t\truntime,\n\t\t\t\toldRotation,\n\t\t\t\ttransform.rotation,\n\t\t\t\tthis.originX,\n\t\t\t\tthis.originY\n\t\t\t);\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const EShapeActionValueTransformRotateType = {\n\tRELATIVE: 0,\n\tABSOLUTE: 1\n} as const;\n\nexport type EShapeActionValueTransformRotateType =\n\ttypeof EShapeActionValueTransformRotateType[keyof typeof EShapeActionValueTransformRotateType];\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShapeActionRuntimeTransformRotate } from \"./e-shape-action-runtime-transform-rotate\";\nimport { EShapeActionRuntimeTransformRotateAbsolute } from \"./e-shape-action-runtime-transform-rotate-absolute\";\nimport { EShapeActionRuntimeTransformRotateRelative } from \"./e-shape-action-runtime-transform-rotate-relative\";\nimport { EShapeActionValue } from \"./e-shape-action-value\";\nimport { EShapeActionValueOpetyped } from \"./e-shape-action-value-opetyped\";\nimport { EShapeActionValueTransformRotateType } from \"./e-shape-action-value-transform-rotate-type\";\nimport { EShapeActionValueTransformType } from \"./e-shape-action-value-transform-type\";\nimport { EShapeActionValueType } from \"./e-shape-action-value-type\";\nimport { EShapeActionValues } from \"./e-shape-action-values\";\n\nexport type EShapeActionValueTransformRotateSerialized = [\n\ttypeof EShapeActionValueType.TRANSFORM,\n\tnumber,\n\ttypeof EShapeActionValueTransformType.ROTATE,\n\tEShapeActionValueTransformRotateType,\n\tnumber,\n\tnumber,\n\tnumber\n];\n\nexport class EShapeActionValueTransformRotate extends EShapeActionValueOpetyped<\n\tEShapeActionValueTransformType,\n\tEShapeActionValueTransformRotateType\n> {\n\treadonly originX: number;\n\treadonly originY: number;\n\treadonly amount: string;\n\n\tconstructor(\n\t\topetype: EShapeActionValueTransformRotateType,\n\t\tcondition: string,\n\t\toriginX: number,\n\t\toriginY: number,\n\t\tamount: string\n\t) {\n\t\tsuper(\n\t\t\tEShapeActionValueType.TRANSFORM,\n\t\t\tcondition,\n\t\t\tEShapeActionValueTransformType.ROTATE,\n\t\t\topetype\n\t\t);\n\t\tthis.originX = originX;\n\t\tthis.originY = originY;\n\t\tthis.amount = amount;\n\t}\n\n\tisEquals(value: EShapeActionValue): boolean {\n\t\treturn (\n\t\t\tsuper.isEquals(value) &&\n\t\t\tvalue instanceof EShapeActionValueTransformRotate &&\n\t\t\tthis.originX === value.originX &&\n\t\t\tthis.originY === value.originY &&\n\t\t\tthis.amount === value.amount\n\t\t);\n\t}\n\n\ttoRuntime(): EShapeActionRuntimeTransformRotate {\n\t\tswitch (this.opetype) {\n\t\t\tcase EShapeActionValueTransformRotateType.ABSOLUTE:\n\t\t\t\treturn new EShapeActionRuntimeTransformRotateAbsolute(this);\n\t\t\tcase EShapeActionValueTransformRotateType.RELATIVE:\n\t\t\t\treturn new EShapeActionRuntimeTransformRotateRelative(this);\n\t\t}\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\tconst conditionId = manager.addResource(this.condition);\n\t\tconst amountId = manager.addResource(this.amount);\n\t\treturn manager.addResource(\n\t\t\t`[${this.type},${conditionId},${this.subtype},${this.opetype},${this.originX},${this.originY},${amountId}]`\n\t\t);\n\t}\n\n\tstatic deserialize(\n\t\tserialized: EShapeActionValueTransformRotateSerialized,\n\t\tmanager: EShapeResourceManagerDeserialization\n\t): EShapeActionValueTransformRotate {\n\t\tconst condition = EShapeActionValues.toResource(1, serialized, manager.resources);\n\t\tconst amount = EShapeActionValues.toResource(6, serialized, manager.resources);\n\t\treturn new EShapeActionValueTransformRotate(\n\t\t\tserialized[3],\n\t\t\tcondition,\n\t\t\tserialized[4],\n\t\t\tserialized[5],\n\t\t\tamount\n\t\t);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { isArray } from \"../../util/is-array\";\nimport { isNumber } from \"../../util/is-number\";\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeActionValue } from \"./e-shape-action-value\";\nimport {\n\tEShapeActionValueBlink,\n\tEShapeActionValueBlinkSerialized\n} from \"./e-shape-action-value-blink\";\nimport {\n\tEShapeActionValueChangeColor,\n\tEShapeActionValueChangeColorSerialized,\n\tEShapeActionValueChangeColorSerializedLegacy\n} from \"./e-shape-action-value-change-color\";\nimport {\n\tEShapeActionValueChangeColorBrightness,\n\tEShapeActionValueChangeColorBrightnessSerialized,\n\tEShapeActionValueChangeColorBrightnessSerializedLegacy\n} from \"./e-shape-action-value-change-color-brightness\";\nimport {\n\tEShapeActionValueChangeColorCode,\n\tEShapeActionValueChangeColorCodeSerialized,\n\tEShapeActionValueChangeColorCodeSerializedLegacy\n} from \"./e-shape-action-value-change-color-code\";\nimport { EShapeActionValueChangeColorTarget } from \"./e-shape-action-value-change-color-target\";\nimport {\n\tEShapeActionValueChangeCursor,\n\tEShapeActionValueChangeCursorSerialized\n} from \"./e-shape-action-value-change-cursor\";\nimport {\n\tEShapeActionValueChangeText,\n\tEShapeActionValueChangeTextSerialized\n} from \"./e-shape-action-value-change-text\";\nimport {\n\tEShapeActionValueEmitEvent,\n\tEShapeActionValueEmitEventSerialized\n} from \"./e-shape-action-value-emit-event\";\nimport {\n\tEShapeActionValueMisc,\n\tEShapeActionValueMiscSerialized\n} from \"./e-shape-action-value-misc\";\nimport {\n\tEShapeActionValueMiscGesture,\n\tEShapeActionValueMiscGestureSerialized\n} from \"./e-shape-action-value-misc-gesture\";\nimport {\n\tEShapeActionValueMiscLayerGesture,\n\tEShapeActionValueMiscLayerGestureSerialized\n} from \"./e-shape-action-value-misc-layer-gesture\";\nimport {\n\tEShapeActionValueMiscLayerShowHide,\n\tEShapeActionValueMiscLayerShowHideSerialized\n} from \"./e-shape-action-value-misc-layer-show-hide\";\nimport { EShapeActionValueMiscType } from \"./e-shape-action-value-misc-type\";\nimport {\n\tEShapeActionValueOpen,\n\tEShapeActionValueOpenSerialized\n} from \"./e-shape-action-value-open\";\nimport {\n\tEShapeActionValueShowHide,\n\tEShapeActionValueShowHideSerialized\n} from \"./e-shape-action-value-show-hide\";\nimport { EShapeActionValueShowHideType } from \"./e-shape-action-value-show-hide-type\";\nimport {\n\tEShapeActionValueTransformMove,\n\tEShapeActionValueTransformMoveSerialized\n} from \"./e-shape-action-value-transform-move\";\nimport {\n\tEShapeActionValueTransformResize,\n\tEShapeActionValueTransformResizeSerialized\n} from \"./e-shape-action-value-transform-resize\";\nimport {\n\tEShapeActionValueTransformRotate,\n\tEShapeActionValueTransformRotateSerialized\n} from \"./e-shape-action-value-transform-rotate\";\nimport { EShapeActionValueTransformType } from \"./e-shape-action-value-transform-type\";\nimport { EShapeActionValueType } from \"./e-shape-action-value-type\";\n\nexport type EShapeActionValueSerialized =\n\t| EShapeActionValueShowHideSerialized\n\t| EShapeActionValueBlinkSerialized\n\t| EShapeActionValueBlinkSerialized\n\t| EShapeActionValueChangeColorSerialized\n\t| EShapeActionValueChangeColorSerializedLegacy\n\t| EShapeActionValueChangeColorCodeSerialized\n\t| EShapeActionValueChangeColorCodeSerializedLegacy\n\t| EShapeActionValueChangeColorBrightnessSerialized\n\t| EShapeActionValueChangeColorBrightnessSerializedLegacy\n\t| EShapeActionValueChangeTextSerialized\n\t| EShapeActionValueChangeCursorSerialized\n\t| EShapeActionValueEmitEventSerialized\n\t| EShapeActionValueOpenSerialized\n\t| EShapeActionValueTransformMoveSerialized\n\t| EShapeActionValueTransformResizeSerialized\n\t| EShapeActionValueTransformRotateSerialized\n\t| EShapeActionValueMiscSerialized\n\t| EShapeActionValueMiscGestureSerialized\n\t| EShapeActionValueMiscLayerGestureSerialized\n\t| EShapeActionValueMiscLayerShowHideSerialized;\n\nconst toSerialized = (resource: string): EShapeActionValueSerialized | null => {\n\ttry {\n\t\tconst parsed = JSON.parse(resource);\n\t\tif (isArray(parsed)) {\n\t\t\tfor (let i = 0, imax = parsed.length; i < imax; ++i) {\n\t\t\t\tif (!isNumber(parsed[i])) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (2 <= parsed.length) {\n\t\t\t\treturn parsed as EShapeActionValueSerialized;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t} catch (e) {\n\t\treturn null;\n\t}\n};\n\nexport const deserializeActionValue = (\n\tid: number,\n\tmanager: EShapeResourceManagerDeserialization\n): EShapeActionValue => {\n\tconst action = manager.getAction(id);\n\tif (action != null) {\n\t\treturn action;\n\t}\n\n\tconst resources = manager.resources;\n\tconst resource = resources[id];\n\tif (resource != null) {\n\t\tconst serialized = toSerialized(resource);\n\t\tif (serialized != null) {\n\t\t\tswitch (serialized[0]) {\n\t\t\t\tcase EShapeActionValueType.SHOW_HIDE:\n\t\t\t\t\treturn EShapeActionValueShowHide.deserialize(serialized, manager);\n\t\t\t\tcase EShapeActionValueType.BLINK:\n\t\t\t\t\treturn EShapeActionValueBlink.deserialize(serialized, manager);\n\t\t\t\tcase EShapeActionValueType.CHANGE_COLOR:\n\t\t\t\tcase EShapeActionValueType.CHANGE_COLOR_LEGACY:\n\t\t\t\t\tswitch (serialized[3]) {\n\t\t\t\t\t\tcase EShapeActionValueChangeColorTarget.COLOR_AND_ALPHA:\n\t\t\t\t\t\tcase EShapeActionValueChangeColorTarget.COLOR:\n\t\t\t\t\t\tcase EShapeActionValueChangeColorTarget.ALPHA:\n\t\t\t\t\t\t\treturn EShapeActionValueChangeColor.deserialize(serialized, manager);\n\t\t\t\t\t\tcase EShapeActionValueChangeColorTarget.CODE:\n\t\t\t\t\t\t\treturn EShapeActionValueChangeColorCode.deserialize(\n\t\t\t\t\t\t\t\tserialized,\n\t\t\t\t\t\t\t\tmanager\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\tcase EShapeActionValueChangeColorTarget.BRIGHTNESS:\n\t\t\t\t\t\t\treturn EShapeActionValueChangeColorBrightness.deserialize(\n\t\t\t\t\t\t\t\tserialized,\n\t\t\t\t\t\t\t\tmanager\n\t\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase EShapeActionValueType.CHANGE_TEXT:\n\t\t\t\t\treturn EShapeActionValueChangeText.deserialize(serialized, manager);\n\t\t\t\tcase EShapeActionValueType.CHANGE_CURSOR:\n\t\t\t\t\treturn EShapeActionValueChangeCursor.deserialize(serialized, manager);\n\t\t\t\tcase EShapeActionValueType.EMIT_EVENT:\n\t\t\t\t\treturn EShapeActionValueEmitEvent.deserialize(serialized, manager);\n\t\t\t\tcase EShapeActionValueType.OPEN:\n\t\t\t\t\treturn EShapeActionValueOpen.deserialize(serialized, manager);\n\t\t\t\tcase EShapeActionValueType.TRANSFORM:\n\t\t\t\t\tswitch (serialized[2]) {\n\t\t\t\t\t\tcase EShapeActionValueTransformType.MOVE:\n\t\t\t\t\t\t\treturn EShapeActionValueTransformMove.deserialize(serialized, manager);\n\t\t\t\t\t\tcase EShapeActionValueTransformType.RESIZE:\n\t\t\t\t\t\t\treturn EShapeActionValueTransformResize.deserialize(\n\t\t\t\t\t\t\t\tserialized,\n\t\t\t\t\t\t\t\tmanager\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\tcase EShapeActionValueTransformType.ROTATE:\n\t\t\t\t\t\t\treturn EShapeActionValueTransformRotate.deserialize(\n\t\t\t\t\t\t\t\tserialized,\n\t\t\t\t\t\t\t\tmanager\n\t\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase EShapeActionValueType.MISC:\n\t\t\t\t\tswitch (serialized[2]) {\n\t\t\t\t\t\tcase EShapeActionValueMiscType.GESTURE:\n\t\t\t\t\t\t\treturn EShapeActionValueMiscGesture.deserialize(serialized, manager);\n\t\t\t\t\t\tcase EShapeActionValueMiscType.LAYER_SHOW_HIDE:\n\t\t\t\t\t\t\treturn EShapeActionValueMiscLayerShowHide.deserialize(\n\t\t\t\t\t\t\t\tserialized,\n\t\t\t\t\t\t\t\tmanager\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\tcase EShapeActionValueMiscType.LAYER_GESTURE:\n\t\t\t\t\t\t\treturn EShapeActionValueMiscLayerGesture.deserialize(\n\t\t\t\t\t\t\t\tserialized,\n\t\t\t\t\t\t\t\tmanager\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\treturn EShapeActionValueMisc.deserialize(serialized, manager);\n\t\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn new EShapeActionValueShowHide(EShapeActionValueShowHideType.SHOW, \"\");\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\nimport { EShape } from \"../e-shape\";\nimport { EShapeDeserializers } from \"../e-shape-deserializers\";\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeType } from \"../e-shape-type\";\n\nexport const deserialize = (\n\titem: DDiagramSerializedItem,\n\tmanager: EShapeResourceManagerDeserialization\n): Promise<EShape> | EShape => {\n\tconst deserializer = EShapeDeserializers[item[0]] || EShapeDeserializers[EShapeType.NULL];\n\tif (deserializer != null) {\n\t\tconst result = deserializer(item, manager);\n\t\tif (result != null) {\n\t\t\treturn result;\n\t\t}\n\t}\n\tthrow new Error(\"Missing shape deserializers\");\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeGradientLike, EShapeGradientPointLike } from \"../e-shape-gradient\";\n\nconst parse = (target: string): number[] | null => {\n\ttry {\n\t\treturn JSON.parse(target) as number[];\n\t} catch (e) {\n\t\treturn null;\n\t}\n};\n\nexport const deserializeGradient = (target: string): EShapeGradientLike | undefined => {\n\tconst parsed = parse(target);\n\tif (parsed == null || parsed.length < 7) {\n\t\treturn undefined;\n\t} else {\n\t\tconst direction = parsed[0];\n\t\tconst points: EShapeGradientPointLike[] = [];\n\t\tfor (let i = 1, imax = parsed.length; i < imax; i += 3) {\n\t\t\tpoints.push({\n\t\t\t\tcolor: parsed[i + 0],\n\t\t\t\talpha: parsed[i + 1],\n\t\t\t\tposition: parsed[i + 2]\n\t\t\t});\n\t\t}\n\t\treturn {\n\t\t\tpoints,\n\t\t\tdirection\n\t\t};\n\t}\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\ntype ImageElement = Promise<HTMLImageElement> | HTMLImageElement;\n\nconst imageElementCache: Record<string, ImageElement | undefined> = {};\n\nexport const toImageElement = (dataUrl: string): Promise<HTMLImageElement> => {\n\tconst cachedImageElement = imageElementCache[dataUrl];\n\tif (cachedImageElement != null) {\n\t\tif (cachedImageElement instanceof HTMLImageElement) {\n\t\t\treturn Promise.resolve(cachedImageElement);\n\t\t} else {\n\t\t\treturn cachedImageElement;\n\t\t}\n\t} else {\n\t\tconst result = new Promise<HTMLImageElement>((resolve, reject): void => {\n\t\t\tconst imageElement = document.createElement(\"img\");\n\t\t\timageElement.onload = () => {\n\t\t\t\timageElementCache[dataUrl] = imageElement;\n\t\t\t\tresolve(imageElement);\n\t\t\t};\n\t\t\timageElement.onabort = imageElement.onerror = () => {\n\t\t\t\treject();\n\t\t\t};\n\t\t\timageElement.src = dataUrl;\n\t\t});\n\t\timageElementCache[dataUrl] = result;\n\t\treturn result;\n\t}\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\nimport { isString } from \"../../util/is-string\";\nimport { deserializeActionValue } from \"../action/deserialize-action-value\";\nimport { EShape } from \"../e-shape\";\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { deserialize } from \"./deserialize\";\nimport { deserializeGradient } from \"./deserialize-gradient\";\nimport { toImageElement } from \"./to-image-element\";\nimport { toSizeNormalized } from \"./to-size-normalized\";\n\nexport const deserializeBase = <SHAPE extends EShape>(\n\titem: DDiagramSerializedItem,\n\tmanager: EShapeResourceManagerDeserialization,\n\tresult: SHAPE\n): Promise<SHAPE> | SHAPE => {\n\tresult.id = manager.resources[item[1]] || \"\";\n\tconst transform = result.transform;\n\ttransform.position.set(item[2], item[3]);\n\ttransform.rotation = item[6];\n\ttransform.skew.set(item[7], item[7]);\n\ttransform.pivot.set(item[21], item[22]);\n\tresult.size.set(toSizeNormalized(item[4]), toSizeNormalized(item[5]));\n\tresult.fill.deserialize(item[8], manager);\n\tresult.stroke.deserialize(item[9], manager);\n\tresult.cursor = manager.resources[item[10]] || \"\";\n\tresult.text.deserialize(item[11], manager);\n\tresult.data.deserialize(item[12], manager);\n\tresult.radius = item[13];\n\tresult.corner = item[14];\n\tconst item23 = item[23];\n\tresult.interactive = !!(item23 & 1);\n\tconst state = result.state;\n\tstate.isFocusable = !(item23 & 2);\n\tstate.isActive = !!(item23 & 4);\n\tconst item24 = item[24];\n\tresult.shortcut = 0 <= item24 ? manager.resources[item24] : undefined;\n\tconst item25 = item[25];\n\tresult.title = 0 <= item25 ? manager.resources[item25] : undefined;\n\tconst item26 = item[26];\n\tresult.uuid = item26 != null ? item26 : 0;\n\n\t// Children\n\tlet childrenPromise: Promise<SHAPE> | null = null;\n\tconst childrenSerialized = item[20];\n\tif (0 < childrenSerialized.length) {\n\t\tconst childrenOrPromises = [];\n\t\tfor (let i = 0, imax = childrenSerialized.length; i < imax; ++i) {\n\t\t\tchildrenOrPromises.push(deserialize(childrenSerialized[i], manager));\n\t\t}\n\t\tchildrenPromise = Promise.all(childrenOrPromises).then((children: EShape[]) => {\n\t\t\tresult.children = children;\n\t\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\t\tchildren[i].parent = result;\n\t\t\t}\n\t\t\tresult.onChildTransformChange();\n\t\t\tresult.toDirty();\n\t\t\treturn result;\n\t\t});\n\t}\n\n\t// Action\n\tconst serializedActions = item[17];\n\tfor (let i = 0, imax = serializedActions.length; i < imax; ++i) {\n\t\tresult.action.add(deserializeActionValue(serializedActions[i], manager));\n\t}\n\n\t// Gradient\n\tconst gradientId = item[19];\n\tif (0 <= gradientId && gradientId < manager.resources.length) {\n\t\tconst gradient = manager.resources[gradientId];\n\t\tif (isString(gradient)) {\n\t\t\tresult.gradient = deserializeGradient(gradient);\n\t\t}\n\t}\n\n\t// Image\n\tlet imagePromise: Promise<SHAPE> | null = null;\n\tconst imageId = item[18];\n\tif (0 <= imageId && imageId < manager.resources.length) {\n\t\tconst imageSrc = manager.resources[imageId];\n\t\tif (isString(imageSrc)) {\n\t\t\timagePromise = toImageElement(imageSrc).then((imageElement) => {\n\t\t\t\tresult.image = imageElement;\n\t\t\t\treturn result;\n\t\t\t});\n\t\t}\n\t}\n\n\t//\n\tif (childrenPromise != null) {\n\t\tif (imagePromise != null) {\n\t\t\treturn Promise.all([childrenPromise, imagePromise]).then(() => {\n\t\t\t\treturn result;\n\t\t\t});\n\t\t} else {\n\t\t\treturn childrenPromise;\n\t\t}\n\t} else {\n\t\tif (imagePromise != null) {\n\t\t\treturn imagePromise;\n\t\t} else {\n\t\t\treturn result;\n\t\t}\n\t}\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\nimport { EShapePointsStyle } from \"../e-shape-points-style\";\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { deserializeBase } from \"./deserialize-base\";\nimport { EShapeBar } from \"./e-shape-bar\";\n\nexport const deserializeBar = (\n\titem: DDiagramSerializedItem,\n\tmanager: EShapeResourceManagerDeserialization,\n\tshape?: EShapeBar\n): Promise<EShapeBar> | EShapeBar => {\n\tshape = shape || new EShapeBar();\n\tconst result = deserializeBase(item, manager, shape);\n\tshape.points.deserialize(item[15], manager);\n\tconst style = shape.points.style;\n\tconst mask =\n\t\tEShapePointsStyle.NON_SCALING_MASK |\n\t\tEShapePointsStyle.DOTTED_MASK |\n\t\tEShapePointsStyle.DASHED_MASK;\n\tconst deprecated = style & mask;\n\tif (deprecated) {\n\t\tshape.points.style &= ~mask;\n\t\tshape.stroke.style |= deprecated;\n\t}\n\treturn result;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeDeserializers } from \"../e-shape-deserializers\";\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapeUploadeds } from \"../e-shape-uploadeds\";\nimport { createBarUploaded } from \"../variant/create-bar-uploaded\";\nimport { deserializeBar } from \"../variant/deserialize-bar\";\n\nexport const loadShapeBar = (): void => {\n\tEShapeUploadeds[EShapeType.BAR] = createBarUploaded;\n\tEShapeDeserializers[EShapeType.BAR] = deserializeBar;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/* eslint-disable prettier/prettier */\n\nconst NONE\t\t\t= 0b0;\n\nconst ID\t\t\t= 0x1;\nconst POSITION\t\t= 0x2;\nconst WIDTH\t\t\t= 0x4;\nconst HEIGHT\t\t= 0x8;\nconst ROTATION\t\t= 0x10;\nconst SKEW\t\t\t= 0x20;\nconst ALIGN\t\t\t= 0x40;\n\nconst REPLACING\t\t= 0x80;\nconst GROUPING\t\t= 0x100;\nconst FILL\t\t\t= 0x200;\nconst STROKE\t\t= 0x400;\nconst STROKE_SIDE\t= 0x800;\nconst BORDER_RADIUS\t= 0x1000;\n\nconst TEXT\t\t\t= 0x2000;\nconst TEXTURE\t\t= 0x4000;\nconst DATA\t\t\t= 0x8000;\nconst ACTION\t\t= 0x10000;\nconst CURSOR\t\t= 0x20000;\nconst ORDER_IN_LAYER= 0x40000;\n\nconst CHILDREN\t\t= 0x80000;\n\nconst COORDINATE\t= ID | POSITION | WIDTH | HEIGHT | ROTATION | SKEW | ALIGN;\nconst SHAPE\t\t\t= REPLACING | GROUPING | FILL | STROKE;\nconst LAYER\t\t\t= ORDER_IN_LAYER;\nconst PRIMITIVE\t\t= COORDINATE | SHAPE | TEXT | TEXTURE | DATA | ACTION | CURSOR | LAYER | CHILDREN;\nconst EMBEDDED\t\t= COORDINATE | REPLACING | GROUPING | TEXT | DATA | ACTION | LAYER;\nconst CONNECTOR\t\t= ID | REPLACING | FILL | STROKE | TEXT | TEXTURE | DATA | ACTION | CURSOR | LAYER | CHILDREN;\nconst ALL\t\t\t= PRIMITIVE | STROKE_SIDE | BORDER_RADIUS;\n\nexport const EShapeCapability = {\n\tNONE,\n\n\tID,\n\tPOSITION,\n\tWIDTH,\n\tHEIGHT,\n\tROTATION,\n\tSKEW,\n\tALIGN,\n\n\tREPLACING,\n\tGROUPING,\n\tFILL,\n\tSTROKE,\n\tSTROKE_SIDE,\n\tBORDER_RADIUS,\n\n\tTEXT,\n\tTEXTURE,\n\t/** @deprecated in favor of {@link DATA} */\n\tTAG: DATA,\n\tDATA,\n\tACTION,\n\tCURSOR,\n\tORDER_IN_LAYER,\n\n\tCHILDREN,\n\n\tCOORDINATE,\n\tSHAPE,\n\tLAYER,\n\tPRIMITIVE,\n\tEMBEDDED,\n\tCONNECTOR,\n\tALL\n} as const;\n\nexport type EShapeCapability = typeof EShapeCapability[keyof typeof EShapeCapability];\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"./e-shape\";\nimport { EShapeCapability } from \"./e-shape-capability\";\nimport { EShapeType } from \"./e-shape-type\";\n\nexport class EShapeCapabilities {\n\tstatic mappings: Record<number, EShapeCapability | undefined> = {};\n\n\tstatic get(type: EShapeType): EShapeCapability {\n\t\tconst capability = this.mappings[type];\n\t\tif (capability != null) {\n\t\t\treturn capability;\n\t\t}\n\t\treturn EShapeCapability.PRIMITIVE;\n\t}\n\n\tstatic contains(shape: EShape | null | undefined, target: EShapeCapability): shape is EShape {\n\t\tif (shape != null) {\n\t\t\tconst capability = this.get(shape.type);\n\t\t\tif (capability & target) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (capability & EShapeCapability.CHILDREN) {\n\t\t\t\tconst children = shape.children;\n\t\t\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\t\t\tif (this.contains(children[i], target)) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tstatic set(type: EShapeType, capability: EShapeCapability): void {\n\t\tthis.mappings[type] = capability;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"./e-shape\";\nimport { EShapeRuntime } from \"./e-shape-runtime\";\n\nexport type EShapeRuntimeConstructor = new (shape: EShape) => EShapeRuntime;\n\nexport const EShapeRuntimes: Record<number, EShapeRuntimeConstructor | undefined> = {};\n","import { Matrix, Point, TextureUvs } from \"pixi.js\";\nimport { EShapeCorner } from \"../e-shape-corner\";\nimport { EShapeStrokeSide } from \"../e-shape-stroke-side\";\nimport { EShapeStrokeStyle } from \"../e-shape-stroke-style\";\nimport { toLength } from \"./to-length\";\nimport { toScaleInvariant } from \"./to-scale-invariant\";\n\nexport const RECTANGLE_ROUNDED_VERTEX_COUNT = 36;\nexport const RECTANGLE_ROUNDED_INDEX_COUNT = 24;\nexport const RECTANGLE_ROUNDED_WORLD_SIZE: [number, number, number] = [0, 0, 0];\nconst RECTANGLE_ROUNDED_WORK_POINT: Point = new Point();\n\nexport const buildRectangleRoundedIndex = (\n\tindices: Uint16Array | Uint32Array,\n\tvoffset: number,\n\tioffset: number\n): void => {\n\t// Top-left corner\n\tlet ii = ioffset * 3 - 1;\n\tindices[++ii] = voffset;\n\tindices[++ii] = voffset + 1;\n\tindices[++ii] = voffset + 2;\n\tindices[++ii] = voffset + 1;\n\tindices[++ii] = voffset + 3;\n\tindices[++ii] = voffset + 2;\n\n\t// Top-right corner\n\tindices[++ii] = voffset + 4;\n\tindices[++ii] = voffset + 5;\n\tindices[++ii] = voffset + 6;\n\tindices[++ii] = voffset + 5;\n\tindices[++ii] = voffset + 7;\n\tindices[++ii] = voffset + 6;\n\n\t// Bottom-left corner\n\tindices[++ii] = voffset + 8;\n\tindices[++ii] = voffset + 9;\n\tindices[++ii] = voffset + 10;\n\tindices[++ii] = voffset + 9;\n\tindices[++ii] = voffset + 11;\n\tindices[++ii] = voffset + 10;\n\n\t// Bottom-right corner\n\tindices[++ii] = voffset + 12;\n\tindices[++ii] = voffset + 13;\n\tindices[++ii] = voffset + 14;\n\tindices[++ii] = voffset + 13;\n\tindices[++ii] = voffset + 15;\n\tindices[++ii] = voffset + 14;\n\n\t// Top edge\n\tindices[++ii] = voffset + 16;\n\tindices[++ii] = voffset + 17;\n\tindices[++ii] = voffset + 20;\n\tindices[++ii] = voffset + 17;\n\tindices[++ii] = voffset + 21;\n\tindices[++ii] = voffset + 20;\n\n\tindices[++ii] = voffset + 17;\n\tindices[++ii] = voffset + 18;\n\tindices[++ii] = voffset + 21;\n\tindices[++ii] = voffset + 18;\n\tindices[++ii] = voffset + 22;\n\tindices[++ii] = voffset + 21;\n\n\t// Upper middle\n\tindices[++ii] = voffset + 19;\n\tindices[++ii] = voffset + 21;\n\tindices[++ii] = voffset + 24;\n\tindices[++ii] = voffset + 21;\n\tindices[++ii] = voffset + 25;\n\tindices[++ii] = voffset + 24;\n\n\tindices[++ii] = voffset + 21;\n\tindices[++ii] = voffset + 23;\n\tindices[++ii] = voffset + 26;\n\tindices[++ii] = voffset + 23;\n\tindices[++ii] = voffset + 27;\n\tindices[++ii] = voffset + 26;\n\n\t// Lower middle\n\tindices[++ii] = voffset + 24;\n\tindices[++ii] = voffset + 25;\n\tindices[++ii] = voffset + 28;\n\tindices[++ii] = voffset + 25;\n\tindices[++ii] = voffset + 30;\n\tindices[++ii] = voffset + 28;\n\n\tindices[++ii] = voffset + 26;\n\tindices[++ii] = voffset + 27;\n\tindices[++ii] = voffset + 30;\n\tindices[++ii] = voffset + 27;\n\tindices[++ii] = voffset + 32;\n\tindices[++ii] = voffset + 30;\n\n\t// Bottom edge\n\tindices[++ii] = voffset + 29;\n\tindices[++ii] = voffset + 30;\n\tindices[++ii] = voffset + 33;\n\tindices[++ii] = voffset + 30;\n\tindices[++ii] = voffset + 34;\n\tindices[++ii] = voffset + 33;\n\n\tindices[++ii] = voffset + 30;\n\tindices[++ii] = voffset + 31;\n\tindices[++ii] = voffset + 34;\n\tindices[++ii] = voffset + 31;\n\tindices[++ii] = voffset + 35;\n\tindices[++ii] = voffset + 34;\n};\n\nexport const buildRectangleRoundedVertex = (\n\tvertices: Float32Array,\n\tvoffset: number,\n\toriginX: number,\n\toriginY: number,\n\tsizeX: number,\n\tsizeY: number,\n\tstrokeAlign: number,\n\tstrokeWidth: number,\n\tradius: number,\n\tinternalTransform: Matrix,\n\tworldSize: typeof RECTANGLE_ROUNDED_WORLD_SIZE\n): void => {\n\t// Calculate the transformed positions\n\t//\n\t//  0   1       4   5\n\t// |---|       |---|\n\t// |2  |3      |6  |7\n\t// |---|       |---|\n\t//\n\t//\n\t//\n\t//\n\t//\n\t// |---|       |---|\n\t// |8  |9      |12 |13\n\t// |---|       |---|\n\t//  10  11      14  15\n\t//\n\t//\n\t//      16  17  18       <-- Top edge\n\t//     |---|---|\n\t//  19 |20 |21 |22  23   <-- Top\n\t// |---|---|---|---|\n\t// |       |       |\n\t// |24   25|26     |27   <-- Middle\n\t// |-------|-------|\n\t// |       |       |\n\t// |       |       |\n\t// |---|---|---|---|\n\t//  28 |29 |30 |31  32   <-- Bottom\n\t//     |---|---|\n\t//      33  34  35       <-- Bottom edge\n\t//\n\tconst s = strokeAlign * strokeWidth;\n\tconst sx = sizeX * 0.5 + (0 <= sizeX ? +s : -s);\n\tconst sy = sizeY * 0.5 + (0 <= sizeY ? +s : -s);\n\tconst ax = Math.abs(sx);\n\tconst ay = Math.abs(sy);\n\tconst a = radius * Math.min(ax, ay);\n\tconst rx = a / ax;\n\tconst ry = a / ay;\n\n\tconst work = RECTANGLE_ROUNDED_WORK_POINT;\n\twork.set(originX - sx, originY - sy);\n\tinternalTransform.apply(work, work);\n\tconst x0 = work.x;\n\tconst y0 = work.y;\n\twork.set(originX, originY - sy);\n\tinternalTransform.apply(work, work);\n\tconst x2 = work.x;\n\tconst y2 = work.y;\n\tconst dxh = x2 - x0;\n\tconst dyh = y2 - y0;\n\tconst dxhr = rx * dxh;\n\tconst dyhr = rx * dyh;\n\tconst x1 = x0 + dxhr;\n\tconst y1 = y0 + dyhr;\n\tconst x4 = x2 + dxh;\n\tconst y4 = y2 + dyh;\n\tconst x3 = x4 - dxhr;\n\tconst y3 = y4 - dyhr;\n\twork.set(originX, originY);\n\tinternalTransform.apply(work, work);\n\tconst x11 = work.x;\n\tconst y11 = work.y;\n\tconst dxv = x11 - x2;\n\tconst dyv = y11 - y2;\n\tconst dxvr = ry * dxv;\n\tconst dyvr = ry * dyv;\n\tconst x7 = x2 + dxvr;\n\tconst y7 = y2 + dyvr;\n\tconst x5 = x7 - dxh;\n\tconst y5 = y7 - dyh;\n\tconst x6 = x5 + dxhr;\n\tconst y6 = y5 + dyhr;\n\tconst x9 = x7 + dxh;\n\tconst y9 = y7 + dyh;\n\tconst x8 = x9 - dxhr;\n\tconst y8 = y9 - dyhr;\n\tconst x10 = x11 - dxh;\n\tconst y10 = y11 - dyh;\n\tconst x12 = x11 + dxh;\n\tconst y12 = y11 + dyh;\n\tconst x20 = x11 + dxv;\n\tconst y20 = y11 + dyv;\n\tconst x15 = x20 - dxvr;\n\tconst y15 = y20 - dyvr;\n\tconst x13 = x15 - dxh;\n\tconst y13 = y15 - dyh;\n\tconst x14 = x13 + dxhr;\n\tconst y14 = y13 + dyhr;\n\tconst x17 = x15 + dxh;\n\tconst y17 = y15 + dyh;\n\tconst x16 = x17 - dxhr;\n\tconst y16 = y17 - dyhr;\n\tconst x18 = x20 - dxh;\n\tconst y18 = y20 - dyh;\n\tconst x19 = x18 + dxhr;\n\tconst y19 = y18 + dyhr;\n\tconst x22 = x20 + dxh;\n\tconst y22 = y20 + dyh;\n\tconst x21 = x22 - dxhr;\n\tconst y21 = y22 - dyhr;\n\n\t// World size\n\tworldSize[0] = toLength(x0, y0, x1, y1);\n\tworldSize[1] = toLength(x0, y0, x2, y2);\n\tworldSize[2] = toLength(x0, y0, x10, y10);\n\n\t// Vertices\n\tlet iv = voffset * 2 - 1;\n\n\t// Top-left corner\n\tvertices[++iv] = x0;\n\tvertices[++iv] = y0;\n\tvertices[++iv] = x1;\n\tvertices[++iv] = y1;\n\tvertices[++iv] = x5;\n\tvertices[++iv] = y5;\n\tvertices[++iv] = x6;\n\tvertices[++iv] = y6;\n\n\t// Top-right corner\n\tvertices[++iv] = x3;\n\tvertices[++iv] = y3;\n\tvertices[++iv] = x4;\n\tvertices[++iv] = y4;\n\tvertices[++iv] = x8;\n\tvertices[++iv] = y8;\n\tvertices[++iv] = x9;\n\tvertices[++iv] = y9;\n\n\t// Bottom-left corner\n\tvertices[++iv] = x13;\n\tvertices[++iv] = y13;\n\tvertices[++iv] = x14;\n\tvertices[++iv] = y14;\n\tvertices[++iv] = x18;\n\tvertices[++iv] = y18;\n\tvertices[++iv] = x19;\n\tvertices[++iv] = y19;\n\n\t// Bottom-right corner\n\tvertices[++iv] = x16;\n\tvertices[++iv] = y16;\n\tvertices[++iv] = x17;\n\tvertices[++iv] = y17;\n\tvertices[++iv] = x21;\n\tvertices[++iv] = y21;\n\tvertices[++iv] = x22;\n\tvertices[++iv] = y22;\n\n\t// Top edge\n\tvertices[++iv] = x1;\n\tvertices[++iv] = y1;\n\tvertices[++iv] = x2;\n\tvertices[++iv] = y2;\n\tvertices[++iv] = x3;\n\tvertices[++iv] = y3;\n\n\t// Top\n\tvertices[++iv] = x5;\n\tvertices[++iv] = y5;\n\tvertices[++iv] = x6;\n\tvertices[++iv] = y6;\n\tvertices[++iv] = x7;\n\tvertices[++iv] = y7;\n\tvertices[++iv] = x8;\n\tvertices[++iv] = y8;\n\tvertices[++iv] = x9;\n\tvertices[++iv] = y9;\n\n\t// Middle\n\tvertices[++iv] = x10;\n\tvertices[++iv] = y10;\n\tvertices[++iv] = x11;\n\tvertices[++iv] = y11;\n\tvertices[++iv] = x11;\n\tvertices[++iv] = y11;\n\tvertices[++iv] = x12;\n\tvertices[++iv] = y12;\n\n\t// Bottom\n\tvertices[++iv] = x13;\n\tvertices[++iv] = y13;\n\tvertices[++iv] = x14;\n\tvertices[++iv] = y14;\n\tvertices[++iv] = x15;\n\tvertices[++iv] = y15;\n\tvertices[++iv] = x16;\n\tvertices[++iv] = y16;\n\tvertices[++iv] = x17;\n\tvertices[++iv] = y17;\n\n\t// Bottom edge\n\tvertices[++iv] = x19;\n\tvertices[++iv] = y19;\n\tvertices[++iv] = x20;\n\tvertices[++iv] = y20;\n\tvertices[++iv] = x21;\n\tvertices[++iv] = y21;\n};\n\nexport const buildRectangleRoundedClipping = (\n\tclippings: Float32Array,\n\tvoffset: number,\n\tcorner: EShapeCorner,\n\tworldSize: typeof RECTANGLE_ROUNDED_WORLD_SIZE\n): void => {\n\tlet ic = voffset * 3 - 1;\n\tconst rxc = 1 - worldSize[0] / worldSize[1];\n\tconst ryc = 1 - worldSize[0] / worldSize[2];\n\n\t// Top-left corner\n\tif (corner & EShapeCorner.TOP_LEFT) {\n\t\tclippings[++ic] = 1;\n\t\tclippings[++ic] = 1;\n\t\tclippings[++ic] = 1;\n\n\t\tclippings[++ic] = 0;\n\t\tclippings[++ic] = 1;\n\t\tclippings[++ic] = 1;\n\n\t\tclippings[++ic] = 1;\n\t\tclippings[++ic] = 0;\n\t\tclippings[++ic] = 1;\n\n\t\tclippings[++ic] = 0;\n\t\tclippings[++ic] = 0;\n\t\tclippings[++ic] = 1;\n\t} else {\n\t\tclippings[++ic] = 1;\n\t\tclippings[++ic] = 1;\n\t\tclippings[++ic] = 0;\n\n\t\tclippings[++ic] = rxc;\n\t\tclippings[++ic] = 1;\n\t\tclippings[++ic] = 0;\n\n\t\tclippings[++ic] = 1;\n\t\tclippings[++ic] = ryc;\n\t\tclippings[++ic] = 0;\n\n\t\tclippings[++ic] = rxc;\n\t\tclippings[++ic] = ryc;\n\t\tclippings[++ic] = 0;\n\t}\n\n\t// Top-right corner\n\tif (corner & EShapeCorner.TOP_RIGHT) {\n\t\tclippings[++ic] = 0;\n\t\tclippings[++ic] = 1;\n\t\tclippings[++ic] = 1;\n\n\t\tclippings[++ic] = 1;\n\t\tclippings[++ic] = 1;\n\t\tclippings[++ic] = 1;\n\n\t\tclippings[++ic] = 0;\n\t\tclippings[++ic] = 0;\n\t\tclippings[++ic] = 1;\n\n\t\tclippings[++ic] = 1;\n\t\tclippings[++ic] = 0;\n\t\tclippings[++ic] = 1;\n\t} else {\n\t\tclippings[++ic] = rxc;\n\t\tclippings[++ic] = 1;\n\t\tclippings[++ic] = 0;\n\n\t\tclippings[++ic] = 1;\n\t\tclippings[++ic] = 1;\n\t\tclippings[++ic] = 0;\n\n\t\tclippings[++ic] = rxc;\n\t\tclippings[++ic] = ryc;\n\t\tclippings[++ic] = 0;\n\n\t\tclippings[++ic] = 1;\n\t\tclippings[++ic] = ryc;\n\t\tclippings[++ic] = 0;\n\t}\n\n\t// Bottom-left corner\n\tif (corner & EShapeCorner.BOTTOM_LEFT) {\n\t\tclippings[++ic] = 1;\n\t\tclippings[++ic] = 0;\n\t\tclippings[++ic] = 1;\n\n\t\tclippings[++ic] = 0;\n\t\tclippings[++ic] = 0;\n\t\tclippings[++ic] = 1;\n\n\t\tclippings[++ic] = 1;\n\t\tclippings[++ic] = 1;\n\t\tclippings[++ic] = 1;\n\n\t\tclippings[++ic] = 0;\n\t\tclippings[++ic] = 1;\n\t\tclippings[++ic] = 1;\n\t} else {\n\t\tclippings[++ic] = 1;\n\t\tclippings[++ic] = ryc;\n\t\tclippings[++ic] = 0;\n\n\t\tclippings[++ic] = rxc;\n\t\tclippings[++ic] = ryc;\n\t\tclippings[++ic] = 0;\n\n\t\tclippings[++ic] = 1;\n\t\tclippings[++ic] = 1;\n\t\tclippings[++ic] = 0;\n\n\t\tclippings[++ic] = rxc;\n\t\tclippings[++ic] = 1;\n\t\tclippings[++ic] = 0;\n\t}\n\n\t// Bottom-right corner\n\tif (corner & EShapeCorner.BOTTOM_RIGHT) {\n\t\tclippings[++ic] = 0;\n\t\tclippings[++ic] = 0;\n\t\tclippings[++ic] = 1;\n\n\t\tclippings[++ic] = 1;\n\t\tclippings[++ic] = 0;\n\t\tclippings[++ic] = 1;\n\n\t\tclippings[++ic] = 0;\n\t\tclippings[++ic] = 1;\n\t\tclippings[++ic] = 1;\n\n\t\tclippings[++ic] = 1;\n\t\tclippings[++ic] = 1;\n\t\tclippings[++ic] = 1;\n\t} else {\n\t\tclippings[++ic] = rxc;\n\t\tclippings[++ic] = ryc;\n\t\tclippings[++ic] = 0;\n\n\t\tclippings[++ic] = 1;\n\t\tclippings[++ic] = ryc;\n\t\tclippings[++ic] = 0;\n\n\t\tclippings[++ic] = rxc;\n\t\tclippings[++ic] = 1;\n\t\tclippings[++ic] = 0;\n\n\t\tclippings[++ic] = 1;\n\t\tclippings[++ic] = 1;\n\t\tclippings[++ic] = 0;\n\t}\n\n\t// Top edge\n\tclippings[++ic] = rxc;\n\tclippings[++ic] = 1;\n\tclippings[++ic] = 0;\n\n\tclippings[++ic] = 0;\n\tclippings[++ic] = 1;\n\tclippings[++ic] = 0;\n\n\tclippings[++ic] = rxc;\n\tclippings[++ic] = 1;\n\tclippings[++ic] = 0;\n\n\t// Top\n\tclippings[++ic] = 1;\n\tclippings[++ic] = ryc;\n\tclippings[++ic] = 0;\n\n\tclippings[++ic] = rxc;\n\tclippings[++ic] = ryc;\n\tclippings[++ic] = 0;\n\n\tclippings[++ic] = 0;\n\tclippings[++ic] = ryc;\n\tclippings[++ic] = 0;\n\n\tclippings[++ic] = rxc;\n\tclippings[++ic] = ryc;\n\tclippings[++ic] = 0;\n\n\tclippings[++ic] = 1;\n\tclippings[++ic] = ryc;\n\tclippings[++ic] = 0;\n\n\t// Middle\n\tclippings[++ic] = 1;\n\tclippings[++ic] = 0;\n\tclippings[++ic] = 0;\n\n\tclippings[++ic] = 0;\n\tclippings[++ic] = 0;\n\tclippings[++ic] = 0;\n\n\tclippings[++ic] = 0;\n\tclippings[++ic] = 0;\n\tclippings[++ic] = 0;\n\n\tclippings[++ic] = 1;\n\tclippings[++ic] = 0;\n\tclippings[++ic] = 0;\n\n\t// Bottom\n\tclippings[++ic] = 1;\n\tclippings[++ic] = ryc;\n\tclippings[++ic] = 0;\n\n\tclippings[++ic] = rxc;\n\tclippings[++ic] = ryc;\n\tclippings[++ic] = 0;\n\n\tclippings[++ic] = 0;\n\tclippings[++ic] = ryc;\n\tclippings[++ic] = 0;\n\n\tclippings[++ic] = rxc;\n\tclippings[++ic] = ryc;\n\tclippings[++ic] = 0;\n\n\tclippings[++ic] = 1;\n\tclippings[++ic] = ryc;\n\tclippings[++ic] = 0;\n\n\t// Bottom edge\n\tclippings[++ic] = rxc;\n\tclippings[++ic] = 1;\n\tclippings[++ic] = 0;\n\n\tclippings[++ic] = 0;\n\tclippings[++ic] = 1;\n\tclippings[++ic] = 0;\n\n\tclippings[++ic] = rxc;\n\tclippings[++ic] = 1;\n\tclippings[++ic] = 0;\n};\n\nexport const buildRectangleRoundedStep = (\n\tsteps: Float32Array,\n\tvoffset: number,\n\tstrokeWidth: number,\n\tstrokeSide: EShapeStrokeSide,\n\tstrokeStyle: EShapeStrokeStyle,\n\tcorner: EShapeCorner,\n\tworldSize: typeof RECTANGLE_ROUNDED_WORLD_SIZE\n): void => {\n\tconst scaleInvariant = toScaleInvariant(strokeStyle);\n\n\tconst sc = worldSize[0];\n\tconst sx = worldSize[1];\n\tconst sy = worldSize[2];\n\n\tconst rxc = Math.max(0, 1 - worldSize[0] / worldSize[1]);\n\tconst ryc = Math.max(0, 1 - worldSize[0] / worldSize[2]);\n\n\tlet wt: number;\n\tlet zt: number;\n\tlet bt: number;\n\tif (strokeSide & EShapeStrokeSide.TOP) {\n\t\twt = +2;\n\t\tzt = +1;\n\t\tbt = +1 + ryc;\n\t} else {\n\t\twt = -2;\n\t\tzt = -1;\n\t\tbt = -1 - ryc;\n\t}\n\n\tlet wr: number;\n\tlet zr: number;\n\tlet br: number;\n\tif (strokeSide & EShapeStrokeSide.RIGHT) {\n\t\twr = +2;\n\t\tzr = +1;\n\t\tbr = +1 + rxc;\n\t} else {\n\t\twr = -2;\n\t\tzr = -1;\n\t\tbr = -1 - rxc;\n\t}\n\n\tlet wb: number;\n\tlet zb: number;\n\tlet bb: number;\n\tif (strokeSide & EShapeStrokeSide.BOTTOM) {\n\t\twb = +2;\n\t\tzb = +1;\n\t\tbb = +1 + ryc;\n\t} else {\n\t\twb = -2;\n\t\tzb = -1;\n\t\tbb = -1 - ryc;\n\t}\n\n\tlet wl: number;\n\tlet zl: number;\n\tlet bl: number;\n\tif (strokeSide & EShapeStrokeSide.LEFT) {\n\t\twl = +2;\n\t\tzl = +1;\n\t\tbl = +1 + rxc;\n\t} else {\n\t\twl = -2;\n\t\tzl = -1;\n\t\tbl = -1 - rxc;\n\t}\n\n\t// Top-left corner\n\tlet is = voffset * 6 - 1;\n\tif (corner & EShapeCorner.TOP_LEFT) {\n\t\tsteps[++is] = strokeWidth;\n\t\tsteps[++is] = scaleInvariant;\n\t\tsteps[++is] = sc;\n\t\tsteps[++is] = sc;\n\t\tsteps[++is] = wl;\n\t\tsteps[++is] = wt;\n\n\t\tsteps[++is] = strokeWidth;\n\t\tsteps[++is] = scaleInvariant;\n\t\tsteps[++is] = sc;\n\t\tsteps[++is] = sc;\n\t\tsteps[++is] = zl;\n\t\tsteps[++is] = wt;\n\n\t\tsteps[++is] = strokeWidth;\n\t\tsteps[++is] = scaleInvariant;\n\t\tsteps[++is] = sc;\n\t\tsteps[++is] = sc;\n\t\tsteps[++is] = wl;\n\t\tsteps[++is] = zt;\n\n\t\tsteps[++is] = strokeWidth;\n\t\tsteps[++is] = scaleInvariant;\n\t\tsteps[++is] = sc;\n\t\tsteps[++is] = sc;\n\t\tsteps[++is] = zl;\n\t\tsteps[++is] = zt;\n\t} else {\n\t\tsteps[++is] = strokeWidth;\n\t\tsteps[++is] = scaleInvariant;\n\t\tsteps[++is] = sx;\n\t\tsteps[++is] = sy;\n\t\tsteps[++is] = wl;\n\t\tsteps[++is] = wt;\n\n\t\tsteps[++is] = strokeWidth;\n\t\tsteps[++is] = scaleInvariant;\n\t\tsteps[++is] = sx;\n\t\tsteps[++is] = sy;\n\t\tsteps[++is] = bl;\n\t\tsteps[++is] = wt;\n\n\t\tsteps[++is] = strokeWidth;\n\t\tsteps[++is] = scaleInvariant;\n\t\tsteps[++is] = sx;\n\t\tsteps[++is] = sy;\n\t\tsteps[++is] = wl;\n\t\tsteps[++is] = bt;\n\n\t\tsteps[++is] = strokeWidth;\n\t\tsteps[++is] = scaleInvariant;\n\t\tsteps[++is] = sx;\n\t\tsteps[++is] = sy;\n\t\tsteps[++is] = bl;\n\t\tsteps[++is] = bt;\n\t}\n\n\t// Top-right corner\n\tif (corner & EShapeCorner.TOP_RIGHT) {\n\t\tsteps[++is] = strokeWidth;\n\t\tsteps[++is] = scaleInvariant;\n\t\tsteps[++is] = sc;\n\t\tsteps[++is] = sc;\n\t\tsteps[++is] = zr;\n\t\tsteps[++is] = wt;\n\n\t\tsteps[++is] = strokeWidth;\n\t\tsteps[++is] = scaleInvariant;\n\t\tsteps[++is] = sc;\n\t\tsteps[++is] = sc;\n\t\tsteps[++is] = wr;\n\t\tsteps[++is] = wt;\n\n\t\tsteps[++is] = strokeWidth;\n\t\tsteps[++is] = scaleInvariant;\n\t\tsteps[++is] = sc;\n\t\tsteps[++is] = sc;\n\t\tsteps[++is] = zr;\n\t\tsteps[++is] = zt;\n\n\t\tsteps[++is] = strokeWidth;\n\t\tsteps[++is] = scaleInvariant;\n\t\tsteps[++is] = sc;\n\t\tsteps[++is] = sc;\n\t\tsteps[++is] = wr;\n\t\tsteps[++is] = zt;\n\t} else {\n\t\tsteps[++is] = strokeWidth;\n\t\tsteps[++is] = scaleInvariant;\n\t\tsteps[++is] = sx;\n\t\tsteps[++is] = sy;\n\t\tsteps[++is] = br;\n\t\tsteps[++is] = wt;\n\n\t\tsteps[++is] = strokeWidth;\n\t\tsteps[++is] = scaleInvariant;\n\t\tsteps[++is] = sx;\n\t\tsteps[++is] = sy;\n\t\tsteps[++is] = wr;\n\t\tsteps[++is] = wt;\n\n\t\tsteps[++is] = strokeWidth;\n\t\tsteps[++is] = scaleInvariant;\n\t\tsteps[++is] = sx;\n\t\tsteps[++is] = sy;\n\t\tsteps[++is] = br;\n\t\tsteps[++is] = bt;\n\n\t\tsteps[++is] = strokeWidth;\n\t\tsteps[++is] = scaleInvariant;\n\t\tsteps[++is] = sx;\n\t\tsteps[++is] = sy;\n\t\tsteps[++is] = wr;\n\t\tsteps[++is] = bt;\n\t}\n\n\t// Bottom-left corner\n\tif (corner & EShapeCorner.BOTTOM_LEFT) {\n\t\tsteps[++is] = strokeWidth;\n\t\tsteps[++is] = scaleInvariant;\n\t\tsteps[++is] = sc;\n\t\tsteps[++is] = sc;\n\t\tsteps[++is] = wl;\n\t\tsteps[++is] = zb;\n\n\t\tsteps[++is] = strokeWidth;\n\t\tsteps[++is] = scaleInvariant;\n\t\tsteps[++is] = sc;\n\t\tsteps[++is] = sc;\n\t\tsteps[++is] = zl;\n\t\tsteps[++is] = zb;\n\n\t\tsteps[++is] = strokeWidth;\n\t\tsteps[++is] = scaleInvariant;\n\t\tsteps[++is] = sc;\n\t\tsteps[++is] = sc;\n\t\tsteps[++is] = wl;\n\t\tsteps[++is] = wb;\n\n\t\tsteps[++is] = strokeWidth;\n\t\tsteps[++is] = scaleInvariant;\n\t\tsteps[++is] = sc;\n\t\tsteps[++is] = sc;\n\t\tsteps[++is] = zl;\n\t\tsteps[++is] = wb;\n\t} else {\n\t\tsteps[++is] = strokeWidth;\n\t\tsteps[++is] = scaleInvariant;\n\t\tsteps[++is] = sx;\n\t\tsteps[++is] = sy;\n\t\tsteps[++is] = wl;\n\t\tsteps[++is] = bb;\n\n\t\tsteps[++is] = strokeWidth;\n\t\tsteps[++is] = scaleInvariant;\n\t\tsteps[++is] = sx;\n\t\tsteps[++is] = sy;\n\t\tsteps[++is] = bl;\n\t\tsteps[++is] = bb;\n\n\t\tsteps[++is] = strokeWidth;\n\t\tsteps[++is] = scaleInvariant;\n\t\tsteps[++is] = sx;\n\t\tsteps[++is] = sy;\n\t\tsteps[++is] = wl;\n\t\tsteps[++is] = wb;\n\n\t\tsteps[++is] = strokeWidth;\n\t\tsteps[++is] = scaleInvariant;\n\t\tsteps[++is] = sx;\n\t\tsteps[++is] = sy;\n\t\tsteps[++is] = bl;\n\t\tsteps[++is] = wb;\n\t}\n\n\t// Bottom-right corner\n\tif (corner & EShapeCorner.BOTTOM_RIGHT) {\n\t\tsteps[++is] = strokeWidth;\n\t\tsteps[++is] = scaleInvariant;\n\t\tsteps[++is] = sc;\n\t\tsteps[++is] = sc;\n\t\tsteps[++is] = zr;\n\t\tsteps[++is] = zb;\n\n\t\tsteps[++is] = strokeWidth;\n\t\tsteps[++is] = scaleInvariant;\n\t\tsteps[++is] = sc;\n\t\tsteps[++is] = sc;\n\t\tsteps[++is] = wr;\n\t\tsteps[++is] = zb;\n\n\t\tsteps[++is] = strokeWidth;\n\t\tsteps[++is] = scaleInvariant;\n\t\tsteps[++is] = sc;\n\t\tsteps[++is] = sc;\n\t\tsteps[++is] = zr;\n\t\tsteps[++is] = wb;\n\n\t\tsteps[++is] = strokeWidth;\n\t\tsteps[++is] = scaleInvariant;\n\t\tsteps[++is] = sc;\n\t\tsteps[++is] = sc;\n\t\tsteps[++is] = wr;\n\t\tsteps[++is] = wb;\n\t} else {\n\t\tsteps[++is] = strokeWidth;\n\t\tsteps[++is] = scaleInvariant;\n\t\tsteps[++is] = sx;\n\t\tsteps[++is] = sy;\n\t\tsteps[++is] = br;\n\t\tsteps[++is] = bb;\n\n\t\tsteps[++is] = strokeWidth;\n\t\tsteps[++is] = scaleInvariant;\n\t\tsteps[++is] = sx;\n\t\tsteps[++is] = sy;\n\t\tsteps[++is] = wr;\n\t\tsteps[++is] = bb;\n\n\t\tsteps[++is] = strokeWidth;\n\t\tsteps[++is] = scaleInvariant;\n\t\tsteps[++is] = sx;\n\t\tsteps[++is] = sy;\n\t\tsteps[++is] = br;\n\t\tsteps[++is] = wb;\n\n\t\tsteps[++is] = strokeWidth;\n\t\tsteps[++is] = scaleInvariant;\n\t\tsteps[++is] = sx;\n\t\tsteps[++is] = sy;\n\t\tsteps[++is] = wr;\n\t\tsteps[++is] = wb;\n\t}\n\n\t// Top edge\n\tsteps[++is] = strokeWidth;\n\tsteps[++is] = scaleInvariant;\n\tsteps[++is] = sx;\n\tsteps[++is] = sy;\n\tsteps[++is] = bl;\n\tsteps[++is] = wt;\n\n\tsteps[++is] = strokeWidth;\n\tsteps[++is] = scaleInvariant;\n\tsteps[++is] = sx;\n\tsteps[++is] = sy;\n\tsteps[++is] = zl;\n\tsteps[++is] = wt;\n\n\tsteps[++is] = strokeWidth;\n\tsteps[++is] = scaleInvariant;\n\tsteps[++is] = sx;\n\tsteps[++is] = sy;\n\tsteps[++is] = br;\n\tsteps[++is] = wt;\n\n\t// Top\n\tsteps[++is] = strokeWidth;\n\tsteps[++is] = scaleInvariant;\n\tsteps[++is] = sx;\n\tsteps[++is] = sy;\n\tsteps[++is] = wl;\n\tsteps[++is] = bt;\n\n\tsteps[++is] = strokeWidth;\n\tsteps[++is] = scaleInvariant;\n\tsteps[++is] = sx;\n\tsteps[++is] = sy;\n\tsteps[++is] = bl;\n\tsteps[++is] = bt;\n\n\tsteps[++is] = strokeWidth;\n\tsteps[++is] = scaleInvariant;\n\tsteps[++is] = sx;\n\tsteps[++is] = sy;\n\tsteps[++is] = zl;\n\tsteps[++is] = bt;\n\n\tsteps[++is] = strokeWidth;\n\tsteps[++is] = scaleInvariant;\n\tsteps[++is] = sx;\n\tsteps[++is] = sy;\n\tsteps[++is] = br;\n\tsteps[++is] = bt;\n\n\tsteps[++is] = strokeWidth;\n\tsteps[++is] = scaleInvariant;\n\tsteps[++is] = sx;\n\tsteps[++is] = sy;\n\tsteps[++is] = wr;\n\tsteps[++is] = bt;\n\n\t// Middle\n\tsteps[++is] = strokeWidth;\n\tsteps[++is] = scaleInvariant;\n\tsteps[++is] = sx;\n\tsteps[++is] = sy;\n\tsteps[++is] = wl;\n\tsteps[++is] = zt;\n\n\tsteps[++is] = strokeWidth;\n\tsteps[++is] = scaleInvariant;\n\tsteps[++is] = sx;\n\tsteps[++is] = sy;\n\tsteps[++is] = zl;\n\tsteps[++is] = zt;\n\n\tsteps[++is] = strokeWidth;\n\tsteps[++is] = scaleInvariant;\n\tsteps[++is] = sx;\n\tsteps[++is] = sy;\n\tsteps[++is] = zr;\n\tsteps[++is] = zb;\n\n\tsteps[++is] = strokeWidth;\n\tsteps[++is] = scaleInvariant;\n\tsteps[++is] = sx;\n\tsteps[++is] = sy;\n\tsteps[++is] = wr;\n\tsteps[++is] = zb;\n\n\t// Bottom\n\tsteps[++is] = strokeWidth;\n\tsteps[++is] = scaleInvariant;\n\tsteps[++is] = sx;\n\tsteps[++is] = sy;\n\tsteps[++is] = wl;\n\tsteps[++is] = bb;\n\n\tsteps[++is] = strokeWidth;\n\tsteps[++is] = scaleInvariant;\n\tsteps[++is] = sx;\n\tsteps[++is] = sy;\n\tsteps[++is] = bl;\n\tsteps[++is] = bb;\n\n\tsteps[++is] = strokeWidth;\n\tsteps[++is] = scaleInvariant;\n\tsteps[++is] = sx;\n\tsteps[++is] = sy;\n\tsteps[++is] = zb;\n\tsteps[++is] = bb;\n\n\tsteps[++is] = strokeWidth;\n\tsteps[++is] = scaleInvariant;\n\tsteps[++is] = sx;\n\tsteps[++is] = sy;\n\tsteps[++is] = br;\n\tsteps[++is] = bb;\n\n\tsteps[++is] = strokeWidth;\n\tsteps[++is] = scaleInvariant;\n\tsteps[++is] = sx;\n\tsteps[++is] = sy;\n\tsteps[++is] = wr;\n\tsteps[++is] = bb;\n\n\t// Bottom edge\n\tsteps[++is] = strokeWidth;\n\tsteps[++is] = scaleInvariant;\n\tsteps[++is] = sx;\n\tsteps[++is] = sy;\n\tsteps[++is] = bl;\n\tsteps[++is] = wb;\n\n\tsteps[++is] = strokeWidth;\n\tsteps[++is] = scaleInvariant;\n\tsteps[++is] = sx;\n\tsteps[++is] = sy;\n\tsteps[++is] = zb;\n\tsteps[++is] = wb;\n\n\tsteps[++is] = strokeWidth;\n\tsteps[++is] = scaleInvariant;\n\tsteps[++is] = sx;\n\tsteps[++is] = sy;\n\tsteps[++is] = br;\n\tsteps[++is] = wb;\n};\n\nexport const buildRectangleRoundedUv = (\n\tuvs: Float32Array,\n\tvoffset: number,\n\ttextureUvs: TextureUvs,\n\tworldSize: typeof RECTANGLE_ROUNDED_WORLD_SIZE\n): void => {\n\tconst x0 = textureUvs.x0;\n\tconst x1 = textureUvs.x1;\n\tconst x2 = textureUvs.x2;\n\tconst x3 = textureUvs.x3;\n\tconst y0 = textureUvs.y0;\n\tconst y1 = textureUvs.y1;\n\tconst y2 = textureUvs.y2;\n\tconst y3 = textureUvs.y3;\n\n\tconst x4 = 0.5 * (x0 + x1);\n\tconst y4 = 0.5 * (y0 + y1);\n\tconst x5 = 0.5 * (x3 + x2);\n\tconst y5 = 0.5 * (y3 + y2);\n\n\tconst ruvx = (0.5 * worldSize[0]) / worldSize[1];\n\tconst ruvy = (0.5 * worldSize[0]) / worldSize[2];\n\tconst d0x = ruvx * (x1 - x0);\n\tconst d0y = ruvx * (y1 - y0);\n\tconst d1x = ruvy * (x3 - x0);\n\tconst d1y = ruvy * (y3 - y0);\n\n\t// UVs\n\tlet iuv = voffset * 2 - 1;\n\n\t// Top-left corner\n\tuvs[++iuv] = x0;\n\tuvs[++iuv] = y0;\n\tuvs[++iuv] = x0 + d0x;\n\tuvs[++iuv] = y0 + d0y;\n\tuvs[++iuv] = x0 + d1x;\n\tuvs[++iuv] = y0 + d1y;\n\tuvs[++iuv] = x0 + d0x + d1x;\n\tuvs[++iuv] = y0 + d0y + d1y;\n\n\t// Top-right corner\n\tuvs[++iuv] = x1 - d0x;\n\tuvs[++iuv] = y1 - d0y;\n\tuvs[++iuv] = x1;\n\tuvs[++iuv] = y1;\n\tuvs[++iuv] = x1 - d0x + d1x;\n\tuvs[++iuv] = y1 - d0y + d1y;\n\tuvs[++iuv] = x1 + d1x;\n\tuvs[++iuv] = y1 + d1y;\n\n\t// Bottom-left corner\n\tuvs[++iuv] = x3 - d1x;\n\tuvs[++iuv] = y3 - d1y;\n\tuvs[++iuv] = x3 + d0x - d1x;\n\tuvs[++iuv] = y3 + d0y - d1y;\n\tuvs[++iuv] = x3;\n\tuvs[++iuv] = y3;\n\tuvs[++iuv] = x3 + d0x;\n\tuvs[++iuv] = y3 + d0y;\n\n\t// Bottom-right corner\n\tuvs[++iuv] = x2 - d0x - d1x;\n\tuvs[++iuv] = y2 - d0y - d1y;\n\tuvs[++iuv] = x2 - d1x;\n\tuvs[++iuv] = y2 - d1y;\n\tuvs[++iuv] = x2 - d0x;\n\tuvs[++iuv] = y2 - d0y;\n\tuvs[++iuv] = x2;\n\tuvs[++iuv] = y2;\n\n\t// Top edge\n\tuvs[++iuv] = x0 + d0x;\n\tuvs[++iuv] = y0 + d0y;\n\tuvs[++iuv] = x4;\n\tuvs[++iuv] = y4;\n\tuvs[++iuv] = x1 - d0x;\n\tuvs[++iuv] = y1 - d0y;\n\n\t// Top\n\tuvs[++iuv] = x0 + d1x;\n\tuvs[++iuv] = y0 + d1y;\n\tuvs[++iuv] = x0 + d1x + d0x;\n\tuvs[++iuv] = y0 + d1y + d0y;\n\tuvs[++iuv] = x4 + d1x;\n\tuvs[++iuv] = y4 + d1y;\n\tuvs[++iuv] = x1 + d1x - d0x;\n\tuvs[++iuv] = y1 + d1y - d0y;\n\tuvs[++iuv] = x1 + d1x;\n\tuvs[++iuv] = y1 + d1y;\n\n\t// Middle\n\tconst x02 = 0.5 * (x0 + x2);\n\tconst y02 = 0.5 * (y0 + y2);\n\tuvs[++iuv] = 0.5 * (x0 + x3);\n\tuvs[++iuv] = 0.5 * (y0 + y3);\n\tuvs[++iuv] = x02;\n\tuvs[++iuv] = y02;\n\tuvs[++iuv] = x02;\n\tuvs[++iuv] = y02;\n\tuvs[++iuv] = 0.5 * (x1 + x2);\n\tuvs[++iuv] = 0.5 * (y1 + y2);\n\n\t// Bottom\n\tuvs[++iuv] = x3 - d1x;\n\tuvs[++iuv] = y3 - d1y;\n\tuvs[++iuv] = x3 - d1x + d0x;\n\tuvs[++iuv] = y3 - d1y + d0y;\n\tuvs[++iuv] = x5 - d1x;\n\tuvs[++iuv] = y5 - d1y;\n\tuvs[++iuv] = x2 - d1x - d0x;\n\tuvs[++iuv] = y2 - d1y - d0y;\n\tuvs[++iuv] = x2 - d1x;\n\tuvs[++iuv] = y2 - d1y;\n\n\t// Bottom edge\n\tuvs[++iuv] = x3 + d0x;\n\tuvs[++iuv] = y3 + d0y;\n\tuvs[++iuv] = x5;\n\tuvs[++iuv] = y5;\n\tuvs[++iuv] = x2 - d0x;\n\tuvs[++iuv] = y2 - d0y;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeBuffer } from \"../e-shape-buffer\";\nimport { EShapeCorner } from \"../e-shape-corner\";\nimport {\n\tbuildRectangleRoundedClipping,\n\tbuildRectangleRoundedIndex,\n\tbuildRectangleRoundedStep,\n\tbuildRectangleRoundedUv,\n\tbuildRectangleRoundedVertex,\n\tRECTANGLE_ROUNDED_WORLD_SIZE\n} from \"./build-rectangle-rounded\";\nimport { BuilderBase } from \"./builder-base\";\nimport { toTexture, toTextureTransformId, toTextureUvs, toTransformLocalId } from \"./builders\";\n\nexport class BuilderRectangleRounded extends BuilderBase {\n\tprotected radius: number;\n\tprotected corner: EShapeCorner;\n\n\tconstructor(\n\t\tvertexOffset: number,\n\t\tindexOffset: number,\n\t\tvertexCount: number,\n\t\tindexCount: number\n\t) {\n\t\tsuper(vertexOffset, indexOffset, vertexCount, indexCount);\n\t\tthis.radius = NaN;\n\t\tthis.corner = NaN;\n\t}\n\n\tinit(buffer: EShapeBuffer): void {\n\t\tbuffer.updateIndices();\n\t\tbuildRectangleRoundedIndex(buffer.indices, this.vertexOffset, this.indexOffset);\n\t}\n\n\tupdate(buffer: EShapeBuffer, shape: EShape): void {\n\t\tthis.updateVertexClippingStepAndUv(buffer, shape);\n\t\tthis.updateColorFill(buffer, shape);\n\t\tthis.updateColorStroke(buffer, shape);\n\t}\n\n\tprotected updateVertexClippingStepAndUv(buffer: EShapeBuffer, shape: EShape): void {\n\t\tconst size = shape.size;\n\t\tconst sizeX = size.x;\n\t\tconst sizeY = size.y;\n\t\tconst radius = shape.radius;\n\t\tconst isSizeChanged =\n\t\t\tsizeX !== this.sizeX || sizeY !== this.sizeY || radius !== this.radius;\n\n\t\tconst transformLocalId = toTransformLocalId(shape);\n\t\tconst isTransformChanged = this.transformLocalId !== transformLocalId;\n\n\t\tconst stroke = shape.stroke;\n\t\tconst strokeAlign = stroke.align;\n\t\tconst strokeWidth = stroke.enable ? stroke.width : 0;\n\t\tconst strokeSide = stroke.side;\n\t\tconst strokeStyle = stroke.style;\n\t\tconst isStrokeChanged =\n\t\t\tthis.strokeAlign !== strokeAlign ||\n\t\t\tthis.strokeWidth !== strokeWidth ||\n\t\t\tthis.strokeSide !== strokeSide ||\n\t\t\tthis.strokeStyle !== strokeStyle;\n\n\t\tconst corner = shape.corner;\n\t\tconst isCornerChanged = corner !== this.corner;\n\n\t\tconst texture = toTexture(shape);\n\t\tconst textureTransformId = toTextureTransformId(texture);\n\t\tconst isTextureChanged =\n\t\t\ttexture !== this.texture || textureTransformId !== this.textureTransformId;\n\n\t\tconst isVertexChanged = isSizeChanged || isStrokeChanged;\n\n\t\tif (isVertexChanged || isTransformChanged || isCornerChanged || isTextureChanged) {\n\t\t\tthis.sizeX = sizeX;\n\t\t\tthis.sizeY = sizeY;\n\t\t\tthis.radius = radius;\n\t\t\tthis.transformLocalId = transformLocalId;\n\t\t\tthis.strokeAlign = strokeAlign;\n\t\t\tthis.strokeWidth = strokeWidth;\n\t\t\tthis.strokeSide = strokeSide;\n\t\t\tthis.strokeStyle = strokeStyle;\n\t\t\tthis.corner = corner;\n\t\t\tthis.texture = texture;\n\t\t\tthis.textureTransformId = textureTransformId;\n\n\t\t\t// Vertices\n\t\t\tconst voffset = this.vertexOffset;\n\t\t\tbuffer.updateVertices();\n\t\t\tbuildRectangleRoundedVertex(\n\t\t\t\tbuffer.vertices,\n\t\t\t\tvoffset,\n\t\t\t\t0,\n\t\t\t\t0,\n\t\t\t\tsizeX,\n\t\t\t\tsizeY,\n\t\t\t\tstrokeAlign,\n\t\t\t\tstrokeWidth,\n\t\t\t\tradius,\n\t\t\t\tshape.transform.internalTransform,\n\t\t\t\tRECTANGLE_ROUNDED_WORLD_SIZE\n\t\t\t);\n\n\t\t\t// Steps\n\t\t\tif (isVertexChanged || isCornerChanged || isTransformChanged) {\n\t\t\t\tbuffer.updateSteps();\n\t\t\t\tbuildRectangleRoundedStep(\n\t\t\t\t\tbuffer.steps,\n\t\t\t\t\tvoffset,\n\t\t\t\t\tstrokeWidth,\n\t\t\t\t\tstrokeSide,\n\t\t\t\t\tstrokeStyle,\n\t\t\t\t\tcorner,\n\t\t\t\t\tRECTANGLE_ROUNDED_WORLD_SIZE\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t// Clippings\n\t\t\tif (isVertexChanged || isCornerChanged) {\n\t\t\t\tbuffer.updateClippings();\n\t\t\t\tbuildRectangleRoundedClipping(\n\t\t\t\t\tbuffer.clippings,\n\t\t\t\t\tvoffset,\n\t\t\t\t\tcorner,\n\t\t\t\t\tRECTANGLE_ROUNDED_WORLD_SIZE\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t// UVs\n\t\t\tif (isVertexChanged || isTextureChanged) {\n\t\t\t\tbuffer.updateUvs();\n\t\t\t\tbuildRectangleRoundedUv(\n\t\t\t\t\tbuffer.uvs,\n\t\t\t\t\tvoffset,\n\t\t\t\t\ttoTextureUvs(texture),\n\t\t\t\t\tRECTANGLE_ROUNDED_WORLD_SIZE\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeBuffer } from \"../e-shape-buffer\";\nimport { EShapeUploaded, EShapeUploadedImpl } from \"../e-shape-uploaded\";\nimport {\n\tRECTANGLE_ROUNDED_INDEX_COUNT,\n\tRECTANGLE_ROUNDED_VERTEX_COUNT\n} from \"./build-rectangle-rounded\";\nimport { TEXT_INDEX_COUNT, TEXT_VERTEX_COUNT, toTextBufferCount } from \"./build-text\";\nimport { BuilderRectangleRounded } from \"./builder-rectangle-rounded\";\nimport { BuilderText } from \"./builder-text\";\n\nexport const createRectangleRoundedUploaded = (\n\tbuffer: EShapeBuffer,\n\tshape: EShape,\n\tvoffset: number,\n\tioffset: number,\n\tantialiasWeight: number\n): EShapeUploaded | null => {\n\tconst tcount = toTextBufferCount(shape);\n\tconst tvcount = tcount * TEXT_VERTEX_COUNT;\n\tconst ticount = tcount * TEXT_INDEX_COUNT;\n\tconst vcount = RECTANGLE_ROUNDED_VERTEX_COUNT + tvcount;\n\tconst icount = RECTANGLE_ROUNDED_INDEX_COUNT + ticount;\n\tif (buffer.check(voffset, ioffset, vcount, icount)) {\n\t\treturn new EShapeUploadedImpl(buffer, voffset, ioffset, vcount, icount, [\n\t\t\tnew BuilderRectangleRounded(voffset, ioffset, vcount - tvcount, icount - ticount),\n\t\t\tnew BuilderText(\n\t\t\t\tvoffset + RECTANGLE_ROUNDED_VERTEX_COUNT,\n\t\t\t\tioffset + RECTANGLE_ROUNDED_INDEX_COUNT,\n\t\t\t\ttvcount,\n\t\t\t\tticount\n\t\t\t)\n\t\t]).init(shape);\n\t}\n\treturn null;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeBuffer } from \"../e-shape-buffer\";\nimport { EShapeUploaded } from \"../e-shape-uploaded\";\nimport { createRectangleRoundedUploaded } from \"./create-rectangle-rounded-uploaded\";\n\nexport const createButtonUploaded = (\n\tbuffer: EShapeBuffer,\n\tshape: EShape,\n\tvoffset: number,\n\tioffset: number,\n\tantialiasWeight: number\n): EShapeUploaded | null => {\n\treturn createRectangleRoundedUploaded(buffer, shape, voffset, ioffset, antialiasWeight);\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeCorner } from \"../e-shape-corner\";\nimport { EShapeStrokeSide } from \"../e-shape-stroke-side\";\n\nconst hitTestRectangleRounded_ = (\n\tx: number,\n\ty: number,\n\tax: number,\n\tay: number,\n\tr: number,\n\tcorner: EShapeCorner\n): boolean => {\n\tconst bx0 = -ax + r;\n\tif (x <= bx0) {\n\t\tconst by0 = -ay + r;\n\t\tif (y <= by0 && corner & EShapeCorner.TOP_LEFT) {\n\t\t\t// Top-left corner\n\t\t\tconst dx = x - bx0;\n\t\t\tconst dy = y - by0;\n\t\t\treturn dx * dx + dy * dy <= r * r;\n\t\t} else {\n\t\t\tconst by1 = +ay - r;\n\t\t\tif (by1 <= y && corner & EShapeCorner.BOTTOM_LEFT) {\n\t\t\t\t// Bottom-left corner\n\t\t\t\tconst dx = x - bx0;\n\t\t\t\tconst dy = y - by1;\n\t\t\t\treturn dx * dx + dy * dy <= r * r;\n\t\t\t} else {\n\t\t\t\t// Middle-left box\n\t\t\t\treturn -ax <= x;\n\t\t\t}\n\t\t}\n\t} else {\n\t\tconst bx1 = +ax - r;\n\t\tif (bx1 <= x) {\n\t\t\tconst by0 = -ay + r;\n\t\t\tif (y <= by0 && corner & EShapeCorner.TOP_RIGHT) {\n\t\t\t\t// Top-right corner\n\t\t\t\tconst dx = x - bx1;\n\t\t\t\tconst dy = y - by0;\n\t\t\t\treturn dx * dx + dy * dy <= r * r;\n\t\t\t} else {\n\t\t\t\tconst by1 = +ay - r;\n\t\t\t\tif (by1 <= y && corner & EShapeCorner.BOTTOM_RIGHT) {\n\t\t\t\t\t// Bottom-right corner\n\t\t\t\t\tconst dx = x - bx1;\n\t\t\t\t\tconst dy = y - by1;\n\t\t\t\t\treturn dx * dx + dy * dy <= r * r;\n\t\t\t\t} else {\n\t\t\t\t\t// Middle-right box\n\t\t\t\t\treturn x <= +ax;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\treturn -ay <= y && y <= +ay;\n\t\t}\n\t}\n};\n\nexport const hitTestRectangleRounded = (\n\tshape: EShape,\n\tx: number,\n\ty: number,\n\tax: number,\n\tay: number,\n\tsw: number,\n\tss: number\n): boolean => {\n\tconst fill = shape.fill;\n\tif (fill.enable || 0 < sw) {\n\t\tconst r = shape.radius * Math.min(ax, ay);\n\t\tconst corner = shape.corner;\n\t\tif (hitTestRectangleRounded_(x, y, ax, ay, r, corner)) {\n\t\t\tif (fill.enable) {\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\tconst s = sw * ss;\n\t\t\t\tconst wx = Math.max(0.0, ax - s);\n\t\t\t\tconst wy = Math.max(0.0, ay - s);\n\t\t\t\tconst wr = Math.max(0.0, r - s);\n\t\t\t\tif (!hitTestRectangleRounded_(x, y, wx, wy, wr, corner)) {\n\t\t\t\t\tconst strokeSide = shape.stroke.side;\n\t\t\t\t\tif (strokeSide === EShapeStrokeSide.ALL) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (x <= -wx + wr) {\n\t\t\t\t\t\t\tconst hasLeftSide = !!(strokeSide & EShapeStrokeSide.LEFT);\n\t\t\t\t\t\t\tif (y <= -wy + wr) {\n\t\t\t\t\t\t\t\tconst hasTopSide = !!(strokeSide & EShapeStrokeSide.TOP);\n\t\t\t\t\t\t\t\tif (hasTopSide && hasLeftSide) {\n\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t} else if (hasTopSide) {\n\t\t\t\t\t\t\t\t\treturn -wx <= y;\n\t\t\t\t\t\t\t\t} else if (hasLeftSide) {\n\t\t\t\t\t\t\t\t\treturn x <= -wx;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else if (+wy - wr <= y) {\n\t\t\t\t\t\t\t\tconst hasBottomSide = !!(strokeSide & EShapeStrokeSide.BOTTOM);\n\t\t\t\t\t\t\t\tif (hasBottomSide && hasLeftSide) {\n\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t} else if (hasBottomSide) {\n\t\t\t\t\t\t\t\t\treturn +wx <= y;\n\t\t\t\t\t\t\t\t} else if (hasLeftSide) {\n\t\t\t\t\t\t\t\t\treturn x <= -wx;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\treturn hasLeftSide;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (+wx - wr <= x) {\n\t\t\t\t\t\t\tconst hasRightSide = !!(strokeSide & EShapeStrokeSide.RIGHT);\n\t\t\t\t\t\t\tif (y <= -wy + wr) {\n\t\t\t\t\t\t\t\tconst hasTopSide = !!(strokeSide & EShapeStrokeSide.TOP);\n\t\t\t\t\t\t\t\tif (hasTopSide && hasRightSide) {\n\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t} else if (hasTopSide) {\n\t\t\t\t\t\t\t\t\treturn -wx <= y;\n\t\t\t\t\t\t\t\t} else if (hasRightSide) {\n\t\t\t\t\t\t\t\t\treturn +wx <= x;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else if (+wy - wr <= y) {\n\t\t\t\t\t\t\t\tconst hasBottomSide = !!(strokeSide & EShapeStrokeSide.BOTTOM);\n\t\t\t\t\t\t\t\tif (hasBottomSide && hasRightSide) {\n\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t} else if (hasBottomSide) {\n\t\t\t\t\t\t\t\t\treturn +wx <= y;\n\t\t\t\t\t\t\t\t} else if (hasRightSide) {\n\t\t\t\t\t\t\t\t\treturn +wx <= x;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\treturn hasRightSide;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (y <= -wy + wr) {\n\t\t\t\t\t\t\t\treturn !!(strokeSide & EShapeStrokeSide.TOP);\n\t\t\t\t\t\t\t} else if (+wy - wr <= y) {\n\t\t\t\t\t\t\t\treturn !!(strokeSide & EShapeStrokeSide.BOTTOM);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn false;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapePrimitive } from \"./e-shape-primitive\";\nimport { hitTestRectangleRounded } from \"./hit-test-rectangle-rounded\";\n\nexport class EShapeRectangleRounded extends EShapePrimitive {\n\tconstructor(type: EShapeType = EShapeType.RECTANGLE_ROUNDED) {\n\t\tsuper(type);\n\t}\n\n\tclone(): EShapeRectangleRounded {\n\t\treturn new EShapeRectangleRounded(this.type).copy(this);\n\t}\n\n\tcontainsAbs(\n\t\tx: number,\n\t\ty: number,\n\t\tax: number,\n\t\tay: number,\n\t\tsw: number,\n\t\tss: number,\n\t\tsa: number\n\t): boolean {\n\t\tif (super.containsAbsBBox(x, y, ax, ay)) {\n\t\t\treturn hitTestRectangleRounded(this, x, y, ax, ay, sw, ss);\n\t\t}\n\t\treturn false;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapeRectangleRounded } from \"./e-shape-rectangle-rounded\";\n\nexport class EShapeButton extends EShapeRectangleRounded {\n\tprotected _isToggle: boolean;\n\tprotected _isGrouped: boolean;\n\n\tconstructor(type: EShapeType = EShapeType.BUTTON) {\n\t\tsuper(type);\n\t\tthis._isToggle = false;\n\t\tthis._isGrouped = false;\n\t}\n\n\tget isToggle(): boolean {\n\t\treturn this._isToggle;\n\t}\n\n\tset isToggle(isToggle: boolean) {\n\t\tthis._isToggle = isToggle;\n\t}\n\n\t/**\n\t * All the sibling buttons whose `isGrouped` is true is considered to to be grouped.\n\t */\n\tget isGrouped(): boolean {\n\t\treturn this._isGrouped;\n\t}\n\n\tset isGrouped(isGrouped: boolean) {\n\t\tthis._isGrouped = isGrouped;\n\t}\n\n\tclone(): EShapeRectangleRounded {\n\t\treturn new EShapeButton(this.type).copy(this);\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): DDiagramSerializedItem {\n\t\tconst result = super.serialize(manager);\n\t\tconst isToggle = this._isToggle ? 1 : 0;\n\t\tconst isGrouped = this._isGrouped ? 2 : 0;\n\t\tresult[15] = manager.addResource(`[${isToggle | isGrouped}]`);\n\t\treturn result;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { deserializeBase } from \"./deserialize-base\";\nimport { EShapeButton } from \"./e-shape-button\";\n\nexport const deserializeButton = (\n\titem: DDiagramSerializedItem,\n\tmanager: EShapeResourceManagerDeserialization,\n\tshape?: EShapeButton\n): Promise<EShapeButton> | EShapeButton => {\n\tshape = shape || new EShapeButton();\n\tconst resources = manager.resources;\n\tconst resourceId = item[15];\n\tif (0 <= resourceId && resourceId < resources.length) {\n\t\tlet parsed = manager.getExtension<[number]>(resourceId);\n\t\tif (parsed == null) {\n\t\t\tparsed = JSON.parse(resources[resourceId]) as [number];\n\t\t\tmanager.setExtension(resourceId, parsed);\n\t\t}\n\t\tshape.isToggle = !!(parsed[0] & 1);\n\t\tshape.isGrouped = !!(parsed[0] & 2);\n\t}\n\treturn deserializeBase(item, manager, shape);\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeActionValueMisc } from \"./e-shape-action-value-misc\";\nimport { EShapeActionValueMiscType } from \"./e-shape-action-value-misc-type\";\nimport { EShapeActionValueOnInputAction } from \"./e-shape-action-value-on-input-action\";\n\nexport class EShapeActionValueMiscEmitEvent extends EShapeActionValueMisc {\n\tconstructor(condition: string, target: string) {\n\t\tsuper(\n\t\t\tEShapeActionValueMiscType.EMIT_EVENT,\n\t\t\tcondition,\n\t\t\ttarget,\n\t\t\tEShapeActionValueOnInputAction.EMIT_EVENT,\n\t\t\t\"\"\n\t\t);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeActionValueMisc } from \"./e-shape-action-value-misc\";\nimport { EShapeActionValueMiscType } from \"./e-shape-action-value-misc-type\";\nimport { EShapeActionValueOnInputAction } from \"./e-shape-action-value-on-input-action\";\n\nexport class EShapeActionValueMiscHtmlElement extends EShapeActionValueMisc {\n\tconstructor(\n\t\tsubtype:\n\t\t\t| typeof EShapeActionValueMiscType.HTML_ELEMENT\n\t\t\t| typeof EShapeActionValueMiscType.HTML_ELEMENT_WITHOUT_POINTER_EVENTS,\n\t\twhen: string,\n\t\tinitializer: string\n\t) {\n\t\tsuper(subtype, when, \"\", EShapeActionValueOnInputAction.EMIT_EVENT, initializer);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeActionValueMisc } from \"./e-shape-action-value-misc\";\nimport { EShapeActionValueMiscType } from \"./e-shape-action-value-misc-type\";\nimport { EShapeActionValueOnInputAction } from \"./e-shape-action-value-on-input-action\";\n\nexport class EShapeActionValueMiscInput extends EShapeActionValueMisc {\n\tconstructor(\n\t\tsubtype:\n\t\t\t| typeof EShapeActionValueMiscType.INPUT_TEXT\n\t\t\t| typeof EShapeActionValueMiscType.INPUT_REAL\n\t\t\t| typeof EShapeActionValueMiscType.INPUT_INTEGER,\n\t\twhen: string,\n\t\ttarget: string,\n\t\tonInputAction: EShapeActionValueOnInputAction\n\t) {\n\t\tsuper(subtype, when, target, onInputAction, \"\");\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeActionValueMisc } from \"./e-shape-action-value-misc\";\nimport { EShapeActionValueMiscType } from \"./e-shape-action-value-misc-type\";\nimport { EShapeActionValueOnInputAction } from \"./e-shape-action-value-on-input-action\";\n\nexport class EShapeActionValueMiscWrite extends EShapeActionValueMisc {\n\tconstructor(\n\t\tsubtype:\n\t\t\t| typeof EShapeActionValueMiscType.WRITE_BOTH\n\t\t\t| typeof EShapeActionValueMiscType.WRITE_LOCAL\n\t\t\t| typeof EShapeActionValueMiscType.WRITE_REMOTE,\n\t\tcondition: string,\n\t\ttarget: string,\n\t\tvalue: string\n\t) {\n\t\tsuper(subtype, condition, target, EShapeActionValueOnInputAction.EMIT_EVENT, value);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { UtilRgb } from \"../../util/util-rgb\";\nimport { EShapeActionRuntime } from \"../action\";\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\nimport { EShapeStateSet } from \"../e-shape-state-set\";\n\nexport class EShapeButtonRuntimeAction extends EShapeActionRuntime {\n\tprotected readonly _fillColor: number;\n\tprotected readonly _fillColorDisabled: number;\n\tprotected readonly _fillColorPressed: number;\n\tprotected readonly _fillColorHovered: number;\n\n\tprotected readonly _fillAlpha: number;\n\tprotected readonly _fillAlphaDisabled: number;\n\n\tprotected readonly _strokeColor: number;\n\tprotected readonly _strokeColorDisabled: number;\n\tprotected readonly _strokeColorPressed: number;\n\tprotected readonly _strokeColorHovered: number;\n\n\tprotected readonly _strokeAlpha: number;\n\tprotected readonly _strokeAlphaDisabled: number;\n\n\tprotected readonly _textColor: number;\n\tprotected readonly _textColorDisabled: number;\n\n\tprotected readonly _textAlpha: number;\n\tprotected readonly _textAlphaDisabled: number;\n\n\tprotected readonly _textOutlineColor: number;\n\tprotected readonly _textOutlineColorDisabled: number;\n\n\tprotected readonly _textOutlineAlpha: number;\n\tprotected readonly _textOutlineAlphaDisabled: number;\n\n\tconstructor(runtime: EShapeRuntime) {\n\t\tsuper(\n\t\t\tEShapeRuntimeReset.COLOR_FILL_AND_STROKE |\n\t\t\t\tEShapeRuntimeReset.COLOR_TEXT |\n\t\t\t\tEShapeRuntimeReset.COLOR_TEXT_OUTLINE |\n\t\t\t\tEShapeRuntimeReset.CURSOR\n\t\t);\n\n\t\tconst fill = runtime.fill;\n\t\tconst fillColor = fill.color;\n\t\tconst fillColorOnHovered = this.toOnHovered(fillColor);\n\t\tconst fillColorOnPressed = fillColorOnHovered * 2;\n\t\tthis._fillColor = fillColor;\n\t\tthis._fillColorDisabled = UtilRgb.toGrayscale(fillColor);\n\t\tthis._fillColorPressed = UtilRgb.darken(fillColor, fillColorOnPressed);\n\t\tthis._fillColorHovered = UtilRgb.darken(fillColor, fillColorOnHovered);\n\n\t\tconst fillAlpha = fill.alpha;\n\t\tthis._fillAlpha = fillAlpha;\n\t\tthis._fillAlphaDisabled = fillAlpha * 0.5;\n\n\t\tconst stroke = runtime.stroke;\n\t\tconst strokeColor = stroke.color;\n\t\tconst strokeColorOnHovered = this.toOnHovered(strokeColor);\n\t\tconst strokeColorOnPressed = strokeColorOnHovered * 2;\n\t\tthis._strokeColor = strokeColor;\n\t\tthis._strokeColorDisabled = UtilRgb.toGrayscale(strokeColor);\n\t\tthis._strokeColorPressed = UtilRgb.darken(strokeColor, strokeColorOnPressed);\n\t\tthis._strokeColorHovered = UtilRgb.darken(strokeColor, strokeColorOnHovered);\n\n\t\tconst strokeAlpha = stroke.alpha;\n\t\tthis._strokeAlpha = strokeAlpha;\n\t\tthis._strokeAlphaDisabled = strokeAlpha * 0.5;\n\n\t\tconst text = runtime.text;\n\t\tconst textColor = text.color;\n\t\tthis._textColor = textColor;\n\t\tthis._textColorDisabled = UtilRgb.toGrayscale(textColor);\n\n\t\tconst textAlpha = text.alpha;\n\t\tthis._textAlpha = textAlpha;\n\t\tthis._textAlphaDisabled = textAlpha * 0.5;\n\n\t\tconst textOutline = text.outline;\n\t\tconst textOutlineColor = textOutline.color;\n\t\tthis._textOutlineColor = textOutlineColor;\n\t\tthis._textOutlineColorDisabled = UtilRgb.toGrayscale(textOutlineColor);\n\n\t\tconst textOutlineAlpha = textOutline.alpha;\n\t\tthis._textOutlineAlpha = textOutlineAlpha;\n\t\tthis._textOutlineAlphaDisabled = textOutlineAlpha * 0.5;\n\t}\n\n\tprotected toOnHovered(color: number): number {\n\t\tconst luma = UtilRgb.toLuma(color);\n\t\tif (128 <= luma) {\n\t\t\tconst t = (luma - 128) / 127;\n\t\t\treturn +0.15 * (1 - t) + t * 0.03;\n\t\t} else {\n\t\t\tconst t = (127 - luma) / 127;\n\t\t\treturn -0.15 * (1 - t) - t * 0.175;\n\t\t}\n\t}\n\n\texecute(shape: EShape, runtime: EShapeRuntime, time: number): void {\n\t\tconst state = shape.state;\n\t\tshape.fill.set(undefined, this.getFillColor(state), this.getFillAlpha(state));\n\t\tshape.stroke.set(undefined, this.getStrokeColor(state), this.getStrokeAlpha(state));\n\t\tshape.text.set(undefined, this.getTextColor(state), this.getTextAlpha(state));\n\t\tshape.text.outline.set(\n\t\t\tundefined,\n\t\t\tthis.getTextOutlineColor(state),\n\t\t\tthis.getTextOutlineAlpha(state)\n\t\t);\n\t\tshape.cursor = this.getCursor(state);\n\t\truntime.written |= this.reset;\n\t}\n\n\tprotected getFillColor(state: EShapeStateSet): number {\n\t\tif (state.inDisabled) {\n\t\t\treturn this._fillColorDisabled;\n\t\t} else if (state.isPressed || state.isActive) {\n\t\t\treturn this._fillColorPressed;\n\t\t} else if (state.isFocused || state.isHovered) {\n\t\t\treturn this._fillColorHovered;\n\t\t} else {\n\t\t\treturn this._fillColor;\n\t\t}\n\t}\n\n\tprotected getFillAlpha(state: EShapeStateSet): number {\n\t\tif (state.inDisabled) {\n\t\t\treturn this._fillAlphaDisabled;\n\t\t} else {\n\t\t\treturn this._fillAlpha;\n\t\t}\n\t}\n\n\tprotected getStrokeColor(state: EShapeStateSet): number {\n\t\tif (state.inDisabled) {\n\t\t\treturn this._strokeColorDisabled;\n\t\t} else if (state.isPressed || state.isActive) {\n\t\t\treturn this._strokeColorPressed;\n\t\t} else if (state.isFocused || state.isHovered) {\n\t\t\treturn this._strokeColorHovered;\n\t\t} else {\n\t\t\treturn this._strokeColor;\n\t\t}\n\t}\n\n\tprotected getStrokeAlpha(state: EShapeStateSet): number {\n\t\tif (state.inDisabled) {\n\t\t\treturn this._strokeAlphaDisabled;\n\t\t} else {\n\t\t\treturn this._strokeAlpha;\n\t\t}\n\t}\n\n\tprotected getTextColor(state: EShapeStateSet): number {\n\t\tif (state.inDisabled) {\n\t\t\treturn this._textColorDisabled;\n\t\t} else {\n\t\t\treturn this._textColor;\n\t\t}\n\t}\n\n\tprotected getTextAlpha(state: EShapeStateSet): number {\n\t\tif (state.inDisabled) {\n\t\t\treturn this._textAlphaDisabled;\n\t\t} else {\n\t\t\treturn this._textAlpha;\n\t\t}\n\t}\n\n\tprotected getTextOutlineColor(state: EShapeStateSet): number {\n\t\tif (state.inDisabled) {\n\t\t\treturn this._textOutlineColorDisabled;\n\t\t} else {\n\t\t\treturn this._textOutlineColor;\n\t\t}\n\t}\n\n\tprotected getTextOutlineAlpha(state: EShapeStateSet): number {\n\t\tif (state.inDisabled) {\n\t\t\treturn this._textOutlineAlphaDisabled;\n\t\t} else {\n\t\t\treturn this._textOutlineAlpha;\n\t\t}\n\t}\n\n\tgetCursor(state: EShapeStateSet): string {\n\t\tif (state.isActionable) {\n\t\t\treturn \"pointer\";\n\t\t}\n\t\treturn \"\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { UtilRgb } from \"../../util/util-rgb\";\nimport { EShapeActionRuntime } from \"../action\";\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\nimport { EShapeStateSet } from \"../e-shape-state-set\";\n\nexport class EShapeButtonRuntimeActionToggle extends EShapeActionRuntime {\n\tprotected readonly _fillColorActive: number;\n\tprotected readonly _fillColorActivePressed: number;\n\tprotected readonly _fillColorActiveHovered: number;\n\tprotected readonly _fillColor: number;\n\tprotected readonly _fillColorPressed: number;\n\tprotected readonly _fillColorHovered: number;\n\n\tprotected readonly _fillAlpha: number;\n\tprotected readonly _fillAlphaDisabled: number;\n\n\tprotected readonly _strokeColorActive: number;\n\tprotected readonly _strokeColorActivePressed: number;\n\tprotected readonly _strokeColorActiveHovered: number;\n\tprotected readonly _strokeColor: number;\n\tprotected readonly _strokeColorPressed: number;\n\tprotected readonly _strokeColorGrayscaleHovered: number;\n\n\tprotected readonly _strokeAlpha: number;\n\tprotected readonly _strokeAlphaDisabled: number;\n\n\tprotected readonly _textColorActive: number;\n\tprotected readonly _textColor: number;\n\tprotected readonly _textColorDisabled: number;\n\n\tprotected readonly _textAlpha: number;\n\tprotected readonly _textAlphaDisabled: number;\n\n\tprotected readonly _textOutlineColor: number;\n\tprotected readonly _textOutlineColorDisabled: number;\n\n\tprotected readonly _textOutlineAlpha: number;\n\tprotected readonly _textOutlineAlphaDisabled: number;\n\n\tconstructor(runtime: EShapeRuntime) {\n\t\tsuper(\n\t\t\tEShapeRuntimeReset.COLOR_FILL_AND_STROKE |\n\t\t\t\tEShapeRuntimeReset.COLOR_TEXT |\n\t\t\t\tEShapeRuntimeReset.COLOR_TEXT_OUTLINE |\n\t\t\t\tEShapeRuntimeReset.CURSOR\n\t\t);\n\n\t\tconst fill = runtime.fill;\n\t\tconst fillColorActive = fill.color;\n\t\tthis._fillColorActive = fillColorActive;\n\t\tconst fillColorActiveOnHovered = this.toOnHovered(fillColorActive);\n\t\tconst fillColorActiveOnPressed = fillColorActiveOnHovered * 2;\n\t\tthis._fillColorActivePressed = UtilRgb.darken(fillColorActive, fillColorActiveOnPressed);\n\t\tthis._fillColorActiveHovered = UtilRgb.darken(fillColorActive, fillColorActiveOnHovered);\n\t\tconst fillColor = 0xe7e5e7;\n\t\tthis._fillColor = fillColor;\n\t\tconst fillColorOnHovered = this.toOnHovered(fillColor);\n\t\tconst fillColorOnPressed = fillColorOnHovered * 2;\n\t\tthis._fillColorPressed = UtilRgb.darken(fillColor, fillColorOnPressed);\n\t\tthis._fillColorHovered = UtilRgb.darken(fillColor, fillColorOnHovered);\n\n\t\tconst fillAlpha = fill.alpha;\n\t\tthis._fillAlpha = fillAlpha;\n\t\tthis._fillAlphaDisabled = fillAlpha * 0.5;\n\n\t\tconst stroke = runtime.stroke;\n\t\tconst strokeColorActive = stroke.color;\n\t\tthis._strokeColorActive = strokeColorActive;\n\t\tconst strokeColorActiveOnHovered = this.toOnHovered(strokeColorActive);\n\t\tconst strokeColorActiveOnPressed = strokeColorActiveOnHovered * 2;\n\t\tthis._strokeColorActivePressed = UtilRgb.darken(\n\t\t\tstrokeColorActive,\n\t\t\tstrokeColorActiveOnPressed\n\t\t);\n\t\tthis._strokeColorActiveHovered = UtilRgb.darken(\n\t\t\tstrokeColorActive,\n\t\t\tstrokeColorActiveOnHovered\n\t\t);\n\t\tconst strokeColor = 0xe7e5e7;\n\t\tthis._strokeColor = strokeColor;\n\t\tconst strokeColorOnHovered = this.toOnHovered(strokeColor);\n\t\tconst strokeColorOnPressed = strokeColorOnHovered * 2;\n\t\tthis._strokeColorPressed = UtilRgb.darken(strokeColor, strokeColorOnPressed);\n\t\tthis._strokeColorGrayscaleHovered = UtilRgb.darken(strokeColor, strokeColorOnHovered);\n\n\t\tconst strokeAlpha = stroke.alpha;\n\t\tthis._strokeAlpha = strokeAlpha;\n\t\tthis._strokeAlphaDisabled = strokeAlpha * 0.5;\n\n\t\tconst text = runtime.text;\n\t\tconst textColor = text.color;\n\t\tthis._textColorActive = textColor;\n\t\tthis._textColorDisabled = UtilRgb.toGrayscale(textColor);\n\t\tthis._textColor = 0x4f4f4f;\n\n\t\tconst textAlpha = text.alpha;\n\t\tthis._textAlpha = textAlpha;\n\t\tthis._textAlphaDisabled = textAlpha * 0.5;\n\n\t\tconst textOutline = text.outline;\n\t\tconst textOutlineColor = textOutline.color;\n\t\tthis._textOutlineColor = textOutlineColor;\n\t\tthis._textOutlineColorDisabled = UtilRgb.toGrayscale(textOutlineColor);\n\n\t\tconst textOutlineAlpha = textOutline.alpha;\n\t\tthis._textOutlineAlpha = textOutlineAlpha;\n\t\tthis._textOutlineAlphaDisabled = textOutlineAlpha * 0.5;\n\t}\n\n\tprotected toOnHovered(color: number): number {\n\t\tconst luma = UtilRgb.toLuma(color);\n\t\tif (128 <= luma) {\n\t\t\tconst t = (luma - 128) / 127;\n\t\t\treturn +0.15 * (1 - t) + t * 0.03;\n\t\t} else {\n\t\t\tconst t = (127 - luma) / 127;\n\t\t\treturn -0.15 * (1 - t) - t * 0.175;\n\t\t}\n\t}\n\n\texecute(shape: EShape, runtime: EShapeRuntime, time: number): void {\n\t\tconst state = shape.state;\n\t\tshape.fill.set(undefined, this.getFillColor(state), this.getFillAlpha(state));\n\t\tshape.stroke.set(undefined, this.getStrokeColor(state), this.getStrokeAlpha(state));\n\t\tshape.text.set(undefined, this.getTextColor(state), this.getTextAlpha(state));\n\t\tshape.text.outline.set(\n\t\t\tundefined,\n\t\t\tthis.getTextOutlineColor(state),\n\t\t\tthis.getTextOutlineAlpha(state)\n\t\t);\n\t\tshape.cursor = this.getCursor(state);\n\t\truntime.written |= this.reset;\n\t}\n\n\tprotected getFillColor(state: EShapeStateSet): number {\n\t\tif (state.inDisabled) {\n\t\t\treturn this._fillColor;\n\t\t} else if (state.isActive) {\n\t\t\tif (state.isPressed) {\n\t\t\t\treturn this._fillColorActivePressed;\n\t\t\t} else if (state.isFocused || state.isHovered) {\n\t\t\t\treturn this._fillColorActiveHovered;\n\t\t\t} else {\n\t\t\t\treturn this._fillColorActive;\n\t\t\t}\n\t\t} else {\n\t\t\tif (state.isPressed) {\n\t\t\t\treturn this._fillColorPressed;\n\t\t\t} else if (state.isFocused || state.isHovered) {\n\t\t\t\treturn this._fillColorHovered;\n\t\t\t} else {\n\t\t\t\treturn this._fillColor;\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected getFillAlpha(state: EShapeStateSet): number {\n\t\tif (state.inDisabled) {\n\t\t\treturn this._fillAlphaDisabled;\n\t\t} else {\n\t\t\treturn this._fillAlpha;\n\t\t}\n\t}\n\n\tprotected getStrokeColor(state: EShapeStateSet): number {\n\t\tif (state.inDisabled) {\n\t\t\treturn this._strokeColor;\n\t\t} else if (state.isActive) {\n\t\t\tif (state.isPressed) {\n\t\t\t\treturn this._strokeColorActivePressed;\n\t\t\t} else if (state.isFocused || state.isHovered) {\n\t\t\t\treturn this._strokeColorActiveHovered;\n\t\t\t} else {\n\t\t\t\treturn this._strokeColorActive;\n\t\t\t}\n\t\t} else {\n\t\t\tif (state.isPressed) {\n\t\t\t\treturn this._strokeColorPressed;\n\t\t\t} else if (state.isFocused || state.isHovered) {\n\t\t\t\treturn this._strokeColorGrayscaleHovered;\n\t\t\t} else {\n\t\t\t\treturn this._strokeColor;\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected getStrokeAlpha(state: EShapeStateSet): number {\n\t\tif (state.inDisabled) {\n\t\t\treturn this._strokeAlphaDisabled;\n\t\t} else {\n\t\t\treturn this._strokeAlpha;\n\t\t}\n\t}\n\n\tprotected getTextColor(state: EShapeStateSet): number {\n\t\tif (state.inDisabled) {\n\t\t\treturn this._textColorDisabled;\n\t\t} else if (state.isActive) {\n\t\t\treturn this._textColorActive;\n\t\t} else {\n\t\t\treturn this._textColor;\n\t\t}\n\t}\n\n\tprotected getTextAlpha(state: EShapeStateSet): number {\n\t\tif (state.inDisabled) {\n\t\t\treturn this._textAlphaDisabled;\n\t\t} else {\n\t\t\treturn this._textAlpha;\n\t\t}\n\t}\n\n\tprotected getTextOutlineColor(state: EShapeStateSet): number {\n\t\tif (state.inDisabled) {\n\t\t\treturn this._textOutlineColorDisabled;\n\t\t} else {\n\t\t\treturn this._textOutlineColor;\n\t\t}\n\t}\n\n\tprotected getTextOutlineAlpha(state: EShapeStateSet): number {\n\t\tif (state.inDisabled) {\n\t\t\treturn this._textOutlineAlphaDisabled;\n\t\t} else {\n\t\t\treturn this._textOutlineAlpha;\n\t\t}\n\t}\n\n\tgetCursor(state: EShapeStateSet): string {\n\t\tif (state.isActionable) {\n\t\t\treturn \"pointer\";\n\t\t}\n\t\treturn \"\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction } from \"pixi.js\";\nimport { DBaseStateSet } from \"../../d-base-state-set\";\nimport { EShape } from \"../e-shape\";\nimport { EShapeRuntime } from \"../e-shape-runtime\";\nimport { EShapeState } from \"../e-shape-state\";\nimport { EShapeButton } from \"./e-shape-button\";\nimport { EShapeButtonRuntimeAction } from \"./e-shape-button-runtime-action\";\nimport { EShapeButtonRuntimeActionToggle } from \"./e-shape-button-runtime-action-toggle\";\n\nexport class EShapeButtonRuntime extends EShapeRuntime {\n\tprotected _isToggle?: boolean;\n\tprotected _isGrouped?: boolean;\n\n\tconstructor(shape: EShape) {\n\t\tsuper(shape);\n\t\tif (shape instanceof EShapeButton) {\n\t\t\tthis._isToggle = shape.isToggle;\n\t\t\tthis._isGrouped = shape.isGrouped;\n\t\t}\n\t}\n\n\tisActionable(): boolean {\n\t\treturn true;\n\t}\n\n\tinitialize(shape: EShape): void {\n\t\tthis.actions.unshift(\n\t\t\tthis._isToggle\n\t\t\t\t? new EShapeButtonRuntimeActionToggle(this)\n\t\t\t\t: new EShapeButtonRuntimeAction(this)\n\t\t);\n\t\tsuper.initialize(shape);\n\t}\n\n\tonClick(shape: EShape, e: interaction.InteractionEvent | KeyboardEvent): void {\n\t\tconst state = shape.state;\n\t\tconst wasClicked = state.isClicked;\n\t\tstate.lock();\n\t\tsuper.onClick(shape, e);\n\t\tif (!wasClicked && state.isClicked) {\n\t\t\tif (this._isToggle) {\n\t\t\t\tstate.isActive = !state.isActive;\n\t\t\t} else {\n\t\t\t\tif (!state.isActive) {\n\t\t\t\t\tstate.isActivated = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tstate.unlock();\n\t}\n\n\tonStateChange(shape: EShape, newState: DBaseStateSet, oldState: DBaseStateSet): void {\n\t\tsuper.onStateChange(shape, newState, oldState);\n\t\tif (this._isToggle && this._isGrouped && newState.is(EShapeState.ACTIVATED)) {\n\t\t\tthis.onActivated(shape);\n\t\t}\n\t}\n\n\tprotected onActivated(shape: EShape): void {\n\t\t// Deactivate other group buttons\n\t\tconst parent = shape.parent;\n\t\tif (parent != null) {\n\t\t\tconst children = parent.children;\n\t\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\t\tconst child = children[i];\n\t\t\t\tif (\n\t\t\t\t\tchild !== shape &&\n\t\t\t\t\tchild instanceof EShapeButton &&\n\t\t\t\t\tchild.isToggle &&\n\t\t\t\t\tchild.isGrouped\n\t\t\t\t) {\n\t\t\t\t\tchild.state.isActive = false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeCapabilities } from \"../e-shape-capabilities\";\nimport { EShapeCapability } from \"../e-shape-capability\";\nimport { EShapeDeserializers } from \"../e-shape-deserializers\";\nimport { EShapeRuntimes } from \"../e-shape-runtimes\";\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapeUploadeds } from \"../e-shape-uploadeds\";\nimport { createButtonUploaded } from \"../variant/create-button-uploaded\";\nimport { deserializeButton } from \"../variant/deserialize-button\";\nimport { EShapeButtonRuntime } from \"../variant/e-shape-button-runtime\";\n\nexport const loadShapeButton = (): void => {\n\tEShapeUploadeds[EShapeType.BUTTON] = createButtonUploaded;\n\tEShapeDeserializers[EShapeType.BUTTON] = deserializeButton;\n\tEShapeRuntimes[EShapeType.BUTTON] = EShapeButtonRuntime;\n\tEShapeCapabilities.set(\n\t\tEShapeType.BUTTON,\n\t\tEShapeCapability.PRIMITIVE | EShapeCapability.STROKE_SIDE | EShapeCapability.BORDER_RADIUS\n\t);\n};\n","import { Matrix, Point, TextureUvs } from \"pixi.js\";\nimport { EShapeStrokeStyle } from \"../e-shape-stroke-style\";\nimport { toLength } from \"./to-length\";\nimport { toScaleInvariant } from \"./to-scale-invariant\";\n\nexport const CIRCLE_VERTEX_COUNT = 9;\nexport const CIRCLE_INDEX_COUNT = 8;\nexport const CIRCLE_WORLD_SIZE: [number, number] = [0, 0];\nconst CIRCLE_WORK_POINT: Point = new Point();\n\nexport const buildCircleClipping = (clippings: Float32Array, voffset: number): void => {\n\tlet ic = voffset * 3 - 1;\n\tclippings[++ic] = 1;\n\tclippings[++ic] = 1;\n\tclippings[++ic] = 1;\n\n\tclippings[++ic] = 0;\n\tclippings[++ic] = 1;\n\tclippings[++ic] = 1;\n\n\tclippings[++ic] = 1;\n\tclippings[++ic] = 1;\n\tclippings[++ic] = 1;\n\n\tclippings[++ic] = 1;\n\tclippings[++ic] = 0;\n\tclippings[++ic] = 1;\n\n\tclippings[++ic] = 0;\n\tclippings[++ic] = 0;\n\tclippings[++ic] = 1;\n\n\tclippings[++ic] = 1;\n\tclippings[++ic] = 0;\n\tclippings[++ic] = 1;\n\n\tclippings[++ic] = 1;\n\tclippings[++ic] = 1;\n\tclippings[++ic] = 1;\n\n\tclippings[++ic] = 0;\n\tclippings[++ic] = 1;\n\tclippings[++ic] = 1;\n\n\tclippings[++ic] = 1;\n\tclippings[++ic] = 1;\n\tclippings[++ic] = 1;\n};\n\nexport const buildCircleIndex = (\n\tindices: Uint16Array | Uint32Array,\n\tvoffset: number,\n\tioffset: number\n): void => {\n\tlet ii = ioffset * 3 - 1;\n\tindices[++ii] = voffset;\n\tindices[++ii] = voffset + 1;\n\tindices[++ii] = voffset + 3;\n\n\tindices[++ii] = voffset + 1;\n\tindices[++ii] = voffset + 4;\n\tindices[++ii] = voffset + 3;\n\n\tindices[++ii] = voffset + 1;\n\tindices[++ii] = voffset + 2;\n\tindices[++ii] = voffset + 4;\n\n\tindices[++ii] = voffset + 2;\n\tindices[++ii] = voffset + 5;\n\tindices[++ii] = voffset + 4;\n\n\tindices[++ii] = voffset + 3;\n\tindices[++ii] = voffset + 4;\n\tindices[++ii] = voffset + 6;\n\n\tindices[++ii] = voffset + 4;\n\tindices[++ii] = voffset + 7;\n\tindices[++ii] = voffset + 6;\n\n\tindices[++ii] = voffset + 4;\n\tindices[++ii] = voffset + 5;\n\tindices[++ii] = voffset + 7;\n\n\tindices[++ii] = voffset + 5;\n\tindices[++ii] = voffset + 8;\n\tindices[++ii] = voffset + 7;\n};\n\nexport const buildCircleVertex = (\n\tvertices: Float32Array,\n\tvoffset: number,\n\toriginX: number,\n\toriginY: number,\n\tsizeX: number,\n\tsizeY: number,\n\tstrokeAlign: number,\n\tstrokeWidth: number,\n\tinternalTransform: Matrix,\n\tworldSize: typeof CIRCLE_WORLD_SIZE\n): void => {\n\t// Calculate the transformed positions\n\t//\n\t//  0       1       2\n\t// |-------|-------|\n\t// |3      |4      |5\n\t// |-------|-------|\n\t// |6      |7      |8\n\t// |-------|-------|\n\t//\n\tconst work = CIRCLE_WORK_POINT;\n\tconst s = strokeAlign * strokeWidth;\n\tconst sx = sizeX * 0.5 + (0 <= sizeX ? +s : -s);\n\tconst sy = sizeY * 0.5 + (0 <= sizeY ? +s : -s);\n\twork.set(-sx + originX, -sy + originY);\n\tinternalTransform.apply(work, work);\n\tconst x0 = work.x;\n\tconst y0 = work.y;\n\twork.set(0 + originX, -sy + originY);\n\tinternalTransform.apply(work, work);\n\tconst x1 = work.x;\n\tconst y1 = work.y;\n\tconst dx = x1 - x0;\n\tconst dy = y1 - y0;\n\twork.set(originX, originY);\n\tinternalTransform.apply(work, work);\n\tconst x4 = work.x;\n\tconst y4 = work.y;\n\tconst x7 = x4 + (x4 - x1);\n\tconst y7 = y4 + (y4 - y1);\n\tconst x3 = x4 - dx;\n\tconst y3 = y4 - dy;\n\n\t// Vertices\n\tlet iv = voffset * 2 - 1;\n\tvertices[++iv] = x0;\n\tvertices[++iv] = y0;\n\tvertices[++iv] = x1;\n\tvertices[++iv] = y1;\n\tvertices[++iv] = x1 + dx;\n\tvertices[++iv] = y1 + dy;\n\n\tvertices[++iv] = x3;\n\tvertices[++iv] = y3;\n\tvertices[++iv] = x4;\n\tvertices[++iv] = y4;\n\tvertices[++iv] = x4 + dx;\n\tvertices[++iv] = y4 + dy;\n\n\tvertices[++iv] = x7 - dx;\n\tvertices[++iv] = y7 - dy;\n\tvertices[++iv] = x7;\n\tvertices[++iv] = y7;\n\tvertices[++iv] = x7 + dx;\n\tvertices[++iv] = y7 + dy;\n\n\tworldSize[0] = toLength(x0, y0, x1, y1);\n\tworldSize[1] = toLength(x0, y0, x3, y3);\n};\n\nexport const buildCircleStep = (\n\tsteps: Float32Array,\n\tclippings: Float32Array,\n\tvoffset: number,\n\tstrokeWidth: number,\n\tstrokeStyle: EShapeStrokeStyle,\n\tworldSize: typeof CIRCLE_WORLD_SIZE\n): void => {\n\tconst scaleInvariant = toScaleInvariant(strokeStyle);\n\tlet is = voffset * 6 - 1;\n\tlet ic = voffset * 3;\n\tfor (let i = 0; i < CIRCLE_VERTEX_COUNT; i += 1, ic += 3) {\n\t\tsteps[++is] = strokeWidth;\n\t\tsteps[++is] = scaleInvariant;\n\t\tsteps[++is] = worldSize[0];\n\t\tsteps[++is] = worldSize[1];\n\t\tsteps[++is] = 1 + clippings[ic];\n\t\tsteps[++is] = 1 + clippings[ic + 1];\n\t}\n};\n\nexport const buildCircleUv = (uvs: Float32Array, voffset: number, textureUvs: TextureUvs): void => {\n\tconst x0 = textureUvs.x0;\n\tconst x1 = textureUvs.x1;\n\tconst x2 = textureUvs.x2;\n\tconst x3 = textureUvs.x3;\n\tconst y0 = textureUvs.y0;\n\tconst y1 = textureUvs.y1;\n\tconst y2 = textureUvs.y2;\n\tconst y3 = textureUvs.y3;\n\n\t// UVs\n\tlet iuv = voffset * 2 - 1;\n\tuvs[++iuv] = x0;\n\tuvs[++iuv] = y0;\n\tuvs[++iuv] = 0.5 * (x0 + x1);\n\tuvs[++iuv] = 0.5 * (y0 + y1);\n\tuvs[++iuv] = x1;\n\tuvs[++iuv] = y1;\n\n\tuvs[++iuv] = 0.5 * (x0 + x3);\n\tuvs[++iuv] = 0.5 * (y0 + y3);\n\tuvs[++iuv] = 0.5 * (x0 + x2);\n\tuvs[++iuv] = 0.5 * (y0 + y2);\n\tuvs[++iuv] = 0.5 * (x1 + x2);\n\tuvs[++iuv] = 0.5 * (y1 + y2);\n\n\tuvs[++iuv] = x3;\n\tuvs[++iuv] = y3;\n\tuvs[++iuv] = 0.5 * (x3 + x2);\n\tuvs[++iuv] = 0.5 * (y3 + y2);\n\tuvs[++iuv] = x2;\n\tuvs[++iuv] = y2;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeBuffer } from \"../e-shape-buffer\";\nimport {\n\tbuildCircleClipping,\n\tbuildCircleIndex,\n\tbuildCircleStep,\n\tbuildCircleUv,\n\tbuildCircleVertex,\n\tCIRCLE_INDEX_COUNT,\n\tCIRCLE_VERTEX_COUNT,\n\tCIRCLE_WORLD_SIZE\n} from \"./build-circle\";\nimport { BuilderBase } from \"./builder-base\";\nimport { toTexture, toTextureTransformId, toTextureUvs, toTransformLocalId } from \"./builders\";\n\nexport class BuilderCircle extends BuilderBase {\n\tconstructor(vertexOffset: number, indexOffset: number) {\n\t\tsuper(vertexOffset, indexOffset, CIRCLE_VERTEX_COUNT, CIRCLE_INDEX_COUNT);\n\t}\n\n\tinit(buffer: EShapeBuffer): void {\n\t\tbuffer.updateClippings();\n\t\tbuffer.updateIndices();\n\t\tconst voffset = this.vertexOffset;\n\t\tbuildCircleClipping(buffer.clippings, voffset);\n\t\tbuildCircleIndex(buffer.indices, voffset, this.indexOffset);\n\t}\n\n\tupdate(buffer: EShapeBuffer, shape: EShape): void {\n\t\tthis.updateVertexAndStep(buffer, shape);\n\t\tthis.updateColorFill(buffer, shape);\n\t\tthis.updateColorStroke(buffer, shape);\n\t\tthis.updateUv(buffer, shape);\n\t}\n\n\tprotected updateVertexAndStep(buffer: EShapeBuffer, shape: EShape): void {\n\t\tconst size = shape.size;\n\t\tconst sizeX = size.x;\n\t\tconst sizeY = size.y;\n\t\tconst isSizeChanged = sizeX !== this.sizeX || sizeY !== this.sizeY;\n\n\t\tconst transformLocalId = toTransformLocalId(shape);\n\t\tconst isTransformChanged = this.transformLocalId !== transformLocalId;\n\n\t\tconst stroke = shape.stroke;\n\t\tconst strokeAlign = stroke.align;\n\t\tconst strokeWidth = stroke.enable ? stroke.width : 0;\n\t\tconst strokeStyle = stroke.style;\n\t\tconst isStrokeChanged =\n\t\t\tthis.strokeAlign !== strokeAlign ||\n\t\t\tthis.strokeWidth !== strokeWidth ||\n\t\t\tthis.strokeStyle !== strokeStyle;\n\n\t\tif (isSizeChanged || isTransformChanged || isStrokeChanged) {\n\t\t\tthis.sizeX = sizeX;\n\t\t\tthis.sizeY = sizeY;\n\t\t\tthis.transformLocalId = transformLocalId;\n\t\t\tthis.strokeAlign = strokeAlign;\n\t\t\tthis.strokeWidth = strokeWidth;\n\t\t\tthis.strokeStyle = strokeStyle;\n\n\t\t\t// Buffer\n\t\t\tbuffer.updateVertices();\n\t\t\tbuffer.updateSteps();\n\t\t\tbuildCircleVertex(\n\t\t\t\tbuffer.vertices,\n\t\t\t\tthis.vertexOffset,\n\t\t\t\t0,\n\t\t\t\t0,\n\t\t\t\tsizeX,\n\t\t\t\tsizeY,\n\t\t\t\tstrokeAlign,\n\t\t\t\tstrokeWidth,\n\t\t\t\tshape.transform.internalTransform,\n\t\t\t\tCIRCLE_WORLD_SIZE\n\t\t\t);\n\t\t\tbuildCircleStep(\n\t\t\t\tbuffer.steps,\n\t\t\t\tbuffer.clippings,\n\t\t\t\tthis.vertexOffset,\n\t\t\t\tstrokeWidth,\n\t\t\t\tstrokeStyle,\n\t\t\t\tCIRCLE_WORLD_SIZE\n\t\t\t);\n\t\t}\n\t}\n\n\tprotected updateUv(buffer: EShapeBuffer, shape: EShape): void {\n\t\tconst texture = toTexture(shape);\n\t\tconst textureTransformId = toTextureTransformId(texture);\n\t\tif (texture !== this.texture || textureTransformId !== this.textureTransformId) {\n\t\t\tthis.texture = texture;\n\t\t\tthis.textureTransformId = textureTransformId;\n\n\t\t\tbuffer.updateUvs();\n\t\t\tconst textureUvs = toTextureUvs(texture);\n\t\t\tbuildCircleUv(buffer.uvs, this.vertexOffset, textureUvs);\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeBuffer } from \"../e-shape-buffer\";\nimport { EShapeUploaded, EShapeUploadedImpl } from \"../e-shape-uploaded\";\nimport { CIRCLE_INDEX_COUNT, CIRCLE_VERTEX_COUNT } from \"./build-circle\";\nimport { TEXT_INDEX_COUNT, TEXT_VERTEX_COUNT, toTextBufferCount } from \"./build-text\";\nimport { BuilderCircle } from \"./builder-circle\";\nimport { BuilderText } from \"./builder-text\";\n\nexport const createCircle = (\n\tbuffer: EShapeBuffer,\n\tshape: EShape,\n\tvoffset: number,\n\tioffset: number,\n\tantialiasWeight: number\n): EShapeUploaded | null => {\n\tconst tcount = toTextBufferCount(shape);\n\tconst tvcount = tcount * TEXT_VERTEX_COUNT;\n\tconst ticount = tcount * TEXT_INDEX_COUNT;\n\tconst vcount = CIRCLE_VERTEX_COUNT + tvcount;\n\tconst icount = CIRCLE_INDEX_COUNT + ticount;\n\tif (buffer.check(voffset, ioffset, vcount, icount)) {\n\t\treturn new EShapeUploadedImpl(buffer, voffset, ioffset, vcount, icount, [\n\t\t\tnew BuilderCircle(voffset, ioffset),\n\t\t\tnew BuilderText(\n\t\t\t\tvoffset + CIRCLE_VERTEX_COUNT,\n\t\t\t\tioffset + CIRCLE_INDEX_COUNT,\n\t\t\t\ttvcount,\n\t\t\t\tticount\n\t\t\t)\n\t\t]).init(shape);\n\t}\n\treturn null;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapePrimitive } from \"./e-shape-primitive\";\nimport { hitTestCircle } from \"./hit-test-circle\";\n\nexport class EShapeCircle extends EShapePrimitive {\n\tconstructor(type: EShapeType = EShapeType.CIRCLE) {\n\t\tsuper(type);\n\t}\n\n\tclone(): EShapeCircle {\n\t\treturn new EShapeCircle(this.type).copy(this);\n\t}\n\n\tcontainsAbs(\n\t\tx: number,\n\t\ty: number,\n\t\tax: number,\n\t\tay: number,\n\t\tsw: number,\n\t\tss: number,\n\t\tsa: number\n\t): boolean {\n\t\tif (super.containsAbsBBox(x, y, ax, ay)) {\n\t\t\treturn hitTestCircle(this, x, y, ax, ay, sw, ss);\n\t\t}\n\t\treturn false;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { deserializeBase } from \"./deserialize-base\";\nimport { EShapeCircle } from \"./e-shape-circle\";\n\nexport const deserializeCircle = (\n\titem: DDiagramSerializedItem,\n\tmanager: EShapeResourceManagerDeserialization,\n\tshape?: EShapeCircle\n): Promise<EShapeCircle> | EShapeCircle => {\n\treturn deserializeBase(item, manager, shape || new EShapeCircle());\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeDeserializers } from \"../e-shape-deserializers\";\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapeUploadeds } from \"../e-shape-uploadeds\";\nimport { createCircle } from \"../variant/create-circle-uploaded\";\nimport { deserializeCircle } from \"../variant/deserialize-circle\";\n\nexport const loadShapeCircle = (): void => {\n\tEShapeUploadeds[EShapeType.CIRCLE] = createCircle;\n\tEShapeDeserializers[EShapeType.CIRCLE] = deserializeCircle;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeBuffer } from \"../e-shape-buffer\";\nimport { EShapePointsStyle } from \"../e-shape-points-style\";\nimport {\n\tbuildLineClipping,\n\tbuildLineIndex,\n\tbuildLineUv,\n\tbuildLineVertexStepAndColorFill,\n\ttoLinePointCount,\n\ttoLineVertexCount\n} from \"./build-line\";\nimport { BuilderBase } from \"./builder-base\";\nimport { toTexture, toTextureTransformId, toTextureUvs, toTransformLocalId } from \"./builders\";\n\nexport class BuilderLine extends BuilderBase {\n\tprotected pointCount: number;\n\tprotected pointId: number;\n\tprotected pointsClosed: boolean;\n\tprotected length: number;\n\n\tconstructor(\n\t\tvertexOffset: number,\n\t\tindexOffset: number,\n\t\tvertexCount: number,\n\t\tindexCount: number\n\t) {\n\t\tsuper(vertexOffset, indexOffset, vertexCount, indexCount);\n\t\tthis.pointId = -1;\n\t\tthis.pointCount = 0;\n\t\tthis.pointsClosed = false;\n\t\tthis.length = 1;\n\t}\n\n\tinit(buffer: EShapeBuffer): void {\n\t\tbuffer.updateIndices();\n\t\tbuildLineIndex(buffer.indices, this.vertexOffset, this.indexOffset, this.indexCount);\n\t}\n\n\tisCompatible(shape: EShape): boolean {\n\t\tconst vcount = toLineVertexCount(toLinePointCount(shape.points), true);\n\t\treturn vcount === this.vertexCount;\n\t}\n\n\tupdate(buffer: EShapeBuffer, shape: EShape): void {\n\t\tthis.updateLineClipping(buffer, shape);\n\t\tthis.updateLineVertexStepAndColorFill(buffer, shape);\n\t\tthis.updateColorStroke(buffer, shape);\n\t\tthis.updateLineUv(buffer, shape);\n\t}\n\n\tprotected updateLineClipping(buffer: EShapeBuffer, shape: EShape): void {\n\t\tconst points = shape.points;\n\t\tif (points) {\n\t\t\tconst formatted = points.formatted;\n\t\t\tconst pointCount = formatted.length;\n\t\t\tif (this.pointCount !== pointCount) {\n\t\t\t\tthis.pointCount = pointCount;\n\n\t\t\t\t// Invalidate the pointId to update the vertices\n\t\t\t\tthis.pointId = -1;\n\n\t\t\t\tbuffer.updateClippings();\n\t\t\t\tbuildLineClipping(\n\t\t\t\t\tbuffer.clippings,\n\t\t\t\t\tthis.vertexOffset,\n\t\t\t\t\tthis.vertexCount,\n\t\t\t\t\tpointCount\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected updateLineVertexStepAndColorFill(buffer: EShapeBuffer, shape: EShape): void {\n\t\tconst points = shape.points;\n\t\tif (points) {\n\t\t\tconst pointId = points.id;\n\t\t\tconst formatted = points.formatted;\n\t\t\tconst pointsClosed = !!(formatted.style & EShapePointsStyle.CLOSED);\n\t\t\tconst isPointChanged = pointId !== this.pointId || pointsClosed !== this.pointsClosed;\n\n\t\t\tconst stroke = shape.stroke;\n\t\t\tconst strokeWidth = stroke.enable ? stroke.width : 0;\n\t\t\tconst strokeStyle = stroke.style;\n\t\t\tconst isStrokeWidthChanged =\n\t\t\t\tthis.strokeWidth !== strokeWidth || this.strokeStyle !== strokeStyle;\n\n\t\t\tconst transformLocalId = toTransformLocalId(shape);\n\t\t\tconst isTransformChanged = this.transformLocalId !== transformLocalId;\n\n\t\t\tif (isPointChanged || isTransformChanged || isStrokeWidthChanged) {\n\t\t\t\tthis.pointId = pointId;\n\t\t\t\tthis.pointsClosed = pointsClosed;\n\t\t\t\tthis.strokeWidth = strokeWidth;\n\t\t\t\tthis.strokeStyle = strokeStyle;\n\t\t\t\tthis.transformLocalId = transformLocalId;\n\n\t\t\t\tif (isPointChanged) {\n\t\t\t\t\t// Invalidate the texture transform ID to update the UVs\n\t\t\t\t\tthis.textureTransformId = NaN;\n\t\t\t\t}\n\n\t\t\t\tbuffer.updateVertices();\n\t\t\t\tbuffer.updateSteps();\n\t\t\t\tbuffer.updateColorFills();\n\t\t\t\tthis.length = buildLineVertexStepAndColorFill(\n\t\t\t\t\tbuffer.vertices,\n\t\t\t\t\tbuffer.steps,\n\t\t\t\t\tbuffer.colorFills,\n\t\t\t\t\tthis.vertexOffset,\n\t\t\t\t\tthis.vertexCount,\n\t\t\t\t\tthis.pointCount,\n\t\t\t\t\tthis.pointsClosed,\n\t\t\t\t\tformatted.values,\n\t\t\t\t\tformatted.segments,\n\t\t\t\t\tstrokeWidth,\n\t\t\t\t\tstrokeStyle,\n\t\t\t\t\tshape.transform.internalTransform\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected updateLineUv(buffer: EShapeBuffer, shape: EShape): void {\n\t\tconst texture = toTexture(shape);\n\t\tconst textureTransformId = toTextureTransformId(texture);\n\t\tif (texture !== this.texture || textureTransformId !== this.textureTransformId) {\n\t\t\tthis.texture = texture;\n\t\t\tthis.textureTransformId = textureTransformId;\n\n\t\t\tbuffer.updateUvs();\n\t\t\tbuildLineUv(\n\t\t\t\tbuffer.uvs,\n\t\t\t\tbuffer.colorFills,\n\t\t\t\tthis.vertexOffset,\n\t\t\t\tthis.vertexCount,\n\t\t\t\ttoTextureUvs(texture),\n\t\t\t\tthis.length\n\t\t\t);\n\t\t}\n\t}\n}\n","import { Matrix, Point, TextureUvs } from \"pixi.js\";\nimport { EShapeStrokeStyle } from \"../e-shape-stroke-style\";\nimport { toLength } from \"./to-length\";\nimport { toScaleInvariant } from \"./to-scale-invariant\";\n\nexport const TRIANGLE_VERTEX_COUNT = 7;\nexport const TRIANGLE_INDEX_COUNT = 3;\nexport const TRIANGLE_WORLD_SIZE: [number, number, number] = [0, 0, 0];\nconst TRIANGLE_WORK_POINT: Point = new Point();\n\nexport const buildTriangleClipping = (clippings: Float32Array, voffset: number): void => {\n\t// Clippings\n\tlet iv = voffset * 3 - 1;\n\tclippings[++iv] = 0;\n\tclippings[++iv] = 0;\n\tclippings[++iv] = 0;\n\n\tclippings[++iv] = 1;\n\tclippings[++iv] = 0;\n\tclippings[++iv] = 0;\n\n\tclippings[++iv] = 1;\n\tclippings[++iv] = 0;\n\tclippings[++iv] = 0;\n\n\tclippings[++iv] = 0;\n\tclippings[++iv] = 1;\n\tclippings[++iv] = 0;\n\n\tclippings[++iv] = 0;\n\tclippings[++iv] = 1;\n\tclippings[++iv] = 0;\n\n\tclippings[++iv] = 1;\n\tclippings[++iv] = 0;\n\tclippings[++iv] = 0;\n\n\tclippings[++iv] = 1;\n\tclippings[++iv] = 0;\n\tclippings[++iv] = 0;\n};\n\nexport const buildTriangleIndex = (\n\tindices: Uint16Array | Uint32Array,\n\tvoffset: number,\n\tioffset: number\n): void => {\n\t// Indices\n\tlet ii = ioffset * 3 - 1;\n\tindices[++ii] = voffset + 0;\n\tindices[++ii] = voffset + 1;\n\tindices[++ii] = voffset + 2;\n\n\tindices[++ii] = voffset + 0;\n\tindices[++ii] = voffset + 3;\n\tindices[++ii] = voffset + 4;\n\n\tindices[++ii] = voffset + 0;\n\tindices[++ii] = voffset + 5;\n\tindices[++ii] = voffset + 6;\n};\n\nexport const buildTriangleVertex = (\n\tvertices: Float32Array,\n\tvoffset: number,\n\toriginX: number,\n\toriginY: number,\n\tsizeX: number,\n\tsizeY: number,\n\tstrokeAlign: number,\n\tstrokeWidth: number,\n\tinternalTransform: Matrix,\n\tworldSize: typeof TRIANGLE_WORLD_SIZE\n): void => {\n\tconst s = strokeAlign * strokeWidth;\n\tconst sx = sizeX * 0.5 + (0 <= sizeX ? +s : -s);\n\tconst sy = sizeY * 0.5 + (0 <= sizeY ? +s : -s);\n\tconst sz = Math.sqrt(sx * sx + 4 * sy * sy);\n\tconst sw = (2 * sx * sy) / (sx + sz);\n\n\tconst work = TRIANGLE_WORK_POINT;\n\twork.set(originX, originY - sy);\n\tinternalTransform.apply(work, work);\n\tconst x0 = work.x;\n\tconst y0 = work.y;\n\twork.set(originX, originY);\n\tinternalTransform.apply(work, work);\n\tconst tx = work.x;\n\tconst ty = work.y;\n\twork.set(originX + sx, originY);\n\tinternalTransform.apply(work, work);\n\tconst dx = tx - x0;\n\tconst dy = ty - y0;\n\tconst x1 = work.x + dx;\n\tconst y1 = work.y + dy;\n\tconst x2 = tx + (tx - work.x) + dx;\n\tconst y2 = ty + (ty - work.y) + dy;\n\twork.set(originX, originY + sy - sw); // Incenter of a triangle\n\tinternalTransform.apply(work, work);\n\tconst x3 = work.x;\n\tconst y3 = work.y;\n\n\t// World size\n\tconst xb = tx + dx;\n\tconst yb = ty + dy;\n\tworldSize[0] = toLength(xb, yb, x3, y3);\n\tworldSize[1] = toLength(x1, y1, xb, yb);\n\tworldSize[2] = toLength(x0, y0, tx, ty);\n\n\t// Vertices\n\tlet iv = (voffset << 1) - 1;\n\tvertices[++iv] = x3;\n\tvertices[++iv] = y3;\n\n\tvertices[++iv] = x0;\n\tvertices[++iv] = y0;\n\tvertices[++iv] = x1;\n\tvertices[++iv] = y1;\n\n\tvertices[++iv] = x1;\n\tvertices[++iv] = y1;\n\tvertices[++iv] = x2;\n\tvertices[++iv] = y2;\n\n\tvertices[++iv] = x2;\n\tvertices[++iv] = y2;\n\tvertices[++iv] = x0;\n\tvertices[++iv] = y0;\n};\n\nexport const buildTriangleStep = (\n\tsteps: Float32Array,\n\tclippings: Float32Array,\n\tvoffset: number,\n\tvcount: number,\n\tstrokeWidth: number,\n\tstrokeStyle: EShapeStrokeStyle,\n\tworldSize: typeof TRIANGLE_WORLD_SIZE\n): void => {\n\tconst scaleInvariant = toScaleInvariant(strokeStyle);\n\tconst s = worldSize[0];\n\n\tlet is = voffset * 6 - 1;\n\tlet ic = voffset * 3;\n\tfor (let i = 0; i < vcount; i += 1, ic += 3) {\n\t\tsteps[++is] = strokeWidth;\n\t\tsteps[++is] = scaleInvariant;\n\t\tsteps[++is] = s;\n\t\tsteps[++is] = s;\n\t\tsteps[++is] = 1 + clippings[ic];\n\t\tsteps[++is] = 1 + clippings[ic + 1];\n\t}\n};\n\nexport const buildTriangleUv = (\n\tuvs: Float32Array,\n\ttextureUvs: TextureUvs,\n\tvoffset: number,\n\tworldSize: typeof TRIANGLE_WORLD_SIZE\n): void => {\n\tconst x0 = textureUvs.x0;\n\tconst x1 = textureUvs.x1;\n\tconst x2 = textureUvs.x2;\n\tconst x3 = textureUvs.x3;\n\tconst y0 = textureUvs.y0;\n\tconst y1 = textureUvs.y1;\n\tconst y2 = textureUvs.y2;\n\tconst y3 = textureUvs.y3;\n\n\tconst x4 = 0.5 * (x0 + x1);\n\tconst y4 = 0.5 * (y0 + y1);\n\n\tconst c = 1 - (0.5 * worldSize[0]) / worldSize[2];\n\tconst x5 = x4 + c * (x3 - x0);\n\tconst y5 = y4 + c * (y3 - y0);\n\n\tlet iuv = (voffset << 1) - 1;\n\tuvs[++iuv] = x5;\n\tuvs[++iuv] = y5;\n\n\tuvs[++iuv] = x4;\n\tuvs[++iuv] = y4;\n\tuvs[++iuv] = x2;\n\tuvs[++iuv] = y2;\n\n\tuvs[++iuv] = x2;\n\tuvs[++iuv] = y2;\n\tuvs[++iuv] = x3;\n\tuvs[++iuv] = y3;\n\n\tuvs[++iuv] = x3;\n\tuvs[++iuv] = y3;\n\tuvs[++iuv] = x4;\n\tuvs[++iuv] = y4;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeBuffer } from \"../e-shape-buffer\";\nimport { EShapePointsMarker } from \"../e-shape-points-marker\";\nimport { EShapePointsMarkerContainer } from \"../e-shape-points-marker-container\";\nimport { buildColor } from \"./build-color\";\nimport { BuilderBase } from \"./builder-base\";\n\nexport abstract class BuilderMarkerBase extends BuilderBase {\n\tprotected updateColorFill(buffer: EShapeBuffer, shape: EShape): void {\n\t\tconst points = shape.points;\n\t\tif (points == null) {\n\t\t\treturn;\n\t\t}\n\t\tconst container = points.getMarker();\n\t\tif (container == null) {\n\t\t\treturn;\n\t\t}\n\t\tconst marker = this.toMarker(container);\n\t\tconst fill = marker.fill;\n\t\tconst isEnabled = shape.visible && fill.enable;\n\t\tconst color = fill.color;\n\t\tconst alpha = isEnabled ? fill.alpha : 0;\n\t\tif (color !== this.colorFill || alpha !== this.alphaFill) {\n\t\t\tthis.colorFill = color;\n\t\t\tthis.alphaFill = alpha;\n\t\t\tbuffer.updateColorFills();\n\n\t\t\tbuildColor(color, alpha, this.vertexOffset, this.vertexCount, buffer.colorFills);\n\t\t}\n\t}\n\n\tprotected abstract toMarker(container: EShapePointsMarkerContainer): EShapePointsMarker;\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Matrix } from \"pixi.js\";\nimport { EShape } from \"../e-shape\";\nimport { EShapeBuffer } from \"../e-shape-buffer\";\nimport {\n\tbuildTriangleClipping,\n\tbuildTriangleIndex,\n\tbuildTriangleStep,\n\tbuildTriangleUv,\n\tbuildTriangleVertex,\n\tTRIANGLE_INDEX_COUNT,\n\tTRIANGLE_VERTEX_COUNT,\n\tTRIANGLE_WORLD_SIZE\n} from \"./build-triangle\";\nimport { BuilderMarkerBase } from \"./builder-marker-base\";\nimport { toTexture, toTextureTransformId, toTextureUvs, toTransformLocalId } from \"./builders\";\n\nexport abstract class BuilderMarkerTriangle extends BuilderMarkerBase {\n\tprotected static WORK?: Matrix;\n\tprotected pointId: number;\n\n\tconstructor(vertexOffset: number, indexOffset: number) {\n\t\tsuper(vertexOffset, indexOffset, TRIANGLE_VERTEX_COUNT, TRIANGLE_INDEX_COUNT);\n\t\tthis.pointId = -1;\n\t}\n\n\tinit(buffer: EShapeBuffer): void {\n\t\tbuffer.updateClippings();\n\t\tbuffer.updateIndices();\n\t\tbuildTriangleClipping(buffer.clippings, this.vertexOffset);\n\t\tbuildTriangleIndex(buffer.indices, this.vertexOffset, this.indexOffset);\n\t}\n\n\tupdate(buffer: EShapeBuffer, shape: EShape): void {\n\t\tthis.updateVertexStepAndUv(buffer, shape);\n\t\tthis.updateColorFill(buffer, shape);\n\t\tthis.updateColorStroke(buffer, shape);\n\t}\n\n\tprotected updateVertexStepAndUv(buffer: EShapeBuffer, shape: EShape): void {\n\t\tconst points = shape.points;\n\t\tif (points == null) {\n\t\t\treturn;\n\t\t}\n\t\tconst container = points.getMarker();\n\t\tif (container == null) {\n\t\t\treturn;\n\t\t}\n\t\tconst marker = this.toMarker(container);\n\t\tconst size = marker.size;\n\t\tconst sizeX = size.x;\n\t\tconst sizeY = size.y;\n\t\tconst isSizeChanged = sizeX !== this.sizeX || sizeY !== this.sizeY;\n\n\t\tconst transformLocalId = toTransformLocalId(shape);\n\t\tconst isTransformChanged = this.transformLocalId !== transformLocalId;\n\n\t\tconst stroke = shape.stroke;\n\t\tconst strokeAlign = stroke.align;\n\t\tconst strokeWidth = stroke.enable ? stroke.width : 0;\n\t\tconst strokeStyle = stroke.style;\n\t\tconst isStrokeChanged =\n\t\t\tthis.strokeAlign !== strokeAlign ||\n\t\t\tthis.strokeWidth !== strokeWidth ||\n\t\t\tthis.strokeStyle !== strokeStyle;\n\n\t\tconst texture = toTexture(shape);\n\t\tconst textureTransformId = toTextureTransformId(texture);\n\t\tconst isTextureChanged =\n\t\t\ttexture !== this.texture || textureTransformId !== this.textureTransformId;\n\n\t\tconst isVertexChanged = isSizeChanged || isStrokeChanged;\n\n\t\tconst pointId = points.id;\n\t\tconst isPointChanged = pointId !== this.pointId;\n\n\t\tif (isVertexChanged || isTransformChanged || isTextureChanged || isPointChanged) {\n\t\t\tthis.sizeX = sizeX;\n\t\t\tthis.sizeY = sizeY;\n\t\t\tthis.transformLocalId = transformLocalId;\n\t\t\tthis.strokeAlign = strokeAlign;\n\t\t\tthis.strokeWidth = strokeWidth;\n\t\t\tthis.strokeStyle = strokeStyle;\n\t\t\tthis.texture = texture;\n\t\t\tthis.textureTransformId = textureTransformId;\n\t\t\tthis.pointId = pointId;\n\n\t\t\tconst voffset = this.vertexOffset;\n\t\t\tconst internalTransform = (BuilderMarkerTriangle.WORK ??= new Matrix());\n\t\t\tinternalTransform.copyFrom(marker.transform).prepend(shape.transform.internalTransform);\n\t\t\tbuffer.updateVertices();\n\t\t\tbuildTriangleVertex(\n\t\t\t\tbuffer.vertices,\n\t\t\t\tvoffset,\n\t\t\t\t0,\n\t\t\t\t0,\n\t\t\t\tsizeX,\n\t\t\t\tsizeY,\n\t\t\t\tstrokeAlign,\n\t\t\t\tstrokeWidth,\n\t\t\t\tinternalTransform,\n\t\t\t\tTRIANGLE_WORLD_SIZE\n\t\t\t);\n\n\t\t\tif (isVertexChanged || isTransformChanged) {\n\t\t\t\tbuffer.updateSteps();\n\t\t\t\tbuildTriangleStep(\n\t\t\t\t\tbuffer.steps,\n\t\t\t\t\tbuffer.clippings,\n\t\t\t\t\tvoffset,\n\t\t\t\t\tTRIANGLE_VERTEX_COUNT,\n\t\t\t\t\tstrokeWidth,\n\t\t\t\t\tstrokeStyle,\n\t\t\t\t\tTRIANGLE_WORLD_SIZE\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (isVertexChanged || isTextureChanged) {\n\t\t\t\tbuffer.updateUvs();\n\t\t\t\tbuildTriangleUv(buffer.uvs, toTextureUvs(texture), voffset, TRIANGLE_WORLD_SIZE);\n\t\t\t}\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapePointsMarker } from \"../e-shape-points-marker\";\nimport { EShapePointsMarkerContainer } from \"../e-shape-points-marker-container\";\nimport { BuilderMarkerTriangle } from \"./builder-marker-triangle\";\n\nexport class BuilderMarkerTriangleHead extends BuilderMarkerTriangle {\n\tprotected toMarker(container: EShapePointsMarkerContainer): EShapePointsMarker {\n\t\treturn container.head;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapePointsMarker } from \"../e-shape-points-marker\";\nimport { EShapePointsMarkerContainer } from \"../e-shape-points-marker-container\";\nimport { BuilderMarkerTriangle } from \"./builder-marker-triangle\";\n\nexport class BuilderMarkerTriangleTail extends BuilderMarkerTriangle {\n\tprotected toMarker(container: EShapePointsMarkerContainer): EShapePointsMarker {\n\t\treturn container.tail;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Matrix } from \"pixi.js\";\nimport { EShape } from \"../e-shape\";\nimport { EShapeBuffer } from \"../e-shape-buffer\";\nimport {\n\tbuildCircleClipping,\n\tbuildCircleIndex,\n\tbuildCircleStep,\n\tbuildCircleUv,\n\tbuildCircleVertex,\n\tCIRCLE_INDEX_COUNT,\n\tCIRCLE_VERTEX_COUNT,\n\tCIRCLE_WORLD_SIZE\n} from \"./build-circle\";\nimport { BuilderMarkerBase } from \"./builder-marker-base\";\nimport { toTexture, toTextureTransformId, toTextureUvs, toTransformLocalId } from \"./builders\";\n\nexport abstract class BuilderMarkerCircle extends BuilderMarkerBase {\n\tprotected static WORK?: Matrix;\n\tprotected pointId: number;\n\n\tconstructor(vertexOffset: number, indexOffset: number) {\n\t\tsuper(vertexOffset, indexOffset, CIRCLE_VERTEX_COUNT, CIRCLE_INDEX_COUNT);\n\t\tthis.pointId = -1;\n\t}\n\n\tinit(buffer: EShapeBuffer): void {\n\t\tbuffer.updateClippings();\n\t\tbuffer.updateIndices();\n\t\tconst vertexOffset = this.vertexOffset;\n\t\tbuildCircleClipping(buffer.clippings, vertexOffset);\n\t\tbuildCircleIndex(buffer.indices, vertexOffset, this.indexOffset);\n\t}\n\n\tupdate(buffer: EShapeBuffer, shape: EShape): void {\n\t\tthis.updateVertexAndStep(buffer, shape);\n\t\tthis.updateColorFill(buffer, shape);\n\t\tthis.updateColorStroke(buffer, shape);\n\t\tthis.updateUv(buffer, shape);\n\t}\n\n\tprotected updateVertexAndStep(buffer: EShapeBuffer, shape: EShape): void {\n\t\tconst points = shape.points;\n\t\tif (points == null) {\n\t\t\treturn;\n\t\t}\n\t\tconst container = points.getMarker();\n\t\tif (container == null) {\n\t\t\treturn;\n\t\t}\n\t\tconst marker = this.toMarker(container);\n\t\tconst size = marker.size;\n\t\tconst sizeX = size.x;\n\t\tconst sizeY = size.y;\n\t\tconst isSizeChanged = sizeX !== this.sizeX || sizeY !== this.sizeY;\n\n\t\tconst transformLocalId = toTransformLocalId(shape);\n\t\tconst isTransformChanged = this.transformLocalId !== transformLocalId;\n\n\t\tconst stroke = shape.stroke;\n\t\tconst strokeAlign = stroke.align;\n\t\tconst strokeWidth = stroke.enable ? stroke.width : 0;\n\t\tconst strokeStyle = stroke.style;\n\t\tconst isStrokeChanged =\n\t\t\tthis.strokeAlign !== strokeAlign ||\n\t\t\tthis.strokeWidth !== strokeWidth ||\n\t\t\tthis.strokeStyle !== strokeStyle;\n\n\t\tconst pointId = points.id;\n\t\tconst isPointChanged = pointId !== this.pointId;\n\n\t\tif (isSizeChanged || isTransformChanged || isStrokeChanged || isPointChanged) {\n\t\t\tthis.sizeX = sizeX;\n\t\t\tthis.sizeY = sizeY;\n\t\t\tthis.transformLocalId = transformLocalId;\n\t\t\tthis.strokeAlign = strokeAlign;\n\t\t\tthis.strokeWidth = strokeWidth;\n\t\t\tthis.strokeStyle = strokeStyle;\n\t\t\tthis.pointId = pointId;\n\n\t\t\t// Buffer\n\t\t\tconst internalTransform = (BuilderMarkerCircle.WORK ??= new Matrix());\n\t\t\tinternalTransform.copyFrom(marker.transform).prepend(shape.transform.internalTransform);\n\t\t\tbuffer.updateVertices();\n\t\t\tbuffer.updateSteps();\n\t\t\tbuildCircleVertex(\n\t\t\t\tbuffer.vertices,\n\t\t\t\tthis.vertexOffset,\n\t\t\t\t0,\n\t\t\t\t0,\n\t\t\t\tsizeX,\n\t\t\t\tsizeY,\n\t\t\t\tstrokeAlign,\n\t\t\t\tstrokeWidth,\n\t\t\t\tinternalTransform,\n\t\t\t\tCIRCLE_WORLD_SIZE\n\t\t\t);\n\t\t\tbuildCircleStep(\n\t\t\t\tbuffer.steps,\n\t\t\t\tbuffer.clippings,\n\t\t\t\tthis.vertexOffset,\n\t\t\t\tstrokeWidth,\n\t\t\t\tstrokeStyle,\n\t\t\t\tCIRCLE_WORLD_SIZE\n\t\t\t);\n\t\t}\n\t}\n\n\tprotected updateUv(buffer: EShapeBuffer, shape: EShape): void {\n\t\tconst texture = toTexture(shape);\n\t\tconst textureTransformId = toTextureTransformId(texture);\n\t\tif (texture !== this.texture || textureTransformId !== this.textureTransformId) {\n\t\t\tthis.texture = texture;\n\t\t\tthis.textureTransformId = textureTransformId;\n\n\t\t\tbuffer.updateUvs();\n\t\t\tconst textureUvs = toTextureUvs(texture);\n\t\t\tbuildCircleUv(buffer.uvs, this.vertexOffset, textureUvs);\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapePointsMarker } from \"../e-shape-points-marker\";\nimport { EShapePointsMarkerContainer } from \"../e-shape-points-marker-container\";\nimport { BuilderMarkerCircle } from \"./builder-marker-circle\";\n\nexport class BuilderMarkerCircleHead extends BuilderMarkerCircle {\n\tprotected toMarker(container: EShapePointsMarkerContainer): EShapePointsMarker {\n\t\treturn container.head;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapePointsMarker } from \"../e-shape-points-marker\";\nimport { EShapePointsMarkerContainer } from \"../e-shape-points-marker-container\";\nimport { BuilderMarkerCircle } from \"./builder-marker-circle\";\n\nexport class BuilderMarkerCircleTail extends BuilderMarkerCircle {\n\tprotected toMarker(container: EShapePointsMarkerContainer): EShapePointsMarker {\n\t\treturn container.tail;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Texture } from \"pixi.js\";\nimport { EShape } from \"../e-shape\";\nimport { EShapeBuffer } from \"../e-shape-buffer\";\nimport { EShapeBufferUnitBuilder } from \"../e-shape-buffer-unit-builder\";\nimport { Builder } from \"./builder\";\nimport { toTexture } from \"./builders\";\n\nexport class BuilderNull implements Builder {\n\treadonly vertexOffset: number;\n\treadonly vertexCount: number;\n\treadonly indexOffset: number;\n\treadonly indexCount: number;\n\n\tprotected texture: Texture | null;\n\n\tconstructor(vertexOffset: number, indexOffset: number) {\n\t\tthis.vertexOffset = vertexOffset;\n\t\tthis.indexOffset = indexOffset;\n\t\tthis.vertexCount = 0;\n\t\tthis.indexCount = 0;\n\n\t\tthis.texture = null;\n\t}\n\n\tinit(buffer: EShapeBuffer): void {\n\t\t// DO NOTHING\n\t}\n\n\tisCompatible(shape: EShape): boolean {\n\t\treturn true;\n\t}\n\n\tupdate(buffer: EShapeBuffer, shape: EShape): void {\n\t\tthis.texture = toTexture(shape);\n\t}\n\n\tbuildUnit(builder: EShapeBufferUnitBuilder): void {\n\t\tconst texture = this.texture || Texture.WHITE;\n\t\tconst baseTexture = texture.baseTexture;\n\t\tif (baseTexture !== builder.baseTexture) {\n\t\t\tbuilder.baseTexture = baseTexture;\n\t\t\tconst indexOffset = this.indexOffset;\n\t\t\tbuilder.push(texture, indexOffset);\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const toIndexOf = <V>(array: V[], value: V): number => {\n\tlet i0 = 0;\n\tlet i1 = array.length - 1;\n\n\twhile (i0 <= i1) {\n\t\tconst i2 = i0 + ((i1 - i0) >> 1);\n\t\tconst v2 = array[i2];\n\t\tif (value < v2) {\n\t\t\ti1 = i2 - 1;\n\t\t} else if (v2 < value) {\n\t\t\ti0 = i2 + 1;\n\t\t} else {\n\t\t\treturn i2;\n\t\t}\n\t}\n\n\treturn -1;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { toIndexOf } from \"./to-index-of\";\n\nexport interface UtilCurveParameter {\n\tcenter: [number, number];\n\taxis1: [number, number];\n\taxis2: [number, number];\n\tangle: [number, number, number];\n}\n\nexport type UtilCurveToParameter = (\n\tindex: number,\n\tlength: number,\n\tvalues: number[],\n\tresult: UtilCurveParameter\n) => UtilCurveParameter;\n\nexport type UtilCurveInterpolated = {\n\tvalues: number[];\n\tsegments: number[];\n};\n\nconst PID = Math.PI * 2;\nconst PIH = Math.PI * 0.5;\n\nconst vdot = (x0: number, y0: number, x1: number, y1: number): number => {\n\treturn x0 * x1 + y0 * y1;\n};\n\nconst vlen = (x0: number, y0: number): number => {\n\treturn Math.sqrt(vdot(x0, y0, x0, y0));\n};\n\nconst vcross = (x0: number, y0: number, x1: number, y1: number): number => {\n\treturn x0 * y1 - y0 * x1;\n};\n\nconst pnew = (): UtilCurveParameter => {\n\treturn {\n\t\tcenter: [0, 0],\n\t\taxis1: [0, 0],\n\t\taxis2: [0, 0],\n\t\tangle: [0, 0, 0]\n\t};\n};\n\nconst pset = (\n\tcx: number,\n\tcy: number,\n\ta1x: number,\n\ta1y: number,\n\ta2x: number,\n\ta2y: number,\n\tangle1: number,\n\tangle2: number,\n\tangle3: number,\n\tresult: UtilCurveParameter\n): UtilCurveParameter => {\n\tconst c = result.center;\n\tc[0] = cx;\n\tc[1] = cy;\n\tconst a1 = result.axis1;\n\ta1[0] = a1x;\n\ta1[1] = a1y;\n\tconst a2 = result.axis2;\n\ta2[0] = a2x;\n\ta2[1] = a2y;\n\tconst a = result.angle;\n\ta[0] = angle1;\n\ta[1] = angle2;\n\ta[2] = angle3;\n\treturn result;\n};\n\nconst pcopy = (source: UtilCurveParameter, result: UtilCurveParameter): UtilCurveParameter => {\n\tconst c = source.center;\n\tconst a1 = source.axis1;\n\tconst a2 = source.axis2;\n\tconst a = source.angle;\n\treturn pset(c[0], c[1], a1[0], a1[1], a2[0], a2[1], a[0], a[1], a[2], result);\n};\n\nconst acopy = <T extends Array<number>>(source: T, result: T): T => {\n\tconst sourceLength = source.length;\n\tfor (let i = 0; i < sourceLength; ++i) {\n\t\tresult[i] = source[i];\n\t}\n\tif (result.length !== sourceLength) {\n\t\tresult.length = sourceLength;\n\t}\n\treturn result;\n};\n\n/**\n * An utility class for spline curves based on the work of Cem Yuksel.\n * Pleaase refer to the paper `A class of C2 interpolating splines`.\n * http://www.cemyuksel.com/research/interpolating_splines/\n */\nexport class UtilCurve {\n\tprotected static WORK_P0?: UtilCurveParameter;\n\tprotected static WORK_P1?: UtilCurveParameter;\n\tprotected static WORK_P2?: UtilCurveParameter;\n\n\tpublic static toCircle = (\n\t\tindex: number,\n\t\tlength: number,\n\t\tvalues: number[],\n\t\tresult: UtilCurveParameter\n\t): UtilCurveParameter => {\n\t\tconst index0 = 0 < index ? index - 1 : length - 1;\n\t\tconst index1 = index;\n\t\tconst index2 = index < length - 1 ? index + 1 : 0;\n\n\t\tconst i0 = index0 << 1;\n\t\tconst i1 = index1 << 1;\n\t\tconst i2 = index2 << 1;\n\n\t\tconst x0 = values[i0 + 0];\n\t\tconst y0 = values[i0 + 1];\n\t\tconst x1 = values[i1 + 0];\n\t\tconst y1 = values[i1 + 1];\n\t\tconst x2 = values[i2 + 0];\n\t\tconst y2 = values[i2 + 1];\n\n\t\tconst d01x = x1 - x0;\n\t\tconst d01y = y1 - y0;\n\t\tconst d12x = x2 - x1;\n\t\tconst d12y = y2 - y1;\n\n\t\tconst m1x = x0 + d01x * 0.5;\n\t\tconst m1y = y0 + d01y * 0.5;\n\t\tconst m2x = x1 + d12x * 0.5;\n\t\tconst m2y = y1 + d12y * 0.5;\n\n\t\tconst n1x = -d01y;\n\t\tconst n1y = +d01x;\n\t\tconst n2x = -d12y;\n\t\tconst n2y = +d12x;\n\n\t\tlet det = vcross(n1x, n1y, n2x, n2y);\n\t\tconst threshold = 0.001;\n\t\tif (Math.abs(det) < threshold) {\n\t\t\tif (0 <= vdot(d01x, d01y, d12x, d12y) || length <= 2) {\n\t\t\t\tconst a = 0.01;\n\t\t\t\tconst s = Math.sin(a);\n\t\t\t\tconst l1 = vlen(d01x, d01y);\n\t\t\t\tconst l2 = vlen(d12x, d12y);\n\t\t\t\treturn pset(x1, y1, 0, 0, d12x / s, d12y / s, (-a * l1) / l2, 0, a, result);\n\t\t\t} else {\n\t\t\t\tdet = threshold;\n\t\t\t}\n\t\t}\n\t\tconst s = (n2y * (m2x - m1x) + n2x * (m1y - m2y)) / det;\n\t\tconst cx = m1x + s * n1x;\n\t\tconst cy = m1y + s * n1y;\n\n\t\tconst a1x = x1 - cx;\n\t\tconst a1y = y1 - cy;\n\n\t\tconst a2x = -a1y;\n\t\tconst a2y = +a1x;\n\n\t\tconst dc2x = x2 - cx;\n\t\tconst dc2y = y2 - cy;\n\n\t\tlet a2 = Math.atan2(vdot(a2x, a2y, dc2x, dc2y), vdot(a1x, a1y, dc2x, dc2y));\n\n\t\tconst dc0x = x0 - cx;\n\t\tconst dc0y = y0 - cy;\n\n\t\tlet a1 = Math.atan2(vdot(a2x, a2y, dc0x, dc0y), vdot(a1x, a1y, dc0x, dc0y));\n\t\tif (0 < a1 * a2) {\n\t\t\tif (Math.abs(a1) < Math.abs(a2)) {\n\t\t\t\tif (0 < a2) {\n\t\t\t\t\ta2 -= PID;\n\t\t\t\t} else {\n\t\t\t\t\ta2 += PID;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (Math.abs(a2) < Math.abs(a1)) {\n\t\t\t\tif (0 < a1) {\n\t\t\t\t\ta1 -= PID;\n\t\t\t\t} else {\n\t\t\t\t\ta1 += PID;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn pset(cx, cy, a1x, a1y, a2x, a2y, a1, 0, a2, result);\n\t};\n\n\tpublic static toEllipse = (\n\t\tindex: number,\n\t\tlength: number,\n\t\tvalues: number[],\n\t\tresult: UtilCurveParameter\n\t): UtilCurveParameter => {\n\t\tconst index0 = 0 < index ? index - 1 : length - 1;\n\t\tconst index1 = index;\n\t\tconst index2 = index < length - 1 ? index + 1 : 0;\n\n\t\tconst i0 = index0 << 1;\n\t\tconst i1 = index1 << 1;\n\t\tconst i2 = index2 << 1;\n\n\t\tconst x0 = values[i0 + 0];\n\t\tconst y0 = values[i0 + 1];\n\t\tconst x1 = values[i1 + 0];\n\t\tconst y1 = values[i1 + 1];\n\t\tconst x2 = values[i2 + 0];\n\t\tconst y2 = values[i2 + 1];\n\n\t\tconst d10x = x0 - x1;\n\t\tconst d10y = y0 - y1;\n\t\tconst d12x = x2 - x1;\n\t\tconst d12y = y2 - y1;\n\n\t\tif (length <= 2) {\n\t\t\tconst a = 0.01;\n\t\t\tconst s = Math.sin(a);\n\t\t\treturn pset(x1, y1, 0, 0, d12x / s, d12y / s, -a, 0, a, result);\n\t\t}\n\n\t\tconst l0 = vlen(d10x, d10y);\n\t\tconst l2 = vlen(d12x, d12y);\n\t\tconst cos = vdot(d10x, d10y, d12x, d12y) / (l0 * l2);\n\t\tconst amax = Math.acos(cos);\n\t\tlet acurrent = amax * 0.5;\n\t\tlet adelta = amax * 0.25;\n\t\tlet a = 0;\n\t\tlet b = 0;\n\t\tlet c = 0;\n\t\tlet d = 0;\n\t\tconst lmax = Math.max(l0, l2);\n\t\tconst lmin = Math.min(l0, l2);\n\t\tfor (let i = 0; i < 16; ++i) {\n\t\t\tconst a0 = acurrent * 0.5;\n\t\t\tconst a1 = amax - a0;\n\t\t\ta = lmax * Math.sin(a0);\n\t\t\tb = lmax * Math.cos(a0);\n\t\t\tc = lmin * Math.sin(a1);\n\t\t\td = lmin * Math.cos(a1);\n\t\t\tconst v = (1 - d / b) * (1 - d / b) + (c * c) / (a * a);\n\t\t\tif (1 < v) {\n\t\t\t\tacurrent += adelta;\n\t\t\t} else {\n\t\t\t\tacurrent -= adelta;\n\t\t\t}\n\t\t\tadelta *= 0.5;\n\t\t}\n\t\tconst beta = Math.asin(Math.min(c / a, 1));\n\t\tif (l0 < l2) {\n\t\t\tconst e3x = d12x / l2;\n\t\t\tconst e3y = d12y / l2;\n\t\t\tlet n3x, n3y;\n\t\t\tif (0 < vcross(d10x, d10y, d12x, d12y)) {\n\t\t\t\tn3x = +e3y;\n\t\t\t\tn3y = -e3x;\n\t\t\t} else {\n\t\t\t\tn3x = -e3y;\n\t\t\t\tn3y = +e3x;\n\t\t\t}\n\t\t\tconst we = -(b * b) / l2;\n\t\t\tconst wn = -(b * a) / l2;\n\t\t\tconst a1x = we * e3x + wn * n3x;\n\t\t\tconst a1y = we * e3y + wn * n3y;\n\t\t\tconst cx = x1 - a1x;\n\t\t\tconst cy = y1 - a1y;\n\t\t\tconst a2x = x2 - cx;\n\t\t\tconst a2y = y2 - cy;\n\t\t\treturn pset(cx, cy, a1x, a1y, a2x, a2y, -beta, 0, PIH, result);\n\t\t} else {\n\t\t\tconst e0x = d10x / l0;\n\t\t\tconst e0y = d10y / l0;\n\t\t\tlet n3x, n3y;\n\t\t\tif (vcross(d10x, d10y, d12x, d12y) < 0) {\n\t\t\t\tn3x = +e0y;\n\t\t\t\tn3y = -e0x;\n\t\t\t} else {\n\t\t\t\tn3x = -e0y;\n\t\t\t\tn3y = +e0x;\n\t\t\t}\n\t\t\tconst we = -(b * b) / l0;\n\t\t\tconst wn = -(b * a) / l0;\n\t\t\tconst a1x = we * e0x + wn * n3x;\n\t\t\tconst a1y = we * e0y + wn * n3y;\n\t\t\tconst cx = x1 - a1x;\n\t\t\tconst cy = y1 - a1y;\n\t\t\tconst a2x = x0 - cx;\n\t\t\tconst a2y = y0 - cy;\n\t\t\treturn pset(cx, cy, a1x, a1y, -a2x, -a2y, -PIH, 0, beta, result);\n\t\t}\n\t};\n\n\tpublic static toHybrid = (\n\t\tindex: number,\n\t\tlength: number,\n\t\tvalues: number[],\n\t\tresult: UtilCurveParameter\n\t): UtilCurveParameter => {\n\t\tconst circle = UtilCurve.toCircle(index, length, values, result);\n\t\tconst a0 = circle.angle[0];\n\t\tconst a2 = circle.angle[2];\n\t\tconst amin = Math.min(a0, a2);\n\t\tconst amax = Math.max(a0, a2);\n\t\tif (amin < -PIH || PIH < amax) {\n\t\t\treturn UtilCurve.toEllipse(index, length, values, result);\n\t\t}\n\t\treturn circle;\n\t};\n\n\tpublic static set(\n\t\tcenter1: [number, number],\n\t\tangle10: number,\n\t\tangle11: number,\n\t\taxis11: [number, number],\n\t\taxis12: [number, number],\n\n\t\tcenter2: [number, number],\n\t\tangle20: number,\n\t\tangle21: number,\n\t\taxis21: [number, number],\n\t\taxis22: [number, number],\n\n\t\tnsegment: number,\n\t\tisAdaptive: boolean,\n\t\tisEdge: boolean,\n\n\t\tresult: number[],\n\t\tresultIndex: number\n\t): number {\n\t\tconst a = Math.max(Math.abs(angle10 - angle11), Math.abs(angle20 - angle21));\n\t\tconst n = isAdaptive ? Math.max(1, Math.round(nsegment * (a / PIH))) : nsegment;\n\t\tconst imax = isEdge ? n + 1 : n;\n\t\tfor (let i = 0; i < imax; ++i) {\n\t\t\tconst t = i / n;\n\t\t\tconst w0 = 1 - t;\n\t\t\tconst w1 = t;\n\n\t\t\tconst t1 = w0 * angle10 + w1 * angle11;\n\t\t\tconst c1 = Math.cos(t1);\n\t\t\tconst s1 = Math.sin(t1);\n\t\t\tconst x1 = center1[0] + c1 * axis11[0] + s1 * axis12[0];\n\t\t\tconst y1 = center1[1] + c1 * axis11[1] + s1 * axis12[1];\n\n\t\t\tconst t2 = w0 * angle20 + w1 * angle21;\n\t\t\tconst c2 = Math.cos(t2);\n\t\t\tconst s2 = Math.sin(t2);\n\t\t\tconst x2 = center2[0] + c2 * axis21[0] + s2 * axis22[0];\n\t\t\tconst y2 = center2[1] + c2 * axis21[1] + s2 * axis22[1];\n\n\t\t\tconst t3 = PIH * t;\n\t\t\tconst c3 = Math.cos(t3);\n\t\t\tconst s3 = Math.sin(t3);\n\t\t\tconst cc3 = c3 * c3;\n\t\t\tconst ss3 = s3 * s3;\n\n\t\t\tconst x3 = cc3 * x1 + ss3 * x2;\n\t\t\tconst y3 = cc3 * y1 + ss3 * y2;\n\t\t\tresult[++resultIndex] = x3;\n\t\t\tresult[++resultIndex] = y3;\n\t\t}\n\t\treturn resultIndex;\n\t}\n\n\t/**\n\t * Calculate an interpolated points of the given control points.\n\t *\n\t * @param length A number of control points.\n\t * @param values An array of control points.\n\t * @param toParameter An interpolation method.\n\t * @param isClosed True if the line is closed.\n\t * @param nsegment The number of segments per 90 degree if isAdaptive is true.\n\t * If isAdaptive is false, the number of segments is fixed to the given number\n\t * regardless of arc angles.\n\t * @param isAdaptive True to adjust the number of segments adaptively.\n\t * @returns An interpolated points of the given control points.\n\t */\n\tpublic static interpolate(\n\t\tlength: number,\n\t\tvalues: number[],\n\t\tsegments: number[],\n\t\ttoParameter: UtilCurveToParameter,\n\t\tisClosed: boolean,\n\t\tnsegment: number,\n\t\tisAdaptive: boolean,\n\t\tresult: UtilCurveInterpolated\n\t): UtilCurveInterpolated {\n\t\tconst rvalues: number[] = result.values;\n\t\tconst rsegments: number[] = result.segments;\n\n\t\tif (length <= 2) {\n\t\t\tacopy(values, rvalues);\n\t\t\tacopy(segments, rsegments);\n\t\t\treturn result;\n\t\t}\n\n\t\tconst c0 = this.WORK_P0 || pnew();\n\t\tlet c1 = this.WORK_P1 || pnew();\n\t\tlet c2 = this.WORK_P2 || pnew();\n\t\tthis.WORK_P0 = c0;\n\t\tthis.WORK_P1 = c1;\n\t\tthis.WORK_P2 = c2;\n\t\tlet rvaluesCount = -1;\n\t\tlet rsegmentCount = -1;\n\t\tif (isClosed) {\n\t\t\ttoParameter(0, length, values, c0);\n\t\t\tpcopy(c0, c1);\n\t\t\tfor (let i = 1; i < length; ++i) {\n\t\t\t\ttoParameter(i, length, values, c2);\n\t\t\t\tif (0 <= toIndexOf(segments, i)) {\n\t\t\t\t\tconst index = (i - 1) << 1;\n\t\t\t\t\trvalues[++rvaluesCount] = values[index + 0];\n\t\t\t\t\trvalues[++rvaluesCount] = values[index + 1];\n\t\t\t\t\trsegments[++rsegmentCount] = (rvaluesCount + 1) >> 1;\n\t\t\t\t} else {\n\t\t\t\t\trvaluesCount = this.set(\n\t\t\t\t\t\tc1.center,\n\t\t\t\t\t\tc1.angle[1],\n\t\t\t\t\t\tc1.angle[2],\n\t\t\t\t\t\tc1.axis1,\n\t\t\t\t\t\tc1.axis2,\n\n\t\t\t\t\t\tc2.center,\n\t\t\t\t\t\tc2.angle[0],\n\t\t\t\t\t\tc2.angle[1],\n\t\t\t\t\t\tc2.axis1,\n\t\t\t\t\t\tc2.axis2,\n\n\t\t\t\t\t\tnsegment,\n\t\t\t\t\t\tisAdaptive,\n\t\t\t\t\t\tfalse,\n\n\t\t\t\t\t\trvalues,\n\t\t\t\t\t\trvaluesCount\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tconst c3 = c1;\n\t\t\t\tc1 = c2;\n\t\t\t\tc2 = c3;\n\t\t\t}\n\t\t\tif (0 <= toIndexOf(segments, 0)) {\n\t\t\t\tconst index = (length - 1) << 1;\n\t\t\t\trvalues[++rvaluesCount] = values[index + 0];\n\t\t\t\trvalues[++rvaluesCount] = values[index + 1];\n\t\t\t\trsegments.unshift(0);\n\t\t\t\trsegmentCount += 1;\n\t\t\t} else {\n\t\t\t\trvaluesCount = this.set(\n\t\t\t\t\tc1.center,\n\t\t\t\t\tc1.angle[1],\n\t\t\t\t\tc1.angle[2],\n\t\t\t\t\tc1.axis1,\n\t\t\t\t\tc1.axis2,\n\n\t\t\t\t\tc0.center,\n\t\t\t\t\tc0.angle[0],\n\t\t\t\t\tc0.angle[1],\n\t\t\t\t\tc0.axis1,\n\t\t\t\t\tc0.axis2,\n\n\t\t\t\t\tnsegment,\n\t\t\t\t\tisAdaptive,\n\t\t\t\t\tfalse,\n\n\t\t\t\t\trvalues,\n\t\t\t\t\trvaluesCount\n\t\t\t\t);\n\t\t\t}\n\t\t} else {\n\t\t\ttoParameter(1, length, values, c0);\n\t\t\tif (0 <= toIndexOf(segments, 1)) {\n\t\t\t\trvalues[++rvaluesCount] = values[0];\n\t\t\t\trvalues[++rvaluesCount] = values[1];\n\t\t\t\trsegments[++rsegmentCount] = 1;\n\t\t\t} else {\n\t\t\t\trvaluesCount = this.set(\n\t\t\t\t\tc0.center,\n\t\t\t\t\tc0.angle[0],\n\t\t\t\t\tc0.angle[1],\n\t\t\t\t\tc0.axis1,\n\t\t\t\t\tc0.axis2,\n\n\t\t\t\t\tc0.center,\n\t\t\t\t\tc0.angle[0],\n\t\t\t\t\tc0.angle[1],\n\t\t\t\t\tc0.axis1,\n\t\t\t\t\tc0.axis2,\n\n\t\t\t\t\tnsegment,\n\t\t\t\t\tisAdaptive,\n\t\t\t\t\tfalse,\n\n\t\t\t\t\trvalues,\n\t\t\t\t\trvaluesCount\n\t\t\t\t);\n\t\t\t}\n\t\t\tpcopy(c0, c1);\n\t\t\tfor (let i = 2, imax = length - 1; i < imax; ++i) {\n\t\t\t\ttoParameter(i, length, values, c2);\n\t\t\t\tif (0 <= toIndexOf(segments, i)) {\n\t\t\t\t\tconst index = (i - 1) << 1;\n\t\t\t\t\trvalues[++rvaluesCount] = values[index + 0];\n\t\t\t\t\trvalues[++rvaluesCount] = values[index + 1];\n\t\t\t\t\trsegments[++rsegmentCount] = (rvaluesCount + 1) >> 1;\n\t\t\t\t} else {\n\t\t\t\t\trvaluesCount = this.set(\n\t\t\t\t\t\tc1.center,\n\t\t\t\t\t\tc1.angle[1],\n\t\t\t\t\t\tc1.angle[2],\n\t\t\t\t\t\tc1.axis1,\n\t\t\t\t\t\tc1.axis2,\n\n\t\t\t\t\t\tc2.center,\n\t\t\t\t\t\tc2.angle[0],\n\t\t\t\t\t\tc2.angle[1],\n\t\t\t\t\t\tc2.axis1,\n\t\t\t\t\t\tc2.axis2,\n\n\t\t\t\t\t\tnsegment,\n\t\t\t\t\t\tisAdaptive,\n\t\t\t\t\t\tfalse,\n\n\t\t\t\t\t\trvalues,\n\t\t\t\t\t\trvaluesCount\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tconst c3 = c1;\n\t\t\t\tc1 = c2;\n\t\t\t\tc2 = c3;\n\t\t\t}\n\n\t\t\tif (0 <= toIndexOf(segments, length - 1)) {\n\t\t\t\tconst index = (length - 2) << 1;\n\t\t\t\trvalues[++rvaluesCount] = values[index + 0];\n\t\t\t\trvalues[++rvaluesCount] = values[index + 1];\n\t\t\t\trsegments[++rsegmentCount] = (rvaluesCount + 1) >> 1;\n\t\t\t} else {\n\t\t\t\trvaluesCount = this.set(\n\t\t\t\t\tc1.center,\n\t\t\t\t\tc1.angle[1],\n\t\t\t\t\tc1.angle[2],\n\t\t\t\t\tc1.axis1,\n\t\t\t\t\tc1.axis2,\n\n\t\t\t\t\tc1.center,\n\t\t\t\t\tc1.angle[1],\n\t\t\t\t\tc1.angle[2],\n\t\t\t\t\tc1.axis1,\n\t\t\t\t\tc1.axis2,\n\n\t\t\t\t\tnsegment,\n\t\t\t\t\tisAdaptive,\n\t\t\t\t\ttrue,\n\n\t\t\t\t\trvalues,\n\t\t\t\t\trvaluesCount\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\trvaluesCount += 1;\n\t\tif (rvalues.length !== rvaluesCount) {\n\t\t\trvalues.length = rvaluesCount;\n\t\t}\n\n\t\trsegmentCount += 1;\n\t\tif (rsegments.length !== rsegmentCount) {\n\t\t\trsegments.length = rsegmentCount;\n\t\t}\n\t\treturn result;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { UtilCurve } from \"../util/util-curve\";\nimport { EShapeDefaults } from \"./e-shape-defaults\";\nimport { EShapePointsFormattedWithoutBoundary } from \"./e-shape-points-formatted\";\nimport { EShapePointsFormatter } from \"./e-shape-points-formatter\";\nimport { EShapePointsStyle } from \"./e-shape-points-style\";\n\nexport const eShapePointsFormatterCurve: EShapePointsFormatter = (\n\tlength: number,\n\tvalues: number[],\n\tsegments: number[],\n\tstyle: EShapePointsStyle,\n\tresult: EShapePointsFormattedWithoutBoundary\n): EShapePointsFormattedWithoutBoundary => {\n\tUtilCurve.interpolate(\n\t\tlength,\n\t\tvalues,\n\t\tsegments,\n\t\tUtilCurve.toHybrid,\n\t\t!!(style & EShapePointsStyle.CLOSED),\n\t\tEShapeDefaults.CURVE_SEGMENT_COUNT,\n\t\ttrue,\n\t\tresult\n\t);\n\tresult.length = result.values.length >> 1;\n\tresult.style = style;\n\treturn result;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapePointsStyle } from \"./e-shape-points-style\";\n\nexport type EShapePointsFormatted =\n\t| EShapePointsFormattedWithBoundary\n\t| EShapePointsFormattedWithoutBoundary;\n\nexport type EShapePointsFormattedBoundary = [number, number, number, number];\n\nexport interface EShapePointsFormattedWithoutBoundary {\n\tlength: number;\n\tvalues: number[];\n\tsegments: number[];\n\tstyle: EShapePointsStyle;\n}\n\nexport interface EShapePointsFormattedWithBoundary extends EShapePointsFormattedWithoutBoundary {\n\tboundary: EShapePointsFormattedBoundary;\n}\n\nexport const toPointsBoundary = (\n\tvalues: number[],\n\tresult: EShapePointsFormattedBoundary\n): EShapePointsFormattedBoundary => {\n\tconst valuesLength = values.length;\n\tif (2 <= valuesLength) {\n\t\tlet xmin = values[0];\n\t\tlet ymin = values[1];\n\t\tlet xmax = xmin;\n\t\tlet ymax = ymin;\n\t\tfor (let i = 2, imax = values.length; i < imax; i += 2) {\n\t\t\tconst x = values[i];\n\t\t\tconst y = values[i + 1];\n\t\t\txmin = Math.min(xmin, x);\n\t\t\tymin = Math.min(ymin, y);\n\t\t\txmax = Math.max(xmax, x);\n\t\t\tymax = Math.max(ymax, y);\n\t\t}\n\t\tresult[0] = xmin;\n\t\tresult[1] = ymin;\n\t\tresult[2] = xmax;\n\t\tresult[3] = ymax;\n\t} else {\n\t\tresult[0] = 0;\n\t\tresult[1] = 0;\n\t\tresult[2] = 0;\n\t\tresult[3] = 0;\n\t}\n\treturn result;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { IPoint, Matrix, ObservablePoint } from \"pixi.js\";\nimport { EShapeDefaults } from \"./e-shape-defaults\";\nimport { EShapeFill } from \"./e-shape-fill\";\nimport { EShapePointsFormatted } from \"./e-shape-points-formatted\";\nimport { EShapePointsMarker, EShapePointsMarkerSerizlized } from \"./e-shape-points-marker\";\nimport { EShapePointsMarkerType } from \"./e-shape-points-marker-type\";\nimport { EShapeResourceManagerDeserialization } from \"./e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"./e-shape-resource-manager-serialization\";\nimport { EShapeFillImpl } from \"./variant/e-shape-fill-impl\";\n\nexport interface EShapePointsMarkerBaseParentParent {\n\treadonly id: number;\n\treadonly formatted: EShapePointsFormatted;\n}\n\nexport interface EShapePointsMarkerBaseParent {\n\treadonly parent: EShapePointsMarkerBaseParentParent;\n\tonTypeChange(): void;\n\tonSizeChange(): void;\n\tonFillChange(): void;\n}\n\nexport abstract class EShapePointsMarkerBase implements EShapePointsMarker {\n\tprotected _parent: EShapePointsMarkerBaseParent;\n\tprotected _lockCount: number;\n\tprotected _isTypeChanged: boolean;\n\tprotected _isSizeChanged: boolean;\n\tprotected _isFillChanged: boolean;\n\tprotected _type: EShapePointsMarkerType;\n\tprotected _size: IPoint;\n\tprotected _transform?: Matrix;\n\tprotected _transformId: number;\n\tprotected _fill: EShapeFill;\n\n\tconstructor(parent: EShapePointsMarkerBaseParent) {\n\t\tthis._parent = parent;\n\t\tthis._lockCount = 0;\n\t\tthis._isTypeChanged = false;\n\t\tthis._isSizeChanged = false;\n\t\tthis._isFillChanged = false;\n\t\tthis._type = EShapePointsMarkerType.NONE;\n\t\tthis._size = new ObservablePoint(\n\t\t\t(): void => {\n\t\t\t\tthis.onSizeChange();\n\t\t\t},\n\t\t\tundefined,\n\t\t\tEShapeDefaults.SIZE_X * 0.15,\n\t\t\tEShapeDefaults.SIZE_Y * 0.15\n\t\t);\n\t\tthis._fill = this.newFill();\n\t\tthis._transformId = 0;\n\t}\n\n\tprotected newFill(): EShapeFill {\n\t\treturn new EShapeFillImpl(this, true, EShapeDefaults.FILL_COLOR, 1);\n\t}\n\n\tlock(): this {\n\t\tthis._lockCount += 1;\n\t\tif (this._lockCount === 1) {\n\t\t\tthis._isTypeChanged = false;\n\t\t\tthis._isSizeChanged = false;\n\t\t\tthis._isFillChanged = false;\n\t\t}\n\t\treturn this;\n\t}\n\n\tunlock(): this {\n\t\tthis._lockCount -= 1;\n\t\tif (this._lockCount === 0) {\n\t\t\tif (this._isTypeChanged) {\n\t\t\t\tthis.onTypeChange();\n\t\t\t} else if (this._isSizeChanged) {\n\t\t\t\tthis.onSizeChange();\n\t\t\t} else if (this._isFillChanged) {\n\t\t\t\tthis.onFillChange();\n\t\t\t}\n\t\t\tthis._isTypeChanged = false;\n\t\t\tthis._isSizeChanged = false;\n\t\t\tthis._isFillChanged = false;\n\t\t}\n\t\treturn this;\n\t}\n\n\tget type(): EShapePointsMarkerType {\n\t\treturn this._type;\n\t}\n\n\tset type(type: EShapePointsMarkerType) {\n\t\tif (this._type !== type) {\n\t\t\tthis._type = type;\n\t\t\tthis.onTypeChange();\n\t\t}\n\t}\n\n\tprotected onTypeChange(): void {\n\t\tif (0 < this._lockCount) {\n\t\t\tthis._isTypeChanged = true;\n\t\t\treturn;\n\t\t}\n\t\tthis._parent.onTypeChange();\n\t}\n\n\tget size(): IPoint {\n\t\treturn this._size;\n\t}\n\n\tprotected onSizeChange(): void {\n\t\tif (0 < this._lockCount) {\n\t\t\tthis._isSizeChanged = true;\n\t\t\treturn;\n\t\t}\n\t\tthis._parent.onSizeChange();\n\t}\n\n\tget transform(): Matrix {\n\t\treturn this.updateTransform();\n\t}\n\n\tprotected updateTransform(): Matrix {\n\t\tlet result = this._transform;\n\t\tif (result == null) {\n\t\t\tresult = new Matrix();\n\t\t\tthis._transform = result;\n\t\t}\n\t\tconst parentParent = this._parent.parent;\n\t\tconst id = parentParent.id;\n\t\tif (this._transformId !== id) {\n\t\t\tthis._transformId = id;\n\t\t\tconst formatted = parentParent.formatted;\n\t\t\tif (2 <= formatted.length) {\n\t\t\t\tthis.toTransform(formatted.values, result);\n\t\t\t} else {\n\t\t\t\tresult.identity();\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected abstract toTransform(values: number[], result: Matrix): Matrix;\n\n\tprotected toTransformMatrix(\n\t\tx0: number,\n\t\ty0: number,\n\t\tx1: number,\n\t\ty1: number,\n\t\tresult: Matrix\n\t): Matrix {\n\t\tconst dx = x0 - x1;\n\t\tconst dy = y0 - y1;\n\t\tconst n = dx * dx + dy * dy;\n\t\tif (0.00001 < n) {\n\t\t\tconst f = 1 / Math.sqrt(n);\n\t\t\tconst nx = dx * f;\n\t\t\tconst ny = dy * f;\n\t\t\tresult.set(ny, -nx, -nx, -ny, x0, y0);\n\t\t} else {\n\t\t\tresult.identity();\n\t\t}\n\t\treturn result;\n\t}\n\n\tget fill(): EShapeFill {\n\t\treturn this._fill;\n\t}\n\n\tprotected onFillChange(): void {\n\t\tif (0 < this._lockCount) {\n\t\t\tthis._isFillChanged = true;\n\t\t\treturn;\n\t\t}\n\t\tthis._parent.onFillChange();\n\t}\n\n\tupdateUploaded(): void {\n\t\tthis.onFillChange();\n\t}\n\n\tcopy(source: EShapePointsMarker): this {\n\t\tconst size = source.size;\n\t\tthis.set(source.type, size.x, size.y);\n\t\treturn this;\n\t}\n\n\tset(type?: EShapePointsMarkerType, sizeX?: number, sizeY?: number): this {\n\t\tthis.lock();\n\n\t\tif (type != null) {\n\t\t\tthis.type = type;\n\t\t}\n\n\t\tthis.size.set(sizeX, sizeY);\n\n\t\tthis.unlock();\n\t\treturn this;\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\tconst size = this._size;\n\t\tconst fillId = this._fill.serialize(manager);\n\t\treturn manager.addResource(`[${this._type},${size.x},${size.y},${fillId}]`);\n\t}\n\n\tdeserialize(resourceId: number, manager: EShapeResourceManagerDeserialization): void {\n\t\tconst resources = manager.resources;\n\t\tif (0 <= resourceId && resourceId < resources.length) {\n\t\t\tlet parsed = manager.getExtension<EShapePointsMarkerSerizlized>(resourceId);\n\t\t\tif (parsed == null) {\n\t\t\t\tparsed = JSON.parse(resources[resourceId]) as EShapePointsMarkerSerizlized;\n\t\t\t\tmanager.setExtension(resourceId, parsed);\n\t\t\t}\n\t\t\tthis.lock();\n\t\t\tthis.type = parsed[0];\n\t\t\tthis._size.set(parsed[1], parsed[2]);\n\t\t\tthis._fill.deserialize(parsed[3], manager);\n\t\t\tthis.unlock();\n\t\t}\n\t}\n}\n","import { Matrix } from \"pixi.js\";\nimport { EShapePointsMarkerBase } from \"./e-shape-points-marker-base\";\n\nexport class EShapePointsMarkerHead extends EShapePointsMarkerBase {\n\tprotected toTransform(values: number[], result: Matrix): Matrix {\n\t\tconst valuesLength = values.length;\n\t\tif (4 <= valuesLength) {\n\t\t\treturn this.toTransformMatrix(\n\t\t\t\tvalues[valuesLength - 2],\n\t\t\t\tvalues[valuesLength - 1],\n\t\t\t\tvalues[valuesLength - 4],\n\t\t\t\tvalues[valuesLength - 3],\n\t\t\t\tresult\n\t\t\t);\n\t\t} else {\n\t\t\tresult.identity();\n\t\t}\n\t\treturn result;\n\t}\n}\n","import { Matrix } from \"pixi.js\";\nimport { EShapePointsMarkerBase } from \"./e-shape-points-marker-base\";\n\nexport class EShapePointsMarkerTail extends EShapePointsMarkerBase {\n\tprotected toTransform(values: number[], result: Matrix): Matrix {\n\t\tconst valuesLength = values.length;\n\t\tif (4 <= valuesLength) {\n\t\t\treturn this.toTransformMatrix(values[0], values[1], values[2], values[3], result);\n\t\t} else {\n\t\t\tresult.identity();\n\t\t}\n\t\treturn result;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapePointsMarker } from \"./e-shape-points-marker\";\nimport {\n\tEShapePointsMarkerContainer,\n\tEShapePointsMarkerContainerSerialized\n} from \"./e-shape-points-marker-container\";\nimport { EShapePointsMarkerBaseParentParent } from \"./e-shape-points-marker-base\";\nimport { EShapeResourceManagerDeserialization } from \"./e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"./e-shape-resource-manager-serialization\";\nimport { EShapePointsMarkerHead } from \"./e-shape-points-marker-head\";\nimport { EShapePointsMarkerTail } from \"./e-shape-points-marker-tail\";\n\nexport interface EShapePointsMarkerContainerImplParent extends EShapePointsMarkerBaseParentParent {\n\tonMarkerTypeChange(): void;\n\tonMarkerSizeChange(): void;\n\tonMarkerFillChange(): void;\n}\n\nexport class EShapePointsMarkerContainerImpl implements EShapePointsMarkerContainer {\n\tprotected _parent: EShapePointsMarkerContainerImplParent;\n\tprotected _lockCount: number;\n\tprotected _isTypeChanged: boolean;\n\tprotected _isSizeChanged: boolean;\n\tprotected _isFillChanged: boolean;\n\tprotected _head: EShapePointsMarker;\n\tprotected _tail: EShapePointsMarker;\n\n\tconstructor(parent: EShapePointsMarkerContainerImplParent) {\n\t\tthis._parent = parent;\n\t\tthis._lockCount = 0;\n\t\tthis._isTypeChanged = false;\n\t\tthis._isSizeChanged = false;\n\t\tthis._isFillChanged = false;\n\t\tthis._head = new EShapePointsMarkerHead(this);\n\t\tthis._tail = new EShapePointsMarkerTail(this);\n\t}\n\n\tlock(): this {\n\t\tthis._lockCount += 1;\n\t\tif (this._lockCount === 1) {\n\t\t\tthis._isTypeChanged = false;\n\t\t\tthis._isSizeChanged = false;\n\t\t\tthis._isFillChanged = false;\n\t\t}\n\t\treturn this;\n\t}\n\n\tunlock(): this {\n\t\tthis._lockCount -= 1;\n\t\tif (this._lockCount === 0) {\n\t\t\tif (this._isTypeChanged) {\n\t\t\t\tthis.onTypeChange();\n\t\t\t} else if (this._isSizeChanged) {\n\t\t\t\tthis.onSizeChange();\n\t\t\t} else if (this._isFillChanged) {\n\t\t\t\tthis.onFillChange();\n\t\t\t}\n\t\t\tthis._isTypeChanged = false;\n\t\t\tthis._isSizeChanged = false;\n\t\t\tthis._isFillChanged = false;\n\t\t}\n\t\treturn this;\n\t}\n\n\tget parent(): EShapePointsMarkerContainerImplParent {\n\t\treturn this._parent;\n\t}\n\n\tget head(): EShapePointsMarker {\n\t\treturn this._head;\n\t}\n\n\tget tail(): EShapePointsMarker {\n\t\treturn this._tail;\n\t}\n\n\tonTypeChange(): void {\n\t\tif (0 < this._lockCount) {\n\t\t\tthis._isTypeChanged = true;\n\t\t\treturn;\n\t\t}\n\t\tthis._parent.onMarkerTypeChange();\n\t}\n\n\tonSizeChange(): void {\n\t\tif (0 < this._lockCount) {\n\t\t\tthis._isSizeChanged = true;\n\t\t\treturn;\n\t\t}\n\t\tthis._parent.onMarkerSizeChange();\n\t}\n\n\tonFillChange(): void {\n\t\tif (0 < this._lockCount) {\n\t\t\tthis._isFillChanged = true;\n\t\t\treturn;\n\t\t}\n\t\tthis._parent.onMarkerFillChange();\n\t}\n\n\tcopy(source: EShapePointsMarkerContainer): this {\n\t\tthis.lock();\n\t\tthis._head.copy(source.head);\n\t\tthis._tail.copy(source.tail);\n\t\tthis.unlock();\n\t\treturn this;\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\tconst headId = this._head.serialize(manager);\n\t\tconst tailId = this._tail.serialize(manager);\n\t\treturn manager.addResource(`[${headId},${tailId}]`);\n\t}\n\n\tdeserialize(resourceId: number, manager: EShapeResourceManagerDeserialization): void {\n\t\tconst resources = manager.resources;\n\t\tif (0 <= resourceId && resourceId < resources.length) {\n\t\t\tlet parsed = manager.getExtension<EShapePointsMarkerContainerSerialized>(resourceId);\n\t\t\tif (parsed == null) {\n\t\t\t\tparsed = JSON.parse(resources[resourceId]) as EShapePointsMarkerContainerSerialized;\n\t\t\t\tmanager.setExtension(resourceId, parsed);\n\t\t\t}\n\t\t\tthis.lock();\n\t\t\tthis._head.deserialize(parsed[0], manager);\n\t\t\tthis._tail.deserialize(parsed[1], manager);\n\t\t\tthis.unlock();\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Matrix, Point } from \"pixi.js\";\nimport { toIndexOf } from \"../../util/to-index-of\";\nimport { EShape } from \"../e-shape\";\nimport { EShapePoints } from \"../e-shape-points\";\nimport { EShapePointsStyle } from \"../e-shape-points-style\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { eShapePointsFormatterCurve } from \"../e-shape-points-formatter-curve\";\nimport { EShapePointsFormatter } from \"../e-shape-points-formatter\";\nimport {\n\tEShapePointsFormatted,\n\tEShapePointsFormattedBoundary,\n\tEShapePointsFormattedWithBoundary,\n\ttoPointsBoundary\n} from \"../e-shape-points-formatted\";\nimport { EShapeLineBasePointsHitTester } from \"./e-shape-line-base-points-hit-tester\";\nimport { EShapeLineBasePointsHitTesterToRange } from \"./e-shape-line-base-points-hit-tester-to-range\";\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapePointsMarkerContainer } from \"../e-shape-points-marker-container\";\nimport { EShapePointsMarkerContainerImpl } from \"../e-shape-points-marker-container-impl\";\n\nexport type EShapeLinePointsSerialized = [number[], number[], number, number?];\n\nexport class EShapeLinePoints implements EShapePoints {\n\tprotected static WORK_RANGE: [number, number] = [0, 0];\n\n\tprotected _parent: EShape;\n\tprotected _valuesBase?: number[];\n\tprotected _valuesBaseLength: number;\n\tprotected _values: number[];\n\tprotected _segments: number[];\n\tprotected _parentSizeBase: Point;\n\tprotected _parentSizeFitted: Point;\n\tprotected _id: number;\n\tprotected _style: EShapePointsStyle;\n\tprotected _formattedId: number;\n\tprotected _formatter?: EShapePointsFormatter | null;\n\tprotected _formatted?: EShapePointsFormattedWithBoundary;\n\tprotected _formattedValuesBase?: number[];\n\tprotected _formattedBoundaryBase?: EShapePointsFormattedBoundary;\n\n\tprotected _marker?: EShapePointsMarkerContainer;\n\n\tconstructor(parent: EShape) {\n\t\tthis._parent = parent;\n\t\tthis._valuesBaseLength = 0;\n\t\tthis._values = [];\n\t\tthis._segments = [];\n\t\tconst parentSize = parent.size;\n\t\tconst parentSizeX = parentSize.x;\n\t\tconst parentSizeY = parentSize.y;\n\t\tthis._parentSizeBase = new Point(parentSizeX, parentSizeY);\n\t\tthis._parentSizeFitted = new Point(parentSizeX, parentSizeY);\n\t\tthis._id = 0;\n\t\tthis._style = EShapePointsStyle.NONE;\n\t\tthis._formattedId = -1;\n\t}\n\n\tget length(): number {\n\t\treturn this._values.length >> 1;\n\t}\n\n\ttoFitted(): void {\n\t\tthis._valuesBase = undefined;\n\t\tconst parentSize = this._parent.size;\n\t\tthis._parentSizeFitted.copyFrom(parentSize);\n\t\tthis._parentSizeBase.copyFrom(parentSize);\n\t}\n\n\tprotected fit(): void {\n\t\tconst psizef = this._parentSizeFitted;\n\t\tconst psize = this._parent.size;\n\t\tconst psizeX = psize.x;\n\t\tconst psizeY = psize.y;\n\t\tconst threshold = 0.00001;\n\t\tif (threshold < Math.abs(psizeX - psizef.x) || threshold < Math.abs(psizeY - psizef.y)) {\n\t\t\tpsizef.set(psizeX, psizeY);\n\n\t\t\tconst psizeBase = this._parentSizeBase;\n\t\t\tconst isValidX = threshold < Math.abs(psizeBase.x);\n\t\t\tconst isValidY = threshold < Math.abs(psizeBase.y);\n\t\t\tif (isValidX || isValidY) {\n\t\t\t\tconst scaleX = isValidX ? psizeX / psizeBase.x : 1;\n\t\t\t\tconst scaleY = isValidY ? psizeY / psizeBase.y : 1;\n\n\t\t\t\t// Values\n\t\t\t\tconst values = this._values;\n\t\t\t\tlet valuesBase = this._valuesBase;\n\t\t\t\tif (valuesBase == null) {\n\t\t\t\t\tvaluesBase = [];\n\t\t\t\t\tthis._valuesBase = valuesBase;\n\n\t\t\t\t\tfor (let i = 0, imax = values.length; i < imax; i += 2) {\n\t\t\t\t\t\tconst x = values[i];\n\t\t\t\t\t\tconst y = values[i + 1];\n\t\t\t\t\t\tvalues[i] = x * scaleX;\n\t\t\t\t\t\tvalues[i + 1] = y * scaleY;\n\t\t\t\t\t\tvaluesBase.push(x, y);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tfor (let i = 0, imax = values.length; i < imax; i += 2) {\n\t\t\t\t\t\tvalues[i] = valuesBase[i] * scaleX;\n\t\t\t\t\t\tvalues[i + 1] = valuesBase[i + 1] * scaleY;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Formatted ID, values and boundary\n\t\t\t\tif (this._id === this._formattedId) {\n\t\t\t\t\tconst formatted = this._formatted;\n\t\t\t\t\tif (formatted != null) {\n\t\t\t\t\t\t// Formatted values\n\t\t\t\t\t\tconst formattedValues = formatted.values;\n\t\t\t\t\t\tlet formattedValuesBase = this._formattedValuesBase;\n\t\t\t\t\t\tif (formattedValuesBase == null) {\n\t\t\t\t\t\t\tformattedValuesBase = [];\n\t\t\t\t\t\t\tthis._formattedValuesBase = formattedValuesBase;\n\n\t\t\t\t\t\t\tfor (let i = 0, imax = formattedValues.length; i < imax; i += 2) {\n\t\t\t\t\t\t\t\tconst x = formattedValues[i];\n\t\t\t\t\t\t\t\tconst y = formattedValues[i + 1];\n\t\t\t\t\t\t\t\tformattedValues[i] = x * scaleX;\n\t\t\t\t\t\t\t\tformattedValues[i + 1] = y * scaleY;\n\t\t\t\t\t\t\t\tformattedValuesBase.push(x, y);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfor (let i = 0, imax = formattedValues.length; i < imax; i += 2) {\n\t\t\t\t\t\t\t\tformattedValues[i] = formattedValuesBase[i] * scaleX;\n\t\t\t\t\t\t\t\tformattedValues[i + 1] = formattedValuesBase[i + 1] * scaleY;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Formatted boundary\n\t\t\t\t\t\tconst formattedBoundary = formatted.boundary;\n\t\t\t\t\t\tlet formattedBoundaryBase = this._formattedBoundaryBase;\n\t\t\t\t\t\tif (formattedBoundaryBase == null) {\n\t\t\t\t\t\t\tformattedBoundaryBase = [0, 0, 0, 0];\n\t\t\t\t\t\t\tthis._formattedBoundaryBase = formattedBoundaryBase;\n\n\t\t\t\t\t\t\tfor (let i = 0, imax = formattedBoundary.length; i < imax; i += 2) {\n\t\t\t\t\t\t\t\tconst x = formattedBoundary[i];\n\t\t\t\t\t\t\t\tconst y = formattedBoundary[i + 1];\n\t\t\t\t\t\t\t\tformattedBoundary[i] = x * scaleX;\n\t\t\t\t\t\t\t\tformattedBoundary[i + 1] = y * scaleY;\n\t\t\t\t\t\t\t\tformattedBoundaryBase[i] = x;\n\t\t\t\t\t\t\t\tformattedBoundaryBase[i + 1] = y;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfor (let i = 0, imax = formattedBoundary.length; i < imax; i += 2) {\n\t\t\t\t\t\t\t\tformattedBoundary[i] = formattedBoundaryBase[i] * scaleX;\n\t\t\t\t\t\t\t\tformattedBoundary[i + 1] = formattedBoundaryBase[i + 1] * scaleY;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Formatted ID\n\t\t\t\t\t\tthis._formattedId += 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis._id += 1;\n\t\t\t}\n\t\t}\n\t}\n\n\tget id(): number {\n\t\tthis.fit();\n\t\treturn this._id;\n\t}\n\n\tget values(): number[] {\n\t\tthis.fit();\n\t\treturn this._values;\n\t}\n\n\tset values(values: number[]) {\n\t\tthis.set(values, undefined, undefined);\n\t}\n\n\tget segments(): number[] {\n\t\treturn this._segments;\n\t}\n\n\t/**\n\t * Must be sorted in ascending order.\n\t */\n\tset segments(segments: number[]) {\n\t\tthis.set(undefined, segments, undefined);\n\t}\n\n\tget style(): EShapePointsStyle {\n\t\treturn this._style;\n\t}\n\n\tset style(style: EShapePointsStyle) {\n\t\tthis.set(undefined, undefined, style);\n\t}\n\n\tget marker(): EShapePointsMarkerContainer {\n\t\tlet result = this._marker;\n\t\tif (result == null) {\n\t\t\tresult = this.newMarker();\n\t\t\tthis._marker = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tgetMarker(): EShapePointsMarkerContainer | undefined {\n\t\treturn this._marker;\n\t}\n\n\tprotected newMarker(): EShapePointsMarkerContainer {\n\t\treturn new EShapePointsMarkerContainerImpl(this);\n\t}\n\n\tonMarkerTypeChange(): void {\n\t\tconst parent = this._parent;\n\t\tparent.uploaded = undefined;\n\t\tparent.toDirty();\n\t}\n\n\tonMarkerSizeChange(): void {\n\t\tthis._parent.updateUploaded();\n\t}\n\n\tonMarkerFillChange(): void {\n\t\tthis._parent.updateUploaded();\n\t}\n\n\tget formatter(): EShapePointsFormatter | null {\n\t\treturn this._formatter || null;\n\t}\n\n\tset formatter(formatter: EShapePointsFormatter | null) {\n\t\tif (this._formatter !== formatter) {\n\t\t\tthis._formattedId = -1;\n\t\t\tthis._formatter = formatter;\n\t\t\tthis.toDirty(true);\n\t\t}\n\t}\n\n\tget formatted(): EShapePointsFormatted {\n\t\tthis.fit();\n\t\tconst id = this._id;\n\t\tlet result = this._formatted;\n\t\tif (this._formattedId !== id) {\n\t\t\tthis._formattedId = id;\n\n\t\t\tconst style = this._style;\n\t\t\tlet formatter = this._formatter;\n\t\t\tif (formatter == null) {\n\t\t\t\tif (style & EShapePointsStyle.CURVE) {\n\t\t\t\t\tformatter = eShapePointsFormatterCurve;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (formatter != null) {\n\t\t\t\tif (result == null) {\n\t\t\t\t\tresult = {\n\t\t\t\t\t\tlength: 0,\n\t\t\t\t\t\tvalues: [],\n\t\t\t\t\t\tsegments: [],\n\t\t\t\t\t\tboundary: [0, 0, 0, 0],\n\t\t\t\t\t\tstyle: EShapePointsStyle.NONE\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tconst valuesBase = this._valuesBase;\n\t\t\t\tconst segments = this._segments;\n\t\t\t\tif (valuesBase != null) {\n\t\t\t\t\tconst length = valuesBase.length >> 1;\n\t\t\t\t\tformatter(length, valuesBase, segments, style, result);\n\t\t\t\t\ttoPointsBoundary(result.values, result.boundary);\n\n\t\t\t\t\tconst formattedValues = result.values;\n\t\t\t\t\tconst formattedValuesBase = formattedValues.splice(0);\n\t\t\t\t\tthis._formattedValuesBase = formattedValuesBase;\n\n\t\t\t\t\tconst formattedBoundary = result.boundary;\n\t\t\t\t\tconst formattedBoundaryBase: EShapePointsFormattedBoundary = [\n\t\t\t\t\t\tformattedBoundary[0],\n\t\t\t\t\t\tformattedBoundary[1],\n\t\t\t\t\t\tformattedBoundary[2],\n\t\t\t\t\t\tformattedBoundary[3]\n\t\t\t\t\t];\n\t\t\t\t\tthis._formattedBoundaryBase = formattedBoundaryBase;\n\n\t\t\t\t\tthis.toScaled(\n\t\t\t\t\t\tformattedValues,\n\t\t\t\t\t\tformattedValuesBase,\n\t\t\t\t\t\tformattedBoundary,\n\t\t\t\t\t\tformattedBoundaryBase\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tconst values = this._values;\n\t\t\t\t\tconst length = values.length >> 1;\n\t\t\t\t\tformatter(length, values, segments, style, result);\n\t\t\t\t\ttoPointsBoundary(result.values, result.boundary);\n\t\t\t\t\tthis._formattedValuesBase = undefined;\n\t\t\t\t\tthis._formattedBoundaryBase = undefined;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tresult = undefined;\n\t\t\t\tthis._formattedValuesBase = undefined;\n\t\t\t\tthis._formattedBoundaryBase = undefined;\n\t\t\t}\n\t\t\tthis._formatted = result;\n\t\t}\n\t\treturn result || this;\n\t}\n\n\tprotected toScaled(\n\t\tvalues: number[],\n\t\tvaluesBase: number[],\n\t\tboundary: EShapePointsFormattedBoundary,\n\t\tboundaryBase: EShapePointsFormattedBoundary\n\t): void {\n\t\tconst size = this._parentSizeFitted;\n\t\tconst sizeBase = this._parentSizeBase;\n\t\tconst threshold = 0.00001;\n\t\tconst hasSizeBaseX = threshold < Math.abs(sizeBase.x);\n\t\tconst hasSizeBaseY = threshold < Math.abs(sizeBase.y);\n\t\tif (hasSizeBaseX || hasSizeBaseY) {\n\t\t\tconst scaleX = hasSizeBaseX ? size.x / sizeBase.x : 1;\n\t\t\tconst scaleY = hasSizeBaseY ? size.y / sizeBase.y : 1;\n\n\t\t\tfor (let i = 0, imax = valuesBase.length; i < imax; i += 2) {\n\t\t\t\tvalues[i] = valuesBase[i] * scaleX;\n\t\t\t\tvalues[i + 1] = valuesBase[i + 1] * scaleY;\n\t\t\t}\n\n\t\t\tfor (let i = 0, imax = boundaryBase.length; i < imax; i += 2) {\n\t\t\t\tboundary[i] = boundaryBase[i] * scaleX;\n\t\t\t\tboundary[i + 1] = boundaryBase[i + 1] * scaleY;\n\t\t\t}\n\t\t}\n\t}\n\n\tcopy(source: EShapePoints): this {\n\t\tthis.set(source.values, source.segments, source.style);\n\t\tconst marker = source.getMarker();\n\t\tif (marker) {\n\t\t\tthis.marker.copy(marker);\n\t\t}\n\t\treturn this;\n\t}\n\n\tset(newValues?: number[], newSegments?: number[], newStyle?: EShapePointsStyle): this {\n\t\tlet isDirty = false;\n\t\tlet isUpdated = false;\n\n\t\t// Formatter\n\t\tconst style = this._style;\n\t\tconst styleFormatter = style & EShapePointsStyle.FORMATTER_MASK;\n\t\tconst formatter = this._formatter;\n\n\t\t// Values\n\t\tif (newValues != null) {\n\t\t\tconst values = this._values;\n\t\t\tconst valuesBaseLength = this._valuesBaseLength;\n\t\t\tconst newValuesLength = newValues.length;\n\t\t\tconst iupdate = Math.min(newValuesLength, valuesBaseLength);\n\t\t\tthis.toFitted();\n\t\t\tif (values !== newValues) {\n\t\t\t\tfor (let i = 0; i < iupdate; ++i) {\n\t\t\t\t\tvalues[i] = newValues[i];\n\t\t\t\t}\n\n\t\t\t\tfor (let i = iupdate; i < newValuesLength; ++i) {\n\t\t\t\t\tvalues.push(newValues[i]);\n\t\t\t\t}\n\n\t\t\t\tif (valuesBaseLength !== newValuesLength) {\n\t\t\t\t\tvalues.length = newValuesLength;\n\t\t\t\t\tthis._valuesBaseLength = newValuesLength;\n\t\t\t\t\tisDirty = true;\n\t\t\t\t} else {\n\t\t\t\t\tif (formatter != null || styleFormatter) {\n\t\t\t\t\t\tisDirty = true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tisUpdated = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (valuesBaseLength !== newValuesLength) {\n\t\t\t\t\tthis._valuesBaseLength = newValuesLength;\n\t\t\t\t\tisDirty = true;\n\t\t\t\t} else {\n\t\t\t\t\tif (formatter != null || styleFormatter) {\n\t\t\t\t\t\tisDirty = true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tisUpdated = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Segments\n\t\tif (newSegments != null) {\n\t\t\tconst segments = this._segments;\n\t\t\tif (segments !== newSegments) {\n\t\t\t\tconst newSegmentsLength = newSegments.length;\n\t\t\t\tconst iupdate = Math.min(segments.length, newSegmentsLength);\n\t\t\t\tfor (let i = 0; i < iupdate; ++i) {\n\t\t\t\t\tsegments[i] = newSegments[i];\n\t\t\t\t}\n\n\t\t\t\tfor (let i = iupdate; i < newSegmentsLength; ++i) {\n\t\t\t\t\tsegments.push(newSegments[i]);\n\t\t\t\t}\n\n\t\t\t\tif (segments.length !== newSegmentsLength) {\n\t\t\t\t\tsegments.length = newSegmentsLength;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (formatter != null || styleFormatter) {\n\t\t\t\tisDirty = true;\n\t\t\t} else {\n\t\t\t\tisUpdated = true;\n\t\t\t}\n\t\t}\n\n\t\t// Style\n\t\tif (newStyle != null) {\n\t\t\tif (style !== newStyle) {\n\t\t\t\tconst newStyleFormatter = newStyle & EShapePointsStyle.FORMATTER_MASK;\n\t\t\t\tif (styleFormatter !== newStyleFormatter) {\n\t\t\t\t\tisDirty = true;\n\t\t\t\t} else {\n\t\t\t\t\tif (formatter != null || styleFormatter) {\n\t\t\t\t\t\tconst styleClosed = style & EShapePointsStyle.CLOSED;\n\t\t\t\t\t\tconst newStyleClosed = newStyle & EShapePointsStyle.CLOSED;\n\t\t\t\t\t\tif (styleClosed !== newStyleClosed) {\n\t\t\t\t\t\t\tisDirty = true;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tisUpdated = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tisUpdated = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis._style = newStyle;\n\t\t\t}\n\t\t}\n\n\t\t//\n\t\tif (isUpdated || isDirty) {\n\t\t\tthis.toDirty(isDirty);\n\t\t}\n\t\treturn this;\n\t}\n\n\tprotected toDirty(revalidate: boolean): void {\n\t\tif (revalidate) {\n\t\t\tthis._id += 1;\n\t\t\tconst parent = this._parent;\n\t\t\tconst uploaded = parent.uploaded;\n\t\t\tif (uploaded) {\n\t\t\t\tif (uploaded.isCompatible(parent)) {\n\t\t\t\t\tparent.updateUploaded();\n\t\t\t\t} else {\n\t\t\t\t\tparent.uploaded = undefined;\n\t\t\t\t\tparent.toDirty();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tparent.updateUploaded();\n\t\t\t}\n\t\t} else {\n\t\t\tthis._id += 1;\n\t\t\tthis._parent.updateUploaded();\n\t\t}\n\t}\n\n\tclone(parent: EShape): EShapeLinePoints {\n\t\treturn new EShapeLinePoints(parent).copy(this);\n\t}\n\n\ttoPoints(transform: Matrix): Point[] {\n\t\tconst result: Point[] = [];\n\t\tconst values = this.values;\n\t\tfor (let i = 0, imax = values.length; i < imax; i += 2) {\n\t\t\tconst point = new Point(values[i + 0], values[i + 1]);\n\t\t\tresult.push(transform.apply(point, point));\n\t\t}\n\t\treturn result;\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\tconst values = JSON.stringify(this._values);\n\t\tconst segments = JSON.stringify(this._segments);\n\t\tconst style = this._style;\n\t\tlet markerId = -1;\n\t\tconst marker = this._marker;\n\t\tif (marker) {\n\t\t\tmarkerId = marker.serialize(manager);\n\t\t}\n\t\treturn manager.addResource(`[${values},${segments},${style},${markerId}]`);\n\t}\n\n\tdeserialize(resourceId: number, manager: EShapeResourceManagerDeserialization): void {\n\t\tconst resources = manager.resources;\n\t\tif (0 <= resourceId && resourceId < resources.length) {\n\t\t\tlet parsed = manager.getExtension<EShapeLinePointsSerialized>(resourceId);\n\t\t\tif (parsed == null) {\n\t\t\t\tparsed = JSON.parse(resources[resourceId]) as EShapeLinePointsSerialized;\n\t\t\t\tmanager.setExtension(resourceId, parsed);\n\t\t\t}\n\t\t\tthis.set(parsed[0], parsed[1], parsed[2]);\n\t\t\tconst markerId = parsed[3];\n\t\t\tif (markerId != null && 0 <= markerId) {\n\t\t\t\tthis.marker.deserialize(markerId, manager);\n\t\t\t}\n\t\t}\n\t}\n\n\tcalcHitPointAbs<RESULT>(\n\t\tx: number,\n\t\ty: number,\n\t\tax: number,\n\t\tay: number,\n\t\tthreshold: number,\n\t\ttoRange: EShapeLineBasePointsHitTesterToRange | null,\n\t\ttester: EShapeLineBasePointsHitTester<RESULT>,\n\t\tresult: RESULT\n\t): boolean {\n\t\tconst formatted = this.formatted;\n\t\tconst length = formatted.length;\n\t\tif (2 <= length) {\n\t\t\tconst values = formatted.values;\n\t\t\tconst segments = formatted.segments;\n\t\t\tconst style = formatted.style;\n\t\t\tlet istart = 0;\n\t\t\tlet iend = length;\n\t\t\tif (toRange) {\n\t\t\t\tconst work = EShapeLinePoints.WORK_RANGE;\n\t\t\t\ttoRange(x, y, threshold, values, work);\n\t\t\t\tistart = work[0];\n\t\t\t\tiend = work[1];\n\t\t\t}\n\t\t\tfor (let i = istart, imax = Math.min(iend, length - 1); i < imax; ++i) {\n\t\t\t\tif (toIndexOf(segments, i + 1) < 0) {\n\t\t\t\t\tconst iv = i << 1;\n\t\t\t\t\tconst p0x = values[iv + 0];\n\t\t\t\t\tconst p0y = values[iv + 1];\n\t\t\t\t\tconst p1x = values[iv + 2];\n\t\t\t\t\tconst p1y = values[iv + 3];\n\t\t\t\t\tif (tester(x, y, p0x, p0y, p1x, p1y, i, threshold, result)) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (2 < length && length <= iend && style & EShapePointsStyle.CLOSED) {\n\t\t\t\tif (toIndexOf(segments, 0) < 0) {\n\t\t\t\t\tconst i = length - 1;\n\t\t\t\t\tconst iv = i << 1;\n\t\t\t\t\tconst p0x = values[iv + 0];\n\t\t\t\t\tconst p0y = values[iv + 1];\n\t\t\t\t\tconst p1x = values[0];\n\t\t\t\t\tconst p1y = values[1];\n\t\t\t\t\tif (tester(x, y, p0x, p0y, p1x, p1y, i, threshold, result)) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n}\n","import { Matrix, Point, TextureUvs } from \"pixi.js\";\nimport { EShapeStrokeSide } from \"../e-shape-stroke-side\";\nimport { EShapeStrokeStyle } from \"../e-shape-stroke-style\";\nimport { toLength } from \"./to-length\";\nimport { toScaleInvariant } from \"./to-scale-invariant\";\n\nexport const RECTANGLE_VERTEX_COUNT = 24;\nexport const RECTANGLE_INDEX_COUNT = 16;\nexport const RECTANGLE_WORLD_SIZE: [number, number, number, number] = [0, 0, 0, 0];\nconst RECTANGLE_WORK_POINT: Point = new Point();\n\nexport const buildRectangleClipping = (\n\tclippings: Float32Array,\n\tvoffset: number,\n\tworldSize: typeof RECTANGLE_WORLD_SIZE\n): void => {\n\tconst brxi = 1 - worldSize[0];\n\tconst bryi = 1 - worldSize[1];\n\n\tlet ic = voffset * 3 - 1;\n\tclippings[++ic] = 0;\n\tclippings[++ic] = 1;\n\tclippings[++ic] = 0;\n\n\tclippings[++ic] = 0;\n\tclippings[++ic] = 1;\n\tclippings[++ic] = 0;\n\n\tclippings[++ic] = 0;\n\tclippings[++ic] = 1;\n\tclippings[++ic] = 0;\n\n\tclippings[++ic] = 0;\n\tclippings[++ic] = 1;\n\tclippings[++ic] = 0;\n\n\tclippings[++ic] = 0;\n\tclippings[++ic] = bryi;\n\tclippings[++ic] = 0;\n\n\tclippings[++ic] = 0;\n\tclippings[++ic] = bryi;\n\tclippings[++ic] = 0;\n\n\t// --------------------------------\n\n\tclippings[++ic] = 0;\n\tclippings[++ic] = bryi;\n\tclippings[++ic] = 0;\n\n\tclippings[++ic] = 0;\n\tclippings[++ic] = bryi;\n\tclippings[++ic] = 0;\n\n\tclippings[++ic] = 0;\n\tclippings[++ic] = 1;\n\tclippings[++ic] = 0;\n\n\tclippings[++ic] = 0;\n\tclippings[++ic] = 1;\n\tclippings[++ic] = 0;\n\n\tclippings[++ic] = 0;\n\tclippings[++ic] = 1;\n\tclippings[++ic] = 0;\n\n\tclippings[++ic] = 0;\n\tclippings[++ic] = 1;\n\tclippings[++ic] = 0;\n\n\t// --------------------------------\n\n\tclippings[++ic] = 1;\n\tclippings[++ic] = 0;\n\tclippings[++ic] = 0;\n\n\tclippings[++ic] = 1;\n\tclippings[++ic] = 0;\n\tclippings[++ic] = 0;\n\n\tclippings[++ic] = 1;\n\tclippings[++ic] = 0;\n\tclippings[++ic] = 0;\n\n\tclippings[++ic] = 1;\n\tclippings[++ic] = 0;\n\tclippings[++ic] = 0;\n\n\tclippings[++ic] = brxi;\n\tclippings[++ic] = 0;\n\tclippings[++ic] = 0;\n\n\tclippings[++ic] = brxi;\n\tclippings[++ic] = 0;\n\tclippings[++ic] = 0;\n\n\t// --------------------------------\n\n\tclippings[++ic] = brxi;\n\tclippings[++ic] = 0;\n\tclippings[++ic] = 0;\n\n\tclippings[++ic] = brxi;\n\tclippings[++ic] = 0;\n\tclippings[++ic] = 0;\n\n\tclippings[++ic] = 1;\n\tclippings[++ic] = 0;\n\tclippings[++ic] = 0;\n\n\tclippings[++ic] = 1;\n\tclippings[++ic] = 0;\n\tclippings[++ic] = 0;\n\n\tclippings[++ic] = 1;\n\tclippings[++ic] = 0;\n\tclippings[++ic] = 0;\n\n\tclippings[++ic] = 1;\n\tclippings[++ic] = 0;\n\tclippings[++ic] = 0;\n};\n\nexport const buildRectangleIndex = (\n\tindices: Uint16Array | Uint32Array,\n\tvoffset: number,\n\tioffset: number\n): void => {\n\tlet ii = ioffset * 3 - 1;\n\tindices[++ii] = voffset + 0;\n\tindices[++ii] = voffset + 1;\n\tindices[++ii] = voffset + 4;\n\n\tindices[++ii] = voffset + 4;\n\tindices[++ii] = voffset + 1;\n\tindices[++ii] = voffset + 2;\n\n\tindices[++ii] = voffset + 4;\n\tindices[++ii] = voffset + 2;\n\tindices[++ii] = voffset + 5;\n\n\tindices[++ii] = voffset + 5;\n\tindices[++ii] = voffset + 2;\n\tindices[++ii] = voffset + 3;\n\n\t// --------------------------------\n\n\tindices[++ii] = voffset + 8;\n\tindices[++ii] = voffset + 6;\n\tindices[++ii] = voffset + 9;\n\n\tindices[++ii] = voffset + 9;\n\tindices[++ii] = voffset + 6;\n\tindices[++ii] = voffset + 7;\n\n\tindices[++ii] = voffset + 9;\n\tindices[++ii] = voffset + 7;\n\tindices[++ii] = voffset + 10;\n\n\tindices[++ii] = voffset + 10;\n\tindices[++ii] = voffset + 7;\n\tindices[++ii] = voffset + 11;\n\n\t// --------------------------------\n\n\tindices[++ii] = voffset + 12;\n\tindices[++ii] = voffset + 16;\n\tindices[++ii] = voffset + 13;\n\n\tindices[++ii] = voffset + 13;\n\tindices[++ii] = voffset + 16;\n\tindices[++ii] = voffset + 17;\n\n\tindices[++ii] = voffset + 13;\n\tindices[++ii] = voffset + 17;\n\tindices[++ii] = voffset + 14;\n\n\tindices[++ii] = voffset + 14;\n\tindices[++ii] = voffset + 17;\n\tindices[++ii] = voffset + 15;\n\n\t// --------------------------------\n\n\tindices[++ii] = voffset + 18;\n\tindices[++ii] = voffset + 20;\n\tindices[++ii] = voffset + 21;\n\n\tindices[++ii] = voffset + 18;\n\tindices[++ii] = voffset + 21;\n\tindices[++ii] = voffset + 22;\n\n\tindices[++ii] = voffset + 18;\n\tindices[++ii] = voffset + 22;\n\tindices[++ii] = voffset + 19;\n\n\tindices[++ii] = voffset + 19;\n\tindices[++ii] = voffset + 22;\n\tindices[++ii] = voffset + 23;\n};\n\nexport const buildRectangleVertex = (\n\tvertices: Float32Array,\n\tvoffset: number,\n\toriginX: number,\n\toriginY: number,\n\tsizeX: number,\n\tsizeY: number,\n\tstrokeAlign: number,\n\tstrokeWidth: number,\n\tinternalTransform: Matrix,\n\tworldSize: typeof RECTANGLE_WORLD_SIZE\n): void => {\n\t// b0              b1\n\t// |-------|-------|\n\t// |       |       |\n\t// |-------|-------|\n\t// |       |       |\n\t// |-------|-------|\n\t// b3              b2\n\tconst s = strokeAlign * strokeWidth;\n\tconst sx = sizeX * 0.5 + (0 <= sizeX ? +s : -s);\n\tconst sy = sizeY * 0.5 + (0 <= sizeY ? +s : -s);\n\tconst work = RECTANGLE_WORK_POINT;\n\twork.set(originX - sx, originY - sy);\n\tinternalTransform.apply(work, work);\n\tconst b0x = work.x;\n\tconst b0y = work.y;\n\twork.set(originX + sx, originY - sy);\n\tinternalTransform.apply(work, work);\n\tconst b1x = work.x;\n\tconst b1y = work.y;\n\twork.set(originX + sx, originY + sy);\n\tinternalTransform.apply(work, work);\n\tconst b2x = work.x;\n\tconst b2y = work.y;\n\tconst b3x = b0x + (b2x - b1x);\n\tconst b3y = b0y + (b2y - b1y);\n\n\tconst ax = toLength(b0x, b0y, b1x, b1y) * 0.5;\n\tconst ay = toLength(b1x, b1y, b2x, b2y) * 0.5;\n\tlet brx = 1;\n\tlet bry = 1;\n\tif (ax <= ay) {\n\t\tbry = ax / ay;\n\t} else {\n\t\tbrx = ay / ax;\n\t}\n\tworldSize[0] = brx;\n\tworldSize[1] = bry;\n\tworldSize[2] = ax;\n\tworldSize[3] = ay;\n\n\t// 0      1  2      3\n\t// |------|--|------|\n\t// |      |  |      |\n\t// |------4--5------|\n\t// |      |  |      |\n\t// |------6--7------|\n\t// |      |  |      |\n\t// |------|--|------|\n\t// 8      9  10     11\n\tconst d01x = brx * (b1x - b0x) * 0.5;\n\tconst d01y = brx * (b1y - b0y) * 0.5;\n\tconst d03x = bry * (b3x - b0x) * 0.5;\n\tconst d03y = bry * (b3y - b0y) * 0.5;\n\tlet iv = (voffset << 1) - 1;\n\tvertices[++iv] = b0x;\n\tvertices[++iv] = b0y;\n\tvertices[++iv] = b0x + d01x;\n\tvertices[++iv] = b0y + d01y;\n\tvertices[++iv] = b1x - d01x;\n\tvertices[++iv] = b1y - d01y;\n\tvertices[++iv] = b1x;\n\tvertices[++iv] = b1y;\n\n\tvertices[++iv] = b0x + d01x + d03x;\n\tvertices[++iv] = b0y + d01y + d03y;\n\tvertices[++iv] = b1x - d01x + d03x;\n\tvertices[++iv] = b1y - d01y + d03y;\n\n\tvertices[++iv] = b3x + d01x - d03x;\n\tvertices[++iv] = b3y + d01y - d03y;\n\tvertices[++iv] = b2x - d01x - d03x;\n\tvertices[++iv] = b2y - d01y - d03y;\n\n\tvertices[++iv] = b3x;\n\tvertices[++iv] = b3y;\n\tvertices[++iv] = b3x + d01x;\n\tvertices[++iv] = b3y + d01y;\n\tvertices[++iv] = b2x - d01x;\n\tvertices[++iv] = b2y - d01y;\n\tvertices[++iv] = b2x;\n\tvertices[++iv] = b2y;\n\n\t// 12               20\n\t// |------|--|------|\n\t// |      |  |      |\n\t// 13----16--18-----21\n\t// |      |  |      |\n\t// 14----17--19-----22\n\t// |      |  |      |\n\t// |------|--|------|\n\t// 15               23\n\tvertices[++iv] = b0x;\n\tvertices[++iv] = b0y;\n\tvertices[++iv] = b0x + d03x;\n\tvertices[++iv] = b0y + d03y;\n\tvertices[++iv] = b3x - d03x;\n\tvertices[++iv] = b3y - d03y;\n\tvertices[++iv] = b3x;\n\tvertices[++iv] = b3y;\n\n\tvertices[++iv] = b0x + d03x + d01x;\n\tvertices[++iv] = b0y + d03y + d01y;\n\tvertices[++iv] = b3x - d03x + d01x;\n\tvertices[++iv] = b3y - d03y + d01y;\n\n\tvertices[++iv] = b1x + d03x - d01x;\n\tvertices[++iv] = b1y + d03y - d01y;\n\tvertices[++iv] = b2x - d03x - d01x;\n\tvertices[++iv] = b2y - d03y - d01y;\n\n\tvertices[++iv] = b1x;\n\tvertices[++iv] = b1y;\n\tvertices[++iv] = b1x + d03x;\n\tvertices[++iv] = b1y + d03y;\n\tvertices[++iv] = b2x - d03x;\n\tvertices[++iv] = b2y - d03y;\n\tvertices[++iv] = b2x;\n\tvertices[++iv] = b2y;\n};\n\nexport const buildRectangleStep = (\n\tvoffset: number,\n\tsteps: Float32Array,\n\tstrokeWidth: number,\n\tstrokeSide: EShapeStrokeSide,\n\tstrokeStyle: EShapeStrokeStyle,\n\tworldSize: typeof RECTANGLE_WORLD_SIZE\n): void => {\n\tconst scaleInvariant = toScaleInvariant(strokeStyle);\n\n\tconst brx = worldSize[0];\n\tconst bry = worldSize[1];\n\tconst brxi = Math.max(0, 1 - brx);\n\tconst bryi = Math.max(0, 1 - bry);\n\tconst sx = worldSize[2];\n\tconst sy = worldSize[3];\n\n\tlet wt: number;\n\tlet bt: number;\n\tif (strokeSide & EShapeStrokeSide.TOP) {\n\t\twt = +2;\n\t\tbt = +1 + bryi;\n\t} else {\n\t\twt = -2;\n\t\tbt = -1 - bryi;\n\t}\n\n\tlet wr: number;\n\tlet br: number;\n\tif (strokeSide & EShapeStrokeSide.RIGHT) {\n\t\twr = +2;\n\t\tbr = +1 + brxi;\n\t} else {\n\t\twr = -2;\n\t\tbr = -1 - brxi;\n\t}\n\n\tlet wb: number;\n\tlet bb: number;\n\tif (strokeSide & EShapeStrokeSide.BOTTOM) {\n\t\twb = +2;\n\t\tbb = +1 + bryi;\n\t} else {\n\t\twb = -2;\n\t\tbb = -1 - bryi;\n\t}\n\n\tlet wl: number;\n\tlet bl: number;\n\tif (strokeSide & EShapeStrokeSide.LEFT) {\n\t\twl = +2;\n\t\tbl = +1 + brxi;\n\t} else {\n\t\twl = -2;\n\t\tbl = -1 - brxi;\n\t}\n\n\t// 0 1 2 3\n\tlet is = (voffset - 1) * 6 - 1;\n\tfillRectangleStep(steps, (is += 6), strokeWidth, scaleInvariant, sx, sy, wl, wt);\n\tfillRectangleStep(steps, (is += 6), strokeWidth, scaleInvariant, sx, sy, bl, wt);\n\tfillRectangleStep(steps, (is += 6), strokeWidth, scaleInvariant, sx, sy, br, wt);\n\tfillRectangleStep(steps, (is += 6), strokeWidth, scaleInvariant, sx, sy, wr, wt);\n\n\t// 4 5\n\tfillRectangleStep(steps, (is += 6), strokeWidth, scaleInvariant, sx, sy, bl, bt);\n\tfillRectangleStep(steps, (is += 6), strokeWidth, scaleInvariant, sx, sy, br, bt);\n\n\t// 6 7\n\tfillRectangleStep(steps, (is += 6), strokeWidth, scaleInvariant, sx, sy, bl, bb);\n\tfillRectangleStep(steps, (is += 6), strokeWidth, scaleInvariant, sx, sy, br, bb);\n\n\t// 8 9 10 11\n\tfillRectangleStep(steps, (is += 6), strokeWidth, scaleInvariant, sx, sy, wl, wb);\n\tfillRectangleStep(steps, (is += 6), strokeWidth, scaleInvariant, sx, sy, bl, wb);\n\tfillRectangleStep(steps, (is += 6), strokeWidth, scaleInvariant, sx, sy, br, wb);\n\tfillRectangleStep(steps, (is += 6), strokeWidth, scaleInvariant, sx, sy, wr, wb);\n\n\t// ------------------------------\n\n\t// 12 13 14 15\n\tfillRectangleStep(steps, (is += 6), strokeWidth, scaleInvariant, sx, sy, wl, wt);\n\tfillRectangleStep(steps, (is += 6), strokeWidth, scaleInvariant, sx, sy, wl, bt);\n\tfillRectangleStep(steps, (is += 6), strokeWidth, scaleInvariant, sx, sy, wl, bb);\n\tfillRectangleStep(steps, (is += 6), strokeWidth, scaleInvariant, sx, sy, wl, wb);\n\n\t// 16 17\n\tfillRectangleStep(steps, (is += 6), strokeWidth, scaleInvariant, sx, sy, bl, bt);\n\tfillRectangleStep(steps, (is += 6), strokeWidth, scaleInvariant, sx, sy, bl, bb);\n\n\t// 18 19\n\tfillRectangleStep(steps, (is += 6), strokeWidth, scaleInvariant, sx, sy, br, bt);\n\tfillRectangleStep(steps, (is += 6), strokeWidth, scaleInvariant, sx, sy, br, bb);\n\n\t// 20 21 22 23\n\tfillRectangleStep(steps, (is += 6), strokeWidth, scaleInvariant, sx, sy, wr, wt);\n\tfillRectangleStep(steps, (is += 6), strokeWidth, scaleInvariant, sx, sy, wr, bt);\n\tfillRectangleStep(steps, (is += 6), strokeWidth, scaleInvariant, sx, sy, wr, bb);\n\tfillRectangleStep(steps, (is += 6), strokeWidth, scaleInvariant, sx, sy, wr, wb);\n};\n\nconst fillRectangleStep = (\n\tsteps: Float32Array,\n\tis: number,\n\tv0: number,\n\tv1: number,\n\tv2: number,\n\tv3: number,\n\tv4: number,\n\tv5: number\n): void => {\n\tsteps[++is] = v0;\n\tsteps[++is] = v1;\n\tsteps[++is] = v2;\n\tsteps[++is] = v3;\n\tsteps[++is] = v4;\n\tsteps[++is] = v5;\n};\n\nexport const buildRectangleUv = (\n\tuvs: Float32Array,\n\tvoffset: number,\n\ttextureUvs: TextureUvs,\n\tworldSize: typeof RECTANGLE_WORLD_SIZE\n): void => {\n\tconst x0 = textureUvs.x0;\n\tconst y0 = textureUvs.y0;\n\tconst y1 = textureUvs.y1;\n\tconst x1 = textureUvs.x1;\n\tconst y2 = textureUvs.y2;\n\tconst x2 = textureUvs.x2;\n\tconst y3 = textureUvs.y3;\n\tconst x3 = textureUvs.x3;\n\n\tconst brx = worldSize[0];\n\tconst bry = worldSize[1];\n\tconst d01x = brx * (x1 - x0) * 0.5;\n\tconst d01y = brx * (y1 - y0) * 0.5;\n\tconst d03x = bry * (x3 - x0) * 0.5;\n\tconst d03y = bry * (y3 - y0) * 0.5;\n\n\t// UVs\n\tlet iuv = (voffset << 1) - 1;\n\tuvs[++iuv] = x0;\n\tuvs[++iuv] = y0;\n\tuvs[++iuv] = x0 + d01x;\n\tuvs[++iuv] = y0 + d01y;\n\tuvs[++iuv] = x1 - d01x;\n\tuvs[++iuv] = y1 - d01y;\n\tuvs[++iuv] = x1;\n\tuvs[++iuv] = y1;\n\n\tuvs[++iuv] = x0 + d01x + d03x;\n\tuvs[++iuv] = y0 + d01y + d03y;\n\tuvs[++iuv] = x1 - d01x + d03x;\n\tuvs[++iuv] = y1 - d01y + d03y;\n\n\tuvs[++iuv] = x3 + d01x - d03x;\n\tuvs[++iuv] = y3 + d01y - d03y;\n\tuvs[++iuv] = x2 - d01x - d03x;\n\tuvs[++iuv] = y2 - d01y - d03y;\n\n\tuvs[++iuv] = x3;\n\tuvs[++iuv] = y3;\n\tuvs[++iuv] = x3 + d01x;\n\tuvs[++iuv] = y3 + d01y;\n\tuvs[++iuv] = x2 - d01x;\n\tuvs[++iuv] = y2 - d01y;\n\tuvs[++iuv] = x2;\n\tuvs[++iuv] = y2;\n\n\t// ------------------------------\n\n\tuvs[++iuv] = x0;\n\tuvs[++iuv] = y0;\n\tuvs[++iuv] = x0 + d03x;\n\tuvs[++iuv] = y0 + d03y;\n\tuvs[++iuv] = x3 - d03x;\n\tuvs[++iuv] = y3 - d03y;\n\tuvs[++iuv] = x3;\n\tuvs[++iuv] = y3;\n\n\tuvs[++iuv] = x0 + d03x + d01x;\n\tuvs[++iuv] = y0 + d03y + d01y;\n\tuvs[++iuv] = x3 - d03x + d01x;\n\tuvs[++iuv] = y3 - d03y + d01y;\n\n\tuvs[++iuv] = x1 + d03x - d01x;\n\tuvs[++iuv] = y1 + d03y - d01y;\n\tuvs[++iuv] = x2 - d03x - d01x;\n\tuvs[++iuv] = y2 - d03y - d01y;\n\n\tuvs[++iuv] = x1;\n\tuvs[++iuv] = y1;\n\tuvs[++iuv] = x1 + d03x;\n\tuvs[++iuv] = y1 + d03y;\n\tuvs[++iuv] = x2 - d03x;\n\tuvs[++iuv] = y2 - d03y;\n\tuvs[++iuv] = x2;\n\tuvs[++iuv] = y2;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Matrix } from \"pixi.js\";\nimport { EShape } from \"../e-shape\";\nimport { EShapeBuffer } from \"../e-shape-buffer\";\nimport {\n\tbuildRectangleClipping,\n\tbuildRectangleIndex,\n\tbuildRectangleStep,\n\tbuildRectangleUv,\n\tbuildRectangleVertex,\n\tRECTANGLE_INDEX_COUNT,\n\tRECTANGLE_VERTEX_COUNT,\n\tRECTANGLE_WORLD_SIZE\n} from \"./build-rectangle\";\nimport { BuilderMarkerBase } from \"./builder-marker-base\";\nimport { toTexture, toTextureTransformId, toTextureUvs, toTransformLocalId } from \"./builders\";\n\nexport abstract class BuilderMarkerRectangle extends BuilderMarkerBase {\n\tprotected static WORK?: Matrix;\n\tprotected pointId: number;\n\n\tconstructor(vertexOffset: number, indexOffset: number) {\n\t\tsuper(vertexOffset, indexOffset, RECTANGLE_VERTEX_COUNT, RECTANGLE_INDEX_COUNT);\n\t\tthis.pointId = -1;\n\t}\n\n\tinit(buffer: EShapeBuffer): void {\n\t\tbuffer.updateIndices();\n\t\tbuildRectangleIndex(buffer.indices, this.vertexOffset, this.indexOffset);\n\t}\n\n\tupdate(buffer: EShapeBuffer, shape: EShape): void {\n\t\tthis.updateVertexClippingStepAndUv(buffer, shape);\n\t\tthis.updateColorFill(buffer, shape);\n\t\tthis.updateColorStroke(buffer, shape);\n\t}\n\n\tprotected updateVertexClippingStepAndUv(buffer: EShapeBuffer, shape: EShape): void {\n\t\tconst points = shape.points;\n\t\tif (points == null) {\n\t\t\treturn;\n\t\t}\n\t\tconst container = points.getMarker();\n\t\tif (container == null) {\n\t\t\treturn;\n\t\t}\n\t\tconst marker = this.toMarker(container);\n\t\tconst size = marker.size;\n\t\tconst sizeX = size.x;\n\t\tconst sizeY = size.y;\n\t\tconst isSizeChanged = sizeX !== this.sizeX || sizeY !== this.sizeY;\n\n\t\tconst transformLocalId = toTransformLocalId(shape);\n\t\tconst isTransformChanged = this.transformLocalId !== transformLocalId;\n\n\t\tconst stroke = shape.stroke;\n\t\tconst strokeAlign = stroke.align;\n\t\tconst strokeWidth = stroke.enable ? stroke.width : 0;\n\t\tconst strokeSide = stroke.side;\n\t\tconst strokeStyle = stroke.style;\n\t\tconst isStrokeChanged =\n\t\t\tthis.strokeAlign !== strokeAlign ||\n\t\t\tthis.strokeWidth !== strokeWidth ||\n\t\t\tthis.strokeSide !== strokeSide ||\n\t\t\tthis.strokeStyle !== strokeStyle;\n\n\t\tconst texture = toTexture(shape);\n\t\tconst textureTransformId = toTextureTransformId(texture);\n\t\tconst isTextureChanged =\n\t\t\ttexture !== this.texture || textureTransformId !== this.textureTransformId;\n\n\t\tconst isVertexChanged = isSizeChanged || isStrokeChanged;\n\n\t\tconst pointId = points.id;\n\t\tconst isPointChanged = pointId !== this.pointId;\n\n\t\tif (isVertexChanged || isTransformChanged || isTextureChanged || isPointChanged) {\n\t\t\tthis.sizeX = sizeX;\n\t\t\tthis.sizeY = sizeY;\n\t\t\tthis.transformLocalId = transformLocalId;\n\t\t\tthis.strokeAlign = strokeAlign;\n\t\t\tthis.strokeWidth = strokeWidth;\n\t\t\tthis.strokeSide = strokeSide;\n\t\t\tthis.strokeStyle = strokeStyle;\n\t\t\tthis.texture = texture;\n\t\t\tthis.textureTransformId = textureTransformId;\n\n\t\t\t// Vertices\n\t\t\tconst voffset = this.vertexOffset;\n\t\t\tconst internalTransform = (BuilderMarkerRectangle.WORK ??= new Matrix());\n\t\t\tinternalTransform.copyFrom(marker.transform).prepend(shape.transform.internalTransform);\n\t\t\tbuffer.updateVertices();\n\t\t\tbuildRectangleVertex(\n\t\t\t\tbuffer.vertices,\n\t\t\t\tvoffset,\n\t\t\t\t0,\n\t\t\t\t0,\n\t\t\t\tsizeX,\n\t\t\t\tsizeY,\n\t\t\t\tstrokeAlign,\n\t\t\t\tstrokeWidth,\n\t\t\t\tinternalTransform,\n\t\t\t\tRECTANGLE_WORLD_SIZE\n\t\t\t);\n\n\t\t\t// Steps\n\t\t\tif (isVertexChanged || isTransformChanged) {\n\t\t\t\tbuffer.updateSteps();\n\t\t\t\tbuildRectangleStep(\n\t\t\t\t\tvoffset,\n\t\t\t\t\tbuffer.steps,\n\t\t\t\t\tstrokeWidth,\n\t\t\t\t\tstrokeSide,\n\t\t\t\t\tstrokeStyle,\n\t\t\t\t\tRECTANGLE_WORLD_SIZE\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t// Clippings\n\t\t\tif (isVertexChanged) {\n\t\t\t\tbuffer.updateClippings();\n\t\t\t\tbuildRectangleClipping(buffer.clippings, voffset, RECTANGLE_WORLD_SIZE);\n\t\t\t}\n\n\t\t\t// UVs\n\t\t\tif (isVertexChanged || isTextureChanged) {\n\t\t\t\tbuffer.updateUvs();\n\t\t\t\tbuildRectangleUv(buffer.uvs, voffset, toTextureUvs(texture), RECTANGLE_WORLD_SIZE);\n\t\t\t}\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapePointsMarker } from \"../e-shape-points-marker\";\nimport { EShapePointsMarkerContainer } from \"../e-shape-points-marker-container\";\nimport { BuilderMarkerRectangle } from \"./builder-marker-rectangle\";\n\nexport class BuilderMarkerRectangleTail extends BuilderMarkerRectangle {\n\tprotected toMarker(container: EShapePointsMarkerContainer): EShapePointsMarker {\n\t\treturn container.tail;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapePointsMarker } from \"../e-shape-points-marker\";\nimport { EShapePointsMarkerContainer } from \"../e-shape-points-marker-container\";\nimport { BuilderMarkerRectangle } from \"./builder-marker-rectangle\";\n\nexport class BuilderMarkerRectangleHead extends BuilderMarkerRectangle {\n\tprotected toMarker(container: EShapePointsMarkerContainer): EShapePointsMarker {\n\t\treturn container.head;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeBuffer } from \"../e-shape-buffer\";\nimport { EShapePointsMarkerType } from \"../e-shape-points-marker-type\";\nimport { EShapeUploadedImpl } from \"../e-shape-uploaded\";\nimport { toLineIndexCount, toLinePointCount, toLineVertexCount } from \"./build-line\";\nimport { TEXT_INDEX_COUNT, TEXT_VERTEX_COUNT, toTextBufferCount } from \"./build-text\";\nimport { Builder } from \"./builder\";\nimport { BuilderLine } from \"./builder-line\";\nimport { BuilderMarkerTriangleHead } from \"./builder-marker-triangle-head\";\nimport { BuilderMarkerTriangleTail } from \"./builder-marker-triangle-tail\";\nimport { BuilderMarkerCircleHead } from \"./builder-marker-circle-head\";\nimport { BuilderMarkerCircleTail } from \"./builder-marker-circle-tail\";\nimport { BuilderNull } from \"./builder-null\";\nimport { BuilderText } from \"./builder-text\";\nimport { EShapeLinePoints } from \"./e-shape-line-points\";\nimport { TRIANGLE_INDEX_COUNT, TRIANGLE_VERTEX_COUNT } from \"./build-triangle\";\nimport { CIRCLE_INDEX_COUNT, CIRCLE_VERTEX_COUNT } from \"./build-circle\";\nimport { BuilderMarkerRectangleTail } from \"./builder-marker-rectangle-tail\";\nimport { BuilderMarkerRectangleHead } from \"./builder-marker-rectangle-head\";\nimport { RECTANGLE_INDEX_COUNT, RECTANGLE_VERTEX_COUNT } from \"./build-rectangle\";\n\nconst toMarkerVertexCount = (type: EShapePointsMarkerType): number => {\n\tswitch (type) {\n\t\tcase EShapePointsMarkerType.NONE:\n\t\t\treturn 0;\n\t\tcase EShapePointsMarkerType.CIRCLE:\n\t\t\treturn CIRCLE_VERTEX_COUNT;\n\t\tcase EShapePointsMarkerType.TRIANGLE:\n\t\t\treturn TRIANGLE_VERTEX_COUNT;\n\t\tcase EShapePointsMarkerType.RECTANGLE:\n\t\t\treturn RECTANGLE_VERTEX_COUNT;\n\t}\n\treturn 0;\n};\n\nconst toMarkerIndexCount = (type: EShapePointsMarkerType): number => {\n\tswitch (type) {\n\t\tcase EShapePointsMarkerType.NONE:\n\t\t\treturn 0;\n\t\tcase EShapePointsMarkerType.CIRCLE:\n\t\t\treturn CIRCLE_INDEX_COUNT;\n\t\tcase EShapePointsMarkerType.TRIANGLE:\n\t\t\treturn TRIANGLE_INDEX_COUNT;\n\t\tcase EShapePointsMarkerType.RECTANGLE:\n\t\t\treturn RECTANGLE_INDEX_COUNT;\n\t}\n\treturn 0;\n};\n\nconst toBuilderMarkerHead = (\n\ttype: EShapePointsMarkerType,\n\tvertexOffset: number,\n\tindexOffset: number\n): Builder => {\n\tswitch (type) {\n\t\tcase EShapePointsMarkerType.NONE:\n\t\t\treturn new BuilderNull(vertexOffset, indexOffset);\n\t\tcase EShapePointsMarkerType.CIRCLE:\n\t\t\treturn new BuilderMarkerCircleHead(vertexOffset, indexOffset);\n\t\tcase EShapePointsMarkerType.TRIANGLE:\n\t\t\treturn new BuilderMarkerTriangleHead(vertexOffset, indexOffset);\n\t\tcase EShapePointsMarkerType.RECTANGLE:\n\t\t\treturn new BuilderMarkerRectangleHead(vertexOffset, indexOffset);\n\t}\n\treturn new BuilderNull(vertexOffset, indexOffset);\n};\n\nconst toBuilderMarkerTail = (\n\ttype: EShapePointsMarkerType,\n\tvertexOffset: number,\n\tindexOffset: number\n): Builder => {\n\tswitch (type) {\n\t\tcase EShapePointsMarkerType.NONE:\n\t\t\treturn new BuilderNull(vertexOffset, indexOffset);\n\t\tcase EShapePointsMarkerType.CIRCLE:\n\t\t\treturn new BuilderMarkerCircleTail(vertexOffset, indexOffset);\n\t\tcase EShapePointsMarkerType.TRIANGLE:\n\t\t\treturn new BuilderMarkerTriangleTail(vertexOffset, indexOffset);\n\t\tcase EShapePointsMarkerType.RECTANGLE:\n\t\t\treturn new BuilderMarkerRectangleTail(vertexOffset, indexOffset);\n\t}\n\treturn new BuilderNull(vertexOffset, indexOffset);\n};\n\nexport const createLineUploaded = (\n\tbuffer: EShapeBuffer,\n\tshape: EShape,\n\tvoffset: number,\n\tioffset: number,\n\tantialiasWeight: number\n): EShapeUploadedImpl | null => {\n\t// Line\n\tconst points = shape.points;\n\tconst pointCount = toLinePointCount(points);\n\tconst lvcount = toLineVertexCount(pointCount, true);\n\tconst licount = toLineIndexCount(pointCount, true);\n\n\t// Markers\n\tlet mttype: EShapePointsMarkerType = EShapePointsMarkerType.NONE;\n\tlet mhtype: EShapePointsMarkerType = EShapePointsMarkerType.NONE;\n\tif (points && points instanceof EShapeLinePoints) {\n\t\tconst marker = points.getMarker();\n\t\tif (marker) {\n\t\t\tmttype = marker.tail.type;\n\t\t\tmhtype = marker.head.type;\n\t\t}\n\t}\n\tconst mtvcount = toMarkerVertexCount(mttype);\n\tconst mticount = toMarkerIndexCount(mttype);\n\tconst mtvoffset = voffset + lvcount;\n\tconst mtioffset = ioffset + licount;\n\tconst mhvcount = toMarkerVertexCount(mhtype);\n\tconst mhicount = toMarkerIndexCount(mhtype);\n\tconst mhvoffset = mtvoffset + mtvcount;\n\tconst mhioffset = mtioffset + mticount;\n\n\t// Text\n\tconst tcount = toTextBufferCount(shape);\n\tconst tvcount = tcount * TEXT_VERTEX_COUNT;\n\tconst ticount = tcount * TEXT_INDEX_COUNT;\n\tconst tvoffset = mhvoffset + mhvcount;\n\tconst tioffset = mhioffset + mhicount;\n\n\t// Uploaded\n\tconst vcount = lvcount + mhvcount + mtvcount + tvcount;\n\tconst icount = licount + mhicount + mticount + ticount;\n\tif (buffer.check(voffset, ioffset, vcount, icount)) {\n\t\treturn new EShapeUploadedImpl(buffer, voffset, ioffset, vcount, icount, [\n\t\t\tnew BuilderLine(voffset, ioffset, lvcount, licount),\n\t\t\ttoBuilderMarkerTail(mttype, mtvoffset, mtioffset),\n\t\t\ttoBuilderMarkerHead(mhtype, mhvoffset, mhioffset),\n\t\t\tnew BuilderText(tvoffset, tioffset, tvcount, ticount)\n\t\t]).init(shape);\n\t}\n\treturn null;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport class EShapeConnectorBodies {\n\tstatic from(values: number[], tailMargin: number, headMargin: number): number[] {\n\t\tconst result: number[] = [];\n\t\tconst length = values.length;\n\t\tif (4 < length) {\n\t\t\tconst threshold = 0.000001;\n\n\t\t\tlet x0 = values[0];\n\t\t\tlet y0 = values[1];\n\t\t\tif (tailMargin !== 0) {\n\t\t\t\tconst ex = x0 - values[2];\n\t\t\t\tconst ey = y0 - values[3];\n\t\t\t\tconst n = ex * ex + ey * ey;\n\t\t\t\tif (threshold < n) {\n\t\t\t\t\tconst f = tailMargin / Math.sqrt(n);\n\t\t\t\t\tx0 += ex * f;\n\t\t\t\t\ty0 += ey * f;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet x1 = values[length - 2];\n\t\t\tlet y1 = values[length - 1];\n\t\t\tif (headMargin !== 0) {\n\t\t\t\tconst ex = x1 - values[length - 4];\n\t\t\t\tconst ey = y1 - values[length - 3];\n\t\t\t\tconst n = ex * ex + ey * ey;\n\t\t\t\tif (threshold < n) {\n\t\t\t\t\tconst f = headMargin / Math.sqrt(n);\n\t\t\t\t\tx1 += ex * f;\n\t\t\t\t\ty1 += ey * f;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst cx = (x1 + x0) * 0.5;\n\t\t\tconst cy = (y1 + y0) * 0.5;\n\t\t\tconst dx = x1 - x0;\n\t\t\tconst dy = y1 - y0;\n\t\t\tconst a = Math.atan2(dy, dx);\n\t\t\tconst c = Math.cos(a);\n\t\t\tconst s = Math.sin(a);\n\t\t\tconst l = dx * dx + dy * dy;\n\t\t\tconst m = threshold < l ? 1 / Math.sqrt(l) : 1;\n\t\t\tfor (let i = 2, imax = length - 2; i < imax; i += 2) {\n\t\t\t\tconst x = values[i + 0] - cx;\n\t\t\t\tconst y = values[i + 1] - cy;\n\t\t\t\tresult.push((c * x + s * y) * m, (c * y - s * x) * m);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeAcceptor, EShapeAcceptorEdge } from \"./e-shape-acceptor\";\nimport { EShapeAcceptorType } from \"./e-shape-acceptor-type\";\n\nexport class EShapeAcceptorImpl implements EShapeAcceptor {\n\tprotected _edges: Map<string, EShapeAcceptorEdge>;\n\n\tconstructor() {\n\t\tthis._edges = new Map<string, EShapeAcceptorEdge>();\n\t}\n\n\tadd(id: string, type: EShapeAcceptorType, x: number, y: number): boolean {\n\t\tthis._edges.set(id, {\n\t\t\ttype,\n\t\t\tx,\n\t\t\ty\n\t\t});\n\t\treturn true;\n\t}\n\n\tremove(id: string): EShapeAcceptorEdge | null {\n\t\tconst edges = this._edges;\n\t\tconst result = edges.get(id);\n\t\tif (result != null) {\n\t\t\tedges.delete(id);\n\t\t\treturn result;\n\t\t}\n\t\treturn null;\n\t}\n\n\tsize(): number {\n\t\treturn this._edges.size;\n\t}\n\n\tget(id: string): EShapeAcceptorEdge | null {\n\t\treturn this._edges.get(id) || null;\n\t}\n\n\teach(iteratee: (edge: EShapeAcceptorEdge, id: string) => void): this {\n\t\tthis._edges.forEach(iteratee);\n\t\treturn this;\n\t}\n\n\tcontains(id: string): boolean {\n\t\treturn this._edges.has(id);\n\t}\n\n\tclear(): boolean {\n\t\tconst edges = this._edges;\n\t\tif (0 < edges.size) {\n\t\t\tedges.clear();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const EShapeAcceptorType = {\n\tTAIL: 1,\n\tHEAD: 2,\n\tALL: 3\n} as const;\n\nexport type EShapeAcceptorType = typeof EShapeAcceptorType[keyof typeof EShapeAcceptorType];\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeAcceptor } from \"./e-shape-acceptor\";\nimport { EShapeAcceptorImpl } from \"./e-shape-acceptor-impl\";\nimport { EShapeAcceptorType } from \"./e-shape-acceptor-type\";\nimport { EShapeType } from \"./e-shape-type\";\n\nexport class EShapeAcceptors {\n\tprotected static _default?: EShapeAcceptor;\n\tprotected static _typeToAcceptor?: Map<EShapeType, EShapeAcceptor>;\n\n\tstatic set(type: EShapeType, acceptor: EShapeAcceptor): void {\n\t\tlet typeToAcceptor = this._typeToAcceptor;\n\t\tif (typeToAcceptor == null) {\n\t\t\ttypeToAcceptor = new Map<EShapeType, EShapeAcceptor>();\n\t\t\tthis._typeToAcceptor = typeToAcceptor;\n\t\t}\n\t\ttypeToAcceptor.set(type, acceptor);\n\t}\n\n\tstatic get(type: EShapeType): EShapeAcceptor {\n\t\treturn this._typeToAcceptor?.get(type) || this.getDefault();\n\t}\n\n\tprotected static getDefault(): EShapeAcceptor {\n\t\tlet result = this._default;\n\t\tif (result == null) {\n\t\t\tresult = this.newDefault();\n\t\t\tthis._default = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected static newDefault(): EShapeAcceptor {\n\t\tconst result = new EShapeAcceptorImpl();\n\t\tresult.add(\"TOP\", EShapeAcceptorType.ALL, 0, -0.5);\n\t\tresult.add(\"LEFT\", EShapeAcceptorType.ALL, -0.5, 0);\n\t\tresult.add(\"RIGHT\", EShapeAcceptorType.ALL, 0.5, 0);\n\t\tresult.add(\"BOTTOM\", EShapeAcceptorType.ALL, 0, 0.5);\n\t\tresult.add(\"CENTER\", EShapeAcceptorType.ALL, 0, 0);\n\t\tresult.add(\"TOP_LEFT\", EShapeAcceptorType.ALL, -0.5, -0.5);\n\t\tresult.add(\"TOP_RIGHT\", EShapeAcceptorType.ALL, 0.5, -0.5);\n\t\tresult.add(\"BOTTOM_LEFT\", EShapeAcceptorType.ALL, -0.5, 0.5);\n\t\tresult.add(\"BOTTOM_RIGHT\", EShapeAcceptorType.ALL, 0.5, 0.5);\n\t\treturn result;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"./e-shape\";\nimport { EShapeConnectorEdgeAcceptor } from \"./e-shape-connector-edge-acceptor\";\n\nexport interface EShapeConnectorEdgeAcceptorImplParent {\n\tonAcceptorChange(): void;\n}\n\nexport class EShapeConnectorEdgeAcceptorImpl implements EShapeConnectorEdgeAcceptor {\n\tprotected _parent: EShapeConnectorEdgeAcceptorImplParent;\n\tprotected _shape: EShape | null;\n\tprotected _edge: string | null;\n\n\tconstructor(parent: EShapeConnectorEdgeAcceptorImplParent) {\n\t\tthis._parent = parent;\n\t\tthis._shape = null;\n\t\tthis._edge = null;\n\t}\n\n\tget shape(): EShape | null {\n\t\treturn this._shape;\n\t}\n\n\tset shape(shape: EShape | null) {\n\t\tthis.set(shape);\n\t}\n\n\tget edge(): string | null {\n\t\treturn this._edge;\n\t}\n\n\tset edge(edge: string | null) {\n\t\tthis.set(undefined, edge);\n\t}\n\n\tcopy(source: EShapeConnectorEdgeAcceptor): this {\n\t\treturn this.set(source.shape, source.edge);\n\t}\n\n\tset(shape?: EShape | null, edge?: string | null): this {\n\t\tlet isChanged = false;\n\n\t\tif (shape !== undefined && this._shape !== shape) {\n\t\t\tthis._shape = shape;\n\t\t\tisChanged = true;\n\t\t}\n\n\t\tif (edge !== undefined && this._edge !== edge) {\n\t\t\tthis._edge = edge;\n\t\t\tisChanged = true;\n\t\t}\n\n\t\tif (isChanged) {\n\t\t\tthis._parent.onAcceptorChange();\n\t\t}\n\n\t\treturn this;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { IPoint, ObservablePoint, Point } from \"pixi.js\";\nimport { EShape } from \"./e-shape\";\nimport { EShapeAcceptors } from \"./e-shape-acceptors\";\nimport { EShapeConnector } from \"./e-shape-connector\";\nimport { EShapeConnectorEdge, EShapeConnectorEdgeSerialized } from \"./e-shape-connector-edge\";\nimport { EShapeConnectorEdgeAcceptor } from \"./e-shape-connector-edge-acceptor\";\nimport { EShapeConnectorEdgeAcceptorImpl } from \"./e-shape-connector-edge-acceptor-impl\";\nimport { EShapeResourceManagerDeserialization } from \"./e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"./e-shape-resource-manager-serialization\";\nimport { EShapeUuidMapping } from \"./e-shape-uuid-mapping\";\n\nexport class EShapeConnectorEdgeImpl implements EShapeConnectorEdge {\n\tprotected static WORK_UPDATE_LOCAL?: Point;\n\n\tprotected _parent: EShapeConnector;\n\tprotected _onChange: () => void;\n\tprotected _acceptor: EShapeConnectorEdgeAcceptor;\n\tprotected _localIdRequired: number;\n\tprotected _localId: number;\n\tprotected _local: IPoint;\n\tprotected _margin: number;\n\tprotected _lockCount: number;\n\tprotected _isAcceptorChanged: boolean;\n\tprotected _isLocalChanged: boolean;\n\tprotected _isOtherChanged: boolean;\n\n\tconstructor(parent: EShapeConnector, onChange: () => void) {\n\t\tthis._parent = parent;\n\t\tthis._onChange = onChange;\n\t\tthis._acceptor = new EShapeConnectorEdgeAcceptorImpl(this);\n\t\tthis._local = new ObservablePoint((): void => {\n\t\t\tthis.onLocalChange();\n\t\t}, undefined);\n\t\tthis._localIdRequired = 0;\n\t\tthis._localId = 0;\n\t\tthis._margin = 0;\n\t\tthis._lockCount = 0;\n\t\tthis._isAcceptorChanged = false;\n\t\tthis._isLocalChanged = false;\n\t\tthis._isOtherChanged = false;\n\t}\n\n\tlock(): void {\n\t\tthis._lockCount += 1;\n\t\tif (this._lockCount === 1) {\n\t\t\tthis._isAcceptorChanged = false;\n\t\t\tthis._isLocalChanged = false;\n\t\t\tthis._isOtherChanged = false;\n\t\t}\n\t}\n\n\tunlock(): void {\n\t\tthis._lockCount -= 1;\n\t\tif (this._lockCount === 0) {\n\t\t\tif (this._isLocalChanged) {\n\t\t\t\tthis.onLocalChange();\n\t\t\t} else if (this._isAcceptorChanged) {\n\t\t\t\tthis.onAcceptorChange();\n\t\t\t} else if (this._isOtherChanged) {\n\t\t\t\tthis.onOtherChange();\n\t\t\t}\n\t\t}\n\t}\n\n\tget acceptor(): EShapeConnectorEdgeAcceptor {\n\t\treturn this._acceptor;\n\t}\n\n\tget local(): IPoint {\n\t\treturn this._local;\n\t}\n\n\tget localId(): number {\n\t\treturn this._localId;\n\t}\n\n\tget margin(): number {\n\t\treturn this._margin;\n\t}\n\n\tset margin(margin: number) {\n\t\tif (this._margin !== margin) {\n\t\t\tthis._margin = margin;\n\t\t\tthis.onOtherChange();\n\t\t}\n\t}\n\n\tset(\n\t\tshape?: EShape | null,\n\t\tedge?: string | null,\n\t\tmargin?: number,\n\t\tlocalX?: number,\n\t\tlocalY?: number\n\t): this {\n\t\tthis.lock();\n\t\tthis._acceptor.set(shape, edge);\n\t\tif (localX != null) {\n\t\t\tthis._local.x = localX;\n\t\t}\n\t\tif (localY != null) {\n\t\t\tthis._local.y = localY;\n\t\t}\n\t\tif (margin != null) {\n\t\t\tthis.margin = margin;\n\t\t}\n\t\tthis.unlock();\n\t\treturn this;\n\t}\n\n\tcopy(source: EShapeConnectorEdge): this {\n\t\tthis.lock();\n\t\tthis._acceptor.copy(source.acceptor);\n\t\tthis._local.copyFrom(source.local);\n\t\tthis.margin = source.margin;\n\t\tthis.unlock();\n\t\treturn this;\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\tconst acceptor = this._acceptor;\n\t\tconst shape = acceptor.shape;\n\t\tconst shapeUuid = shape ? shape.uuid : null;\n\t\tconst edge = acceptor.edge;\n\t\tconst edgeId = edge != null ? manager.addResource(edge) : -1;\n\t\tconst local = this._local;\n\t\treturn manager.addResource(\n\t\t\t`[${shapeUuid},${edgeId},${local.x},${local.y},${this._margin}]`\n\t\t);\n\t}\n\n\tdeserialize(\n\t\tresourceId: number,\n\t\tmapping: EShapeUuidMapping,\n\t\tmanager: EShapeResourceManagerDeserialization\n\t): void {\n\t\tconst resources = manager.resources;\n\t\tif (0 <= resourceId && resourceId < resources.length) {\n\t\t\tlet parsed = manager.getExtension<EShapeConnectorEdgeSerialized>(resourceId);\n\t\t\tif (parsed == null) {\n\t\t\t\tparsed = JSON.parse(resources[resourceId]) as EShapeConnectorEdgeSerialized;\n\t\t\t\tmanager.setExtension(resourceId, parsed);\n\t\t\t}\n\t\t\tlet shape: EShape | null = null;\n\t\t\tconst shapeUuid = parsed[0];\n\t\t\tif (shapeUuid != null) {\n\t\t\t\tshape = mapping.find(shapeUuid) || null;\n\t\t\t}\n\t\t\tthis.lock();\n\t\t\tconst acceptor = this._acceptor;\n\t\t\tacceptor.shape = shape;\n\t\t\tconst edgeId = parsed[1];\n\t\t\tacceptor.edge = 0 <= edgeId && edgeId < resources.length ? resources[edgeId] : null;\n\t\t\tthis._local.set(parsed[2], parsed[3]);\n\t\t\tthis.margin = parsed[4] || 0;\n\t\t\tthis.unlock();\n\t\t\tif (shape) {\n\t\t\t\tshape.connector.add(this);\n\t\t\t}\n\t\t}\n\t}\n\n\tfit(forcibly?: boolean): this {\n\t\tif (forcibly) {\n\t\t\tthis._localIdRequired += 1;\n\t\t}\n\t\tconst localIdRequired = this._localIdRequired;\n\t\tif (this._localId !== localIdRequired) {\n\t\t\tthis._localId = localIdRequired;\n\n\t\t\tconst acceptor = this._acceptor;\n\t\t\tconst acceptorShape = acceptor.shape;\n\t\t\tconst acceptorEdge = acceptor.edge;\n\t\t\tif (acceptorShape != null && acceptorEdge != null) {\n\t\t\t\tconst edge = EShapeAcceptors.get(acceptorShape.type).get(acceptorEdge);\n\t\t\t\tif (edge) {\n\t\t\t\t\tconst work = (EShapeConnectorEdgeImpl.WORK_UPDATE_LOCAL ??= new Point());\n\t\t\t\t\tconst size = acceptorShape.size;\n\t\t\t\t\twork.set(size.x * edge.x, size.y * edge.y);\n\t\t\t\t\tacceptorShape.toGlobal(work, work);\n\t\t\t\t\tconst parent = this._parent;\n\t\t\t\t\tconst parentParent = parent.parent;\n\t\t\t\t\tif (parentParent) {\n\t\t\t\t\t\tparent.updateTransform();\n\t\t\t\t\t\tparentParent.toLocal(work, undefined, work, true);\n\t\t\t\t\t}\n\t\t\t\t\tthis._local.copyFrom(work);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n\n\tonAcceptorChange(): void {\n\t\tif (0 < this._lockCount) {\n\t\t\tthis._isAcceptorChanged = true;\n\t\t\treturn;\n\t\t}\n\t\tthis._localIdRequired += 1;\n\t\tthis.fit();\n\t}\n\n\tprotected onLocalChange(): void {\n\t\tif (0 < this._lockCount) {\n\t\t\tthis._isLocalChanged = true;\n\t\t\treturn;\n\t\t}\n\t\tthis._localIdRequired += 1;\n\t\tthis._localId = this._localIdRequired;\n\t\tthis._onChange();\n\t}\n\n\tprotected onOtherChange(): void {\n\t\tif (0 < this._lockCount) {\n\t\t\tthis._isOtherChanged = true;\n\t\t\treturn;\n\t\t}\n\t\tthis._onChange();\n\t}\n\n\tattach(): this {\n\t\tconst shape = this._acceptor.shape;\n\t\tif (shape) {\n\t\t\tshape.connector.add(this);\n\t\t}\n\t\treturn this;\n\t}\n\n\tdetach(): this {\n\t\tconst shape = this._acceptor.shape;\n\t\tif (shape) {\n\t\t\tshape.connector.remove(this);\n\t\t}\n\t\treturn this;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeConnector } from \"./e-shape-connector\";\nimport { EShapeConnectorEdge } from \"./e-shape-connector-edge\";\nimport {\n\tEShapeConnectorEdgeContainer,\n\tEShapeConnectorEdgeContainerSerialized\n} from \"./e-shape-connector-edge-container\";\nimport { EShapeConnectorEdgeImpl } from \"./e-shape-connector-edge-impl\";\nimport { EShapeResourceManagerDeserialization } from \"./e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"./e-shape-resource-manager-serialization\";\nimport { EShapeUuidMapping } from \"./e-shape-uuid-mapping\";\n\nexport class EShapeConnectorEdgeContainerImpl implements EShapeConnectorEdgeContainer {\n\tprotected _parent: EShapeConnector;\n\tprotected _lockCount: number;\n\tprotected _isChanged: boolean;\n\tprotected _onChange: () => void;\n\tprotected _tail: EShapeConnectorEdge;\n\tprotected _head: EShapeConnectorEdge;\n\n\tconstructor(parent: EShapeConnector, onChange: () => void) {\n\t\tthis._parent = parent;\n\t\tthis._lockCount = 0;\n\t\tthis._isChanged = false;\n\t\tthis._onChange = onChange;\n\t\tconst onChangeBound = (): void => {\n\t\t\tthis.onChange();\n\t\t};\n\t\tthis._tail = new EShapeConnectorEdgeImpl(parent, onChangeBound);\n\t\tthis._head = new EShapeConnectorEdgeImpl(parent, onChangeBound);\n\t}\n\n\tlock(): this {\n\t\tthis._lockCount += 1;\n\t\tif (this._lockCount === 1) {\n\t\t\tthis._isChanged = false;\n\t\t}\n\t\treturn this;\n\t}\n\n\tunlock(): this {\n\t\tthis._lockCount -= 1;\n\t\tif (this._lockCount === 0) {\n\t\t\tif (this._isChanged) {\n\t\t\t\tthis._onChange();\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n\n\tprotected onChange(): void {\n\t\tif (0 < this._lockCount) {\n\t\t\tthis._isChanged = true;\n\t\t\treturn;\n\t\t}\n\t\tthis._onChange();\n\t}\n\n\tget tail(): EShapeConnectorEdge {\n\t\treturn this._tail;\n\t}\n\n\tget head(): EShapeConnectorEdge {\n\t\treturn this._head;\n\t}\n\n\tcopy(source: EShapeConnectorEdgeContainer): this {\n\t\tthis.lock();\n\t\tthis._tail.copy(source.tail);\n\t\tthis._head.copy(source.head);\n\t\tthis.unlock();\n\t\treturn this;\n\t}\n\n\tfit(forcibly?: boolean): this {\n\t\tthis.lock();\n\t\tthis._tail.fit(forcibly);\n\t\tthis._head.fit(forcibly);\n\t\tthis.unlock();\n\t\treturn this;\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\tconst tailId = this._tail.serialize(manager);\n\t\tconst headId = this._head.serialize(manager);\n\t\treturn manager.addResource(`[${tailId},${headId}]`);\n\t}\n\n\tdeserialize(\n\t\tresourceId: number,\n\t\tmapping: EShapeUuidMapping,\n\t\tmanager: EShapeResourceManagerDeserialization\n\t): void {\n\t\tconst resources = manager.resources;\n\t\tif (0 <= resourceId && resourceId < resources.length) {\n\t\t\tlet parsed = manager.getExtension<EShapeConnectorEdgeContainerSerialized>(resourceId);\n\t\t\tif (parsed == null) {\n\t\t\t\tparsed = JSON.parse(\n\t\t\t\t\tresources[resourceId]\n\t\t\t\t) as EShapeConnectorEdgeContainerSerialized;\n\t\t\t\tmanager.setExtension(resourceId, parsed);\n\t\t\t}\n\t\t\tthis.lock();\n\t\t\tthis._tail.deserialize(parsed[0], mapping, manager);\n\t\t\tthis._head.deserialize(parsed[1], mapping, manager);\n\t\t\tthis.unlock();\n\t\t}\n\t}\n\n\tattach(): this {\n\t\tthis.lock();\n\t\tconst tail = this._tail;\n\t\tconst head = this._head;\n\t\ttail.attach();\n\t\thead.attach();\n\t\ttail.fit(true);\n\t\thead.fit(true);\n\t\tthis.unlock();\n\t\treturn this;\n\t}\n\n\tdetach(): this {\n\t\tthis.lock();\n\t\tthis._tail.detach();\n\t\tthis._head.detach();\n\t\tthis.unlock();\n\t\treturn this;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeConnector } from \"./e-shape-connector\";\nimport { EShapeConnectorBody, EShapeConnectorBodySerialized } from \"./e-shape-connector-body\";\nimport { EShapeResourceManagerDeserialization } from \"./e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"./e-shape-resource-manager-serialization\";\nimport { EShapeUuidMapping } from \"./e-shape-uuid-mapping\";\n\nexport class EShapeConnectorBodyImpl implements EShapeConnectorBody {\n\tprotected _parent: EShapeConnector;\n\tprotected _id: number;\n\tprotected _values: number[];\n\tprotected _lockCount: number;\n\tprotected _isChanged: boolean;\n\tprotected _onChange: () => void;\n\n\tconstructor(parent: EShapeConnector, onChange: () => void) {\n\t\tthis._parent = parent;\n\t\tthis._id = 0;\n\t\tthis._values = [];\n\t\tthis._lockCount = 0;\n\t\tthis._isChanged = false;\n\t\tthis._onChange = onChange;\n\t}\n\n\tlock(): void {\n\t\tthis._lockCount += 1;\n\t\tif (this._lockCount === 1) {\n\t\t\tthis._isChanged = false;\n\t\t}\n\t}\n\n\tunlock(): void {\n\t\tthis._lockCount -= 1;\n\t\tif (this._lockCount === 0) {\n\t\t\tif (this._isChanged) {\n\t\t\t\tthis.onChange();\n\t\t\t}\n\t\t\tthis._isChanged = false;\n\t\t}\n\t}\n\n\tget id(): number {\n\t\treturn this._id;\n\t}\n\n\tget values(): number[] {\n\t\treturn this._values;\n\t}\n\n\tset values(newValues: number[]) {\n\t\tthis.set(newValues);\n\t}\n\n\tset(newValues?: number[]): this {\n\t\tif (newValues != null) {\n\t\t\tthis._id += 1;\n\t\t\tif (this._values !== newValues) {\n\t\t\t\tconst length = newValues.length;\n\t\t\t\tconst values = this._values;\n\t\t\t\tfor (let i = 0; i < length; ++i) {\n\t\t\t\t\tvalues[i] = newValues[i];\n\t\t\t\t}\n\t\t\t\tvalues.length = length;\n\t\t\t}\n\t\t\tthis.onChange();\n\t\t}\n\t\treturn this;\n\t}\n\n\tcopy(source: EShapeConnectorBody): this {\n\t\treturn this.set(source.values);\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\treturn manager.addResource(JSON.stringify(this._values));\n\t}\n\n\tdeserialize(\n\t\tresourceId: number,\n\t\tmapping: EShapeUuidMapping,\n\t\tmanager: EShapeResourceManagerDeserialization\n\t): void {\n\t\tconst resources = manager.resources;\n\t\tif (0 <= resourceId && resourceId < resources.length) {\n\t\t\tlet parsed = manager.getExtension<EShapeConnectorBodySerialized>(resourceId);\n\t\t\tif (parsed == null) {\n\t\t\t\tparsed = JSON.parse(resources[resourceId]) as EShapeConnectorBodySerialized;\n\t\t\t\tmanager.setExtension(resourceId, parsed);\n\t\t\t}\n\t\t\tthis.set(parsed);\n\t\t}\n\t}\n\n\tprotected onChange(): void {\n\t\tif (0 < this._lockCount) {\n\t\t\tthis._isChanged = true;\n\t\t\treturn;\n\t\t}\n\t\tthis._onChange();\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapeConnector } from \"../e-shape-connector\";\nimport { EShapeConnectorEdgeContainer } from \"../e-shape-connector-edge-container\";\nimport { EShapeConnectorEdgeContainerImpl } from \"../e-shape-connector-edge-container-impl\";\nimport { EShapeLineBase } from \"./e-shape-line-base\";\nimport { EShapeLinePoints } from \"./e-shape-line-points\";\nimport { EShapeDefaults } from \"../e-shape-defaults\";\nimport { EShapeCopyPart } from \"../e-shape-copy-part\";\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShape } from \"../e-shape\";\nimport { toPointsBoundary } from \"../e-shape-points-formatted\";\nimport { EShapeConnectorBody } from \"../e-shape-connector-body\";\nimport { EShapeConnectorBodyImpl } from \"../e-shape-connector-body-impl\";\n\nexport class EShapeConnectorLine extends EShapeLineBase implements EShapeConnector {\n\tprotected static WORK_BOUNDARY: [number, number, number, number];\n\tprotected _edge: EShapeConnectorEdgeContainer;\n\tprotected _body: EShapeConnectorBody;\n\tprotected declare _points: EShapeLinePoints;\n\tprotected _tailLocalId: number;\n\tprotected _tailMargin: number;\n\tprotected _headLocalId: number;\n\tprotected _headMargin: number;\n\tprotected _bodyId: number;\n\tprotected _lockCount: number;\n\tprotected _isChanged: boolean;\n\n\tconstructor(type: EShapeType = EShapeType.CONNECTOR_LINE) {\n\t\tsuper(type);\n\t\tthis._tailLocalId = 0;\n\t\tthis._tailMargin = 0;\n\t\tthis._headLocalId = 0;\n\t\tthis._headMargin = 0;\n\t\tthis._bodyId = 0;\n\t\tthis._lockCount = 0;\n\t\tthis._isChanged = false;\n\t\tconst sx = EShapeDefaults.SIZE_X;\n\t\tconst sy = EShapeDefaults.SIZE_Y;\n\t\tconst hx = sx * 0.5;\n\t\tconst hy = sy * 0.5;\n\t\tthis._points = new EShapeLinePoints(this).set([-hx, -hy, +hx, +hy]);\n\t\tconst onChangeBound = (): void => {\n\t\t\tthis.onChange();\n\t\t};\n\t\tthis._edge = new EShapeConnectorEdgeContainerImpl(this, onChangeBound);\n\t\tthis._body = new EShapeConnectorBodyImpl(this, onChangeBound);\n\t}\n\n\tlock(): void {\n\t\tthis._lockCount += 1;\n\t\tif (this._lockCount === 1) {\n\t\t\tthis._isChanged = false;\n\t\t}\n\t}\n\n\tunlock(): void {\n\t\tthis._lockCount -= 1;\n\t\tif (this._lockCount === 0) {\n\t\t\tif (this._isChanged) {\n\t\t\t\tthis.onChange();\n\t\t\t}\n\t\t\tthis._isChanged = false;\n\t\t}\n\t}\n\n\tget points(): EShapeLinePoints {\n\t\treturn this._points;\n\t}\n\n\tget edge(): EShapeConnectorEdgeContainer {\n\t\treturn this._edge;\n\t}\n\n\tget body(): EShapeConnectorBody {\n\t\treturn this._body;\n\t}\n\n\tonAttach(): void {\n\t\tsuper.onAttach();\n\t\tthis._edge.attach();\n\t}\n\n\tonDetach(): void {\n\t\tthis._edge.detach();\n\t\tsuper.onDetach();\n\t}\n\n\tprotected onChange(): void {\n\t\tif (0 < this._lockCount) {\n\t\t\tthis._isChanged = true;\n\t\t\treturn;\n\t\t}\n\n\t\tconst edge = this._edge;\n\t\tconst tail = edge.tail;\n\t\tconst tailLocalId = tail.localId;\n\t\tconst tailMargin = tail.margin;\n\t\tconst head = edge.head;\n\t\tconst headLocalId = head.localId;\n\t\tconst headMargin = head.margin;\n\t\tconst body = this._body;\n\t\tconst bodyId = body.id;\n\t\tif (\n\t\t\tthis._tailLocalId !== tailLocalId ||\n\t\t\tthis._tailMargin !== tailMargin ||\n\t\t\tthis._headLocalId !== headLocalId ||\n\t\t\tthis._headMargin !== headMargin ||\n\t\t\tthis._bodyId !== bodyId\n\t\t) {\n\t\t\tthis._tailLocalId = tailLocalId;\n\t\t\tthis._tailMargin = tailMargin;\n\t\t\tthis._headLocalId = headLocalId;\n\t\t\tthis._headMargin = headMargin;\n\t\t\tthis._bodyId !== bodyId;\n\n\t\t\t// Tail\n\t\t\tconst tailLocal = tail.local;\n\t\t\tconst tailLocalX = tailLocal.x;\n\t\t\tconst tailLocalY = tailLocal.y;\n\n\t\t\t// Head\n\t\t\tconst headLocal = head.local;\n\t\t\tconst headLocalX = headLocal.x;\n\t\t\tconst headLocalY = headLocal.y;\n\n\t\t\t// Body\n\t\t\tconst bodyValues = body.values;\n\t\t\tconst bodyValuesLength = bodyValues.length;\n\n\t\t\t// Values\n\t\t\tconst transform = this.transform;\n\t\t\tconst transformPosition = transform.position;\n\t\t\tconst px = transformPosition.x;\n\t\t\tconst py = transformPosition.y;\n\t\t\tconst points = this._points;\n\t\t\tconst values = points.values;\n\t\t\tif (values.length < 4) {\n\t\t\t\tvalues[0] = 0;\n\t\t\t\tvalues[1] = 0;\n\t\t\t}\n\n\t\t\tconst threshold = 0.000001;\n\t\t\tconst x0 = tailLocalX - px;\n\t\t\tconst y0 = tailLocalY - py;\n\t\t\tconst x1 = headLocalX - px;\n\t\t\tconst y1 = headLocalY - py;\n\n\t\t\t// Body\n\t\t\tif (0 < bodyValuesLength) {\n\t\t\t\tconst cx = (x1 + x0) * 0.5;\n\t\t\t\tconst cy = (y1 + y0) * 0.5;\n\t\t\t\tconst dx = x1 - x0;\n\t\t\t\tconst dy = y1 - y0;\n\t\t\t\tconst a = Math.atan2(dy, dx);\n\t\t\t\tconst c = Math.cos(a);\n\t\t\t\tconst s = Math.sin(a);\n\t\t\t\tconst l = Math.sqrt(dx * dx + dy * dy);\n\t\t\t\tfor (let i = 0; i < bodyValuesLength; i += 2) {\n\t\t\t\t\tconst x = bodyValues[i + 0];\n\t\t\t\t\tconst y = bodyValues[i + 1];\n\t\t\t\t\tvalues[i + 2] = cx + (c * x - s * y) * l;\n\t\t\t\t\tvalues[i + 3] = cy + (c * y + s * x) * l;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Tail\n\t\t\tvalues[0] = x0;\n\t\t\tvalues[1] = y0;\n\t\t\tif (tailMargin !== 0) {\n\t\t\t\tconst dx = values[2] - x0;\n\t\t\t\tconst dy = values[3] - y0;\n\t\t\t\tconst d = dx * dx + dy * dy;\n\t\t\t\tif (threshold < d) {\n\t\t\t\t\tconst f = tailMargin / Math.sqrt(dx * dx + dy * dy);\n\t\t\t\t\tvalues[0] = x0 + dx * f;\n\t\t\t\t\tvalues[1] = y0 + dy * f;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Head\n\t\t\tvalues[2 + bodyValuesLength] = x1;\n\t\t\tvalues[3 + bodyValuesLength] = y1;\n\t\t\tif (headMargin !== 0) {\n\t\t\t\tconst dx = values[0 + bodyValuesLength] - x1;\n\t\t\t\tconst dy = values[1 + bodyValuesLength] - y1;\n\t\t\t\tconst d = dx * dx + dy * dy;\n\t\t\t\tif (threshold < d) {\n\t\t\t\t\tconst f = headMargin / Math.sqrt(dx * dx + dy * dy);\n\t\t\t\t\tvalues[2 + bodyValuesLength] = x1 + dx * f;\n\t\t\t\t\tvalues[3 + bodyValuesLength] = y1 + dy * f;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Remove the rest\n\t\t\tvalues.length = bodyValuesLength + 4;\n\n\t\t\t// Center & size\n\t\t\tconst boundary = (EShapeConnectorLine.WORK_BOUNDARY ??= [0, 0, 0, 0]);\n\t\t\ttoPointsBoundary(values, boundary);\n\t\t\tconst cx = (boundary[2] + boundary[0]) * 0.5;\n\t\t\tconst cy = (boundary[3] + boundary[1]) * 0.5;\n\t\t\tconst sx = boundary[2] - boundary[0];\n\t\t\tconst sy = boundary[3] - boundary[1];\n\n\t\t\t// Adjust values\n\t\t\tfor (let i = 0, imax = values.length; i < imax; i += 2) {\n\t\t\t\tvalues[i + 0] -= cx;\n\t\t\t\tvalues[i + 1] -= cy;\n\t\t\t}\n\n\t\t\tthis.disallowUploadedUpdate();\n\t\t\ttransformPosition.set(px + cx, py + cy);\n\t\t\ttransform.scale.set(1, 1);\n\t\t\ttransform.rotation = 0;\n\t\t\ttransform.skew.set(0, 0);\n\t\t\tthis.size.set(sx, sy);\n\t\t\tpoints.toFitted();\n\t\t\tpoints.set(values);\n\t\t\tthis.allowUploadedUpdate();\n\t\t}\n\t}\n\n\tcopy(source: EShape, part: EShapeCopyPart = EShapeCopyPart.ALL): this {\n\t\tsuper.copy(source, part);\n\t\tif (source instanceof EShapeConnectorLine) {\n\t\t\tthis._edge.copy(source.edge);\n\t\t\tthis._body.copy(source.body);\n\t\t}\n\t\treturn this;\n\t}\n\n\tclone(): EShapeConnectorLine {\n\t\treturn new EShapeConnectorLine(this.type).copy(this);\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): DDiagramSerializedItem {\n\t\tconst result = super.serialize(manager);\n\t\tconst edgeId = this._edge.serialize(manager);\n\t\tconst bodyId = this._body.serialize(manager);\n\t\tconst pointsId = this._points.serialize(manager);\n\t\tresult[15] = manager.addResource(`[${edgeId},${pointsId},${bodyId}]`);\n\t\treturn result;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\nimport { EShape } from \"../e-shape\";\nimport { EShapeConnectorBodies } from \"../e-shape-connector-bodies\";\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeUuidMapping } from \"../e-shape-uuid-mapping\";\nimport { deserializeBase } from \"./deserialize-base\";\nimport { EShapeConnectorLine } from \"./e-shape-connector-line\";\n\nexport const deserializeConnectorLine = (\n\titem: DDiagramSerializedItem,\n\tmanager: EShapeResourceManagerDeserialization,\n\tshape?: EShapeConnectorLine\n): Promise<EShapeConnectorLine> | EShapeConnectorLine => {\n\treturn deserializeBase(item, manager, shape || new EShapeConnectorLine());\n};\n\nexport const onDeserializedConnectorLine = (\n\titem: DDiagramSerializedItem,\n\tshape: EShape,\n\tmapping: EShapeUuidMapping,\n\tmanager: EShapeResourceManagerDeserialization\n): void => {\n\tif (shape instanceof EShapeConnectorLine) {\n\t\tconst resources = manager.resources;\n\t\tconst resourceId = item[15];\n\t\tif (0 <= resourceId && resourceId < resources.length) {\n\t\t\tlet parsed = manager.getExtension<[number, number, number?]>(resourceId);\n\t\t\tif (parsed == null) {\n\t\t\t\tparsed = JSON.parse(resources[resourceId]) as [number, number, number?];\n\t\t\t\tmanager.setExtension(resourceId, parsed);\n\t\t\t}\n\n\t\t\t// Lock\n\t\t\tshape.lock();\n\n\t\t\t// Points\n\t\t\tconst points = shape.points;\n\t\t\tpoints.deserialize(parsed[1], manager);\n\n\t\t\t// Edge\n\t\t\tconst edge = shape.edge;\n\t\t\tedge.deserialize(parsed[0], mapping, manager);\n\n\t\t\t// Body\n\t\t\tconst body = shape.body;\n\t\t\tconst bodyId = parsed[2];\n\t\t\tif (bodyId != null) {\n\t\t\t\tbody.deserialize(bodyId, mapping, manager);\n\t\t\t} else {\n\t\t\t\t// The following is for backward compatibility.\n\t\t\t\tbody.set(\n\t\t\t\t\tEShapeConnectorBodies.from(points.values, edge.tail.margin, edge.head.margin)\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t// Unlock\n\t\t\tshape.unlock();\n\t\t}\n\t}\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeCapabilities } from \"../e-shape-capabilities\";\nimport { EShapeCapability } from \"../e-shape-capability\";\nimport { EShapeDeserializers, EShapeOnDeserializeds } from \"../e-shape-deserializers\";\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapeUploadeds } from \"../e-shape-uploadeds\";\nimport { createLineUploaded } from \"../variant/create-line-uploaded\";\nimport {\n\tdeserializeConnectorLine,\n\tonDeserializedConnectorLine\n} from \"../variant/deserialize-connector-line\";\n\nexport const loadShapeConnectorLine = (): void => {\n\tEShapeUploadeds[EShapeType.CONNECTOR_LINE] = createLineUploaded;\n\tEShapeDeserializers[EShapeType.CONNECTOR_LINE] = deserializeConnectorLine;\n\tEShapeOnDeserializeds[EShapeType.CONNECTOR_LINE] = onDeserializedConnectorLine;\n\tEShapeCapabilities.set(EShapeType.CONNECTOR_LINE, EShapeCapability.CONNECTOR);\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeBuffer } from \"../e-shape-buffer\";\nimport {\n\tbuildRectangleClipping,\n\tbuildRectangleIndex,\n\tbuildRectangleStep,\n\tbuildRectangleUv,\n\tbuildRectangleVertex,\n\tRECTANGLE_WORLD_SIZE\n} from \"./build-rectangle\";\nimport { BuilderBase } from \"./builder-base\";\nimport { toTexture, toTextureTransformId, toTextureUvs, toTransformLocalId } from \"./builders\";\n\nexport class BuilderRectanglePivoted extends BuilderBase {\n\tinit(buffer: EShapeBuffer): void {\n\t\tbuffer.updateIndices();\n\t\tbuildRectangleIndex(buffer.indices, this.vertexOffset, this.indexOffset);\n\t}\n\n\tupdate(buffer: EShapeBuffer, shape: EShape): void {\n\t\tthis.updateVertexClippingStepAndUv(buffer, shape);\n\t\tthis.updateColorFill(buffer, shape);\n\t\tthis.updateColorStroke(buffer, shape);\n\t}\n\n\tprotected updateVertexClippingStepAndUv(buffer: EShapeBuffer, shape: EShape): void {\n\t\tconst size = shape.size;\n\t\tconst sizeX = size.x;\n\t\tconst sizeY = size.y;\n\t\tconst isSizeChanged = sizeX !== this.sizeX || sizeY !== this.sizeY;\n\n\t\tconst transformLocalId = toTransformLocalId(shape);\n\t\tconst isTransformChanged = this.transformLocalId !== transformLocalId;\n\n\t\tconst stroke = shape.stroke;\n\t\tconst strokeAlign = stroke.align;\n\t\tconst strokeWidth = stroke.enable ? stroke.width : 0;\n\t\tconst strokeSide = stroke.side;\n\t\tconst strokeStyle = stroke.style;\n\t\tconst isStrokeChanged =\n\t\t\tthis.strokeAlign !== strokeAlign ||\n\t\t\tthis.strokeWidth !== strokeWidth ||\n\t\t\tthis.strokeSide !== strokeSide ||\n\t\t\tthis.strokeStyle !== strokeStyle;\n\n\t\tconst texture = toTexture(shape);\n\t\tconst textureTransformId = toTextureTransformId(texture);\n\t\tconst isTextureChanged =\n\t\t\ttexture !== this.texture || textureTransformId !== this.textureTransformId;\n\n\t\tconst isVertexChanged = isSizeChanged || isStrokeChanged;\n\n\t\tif (isVertexChanged || isTransformChanged || isTextureChanged) {\n\t\t\tthis.sizeX = sizeX;\n\t\t\tthis.sizeY = sizeY;\n\t\t\tthis.transformLocalId = transformLocalId;\n\t\t\tthis.strokeAlign = strokeAlign;\n\t\t\tthis.strokeWidth = strokeWidth;\n\t\t\tthis.strokeSide = strokeSide;\n\t\t\tthis.strokeStyle = strokeStyle;\n\t\t\tthis.texture = texture;\n\t\t\tthis.textureTransformId = textureTransformId;\n\n\t\t\t// Vertices\n\t\t\tconst voffset = this.vertexOffset;\n\t\t\tbuffer.updateVertices();\n\t\t\tbuildRectangleVertex(\n\t\t\t\tbuffer.vertices,\n\t\t\t\tvoffset,\n\t\t\t\t0.5 * sizeX,\n\t\t\t\t0.5 * sizeY,\n\t\t\t\tsizeX,\n\t\t\t\tsizeY,\n\t\t\t\tstrokeAlign,\n\t\t\t\tstrokeWidth,\n\t\t\t\tshape.transform.internalTransform,\n\t\t\t\tRECTANGLE_WORLD_SIZE\n\t\t\t);\n\n\t\t\t// Steps\n\t\t\tif (isVertexChanged || isTransformChanged) {\n\t\t\t\tbuffer.updateSteps();\n\t\t\t\tbuildRectangleStep(\n\t\t\t\t\tvoffset,\n\t\t\t\t\tbuffer.steps,\n\t\t\t\t\tstrokeWidth,\n\t\t\t\t\tstrokeSide,\n\t\t\t\t\tstrokeStyle,\n\t\t\t\t\tRECTANGLE_WORLD_SIZE\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t// Clippings\n\t\t\tif (isVertexChanged) {\n\t\t\t\tbuffer.updateClippings();\n\t\t\t\tbuildRectangleClipping(buffer.clippings, voffset, RECTANGLE_WORLD_SIZE);\n\t\t\t}\n\n\t\t\t// UVs\n\t\t\tif (isVertexChanged || isTextureChanged) {\n\t\t\t\tbuffer.updateUvs();\n\t\t\t\tbuildRectangleUv(buffer.uvs, voffset, toTextureUvs(texture), RECTANGLE_WORLD_SIZE);\n\t\t\t}\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeBuffer } from \"../e-shape-buffer\";\nimport { EShapeUploaded, EShapeUploadedImpl } from \"../e-shape-uploaded\";\nimport { RECTANGLE_INDEX_COUNT, RECTANGLE_VERTEX_COUNT } from \"./build-rectangle\";\nimport { TEXT_INDEX_COUNT, TEXT_VERTEX_COUNT, toTextBufferCount } from \"./build-text\";\nimport { BuilderRectanglePivoted } from \"./builder-rectangle-pivoted\";\nimport { BuilderText } from \"./builder-text\";\n\nexport const createRectanglePivotedUploaded = (\n\tbuffer: EShapeBuffer,\n\tshape: EShape,\n\tvoffset: number,\n\tioffset: number,\n\tantialiasWeight: number\n): EShapeUploaded | null => {\n\tconst tcount = toTextBufferCount(shape);\n\tconst tvcount = tcount * TEXT_VERTEX_COUNT;\n\tconst ticount = tcount * TEXT_INDEX_COUNT;\n\tconst vcount = RECTANGLE_VERTEX_COUNT + tvcount;\n\tconst icount = RECTANGLE_INDEX_COUNT + ticount;\n\tif (buffer.check(voffset, ioffset, vcount, icount)) {\n\t\treturn new EShapeUploadedImpl(buffer, voffset, ioffset, vcount, icount, [\n\t\t\tnew BuilderRectanglePivoted(voffset, ioffset, vcount - tvcount, icount - ticount),\n\t\t\tnew BuilderText(\n\t\t\t\tvoffset + RECTANGLE_VERTEX_COUNT,\n\t\t\t\tioffset + RECTANGLE_INDEX_COUNT,\n\t\t\t\ttvcount,\n\t\t\t\tticount\n\t\t\t)\n\t\t]).init(shape);\n\t}\n\treturn null;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeBuffer } from \"../e-shape-buffer\";\nimport { EShapeUploaded, EShapeUploadedImpl } from \"../e-shape-uploaded\";\nimport { BuilderNull } from \"./builder-null\";\n\nexport const createGroupUploaded = (\n\tbuffer: EShapeBuffer,\n\tshape: EShape,\n\tvoffset: number,\n\tioffset: number\n): EShapeUploaded | null => {\n\treturn new EShapeUploadedImpl(buffer, voffset, ioffset, 0, 0, [\n\t\tnew BuilderNull(voffset, ioffset)\n\t]).init(shape);\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShapeTextAlign, EShapeTextAlignLike } from \"../e-shape-text-align\";\nimport { EShapeTextAlignHorizontal } from \"../e-shape-text-align-horizontal\";\nimport { EShapeTextAlignVertical } from \"../e-shape-text-align-vertical\";\nimport { EShapeGroupPropertyParent } from \"./e-shape-group-property-parent\";\n\nexport class EShapeGroupTextAlignEditor implements EShapeTextAlign {\n\tprotected _parent: EShapeGroupPropertyParent;\n\n\tconstructor(parent: EShapeGroupPropertyParent) {\n\t\tthis._parent = parent;\n\t}\n\n\tget horizontal(): EShapeTextAlignHorizontal {\n\t\tconst children = this._parent.children;\n\t\tif (0 < children.length) {\n\t\t\treturn children[children.length - 1].text.align.horizontal;\n\t\t}\n\t\treturn EShapeTextAlignHorizontal.CENTER;\n\t}\n\n\tset horizontal(horizontal: EShapeTextAlignHorizontal) {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].text.align.horizontal = horizontal;\n\t\t}\n\t}\n\n\tget vertical(): EShapeTextAlignVertical {\n\t\tconst children = this._parent.children;\n\t\tif (0 < children.length) {\n\t\t\treturn children[children.length - 1].text.align.vertical;\n\t\t}\n\t\treturn EShapeTextAlignVertical.MIDDLE;\n\t}\n\n\tset vertical(vertical: EShapeTextAlignVertical) {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].text.align.vertical = vertical;\n\t\t}\n\t}\n\n\tcopy(target?: Partial<EShapeTextAlignLike>): void {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].text.align.copy(target);\n\t\t}\n\t}\n\n\tset(horizontal?: EShapeTextAlignHorizontal, vertical?: EShapeTextAlignVertical): void {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].text.align.set(horizontal, vertical);\n\t\t}\n\t}\n\n\ttoObject(): EShapeTextAlignLike {\n\t\tconst children = this._parent.children;\n\t\tif (0 < children.length) {\n\t\t\treturn children[children.length - 1].text.align.toObject();\n\t\t}\n\t\treturn {\n\t\t\thorizontal: EShapeTextAlignHorizontal.CENTER,\n\t\t\tvertical: EShapeTextAlignVertical.MIDDLE\n\t\t};\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\treturn -1;\n\t}\n\n\tdeserialize(target: number, manager: EShapeResourceManagerDeserialization): void {\n\t\t// DO NOTHING\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShapeTextOffsetLike } from \"../e-shape-text-offset\";\nimport { EShapeGroupPropertyParent } from \"./e-shape-group-property-parent\";\n\nexport class EShapeGroupTextOffsetEditor {\n\tprotected _parent: EShapeGroupPropertyParent;\n\n\tconstructor(parent: EShapeGroupPropertyParent) {\n\t\tthis._parent = parent;\n\t}\n\n\tget horizontal(): number {\n\t\tconst children = this._parent.children;\n\t\tif (0 < children.length) {\n\t\t\treturn children[children.length - 1].text.offset.horizontal;\n\t\t}\n\t\treturn 0;\n\t}\n\n\tset horizontal(horizontal: number) {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].text.offset.horizontal = horizontal;\n\t\t}\n\t}\n\n\tget vertical(): number {\n\t\tconst children = this._parent.children;\n\t\tif (0 < children.length) {\n\t\t\treturn children[children.length - 1].text.offset.vertical;\n\t\t}\n\t\treturn 0;\n\t}\n\n\tset vertical(vertical: number) {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].text.offset.vertical = vertical;\n\t\t}\n\t}\n\n\tcopy(target: EShapeTextOffsetLike): void {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].text.offset.copy(target);\n\t\t}\n\t}\n\n\tset(horizontal: number, vertical: number): void {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].text.offset.set(horizontal, vertical);\n\t\t}\n\t}\n\n\ttoObject(): EShapeTextOffsetLike {\n\t\tconst children = this._parent.children;\n\t\tif (0 < children.length) {\n\t\t\treturn children[children.length - 1].text.offset.toObject();\n\t\t}\n\t\treturn {\n\t\t\thorizontal: 0,\n\t\t\tvertical: 0\n\t\t};\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\treturn -1;\n\t}\n\n\tdeserialize(target: number, manager: EShapeResourceManagerDeserialization): void {\n\t\t// DO NOTHING\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShapeTextOutline, EShapeTextOutlineLike } from \"../e-shape-text-outline\";\nimport { EShapeGroupPropertyParent } from \"./e-shape-group-property-parent\";\n\nexport class EShapeGroupTextOutlineEditor implements EShapeTextOutline {\n\tprotected _parent: EShapeGroupPropertyParent;\n\n\tconstructor(parent: EShapeGroupPropertyParent) {\n\t\tthis._parent = parent;\n\t}\n\n\tget enable(): boolean {\n\t\tconst children = this._parent.children;\n\t\tif (0 < children.length) {\n\t\t\treturn children[children.length - 1].text.outline.enable;\n\t\t}\n\t\treturn false;\n\t}\n\n\tset enable(enable: boolean) {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].text.outline.enable = enable;\n\t\t}\n\t}\n\n\tget color(): number {\n\t\tconst children = this._parent.children;\n\t\tif (0 < children.length) {\n\t\t\treturn children[children.length - 1].text.outline.color;\n\t\t}\n\t\treturn 0xffffff;\n\t}\n\n\tset color(color: number) {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].text.outline.color = color;\n\t\t}\n\t}\n\n\tget alpha(): number {\n\t\tconst children = this._parent.children;\n\t\tif (0 < children.length) {\n\t\t\treturn children[children.length - 1].text.outline.alpha;\n\t\t}\n\t\treturn 1.0;\n\t}\n\n\tset alpha(alpha: number) {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].text.outline.alpha = alpha;\n\t\t}\n\t}\n\n\tget width(): number {\n\t\tconst children = this._parent.children;\n\t\tif (0 < children.length) {\n\t\t\treturn children[children.length - 1].text.outline.width;\n\t\t}\n\t\treturn 1.0;\n\t}\n\n\tset width(width: number) {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].text.outline.width = width;\n\t\t}\n\t}\n\n\tcopy(target?: Partial<EShapeTextOutlineLike>): void {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].text.outline.copy(target);\n\t\t}\n\t}\n\n\tset(enable?: boolean, color?: number, alpha?: number, width?: number): void {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].text.outline.set(enable, color, alpha, width);\n\t\t}\n\t}\n\n\tclone(): EShapeGroupTextOutlineEditor {\n\t\treturn new EShapeGroupTextOutlineEditor(this._parent);\n\t}\n\n\ttoObject(): EShapeTextOutlineLike {\n\t\tconst children = this._parent.children;\n\t\tif (0 < children.length) {\n\t\t\treturn children[children.length - 1].text.outline.toObject();\n\t\t}\n\t\treturn {\n\t\t\tenable: false,\n\t\t\tcolor: 0xffffff,\n\t\t\talpha: 1.0,\n\t\t\twidth: 1.0\n\t\t};\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\treturn -1;\n\t}\n\n\tdeserialize(target: number, manager: EShapeResourceManagerDeserialization): void {\n\t\t//\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShapeTextOffsetLike } from \"../e-shape-text-offset\";\nimport { EShapeGroupPropertyParent } from \"./e-shape-group-property-parent\";\n\nexport class EShapeGroupTextPaddingEditor {\n\tprotected _parent: EShapeGroupPropertyParent;\n\n\tconstructor(parent: EShapeGroupPropertyParent) {\n\t\tthis._parent = parent;\n\t}\n\n\tget horizontal(): number {\n\t\tconst children = this._parent.children;\n\t\tif (0 < children.length) {\n\t\t\treturn children[children.length - 1].text.padding.horizontal;\n\t\t}\n\t\treturn 0;\n\t}\n\n\tset horizontal(horizontal: number) {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].text.padding.horizontal = horizontal;\n\t\t}\n\t}\n\n\tget vertical(): number {\n\t\tconst children = this._parent.children;\n\t\tif (0 < children.length) {\n\t\t\treturn children[children.length - 1].text.padding.vertical;\n\t\t}\n\t\treturn 0;\n\t}\n\n\tset vertical(vertical: number) {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].text.padding.vertical = vertical;\n\t\t}\n\t}\n\n\tcopy(target: EShapeTextOffsetLike): void {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].text.padding.copy(target);\n\t\t}\n\t}\n\n\tset(horizontal: number, vertical: number): void {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].text.padding.set(horizontal, vertical);\n\t\t}\n\t}\n\n\ttoObject(): EShapeTextOffsetLike {\n\t\tconst children = this._parent.children;\n\t\tif (0 < children.length) {\n\t\t\treturn children[children.length - 1].text.padding.toObject();\n\t\t}\n\t\treturn {\n\t\t\thorizontal: 0,\n\t\t\tvertical: 0\n\t\t};\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\treturn -1;\n\t}\n\n\tdeserialize(target: number, manager: EShapeResourceManagerDeserialization): void {\n\t\t// DO NOTHING\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShapeTextOffsetLike } from \"../e-shape-text-offset\";\nimport { EShapeGroupPropertyParent } from \"./e-shape-group-property-parent\";\n\nexport class EShapeGroupTextSpacingEditor {\n\tprotected _parent: EShapeGroupPropertyParent;\n\n\tconstructor(parent: EShapeGroupPropertyParent) {\n\t\tthis._parent = parent;\n\t}\n\n\tget horizontal(): number {\n\t\tconst children = this._parent.children;\n\t\tif (0 < children.length) {\n\t\t\treturn children[children.length - 1].text.spacing.horizontal;\n\t\t}\n\t\treturn 0;\n\t}\n\n\tset horizontal(horizontal: number) {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].text.spacing.horizontal = horizontal;\n\t\t}\n\t}\n\n\tget vertical(): number {\n\t\tconst children = this._parent.children;\n\t\tif (0 < children.length) {\n\t\t\treturn children[children.length - 1].text.spacing.vertical;\n\t\t}\n\t\treturn 0;\n\t}\n\n\tset vertical(vertical: number) {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].text.spacing.vertical = vertical;\n\t\t}\n\t}\n\n\tcopy(target: EShapeTextOffsetLike): void {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].text.spacing.copy(target);\n\t\t}\n\t}\n\n\tset(horizontal: number, vertical: number): void {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].text.spacing.set(horizontal, vertical);\n\t\t}\n\t}\n\n\ttoObject(): EShapeTextOffsetLike {\n\t\tconst children = this._parent.children;\n\t\tif (0 < children.length) {\n\t\t\treturn children[children.length - 1].text.spacing.toObject();\n\t\t}\n\t\treturn {\n\t\t\thorizontal: 0,\n\t\t\tvertical: 0\n\t\t};\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\treturn -1;\n\t}\n\n\tdeserialize(target: number, manager: EShapeResourceManagerDeserialization): void {\n\t\t// DO NOTHING\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DeepPartial } from \"../../util/deep-partial\";\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShapeText, EShapeTextLike, EShapeTextStyle, EShapeTextWeight } from \"../e-shape-text\";\nimport { EShapeTextDirection } from \"../e-shape-text-direction\";\nimport { EShapeTextOutline } from \"../e-shape-text-outline\";\nimport { EShapeGroupPropertyParent } from \"./e-shape-group-property-parent\";\nimport { EShapeGroupTextAlignEditor } from \"./e-shape-group-text-align-editor\";\nimport { EShapeGroupTextOffsetEditor } from \"./e-shape-group-text-offset-editor\";\nimport { EShapeGroupTextOutlineEditor } from \"./e-shape-group-text-outline-editor\";\nimport { EShapeGroupTextPaddingEditor } from \"./e-shape-group-text-padding-editor\";\nimport { EShapeGroupTextSpacingEditor } from \"./e-shape-group-text-spacing-editor\";\n\nexport class EShapeGroupTextEditor implements EShapeText {\n\tprotected _parent: EShapeGroupPropertyParent;\n\n\talign: EShapeGroupTextAlignEditor;\n\toffset: EShapeGroupTextOffsetEditor;\n\toutline: EShapeTextOutline;\n\tspacing: EShapeGroupTextSpacingEditor;\n\tpadding: EShapeGroupTextPaddingEditor;\n\n\tconstructor(parent: EShapeGroupPropertyParent) {\n\t\tthis._parent = parent;\n\n\t\tthis.align = new EShapeGroupTextAlignEditor(parent);\n\t\tthis.offset = new EShapeGroupTextOffsetEditor(parent);\n\t\tthis.outline = new EShapeGroupTextOutlineEditor(parent);\n\t\tthis.spacing = new EShapeGroupTextSpacingEditor(parent);\n\t\tthis.padding = new EShapeGroupTextPaddingEditor(parent);\n\t}\n\n\tget enable(): boolean {\n\t\tconst children = this._parent.children;\n\t\tif (0 < children.length) {\n\t\t\treturn children[children.length - 1].text.enable;\n\t\t}\n\t\treturn true;\n\t}\n\n\tset enable(enable: boolean) {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].text.enable = enable;\n\t\t}\n\t}\n\n\tget value(): string {\n\t\tconst children = this._parent.children;\n\t\tif (0 < children.length) {\n\t\t\treturn children[children.length - 1].text.value;\n\t\t}\n\t\treturn \"\";\n\t}\n\n\tset value(value: string) {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].text.value = value;\n\t\t}\n\t}\n\n\tget color(): number {\n\t\tconst children = this._parent.children;\n\t\tif (0 < children.length) {\n\t\t\treturn children[children.length - 1].text.color;\n\t\t}\n\t\treturn 0x000000;\n\t}\n\n\tset color(color: number) {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].text.color = color;\n\t\t}\n\t}\n\n\tget alpha(): number {\n\t\tconst children = this._parent.children;\n\t\tif (0 < children.length) {\n\t\t\treturn children[children.length - 1].text.alpha;\n\t\t}\n\t\treturn 1.0;\n\t}\n\n\tset alpha(alpha: number) {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].text.alpha = alpha;\n\t\t}\n\t}\n\n\tget family(): string {\n\t\tconst children = this._parent.children;\n\t\tif (0 < children.length) {\n\t\t\treturn children[children.length - 1].text.family;\n\t\t}\n\t\treturn \"auto\";\n\t}\n\n\tset family(family: string) {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].text.family = family;\n\t\t}\n\t}\n\n\tget size(): number {\n\t\tconst children = this._parent.children;\n\t\tif (0 < children.length) {\n\t\t\treturn children[children.length - 1].text.size;\n\t\t}\n\t\treturn 24;\n\t}\n\n\tset size(size: number) {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].text.size = size;\n\t\t}\n\t}\n\n\tget weight(): EShapeTextWeight {\n\t\tconst children = this._parent.children;\n\t\tif (0 < children.length) {\n\t\t\treturn children[children.length - 1].text.weight;\n\t\t}\n\t\treturn EShapeTextWeight.NORMAL;\n\t}\n\n\tset weight(weight: EShapeTextWeight) {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].text.weight = weight;\n\t\t}\n\t}\n\n\tget style(): EShapeTextStyle {\n\t\tconst children = this._parent.children;\n\t\tif (0 < children.length) {\n\t\t\treturn children[children.length - 1].text.style;\n\t\t}\n\t\treturn EShapeTextStyle.NORMAL;\n\t}\n\n\tset style(style: EShapeTextStyle) {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].text.style = style;\n\t\t}\n\t}\n\n\tget direction(): EShapeTextDirection {\n\t\tconst children = this._parent.children;\n\t\tif (0 < children.length) {\n\t\t\treturn children[children.length - 1].text.direction;\n\t\t}\n\t\treturn 0;\n\t}\n\n\tset direction(direction: EShapeTextDirection) {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].text.direction = direction;\n\t\t}\n\t}\n\n\tget clipping(): boolean {\n\t\tconst children = this._parent.children;\n\t\tif (0 < children.length) {\n\t\t\treturn children[children.length - 1].text.clipping;\n\t\t}\n\t\treturn false;\n\t}\n\n\tset clipping(clipping: boolean) {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].text.clipping = clipping;\n\t\t}\n\t}\n\n\tcopy(target?: DeepPartial<EShapeTextLike>): this {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].text.copy(target);\n\t\t}\n\t\treturn this;\n\t}\n\n\tset(\n\t\tvalue?: string,\n\t\tcolor?: number,\n\t\talpha?: number,\n\t\tfamily?: string,\n\t\tsize?: number,\n\t\tweight?: EShapeTextWeight,\n\t\tstyle?: EShapeTextStyle,\n\t\tdirection?: EShapeTextDirection\n\t): this {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].text.set(value, color, alpha, family, size, weight, style, direction);\n\t\t}\n\t\treturn this;\n\t}\n\n\ttoObject(): EShapeTextLike {\n\t\tconst children = this._parent.children;\n\t\tif (0 < children.length) {\n\t\t\treturn children[children.length - 1].text.toObject();\n\t\t}\n\t\treturn {\n\t\t\tvalue: \"\",\n\t\t\tcolor: 0x000000,\n\t\t\talpha: 1.0,\n\t\t\tfamily: \"auto\",\n\t\t\tsize: 24,\n\t\t\tweight: EShapeTextWeight.NORMAL,\n\t\t\talign: this.align.toObject(),\n\t\t\toffset: this.offset.toObject(),\n\t\t\tstyle: EShapeTextStyle.NORMAL,\n\t\t\toutline: this.outline.toObject(),\n\t\t\tspacing: this.spacing.toObject(),\n\t\t\tdirection: EShapeTextDirection.LEFT_TO_RIGHT,\n\t\t\tpadding: this.padding.toObject(),\n\t\t\tclipping: false\n\t\t};\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\treturn -1;\n\t}\n\n\tdeserialize(target: number, manager: EShapeResourceManagerDeserialization): void {\n\t\t// DO NOTHING\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeFill, EShapeFillLike } from \"../e-shape-fill\";\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\n\nexport class EShapeGroupFillViewer implements EShapeFill {\n\tconstructor() {\n\t\t// DO NOTHING\n\t}\n\n\tget enable(): boolean {\n\t\treturn true;\n\t}\n\n\tset enable(enable: boolean) {\n\t\t// DO NOTHING\n\t}\n\n\tget color(): number {\n\t\treturn 0xffffff;\n\t}\n\n\tset color(color: number) {\n\t\t// DO NOTHING\n\t}\n\n\tget alpha(): number {\n\t\treturn 1.0;\n\t}\n\n\tset alpha(alpha: number) {\n\t\t// DO NOTHING\n\t}\n\n\tcopy(target?: Partial<EShapeFillLike>): void {\n\t\t// DO NOTHING\n\t}\n\n\tset(enable: boolean, color: number, alpha: number): void {\n\t\t// DO NOTHING\n\t}\n\n\tclone(): EShapeGroupFillViewer {\n\t\treturn new EShapeGroupFillViewer();\n\t}\n\n\ttoObject(): EShapeFillLike {\n\t\treturn {\n\t\t\tenable: true,\n\t\t\tcolor: 0xffffff,\n\t\t\talpha: 1.0\n\t\t};\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\treturn -1;\n\t}\n\n\tdeserialize(target: number, manager: EShapeResourceManagerDeserialization): void {\n\t\t// DO NOTHING\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Matrix, Point } from \"pixi.js\";\n\nexport class EShapeEditor {\n\tlocalTransform: Matrix;\n\tinternalTransform: Matrix;\n\tinternalTransformParentInverse: Matrix;\n\trotation: number;\n\tsize: Point;\n\n\tconstructor() {\n\t\tthis.localTransform = new Matrix();\n\t\tthis.internalTransform = new Matrix();\n\t\tthis.internalTransformParentInverse = new Matrix();\n\t\tthis.rotation = 0;\n\t\tthis.size = new Point();\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Matrix } from \"pixi.js\";\nimport { EShape } from \"./e-shape\";\nimport { EShapeEditor } from \"./e-shape-editor\";\nimport { EShapeBase } from \"./variant/e-shape-base\";\nimport { toSizeNormalized } from \"./variant/to-size-normalized\";\n\nexport class EShapeTransforms {\n\tstatic prepare(shape: EShape): void {\n\t\tconst editor = shape.editor || new EShapeEditor();\n\t\tshape.editor = editor;\n\n\t\t// Transform\n\t\tshape.updateTransform();\n\t\tconst parent = shape.parent;\n\t\tif (parent instanceof EShapeBase) {\n\t\t\tparent.transform.internalTransform\n\t\t\t\t.copyTo(editor.internalTransformParentInverse)\n\t\t\t\t.invert();\n\t\t} else {\n\t\t\teditor.internalTransformParentInverse.identity();\n\t\t}\n\t\tshape.transform.internalTransform.copyTo(editor.internalTransform);\n\n\t\t// Rotation\n\t\teditor.rotation = shape.transform.rotation;\n\n\t\t// Size\n\t\teditor.size.copyFrom(shape.size);\n\n\t\t//\n\t\tshape.disallowOnTransformChange();\n\t}\n\n\tstatic finalize(shape: EShape): void {\n\t\tshape.allowOnTransformChange(true);\n\t}\n\n\tstatic apply(shape: EShape, transform: Matrix, keepSize: boolean): void {\n\t\tconst editor = shape.editor;\n\t\tif (editor != null) {\n\t\t\tconst newLocalTransform = editor.localTransform;\n\t\t\teditor.internalTransformParentInverse\n\t\t\t\t.copyTo(newLocalTransform)\n\t\t\t\t.append(transform)\n\t\t\t\t.append(editor.internalTransform);\n\t\t\tif (keepSize) {\n\t\t\t\tthis.applyLocal(shape, newLocalTransform);\n\t\t\t} else {\n\t\t\t\tconst size = editor.size;\n\t\t\t\tthis.applyLocal(shape, newLocalTransform, size.x, size.y);\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic applyLocal(shape: EShape, localTransform: Matrix, bx?: number, by?: number): void {\n\t\tshape.disallowUploadedUpdate();\n\n\t\t// Reconstruct the position, the rotation and the size\n\t\tconst a = localTransform.a;\n\t\tconst b = localTransform.b;\n\t\tconst c = localTransform.c;\n\t\tconst d = localTransform.d;\n\t\tconst tx = localTransform.tx;\n\t\tconst ty = localTransform.ty;\n\n\t\t// Rotation\n\t\tconst transform = shape.transform;\n\t\tconst rx = Math.atan2(-c, d); // rotation - skewX\n\t\tconst ry = Math.atan2(+b, a); // rotation + skewY\n\t\ttransform.rotation = (rx + ry) * 0.5; // Here, assumes `skewX` === `skewY`\n\n\t\t// Skew\n\t\tconst skew = (ry - rx) * 0.5;\n\t\ttransform.skew.set(skew, skew);\n\n\t\t// Position: Assumes the pivot is invariant.\n\t\t// tx = position.x - (a * px + c * py)\n\t\t// ty = position.y - (b * px + d * py)\n\t\t//\n\t\t// Thus,\n\t\t// position.x = tx + (a * px + c * py)\n\t\t// position.y = ty + (b * px + d * py)\n\t\tconst pivot = transform.pivot;\n\t\tconst px = pivot.x;\n\t\tconst py = pivot.y;\n\t\ttransform.position.set(tx + (a * px + c * py), ty + (b * px + d * py));\n\n\t\t// Scale\n\t\tif (bx != null && by != null) {\n\t\t\tconst sx = Math.sqrt(a * a + b * b);\n\t\t\tconst sy = Math.sqrt(c * c + d * d);\n\t\t\tshape.size.set(toSizeNormalized(bx * sx), toSizeNormalized(by * sy));\n\t\t}\n\n\t\t//\n\t\tshape.allowUploadedUpdate();\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Matrix, Point } from \"pixi.js\";\nimport { EShape } from \"../e-shape\";\nimport { EShapeLayout } from \"../e-shape-layout\";\nimport { EShapeTransforms } from \"../e-shape-transforms\";\n\nexport class EShapeGroupSizeLayout implements EShapeLayout {\n\tprotected static WORK_TRANSFORM: Matrix = new Matrix();\n\n\tprotected shape: EShape;\n\tprotected base: Point;\n\tprotected shapeBase: Point;\n\tprotected transform: Matrix;\n\n\tconstructor(shape: EShape, bx: number, by: number) {\n\t\tthis.shape = shape;\n\n\t\t// Base group size\n\t\tthis.base = new Point(bx, by);\n\n\t\t// Base shape size\n\t\tconst size = shape.size;\n\t\tthis.shapeBase = new Point(size.x, size.y);\n\n\t\t// Transform\n\t\tthis.transform = new Matrix();\n\t\tshape.updateTransform();\n\t\tshape.transform.localTransform.copyTo(this.transform);\n\t}\n\n\tisCompatible(shape: EShape): boolean {\n\t\treturn this.shape === shape;\n\t}\n\n\treset(shape: EShape, baseX: number, baseY: number): void {\n\t\tthis.base.set(baseX, baseY);\n\n\t\t// Base shape size\n\t\tconst size = shape.size;\n\t\tthis.shapeBase.copyFrom(size);\n\n\t\t// Transform\n\t\tshape.updateTransform();\n\t\tshape.transform.localTransform.copyTo(this.transform);\n\t}\n\n\tupdate(shape: EShape, baseX: number, baseY: number, pivotX: number, pivotY: number): void {\n\t\tconst sx = baseX / this.base.x;\n\t\tconst sy = baseY / this.base.y;\n\t\tconst childBase = this.shapeBase;\n\t\tconst transform = EShapeGroupSizeLayout.WORK_TRANSFORM;\n\t\ttransform\n\t\t\t.identity()\n\t\t\t.append(this.transform)\n\t\t\t.translate(-pivotX, -pivotY)\n\t\t\t.scale(sx, sy)\n\t\t\t.translate(+pivotX, +pivotY);\n\t\tshape.disallowOnTransformChange();\n\t\tEShapeTransforms.applyLocal(shape, transform, childBase.x, childBase.y);\n\t\tshape.allowOnTransformChange(false);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { IPoint, Point, Rectangle } from \"pixi.js\";\nimport { EShape } from \"../e-shape\";\nimport { EShapeLayout } from \"../e-shape-layout\";\nimport { EShapeGroupSize } from \"./e-shape-group-size\";\nimport { EShapeGroupSizeLayout } from \"./e-shape-group-size-layout\";\nimport { EShapeGroupSizeParent } from \"./e-shape-group-size-parent\";\n\nexport class EShapeGroupSizeEditor implements EShapeGroupSize {\n\tprotected _parent: EShapeGroupSizeParent;\n\tprotected _size: Point;\n\tprotected _layouts: EShapeLayout[];\n\tprotected _workPoint: Point = new Point();\n\tprotected _workRectForCalcRect: Rectangle = new Rectangle();\n\tprotected _workRectForFit: Rectangle = new Rectangle();\n\tprotected _isFittable: boolean;\n\n\tconstructor(parent: EShapeGroupSizeParent, x: number, y: number, isFittable: boolean) {\n\t\tthis._parent = parent;\n\t\tthis._layouts = [];\n\t\tthis._size = new Point(x, y);\n\t\tthis._isFittable = isFittable;\n\t}\n\n\tinit(): void {\n\t\t// DO NOTHING\n\t}\n\n\tget x(): number {\n\t\treturn this._size.x;\n\t}\n\n\tset x(x: number) {\n\t\tconst size = this._size;\n\t\tif (size.x !== x) {\n\t\t\tconst ox = size.x;\n\t\t\tsize.x = x;\n\t\t\tthis.onChange(ox, size.y);\n\t\t}\n\t}\n\n\tget y(): number {\n\t\treturn this._size.y;\n\t}\n\n\tset y(y: number) {\n\t\tconst size = this._size;\n\t\tif (size.y !== y) {\n\t\t\tconst oy = size.y;\n\t\t\tsize.y = y;\n\t\t\tthis.onChange(size.x, oy);\n\t\t}\n\t}\n\n\tset(x?: number, y?: number): this {\n\t\tlet isChanged = false;\n\t\tconst size = this._size;\n\t\tconst ox = size.x;\n\t\tconst oy = size.y;\n\t\tif (x != null && ox !== x) {\n\t\t\tisChanged = true;\n\t\t\tsize.x = x;\n\t\t}\n\t\tif (y != null && oy !== y) {\n\t\t\tisChanged = true;\n\t\t\tsize.y = y;\n\t\t}\n\t\tif (isChanged) {\n\t\t\tthis.onChange(ox, oy);\n\t\t}\n\t\treturn this;\n\t}\n\n\tclone(): EShapeGroupSizeEditor {\n\t\tconst size = this._size;\n\t\treturn new EShapeGroupSizeEditor(this._parent, size.x, size.y, this._isFittable);\n\t}\n\n\tcopy(): void {\n\t\t// DO NOTHING\n\t}\n\n\tcopyFrom(point: IPoint): this {\n\t\tconst x = point.x;\n\t\tconst y = point.y;\n\t\tconst size = this._size;\n\t\tconst ox = size.x;\n\t\tconst oy = size.y;\n\t\tif (ox !== x || oy !== y) {\n\t\t\tsize.x = x;\n\t\t\tsize.y = y;\n\t\t\tthis.onChange(ox, oy);\n\t\t}\n\t\treturn this;\n\t}\n\n\tcopyTo(point: IPoint): IPoint {\n\t\treturn this._size.copyTo(point);\n\t}\n\n\tequals(point: IPoint): boolean {\n\t\treturn this._size.equals(point);\n\t}\n\n\tfit(): void {\n\t\tif (this._isFittable) {\n\t\t\tthis.doFit();\n\t\t}\n\t}\n\n\tprotected doFit(): void {\n\t\tconst parent = this._parent;\n\t\tparent.disallowOnTransformChange();\n\n\t\t// Calculate the rect\n\t\tconst rect = this.calcRect(this._workRectForFit);\n\n\t\t// Set size\n\t\tconst size = this._size;\n\t\tsize.set(rect.width, rect.height);\n\n\t\t// Position & Pivot\n\t\t// rx := rect.x\n\t\t// ry := rect.y\n\t\t//\n\t\t// | a c tx | | 1 0 +rx | | 1 0 -rx |   | a c tx + (a * rx + c * ry) | | 1 0 -rx |\n\t\t// | b d ty | | 0 1 +ry | | 0 1 -ry | = | b d ty + (b * rx + d * ry) | | 0 1 -ry |\n\t\t// | 0 0 1  | | 0 0  1  | | 0 0  1  |   | 0 0 1                      | | 0 0  1  |\n\t\t//\n\t\t// tx -> tx + (a * rx + c * ry) = poxition.x - (a * pivot.x + c * pivot.y)\n\t\t// ty -> ty + (b * rx + d * ry) = poxition.y - (b * pivot.x + d * pivot.y)\n\t\t// position.x -> position.x + (a * rx + c * ry) - (a * pivot.x + c * pivot.y)\n\t\t// position.y -> position.y + (b * rx + d * ry) - (b * pivot.x + d * pivot.y)\n\t\t// pivot.x -> 0\n\t\t// pivot.y -> 0\n\t\t//\n\t\t// a -> a', b -> b', c -> c', tx -> tx', ty -> ty'\n\t\t//\n\t\t// | a' c' tx' | | 1 0 -rx |   | a' c' tx' - (a' * rx + c' * ry) |\n\t\t// | b' d' ty' | | 0 1 -ry | = | b' d' ty' - (b' * rx + d' * ry) |\n\t\t// | 0  0  1   | | 0 0  1  |   | 0  0  1                         |\n\t\t//\n\t\t// tx' -> tx' - (a' * rx + c' * ry) = poxition.x - (a' * pivot.x + c' * pivot.y)\n\t\t// ty' -> ty' - (b' * rx + d' * ry) = poxition.y - (b' * pivot.x + d' * pivot.y)\n\t\t// pivot.x -> pivot.x + rx\n\t\t// pivot.y -> pivot.y + ry\n\t\tparent.updateTransform();\n\t\tconst transform = parent.transform;\n\t\tconst x = rect.x + rect.width * 0.5;\n\t\tconst y = rect.y + rect.height * 0.5;\n\t\tconst position = transform.position;\n\t\tconst localTransform = transform.localTransform;\n\t\tconst a = localTransform.a;\n\t\tconst b = localTransform.b;\n\t\tconst c = localTransform.c;\n\t\tconst d = localTransform.d;\n\t\tconst pivot = transform.pivot;\n\t\tposition.set(\n\t\t\tposition.x + (a * x + c * y) - (a * pivot.x + c * pivot.y),\n\t\t\tposition.y + (b * x + d * y) - (b * pivot.x + d * pivot.y)\n\t\t);\n\t\tpivot.set(x, y);\n\n\t\t// Reset the data\n\t\tthis.reset(parent.children, this._layouts, size);\n\n\t\t//\n\t\tparent.allowOnTransformChange(true);\n\t}\n\n\tprotected reset(children: EShape[], layouts: EShapeLayout[], size: IPoint): void {\n\t\tfor (let i = 0, imax = Math.min(layouts.length, children.length); i < imax; ++i) {\n\t\t\tconst child = children[i];\n\t\t\tconst layout = layouts[i];\n\t\t\tif (layout.isCompatible(child)) {\n\t\t\t\tlayout.reset(child, size.x, size.y);\n\t\t\t} else {\n\t\t\t\tlayouts.length = i;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (children.length < layouts.length) {\n\t\t\tlayouts.length = children.length;\n\t\t}\n\t}\n\n\tcalcRect(result: Rectangle): Rectangle {\n\t\tconst parent = this._parent;\n\t\tconst children = parent.children;\n\t\tif (children.length <= 0) {\n\t\t\tresult.x = 0;\n\t\t\tresult.y = 0;\n\t\t\tresult.width = 0;\n\t\t\tresult.height = 0;\n\t\t} else {\n\t\t\tconst workPoint = this._workPoint;\n\t\t\tconst workRect = this._workRectForCalcRect;\n\t\t\tchildren[0].getBoundsLocal(workPoint, false, result);\n\t\t\tfor (let i = 1, imax = children.length; i < imax; ++i) {\n\t\t\t\tconst child = children[i];\n\t\t\t\tchild.getBoundsLocal(workPoint, false, workRect);\n\t\t\t\tresult.enlarge(workRect);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected onChange(ox: number, oy: number): void {\n\t\tconst parent = this._parent;\n\t\tconst size = this._size;\n\t\tconst pivot = parent.transform.pivot;\n\t\tthis.onChange_(parent.children, this._layouts, size.x, size.y, pivot.x, pivot.y, ox, oy);\n\t\tparent.onSizeChange();\n\t}\n\n\tprotected onChange_(\n\t\tchildren: EShape[],\n\t\tlayouts: EShapeLayout[],\n\t\tsx: number,\n\t\tsy: number,\n\t\tpx: number,\n\t\tpy: number,\n\t\tox: number,\n\t\toy: number\n\t): void {\n\t\tfor (let i = 0, imax = Math.min(layouts.length, children.length); i < imax; ++i) {\n\t\t\tconst child = children[i];\n\t\t\tconst layout = layouts[i];\n\t\t\tif (layout.isCompatible(child)) {\n\t\t\t\tlayout.update(child, sx, sy, px, py);\n\t\t\t} else {\n\t\t\t\tlayouts.length = i;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tfor (let i = layouts.length, imax = children.length; i < imax; ++i) {\n\t\t\tconst child = children[i];\n\t\t\tconst layout = this.newLayout(child, ox, oy);\n\t\t\tlayout.update(child, sx, sy, px, py);\n\t\t\tlayouts.push(layout);\n\t\t}\n\t\tif (layouts.length !== children.length) {\n\t\t\tlayouts.length = children.length;\n\t\t}\n\t}\n\n\tprotected newLayout(shape: EShape, ox: number, oy: number): EShapeLayout {\n\t\treturn shape.layout || new EShapeGroupSizeLayout(shape, ox, oy);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { IPoint, Point } from \"pixi.js\";\nimport { EShapeGroupSize } from \"./e-shape-group-size\";\n\nexport interface EShapeGroupSizeViewerParentTransform {\n\tscale: IPoint;\n}\n\nexport interface EShapeGroupSizeViewerParent {\n\treadonly transform: EShapeGroupSizeViewerParentTransform;\n}\n\nexport class EShapeGroupSizeViewer implements EShapeGroupSize {\n\tprotected _x: number;\n\tprotected _y: number;\n\tprotected _parent: EShapeGroupSizeViewerParent;\n\tprotected _base: Point;\n\n\tconstructor(parent: EShapeGroupSizeViewerParent, x: number, y: number, bx: number, by: number) {\n\t\tthis._parent = parent;\n\t\tthis._x = x;\n\t\tthis._y = y;\n\t\tthis._base = new Point(bx, by);\n\t}\n\n\tget x(): number {\n\t\treturn this._x;\n\t}\n\n\tset x(x: number) {\n\t\tif (this._x !== x) {\n\t\t\tthis._x = x;\n\t\t\tthis.onChange();\n\t\t}\n\t}\n\n\tget y(): number {\n\t\treturn this._y;\n\t}\n\n\tset y(y: number) {\n\t\tif (this._y !== y) {\n\t\t\tthis._y = y;\n\t\t\tthis.onChange();\n\t\t}\n\t}\n\n\tget base(): IPoint {\n\t\treturn this._base;\n\t}\n\n\tinit(): void {\n\t\tthis._base.copyFrom(this);\n\t\tthis.onChange();\n\t}\n\n\tclone(): EShapeGroupSizeViewer {\n\t\tconst base = this._base;\n\t\treturn new EShapeGroupSizeViewer(this._parent, this._x, this._y, base.x, base.y);\n\t}\n\n\tset(x?: number, y?: number): this {\n\t\tlet isChanged = false;\n\t\tif (x != null && this._x !== x) {\n\t\t\tthis._x = x;\n\t\t\tisChanged = true;\n\t\t}\n\t\tif (y != null && this._y !== y) {\n\t\t\tthis._y = y;\n\t\t\tisChanged = true;\n\t\t}\n\t\tif (isChanged) {\n\t\t\tthis.onChange();\n\t\t}\n\t\treturn this;\n\t}\n\n\tcopyFrom(p: IPoint): this {\n\t\tif (p instanceof EShapeGroupSizeViewer) {\n\t\t\tthis._base.copyFrom(p.base);\n\t\t}\n\t\tif (this._x !== p.x || this._y !== p.y) {\n\t\t\tthis._x = p.x;\n\t\t\tthis._y = p.y;\n\t\t\tthis.onChange();\n\t\t}\n\t\treturn this;\n\t}\n\n\tcopyTo(p: IPoint): IPoint {\n\t\tif (p instanceof EShapeGroupSizeViewer) {\n\t\t\tthis._base.copyTo(p.base);\n\t\t}\n\t\tp.set(this._x, this._y);\n\t\treturn p;\n\t}\n\n\tequals(p: IPoint): boolean {\n\t\treturn p.x === this._x && p.y === this._y;\n\t}\n\n\tfit(): void {\n\t\t// DO NOTHING\n\t}\n\n\tprotected onChange(): void {\n\t\tconst base = this._base;\n\t\tthis._parent.transform.scale.set(this._x / base.x, this._y / base.y);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShapeStroke, EShapeStrokeLike } from \"../e-shape-stroke\";\nimport { EShapeStrokeSide } from \"../e-shape-stroke-side\";\nimport { EShapeStrokeStyle } from \"../e-shape-stroke-style\";\n\nexport class EShapeGroupStrokeViewer implements EShapeStroke {\n\tconstructor() {\n\t\t// DO NOTHING\n\t}\n\n\tget enable(): boolean {\n\t\treturn false;\n\t}\n\n\tset enable(enable: boolean) {\n\t\t// DO NOTHING\n\t}\n\n\tget color(): number {\n\t\treturn 0xffffff;\n\t}\n\n\tset color(color: number) {\n\t\t// DO NOTHING\n\t}\n\n\tget alpha(): number {\n\t\treturn 1.0;\n\t}\n\n\tset alpha(alpha: number) {\n\t\t// DO NOTHING\n\t}\n\n\tget width(): number {\n\t\treturn 1.0;\n\t}\n\n\tset width(width: number) {\n\t\t// DO NOTHING\n\t}\n\n\tget align(): number {\n\t\treturn 0.0;\n\t}\n\n\tset align(width: number) {\n\t\t// DO NOTHING\n\t}\n\n\tget side(): EShapeStrokeSide {\n\t\treturn EShapeStrokeSide.NONE;\n\t}\n\n\tset side(side: EShapeStrokeSide) {\n\t\t// DO NOTHING\n\t}\n\n\tget style(): EShapeStrokeStyle {\n\t\treturn EShapeStrokeStyle.NONE;\n\t}\n\n\tset style(style: EShapeStrokeStyle) {\n\t\t// DO NOTHING\n\t}\n\n\tcopy(target?: Partial<EShapeStrokeLike>): void {\n\t\t// DO NOTHING\n\t}\n\n\tset(\n\t\tenable?: boolean,\n\t\tcolor?: number,\n\t\talpha?: number,\n\t\twidth?: number,\n\t\talign?: number,\n\t\tside?: EShapeStrokeSide,\n\t\tstyle?: EShapeStrokeStyle\n\t): void {\n\t\t// DO NOTHING\n\t}\n\n\tclone(): EShapeGroupStrokeViewer {\n\t\treturn new EShapeGroupStrokeViewer();\n\t}\n\n\ttoObject(): EShapeStrokeLike {\n\t\treturn {\n\t\t\tenable: false,\n\t\t\tcolor: 0xffffff,\n\t\t\talpha: 1.0,\n\t\t\twidth: 1.0,\n\t\t\talign: 0.0,\n\t\t\tside: EShapeStrokeSide.NONE,\n\t\t\tstyle: EShapeStrokeStyle.NONE\n\t\t};\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\treturn -1;\n\t}\n\n\tdeserialize(target: number, manager: EShapeResourceManagerDeserialization): void {\n\t\t//\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShapeTextAlign, EShapeTextAlignLike } from \"../e-shape-text-align\";\nimport { EShapeTextAlignHorizontal } from \"../e-shape-text-align-horizontal\";\nimport { EShapeTextAlignVertical } from \"../e-shape-text-align-vertical\";\n\nexport class EShapeGroupTextAlignViewer implements EShapeTextAlign {\n\tconstructor() {\n\t\t// DO NOTHING\n\t}\n\n\tget horizontal(): EShapeTextAlignHorizontal {\n\t\treturn EShapeTextAlignHorizontal.CENTER;\n\t}\n\n\tset horizontal(horizontal: EShapeTextAlignHorizontal) {\n\t\t// DO NOTHING\n\t}\n\n\tget vertical(): EShapeTextAlignVertical {\n\t\treturn EShapeTextAlignVertical.MIDDLE;\n\t}\n\n\tset vertical(vertical: EShapeTextAlignVertical) {\n\t\t// DO NOTHING\n\t}\n\n\tcopy(target?: Partial<EShapeTextAlignLike>): void {\n\t\t// DO NOTHING\n\t}\n\n\tset(horizontal?: EShapeTextAlignHorizontal, vertical?: EShapeTextAlignVertical): void {\n\t\t// DO NOTHING\n\t}\n\n\ttoObject(): EShapeTextAlignLike {\n\t\treturn {\n\t\t\thorizontal: EShapeTextAlignHorizontal.CENTER,\n\t\t\tvertical: EShapeTextAlignVertical.MIDDLE\n\t\t};\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\treturn -1;\n\t}\n\n\tdeserialize(target: number, manager: EShapeResourceManagerDeserialization): void {\n\t\t// DO NOTHING\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShapeTextOffset, EShapeTextOffsetLike } from \"../e-shape-text-offset\";\n\nexport class EShapeGroupTextOffsetViewer implements EShapeTextOffset {\n\tconstructor() {\n\t\t// DO NOTHING\n\t}\n\n\tget horizontal(): number {\n\t\treturn 0;\n\t}\n\n\tset horizontal(horizontal: number) {\n\t\t// DO NOTHING\n\t}\n\n\tget vertical(): number {\n\t\treturn 0;\n\t}\n\n\tset vertical(vertical: number) {\n\t\t// DO NOTHING\n\t}\n\n\tcopy(target?: Partial<EShapeTextOffsetLike>): void {\n\t\t// DO NOTHING\n\t}\n\n\tset(horizontal?: number, vertical?: number): void {\n\t\t// DO NOTHING\n\t}\n\n\ttoObject(): EShapeTextOffsetLike {\n\t\treturn {\n\t\t\thorizontal: 0,\n\t\t\tvertical: 0\n\t\t};\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\treturn -1;\n\t}\n\n\tdeserialize(target: number, manager: EShapeResourceManagerDeserialization): void {\n\t\t// DO NOTHING\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShapeTextOutline, EShapeTextOutlineLike } from \"../e-shape-text-outline\";\n\nexport class EShapeGroupTextOutlineViewer implements EShapeTextOutline {\n\tconstructor() {\n\t\t// DO NOTHING\n\t}\n\n\tget enable(): boolean {\n\t\treturn false;\n\t}\n\n\tset enable(enable: boolean) {\n\t\t// DO NOTHING\n\t}\n\n\tget color(): number {\n\t\treturn 0xffffff;\n\t}\n\n\tset color(color: number) {\n\t\t// DO NOTHING\n\t}\n\n\tget alpha(): number {\n\t\treturn 1.0;\n\t}\n\n\tset alpha(alpha: number) {\n\t\t// DO NOTHING\n\t}\n\n\tget width(): number {\n\t\treturn 1.0;\n\t}\n\n\tset width(width: number) {\n\t\t// DO NOTHING\n\t}\n\n\tcopy(target?: Partial<EShapeTextOutlineLike>): void {\n\t\t// DO NOTHING\n\t}\n\n\tset(enable?: boolean, color?: number, alpha?: number, width?: number): void {\n\t\t// DO NOTHING\n\t}\n\n\tclone(): EShapeGroupTextOutlineViewer {\n\t\treturn new EShapeGroupTextOutlineViewer();\n\t}\n\n\ttoObject(): EShapeTextOutlineLike {\n\t\treturn {\n\t\t\tenable: false,\n\t\t\tcolor: 0xffffff,\n\t\t\talpha: 1.0,\n\t\t\twidth: 1.0\n\t\t};\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\treturn -1;\n\t}\n\n\tdeserialize(target: number, manager: EShapeResourceManagerDeserialization): void {\n\t\t//\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShapeTextOffset, EShapeTextOffsetLike } from \"../e-shape-text-offset\";\n\nexport class EShapeGroupTextPaddingViewer implements EShapeTextOffset {\n\tconstructor() {\n\t\t// DO NOTHING\n\t}\n\n\tget horizontal(): number {\n\t\treturn 0;\n\t}\n\n\tset horizontal(horizontal: number) {\n\t\t// DO NOTHING\n\t}\n\n\tget vertical(): number {\n\t\treturn 0;\n\t}\n\n\tset vertical(vertical: number) {\n\t\t// DO NOTHING\n\t}\n\n\tcopy(target?: Partial<EShapeTextOffsetLike>): void {\n\t\t// DO NOTHING\n\t}\n\n\tset(horizontal?: number, vertical?: number): void {\n\t\t// DO NOTHING\n\t}\n\n\ttoObject(): EShapeTextOffsetLike {\n\t\treturn {\n\t\t\thorizontal: 0,\n\t\t\tvertical: 0\n\t\t};\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\treturn -1;\n\t}\n\n\tdeserialize(target: number, manager: EShapeResourceManagerDeserialization): void {\n\t\t// DO NOTHING\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShapeTextOffset, EShapeTextOffsetLike } from \"../e-shape-text-offset\";\n\nexport class EShapeGroupTextSpacingViewer implements EShapeTextOffset {\n\tconstructor() {\n\t\t// DO NOTHING\n\t}\n\n\tget horizontal(): number {\n\t\treturn 0;\n\t}\n\n\tset horizontal(horizontal: number) {\n\t\t// DO NOTHING\n\t}\n\n\tget vertical(): number {\n\t\treturn 0;\n\t}\n\n\tset vertical(vertical: number) {\n\t\t// DO NOTHING\n\t}\n\n\tcopy(target?: Partial<EShapeTextOffsetLike>): void {\n\t\t// DO NOTHING\n\t}\n\n\tset(horizontal?: number, vertical?: number): void {\n\t\t// DO NOTHING\n\t}\n\n\ttoObject(): EShapeTextOffsetLike {\n\t\treturn {\n\t\t\thorizontal: 0,\n\t\t\tvertical: 0\n\t\t};\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\treturn -1;\n\t}\n\n\tdeserialize(target: number, manager: EShapeResourceManagerDeserialization): void {\n\t\t// DO NOTHING\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DeepPartial } from \"../../util/deep-partial\";\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShapeText, EShapeTextLike, EShapeTextStyle, EShapeTextWeight } from \"../e-shape-text\";\nimport { EShapeTextDirection } from \"../e-shape-text-direction\";\nimport { EShapeGroupTextAlignViewer } from \"./e-shape-group-text-align-viewer\";\nimport { EShapeGroupTextOffsetViewer } from \"./e-shape-group-text-offset-viewer\";\nimport { EShapeGroupTextOutlineViewer } from \"./e-shape-group-text-outline-viewer\";\nimport { EShapeGroupTextPaddingViewer } from \"./e-shape-group-text-padding-viewer\";\nimport { EShapeGroupTextSpacingViewer } from \"./e-shape-group-text-spacing-viewer\";\n\nexport class EShapeGroupTextViewer implements EShapeText {\n\talign: EShapeGroupTextAlignViewer;\n\toffset: EShapeGroupTextOffsetViewer;\n\toutline: EShapeGroupTextOutlineViewer;\n\tspacing: EShapeGroupTextSpacingViewer;\n\tpadding: EShapeGroupTextPaddingViewer;\n\n\tconstructor() {\n\t\tthis.align = new EShapeGroupTextAlignViewer();\n\t\tthis.offset = new EShapeGroupTextOffsetViewer();\n\t\tthis.outline = new EShapeGroupTextOutlineViewer();\n\t\tthis.spacing = new EShapeGroupTextSpacingViewer();\n\t\tthis.padding = new EShapeGroupTextPaddingViewer();\n\t}\n\n\tget enable(): boolean {\n\t\treturn true;\n\t}\n\n\tset enable(enable: boolean) {\n\t\t// DO NOTHING\n\t}\n\n\tget value(): string {\n\t\treturn \"\";\n\t}\n\n\tset value(value: string) {\n\t\t// DO NOTHING\n\t}\n\n\tget color(): number {\n\t\treturn 0x000000;\n\t}\n\n\tset color(color: number) {\n\t\t// DO NOTHING\n\t}\n\n\tget alpha(): number {\n\t\treturn 1.0;\n\t}\n\n\tset alpha(alpha: number) {\n\t\t// DO NOTHING\n\t}\n\n\tget family(): string {\n\t\treturn \"auto\";\n\t}\n\n\tset family(family: string) {\n\t\t// DO NOTHING\n\t}\n\n\tget size(): number {\n\t\treturn 24;\n\t}\n\n\tset size(size: number) {\n\t\t// DO NOTHING\n\t}\n\n\tget weight(): EShapeTextWeight {\n\t\treturn EShapeTextWeight.NORMAL;\n\t}\n\n\tset weight(weight: EShapeTextWeight) {\n\t\t// DO NOTHING\n\t}\n\n\tget style(): EShapeTextStyle {\n\t\treturn EShapeTextStyle.NORMAL;\n\t}\n\n\tset style(style: EShapeTextStyle) {\n\t\t// DO NOTHING\n\t}\n\n\tget direction(): EShapeTextDirection {\n\t\treturn EShapeTextDirection.LEFT_TO_RIGHT;\n\t}\n\n\tset direction(direction: EShapeTextDirection) {\n\t\t// DO NOTHING\n\t}\n\n\tget clipping(): boolean {\n\t\treturn false;\n\t}\n\n\tset clipping(clipping: boolean) {\n\t\t// DO NOTHING\n\t}\n\n\tcopy(target?: DeepPartial<EShapeTextLike>): this {\n\t\treturn this;\n\t}\n\n\tset(\n\t\tvalue?: string,\n\t\tcolor?: number,\n\t\talpha?: number,\n\t\tfamily?: string,\n\t\tsize?: number,\n\t\tweight?: EShapeTextWeight,\n\t\tstyle?: EShapeTextStyle,\n\t\tdirection?: EShapeTextDirection,\n\t\tclipping?: boolean\n\t): this {\n\t\treturn this;\n\t}\n\n\ttoObject(): EShapeTextLike {\n\t\treturn {\n\t\t\tvalue: \"\",\n\t\t\tcolor: 0x000000,\n\t\t\talpha: 1.0,\n\t\t\tfamily: \"auto\",\n\t\t\tsize: 24,\n\t\t\tweight: EShapeTextWeight.NORMAL,\n\t\t\talign: this.align.toObject(),\n\t\t\toffset: this.offset.toObject(),\n\t\t\tstyle: EShapeTextStyle.NORMAL,\n\t\t\toutline: this.outline.toObject(),\n\t\t\tspacing: this.spacing.toObject(),\n\t\t\tdirection: EShapeTextDirection.LEFT_TO_RIGHT,\n\t\t\tpadding: this.padding.toObject(),\n\t\t\tclipping: false\n\t\t};\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\treturn -1;\n\t}\n\n\tdeserialize(target: number, manager: EShapeResourceManagerDeserialization): void {\n\t\t//\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { IPoint } from \"pixi.js\";\nimport { EShapeCorner } from \"../e-shape-corner\";\nimport { EShapeDefaults } from \"../e-shape-defaults\";\nimport { EShapeFill } from \"../e-shape-fill\";\nimport { EShapeGradientLike } from \"../e-shape-gradient\";\nimport { EShapePoints } from \"../e-shape-points\";\nimport { EShapeStroke } from \"../e-shape-stroke\";\nimport { EShapeData } from \"../e-shape-data\";\nimport { EShapeText } from \"../e-shape-text\";\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapeBase } from \"./e-shape-base\";\nimport { EShapeGroupFillViewer } from \"./e-shape-group-fill-viewer\";\nimport { EShapeGroupSize } from \"./e-shape-group-size\";\nimport { EShapeGroupSizeEditor } from \"./e-shape-group-size-editor\";\nimport { EShapeGroupSizeViewer } from \"./e-shape-group-size-viewer\";\nimport { EShapeGroupStrokeViewer } from \"./e-shape-group-stroke-viewer\";\nimport { EShapeGroupTextViewer } from \"./e-shape-group-text-viewer\";\nimport { EShapeDataImpl } from \"./e-shape-data-impl\";\n\nexport abstract class EShapeGroupViewer extends EShapeBase {\n\tsize: EShapeGroupSize;\n\tfill: EShapeFill;\n\tstroke: EShapeStroke;\n\t/** @deprecated in favor of {@link data} */\n\ttag: EShapeData;\n\tdata: EShapeData;\n\ttext: EShapeText;\n\n\tprotected _isEditMode: boolean;\n\n\tconstructor(isEditMode: boolean, type: EShapeType) {\n\t\tsuper(type);\n\t\tthis._isEditMode = isEditMode;\n\t\tconst data = this.newData();\n\t\tthis.data = data;\n\t\tthis.tag = data;\n\t\tthis.size = this.newGroupSize(isEditMode);\n\t\tthis.fill = this.newGroupFill();\n\t\tthis.stroke = this.newGroupStroke();\n\t\tthis.text = this.newGroupText();\n\t}\n\n\tget isEditMode(): boolean {\n\t\treturn this._isEditMode;\n\t}\n\n\tprotected newGroupSize(isEditMode: boolean): EShapeGroupSize {\n\t\tconst sizeX = EShapeDefaults.SIZE_X;\n\t\tconst sizeY = EShapeDefaults.SIZE_Y;\n\t\tif (isEditMode) {\n\t\t\treturn new EShapeGroupSizeEditor(this, sizeX, sizeY, this.isGroupSizeFittable());\n\t\t} else {\n\t\t\treturn new EShapeGroupSizeViewer(this, sizeX, sizeY, sizeX, sizeY);\n\t\t}\n\t}\n\n\tprotected isGroupSizeFittable(): boolean {\n\t\treturn true;\n\t}\n\n\tprotected newData(): EShapeData {\n\t\treturn new EShapeDataImpl();\n\t}\n\n\tprotected newGroupFill(): EShapeFill {\n\t\treturn new EShapeGroupFillViewer();\n\t}\n\n\tprotected newGroupStroke(): EShapeStroke {\n\t\treturn new EShapeGroupStrokeViewer();\n\t}\n\n\tprotected newGroupText(): EShapeText {\n\t\treturn new EShapeGroupTextViewer();\n\t}\n\n\tprotected getBoundsSize(): IPoint {\n\t\tconst size = this.size;\n\t\tif (size instanceof EShapeGroupSizeViewer) {\n\t\t\treturn size.base;\n\t\t} else {\n\t\t\treturn size;\n\t\t}\n\t}\n\n\tonChildTransformChange(): void {\n\t\tsuper.onChildTransformChange();\n\t\tthis.size.fit();\n\t}\n\n\tget corner(): EShapeCorner {\n\t\treturn EShapeCorner.NONE;\n\t}\n\n\tset corner(corner: EShapeCorner) {\n\t\t// DO NOTHING\n\t}\n\n\tget cursor(): string {\n\t\treturn \"\";\n\t}\n\n\tset cursor(cursor: string) {\n\t\t// DO NOTHING\n\t}\n\n\tget gradient(): EShapeGradientLike | undefined {\n\t\treturn undefined;\n\t}\n\n\tset gradient(gradient: EShapeGradientLike | undefined) {\n\t\t// DO NOTHING\n\t}\n\n\tget radius(): number {\n\t\treturn 0;\n\t}\n\n\tset radius(radius: number) {\n\t\t// DO NOTHING\n\t}\n\n\tget image(): HTMLImageElement | undefined {\n\t\treturn undefined;\n\t}\n\n\tset image(image: HTMLImageElement | undefined) {\n\t\t// DO NOTHING\n\t}\n\n\tget points(): EShapePoints | undefined {\n\t\treturn undefined;\n\t}\n\n\tset points(points: EShapePoints | undefined) {\n\t\t// DO NOTHING\n\t}\n\n\tabstract clone(): EShapeGroupViewer;\n\n\tcontainsAbs(\n\t\tx: number,\n\t\ty: number,\n\t\tax: number,\n\t\tay: number,\n\t\tsw: number,\n\t\tss: number,\n\t\tsa: number\n\t): boolean {\n\t\treturn false;\n\t}\n}\n","import { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShapeText } from \"../e-shape-text\";\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapeGroupTextEditor } from \"./e-shape-group-text-editor\";\nimport { EShapeGroupViewer } from \"./e-shape-group-viewer\";\n\nexport class EShapeEmbedded extends EShapeGroupViewer {\n\tprotected _name: string;\n\n\tconstructor(name: string, isEditMode: boolean, type: EShapeType = EShapeType.EMBEDDED) {\n\t\tsuper(isEditMode, type);\n\t\tthis._name = name;\n\t}\n\n\tget name(): string {\n\t\treturn this._name;\n\t}\n\n\tprotected newGroupText(): EShapeText {\n\t\treturn new EShapeGroupTextEditor(this);\n\t}\n\n\tprotected isGroupSizeFittable(): boolean {\n\t\treturn false;\n\t}\n\n\tclone(): EShapeEmbedded {\n\t\tconst result = this.newClone().copy(this);\n\t\tconst children = this.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tconst clone = children[i].clone();\n\t\t\tclone.parent = result;\n\t\t\tresult.children.push(clone);\n\t\t}\n\t\tresult.onChildTransformChange();\n\t\tresult.toDirty();\n\t\treturn result;\n\t}\n\n\tprotected newClone(): EShapeEmbedded {\n\t\tconst constructor = this.constructor as typeof EShapeEmbedded;\n\t\treturn new constructor(this._name, this._isEditMode, this.type);\n\t}\n\n\tserializeChildren(manager: EShapeResourceManagerSerialization): DDiagramSerializedItem[] {\n\t\treturn [];\n\t}\n\n\tserializeImage(manager: EShapeResourceManagerSerialization): number {\n\t\treturn -1;\n\t}\n\n\tserializeGradient(manager: EShapeResourceManagerSerialization): number {\n\t\treturn -1;\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): DDiagramSerializedItem {\n\t\tconst result = super.serialize(manager);\n\t\tresult[15] = manager.addPiece(this._name);\n\t\treturn result;\n\t}\n\n\taddUuid(manager: EShapeResourceManagerSerialization): void {\n\t\tthis.uuid = manager.addUuid(this.uuid);\n\t}\n\n\tupdateUuid(manager: EShapeResourceManagerSerialization): void {\n\t\tthis.uuid = manager.updateUuid(this.uuid);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const EShapeLayerState = {\n\tINVISIBLE: \"INVISIBLE\", // Invisible initially when non-edit mode\n\tINTERACTIVE: \"INTERACTIVE\",\n\tDRAGGABLE: \"DRAGGABLE\",\n\tPINCHABLE: \"PINCHABLE\"\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDiagramSerializedItem, DDiagramSerializedLayer } from \"../../d-diagram-serialized\";\nimport { isString } from \"../../util/is-string\";\nimport { EShapeActionValueMiscGestureType } from \"../action/e-shape-action-value-misc-gesture-type\";\nimport { EShapeActionValueMiscLayerGesture } from \"../action/e-shape-action-value-misc-layer-gesture\";\nimport { EShapeFill } from \"../e-shape-fill\";\nimport { EShapeLayer } from \"../e-shape-layer\";\nimport { EShapeLayerState } from \"../e-shape-layer-state\";\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapeFillImpl } from \"./e-shape-fill-impl\";\nimport { EShapeGroupViewer } from \"./e-shape-group-viewer\";\n\nexport class EShapeEmbeddedLayer extends EShapeGroupViewer implements EShapeLayer {\n\tprotected _name: string;\n\n\tconstructor(name: string, isEditMode: boolean, type: EShapeType = EShapeType.EMBEDDED_LAYER) {\n\t\tsuper(isEditMode, type);\n\t\tthis._name = name;\n\t}\n\n\tget name(): string {\n\t\treturn this._name;\n\t}\n\n\tprotected newGroupFill(): EShapeFill {\n\t\treturn new EShapeFillImpl(this, false, 0xffffff, 1);\n\t}\n\n\tprotected isGroupSizeFittable(): boolean {\n\t\treturn false;\n\t}\n\n\tclone(): EShapeEmbeddedLayer {\n\t\tconst result = this.newClone().copy(this);\n\t\tconst children = this.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tconst clone = children[i].clone();\n\t\t\tclone.parent = result;\n\t\t\tresult.children.push(clone);\n\t\t}\n\t\tresult.onChildTransformChange();\n\t\tresult.toDirty();\n\t\tresult.size.init();\n\t\treturn result;\n\t}\n\n\tprotected newClone(): EShapeEmbeddedLayer {\n\t\tconst constructor = this.constructor as typeof EShapeEmbeddedLayer;\n\t\treturn new constructor(this._name, this._isEditMode, this.type);\n\t}\n\n\tserializeChildren(manager: EShapeResourceManagerSerialization): DDiagramSerializedItem[] {\n\t\treturn [];\n\t}\n\n\tserializeImage(manager: EShapeResourceManagerSerialization): number {\n\t\treturn -1;\n\t}\n\n\tserializeGradient(manager: EShapeResourceManagerSerialization): number {\n\t\treturn -1;\n\t}\n\n\tstatic deserialize(\n\t\tserialized: DDiagramSerializedLayer,\n\t\tmanager: EShapeResourceManagerDeserialization,\n\t\twidth: number,\n\t\theight: number\n\t): EShapeEmbeddedLayer {\n\t\tconst result = new EShapeEmbeddedLayer(\n\t\t\tthis.deserializeName(serialized[0], manager),\n\t\t\tmanager.isEditMode\n\t\t);\n\n\t\tconst visibility = serialized[1];\n\t\tconst visible = visibility == null || !!(visibility & 0x2);\n\t\tif (!visible) {\n\t\t\tresult.visible = false;\n\t\t\tresult.state.add(EShapeLayerState.INVISIBLE);\n\t\t}\n\n\t\tconst positionX = -0.5 * width + (serialized[2] || 0);\n\t\tconst positionY = -0.5 * height + (serialized[3] || 0);\n\t\tresult.transform.position.set(positionX, positionY);\n\n\t\tconst sizeX = serialized[4] ?? width;\n\t\tconst sizeY = serialized[5] ?? height;\n\t\tresult.size.set(sizeX, sizeY);\n\n\t\tconst fillId = serialized[6];\n\t\tif (fillId != null) {\n\t\t\tresult.fill.deserialize(fillId, manager);\n\t\t}\n\n\t\tif (!manager.isEditMode) {\n\t\t\tconst state = serialized[7] ?? 1;\n\t\t\tconst isInteractive = state & 0x1;\n\t\t\tconst isDraggable = state & 0x2;\n\t\t\tconst isPinchable = state & 0x4;\n\t\t\tif (isDraggable || isPinchable) {\n\t\t\t\tconst gestureType =\n\t\t\t\t\t(isDraggable\n\t\t\t\t\t\t? EShapeActionValueMiscGestureType.DRAG\n\t\t\t\t\t\t: EShapeActionValueMiscGestureType.NONE) |\n\t\t\t\t\t(isPinchable\n\t\t\t\t\t\t? EShapeActionValueMiscGestureType.PINCH\n\t\t\t\t\t\t: EShapeActionValueMiscGestureType.NONE);\n\t\t\t\tresult.action.add(new EShapeActionValueMiscLayerGesture(\"\", gestureType));\n\t\t\t}\n\t\t\tif (isInteractive || isDraggable || isPinchable) {\n\t\t\t\tresult.interactive = true;\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tstatic deserializeName(\n\t\ttarget: string | number,\n\t\tmanager: EShapeResourceManagerDeserialization\n\t): string {\n\t\tif (isString(target)) {\n\t\t\treturn target;\n\t\t} else {\n\t\t\tconst resources = manager.resources;\n\t\t\tif (0 <= target && target <= resources.length) {\n\t\t\t\treturn resources[target];\n\t\t\t}\n\t\t\treturn \"\";\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapePrimitive } from \"./e-shape-primitive\";\nimport { hitTestRectangle } from \"./hit-test-rectangle\";\n\nexport class EShapeRectangle extends EShapePrimitive {\n\tconstructor(type: EShapeType = EShapeType.RECTANGLE) {\n\t\tsuper(type);\n\t}\n\n\tclone(): EShapeRectangle {\n\t\treturn new EShapeRectangle(this.type).copy(this);\n\t}\n\n\tcontainsAbs(\n\t\tx: number,\n\t\ty: number,\n\t\tax: number,\n\t\tay: number,\n\t\tsw: number,\n\t\tss: number,\n\t\tsa: number\n\t): boolean {\n\t\tif (super.containsAbsBBox(x, y, ax, ay)) {\n\t\t\treturn hitTestRectangle(this, x, y, ax, ay, sw, ss);\n\t\t}\n\t\treturn false;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\nimport { EShapeLayerContainer } from \"../e-shape-layer-container\";\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { deserializeBase } from \"./deserialize-base\";\nimport { EShapeEmbedded } from \"./e-shape-embedded\";\nimport { EShapeEmbeddedLayer } from \"./e-shape-embedded-layer\";\nimport { EShapeRectangle } from \"./e-shape-rectangle\";\n\nconst create = (\n\tname: string,\n\twidth: number,\n\theight: number,\n\tcontainer: EShapeLayerContainer,\n\tmanager: EShapeResourceManagerDeserialization,\n\titem: DDiagramSerializedItem\n): Promise<EShapeEmbedded> | EShapeEmbedded => {\n\tconst shape = new EShapeEmbedded(name, manager.isEditMode);\n\tconst result = deserializeBase(item, manager, shape);\n\tconst shapeSize = shape.size;\n\tconst sizeX = shapeSize.x;\n\tconst sizeY = shapeSize.y;\n\tshape.size.set(width, height);\n\tcontainer.copyTo(shape);\n\tshape.size.init();\n\tshape.size.set(sizeX, sizeY);\n\treturn result;\n};\n\nconst createMissing = (\n\tname: string,\n\tmanager: EShapeResourceManagerDeserialization,\n\titem: DDiagramSerializedItem\n): Promise<EShapeEmbedded> | EShapeEmbedded => {\n\tconst shape = new EShapeEmbedded(name, manager.isEditMode);\n\tconst result = deserializeBase(item, manager, shape);\n\n\tconst size = shape.size;\n\tconst sizeX = size.x;\n\tconst sizeY = size.y;\n\n\tconst children = shape.children;\n\tconst layer = new EShapeEmbeddedLayer(\"missing\", manager.isEditMode);\n\tconst px = 0.5 * sizeX;\n\tconst py = 0.5 * sizeX;\n\tlayer.transform.position.set(-px, -py);\n\tlayer.size.set(sizeX, sizeY);\n\tlayer.parent = shape;\n\n\tconst rectangle = new EShapeRectangle();\n\trectangle.stroke.color = 0xff0000;\n\trectangle.transform.position.set(px, py);\n\trectangle.size.copyFrom(shape.size);\n\trectangle.attach(layer);\n\n\tchildren.push(layer);\n\tshape.onChildTransformChange();\n\tshape.toDirty();\n\tshape.onAttach();\n\n\tshape.size.init();\n\treturn result;\n};\n\nexport const deserializeEmbedded = (\n\titem: DDiagramSerializedItem,\n\tmanager: EShapeResourceManagerDeserialization\n): Promise<EShapeEmbedded> | EShapeEmbedded | null => {\n\tconst pieces = manager.pieces;\n\tconst pieceId = item[15];\n\tif (pieces && 0 <= pieceId && pieceId < pieces.length) {\n\t\tconst pieceData = manager.pieceData;\n\t\tif (pieceData) {\n\t\t\tconst piece = pieces[pieceId];\n\t\t\tconst pieceDatum = pieceData.get(piece);\n\t\t\tif (pieceDatum) {\n\t\t\t\treturn create(\n\t\t\t\t\tpiece,\n\t\t\t\t\tpieceDatum.width,\n\t\t\t\t\tpieceDatum.height,\n\t\t\t\t\tpieceDatum.layer,\n\t\t\t\t\tmanager,\n\t\t\t\t\titem\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\treturn createMissing(piece, manager, item);\n\t\t\t}\n\t\t}\n\t}\n\treturn null;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeCapabilities } from \"../e-shape-capabilities\";\nimport { EShapeCapability } from \"../e-shape-capability\";\nimport { EShapeDeserializers } from \"../e-shape-deserializers\";\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapeUploadeds } from \"../e-shape-uploadeds\";\nimport { createRectanglePivotedUploaded } from \"../variant/create-rectangle-pivoted-uploaded\";\nimport { createGroupUploaded } from \"../variant/create-group-uploaded\";\nimport { deserializeEmbedded } from \"../variant/deserialize-embedded\";\n\nexport const loadShapeEmbedded = (): void => {\n\tEShapeUploadeds[EShapeType.EMBEDDED] = createGroupUploaded;\n\tEShapeDeserializers[EShapeType.EMBEDDED] = deserializeEmbedded;\n\tEShapeCapabilities.set(EShapeType.EMBEDDED, EShapeCapability.EMBEDDED);\n\n\tEShapeUploadeds[EShapeType.EMBEDDED_LAYER] = createRectanglePivotedUploaded;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeFill, EShapeFillLike } from \"../e-shape-fill\";\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShapeGroupPropertyParent } from \"./e-shape-group-property-parent\";\n\nexport class EShapeGroupFillEditor implements EShapeFill {\n\tprotected _parent: EShapeGroupPropertyParent;\n\n\tconstructor(parent: EShapeGroupPropertyParent) {\n\t\tthis._parent = parent;\n\t}\n\n\tget enable(): boolean {\n\t\tconst children = this._parent.children;\n\t\tif (0 < children.length) {\n\t\t\treturn children[children.length - 1].fill.enable;\n\t\t}\n\t\treturn true;\n\t}\n\n\tset enable(enable: boolean) {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].fill.enable = enable;\n\t\t}\n\t}\n\n\tget color(): number {\n\t\tconst children = this._parent.children;\n\t\tif (0 < children.length) {\n\t\t\treturn children[children.length - 1].fill.color;\n\t\t}\n\t\treturn 0xffffff;\n\t}\n\n\tset color(color: number) {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].fill.color = color;\n\t\t}\n\t}\n\n\tget alpha(): number {\n\t\tconst children = this._parent.children;\n\t\tif (0 < children.length) {\n\t\t\treturn children[children.length - 1].fill.alpha;\n\t\t}\n\t\treturn 1.0;\n\t}\n\n\tset alpha(alpha: number) {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].fill.alpha = alpha;\n\t\t}\n\t}\n\n\tcopy(target?: Partial<EShapeFillLike>): void {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].fill.copy(target);\n\t\t}\n\t}\n\n\tset(enable: boolean, color: number, alpha: number): void {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].fill.set(enable, color, alpha);\n\t\t}\n\t}\n\n\tclone(): EShapeGroupFillEditor {\n\t\treturn new EShapeGroupFillEditor(this._parent);\n\t}\n\n\ttoObject(): EShapeFillLike {\n\t\tconst children = this._parent.children;\n\t\tif (0 < children.length) {\n\t\t\treturn children[children.length - 1].fill.toObject();\n\t\t}\n\t\treturn {\n\t\t\tenable: true,\n\t\t\tcolor: 0xffffff,\n\t\t\talpha: 1.0\n\t\t};\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\treturn -1;\n\t}\n\n\tdeserialize(target: number, manager: EShapeResourceManagerDeserialization): void {\n\t\t// DO NOTHING\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Matrix, Point } from \"pixi.js\";\nimport { EShape } from \"../e-shape\";\nimport { EShapePoints } from \"../e-shape-points\";\nimport { EShapePointsFormatted } from \"../e-shape-points-formatted\";\nimport { EShapePointsFormatter } from \"../e-shape-points-formatter\";\nimport { EShapePointsMarkerContainer } from \"../e-shape-points-marker-container\";\nimport { EShapePointsMarkerContainerImplNoop } from \"../e-shape-points-marker-container-impl-noop\";\nimport { EShapePointsStyle } from \"../e-shape-points-style\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShapeGroupPropertyParent } from \"./e-shape-group-property-parent\";\n\nexport class EShapeGroupPoints implements EShapePoints {\n\tprotected _parent: EShapeGroupPropertyParent;\n\n\tconstructor(parent: EShapeGroupPropertyParent) {\n\t\tthis._parent = parent;\n\t}\n\n\tget length(): number {\n\t\tconst children = this._parent.children;\n\t\tif (0 < children.length) {\n\t\t\tconst points = children[children.length - 1].points;\n\t\t\tif (points != null) {\n\t\t\t\treturn points.length;\n\t\t\t}\n\t\t}\n\t\treturn 0;\n\t}\n\n\tget id(): number {\n\t\tconst children = this._parent.children;\n\t\tif (0 < children.length) {\n\t\t\tconst points = children[children.length - 1].points;\n\t\t\tif (points != null) {\n\t\t\t\treturn points.id;\n\t\t\t}\n\t\t}\n\t\treturn 0;\n\t}\n\n\tget values(): number[] {\n\t\tconst children = this._parent.children;\n\t\tif (0 < children.length) {\n\t\t\tconst points = children[children.length - 1].points;\n\t\t\tif (points != null) {\n\t\t\t\treturn points.values;\n\t\t\t}\n\t\t}\n\t\treturn [];\n\t}\n\n\tset values(values: number[]) {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tconst points = children[i].points;\n\t\t\tif (points != null) {\n\t\t\t\tpoints.values = values;\n\t\t\t}\n\t\t}\n\t}\n\n\tget segments(): number[] {\n\t\tconst children = this._parent.children;\n\t\tif (0 < children.length) {\n\t\t\tconst points = children[children.length - 1].points;\n\t\t\tif (points != null) {\n\t\t\t\treturn points.segments;\n\t\t\t}\n\t\t}\n\t\treturn [];\n\t}\n\n\tset segments(segments: number[]) {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tconst points = children[i].points;\n\t\t\tif (points != null) {\n\t\t\t\tpoints.segments = segments;\n\t\t\t}\n\t\t}\n\t}\n\n\tget style(): EShapePointsStyle {\n\t\tconst children = this._parent.children;\n\t\tif (0 < children.length) {\n\t\t\tconst points = children[children.length - 1].points;\n\t\t\tif (points != null) {\n\t\t\t\treturn points.style;\n\t\t\t}\n\t\t}\n\t\treturn EShapePointsStyle.NONE;\n\t}\n\n\tset style(style: EShapePointsStyle) {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tconst points = children[i].points;\n\t\t\tif (points != null) {\n\t\t\t\tpoints.style = style;\n\t\t\t}\n\t\t}\n\t}\n\n\tget marker(): EShapePointsMarkerContainer {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tconst points = children[i].points;\n\t\t\tif (points != null) {\n\t\t\t\treturn points.marker;\n\t\t\t}\n\t\t}\n\t\treturn EShapePointsMarkerContainerImplNoop.getInstance();\n\t}\n\n\tgetMarker(): EShapePointsMarkerContainer | undefined {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tconst points = children[i].points;\n\t\t\tif (points != null) {\n\t\t\t\treturn points.getMarker();\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tget formatter(): EShapePointsFormatter | null {\n\t\tconst children = this._parent.children;\n\t\tif (0 < children.length) {\n\t\t\tconst points = children[children.length - 1].points;\n\t\t\tif (points != null) {\n\t\t\t\treturn points.formatter;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tset formatter(formatter: EShapePointsFormatter | null) {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tconst points = children[i].points;\n\t\t\tif (points != null) {\n\t\t\t\tpoints.formatter = formatter;\n\t\t\t}\n\t\t}\n\t}\n\n\tget formatted(): EShapePointsFormatted {\n\t\tconst children = this._parent.children;\n\t\tif (0 < children.length) {\n\t\t\tconst points = children[children.length - 1].points;\n\t\t\tif (points != null) {\n\t\t\t\treturn points.formatted;\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n\n\tcopy(source: EShapePoints): this {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tconst points = children[i].points;\n\t\t\tif (points != null) {\n\t\t\t\tpoints.copy(source);\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n\n\tset(values?: number[], segments?: number[], style?: EShapePointsStyle): this {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tconst points = children[i].points;\n\t\t\tif (points != null) {\n\t\t\t\tpoints.set(values, segments, style);\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n\n\tclone(parent: EShape): EShapeGroupPoints {\n\t\treturn new EShapeGroupPoints(parent);\n\t}\n\n\ttoPoints(transform: Matrix): Point[] {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tconst points = children[i].points;\n\t\t\tif (points != null) {\n\t\t\t\treturn points.toPoints(transform);\n\t\t\t}\n\t\t}\n\t\treturn [];\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tconst points = children[i].points;\n\t\t\tif (points != null) {\n\t\t\t\treturn points.serialize(manager);\n\t\t\t}\n\t\t}\n\t\treturn -1;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShapeStroke, EShapeStrokeLike } from \"../e-shape-stroke\";\nimport { EShapeStrokeSide } from \"../e-shape-stroke-side\";\nimport { EShapeStrokeStyle } from \"../e-shape-stroke-style\";\nimport { EShapeGroupPropertyParent } from \"./e-shape-group-property-parent\";\n\nexport class EShapeGroupStrokeEditor implements EShapeStroke {\n\tprotected _parent: EShapeGroupPropertyParent;\n\n\tconstructor(parent: EShapeGroupPropertyParent) {\n\t\tthis._parent = parent;\n\t}\n\n\tget enable(): boolean {\n\t\tconst children = this._parent.children;\n\t\tif (0 < children.length) {\n\t\t\treturn children[children.length - 1].stroke.enable;\n\t\t}\n\t\treturn false;\n\t}\n\n\tset enable(enable: boolean) {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].stroke.enable = enable;\n\t\t}\n\t}\n\n\tget color(): number {\n\t\tconst children = this._parent.children;\n\t\tif (0 < children.length) {\n\t\t\treturn children[children.length - 1].stroke.color;\n\t\t}\n\t\treturn 0xffffff;\n\t}\n\n\tset color(color: number) {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].stroke.color = color;\n\t\t}\n\t}\n\n\tget alpha(): number {\n\t\tconst children = this._parent.children;\n\t\tif (0 < children.length) {\n\t\t\treturn children[children.length - 1].stroke.alpha;\n\t\t}\n\t\treturn 1.0;\n\t}\n\n\tset alpha(alpha: number) {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].stroke.alpha = alpha;\n\t\t}\n\t}\n\n\tget width(): number {\n\t\tconst children = this._parent.children;\n\t\tif (0 < children.length) {\n\t\t\treturn children[children.length - 1].stroke.width;\n\t\t}\n\t\treturn 1.0;\n\t}\n\n\tset width(width: number) {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].stroke.width = width;\n\t\t}\n\t}\n\n\tget align(): number {\n\t\tconst children = this._parent.children;\n\t\tif (0 < children.length) {\n\t\t\treturn children[children.length - 1].stroke.align;\n\t\t}\n\t\treturn 1.0;\n\t}\n\n\tset align(align: number) {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].stroke.align = align;\n\t\t}\n\t}\n\n\tget side(): EShapeStrokeSide {\n\t\tconst children = this._parent.children;\n\t\tif (0 < children.length) {\n\t\t\treturn children[children.length - 1].stroke.side;\n\t\t}\n\t\treturn 1.0;\n\t}\n\n\tset side(side: EShapeStrokeSide) {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].stroke.side = side;\n\t\t}\n\t}\n\n\tget style(): EShapeStrokeStyle {\n\t\tconst children = this._parent.children;\n\t\tif (0 < children.length) {\n\t\t\treturn children[children.length - 1].stroke.style;\n\t\t}\n\t\treturn EShapeStrokeStyle.NONE;\n\t}\n\n\tset style(style: EShapeStrokeStyle) {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].stroke.style = style;\n\t\t}\n\t}\n\n\tcopy(target?: Partial<EShapeStrokeLike>): void {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].stroke.copy(target);\n\t\t}\n\t}\n\n\tset(\n\t\tenable: boolean,\n\t\tcolor: number,\n\t\talpha: number,\n\t\twidth: number,\n\t\tside: EShapeStrokeSide\n\t): void {\n\t\tconst children = this._parent.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].stroke.set(enable, color, alpha, width, side);\n\t\t}\n\t}\n\n\tclone(): EShapeGroupStrokeEditor {\n\t\treturn new EShapeGroupStrokeEditor(this._parent);\n\t}\n\n\ttoObject(): EShapeStrokeLike {\n\t\tconst children = this._parent.children;\n\t\tif (0 < children.length) {\n\t\t\treturn children[children.length - 1].stroke.toObject();\n\t\t}\n\t\treturn {\n\t\t\tenable: false,\n\t\t\tcolor: 0xffffff,\n\t\t\talpha: 1.0,\n\t\t\twidth: 1.0,\n\t\t\talign: 0.0,\n\t\t\tside: EShapeStrokeSide.NONE,\n\t\t\tstyle: EShapeStrokeStyle.NONE\n\t\t};\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\treturn -1;\n\t}\n\n\tdeserialize(target: number, manager: EShapeResourceManagerDeserialization): void {\n\t\t//\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { IPoint } from \"pixi.js\";\nimport { EShapeCorner } from \"../e-shape-corner\";\nimport { EShapeDefaults } from \"../e-shape-defaults\";\nimport { EShapeFill } from \"../e-shape-fill\";\nimport { EShapeGradientLike } from \"../e-shape-gradient\";\nimport { EShapePoints } from \"../e-shape-points\";\nimport { EShapeStroke } from \"../e-shape-stroke\";\nimport { EShapeData } from \"../e-shape-data\";\nimport { EShapeText } from \"../e-shape-text\";\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapeBase } from \"./e-shape-base\";\nimport { EShapeGroupFillEditor } from \"./e-shape-group-fill-editor\";\nimport { EShapeGroupPoints } from \"./e-shape-group-points\";\nimport { EShapeGroupPropertyParent } from \"./e-shape-group-property-parent\";\nimport { EShapeGroupSize } from \"./e-shape-group-size\";\nimport { EShapeGroupSizeEditor } from \"./e-shape-group-size-editor\";\nimport { EShapeGroupSizeViewer } from \"./e-shape-group-size-viewer\";\nimport { EShapeGroupStrokeEditor } from \"./e-shape-group-stroke-editor\";\nimport { EShapeGroupTextEditor } from \"./e-shape-group-text-editor\";\nimport { EShapeDataImpl } from \"./e-shape-data-impl\";\n\nexport class EShapeGroup extends EShapeBase implements EShapeGroupPropertyParent {\n\tsize: EShapeGroupSize;\n\tfill: EShapeFill;\n\tstroke: EShapeStroke;\n\t/** @deprecated in favor of {@link data} */\n\ttag: EShapeData;\n\tdata: EShapeData;\n\ttext: EShapeText;\n\n\tprotected _isEditMode: boolean;\n\tprotected _points?: EShapePoints;\n\n\tconstructor(isEditMode: boolean, type: EShapeType = EShapeType.GROUP) {\n\t\tsuper(type);\n\t\tthis._isEditMode = isEditMode;\n\t\tconst data = new EShapeDataImpl();\n\t\tthis.data = data;\n\t\tthis.tag = data;\n\t\tthis.size = this.newGroupSize(isEditMode);\n\t\tthis.fill = this.newGroupFill();\n\t\tthis.stroke = this.newGroupStroke();\n\t\tthis.text = this.newGroupText();\n\t\tthis._points = this.newGroupPoints();\n\t}\n\n\tget isEditMode(): boolean {\n\t\treturn this._isEditMode;\n\t}\n\n\tprotected newGroupSize(isEditMode: boolean): EShapeGroupSize {\n\t\tconst sizeX = EShapeDefaults.SIZE_X;\n\t\tconst sizeY = EShapeDefaults.SIZE_Y;\n\t\tif (isEditMode) {\n\t\t\treturn new EShapeGroupSizeEditor(this, sizeX, sizeY, this.isGroupSizeFittable());\n\t\t} else {\n\t\t\treturn new EShapeGroupSizeViewer(this, sizeX, sizeY, sizeX, sizeY);\n\t\t}\n\t}\n\n\tprotected isGroupSizeFittable(): boolean {\n\t\treturn true;\n\t}\n\n\tprotected newGroupFill(): EShapeFill {\n\t\treturn new EShapeGroupFillEditor(this);\n\t}\n\n\tprotected newGroupStroke(): EShapeStroke {\n\t\treturn new EShapeGroupStrokeEditor(this);\n\t}\n\n\tprotected newGroupText(): EShapeText {\n\t\treturn new EShapeGroupTextEditor(this);\n\t}\n\n\tprotected newGroupPoints(): EShapePoints | undefined {\n\t\treturn new EShapeGroupPoints(this);\n\t}\n\n\tprotected getBoundsSize(): IPoint {\n\t\tconst size = this.size;\n\t\tif (size instanceof EShapeGroupSizeViewer) {\n\t\t\treturn size.base;\n\t\t} else {\n\t\t\treturn size;\n\t\t}\n\t}\n\n\tonChildTransformChange(): void {\n\t\tsuper.onChildTransformChange();\n\t\tthis.size.fit();\n\t}\n\n\tget corner(): EShapeCorner {\n\t\tconst children = this.children;\n\t\tif (0 < children.length) {\n\t\t\treturn children[children.length - 1].corner;\n\t\t}\n\t\treturn EShapeCorner.ALL;\n\t}\n\n\tset corner(corner: EShapeCorner) {\n\t\tconst children = this.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].corner = corner;\n\t\t}\n\t}\n\n\tget cursor(): string {\n\t\tconst children = this.children;\n\t\tif (0 < children.length) {\n\t\t\treturn children[children.length - 1].cursor;\n\t\t}\n\t\treturn \"\";\n\t}\n\n\tset cursor(cursor: string) {\n\t\tconst children = this.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].cursor = cursor;\n\t\t}\n\t}\n\n\tget gradient(): EShapeGradientLike | undefined {\n\t\tconst children = this.children;\n\t\tfor (let i = children.length - 1; 0 <= i; --i) {\n\t\t\tconst gradient = children[i].gradient;\n\t\t\tif (gradient != null) {\n\t\t\t\treturn gradient;\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tset gradient(gradient: EShapeGradientLike | undefined) {\n\t\tconst children = this.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].gradient = gradient;\n\t\t}\n\t}\n\n\tget radius(): number {\n\t\tconst children = this.children;\n\t\tif (0 < children.length) {\n\t\t\treturn children[children.length - 1].radius;\n\t\t}\n\t\treturn 0.5;\n\t}\n\n\tset radius(radius: number) {\n\t\tconst children = this.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].radius = radius;\n\t\t}\n\t}\n\n\tget image(): HTMLImageElement | undefined {\n\t\tconst children = this.children;\n\t\tfor (let i = children.length - 1; 0 <= i; --i) {\n\t\t\tconst image = children[i].image;\n\t\t\tif (image != null) {\n\t\t\t\treturn image;\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tset image(image: HTMLImageElement | undefined) {\n\t\tconst children = this.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].image = image;\n\t\t}\n\t}\n\n\tget points(): EShapePoints | undefined {\n\t\tconst children = this.children;\n\t\tfor (let i = children.length - 1; 0 <= i; --i) {\n\t\t\tconst points = children[i].points;\n\t\t\tif (points != null) {\n\t\t\t\treturn this._points;\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tset points(points: EShapePoints | undefined) {\n\t\t// DO NOTHING\n\t}\n\n\tclone(): EShapeGroup {\n\t\tconst result = this.newClone().copy(this);\n\t\tconst children = this.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tconst clone = children[i].clone();\n\t\t\tclone.parent = result;\n\t\t\tresult.children.push(clone);\n\t\t}\n\t\tresult.onChildTransformChange();\n\t\tresult.toDirty();\n\t\treturn result;\n\t}\n\n\tprotected newClone(): EShapeGroup {\n\t\tconst constructor = this.constructor as typeof EShapeGroup;\n\t\treturn new constructor(this._isEditMode, this.type);\n\t}\n\n\tcontainsAbs(\n\t\tx: number,\n\t\ty: number,\n\t\tax: number,\n\t\tay: number,\n\t\tsw: number,\n\t\tss: number,\n\t\tsa: number\n\t): boolean {\n\t\treturn false;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { deserializeBase } from \"./deserialize-base\";\nimport { EShapeGroup } from \"./e-shape-group\";\n\nexport const deserializeGroup = (\n\titem: DDiagramSerializedItem,\n\tmanager: EShapeResourceManagerDeserialization,\n\tshape?: EShapeGroup\n): Promise<EShapeGroup> | EShapeGroup => {\n\tshape = shape || new EShapeGroup(manager.isEditMode);\n\tconst result = deserializeBase(item, manager, shape);\n\tshape.size.init();\n\treturn result;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeDeserializers } from \"../e-shape-deserializers\";\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapeUploadeds } from \"../e-shape-uploadeds\";\nimport { createGroupUploaded } from \"../variant/create-group-uploaded\";\nimport { deserializeGroup } from \"../variant/deserialize-group\";\n\nexport const loadShapeGroup = (): void => {\n\tEShapeUploadeds[EShapeType.GROUP] = createGroupUploaded;\n\tEShapeDeserializers[EShapeType.GROUP] = deserializeGroup;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { IPoint, Point } from \"pixi.js\";\nimport { EShapeGroupSize } from \"./e-shape-group-size\";\nimport { EShapeGroupSizeParent } from \"./e-shape-group-size-parent\";\n\nexport class EShapeGroupSizeShadowed implements EShapeGroupSize {\n\tprotected _parent: EShapeGroupSizeParent;\n\tprotected _size: Point;\n\n\tconstructor(parent: EShapeGroupSizeParent, x: number, y: number) {\n\t\tthis._parent = parent;\n\t\tthis._size = new Point(x, y);\n\t}\n\n\tinit(): void {\n\t\t// DO NOTHING\n\t}\n\n\tget x(): number {\n\t\treturn this._size.x;\n\t}\n\n\tset x(x: number) {\n\t\tconst size = this._size;\n\t\tif (size.x !== x) {\n\t\t\tconst ox = size.x;\n\t\t\tsize.x = x;\n\t\t\tthis.onChange(ox, size.y);\n\t\t}\n\t}\n\n\tget y(): number {\n\t\treturn this._size.y;\n\t}\n\n\tset y(y: number) {\n\t\tconst size = this._size;\n\t\tif (size.y !== y) {\n\t\t\tconst oy = size.y;\n\t\t\tsize.y = y;\n\t\t\tthis.onChange(size.x, oy);\n\t\t}\n\t}\n\n\tset(x?: number | undefined, y?: number | undefined): this {\n\t\tlet isChanged = false;\n\t\tconst size = this._size;\n\t\tconst ox = size.x;\n\t\tconst oy = size.y;\n\t\tif (x != null && ox !== x) {\n\t\t\tisChanged = true;\n\t\t\tsize.x = x;\n\t\t}\n\t\tif (y != null && oy !== y) {\n\t\t\tisChanged = true;\n\t\t\tsize.y = y;\n\t\t}\n\t\tif (isChanged) {\n\t\t\tthis.onChange(ox, oy);\n\t\t}\n\t\treturn this;\n\t}\n\n\tclone(): EShapeGroupSizeShadowed {\n\t\tconst size = this._size;\n\t\treturn new EShapeGroupSizeShadowed(this._parent, size.x, size.y);\n\t}\n\n\tcopy(): void {\n\t\t// DO NOTHING\n\t}\n\n\tcopyFrom(point: IPoint): this {\n\t\tconst x = point.x;\n\t\tconst y = point.y;\n\t\tconst size = this._size;\n\t\tconst ox = size.x;\n\t\tconst oy = size.y;\n\t\tif (ox !== x || oy !== y) {\n\t\t\tsize.x = x;\n\t\t\tsize.y = y;\n\t\t\tthis.onChange(ox, oy);\n\t\t}\n\t\treturn this;\n\t}\n\n\tcopyTo(point: IPoint): IPoint {\n\t\treturn this._size.copyTo(point);\n\t}\n\n\tequals(point: IPoint): boolean {\n\t\treturn this._size.equals(point);\n\t}\n\n\tfit(): void {\n\t\t// DO NOTHING\n\t}\n\n\tprotected onChange(ox: number, oy: number): void {\n\t\tthis._parent.onSizeChange();\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeDefaults } from \"../e-shape-defaults\";\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapeGroup } from \"./e-shape-group\";\nimport { EShapeGroupSize } from \"./e-shape-group-size\";\nimport { EShapeGroupSizeShadowed } from \"./e-shape-group-size-shadowed\";\n\nexport class EShapeGroupShadowed extends EShapeGroup {\n\tconstructor(isEditMode: boolean, type: EShapeType = EShapeType.GROUP_SHADOWED) {\n\t\tsuper(isEditMode, type);\n\t}\n\n\tprotected newGroupSize(isEditMode: boolean): EShapeGroupSize {\n\t\tif (isEditMode) {\n\t\t\treturn new EShapeGroupSizeShadowed(this, EShapeDefaults.SIZE_X, EShapeDefaults.SIZE_Y);\n\t\t} else {\n\t\t\treturn super.newGroupSize(isEditMode);\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { deserializeBase } from \"./deserialize-base\";\nimport { EShapeGroupShadowed } from \"./e-shape-group-shadowed\";\n\nexport const deserializeGroupShadowed = (\n\titem: DDiagramSerializedItem,\n\tmanager: EShapeResourceManagerDeserialization,\n\tshape?: EShapeGroupShadowed\n): Promise<EShapeGroupShadowed> | EShapeGroupShadowed => {\n\tshape = shape || new EShapeGroupShadowed(manager.isEditMode);\n\tconst result = deserializeBase(item, manager, shape);\n\tshape.size.init();\n\treturn result;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeDeserializers } from \"../e-shape-deserializers\";\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapeUploadeds } from \"../e-shape-uploadeds\";\nimport { createGroupUploaded } from \"../variant/create-group-uploaded\";\nimport { deserializeGroupShadowed } from \"../variant/deserialize-group-shadowed\";\n\nexport const loadShapeGroupShadowed = (): void => {\n\tEShapeUploadeds[EShapeType.GROUP_SHADOWED] = createGroupUploaded;\n\tEShapeDeserializers[EShapeType.GROUP_SHADOWED] = deserializeGroupShadowed;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeBuffer } from \"../e-shape-buffer\";\nimport {\n\tbuildRectangleClipping,\n\tbuildRectangleIndex,\n\tbuildRectangleStep,\n\tbuildRectangleUv,\n\tbuildRectangleVertex,\n\tRECTANGLE_WORLD_SIZE\n} from \"./build-rectangle\";\nimport { BuilderBase } from \"./builder-base\";\nimport { toTexture, toTextureTransformId, toTextureUvs, toTransformLocalId } from \"./builders\";\n\nexport class BuilderRectangle extends BuilderBase {\n\tinit(buffer: EShapeBuffer): void {\n\t\tbuffer.updateIndices();\n\t\tbuildRectangleIndex(buffer.indices, this.vertexOffset, this.indexOffset);\n\t}\n\n\tupdate(buffer: EShapeBuffer, shape: EShape): void {\n\t\tthis.updateVertexClippingStepAndUv(buffer, shape);\n\t\tthis.updateColorFill(buffer, shape);\n\t\tthis.updateColorStroke(buffer, shape);\n\t}\n\n\tprotected updateVertexClippingStepAndUv(buffer: EShapeBuffer, shape: EShape): void {\n\t\tconst size = shape.size;\n\t\tconst sizeX = size.x;\n\t\tconst sizeY = size.y;\n\t\tconst isSizeChanged = sizeX !== this.sizeX || sizeY !== this.sizeY;\n\n\t\tconst transformLocalId = toTransformLocalId(shape);\n\t\tconst isTransformChanged = this.transformLocalId !== transformLocalId;\n\n\t\tconst stroke = shape.stroke;\n\t\tconst strokeAlign = stroke.align;\n\t\tconst strokeWidth = stroke.enable ? stroke.width : 0;\n\t\tconst strokeSide = stroke.side;\n\t\tconst strokeStyle = stroke.style;\n\t\tconst isStrokeChanged =\n\t\t\tthis.strokeAlign !== strokeAlign ||\n\t\t\tthis.strokeWidth !== strokeWidth ||\n\t\t\tthis.strokeSide !== strokeSide ||\n\t\t\tthis.strokeStyle !== strokeStyle;\n\n\t\tconst texture = toTexture(shape);\n\t\tconst textureTransformId = toTextureTransformId(texture);\n\t\tconst isTextureChanged =\n\t\t\ttexture !== this.texture || textureTransformId !== this.textureTransformId;\n\n\t\tconst isVertexChanged = isSizeChanged || isStrokeChanged;\n\n\t\tif (isVertexChanged || isTransformChanged || isTextureChanged) {\n\t\t\tthis.sizeX = sizeX;\n\t\t\tthis.sizeY = sizeY;\n\t\t\tthis.transformLocalId = transformLocalId;\n\t\t\tthis.strokeAlign = strokeAlign;\n\t\t\tthis.strokeWidth = strokeWidth;\n\t\t\tthis.strokeSide = strokeSide;\n\t\t\tthis.strokeStyle = strokeStyle;\n\t\t\tthis.texture = texture;\n\t\t\tthis.textureTransformId = textureTransformId;\n\n\t\t\t// Vertices\n\t\t\tconst voffset = this.vertexOffset;\n\t\t\tbuffer.updateVertices();\n\t\t\tbuildRectangleVertex(\n\t\t\t\tbuffer.vertices,\n\t\t\t\tvoffset,\n\t\t\t\t0,\n\t\t\t\t0,\n\t\t\t\tsizeX,\n\t\t\t\tsizeY,\n\t\t\t\tstrokeAlign,\n\t\t\t\tstrokeWidth,\n\t\t\t\tshape.transform.internalTransform,\n\t\t\t\tRECTANGLE_WORLD_SIZE\n\t\t\t);\n\n\t\t\t// Steps\n\t\t\tif (isVertexChanged || isTransformChanged) {\n\t\t\t\tbuffer.updateSteps();\n\t\t\t\tbuildRectangleStep(\n\t\t\t\t\tvoffset,\n\t\t\t\t\tbuffer.steps,\n\t\t\t\t\tstrokeWidth,\n\t\t\t\t\tstrokeSide,\n\t\t\t\t\tstrokeStyle,\n\t\t\t\t\tRECTANGLE_WORLD_SIZE\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t// Clippings\n\t\t\tif (isVertexChanged) {\n\t\t\t\tbuffer.updateClippings();\n\t\t\t\tbuildRectangleClipping(buffer.clippings, voffset, RECTANGLE_WORLD_SIZE);\n\t\t\t}\n\n\t\t\t// UVs\n\t\t\tif (isVertexChanged || isTextureChanged) {\n\t\t\t\tbuffer.updateUvs();\n\t\t\t\tbuildRectangleUv(buffer.uvs, voffset, toTextureUvs(texture), RECTANGLE_WORLD_SIZE);\n\t\t\t}\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeBuffer } from \"../e-shape-buffer\";\nimport { EShapeUploaded, EShapeUploadedImpl } from \"../e-shape-uploaded\";\nimport { RECTANGLE_INDEX_COUNT, RECTANGLE_VERTEX_COUNT } from \"./build-rectangle\";\nimport { TEXT_INDEX_COUNT, TEXT_VERTEX_COUNT, toTextBufferCount } from \"./build-text\";\nimport { BuilderRectangle } from \"./builder-rectangle\";\nimport { BuilderText } from \"./builder-text\";\n\nexport const createRectangleUploaded = (\n\tbuffer: EShapeBuffer,\n\tshape: EShape,\n\tvoffset: number,\n\tioffset: number,\n\tantialiasWeight: number\n): EShapeUploaded | null => {\n\tconst tcount = toTextBufferCount(shape);\n\tconst tvcount = tcount * TEXT_VERTEX_COUNT;\n\tconst ticount = tcount * TEXT_INDEX_COUNT;\n\tconst vcount = RECTANGLE_VERTEX_COUNT + tvcount;\n\tconst icount = RECTANGLE_INDEX_COUNT + ticount;\n\tif (buffer.check(voffset, ioffset, vcount, icount)) {\n\t\treturn new EShapeUploadedImpl(buffer, voffset, ioffset, vcount, icount, [\n\t\t\tnew BuilderRectangle(voffset, ioffset, vcount - tvcount, icount - ticount),\n\t\t\tnew BuilderText(\n\t\t\t\tvoffset + RECTANGLE_VERTEX_COUNT,\n\t\t\t\tioffset + RECTANGLE_INDEX_COUNT,\n\t\t\t\ttvcount,\n\t\t\t\tticount\n\t\t\t)\n\t\t]).init(shape);\n\t}\n\treturn null;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapeRectangle } from \"./e-shape-rectangle\";\n\nexport class EShapeImage extends EShapeRectangle {\n\tconstructor(image?: HTMLImageElement, type: EShapeType = EShapeType.IMAGE) {\n\t\tsuper(type);\n\t\tif (image != null) {\n\t\t\tthis.image = image;\n\t\t\tthis.size.set(image.width, image.height);\n\t\t}\n\t\tthis.fill.alpha = 1;\n\t}\n\n\tclone(): EShapeImage {\n\t\treturn new EShapeImage(this.image, this.type).copy(this);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { deserializeBase } from \"./deserialize-base\";\nimport { EShapeImage } from \"./e-shape-image\";\n\nexport const deserializeImage = (\n\titem: DDiagramSerializedItem,\n\tmanager: EShapeResourceManagerDeserialization,\n\tshape?: EShapeImage\n): Promise<EShapeImage> | EShapeImage => {\n\treturn deserializeBase(item, manager, shape || new EShapeImage());\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeDeserializers } from \"../e-shape-deserializers\";\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapeUploadeds } from \"../e-shape-uploadeds\";\nimport { createRectangleUploaded } from \"../variant/create-rectangle-uploaded\";\nimport { deserializeImage } from \"../variant/deserialize-image\";\n\nexport const loadShapeImage = (): void => {\n\tEShapeUploadeds[EShapeType.IMAGE] = createRectangleUploaded;\n\tEShapeDeserializers[EShapeType.IMAGE] = deserializeImage;\n};\n","import { Matrix, Point, TextureUvs } from \"pixi.js\";\nimport { EShapeStrokeStyle } from \"../e-shape-stroke-style\";\nimport { toLength } from \"./to-length\";\nimport { toScaleInvariant } from \"./to-scale-invariant\";\n\nexport const IMAGE_SDF_VERTEX_COUNT = 9;\nexport const IMAGE_SDF_INDEX_COUNT = 8;\nexport const IMAGE_SDF_WORLD_SIZE: [number, number] = [0, 0];\nconst IMAGE_SDF_WORK_POINT: Point = new Point();\n\nexport const buildImageSdfClipping = (clippings: Float32Array, voffset: number): void => {\n\tlet ic = voffset * 3 - 1;\n\tconst icmax = (voffset + IMAGE_SDF_VERTEX_COUNT) * 3 - 1;\n\tfor (; ic < icmax; ) {\n\t\tclippings[++ic] = 0;\n\t\tclippings[++ic] = 0;\n\t\tclippings[++ic] = 2;\n\t}\n};\n\nexport const buildImageSdfIndex = (\n\tindices: Uint16Array | Uint32Array,\n\tvoffset: number,\n\tioffset: number\n): void => {\n\tlet ii = ioffset * 3 - 1;\n\tindices[++ii] = voffset;\n\tindices[++ii] = voffset + 1;\n\tindices[++ii] = voffset + 3;\n\tindices[++ii] = voffset + 1;\n\tindices[++ii] = voffset + 4;\n\tindices[++ii] = voffset + 3;\n\n\tindices[++ii] = voffset + 1;\n\tindices[++ii] = voffset + 2;\n\tindices[++ii] = voffset + 4;\n\tindices[++ii] = voffset + 2;\n\tindices[++ii] = voffset + 5;\n\tindices[++ii] = voffset + 4;\n\n\tindices[++ii] = voffset + 3;\n\tindices[++ii] = voffset + 4;\n\tindices[++ii] = voffset + 6;\n\tindices[++ii] = voffset + 4;\n\tindices[++ii] = voffset + 7;\n\tindices[++ii] = voffset + 6;\n\n\tindices[++ii] = voffset + 4;\n\tindices[++ii] = voffset + 5;\n\tindices[++ii] = voffset + 7;\n\tindices[++ii] = voffset + 5;\n\tindices[++ii] = voffset + 8;\n\tindices[++ii] = voffset + 7;\n};\n\nexport const buildImageSdfStep = (\n\tsteps: Float32Array,\n\tvoffset: number,\n\tstrokeAlign: number,\n\tstrokeWidth: number,\n\tstrokeStyle: EShapeStrokeStyle,\n\ttextureWidth: number,\n\ttextureHeight: number,\n\tworldSize: typeof IMAGE_SDF_WORLD_SIZE\n): void => {\n\tconst scaleInvariant = toScaleInvariant(strokeStyle);\n\n\tconst scaleX = textureWidth / worldSize[0];\n\tconst scaleY = textureHeight / worldSize[1];\n\tconst scaleZ = (scaleX + scaleY) * 0.5;\n\tconst strokeWidthMax = 12;\n\tconst position = -1 + strokeAlign;\n\n\tlet is = voffset * 6 - 1;\n\tsteps[++is] = strokeWidth;\n\tsteps[++is] = scaleInvariant;\n\tsteps[++is] = scaleZ;\n\tsteps[++is] = strokeWidthMax;\n\tsteps[++is] = position;\n\tsteps[++is] = 0;\n\n\tsteps[++is] = strokeWidth;\n\tsteps[++is] = scaleInvariant;\n\tsteps[++is] = scaleY;\n\tsteps[++is] = strokeWidthMax;\n\tsteps[++is] = position;\n\tsteps[++is] = 0;\n\n\tsteps[++is] = strokeWidth;\n\tsteps[++is] = scaleInvariant;\n\tsteps[++is] = scaleZ;\n\tsteps[++is] = strokeWidthMax;\n\tsteps[++is] = position;\n\tsteps[++is] = 0;\n\n\tsteps[++is] = strokeWidth;\n\tsteps[++is] = scaleInvariant;\n\tsteps[++is] = scaleX;\n\tsteps[++is] = strokeWidthMax;\n\tsteps[++is] = position;\n\tsteps[++is] = 0;\n\n\tsteps[++is] = strokeWidth;\n\tsteps[++is] = scaleInvariant;\n\tsteps[++is] = scaleZ;\n\tsteps[++is] = strokeWidthMax;\n\tsteps[++is] = position;\n\tsteps[++is] = 0;\n\n\tsteps[++is] = strokeWidth;\n\tsteps[++is] = scaleInvariant;\n\tsteps[++is] = scaleX;\n\tsteps[++is] = strokeWidthMax;\n\tsteps[++is] = position;\n\tsteps[++is] = 0;\n\n\tsteps[++is] = strokeWidth;\n\tsteps[++is] = scaleInvariant;\n\tsteps[++is] = scaleZ;\n\tsteps[++is] = strokeWidthMax;\n\tsteps[++is] = position;\n\tsteps[++is] = 0;\n\n\tsteps[++is] = strokeWidth;\n\tsteps[++is] = scaleInvariant;\n\tsteps[++is] = scaleY;\n\tsteps[++is] = strokeWidthMax;\n\tsteps[++is] = position;\n\tsteps[++is] = 0;\n\n\tsteps[++is] = strokeWidth;\n\tsteps[++is] = scaleInvariant;\n\tsteps[++is] = scaleY;\n\tsteps[++is] = strokeWidthMax;\n\tsteps[++is] = position;\n\tsteps[++is] = 0;\n};\n\nexport const buildImageSdfVertex = (\n\tvertices: Float32Array,\n\tvoffset: number,\n\toriginX: number,\n\toriginY: number,\n\tsizeX: number,\n\tsizeY: number,\n\tinternalTransform: Matrix,\n\tworldSize: typeof IMAGE_SDF_WORLD_SIZE\n): void => {\n\t// Calculate the transformed positions\n\t//\n\t// 0       1       2\n\t// |-------|-------|\n\t// |       |       |\n\t// 3-------4-------5\n\t// |       |       |\n\t// |-------|-------|\n\t// 6       7       8\n\t//\n\tconst work = IMAGE_SDF_WORK_POINT;\n\tconst sx = sizeX * 0.5;\n\tconst sy = sizeY * 0.5;\n\twork.set(originX - sx, originY - sy);\n\tinternalTransform.apply(work, work);\n\tconst x0 = work.x;\n\tconst y0 = work.y;\n\twork.set(originX + sx, originY - sy);\n\tinternalTransform.apply(work, work);\n\tconst x2 = work.x;\n\tconst y2 = work.y;\n\twork.set(originX + sx, originY + sy);\n\tinternalTransform.apply(work, work);\n\tconst x8 = work.x;\n\tconst y8 = work.y;\n\tconst x6 = x0 + (x8 - x2);\n\tconst y6 = y0 + (y8 - y2);\n\n\t// Vertices\n\tlet iv = (voffset << 1) - 1;\n\tvertices[++iv] = x0;\n\tvertices[++iv] = y0;\n\tvertices[++iv] = (x0 + x2) * 0.5;\n\tvertices[++iv] = (y0 + y2) * 0.5;\n\tvertices[++iv] = x2;\n\tvertices[++iv] = y2;\n\n\tvertices[++iv] = (x0 + x6) * 0.5;\n\tvertices[++iv] = (y0 + y6) * 0.5;\n\tvertices[++iv] = (x0 + x8) * 0.5;\n\tvertices[++iv] = (y0 + y8) * 0.5;\n\tvertices[++iv] = (x2 + x8) * 0.5;\n\tvertices[++iv] = (y2 + y8) * 0.5;\n\n\tvertices[++iv] = x6;\n\tvertices[++iv] = y6;\n\tvertices[++iv] = (x6 + x8) * 0.5;\n\tvertices[++iv] = (y6 + y8) * 0.5;\n\tvertices[++iv] = x8;\n\tvertices[++iv] = y8;\n\n\tworldSize[0] = toLength(x0, y0, x2, y2) * 0.5;\n\tworldSize[1] = toLength(x0, y0, x6, y6) * 0.5;\n};\n\nexport const buildImageSdfUv = (\n\tuvs: Float32Array,\n\tvoffset: number,\n\ttextureUv: TextureUvs\n): void => {\n\tconst x0 = textureUv.x0;\n\tconst y0 = textureUv.y0;\n\tconst x1 = textureUv.x1;\n\tconst y1 = textureUv.y1;\n\tconst x2 = textureUv.x2;\n\tconst y2 = textureUv.y2;\n\tconst x3 = textureUv.x3;\n\tconst y3 = textureUv.y3;\n\n\tlet iv = (voffset << 1) - 1;\n\tuvs[++iv] = x0;\n\tuvs[++iv] = y0;\n\tuvs[++iv] = (x1 + x0) * 0.5;\n\tuvs[++iv] = (y1 + y0) * 0.5;\n\tuvs[++iv] = x1;\n\tuvs[++iv] = y1;\n\n\tuvs[++iv] = (x0 + x3) * 0.5;\n\tuvs[++iv] = (y0 + y3) * 0.5;\n\tuvs[++iv] = (x0 + x2) * 0.5;\n\tuvs[++iv] = (y0 + y2) * 0.5;\n\tuvs[++iv] = (x1 + x2) * 0.5;\n\tuvs[++iv] = (y1 + y2) * 0.5;\n\n\tuvs[++iv] = x3;\n\tuvs[++iv] = y3;\n\tuvs[++iv] = (x3 + x2) * 0.5;\n\tuvs[++iv] = (y3 + y2) * 0.5;\n\tuvs[++iv] = x2;\n\tuvs[++iv] = y2;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeBuffer } from \"../e-shape-buffer\";\nimport {\n\tbuildImageSdfClipping,\n\tbuildImageSdfIndex,\n\tbuildImageSdfStep,\n\tbuildImageSdfUv,\n\tbuildImageSdfVertex,\n\tIMAGE_SDF_INDEX_COUNT,\n\tIMAGE_SDF_VERTEX_COUNT,\n\tIMAGE_SDF_WORLD_SIZE\n} from \"./build-image-sdf\";\nimport { BuilderBase } from \"./builder-base\";\nimport { toTexture, toTextureTransformId, toTextureUvs, toTransformLocalId } from \"./builders\";\n\nexport class BuilderImageSdf extends BuilderBase {\n\tprotected textureWidth: number;\n\tprotected textureHeight: number;\n\n\tconstructor(vertexOffset: number, indexOffset: number) {\n\t\tsuper(vertexOffset, indexOffset, IMAGE_SDF_VERTEX_COUNT, IMAGE_SDF_INDEX_COUNT);\n\t\tthis.textureWidth = -1;\n\t\tthis.textureHeight = -1;\n\t}\n\n\tinit(buffer: EShapeBuffer): void {\n\t\tconst voffset = this.vertexOffset;\n\t\tbuffer.updateClippings();\n\t\tbuffer.updateIndices();\n\t\tbuildImageSdfClipping(buffer.clippings, voffset);\n\t\tbuildImageSdfIndex(buffer.indices, voffset, this.indexOffset);\n\t}\n\n\tupdate(buffer: EShapeBuffer, shape: EShape): void {\n\t\tthis.updateVertexAndStep(buffer, shape);\n\t\tthis.updateColorFill(buffer, shape);\n\t\tthis.updateColorStroke(buffer, shape);\n\t\tthis.updateUv(buffer, shape);\n\t}\n\n\tprotected updateVertexAndStep(buffer: EShapeBuffer, shape: EShape): void {\n\t\tconst size = shape.size;\n\t\tconst sizeX = size.x;\n\t\tconst sizeY = size.y;\n\t\tconst isSizeChanged = sizeX !== this.sizeX || sizeY !== this.sizeY;\n\n\t\tconst transformLocalId = toTransformLocalId(shape);\n\t\tconst isTransformChanged = this.transformLocalId !== transformLocalId;\n\n\t\tconst stroke = shape.stroke;\n\t\tconst strokeAlign = stroke.align;\n\t\tconst strokeWidth = stroke.enable ? stroke.width : 0;\n\t\tconst strokeStyle = stroke.style;\n\t\tconst isStrokeChanged =\n\t\t\tthis.strokeAlign !== strokeAlign ||\n\t\t\tthis.strokeWidth !== strokeWidth ||\n\t\t\tthis.strokeStyle !== strokeStyle;\n\n\t\tconst texture = toTexture(shape);\n\t\tconst textureWidth = texture.width * texture.resolution;\n\t\tconst textureHeight = texture.height * texture.resolution;\n\t\tconst isTextureSizeChanged =\n\t\t\tthis.textureWidth !== textureWidth || this.textureHeight !== textureHeight;\n\n\t\tif (isSizeChanged || isTransformChanged || isStrokeChanged || isTextureSizeChanged) {\n\t\t\tthis.sizeX = sizeX;\n\t\t\tthis.sizeY = sizeY;\n\t\t\tthis.transformLocalId = transformLocalId;\n\t\t\tthis.strokeAlign = strokeAlign;\n\t\t\tthis.strokeWidth = strokeWidth;\n\t\t\tthis.strokeStyle = strokeStyle;\n\t\t\tthis.textureWidth = textureWidth;\n\t\t\tthis.textureHeight = textureHeight;\n\n\t\t\t// Vertices\n\t\t\tbuffer.updateVertices();\n\t\t\tbuildImageSdfVertex(\n\t\t\t\tbuffer.vertices,\n\t\t\t\tthis.vertexOffset,\n\t\t\t\t0,\n\t\t\t\t0,\n\t\t\t\tsizeX,\n\t\t\t\tsizeY,\n\t\t\t\tshape.transform.internalTransform,\n\t\t\t\tIMAGE_SDF_WORLD_SIZE\n\t\t\t);\n\n\t\t\t// Steps\n\t\t\tbuffer.updateSteps();\n\t\t\tbuildImageSdfStep(\n\t\t\t\tbuffer.steps,\n\t\t\t\tthis.vertexOffset,\n\t\t\t\tstrokeAlign,\n\t\t\t\tstrokeWidth,\n\t\t\t\tstrokeStyle,\n\t\t\t\ttextureWidth,\n\t\t\t\ttextureHeight,\n\t\t\t\tIMAGE_SDF_WORLD_SIZE\n\t\t\t);\n\t\t}\n\t}\n\n\tprotected updateUv(buffer: EShapeBuffer, shape: EShape): void {\n\t\tconst texture = toTexture(shape);\n\t\tconst textureTransformId = toTextureTransformId(texture);\n\t\tif (texture !== this.texture || textureTransformId !== this.textureTransformId) {\n\t\t\tthis.texture = texture;\n\t\t\tthis.textureTransformId = textureTransformId;\n\n\t\t\tbuffer.updateUvs();\n\t\t\tbuildImageSdfUv(buffer.uvs, this.vertexOffset, toTextureUvs(texture));\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeBuffer } from \"../e-shape-buffer\";\nimport { EShapeUploaded, EShapeUploadedImpl } from \"../e-shape-uploaded\";\nimport { IMAGE_SDF_INDEX_COUNT, IMAGE_SDF_VERTEX_COUNT } from \"./build-image-sdf\";\nimport { TEXT_INDEX_COUNT, TEXT_VERTEX_COUNT, toTextBufferCount } from \"./build-text\";\nimport { BuilderImageSdf } from \"./builder-image-sdf\";\nimport { BuilderText } from \"./builder-text\";\n\nexport const createImageSdfUploaded = (\n\tbuffer: EShapeBuffer,\n\tshape: EShape,\n\tvoffset: number,\n\tioffset: number,\n\tantialiasWeight: number\n): EShapeUploaded | null => {\n\tconst tcount = toTextBufferCount(shape);\n\tconst tvcount = tcount * TEXT_VERTEX_COUNT;\n\tconst ticount = tcount * TEXT_INDEX_COUNT;\n\tconst vcount = IMAGE_SDF_VERTEX_COUNT + tvcount;\n\tconst icount = IMAGE_SDF_INDEX_COUNT + ticount;\n\tif (buffer.check(voffset, ioffset, vcount, icount)) {\n\t\treturn new EShapeUploadedImpl(buffer, voffset, ioffset, vcount, icount, [\n\t\t\tnew BuilderImageSdf(voffset, ioffset),\n\t\t\tnew BuilderText(\n\t\t\t\tvoffset + IMAGE_SDF_VERTEX_COUNT,\n\t\t\t\tioffset + IMAGE_SDF_INDEX_COUNT,\n\t\t\t\ttvcount,\n\t\t\t\tticount\n\t\t\t)\n\t\t]).init(shape);\n\t}\n\treturn null;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapeImage } from \"./e-shape-image\";\n\nexport class EShapeImageSdf extends EShapeImage {\n\tconstructor(image?: HTMLImageElement, type: EShapeType = EShapeType.IMAGE_SDF) {\n\t\tsuper(image, type);\n\t}\n\n\tclone(): EShapeImageSdf {\n\t\treturn new EShapeImageSdf(this.image, this.type).copy(this);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { deserializeBase } from \"./deserialize-base\";\nimport { EShapeImageSdf } from \"./e-shape-image-sdf\";\n\nexport const deserializeImageSdf = (\n\titem: DDiagramSerializedItem,\n\tmanager: EShapeResourceManagerDeserialization,\n\tshape?: EShapeImageSdf\n): Promise<EShapeImageSdf> | EShapeImageSdf => {\n\treturn deserializeBase(item, manager, shape || new EShapeImageSdf());\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Texture } from \"pixi.js\";\nimport { EShape } from \"../e-shape\";\nimport { EShapeBuffer } from \"../e-shape-buffer\";\nimport { EShapeBufferUnitBuilder } from \"../e-shape-buffer-unit-builder\";\nimport { Builder } from \"./builder\";\nimport { toTexture } from \"./builders\";\n\nexport class BuilderLabel implements Builder {\n\treadonly vertexOffset: number;\n\treadonly vertexCount: number;\n\treadonly indexOffset: number;\n\treadonly indexCount: number;\n\n\tprotected texture: Texture | null;\n\n\tconstructor(\n\t\tvertexOffset: number,\n\t\tindexOffset: number,\n\t\tvertexCount: number,\n\t\tindexCount: number\n\t) {\n\t\tthis.vertexOffset = vertexOffset;\n\t\tthis.indexOffset = indexOffset;\n\t\tthis.vertexCount = vertexCount;\n\t\tthis.indexCount = indexCount;\n\n\t\tthis.texture = null;\n\t}\n\n\tinit(buffer: EShapeBuffer): void {\n\t\t// DO NOTHING\n\t}\n\n\tisCompatible(shape: EShape): boolean {\n\t\treturn true;\n\t}\n\n\tupdate(buffer: EShapeBuffer, shape: EShape): void {\n\t\tthis.texture = toTexture(shape);\n\t}\n\n\tbuildUnit(builder: EShapeBufferUnitBuilder): void {\n\t\tconst texture = this.texture || Texture.WHITE;\n\t\tconst baseTexture = texture.baseTexture;\n\t\tif (baseTexture !== builder.baseTexture) {\n\t\t\tbuilder.baseTexture = baseTexture;\n\t\t\tconst indexOffset = this.indexOffset;\n\t\t\tbuilder.push(texture, indexOffset);\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeBuffer } from \"../e-shape-buffer\";\nimport { EShapeUploaded, EShapeUploadedImpl } from \"../e-shape-uploaded\";\nimport { TEXT_INDEX_COUNT, TEXT_VERTEX_COUNT, toTextBufferCount } from \"./build-text\";\nimport { BuilderLabel } from \"./builder-label\";\nimport { BuilderText } from \"./builder-text\";\n\nexport const createLabelUploaded = (\n\tbuffer: EShapeBuffer,\n\tshape: EShape,\n\tvoffset: number,\n\tioffset: number,\n\tantialiasWeight: number\n): EShapeUploaded | null => {\n\tconst tcount = toTextBufferCount(shape);\n\tconst tvcount = tcount * TEXT_VERTEX_COUNT;\n\tconst ticount = tcount * TEXT_INDEX_COUNT;\n\tconst vcount = tvcount;\n\tconst icount = ticount;\n\tif (buffer.check(voffset, ioffset, vcount, icount)) {\n\t\treturn new EShapeUploadedImpl(buffer, voffset, ioffset, vcount, icount, [\n\t\t\tnew BuilderLabel(voffset, ioffset, vcount - tvcount, icount - ticount),\n\t\t\tnew BuilderText(voffset, ioffset, tvcount, ticount)\n\t\t]).init(shape);\n\t}\n\treturn null;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapePrimitive } from \"./e-shape-primitive\";\n\nexport class EShapeLabel extends EShapePrimitive {\n\tconstructor(type: EShapeType = EShapeType.LABEL) {\n\t\tsuper(type);\n\t}\n\n\tclone(): EShapeLabel {\n\t\treturn new EShapeLabel(this.type).copy(this);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { deserializeBase } from \"./deserialize-base\";\nimport { EShapeLabel } from \"./e-shape-label\";\n\nexport const deserializeLabel = (\n\titem: DDiagramSerializedItem,\n\tmanager: EShapeResourceManagerDeserialization,\n\tshape?: EShapeLabel\n): Promise<EShapeLabel> | EShapeLabel => {\n\treturn deserializeBase(item, manager, shape || new EShapeLabel());\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeDeserializers } from \"../e-shape-deserializers\";\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapeUploadeds } from \"../e-shape-uploadeds\";\nimport { createLabelUploaded } from \"../variant/create-label-uploaded\";\nimport { deserializeLabel } from \"../variant/deserialize-label\";\n\nexport const loadShapeLabel = (): void => {\n\tEShapeUploadeds[EShapeType.LABEL] = createLabelUploaded;\n\tEShapeDeserializers[EShapeType.LABEL] = deserializeLabel;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapeLineBase } from \"./e-shape-line-base\";\nimport { EShapeLinePoints } from \"./e-shape-line-points\";\n\nexport class EShapeLine extends EShapeLineBase {\n\tprotected declare _points: EShapeLinePoints;\n\n\tconstructor(type: EShapeType = EShapeType.LINE) {\n\t\tsuper(type);\n\t\tthis._points = new EShapeLinePoints(this);\n\t}\n\n\tget points(): EShapeLinePoints {\n\t\treturn this._points;\n\t}\n\n\tclone(): EShapeLine {\n\t\treturn new EShapeLine(this.type).copy(this);\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): DDiagramSerializedItem {\n\t\tconst result = super.serialize(manager);\n\t\tresult[15] = this._points.serialize(manager);\n\t\treturn result;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\nimport { EShapePointsStyle } from \"../e-shape-points-style\";\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { deserializeBase } from \"./deserialize-base\";\nimport { EShapeLine } from \"./e-shape-line\";\n\nexport const deserializeLine = (\n\titem: DDiagramSerializedItem,\n\tmanager: EShapeResourceManagerDeserialization,\n\tshape?: EShapeLine\n): Promise<EShapeLine> | EShapeLine => {\n\tshape = shape || new EShapeLine();\n\tconst result = deserializeBase(item, manager, shape);\n\tshape.points.deserialize(item[15], manager);\n\tconst style = shape.points.style;\n\tconst mask =\n\t\tEShapePointsStyle.NON_SCALING_MASK |\n\t\tEShapePointsStyle.DOTTED_MASK |\n\t\tEShapePointsStyle.DASHED_MASK;\n\tconst deprecated = style & mask;\n\tif (deprecated) {\n\t\tshape.points.style &= ~mask;\n\t\tshape.stroke.style |= deprecated;\n\t}\n\treturn result;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeDeserializers } from \"../e-shape-deserializers\";\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapeUploadeds } from \"../e-shape-uploadeds\";\nimport { createLineUploaded } from \"../variant/create-line-uploaded\";\nimport { deserializeLine } from \"../variant/deserialize-line\";\n\nexport const loadShapeLine = (): void => {\n\tEShapeUploadeds[EShapeType.LINE] = createLineUploaded;\n\tEShapeDeserializers[EShapeType.LINE] = deserializeLine;\n};\n","export const buildNullClipping = (\n\tclippings: Float32Array,\n\tvoffset: number,\n\tvcount: number\n): void => {\n\tfor (let i = voffset * 3, imax = (voffset + vcount) * 3; i < imax; i += 3) {\n\t\tclippings[i + 0] = 0;\n\t\tclippings[i + 1] = 0;\n\t\tclippings[i + 2] = 0;\n\t}\n};\n\nexport const buildNullIndex = (\n\tindices: Uint16Array | Uint32Array,\n\tvoffset: number,\n\tioffset: number,\n\ticount: number\n): void => {\n\tfor (let ii = ioffset * 3, iimax = (ioffset + icount) * 3; ii < iimax; ii += 3) {\n\t\tindices[ii + 0] = voffset;\n\t\tindices[ii + 1] = voffset;\n\t\tindices[ii + 2] = voffset;\n\t}\n};\n\nexport const buildNullVertex = (vertices: Float32Array, voffset: number, vcount: number): void => {\n\tfor (let i = voffset * 2, imax = (voffset + vcount) * 2; i < imax; i += 2) {\n\t\tvertices[i + 0] = 0;\n\t\tvertices[i + 1] = 0;\n\t}\n};\n\nexport const buildNullStep = (steps: Float32Array, voffset: number, vcount: number): void => {\n\tfor (let i = voffset * 6, imax = (voffset + vcount) * 6; i < imax; i += 6) {\n\t\tsteps[i + 0] = 0;\n\t\tsteps[i + 1] = 0;\n\t\tsteps[i + 2] = 0;\n\t\tsteps[i + 3] = 0;\n\t\tsteps[i + 4] = 0;\n\t\tsteps[i + 5] = 0;\n\t}\n};\n\nexport const buildNullUv = (uvs: Float32Array, voffset: number, vcount: number): void => {\n\tfor (let i = voffset * 2, imax = (voffset + vcount) * 2; i < imax; i += 2) {\n\t\tuvs[i + 0] = 0;\n\t\tuvs[i + 1] = 0;\n\t}\n};\n","import { buildColor } from \"./build-color\";\nimport { EShapeLineOfAnyPointsFill } from \"./e-shape-line-of-any-points-fill\";\nimport { EShapeLineOfAnyPointsStroke } from \"./e-shape-line-of-any-points-stroke\";\n\nexport const toLineOfAnyPointCount = (pointCount: number): number => {\n\treturn Math.ceil(pointCount / 12) * 12;\n};\n\nexport const buildLineOfAnyColor = (\n\tvoffset: number,\n\tvcountPerPoint: number,\n\tpoint: EShapeLineOfAnyPointsStroke | EShapeLineOfAnyPointsFill,\n\tpointCount: number,\n\tcolors: Float32Array,\n\tisEnabled: boolean,\n\tcolorDef: number,\n\talphaDef: number\n): void => {\n\tif (isEnabled) {\n\t\tif (point.isStaticColor()) {\n\t\t\tconst color = point.getColor(0, colorDef);\n\t\t\tif (point.isStaticAlpha()) {\n\t\t\t\tconst alpha = point.getAlpha(0, alphaDef);\n\t\t\t\tbuildColor(color, alpha, voffset, vcountPerPoint * pointCount, colors);\n\t\t\t} else {\n\t\t\t\tfor (let i = 0, iv = voffset; i < pointCount; i += 1, iv += vcountPerPoint) {\n\t\t\t\t\tconst alpha = point.getAlpha(i, alphaDef);\n\t\t\t\t\tbuildColor(color, alpha, iv, vcountPerPoint, colors);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tif (point.isStaticAlpha()) {\n\t\t\t\tconst alpha = point.getAlpha(0, alphaDef);\n\t\t\t\tfor (let i = 0, iv = voffset; i < pointCount; i += 1, iv += vcountPerPoint) {\n\t\t\t\t\tconst color = point.getColor(i, colorDef);\n\t\t\t\t\tbuildColor(color, alpha, iv, vcountPerPoint, colors);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (let i = 0, iv = voffset; i < pointCount; i += 1, iv += vcountPerPoint) {\n\t\t\t\t\tconst color = point.getColor(i, colorDef);\n\t\t\t\t\tconst alpha = point.getAlpha(i, alphaDef);\n\t\t\t\t\tbuildColor(color, alpha, iv, vcountPerPoint, colors);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} else {\n\t\tif (point.isStaticColor()) {\n\t\t\tconst color = point.getColor(0, colorDef);\n\t\t\tbuildColor(color, 0, voffset, vcountPerPoint * pointCount, colors);\n\t\t} else {\n\t\t\tfor (let i = 0, iv = voffset; i < pointCount; i += 1, iv += vcountPerPoint) {\n\t\t\t\tconst color = point.getColor(i, colorDef);\n\t\t\t\tbuildColor(color, 0, iv, vcountPerPoint, colors);\n\t\t\t}\n\t\t}\n\t}\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeBuffer } from \"../e-shape-buffer\";\nimport { toPointsCount } from \"./build-line\";\nimport { buildLineOfAnyColor, toLineOfAnyPointCount } from \"./build-line-of-any\";\nimport { BuilderBase } from \"./builder-base\";\nimport { EShapeLineOfAnyPoints } from \"./e-shape-line-of-any-points\";\n\nexport abstract class BuilderLineOfAny extends BuilderBase {\n\tprotected pointId: number;\n\tprotected pointCount: number;\n\tprotected pointCountReserved: number;\n\tprotected pointSizeId: number;\n\tprotected pointOffsetId: number;\n\tprotected pointFillId: number;\n\tprotected pointStrokeId: number;\n\n\tconstructor(\n\t\tvertexOffset: number,\n\t\tindexOffset: number,\n\t\tvertexCount: number,\n\t\tindexCount: number,\n\t\tpointCountReserved: number\n\t) {\n\t\tsuper(vertexOffset, indexOffset, vertexCount, indexCount);\n\t\tthis.pointId = -1;\n\t\tthis.pointCount = 0;\n\t\tthis.pointCountReserved = pointCountReserved;\n\t\tthis.pointSizeId = -1;\n\t\tthis.pointOffsetId = -1;\n\t\tthis.pointFillId = -1;\n\t\tthis.pointStrokeId = -1;\n\t}\n\n\tisCompatible(shape: EShape): boolean {\n\t\tconst pointCount = toLineOfAnyPointCount(toPointsCount(shape.points));\n\t\treturn pointCount === this.pointCountReserved;\n\t}\n\n\tprotected updateLineOfAnyColorFill(\n\t\tbuffer: EShapeBuffer,\n\t\tshape: EShape,\n\t\tpoints: EShapeLineOfAnyPoints,\n\t\tvcountPerPoint: number\n\t): void {\n\t\tconst pointFill = points.fill;\n\t\tconst pointFillId = pointFill.id;\n\t\tconst isPointFillChanged = pointFillId !== this.pointFillId;\n\n\t\tconst fill = shape.fill;\n\t\tconst isFillEnabled = shape.visible && fill.enable;\n\t\tconst colorFill = fill.color;\n\t\tconst alphaFill = isFillEnabled ? fill.alpha : 0;\n\t\tconst isFillChanged = colorFill !== this.colorFill || alphaFill !== this.alphaFill;\n\n\t\tif (isPointFillChanged || isFillChanged) {\n\t\t\tthis.colorFill = colorFill;\n\t\t\tthis.alphaFill = alphaFill;\n\t\t\tthis.pointFillId = pointFillId;\n\t\t\tbuffer.updateColorFills();\n\t\t\tbuildLineOfAnyColor(\n\t\t\t\tthis.vertexOffset,\n\t\t\t\tvcountPerPoint,\n\t\t\t\tpointFill,\n\t\t\t\tthis.pointCountReserved,\n\t\t\t\tbuffer.colorFills,\n\t\t\t\tisFillEnabled,\n\t\t\t\tcolorFill,\n\t\t\t\talphaFill\n\t\t\t);\n\t\t}\n\t}\n\n\tprotected updateLineOfAnyColorStroke(\n\t\tbuffer: EShapeBuffer,\n\t\tshape: EShape,\n\t\tpoints: EShapeLineOfAnyPoints,\n\t\tvcountPerPoint: number\n\t): void {\n\t\tconst pointStroke = points.stroke;\n\t\tconst pointStrokeId = pointStroke.id;\n\t\tconst isPointStrokeChanged = pointStrokeId !== this.pointStrokeId;\n\n\t\tconst stroke = shape.stroke;\n\t\tconst isStrokeEnabled = shape.visible && stroke.enable;\n\t\tconst colorStroke = stroke.color;\n\t\tconst alphaStroke = isStrokeEnabled ? stroke.alpha : 0;\n\t\tconst isStrokeChanged =\n\t\t\tcolorStroke !== this.colorStroke || alphaStroke !== this.alphaStroke;\n\n\t\tif (isPointStrokeChanged || isStrokeChanged) {\n\t\t\tthis.colorStroke = colorStroke;\n\t\t\tthis.alphaStroke = alphaStroke;\n\t\t\tthis.pointStrokeId = pointStrokeId;\n\t\t\tbuffer.updateColorStrokes();\n\t\t\tbuildLineOfAnyColor(\n\t\t\t\tthis.vertexOffset,\n\t\t\t\tvcountPerPoint,\n\t\t\t\tpointStroke,\n\t\t\t\tthis.pointCountReserved,\n\t\t\t\tbuffer.colorStrokes,\n\t\t\t\tisStrokeEnabled,\n\t\t\t\tcolorStroke,\n\t\t\t\talphaStroke\n\t\t\t);\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const copyClipping = (\n\tclippings: Float32Array,\n\tvoffset: number,\n\tvcountPerPoint: number,\n\tpointCount: number\n): void => {\n\tlet iv = voffset + vcountPerPoint;\n\tfor (let i = 1; i < pointCount; ++i) {\n\t\tlet icd = iv * 3;\n\t\tlet ics = voffset * 3;\n\t\tfor (let j = 0; j < vcountPerPoint; ++j) {\n\t\t\tclippings[icd + 0] = clippings[ics + 0];\n\t\t\tclippings[icd + 1] = clippings[ics + 1];\n\t\t\tclippings[icd + 2] = clippings[ics + 2];\n\t\t\ticd += 3;\n\t\t\tics += 3;\n\t\t}\n\t\tiv += vcountPerPoint;\n\t}\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const copyIndex = (\n\tindices: Uint16Array | Uint32Array,\n\tvcountPerPoint: number,\n\tioffset: number,\n\ticountPerPoint: number,\n\tpointCount: number\n): void => {\n\tlet idiv = vcountPerPoint;\n\tlet ii = ioffset + icountPerPoint;\n\tfor (let i = 1; i < pointCount; ++i) {\n\t\tlet iid = ii * 3;\n\t\tlet iis = ioffset * 3;\n\t\tfor (let j = 0; j < icountPerPoint; ++j) {\n\t\t\tindices[iid + 0] = indices[iis + 0] + idiv;\n\t\t\tindices[iid + 1] = indices[iis + 1] + idiv;\n\t\t\tindices[iid + 2] = indices[iis + 2] + idiv;\n\t\t\tiid += 3;\n\t\t\tiis += 3;\n\t\t}\n\t\tidiv += vcountPerPoint;\n\t\tii += icountPerPoint;\n\t}\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const copyStep = (\n\tsteps: Float32Array,\n\tvoffset: number,\n\tvcountPerPoint: number,\n\tpointCount: number\n): void => {\n\tconst iss0 = voffset * 6;\n\tlet isd = (voffset + vcountPerPoint) * 6;\n\tfor (let i = 1; i < pointCount; ++i) {\n\t\tlet iss = iss0;\n\t\tfor (let j = 0; j < vcountPerPoint; ++j) {\n\t\t\tsteps[isd + 0] = steps[iss + 0];\n\t\t\tsteps[isd + 1] = steps[iss + 1];\n\t\t\tsteps[isd + 2] = steps[iss + 2];\n\t\t\tsteps[isd + 3] = steps[iss + 3];\n\t\t\tsteps[isd + 4] = steps[iss + 4];\n\t\t\tsteps[isd + 5] = steps[iss + 5];\n\t\t\tisd += 6;\n\t\t\tiss += 6;\n\t\t}\n\t}\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const copyUvs = (\n\tuvs: Float32Array,\n\tvoffset: number,\n\tvcountPerPoint: number,\n\tpointCount: number\n): void => {\n\tlet iv = voffset + vcountPerPoint;\n\tfor (let i = 1; i < pointCount; ++i) {\n\t\tlet iuvd = iv << 1;\n\t\tlet iuvs = voffset << 1;\n\t\tfor (let j = 0; j < vcountPerPoint; ++j) {\n\t\t\tuvs[iuvd] = uvs[iuvs];\n\t\t\tuvs[iuvd + 1] = uvs[iuvs + 1];\n\t\t\tiuvd += 2;\n\t\t\tiuvs += 2;\n\t\t}\n\t\tiv += vcountPerPoint;\n\t}\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Matrix } from \"pixi.js\";\nimport { EShapeLineOfAnyPointsPoint } from \"./e-shape-line-of-any-points-point\";\n\nexport const copyVertex = (\n\tvertices: Float32Array,\n\tinternalTransform: Matrix,\n\tvoffset: number,\n\tvcountPerPoint: number,\n\tpointCount: number,\n\tpointsValues: number[],\n\tpointOffset: EShapeLineOfAnyPointsPoint\n): void => {\n\tconst a = internalTransform.a;\n\tconst b = internalTransform.b;\n\tconst c = internalTransform.c;\n\tconst d = internalTransform.d;\n\tlet i = pointCount - 1;\n\tlet iv = voffset + i * vcountPerPoint;\n\tif (pointOffset.isStaticX() && pointOffset.isStaticY()) {\n\t\tconst ox = pointOffset.getX(0);\n\t\tconst oy = pointOffset.getY(0);\n\t\tfor (; 0 <= i; --i) {\n\t\t\tconst ip = i << 1;\n\t\t\tconst px = pointsValues[ip] + ox;\n\t\t\tconst py = pointsValues[ip + 1] + oy;\n\t\t\tconst dx = a * px + c * py;\n\t\t\tconst dy = b * px + d * py;\n\t\t\tlet ivd = iv << 1;\n\t\t\tlet ivs = voffset << 1;\n\t\t\tfor (let j = 0; j < vcountPerPoint; ++j) {\n\t\t\t\tvertices[ivd] = vertices[ivs] + dx;\n\t\t\t\tvertices[ivd + 1] = vertices[ivs + 1] + dy;\n\t\t\t\tivd += 2;\n\t\t\t\tivs += 2;\n\t\t\t}\n\t\t\tiv -= vcountPerPoint;\n\t\t}\n\t} else {\n\t\tfor (; 0 <= i; --i) {\n\t\t\tconst ip = i << 1;\n\t\t\tconst px = pointsValues[ip] + pointOffset.getX(i);\n\t\t\tconst py = pointsValues[ip + 1] + pointOffset.getY(i);\n\t\t\tconst dx = a * px + c * py;\n\t\t\tconst dy = b * px + d * py;\n\t\t\tlet ivd = iv << 1;\n\t\t\tlet ivs = voffset << 1;\n\t\t\tfor (let j = 0; j < vcountPerPoint; ++j) {\n\t\t\t\tvertices[ivd] = vertices[ivs] + dx;\n\t\t\t\tvertices[ivd + 1] = vertices[ivs + 1] + dy;\n\t\t\t\tivd += 2;\n\t\t\t\tivs += 2;\n\t\t\t}\n\t\t\tiv -= vcountPerPoint;\n\t\t}\n\t}\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { isNumber } from \"../../util/is-number\";\nimport { EShapeLineOfAnyValue } from \"./e-shape-line-of-any-value\";\n\nexport const isStatic = (value: EShapeLineOfAnyValue): boolean => {\n\treturn isNumber(value) || value == null;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { isFunction } from \"../../util/is-function\";\nimport { isNumber } from \"../../util/is-number\";\nimport { EShapeLineOfAnyValue } from \"./e-shape-line-of-any-value\";\n\nexport const toComputed = (index: number, value: EShapeLineOfAnyValue, def: number): number => {\n\tif (isNumber(value)) {\n\t\treturn value;\n\t} else if (isFunction(value)) {\n\t\treturn value(index);\n\t} else if (value) {\n\t\treturn value[index % value.length];\n\t}\n\treturn def;\n};\n","/*\n * Copyright (C) 2020 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeLineOfAnyPointsFill } from \"./e-shape-line-of-any-points-fill\";\nimport { EShapeLineOfAnyValue } from \"./e-shape-line-of-any-value\";\nimport { isStatic } from \"./is-static\";\nimport { toComputed } from \"./to-computed\";\n\nexport interface EShapeLineOfAnyPointsFillImplParent {\n\tupdateUploaded(): void;\n}\n\nexport class EShapeLineOfAnyPointsFillImpl implements EShapeLineOfAnyPointsFill {\n\tprotected _parent: EShapeLineOfAnyPointsFillImplParent;\n\tprotected _id: number;\n\tprotected _color: EShapeLineOfAnyValue;\n\tprotected _alpha: EShapeLineOfAnyValue;\n\n\tconstructor(parent: EShapeLineOfAnyPointsFillImplParent) {\n\t\tthis._parent = parent;\n\t\tthis._id = 0;\n\t\tthis._color = null;\n\t\tthis._alpha = null;\n\t}\n\n\tget id(): number {\n\t\treturn this._id;\n\t}\n\n\tget color(): EShapeLineOfAnyValue {\n\t\treturn this._color;\n\t}\n\n\tset color(color: EShapeLineOfAnyValue) {\n\t\tthis.set(color, undefined);\n\t}\n\n\tget alpha(): EShapeLineOfAnyValue {\n\t\treturn this._alpha;\n\t}\n\n\tset alpha(alpha: EShapeLineOfAnyValue) {\n\t\tthis.set(undefined, alpha);\n\t}\n\n\tset(color?: EShapeLineOfAnyValue, alpha?: EShapeLineOfAnyValue): void {\n\t\tlet isChanged = false;\n\n\t\tif (color !== undefined && this._color !== color) {\n\t\t\tisChanged = true;\n\t\t\tthis._color = color;\n\t\t}\n\n\t\tif (alpha !== undefined && this._alpha !== alpha) {\n\t\t\tisChanged = true;\n\t\t\tthis._alpha = alpha;\n\t\t}\n\n\t\tif (isChanged) {\n\t\t\tthis._id += 1;\n\t\t\tthis._parent.updateUploaded();\n\t\t}\n\t}\n\n\tgetColor(index: number, def: number): number {\n\t\treturn toComputed(index, this._color, def);\n\t}\n\n\tgetAlpha(index: number, def: number): number {\n\t\treturn toComputed(index, this._alpha, def);\n\t}\n\n\tisStaticColor(): boolean {\n\t\treturn isStatic(this._color);\n\t}\n\n\tisStaticAlpha(): boolean {\n\t\treturn isStatic(this._alpha);\n\t}\n\n\ttoDirty(): void {\n\t\tthis._id += 1;\n\t}\n}\n","/*\n * Copyright (C) 2020 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { isFunction } from \"../../util/is-function\";\nimport { isNumber } from \"../../util/is-number\";\nimport { EShapeLineOfAnyPointsPoint } from \"./e-shape-line-of-any-points-point\";\nimport { EShapeLineOfAnyValue } from \"./e-shape-line-of-any-value\";\nimport { isStatic } from \"./is-static\";\nimport { toComputed } from \"./to-computed\";\n\nexport interface EShapeLineOfAnyPointsPointImplParent {\n\treadonly length: number;\n\tupdateUploaded(): void;\n}\n\nexport class EShapeLineOfAnyPointsPointImpl implements EShapeLineOfAnyPointsPoint {\n\tprotected _parent: EShapeLineOfAnyPointsPointImplParent;\n\tprotected _id: number;\n\tprotected _x: EShapeLineOfAnyValue;\n\tprotected _y: EShapeLineOfAnyValue;\n\tprotected _defX: number;\n\tprotected _defY: number;\n\tprotected _limit: number | null;\n\tprotected _limitComputed: number;\n\tprotected _limitId: number;\n\tprotected _limitParentLength: number;\n\n\tconstructor(parent: EShapeLineOfAnyPointsPointImplParent, defX: number, defY: number) {\n\t\tthis._parent = parent;\n\t\tthis._id = 0;\n\t\tthis._x = null;\n\t\tthis._y = null;\n\t\tthis._defX = defX;\n\t\tthis._defY = defY;\n\t\tthis._limit = null;\n\t\tthis._limitComputed = 0;\n\t\tthis._limitId = -1;\n\t\tthis._limitParentLength = 0;\n\t}\n\n\tget id(): number {\n\t\treturn this._id;\n\t}\n\n\tget x(): EShapeLineOfAnyValue {\n\t\treturn this._x;\n\t}\n\n\tset x(x: EShapeLineOfAnyValue) {\n\t\tthis.set(x, undefined);\n\t}\n\n\tget y(): EShapeLineOfAnyValue {\n\t\treturn this._y;\n\t}\n\n\tset y(y: EShapeLineOfAnyValue) {\n\t\tthis.set(undefined, y);\n\t}\n\n\tget limit(): number | null {\n\t\treturn this._limit;\n\t}\n\n\tset limit(limit: number | null) {\n\t\tthis._limit = limit;\n\t}\n\n\tset(x?: EShapeLineOfAnyValue, y?: EShapeLineOfAnyValue): void {\n\t\tlet isChanged = false;\n\n\t\tif (x !== undefined && this._x !== x) {\n\t\t\tisChanged = true;\n\t\t\tthis._x = x;\n\t\t}\n\n\t\tif (y !== undefined && this._y !== y) {\n\t\t\tisChanged = true;\n\t\t\tthis._y = y;\n\t\t}\n\n\t\tif (isChanged) {\n\t\t\tthis._id += 1;\n\t\t\tthis._parent.updateUploaded();\n\t\t}\n\t}\n\n\tgetX(index: number): number {\n\t\treturn toComputed(index, this._x, this._defX);\n\t}\n\n\tgetY(index: number): number {\n\t\treturn toComputed(index, this._y, this._defY);\n\t}\n\n\tgetLimit(): number {\n\t\tconst limit = this._limit;\n\t\tif (limit != null) {\n\t\t\treturn limit;\n\t\t}\n\t\tthis.updateLimitComputed();\n\t\treturn this._limitComputed;\n\t}\n\n\tprotected updateLimitComputed(): void {\n\t\tconst limitId = this._id;\n\t\tconst parent = this._parent;\n\t\tconst limitParentLength = parent.length;\n\t\tif (this._limitId !== limitId || this._limitParentLength !== limitParentLength) {\n\t\t\tthis._limitId = limitId;\n\t\t\tthis._limitParentLength = limitParentLength;\n\t\t\tthis._limitComputed = Math.max(\n\t\t\t\tthis.calcLimit(this._x, limitParentLength, this._defX),\n\t\t\t\tthis.calcLimit(this._y, limitParentLength, this._defY)\n\t\t\t);\n\t\t}\n\t}\n\n\tprotected calcLimit(value: EShapeLineOfAnyValue, parentLenght: number, def: number): number {\n\t\tif (isNumber(value)) {\n\t\t\treturn Math.abs(value);\n\t\t} else if (isFunction(value)) {\n\t\t\tif (0 < parentLenght) {\n\t\t\t\tlet result = Math.abs(value(0));\n\t\t\t\tfor (let i = 1; i < parentLenght; ++i) {\n\t\t\t\t\tresult = Math.max(result, Math.abs(value(i)));\n\t\t\t\t}\n\t\t\t\treturn result;\n\t\t\t}\n\t\t\treturn 0;\n\t\t} else if (value != null) {\n\t\t\tconst l = value.length;\n\t\t\tif (0 < l) {\n\t\t\t\tlet result = value[0];\n\t\t\t\tfor (let i = 1; i < l; ++i) {\n\t\t\t\t\tresult = Math.max(result, Math.abs(value[i]));\n\t\t\t\t}\n\t\t\t\treturn result;\n\t\t\t}\n\t\t\treturn 0;\n\t\t} else {\n\t\t\treturn Math.abs(def);\n\t\t}\n\t}\n\n\tisStaticX(): boolean {\n\t\treturn isStatic(this._x);\n\t}\n\n\tisStaticY(): boolean {\n\t\treturn isStatic(this._y);\n\t}\n\n\ttoDirty(): void {\n\t\tthis._id += 1;\n\t}\n}\n","/*\n * Copyright (C) 2020 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeLineOfAnyPointsStroke } from \"./e-shape-line-of-any-points-stroke\";\nimport { EShapeLineOfAnyValue } from \"./e-shape-line-of-any-value\";\nimport { isStatic } from \"./is-static\";\nimport { toComputed } from \"./to-computed\";\n\nexport interface EShapeLineOfAnyPointsStrokeImplParent {\n\tupdateUploaded(): void;\n}\n\nexport class EShapeLineOfAnyPointsStrokeImpl implements EShapeLineOfAnyPointsStroke {\n\tprotected _parent: EShapeLineOfAnyPointsStrokeImplParent;\n\tprotected _id: number;\n\tprotected _color: EShapeLineOfAnyValue;\n\tprotected _alpha: EShapeLineOfAnyValue;\n\n\tconstructor(parent: EShapeLineOfAnyPointsStrokeImplParent) {\n\t\tthis._parent = parent;\n\t\tthis._id = 0;\n\t\tthis._color = null;\n\t\tthis._alpha = null;\n\t}\n\n\tget id(): number {\n\t\treturn this._id;\n\t}\n\n\tget color(): EShapeLineOfAnyValue {\n\t\treturn this._color;\n\t}\n\n\tset color(color: EShapeLineOfAnyValue) {\n\t\tthis.set(color, undefined);\n\t}\n\n\tget alpha(): EShapeLineOfAnyValue {\n\t\treturn this._alpha;\n\t}\n\n\tset alpha(alpha: EShapeLineOfAnyValue) {\n\t\tthis.set(undefined, alpha);\n\t}\n\n\tset(color?: EShapeLineOfAnyValue, alpha?: EShapeLineOfAnyValue): void {\n\t\tlet isChanged = false;\n\n\t\tif (color !== undefined && this._color !== color) {\n\t\t\tisChanged = true;\n\t\t\tthis._color = color;\n\t\t}\n\n\t\tif (alpha !== undefined && this._alpha !== alpha) {\n\t\t\tisChanged = true;\n\t\t\tthis._alpha = alpha;\n\t\t}\n\n\t\tif (isChanged) {\n\t\t\tthis._id += 1;\n\t\t\tthis._parent.updateUploaded();\n\t\t}\n\t}\n\n\tgetColor(index: number, def: number): number {\n\t\treturn toComputed(index, this._color, def);\n\t}\n\n\tgetAlpha(index: number, def: number): number {\n\t\treturn toComputed(index, this._alpha, def);\n\t}\n\n\tisStaticColor(): boolean {\n\t\treturn isStatic(this._color);\n\t}\n\n\tisStaticAlpha(): boolean {\n\t\treturn isStatic(this._alpha);\n\t}\n\n\ttoDirty(): void {\n\t\tthis._id += 1;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Matrix, Point } from \"pixi.js\";\nimport { EShape } from \"../e-shape\";\nimport { EShapeDefaults } from \"../e-shape-defaults\";\nimport { EShapePoints } from \"../e-shape-points\";\nimport { EShapePointsFormatter } from \"../e-shape-points-formatter\";\nimport { EShapePointsMarkerContainer } from \"../e-shape-points-marker-container\";\nimport { EShapePointsMarkerContainerImplNoop } from \"../e-shape-points-marker-container-impl-noop\";\nimport { EShapePointsStyle } from \"../e-shape-points-style\";\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\nimport { EShapeLineOfAnyPoints } from \"./e-shape-line-of-any-points\";\nimport { EShapeLineOfAnyPointsFill } from \"./e-shape-line-of-any-points-fill\";\nimport { EShapeLineOfAnyPointsFillImpl } from \"./e-shape-line-of-any-points-fill-impl\";\nimport { EShapeLineOfAnyPointsHitTester } from \"./e-shape-line-of-any-points-hit-tester\";\nimport { EShapeLineOfAnyPointsHitTesterToRange } from \"./e-shape-line-of-any-points-hit-tester-to-range\";\nimport { EShapeLineOfAnyPointsPoint } from \"./e-shape-line-of-any-points-point\";\nimport { EShapeLineOfAnyPointsPointImpl } from \"./e-shape-line-of-any-points-point-impl\";\nimport { EShapeLineOfAnyPointsStroke } from \"./e-shape-line-of-any-points-stroke\";\nimport { EShapeLineOfAnyPointsStrokeImpl } from \"./e-shape-line-of-any-points-stroke-impl\";\n\nexport class EShapeLineOfAnyPointsImpl implements EShapeLineOfAnyPoints {\n\tprotected static WORK_RANGE: [number, number] = [0, 0];\n\n\tprotected _parent: EShape;\n\tprotected _values: number[];\n\tprotected _valuesLength: number;\n\tprotected _segments: number[];\n\tprotected _size: EShapeLineOfAnyPointsPoint;\n\tprotected _offset: EShapeLineOfAnyPointsPoint;\n\tprotected _fill: EShapeLineOfAnyPointsFill;\n\tprotected _stroke: EShapeLineOfAnyPointsStroke;\n\tprotected _id: number;\n\tprotected _marker?: EShapePointsMarkerContainer;\n\n\tconstructor(parent: EShape) {\n\t\tthis._parent = parent;\n\t\tthis._values = [];\n\t\tthis._valuesLength = 0;\n\t\tthis._segments = [];\n\t\tthis._size = new EShapeLineOfAnyPointsPointImpl(\n\t\t\tthis,\n\t\t\tEShapeDefaults.SIZE_X,\n\t\t\tEShapeDefaults.SIZE_Y\n\t\t);\n\t\tthis._offset = new EShapeLineOfAnyPointsPointImpl(this, 0, 0);\n\t\tthis._fill = new EShapeLineOfAnyPointsFillImpl(parent);\n\t\tthis._stroke = new EShapeLineOfAnyPointsStrokeImpl(parent);\n\t\tthis._id = 0;\n\t}\n\n\tget length(): number {\n\t\treturn this._values.length >> 1;\n\t}\n\n\tget id(): number {\n\t\treturn this._id;\n\t}\n\n\tget values(): number[] {\n\t\treturn this._values;\n\t}\n\n\tset values(values: number[]) {\n\t\tthis.set(values, undefined, undefined);\n\t}\n\n\tget segments(): number[] {\n\t\treturn this._segments;\n\t}\n\n\tset segments(segments: number[]) {\n\t\t// DO NOTHING\n\t}\n\n\tget style(): EShapePointsStyle {\n\t\treturn EShapePointsStyle.NONE;\n\t}\n\n\tset style(style: EShapePointsStyle) {\n\t\tthis.set(undefined, undefined, style);\n\t}\n\n\tget marker(): EShapePointsMarkerContainer {\n\t\tlet result = this._marker;\n\t\tif (result == null) {\n\t\t\tresult = EShapePointsMarkerContainerImplNoop.getInstance();\n\t\t\tthis._marker = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tgetMarker(): EShapePointsMarkerContainer | undefined {\n\t\treturn undefined;\n\t}\n\n\tget size(): EShapeLineOfAnyPointsPoint {\n\t\treturn this._size;\n\t}\n\n\tget offset(): EShapeLineOfAnyPointsPoint {\n\t\treturn this._offset;\n\t}\n\n\tget fill(): EShapeLineOfAnyPointsFill {\n\t\treturn this._fill;\n\t}\n\n\tget stroke(): EShapeLineOfAnyPointsStroke {\n\t\treturn this._stroke;\n\t}\n\n\tget formatter(): EShapePointsFormatter | null {\n\t\treturn null;\n\t}\n\n\tset formatter(formatter: EShapePointsFormatter | null) {\n\t\t// DO NOTHING\n\t}\n\n\tget formatted(): this {\n\t\treturn this;\n\t}\n\n\tcopy(source: EShapePoints): this {\n\t\treturn this.set(source.values, source.segments, source.style);\n\t}\n\n\tset(newValues?: number[], newSegments?: number[], newStyle?: EShapePointsStyle): this {\n\t\tlet isDirty = false;\n\t\tlet isUpdated = false;\n\n\t\t// Values\n\t\tif (newValues != null) {\n\t\t\tconst values = this._values;\n\t\t\tconst valuesLength = this._valuesLength;\n\t\t\tconst newValuesLength = newValues.length;\n\t\t\tif (values !== newValues) {\n\t\t\t\tconst iupdate = Math.min(valuesLength, newValuesLength);\n\n\t\t\t\tfor (let i = 0; i < iupdate; ++i) {\n\t\t\t\t\tvalues[i] = newValues[i];\n\t\t\t\t}\n\n\t\t\t\tfor (let i = iupdate; i < newValuesLength; ++i) {\n\t\t\t\t\tvalues.push(newValues[i]);\n\t\t\t\t}\n\n\t\t\t\tif (valuesLength !== newValuesLength) {\n\t\t\t\t\tvalues.length = newValuesLength;\n\t\t\t\t\tthis._valuesLength = newValuesLength;\n\t\t\t\t\tisDirty = true;\n\t\t\t\t} else {\n\t\t\t\t\tisUpdated = true;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (valuesLength !== newValuesLength) {\n\t\t\t\t\tthis._valuesLength = newValuesLength;\n\t\t\t\t\tisDirty = true;\n\t\t\t\t} else {\n\t\t\t\t\tisUpdated = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t//\n\t\tif (isDirty) {\n\t\t\tthis._id += 1;\n\t\t\tconst parent = this._parent;\n\t\t\tconst uploaded = parent.uploaded;\n\t\t\tif (uploaded) {\n\t\t\t\tif (uploaded.isCompatible(parent)) {\n\t\t\t\t\tparent.updateUploaded();\n\t\t\t\t} else {\n\t\t\t\t\tparent.uploaded = undefined;\n\t\t\t\t\tparent.toDirty();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tparent.updateUploaded();\n\t\t\t}\n\t\t} else if (isUpdated) {\n\t\t\tthis._id += 1;\n\t\t\tthis._parent.updateUploaded();\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tupdateUploaded(): void {\n\t\tthis._parent.updateUploaded();\n\t}\n\n\tclone(parent: EShape): EShapeLineOfAnyPointsImpl {\n\t\treturn new EShapeLineOfAnyPointsImpl(parent).copy(this);\n\t}\n\n\ttoPoints(transform: Matrix): Point[] {\n\t\tconst result: Point[] = [];\n\t\tconst values = this.values;\n\t\tfor (let i = 0, imax = values.length; i < imax; i += 2) {\n\t\t\tconst point = new Point(values[i + 0], values[i + 1]);\n\t\t\tresult.push(transform.apply(point, point));\n\t\t}\n\t\treturn result;\n\t}\n\n\tserialize(manager: EShapeResourceManagerSerialization): number {\n\t\treturn manager.addResource(`[]`);\n\t}\n\n\tcalcHitPointAbs<RESULT>(\n\t\tx: number,\n\t\ty: number,\n\t\tsw: number,\n\t\tss: number,\n\t\tsa: number,\n\t\tthreshold: number,\n\t\ttoRange: EShapeLineOfAnyPointsHitTesterToRange | null,\n\t\ttester: EShapeLineOfAnyPointsHitTester<RESULT>,\n\t\tresult: RESULT\n\t): boolean {\n\t\tconst formatted = this.formatted;\n\t\tconst pointCount = formatted.length;\n\t\tconst pointValues = formatted.values;\n\t\tconst size = this._size;\n\t\tconst offset = this._offset;\n\t\tlet istart = 0;\n\t\tlet iend = pointCount;\n\t\tif (toRange) {\n\t\t\tconst s = size.getLimit() * 0.5;\n\t\t\tconst o = offset.getLimit();\n\t\t\tconst work = EShapeLineOfAnyPointsImpl.WORK_RANGE;\n\t\t\ttoRange(x, y, s, s, o, o, threshold, pointValues, work);\n\t\t\tistart = work[0];\n\t\t\tiend = work[1];\n\t\t}\n\t\tfor (let i = istart, imax = Math.min(iend, pointCount); i < imax; ++i) {\n\t\t\tconst iv = i << 1;\n\t\t\tconst px = pointValues[iv];\n\t\t\tconst py = pointValues[iv + 1];\n\t\t\tconst sx = size.getX(i) * 0.5;\n\t\t\tconst sy = size.getY(i) * 0.5;\n\t\t\tconst ox = offset.getX(i);\n\t\t\tconst oy = offset.getY(i);\n\t\t\tif (tester(x, y, sx, sy, ox, oy, px, py, sw, ss, sa, i, threshold, result)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeBuffer } from \"../e-shape-buffer\";\nimport {\n\tbuildCircleClipping,\n\tbuildCircleIndex,\n\tbuildCircleStep,\n\tbuildCircleUv,\n\tbuildCircleVertex,\n\tCIRCLE_INDEX_COUNT,\n\tCIRCLE_VERTEX_COUNT,\n\tCIRCLE_WORLD_SIZE\n} from \"./build-circle\";\nimport { buildNullStep, buildNullVertex } from \"./build-null\";\nimport { BuilderLineOfAny } from \"./builder-line-of-any\";\nimport { toTexture, toTextureTransformId, toTextureUvs, toTransformLocalId } from \"./builders\";\nimport { copyClipping } from \"./copy-clipping\";\nimport { copyIndex } from \"./copy-index\";\nimport { copyStep } from \"./copy-step\";\nimport { copyUvs } from \"./copy-uv\";\nimport { copyVertex } from \"./copy-vertex\";\nimport { EShapeLineOfAnyPoints } from \"./e-shape-line-of-any-points\";\nimport { EShapeLineOfAnyPointsImpl } from \"./e-shape-line-of-any-points-impl\";\n\nexport class BuilderLineOfCircles extends BuilderLineOfAny {\n\tinit(buffer: EShapeBuffer): void {\n\t\tbuffer.updateClippings();\n\t\tbuffer.updateIndices();\n\t\tconst clippings = buffer.clippings;\n\t\tconst indices = buffer.indices;\n\t\tconst voffset = this.vertexOffset;\n\t\tconst ioffset = this.indexOffset;\n\t\tconst pointCountReserved = this.pointCountReserved;\n\t\tif (0 < pointCountReserved) {\n\t\t\tbuildCircleClipping(clippings, voffset);\n\t\t\tcopyClipping(clippings, voffset, CIRCLE_VERTEX_COUNT, pointCountReserved);\n\t\t\tbuildCircleIndex(indices, voffset, ioffset);\n\t\t\tcopyIndex(\n\t\t\t\tindices,\n\t\t\t\tCIRCLE_VERTEX_COUNT,\n\t\t\t\tioffset,\n\t\t\t\tCIRCLE_INDEX_COUNT,\n\t\t\t\tpointCountReserved\n\t\t\t);\n\t\t}\n\t}\n\n\tupdate(buffer: EShapeBuffer, shape: EShape): void {\n\t\tconst points = shape.points;\n\t\tif (points instanceof EShapeLineOfAnyPointsImpl) {\n\t\t\tthis.updateVertexAndStep(buffer, shape, points);\n\t\t\tthis.updateLineOfAnyColorFill(buffer, shape, points, CIRCLE_VERTEX_COUNT);\n\t\t\tthis.updateLineOfAnyColorStroke(buffer, shape, points, CIRCLE_VERTEX_COUNT);\n\t\t\tthis.updateUv(buffer, shape);\n\t\t}\n\t}\n\n\tprotected updateVertexAndStep(\n\t\tbuffer: EShapeBuffer,\n\t\tshape: EShape,\n\t\tpoints: EShapeLineOfAnyPoints\n\t): void {\n\t\tconst pointId = points.id;\n\t\tconst pointOffset = points.offset;\n\t\tconst pointOffsetId = pointOffset.id;\n\t\tconst isPointChanged = pointId !== this.pointId || pointOffsetId !== this.pointOffsetId;\n\n\t\tconst pointSize = points.size;\n\t\tconst pointSizeId = pointSize.id;\n\t\tconst isPointSizeChanged = pointSizeId !== this.pointSizeId;\n\n\t\tconst size = shape.size;\n\t\tconst sizeX = size.x;\n\t\tconst sizeY = size.y;\n\t\tconst isSizeChanged = sizeX !== this.sizeX || sizeY !== this.sizeY;\n\n\t\tconst transformLocalId = toTransformLocalId(shape);\n\t\tconst isTransformChanged = this.transformLocalId !== transformLocalId;\n\n\t\tconst stroke = shape.stroke;\n\t\tconst strokeAlign = stroke.align;\n\t\tconst strokeWidth = stroke.enable ? stroke.width : 0;\n\t\tconst strokeStyle = stroke.style;\n\t\tconst isStrokeChanged =\n\t\t\tthis.strokeAlign !== strokeAlign ||\n\t\t\tthis.strokeWidth !== strokeWidth ||\n\t\t\tthis.strokeStyle !== strokeStyle;\n\n\t\tif (\n\t\t\tisPointChanged ||\n\t\t\tisPointSizeChanged ||\n\t\t\tisSizeChanged ||\n\t\t\tisTransformChanged ||\n\t\t\tisStrokeChanged\n\t\t) {\n\t\t\tthis.pointId = pointId;\n\t\t\tconst formatted = points.formatted;\n\t\t\tthis.pointCount = formatted.length;\n\t\t\tthis.pointOffsetId = pointOffsetId;\n\t\t\tthis.pointSizeId = pointSizeId;\n\t\t\tthis.sizeX = sizeX;\n\t\t\tthis.sizeY = sizeY;\n\t\t\tthis.transformLocalId = transformLocalId;\n\t\t\tthis.strokeWidth = strokeWidth;\n\t\t\tthis.strokeAlign = strokeAlign;\n\t\t\tthis.strokeStyle = strokeStyle;\n\n\t\t\t// Buffer\n\t\t\tbuffer.updateVertices();\n\t\t\tbuffer.updateSteps();\n\t\t\tconst pointCount = this.pointCount;\n\t\t\tconst pointsValues = formatted.values;\n\t\t\tconst voffset = this.vertexOffset;\n\t\t\tconst vertices = buffer.vertices;\n\t\t\tconst steps = buffer.steps;\n\t\t\tconst clippings = buffer.clippings;\n\t\t\tconst internalTransform = shape.transform.internalTransform;\n\t\t\tif (0 < pointCount && pointSize.isStaticX() && pointSize.isStaticY()) {\n\t\t\t\tconst pointSizeX = pointSize.getX(0);\n\t\t\t\tconst pointSizeY = pointSize.getY(0);\n\n\t\t\t\tbuildCircleVertex(\n\t\t\t\t\tvertices,\n\t\t\t\t\tvoffset,\n\t\t\t\t\t0,\n\t\t\t\t\t0,\n\t\t\t\t\tpointSizeX,\n\t\t\t\t\tpointSizeY,\n\t\t\t\t\tstrokeAlign,\n\t\t\t\t\tstrokeWidth,\n\t\t\t\t\tinternalTransform,\n\t\t\t\t\tCIRCLE_WORLD_SIZE\n\t\t\t\t);\n\t\t\t\tcopyVertex(\n\t\t\t\t\tvertices,\n\t\t\t\t\tinternalTransform,\n\t\t\t\t\tvoffset,\n\t\t\t\t\tCIRCLE_VERTEX_COUNT,\n\t\t\t\t\tpointCount,\n\t\t\t\t\tpointsValues,\n\t\t\t\t\tpointOffset\n\t\t\t\t);\n\t\t\t\tbuildCircleStep(\n\t\t\t\t\tsteps,\n\t\t\t\t\tclippings,\n\t\t\t\t\tvoffset,\n\t\t\t\t\tstrokeWidth,\n\t\t\t\t\tstrokeStyle,\n\t\t\t\t\tCIRCLE_WORLD_SIZE\n\t\t\t\t);\n\t\t\t\tcopyStep(steps, voffset, CIRCLE_VERTEX_COUNT, pointCount);\n\t\t\t} else {\n\t\t\t\tfor (let i = 0; i < pointCount; ++i) {\n\t\t\t\t\tconst ip = i << 1;\n\t\t\t\t\tconst px = pointsValues[ip] + pointOffset.getX(i);\n\t\t\t\t\tconst py = pointsValues[ip + 1] + pointOffset.getY(i);\n\t\t\t\t\tconst pointSizeX = pointSize.getX(i);\n\t\t\t\t\tconst pointSizeY = pointSize.getY(i);\n\t\t\t\t\tconst iv = voffset + i * CIRCLE_VERTEX_COUNT;\n\t\t\t\t\tbuildCircleVertex(\n\t\t\t\t\t\tvertices,\n\t\t\t\t\t\tiv,\n\t\t\t\t\t\tpx,\n\t\t\t\t\t\tpy,\n\t\t\t\t\t\tpointSizeX,\n\t\t\t\t\t\tpointSizeY,\n\t\t\t\t\t\tstrokeAlign,\n\t\t\t\t\t\tstrokeWidth,\n\t\t\t\t\t\tinternalTransform,\n\t\t\t\t\t\tCIRCLE_WORLD_SIZE\n\t\t\t\t\t);\n\t\t\t\t\tbuildCircleStep(\n\t\t\t\t\t\tsteps,\n\t\t\t\t\t\tclippings,\n\t\t\t\t\t\tiv,\n\t\t\t\t\t\tstrokeWidth,\n\t\t\t\t\t\tstrokeStyle,\n\t\t\t\t\t\tCIRCLE_WORLD_SIZE\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Fill the rest\n\t\t\tconst pointCountReserved = this.pointCountReserved;\n\t\t\tconst voffsetReserved = voffset + pointCount * CIRCLE_VERTEX_COUNT;\n\t\t\tconst vcountReserved = CIRCLE_VERTEX_COUNT * (pointCountReserved - pointCount);\n\t\t\tbuildNullVertex(vertices, voffsetReserved, vcountReserved);\n\t\t\tbuildNullStep(steps, voffsetReserved, vcountReserved);\n\t\t}\n\t}\n\n\tprotected updateUv(buffer: EShapeBuffer, shape: EShape): void {\n\t\tconst texture = toTexture(shape);\n\t\tconst textureTransformId = toTextureTransformId(texture);\n\t\tif (texture !== this.texture || textureTransformId !== this.textureTransformId) {\n\t\t\tthis.texture = texture;\n\t\t\tthis.textureTransformId = textureTransformId;\n\n\t\t\tbuffer.updateUvs();\n\t\t\tconst uvs = buffer.uvs;\n\t\t\tconst voffset = this.vertexOffset;\n\t\t\tconst textureUvs = toTextureUvs(texture);\n\t\t\tconst pointCountReserved = this.pointCountReserved;\n\t\t\tif (0 < pointCountReserved) {\n\t\t\t\tbuildCircleUv(uvs, voffset, textureUvs);\n\t\t\t\tcopyUvs(uvs, voffset, CIRCLE_VERTEX_COUNT, pointCountReserved);\n\t\t\t}\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeBuffer } from \"../e-shape-buffer\";\nimport { EShapeUploaded, EShapeUploadedImpl } from \"../e-shape-uploaded\";\nimport { toPointsCount } from \"./build-line\";\nimport { toLineOfAnyPointCount } from \"./build-line-of-any\";\nimport { TEXT_INDEX_COUNT, TEXT_VERTEX_COUNT, toTextBufferCount } from \"./build-text\";\nimport { Builder } from \"./builder\";\nimport { BuilderText } from \"./builder-text\";\n\nexport type BuilderConstructor = new (\n\tvertexOffset: number,\n\tindexOffset: number,\n\tvertexCount: number,\n\tindexCount: number,\n\tpointCount: number\n) => Builder;\n\nexport const createLineOfAnyUploaded = (\n\tbuffer: EShapeBuffer,\n\tshape: EShape,\n\tvoffset: number,\n\tvcountPerPoint: number,\n\tioffset: number,\n\ticountPerPoint: number,\n\tantialiasWeight: number,\n\tconstructor: BuilderConstructor\n): EShapeUploaded | null => {\n\tconst tcount = toTextBufferCount(shape);\n\tconst tvcount = tcount * TEXT_VERTEX_COUNT;\n\tconst ticount = tcount * TEXT_INDEX_COUNT;\n\tconst points = shape.points;\n\tconst pointCount = toLineOfAnyPointCount(toPointsCount(points));\n\tconst pvcount = pointCount * vcountPerPoint;\n\tconst picount = pointCount * icountPerPoint;\n\tconst vcount = pvcount + tvcount;\n\tconst icount = picount + ticount;\n\tif (buffer.check(voffset, ioffset, vcount, icount)) {\n\t\treturn new EShapeUploadedImpl(buffer, voffset, ioffset, vcount, icount, [\n\t\t\tnew constructor(voffset, ioffset, pvcount, picount, pointCount),\n\t\t\tnew BuilderText(voffset + pvcount, ioffset + picount, tvcount, ticount)\n\t\t]).init(shape);\n\t}\n\treturn null;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeBuffer } from \"../e-shape-buffer\";\nimport { EShapeUploaded } from \"../e-shape-uploaded\";\nimport { CIRCLE_INDEX_COUNT, CIRCLE_VERTEX_COUNT } from \"./build-circle\";\nimport { BuilderLineOfCircles } from \"./builder-line-of-circles\";\nimport { createLineOfAnyUploaded } from \"./create-line-of-any-uploaded\";\n\nexport const createLineOfCirclesUploaded = (\n\tbuffer: EShapeBuffer,\n\tshape: EShape,\n\tvoffset: number,\n\tioffset: number,\n\tantialiasWeight: number\n): EShapeUploaded | null => {\n\treturn createLineOfAnyUploaded(\n\t\tbuffer,\n\t\tshape,\n\t\tvoffset,\n\t\tCIRCLE_VERTEX_COUNT,\n\t\tioffset,\n\t\tCIRCLE_INDEX_COUNT,\n\t\tantialiasWeight,\n\t\tBuilderLineOfCircles\n\t);\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapeCircle } from \"./e-shape-circle\";\nimport { EShapeLineOfAny } from \"./e-shape-line-of-any\";\nimport { EShapeLineOfAnyPoints } from \"./e-shape-line-of-any-points\";\nimport { EShapeLineOfAnyPointsHitTester } from \"./e-shape-line-of-any-points-hit-tester\";\nimport { EShapeLineOfAnyPointsHitTesterToRange } from \"./e-shape-line-of-any-points-hit-tester-to-range\";\nimport { EShapeLineOfAnyPointsHitTesterToThreshold } from \"./e-shape-line-of-any-points-hit-tester-to-threshold\";\nimport { EShapeLineOfAnyPointsImpl } from \"./e-shape-line-of-any-points-impl\";\nimport { toThresholdDefault } from \"./to-threshold-default\";\n\nexport class EShapeLineOfCircles extends EShapeCircle implements EShapeLineOfAny {\n\tprotected declare _points: EShapeLineOfAnyPoints;\n\tprotected _tester: EShapeLineOfAnyPointsHitTester<unknown>;\n\n\tconstructor(type: EShapeType = EShapeType.LINE_OF_CIRCLES) {\n\t\tsuper(type);\n\t\tthis._points = new EShapeLineOfAnyPointsImpl(this);\n\n\t\tthis._tester = (x, y, ax, ay, ox, oy, px, py, sw, ss, sa): boolean => {\n\t\t\treturn this.containsPointAbs(x, y, ax, ay, ox, oy, px, py, sw, ss, sa);\n\t\t};\n\t}\n\n\tget points(): EShapeLineOfAnyPoints {\n\t\treturn this._points;\n\t}\n\n\tclone(): EShapeLineOfCircles {\n\t\treturn new EShapeLineOfCircles(this.type).copy(this);\n\t}\n\n\tcontainsAbs(\n\t\tx: number,\n\t\ty: number,\n\t\tax: number,\n\t\tay: number,\n\t\tsw: number,\n\t\tss: number,\n\t\tsa: number\n\t): boolean {\n\t\tconst threshold = toThresholdDefault(sw, ss, this._points.size.getLimit());\n\t\tif (this.containsAbsBBox(x, y, ax + threshold, ay + threshold)) {\n\t\t\treturn this._points.calcHitPointAbs(\n\t\t\t\tx,\n\t\t\t\ty,\n\t\t\t\tsw,\n\t\t\t\tss,\n\t\t\t\tsa,\n\t\t\t\tthreshold,\n\t\t\t\tnull,\n\t\t\t\tthis._tester,\n\t\t\t\tnull\n\t\t\t);\n\t\t}\n\t\treturn false;\n\t}\n\n\tcontainsPointAbs(\n\t\tx: number,\n\t\ty: number,\n\t\tax: number,\n\t\tay: number,\n\t\tox: number,\n\t\toy: number,\n\t\tpx: number,\n\t\tpy: number,\n\t\tsw: number,\n\t\tss: number,\n\t\tsa: number\n\t): boolean {\n\t\treturn super.containsAbs(x - px - ox, y - py - oy, ax, ay, sw, ss, sa);\n\t}\n\n\tcalcHitPoint<RESULT>(\n\t\tx: number,\n\t\ty: number,\n\t\ttoThreshold: EShapeLineOfAnyPointsHitTesterToThreshold | null,\n\t\ttoRange: EShapeLineOfAnyPointsHitTesterToRange | null,\n\t\ttester: EShapeLineOfAnyPointsHitTester<RESULT> | null,\n\t\tresult: RESULT\n\t): boolean {\n\t\tconst data = this.toHitTestData(x, y);\n\t\tconst threshold = (toThreshold || toThresholdDefault)(\n\t\t\tdata.strokeWidth,\n\t\t\tdata.strokeScale,\n\t\t\tthis._points.size.getLimit()\n\t\t);\n\t\tif (this.containsAbsBBox(data.x, data.y, data.width + threshold, data.height + threshold)) {\n\t\t\treturn this._points.calcHitPointAbs(\n\t\t\t\tdata.x,\n\t\t\t\tdata.y,\n\t\t\t\tdata.strokeWidth,\n\t\t\t\tdata.strokeScale,\n\t\t\t\tdata.strokeAlign,\n\t\t\t\tthreshold,\n\t\t\t\ttoRange,\n\t\t\t\ttester || this._tester,\n\t\t\t\tresult\n\t\t\t);\n\t\t}\n\t\treturn false;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { deserializeBase } from \"./deserialize-base\";\nimport { EShapeLineOfCircles } from \"./e-shape-line-of-circles\";\n\nexport const deserializeLineOfCircles = (\n\titem: DDiagramSerializedItem,\n\tmanager: EShapeResourceManagerDeserialization,\n\tshape?: EShapeLineOfCircles\n): Promise<EShapeLineOfCircles> | EShapeLineOfCircles => {\n\treturn deserializeBase(item, manager, shape || new EShapeLineOfCircles());\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeDeserializers } from \"../e-shape-deserializers\";\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapeUploadeds } from \"../e-shape-uploadeds\";\nimport { createLineOfCirclesUploaded } from \"../variant/create-line-of-circles-uploaded\";\nimport { deserializeLineOfCircles } from \"../variant/deserialize-line-of-circles\";\n\nexport const loadShapeLineOfCircles = (): void => {\n\tEShapeUploadeds[EShapeType.LINE_OF_CIRCLES] = createLineOfCirclesUploaded;\n\tEShapeDeserializers[EShapeType.LINE_OF_CIRCLES] = deserializeLineOfCircles;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeBuffer } from \"../e-shape-buffer\";\nimport { EShapeCorner } from \"../e-shape-corner\";\nimport { buildNullClipping, buildNullStep, buildNullUv, buildNullVertex } from \"./build-null\";\nimport {\n\tbuildRectangleRoundedClipping,\n\tbuildRectangleRoundedIndex,\n\tbuildRectangleRoundedStep,\n\tbuildRectangleRoundedUv,\n\tbuildRectangleRoundedVertex,\n\tRECTANGLE_ROUNDED_INDEX_COUNT,\n\tRECTANGLE_ROUNDED_VERTEX_COUNT,\n\tRECTANGLE_ROUNDED_WORLD_SIZE\n} from \"./build-rectangle-rounded\";\nimport { BuilderLineOfAny } from \"./builder-line-of-any\";\nimport { toTexture, toTextureTransformId, toTextureUvs, toTransformLocalId } from \"./builders\";\nimport { copyClipping } from \"./copy-clipping\";\nimport { copyIndex } from \"./copy-index\";\nimport { copyStep } from \"./copy-step\";\nimport { copyUvs } from \"./copy-uv\";\nimport { copyVertex } from \"./copy-vertex\";\nimport { EShapeLineOfAnyPoints } from \"./e-shape-line-of-any-points\";\nimport { EShapeLineOfAnyPointsImpl } from \"./e-shape-line-of-any-points-impl\";\n\nexport class BuilderLineOfRectangleRoundeds extends BuilderLineOfAny {\n\tprotected radius: number;\n\tprotected corner: EShapeCorner;\n\n\tconstructor(\n\t\tvertexOffset: number,\n\t\tindexOffset: number,\n\t\tvertexCount: number,\n\t\tindexCount: number,\n\t\tpointCountReserved: number\n\t) {\n\t\tsuper(vertexOffset, indexOffset, vertexCount, indexCount, pointCountReserved);\n\t\tthis.radius = NaN;\n\t\tthis.corner = NaN;\n\t}\n\n\tinit(buffer: EShapeBuffer): void {\n\t\tbuffer.updateIndices();\n\t\tconst indices = buffer.indices;\n\t\tconst voffset = this.vertexOffset;\n\t\tconst ioffset = this.indexOffset;\n\t\tconst pointCountReserved = this.pointCountReserved;\n\t\tif (0 < pointCountReserved) {\n\t\t\tbuildRectangleRoundedIndex(indices, voffset, ioffset);\n\t\t\tcopyIndex(\n\t\t\t\tindices,\n\t\t\t\tRECTANGLE_ROUNDED_VERTEX_COUNT,\n\t\t\t\tioffset,\n\t\t\t\tRECTANGLE_ROUNDED_INDEX_COUNT,\n\t\t\t\tpointCountReserved\n\t\t\t);\n\t\t}\n\t}\n\n\tupdate(buffer: EShapeBuffer, shape: EShape): void {\n\t\tconst points = shape.points;\n\t\tif (points instanceof EShapeLineOfAnyPointsImpl) {\n\t\t\tthis.updateVertexClippingStepAndUv(buffer, shape, points);\n\t\t\tthis.updateLineOfAnyColorFill(buffer, shape, points, RECTANGLE_ROUNDED_VERTEX_COUNT);\n\t\t\tthis.updateLineOfAnyColorStroke(buffer, shape, points, RECTANGLE_ROUNDED_VERTEX_COUNT);\n\t\t}\n\t}\n\n\tprotected updateVertexClippingStepAndUv(\n\t\tbuffer: EShapeBuffer,\n\t\tshape: EShape,\n\t\tpoints: EShapeLineOfAnyPoints\n\t): void {\n\t\tconst pointId = points.id;\n\t\tconst pointOffset = points.offset;\n\t\tconst pointOffsetId = pointOffset.id;\n\t\tconst isPointChanged = pointId !== this.pointId || pointOffsetId !== this.pointOffsetId;\n\n\t\tconst pointSize = points.size;\n\t\tconst pointSizeId = pointSize.id;\n\t\tconst isPointSizeChanged = pointSizeId !== this.pointSizeId;\n\n\t\tconst size = shape.size;\n\t\tconst sizeX = size.x;\n\t\tconst sizeY = size.y;\n\t\tconst radius = shape.radius;\n\t\tconst isSizeChanged =\n\t\t\tsizeX !== this.sizeX || sizeY !== this.sizeY || radius !== this.radius;\n\n\t\tconst transformLocalId = toTransformLocalId(shape);\n\t\tconst isTransformChanged = this.transformLocalId !== transformLocalId;\n\n\t\tconst stroke = shape.stroke;\n\t\tconst strokeAlign = stroke.align;\n\t\tconst strokeWidth = stroke.enable ? stroke.width : 0;\n\t\tconst strokeSide = stroke.side;\n\t\tconst strokeStyle = stroke.style;\n\t\tconst isStrokeChanged =\n\t\t\tthis.strokeAlign !== strokeAlign ||\n\t\t\tthis.strokeWidth !== strokeWidth ||\n\t\t\tthis.strokeSide !== strokeSide ||\n\t\t\tthis.strokeStyle !== strokeStyle;\n\n\t\tconst corner = shape.corner;\n\t\tconst isCornerChanged = corner !== this.corner;\n\n\t\tconst texture = toTexture(shape);\n\t\tconst textureTransformId = toTextureTransformId(texture);\n\t\tconst isTextureChanged =\n\t\t\ttexture !== this.texture || textureTransformId !== this.textureTransformId;\n\n\t\tconst isVertexChanged =\n\t\t\tisPointChanged || isPointSizeChanged || isSizeChanged || isStrokeChanged;\n\n\t\tif (isVertexChanged || isTransformChanged || isCornerChanged || isTextureChanged) {\n\t\t\tthis.pointId = pointId;\n\t\t\tconst formatted = points.formatted;\n\t\t\tthis.pointCount = formatted.length;\n\t\t\tthis.pointOffsetId = pointOffsetId;\n\t\t\tthis.pointSizeId = pointSizeId;\n\t\t\tthis.sizeX = sizeX;\n\t\t\tthis.sizeY = sizeY;\n\t\t\tthis.radius = radius;\n\t\t\tthis.transformLocalId = transformLocalId;\n\t\t\tthis.strokeAlign = strokeAlign;\n\t\t\tthis.strokeWidth = strokeWidth;\n\t\t\tthis.strokeSide = strokeSide;\n\t\t\tthis.strokeStyle = strokeStyle;\n\t\t\tthis.corner = corner;\n\t\t\tthis.texture = texture;\n\t\t\tthis.textureTransformId = textureTransformId;\n\n\t\t\t// Buffer\n\t\t\tbuffer.updateVertices();\n\t\t\tif (isVertexChanged || isTransformChanged) {\n\t\t\t\tbuffer.updateSteps();\n\t\t\t}\n\t\t\tif (isVertexChanged || isCornerChanged) {\n\t\t\t\tbuffer.updateClippings();\n\t\t\t}\n\t\t\tif (isVertexChanged || isTextureChanged) {\n\t\t\t\tbuffer.updateUvs();\n\t\t\t}\n\t\t\tconst pointCount = this.pointCount;\n\t\t\tconst pointsValues = formatted.values;\n\t\t\tconst voffset = this.vertexOffset;\n\t\t\tconst vertices = buffer.vertices;\n\t\t\tconst clippings = buffer.clippings;\n\t\t\tconst steps = buffer.steps;\n\t\t\tconst uvs = buffer.uvs;\n\t\t\tconst internalTransform = shape.transform.internalTransform;\n\t\t\tconst textureUvs = toTextureUvs(texture);\n\t\t\tif (0 < pointCount && pointSize.isStaticX() && pointSize.isStaticY()) {\n\t\t\t\tconst pointSizeX = pointSize.getX(0);\n\t\t\t\tconst pointSizeY = pointSize.getY(0);\n\n\t\t\t\t// Vertices\n\t\t\t\tbuildRectangleRoundedVertex(\n\t\t\t\t\tvertices,\n\t\t\t\t\tvoffset,\n\t\t\t\t\t0,\n\t\t\t\t\t0,\n\t\t\t\t\tpointSizeX,\n\t\t\t\t\tpointSizeY,\n\t\t\t\t\tstrokeAlign,\n\t\t\t\t\tstrokeWidth,\n\t\t\t\t\tradius,\n\t\t\t\t\tinternalTransform,\n\t\t\t\t\tRECTANGLE_ROUNDED_WORLD_SIZE\n\t\t\t\t);\n\t\t\t\tcopyVertex(\n\t\t\t\t\tvertices,\n\t\t\t\t\tinternalTransform,\n\t\t\t\t\tvoffset,\n\t\t\t\t\tRECTANGLE_ROUNDED_VERTEX_COUNT,\n\t\t\t\t\tpointCount,\n\t\t\t\t\tpointsValues,\n\t\t\t\t\tpointOffset\n\t\t\t\t);\n\n\t\t\t\t// Steps\n\t\t\t\tif (isVertexChanged || isTransformChanged) {\n\t\t\t\t\tbuildRectangleRoundedStep(\n\t\t\t\t\t\tsteps,\n\t\t\t\t\t\tvoffset,\n\t\t\t\t\t\tstrokeWidth,\n\t\t\t\t\t\tstrokeSide,\n\t\t\t\t\t\tstrokeStyle,\n\t\t\t\t\t\tcorner,\n\t\t\t\t\t\tRECTANGLE_ROUNDED_WORLD_SIZE\n\t\t\t\t\t);\n\t\t\t\t\tcopyStep(steps, voffset, RECTANGLE_ROUNDED_VERTEX_COUNT, pointCount);\n\t\t\t\t}\n\n\t\t\t\t// Clippings\n\t\t\t\tif (isVertexChanged || isCornerChanged) {\n\t\t\t\t\tbuildRectangleRoundedClipping(\n\t\t\t\t\t\tclippings,\n\t\t\t\t\t\tvoffset,\n\t\t\t\t\t\tcorner,\n\t\t\t\t\t\tRECTANGLE_ROUNDED_WORLD_SIZE\n\t\t\t\t\t);\n\t\t\t\t\tcopyClipping(clippings, voffset, RECTANGLE_ROUNDED_VERTEX_COUNT, pointCount);\n\t\t\t\t}\n\n\t\t\t\t// UVs\n\t\t\t\tif (isVertexChanged || isTextureChanged) {\n\t\t\t\t\tbuildRectangleRoundedUv(uvs, voffset, textureUvs, RECTANGLE_ROUNDED_WORLD_SIZE);\n\t\t\t\t\tcopyUvs(uvs, voffset, RECTANGLE_ROUNDED_VERTEX_COUNT, pointCount);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (let i = 0; i < pointCount; ++i) {\n\t\t\t\t\tconst ip = i << 1;\n\t\t\t\t\tconst px = pointsValues[ip] + pointOffset.getX(i);\n\t\t\t\t\tconst py = pointsValues[ip + 1] + pointOffset.getY(i);\n\t\t\t\t\tconst pointSizeX = pointSize.getX(i);\n\t\t\t\t\tconst pointSizeY = pointSize.getY(i);\n\n\t\t\t\t\tconst iv = voffset + i * RECTANGLE_ROUNDED_VERTEX_COUNT;\n\n\t\t\t\t\t// Vertices\n\t\t\t\t\tbuildRectangleRoundedVertex(\n\t\t\t\t\t\tvertices,\n\t\t\t\t\t\tiv,\n\t\t\t\t\t\tpx,\n\t\t\t\t\t\tpy,\n\t\t\t\t\t\tpointSizeX,\n\t\t\t\t\t\tpointSizeY,\n\t\t\t\t\t\tstrokeAlign,\n\t\t\t\t\t\tstrokeWidth,\n\t\t\t\t\t\tradius,\n\t\t\t\t\t\tinternalTransform,\n\t\t\t\t\t\tRECTANGLE_ROUNDED_WORLD_SIZE\n\t\t\t\t\t);\n\n\t\t\t\t\t// Steps\n\t\t\t\t\tif (isVertexChanged || isTransformChanged) {\n\t\t\t\t\t\tbuildRectangleRoundedStep(\n\t\t\t\t\t\t\tsteps,\n\t\t\t\t\t\t\tiv,\n\t\t\t\t\t\t\tstrokeWidth,\n\t\t\t\t\t\t\tstrokeSide,\n\t\t\t\t\t\t\tstrokeStyle,\n\t\t\t\t\t\t\tcorner,\n\t\t\t\t\t\t\tRECTANGLE_ROUNDED_WORLD_SIZE\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Clippings\n\t\t\t\t\tif (isVertexChanged || isCornerChanged) {\n\t\t\t\t\t\tbuildRectangleRoundedClipping(\n\t\t\t\t\t\t\tclippings,\n\t\t\t\t\t\t\tiv,\n\t\t\t\t\t\t\tcorner,\n\t\t\t\t\t\t\tRECTANGLE_ROUNDED_WORLD_SIZE\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\t// UVs\n\t\t\t\t\tif (isVertexChanged || isTextureChanged) {\n\t\t\t\t\t\tbuildRectangleRoundedUv(uvs, iv, textureUvs, RECTANGLE_ROUNDED_WORLD_SIZE);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Fill the rest\n\t\t\tconst pointCountReserved = this.pointCountReserved;\n\t\t\tconst voffsetReserved = voffset + pointCount * RECTANGLE_ROUNDED_VERTEX_COUNT;\n\t\t\tconst vcountReserved =\n\t\t\t\tRECTANGLE_ROUNDED_VERTEX_COUNT * (pointCountReserved - pointCount);\n\t\t\tbuildNullVertex(vertices, voffsetReserved, vcountReserved);\n\t\t\tbuildNullStep(steps, voffsetReserved, vcountReserved);\n\t\t\tbuildNullClipping(clippings, voffsetReserved, vcountReserved);\n\t\t\tbuildNullUv(uvs, voffsetReserved, vcountReserved);\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeBuffer } from \"../e-shape-buffer\";\nimport { EShapeUploaded } from \"../e-shape-uploaded\";\nimport {\n\tRECTANGLE_ROUNDED_INDEX_COUNT,\n\tRECTANGLE_ROUNDED_VERTEX_COUNT\n} from \"./build-rectangle-rounded\";\nimport { BuilderLineOfRectangleRoundeds } from \"./builder-line-of-rectangle-roundeds\";\nimport { createLineOfAnyUploaded } from \"./create-line-of-any-uploaded\";\n\nexport const createLineOfRectangleRoundedsUploaded = (\n\tbuffer: EShapeBuffer,\n\tshape: EShape,\n\tvoffset: number,\n\tioffset: number,\n\tantialiasWeight: number\n): EShapeUploaded | null => {\n\treturn createLineOfAnyUploaded(\n\t\tbuffer,\n\t\tshape,\n\t\tvoffset,\n\t\tRECTANGLE_ROUNDED_VERTEX_COUNT,\n\t\tioffset,\n\t\tRECTANGLE_ROUNDED_INDEX_COUNT,\n\t\tantialiasWeight,\n\t\tBuilderLineOfRectangleRoundeds\n\t);\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapeLineOfAny } from \"./e-shape-line-of-any\";\nimport { EShapeLineOfAnyPoints } from \"./e-shape-line-of-any-points\";\nimport { EShapeLineOfAnyPointsHitTester } from \"./e-shape-line-of-any-points-hit-tester\";\nimport { EShapeLineOfAnyPointsHitTesterToRange } from \"./e-shape-line-of-any-points-hit-tester-to-range\";\nimport { EShapeLineOfAnyPointsHitTesterToThreshold } from \"./e-shape-line-of-any-points-hit-tester-to-threshold\";\nimport { EShapeLineOfAnyPointsImpl } from \"./e-shape-line-of-any-points-impl\";\nimport { EShapeRectangleRounded } from \"./e-shape-rectangle-rounded\";\nimport { toThresholdDefault } from \"./to-threshold-default\";\n\nexport class EShapeLineOfRectangleRoundeds\n\textends EShapeRectangleRounded\n\timplements EShapeLineOfAny\n{\n\tprotected declare _points: EShapeLineOfAnyPoints;\n\tprotected _tester: EShapeLineOfAnyPointsHitTester<unknown>;\n\n\tconstructor(type: EShapeType = EShapeType.LINE_OF_RECTANGLE_ROUNDEDS) {\n\t\tsuper(type);\n\t\tthis._points = new EShapeLineOfAnyPointsImpl(this);\n\n\t\tthis._tester = (x, y, ax, ay, ox, oy, px, py, sw, ss, sa): boolean => {\n\t\t\treturn this.containsPointAbs(x, y, ax, ay, ox, oy, px, py, sw, ss, sa);\n\t\t};\n\t}\n\n\tget points(): EShapeLineOfAnyPoints {\n\t\treturn this._points;\n\t}\n\n\tclone(): EShapeLineOfRectangleRoundeds {\n\t\treturn new EShapeLineOfRectangleRoundeds(this.type).copy(this);\n\t}\n\n\tcontainsAbs(\n\t\tx: number,\n\t\ty: number,\n\t\tax: number,\n\t\tay: number,\n\t\tsw: number,\n\t\tss: number,\n\t\tsa: number\n\t): boolean {\n\t\tconst threshold = toThresholdDefault(sw, ss, this._points.size.getLimit());\n\t\tif (this.containsAbsBBox(x, y, ax + threshold, ay + threshold)) {\n\t\t\treturn this._points.calcHitPointAbs(\n\t\t\t\tx,\n\t\t\t\ty,\n\t\t\t\tthreshold,\n\t\t\t\tsw,\n\t\t\t\tss,\n\t\t\t\tsa,\n\t\t\t\tnull,\n\t\t\t\tthis._tester,\n\t\t\t\tnull\n\t\t\t);\n\t\t}\n\t\treturn false;\n\t}\n\n\tcontainsPointAbs(\n\t\tx: number,\n\t\ty: number,\n\t\tax: number,\n\t\tay: number,\n\t\tox: number,\n\t\toy: number,\n\t\tpx: number,\n\t\tpy: number,\n\t\tsw: number,\n\t\tss: number,\n\t\tsa: number\n\t): boolean {\n\t\treturn super.containsAbs(x - px - ox, y - py - oy, ax, ay, sw, ss, sa);\n\t}\n\n\tcalcHitPoint<RESULT>(\n\t\tx: number,\n\t\ty: number,\n\t\ttoThreshold: EShapeLineOfAnyPointsHitTesterToThreshold | null,\n\t\ttoRange: EShapeLineOfAnyPointsHitTesterToRange | null,\n\t\ttester: EShapeLineOfAnyPointsHitTester<RESULT> | null,\n\t\tresult: RESULT\n\t): boolean {\n\t\tconst data = this.toHitTestData(x, y);\n\t\tconst threshold = (toThreshold || toThresholdDefault)(\n\t\t\tdata.strokeWidth,\n\t\t\tdata.strokeScale,\n\t\t\tthis._points.size.getLimit()\n\t\t);\n\t\tif (this.containsAbsBBox(data.x, data.y, data.width + threshold, data.height + threshold)) {\n\t\t\treturn this._points.calcHitPointAbs(\n\t\t\t\tdata.x,\n\t\t\t\tdata.y,\n\t\t\t\tdata.strokeWidth,\n\t\t\t\tdata.strokeScale,\n\t\t\t\tdata.strokeAlign,\n\t\t\t\tthreshold,\n\t\t\t\ttoRange,\n\t\t\t\ttester || this._tester,\n\t\t\t\tresult\n\t\t\t);\n\t\t}\n\t\treturn false;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { deserializeBase } from \"./deserialize-base\";\nimport { EShapeLineOfRectangleRoundeds } from \"./e-shape-line-of-rectangle-roundeds\";\n\nexport const deserializeLineOfRectangleRoundeds = (\n\titem: DDiagramSerializedItem,\n\tmanager: EShapeResourceManagerDeserialization,\n\tshape?: EShapeLineOfRectangleRoundeds\n): Promise<EShapeLineOfRectangleRoundeds> | EShapeLineOfRectangleRoundeds => {\n\treturn deserializeBase(item, manager, shape || new EShapeLineOfRectangleRoundeds());\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeCapabilities } from \"../e-shape-capabilities\";\nimport { EShapeCapability } from \"../e-shape-capability\";\nimport { EShapeDeserializers } from \"../e-shape-deserializers\";\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapeUploadeds } from \"../e-shape-uploadeds\";\nimport { createLineOfRectangleRoundedsUploaded } from \"../variant/create-line-of-rectangle-roundeds-uploaded\";\nimport { deserializeLineOfRectangleRoundeds } from \"../variant/deserialize-line-of-rectangle-roundeds\";\n\nexport const loadShapeLineOfRectangleRoundeds = (): void => {\n\tEShapeUploadeds[EShapeType.LINE_OF_RECTANGLE_ROUNDEDS] = createLineOfRectangleRoundedsUploaded;\n\tEShapeDeserializers[EShapeType.LINE_OF_RECTANGLE_ROUNDEDS] = deserializeLineOfRectangleRoundeds;\n\tEShapeCapabilities.set(\n\t\tEShapeType.LINE_OF_RECTANGLE_ROUNDEDS,\n\t\tEShapeCapability.PRIMITIVE | EShapeCapability.STROKE_SIDE | EShapeCapability.BORDER_RADIUS\n\t);\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeBuffer } from \"../e-shape-buffer\";\nimport { buildNullClipping, buildNullStep, buildNullUv, buildNullVertex } from \"./build-null\";\nimport {\n\tbuildRectangleClipping,\n\tbuildRectangleIndex,\n\tbuildRectangleStep,\n\tbuildRectangleUv,\n\tbuildRectangleVertex,\n\tRECTANGLE_INDEX_COUNT,\n\tRECTANGLE_VERTEX_COUNT,\n\tRECTANGLE_WORLD_SIZE\n} from \"./build-rectangle\";\nimport { BuilderLineOfAny } from \"./builder-line-of-any\";\nimport { toTexture, toTextureTransformId, toTextureUvs, toTransformLocalId } from \"./builders\";\nimport { copyClipping } from \"./copy-clipping\";\nimport { copyIndex } from \"./copy-index\";\nimport { copyStep } from \"./copy-step\";\nimport { copyUvs } from \"./copy-uv\";\nimport { copyVertex } from \"./copy-vertex\";\nimport { EShapeLineOfAnyPoints } from \"./e-shape-line-of-any-points\";\nimport { EShapeLineOfAnyPointsImpl } from \"./e-shape-line-of-any-points-impl\";\n\nexport class BuilderLineOfRectangles extends BuilderLineOfAny {\n\tinit(buffer: EShapeBuffer): void {\n\t\tbuffer.updateIndices();\n\t\tconst indices = buffer.indices;\n\t\tconst voffset = this.vertexOffset;\n\t\tconst ioffset = this.indexOffset;\n\t\tconst pointCountReserved = this.pointCountReserved;\n\t\tif (0 < pointCountReserved) {\n\t\t\tbuildRectangleIndex(indices, voffset, ioffset);\n\t\t\tcopyIndex(\n\t\t\t\tindices,\n\t\t\t\tRECTANGLE_VERTEX_COUNT,\n\t\t\t\tioffset,\n\t\t\t\tRECTANGLE_INDEX_COUNT,\n\t\t\t\tpointCountReserved\n\t\t\t);\n\t\t}\n\t}\n\n\tupdate(buffer: EShapeBuffer, shape: EShape): void {\n\t\tconst points = shape.points;\n\t\tif (points instanceof EShapeLineOfAnyPointsImpl) {\n\t\t\tthis.updateVertexClippingStepAndUv(buffer, shape, points);\n\t\t\tthis.updateLineOfAnyColorFill(buffer, shape, points, RECTANGLE_VERTEX_COUNT);\n\t\t\tthis.updateLineOfAnyColorStroke(buffer, shape, points, RECTANGLE_VERTEX_COUNT);\n\t\t}\n\t}\n\n\tprotected updateVertexClippingStepAndUv(\n\t\tbuffer: EShapeBuffer,\n\t\tshape: EShape,\n\t\tpoints: EShapeLineOfAnyPoints\n\t): void {\n\t\tconst pointId = points.id;\n\t\tconst pointOffset = points.offset;\n\t\tconst pointOffsetId = pointOffset.id;\n\t\tconst isPointChanged = pointId !== this.pointId || pointOffsetId !== this.pointOffsetId;\n\n\t\tconst pointSize = points.size;\n\t\tconst pointSizeId = pointSize.id;\n\t\tconst isPointSizeChanged = pointSizeId !== this.pointSizeId;\n\n\t\tconst size = shape.size;\n\t\tconst sizeX = size.x;\n\t\tconst sizeY = size.y;\n\t\tconst isSizeChanged = sizeX !== this.sizeX || sizeY !== this.sizeY;\n\n\t\tconst transformLocalId = toTransformLocalId(shape);\n\t\tconst isTransformChanged = this.transformLocalId !== transformLocalId;\n\n\t\tconst stroke = shape.stroke;\n\t\tconst strokeAlign = stroke.align;\n\t\tconst strokeWidth = stroke.enable ? stroke.width : 0;\n\t\tconst strokeSide = stroke.side;\n\t\tconst strokeStyle = stroke.style;\n\t\tconst isStrokeChanged =\n\t\t\tthis.strokeAlign !== strokeAlign ||\n\t\t\tthis.strokeWidth !== strokeWidth ||\n\t\t\tthis.strokeSide !== strokeSide ||\n\t\t\tthis.strokeStyle !== strokeStyle;\n\n\t\tconst texture = toTexture(shape);\n\t\tconst textureTransformId = toTextureTransformId(texture);\n\t\tconst isTextureChanged =\n\t\t\ttexture !== this.texture || textureTransformId !== this.textureTransformId;\n\n\t\tconst isVertexChanged =\n\t\t\tisPointChanged || isPointSizeChanged || isSizeChanged || isStrokeChanged;\n\n\t\tif (isVertexChanged || isTransformChanged || isTextureChanged) {\n\t\t\tthis.pointId = pointId;\n\t\t\tconst formatted = points.formatted;\n\t\t\tthis.pointCount = formatted.length;\n\t\t\tthis.pointOffsetId = pointOffsetId;\n\t\t\tthis.pointSizeId = pointSizeId;\n\t\t\tthis.transformLocalId = transformLocalId;\n\t\t\tthis.strokeWidth = strokeWidth;\n\t\t\tthis.strokeAlign = strokeAlign;\n\t\t\tthis.strokeSide = strokeSide;\n\t\t\tthis.strokeStyle = strokeStyle;\n\t\t\tthis.texture = texture;\n\t\t\tthis.textureTransformId = textureTransformId;\n\n\t\t\t// Buffer\n\t\t\tbuffer.updateVertices();\n\t\t\tif (isVertexChanged || isTransformChanged) {\n\t\t\t\tbuffer.updateSteps();\n\t\t\t}\n\t\t\tif (isVertexChanged) {\n\t\t\t\tbuffer.updateClippings();\n\t\t\t}\n\t\t\tif (isVertexChanged || isTextureChanged) {\n\t\t\t\tbuffer.updateUvs();\n\t\t\t}\n\t\t\tconst pointCount = this.pointCount;\n\t\t\tconst pointsValues = formatted.values;\n\t\t\tconst voffset = this.vertexOffset;\n\t\t\tconst vertices = buffer.vertices;\n\t\t\tconst clippings = buffer.clippings;\n\t\t\tconst steps = buffer.steps;\n\t\t\tconst uvs = buffer.uvs;\n\t\t\tconst internalTransform = shape.transform.internalTransform;\n\t\t\tconst textureUvs = toTextureUvs(texture);\n\t\t\tif (0 < pointCount && pointSize.isStaticX() && pointSize.isStaticY()) {\n\t\t\t\tconst pointSizeX = pointSize.getX(0);\n\t\t\t\tconst pointSizeY = pointSize.getY(0);\n\n\t\t\t\t// Vertices\n\t\t\t\tbuildRectangleVertex(\n\t\t\t\t\tvertices,\n\t\t\t\t\tvoffset,\n\t\t\t\t\t0,\n\t\t\t\t\t0,\n\t\t\t\t\tpointSizeX,\n\t\t\t\t\tpointSizeY,\n\t\t\t\t\tstrokeAlign,\n\t\t\t\t\tstrokeWidth,\n\t\t\t\t\tinternalTransform,\n\t\t\t\t\tRECTANGLE_WORLD_SIZE\n\t\t\t\t);\n\t\t\t\tcopyVertex(\n\t\t\t\t\tvertices,\n\t\t\t\t\tinternalTransform,\n\t\t\t\t\tvoffset,\n\t\t\t\t\tRECTANGLE_VERTEX_COUNT,\n\t\t\t\t\tpointCount,\n\t\t\t\t\tpointsValues,\n\t\t\t\t\tpointOffset\n\t\t\t\t);\n\n\t\t\t\t// Steps\n\t\t\t\tif (isVertexChanged || isTransformChanged) {\n\t\t\t\t\tbuildRectangleStep(\n\t\t\t\t\t\tvoffset,\n\t\t\t\t\t\tsteps,\n\t\t\t\t\t\tstrokeWidth,\n\t\t\t\t\t\tstrokeSide,\n\t\t\t\t\t\tstrokeStyle,\n\t\t\t\t\t\tRECTANGLE_WORLD_SIZE\n\t\t\t\t\t);\n\t\t\t\t\tcopyStep(steps, voffset, RECTANGLE_VERTEX_COUNT, pointCount);\n\t\t\t\t}\n\n\t\t\t\t// Clippings\n\t\t\t\tif (isVertexChanged) {\n\t\t\t\t\tbuildRectangleClipping(clippings, voffset, RECTANGLE_WORLD_SIZE);\n\t\t\t\t\tcopyClipping(clippings, voffset, RECTANGLE_VERTEX_COUNT, pointCount);\n\t\t\t\t}\n\n\t\t\t\t// UVs\n\t\t\t\tif (isVertexChanged || isTextureChanged) {\n\t\t\t\t\tbuildRectangleUv(uvs, voffset, textureUvs, RECTANGLE_WORLD_SIZE);\n\t\t\t\t\tcopyUvs(uvs, voffset, RECTANGLE_VERTEX_COUNT, pointCount);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (let i = 0; i < pointCount; ++i) {\n\t\t\t\t\tconst ip = i << 1;\n\t\t\t\t\tconst px = pointsValues[ip] + pointOffset.getX(i);\n\t\t\t\t\tconst py = pointsValues[ip + 1] + pointOffset.getY(i);\n\t\t\t\t\tconst pointSizeX = pointSize.getX(i);\n\t\t\t\t\tconst pointSizeY = pointSize.getY(i);\n\t\t\t\t\tconst iv = voffset + i * RECTANGLE_VERTEX_COUNT;\n\n\t\t\t\t\t// Vertices\n\t\t\t\t\tbuildRectangleVertex(\n\t\t\t\t\t\tvertices,\n\t\t\t\t\t\tiv,\n\t\t\t\t\t\tpx,\n\t\t\t\t\t\tpy,\n\t\t\t\t\t\tpointSizeX,\n\t\t\t\t\t\tpointSizeY,\n\t\t\t\t\t\tstrokeAlign,\n\t\t\t\t\t\tstrokeWidth,\n\t\t\t\t\t\tinternalTransform,\n\t\t\t\t\t\tRECTANGLE_WORLD_SIZE\n\t\t\t\t\t);\n\n\t\t\t\t\t// Steps\n\t\t\t\t\tif (isVertexChanged || isTransformChanged) {\n\t\t\t\t\t\tbuildRectangleStep(\n\t\t\t\t\t\t\tiv,\n\t\t\t\t\t\t\tsteps,\n\t\t\t\t\t\t\tstrokeWidth,\n\t\t\t\t\t\t\tstrokeSide,\n\t\t\t\t\t\t\tstrokeStyle,\n\t\t\t\t\t\t\tRECTANGLE_WORLD_SIZE\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Clippings\n\t\t\t\t\tif (isVertexChanged) {\n\t\t\t\t\t\tbuildRectangleClipping(clippings, iv, RECTANGLE_WORLD_SIZE);\n\t\t\t\t\t}\n\n\t\t\t\t\t// UVs\n\t\t\t\t\tif (isVertexChanged || isTextureChanged) {\n\t\t\t\t\t\tbuildRectangleUv(uvs, iv, textureUvs, RECTANGLE_WORLD_SIZE);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Fill the rest\n\t\t\tconst pointCountReserved = this.pointCountReserved;\n\t\t\tconst voffsetReserved = voffset + pointCount * RECTANGLE_VERTEX_COUNT;\n\t\t\tconst vcountReserved = RECTANGLE_VERTEX_COUNT * (pointCountReserved - pointCount);\n\t\t\tbuildNullVertex(vertices, voffsetReserved, vcountReserved);\n\t\t\tbuildNullStep(steps, voffsetReserved, vcountReserved);\n\t\t\tbuildNullClipping(clippings, voffsetReserved, vcountReserved);\n\t\t\tbuildNullUv(uvs, voffsetReserved, vcountReserved);\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeBuffer } from \"../e-shape-buffer\";\nimport { EShapeUploaded } from \"../e-shape-uploaded\";\nimport { RECTANGLE_INDEX_COUNT, RECTANGLE_VERTEX_COUNT } from \"./build-rectangle\";\nimport { BuilderLineOfRectangles } from \"./builder-line-of-rectangles\";\nimport { createLineOfAnyUploaded } from \"./create-line-of-any-uploaded\";\n\nexport const createLineOfRectanglesUploaded = (\n\tbuffer: EShapeBuffer,\n\tshape: EShape,\n\tvoffset: number,\n\tioffset: number,\n\tantialiasWeight: number\n): EShapeUploaded | null => {\n\treturn createLineOfAnyUploaded(\n\t\tbuffer,\n\t\tshape,\n\t\tvoffset,\n\t\tRECTANGLE_VERTEX_COUNT,\n\t\tioffset,\n\t\tRECTANGLE_INDEX_COUNT,\n\t\tantialiasWeight,\n\t\tBuilderLineOfRectangles\n\t);\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapeLineOfAny } from \"./e-shape-line-of-any\";\nimport { EShapeLineOfAnyPoints } from \"./e-shape-line-of-any-points\";\nimport { EShapeLineOfAnyPointsHitTester } from \"./e-shape-line-of-any-points-hit-tester\";\nimport { EShapeLineOfAnyPointsHitTesterToRange } from \"./e-shape-line-of-any-points-hit-tester-to-range\";\nimport { EShapeLineOfAnyPointsHitTesterToThreshold } from \"./e-shape-line-of-any-points-hit-tester-to-threshold\";\nimport { EShapeLineOfAnyPointsImpl } from \"./e-shape-line-of-any-points-impl\";\nimport { EShapeRectangle } from \"./e-shape-rectangle\";\nimport { toThresholdDefault } from \"./to-threshold-default\";\n\nexport class EShapeLineOfRectangles extends EShapeRectangle implements EShapeLineOfAny {\n\tprotected declare _points: EShapeLineOfAnyPoints;\n\tprotected _tester: EShapeLineOfAnyPointsHitTester<unknown>;\n\n\tconstructor(type: EShapeType = EShapeType.LINE_OF_RECTANGLES) {\n\t\tsuper(type);\n\t\tthis._points = new EShapeLineOfAnyPointsImpl(this);\n\n\t\tthis._tester = (x, y, ax, ay, ox, oy, px, py, sw, ss, sa): boolean => {\n\t\t\treturn this.containsPointAbs(x, y, ax, ay, ox, oy, px, py, sw, ss, sa);\n\t\t};\n\t}\n\n\tget points(): EShapeLineOfAnyPoints {\n\t\treturn this._points;\n\t}\n\n\tclone(): EShapeLineOfRectangles {\n\t\treturn new EShapeLineOfRectangles(this.type).copy(this);\n\t}\n\n\tcontainsAbs(\n\t\tx: number,\n\t\ty: number,\n\t\tax: number,\n\t\tay: number,\n\t\tsw: number,\n\t\tss: number,\n\t\tsa: number\n\t): boolean {\n\t\tconst threshold = toThresholdDefault(sw, ss, this._points.size.getLimit());\n\t\tif (this.containsAbsBBox(x, y, ax + threshold, ay + threshold)) {\n\t\t\treturn this._points.calcHitPointAbs(\n\t\t\t\tx,\n\t\t\t\ty,\n\t\t\t\tsw,\n\t\t\t\tss,\n\t\t\t\tsa,\n\t\t\t\tthreshold,\n\t\t\t\tnull,\n\t\t\t\tthis._tester,\n\t\t\t\tnull\n\t\t\t);\n\t\t}\n\t\treturn false;\n\t}\n\n\tcontainsPointAbs(\n\t\tx: number,\n\t\ty: number,\n\t\tax: number,\n\t\tay: number,\n\t\tox: number,\n\t\toy: number,\n\t\tpx: number,\n\t\tpy: number,\n\t\tsw: number,\n\t\tss: number,\n\t\tsa: number\n\t): boolean {\n\t\treturn super.containsAbs(x - px - ox, y - py - oy, ax, ay, sw, ss, sa);\n\t}\n\n\tcalcHitPoint<RESULT>(\n\t\tx: number,\n\t\ty: number,\n\t\ttoThreshold: EShapeLineOfAnyPointsHitTesterToThreshold | null,\n\t\ttoRange: EShapeLineOfAnyPointsHitTesterToRange | null,\n\t\ttester: EShapeLineOfAnyPointsHitTester<RESULT> | null,\n\t\tresult: RESULT\n\t): boolean {\n\t\tconst data = this.toHitTestData(x, y);\n\t\tconst threshold = (toThreshold || toThresholdDefault)(\n\t\t\tdata.strokeWidth,\n\t\t\tdata.strokeScale,\n\t\t\tthis._points.size.getLimit()\n\t\t);\n\t\tif (this.containsAbsBBox(data.x, data.y, data.width + threshold, data.height + threshold)) {\n\t\t\treturn this._points.calcHitPointAbs(\n\t\t\t\tdata.x,\n\t\t\t\tdata.y,\n\t\t\t\tdata.strokeWidth,\n\t\t\t\tdata.strokeScale,\n\t\t\t\tdata.strokeAlign,\n\t\t\t\tthreshold,\n\t\t\t\ttoRange,\n\t\t\t\ttester || this._tester,\n\t\t\t\tresult\n\t\t\t);\n\t\t}\n\t\treturn false;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { deserializeBase } from \"./deserialize-base\";\nimport { EShapeLineOfRectangles } from \"./e-shape-line-of-rectangles\";\n\nexport const deserializeLineOfRectangles = (\n\titem: DDiagramSerializedItem,\n\tmanager: EShapeResourceManagerDeserialization,\n\tshape?: EShapeLineOfRectangles\n): Promise<EShapeLineOfRectangles> | EShapeLineOfRectangles => {\n\treturn deserializeBase(item, manager, shape || new EShapeLineOfRectangles());\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeCapabilities } from \"../e-shape-capabilities\";\nimport { EShapeCapability } from \"../e-shape-capability\";\nimport { EShapeDeserializers } from \"../e-shape-deserializers\";\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapeUploadeds } from \"../e-shape-uploadeds\";\nimport { createLineOfRectanglesUploaded } from \"../variant/create-line-of-rectangles-uploaded\";\nimport { deserializeLineOfRectangles } from \"../variant/deserialize-line-of-rectangles\";\n\nexport const loadShapeLineOfRectangles = (): void => {\n\tEShapeUploadeds[EShapeType.LINE_OF_RECTANGLES] = createLineOfRectanglesUploaded;\n\tEShapeDeserializers[EShapeType.LINE_OF_RECTANGLES] = deserializeLineOfRectangles;\n\tEShapeCapabilities.set(\n\t\tEShapeType.LINE_OF_RECTANGLES,\n\t\tEShapeCapability.PRIMITIVE | EShapeCapability.STROKE_SIDE\n\t);\n};\n","import { Matrix, Point, TextureUvs } from \"pixi.js\";\nimport { EShapeCorner } from \"../e-shape-corner\";\nimport { EShapeStrokeStyle } from \"../e-shape-stroke-style\";\nimport { toLength } from \"./to-length\";\nimport { toScaleInvariant } from \"./to-scale-invariant\";\n\nexport const TRIANGLE_ROUNDED_VERTEX_COUNT = 22;\nexport const TRIANGLE_ROUNDED_INDEX_COUNT = 15;\nexport const TRIANGLE_ROUNDED_WORLD_SIZE: [number, number, number, number, number] = [\n\t0, 0, 0, 0, 0\n];\nconst TRIANGLE_ROUNDED_WORK_POINT: Point = new Point();\n\nexport const buildTriangleRoundedIndex = (\n\tindices: Uint16Array | Uint32Array,\n\tvoffset: number,\n\tioffset: number\n): void => {\n\t// Top corner\n\tlet ii = ioffset * 3 - 1;\n\tindices[++ii] = voffset + 0;\n\tindices[++ii] = voffset + 1;\n\tindices[++ii] = voffset + 3;\n\n\tindices[++ii] = voffset + 1;\n\tindices[++ii] = voffset + 2;\n\tindices[++ii] = voffset + 3;\n\n\t// Bottom-right corner\n\tindices[++ii] = voffset + 4;\n\tindices[++ii] = voffset + 5;\n\tindices[++ii] = voffset + 7;\n\n\tindices[++ii] = voffset + 5;\n\tindices[++ii] = voffset + 6;\n\tindices[++ii] = voffset + 7;\n\n\t// Bottom-left corner\n\tindices[++ii] = voffset + 8;\n\tindices[++ii] = voffset + 9;\n\tindices[++ii] = voffset + 11;\n\n\tindices[++ii] = voffset + 9;\n\tindices[++ii] = voffset + 10;\n\tindices[++ii] = voffset + 11;\n\n\t// Others\n\tindices[++ii] = voffset + 12;\n\tindices[++ii] = voffset + 13;\n\tindices[++ii] = voffset + 16;\n\n\tindices[++ii] = voffset + 13;\n\tindices[++ii] = voffset + 14;\n\tindices[++ii] = voffset + 16;\n\n\tindices[++ii] = voffset + 14;\n\tindices[++ii] = voffset + 15;\n\tindices[++ii] = voffset + 16;\n\n\t//\n\tindices[++ii] = voffset + 12;\n\tindices[++ii] = voffset + 16;\n\tindices[++ii] = voffset + 19;\n\n\tindices[++ii] = voffset + 16;\n\tindices[++ii] = voffset + 17;\n\tindices[++ii] = voffset + 19;\n\n\tindices[++ii] = voffset + 17;\n\tindices[++ii] = voffset + 18;\n\tindices[++ii] = voffset + 19;\n\n\t//\n\tindices[++ii] = voffset + 12;\n\tindices[++ii] = voffset + 19;\n\tindices[++ii] = voffset + 13;\n\n\tindices[++ii] = voffset + 19;\n\tindices[++ii] = voffset + 20;\n\tindices[++ii] = voffset + 13;\n\n\tindices[++ii] = voffset + 20;\n\tindices[++ii] = voffset + 21;\n\tindices[++ii] = voffset + 13;\n};\n\nexport const buildTriangleRoundedVertex = (\n\tvertices: Float32Array,\n\tvoffset: number,\n\toriginX: number,\n\toriginY: number,\n\tsizeX: number,\n\tsizeY: number,\n\tstrokeAlign: number,\n\tstrokeWidth: number,\n\tradius: number,\n\tinternalTransform: Matrix,\n\tworldSize: typeof TRIANGLE_ROUNDED_WORLD_SIZE\n): void => {\n\t// Calculate the transformed positions\n\tconst s = strokeAlign * strokeWidth;\n\tconst sx = sizeX * 0.5 + (0 <= sizeX ? +s : -s);\n\tconst sy = sizeY * 0.5 + (0 <= sizeY ? +s : -s);\n\tconst sz = Math.sqrt(sx * sx + 4 * sy * sy);\n\tconst sw = (2 * sx * sy) / (sx + sz);\n\tconst ry = (sw * radius) / (2 * sy);\n\tconst rz = (0.5 * (sz - sw) * radius) / sz;\n\tconst rx = (ry * sz) / (2 * sx);\n\n\tconst work = TRIANGLE_ROUNDED_WORK_POINT;\n\twork.set(originX, originY - sy);\n\tinternalTransform.apply(work, work);\n\tconst x1 = work.x;\n\tconst y1 = work.y;\n\twork.set(originX, originY);\n\tinternalTransform.apply(work, work);\n\tconst tx = work.x;\n\tconst ty = work.y;\n\twork.set(originX + sx, originY);\n\tinternalTransform.apply(work, work);\n\tconst dx = tx - x1;\n\tconst dy = ty - y1;\n\tconst x4 = work.x + dx;\n\tconst y4 = work.y + dy;\n\tconst x7 = tx + (tx - work.x) + dx;\n\tconst y7 = ty + (ty - work.y) + dy;\n\tconst dx14 = x4 - x1;\n\tconst dy14 = y4 - y1;\n\tconst x2 = x1 + rz * dx14;\n\tconst y2 = y1 + rz * dy14;\n\tconst x3 = x4 - ry * dx14;\n\tconst y3 = y4 - ry * dy14;\n\tconst dx47r = rx * (x7 - x4);\n\tconst dy47r = rx * (y7 - y4);\n\tconst x5 = x4 + dx47r;\n\tconst y5 = y4 + dy47r;\n\tconst x6 = x7 - dx47r;\n\tconst y6 = y7 - dy47r;\n\tconst dx71 = x1 - x7;\n\tconst dy71 = y1 - y7;\n\tconst x8 = x7 + ry * dx71;\n\tconst y8 = y7 + ry * dy71;\n\tconst x9 = x1 - rz * dx71;\n\tconst y9 = y1 - rz * dy71;\n\twork.set(originX, originY + sy - sw); // Incenter of a triangle\n\tinternalTransform.apply(work, work);\n\tconst x0 = work.x;\n\tconst y0 = work.y;\n\n\tconst x10 = x1 + radius * (x0 - x1);\n\tconst y10 = y1 + radius * (y0 - y1);\n\tconst x11 = x4 + radius * (x0 - x4);\n\tconst y11 = y4 + radius * (y0 - y4);\n\tconst x12 = x7 + radius * (x0 - x7);\n\tconst y12 = y7 + radius * (y0 - y7);\n\n\t// World size\n\tconst xb = tx + dx;\n\tconst yb = ty + dy;\n\tworldSize[0] = toLength(xb, yb, x0, y0);\n\tworldSize[1] = rx;\n\tworldSize[2] = ry;\n\tworldSize[3] = rz;\n\tworldSize[4] = 1 - (0.5 * sw) / sy;\n\n\t// Vertices\n\t// Top corner\n\tlet iv = voffset * 2 - 1;\n\tvertices[++iv] = x10;\n\tvertices[++iv] = y10;\n\tvertices[++iv] = x9;\n\tvertices[++iv] = y9;\n\tvertices[++iv] = x1;\n\tvertices[++iv] = y1;\n\tvertices[++iv] = x2;\n\tvertices[++iv] = y2;\n\n\t// Bottom-right corner\n\tvertices[++iv] = x11;\n\tvertices[++iv] = y11;\n\tvertices[++iv] = x3;\n\tvertices[++iv] = y3;\n\tvertices[++iv] = x4;\n\tvertices[++iv] = y4;\n\tvertices[++iv] = x5;\n\tvertices[++iv] = y5;\n\n\t// Bottom-left corner\n\tvertices[++iv] = x12;\n\tvertices[++iv] = y12;\n\tvertices[++iv] = x6;\n\tvertices[++iv] = y6;\n\tvertices[++iv] = x7;\n\tvertices[++iv] = y7;\n\tvertices[++iv] = x8;\n\tvertices[++iv] = y8;\n\n\t// Others\n\tvertices[++iv] = x0;\n\tvertices[++iv] = y0;\n\n\tvertices[++iv] = x10;\n\tvertices[++iv] = y10;\n\n\tvertices[++iv] = x2;\n\tvertices[++iv] = y2;\n\tvertices[++iv] = x3;\n\tvertices[++iv] = y3;\n\n\tvertices[++iv] = x11;\n\tvertices[++iv] = y11;\n\n\tvertices[++iv] = x5;\n\tvertices[++iv] = y5;\n\tvertices[++iv] = x6;\n\tvertices[++iv] = y6;\n\n\tvertices[++iv] = x12;\n\tvertices[++iv] = y12;\n\n\tvertices[++iv] = x8;\n\tvertices[++iv] = y8;\n\tvertices[++iv] = x9;\n\tvertices[++iv] = y9;\n};\n\nexport const buildTriangleRoundedClipping = (\n\tclippings: Float32Array,\n\tvoffset: number,\n\tcorner: EShapeCorner,\n\tradius: number\n): void => {\n\t// Top corner\n\tlet iv = voffset * 3 - 1;\n\tconst w = 1 - radius;\n\tif (corner & EShapeCorner.TOP) {\n\t\tclippings[++iv] = 0;\n\t\tclippings[++iv] = 0;\n\t\tclippings[++iv] = 1;\n\t\tclippings[++iv] = 1;\n\t\tclippings[++iv] = 0;\n\t\tclippings[++iv] = 1;\n\t\tclippings[++iv] = 1;\n\t\tclippings[++iv] = 1;\n\t\tclippings[++iv] = 1;\n\t\tclippings[++iv] = 0;\n\t\tclippings[++iv] = 1;\n\t\tclippings[++iv] = 1;\n\t} else {\n\t\tclippings[++iv] = w;\n\t\tclippings[++iv] = w;\n\t\tclippings[++iv] = 0;\n\t\tclippings[++iv] = 1;\n\t\tclippings[++iv] = w;\n\t\tclippings[++iv] = 0;\n\t\tclippings[++iv] = 1;\n\t\tclippings[++iv] = 1;\n\t\tclippings[++iv] = 0;\n\t\tclippings[++iv] = w;\n\t\tclippings[++iv] = 1;\n\t\tclippings[++iv] = 0;\n\t}\n\n\t// Bottom-right corner\n\tif (corner & EShapeCorner.BOTTOM_RIGHT) {\n\t\tclippings[++iv] = 0;\n\t\tclippings[++iv] = 0;\n\t\tclippings[++iv] = 1;\n\t\tclippings[++iv] = 1;\n\t\tclippings[++iv] = 0;\n\t\tclippings[++iv] = 1;\n\t\tclippings[++iv] = 1;\n\t\tclippings[++iv] = 1;\n\t\tclippings[++iv] = 1;\n\t\tclippings[++iv] = 0;\n\t\tclippings[++iv] = 1;\n\t\tclippings[++iv] = 1;\n\t} else {\n\t\tclippings[++iv] = w;\n\t\tclippings[++iv] = w;\n\t\tclippings[++iv] = 0;\n\t\tclippings[++iv] = 1;\n\t\tclippings[++iv] = w;\n\t\tclippings[++iv] = 0;\n\t\tclippings[++iv] = 1;\n\t\tclippings[++iv] = 1;\n\t\tclippings[++iv] = 0;\n\t\tclippings[++iv] = w;\n\t\tclippings[++iv] = 1;\n\t\tclippings[++iv] = 0;\n\t}\n\n\t// Bottom-left corner\n\tif (corner & EShapeCorner.BOTTOM_LEFT) {\n\t\tclippings[++iv] = 0;\n\t\tclippings[++iv] = 0;\n\t\tclippings[++iv] = 1;\n\t\tclippings[++iv] = 1;\n\t\tclippings[++iv] = 0;\n\t\tclippings[++iv] = 1;\n\t\tclippings[++iv] = 1;\n\t\tclippings[++iv] = 1;\n\t\tclippings[++iv] = 1;\n\t\tclippings[++iv] = 0;\n\t\tclippings[++iv] = 1;\n\t\tclippings[++iv] = 1;\n\t} else {\n\t\tclippings[++iv] = w;\n\t\tclippings[++iv] = w;\n\t\tclippings[++iv] = 0;\n\t\tclippings[++iv] = 1;\n\t\tclippings[++iv] = w;\n\t\tclippings[++iv] = 0;\n\t\tclippings[++iv] = 1;\n\t\tclippings[++iv] = 1;\n\t\tclippings[++iv] = 0;\n\t\tclippings[++iv] = w;\n\t\tclippings[++iv] = 1;\n\t\tclippings[++iv] = 0;\n\t}\n\n\t// Others\n\tclippings[++iv] = 0;\n\tclippings[++iv] = 0;\n\tclippings[++iv] = 0;\n\n\tclippings[++iv] = w;\n\tclippings[++iv] = 0;\n\tclippings[++iv] = 0;\n\n\tclippings[++iv] = 1;\n\tclippings[++iv] = 0;\n\tclippings[++iv] = 0;\n\tclippings[++iv] = 1;\n\tclippings[++iv] = 0;\n\tclippings[++iv] = 0;\n\n\tclippings[++iv] = w;\n\tclippings[++iv] = 0;\n\tclippings[++iv] = 0;\n\n\tclippings[++iv] = 1;\n\tclippings[++iv] = 0;\n\tclippings[++iv] = 0;\n\tclippings[++iv] = 1;\n\tclippings[++iv] = 0;\n\tclippings[++iv] = 0;\n\n\tclippings[++iv] = w;\n\tclippings[++iv] = 0;\n\tclippings[++iv] = 0;\n\n\tclippings[++iv] = 1;\n\tclippings[++iv] = 0;\n\tclippings[++iv] = 0;\n\tclippings[++iv] = 1;\n\tclippings[++iv] = 0;\n\tclippings[++iv] = 0;\n};\n\nexport const buildTriangleRoundedStep = (\n\tsteps: Float32Array,\n\tclippings: Float32Array,\n\tvoffset: number,\n\tstrokeWidth: number,\n\tstrokeStyle: EShapeStrokeStyle,\n\tradius: number,\n\tworldSize: typeof TRIANGLE_ROUNDED_WORLD_SIZE\n): void => {\n\tconst scaleInvariant = toScaleInvariant(strokeStyle);\n\n\tconst s = worldSize[0];\n\tconst sr = radius * s;\n\n\tlet ic = voffset * 3;\n\tlet is = voffset * 6 - 1;\n\tfor (let i = 0; i < TRIANGLE_ROUNDED_VERTEX_COUNT; i += 1, ic += 3) {\n\t\tsteps[++is] = strokeWidth;\n\t\tsteps[++is] = scaleInvariant;\n\t\tif (0.5 < clippings[ic + 2]) {\n\t\t\tsteps[++is] = sr;\n\t\t\tsteps[++is] = sr;\n\t\t\tsteps[++is] = 1 + clippings[ic];\n\t\t\tsteps[++is] = 1 + clippings[ic + 1];\n\t\t} else {\n\t\t\tsteps[++is] = s;\n\t\t\tsteps[++is] = s;\n\t\t\tsteps[++is] = 1 + clippings[ic];\n\t\t\tsteps[++is] = 1 + clippings[ic + 1];\n\t\t}\n\t}\n};\n\nexport const buildTriangleRoundedUv = (\n\tuvs: Float32Array,\n\tvoffset: number,\n\ttextureUvs: TextureUvs,\n\tradius: number,\n\tworldSize: typeof TRIANGLE_ROUNDED_WORLD_SIZE\n): void => {\n\tconst x0 = textureUvs.x0;\n\tconst x1 = textureUvs.x1;\n\tconst x2 = textureUvs.x2;\n\tconst x3 = textureUvs.x3;\n\tconst y0 = textureUvs.y0;\n\tconst y1 = textureUvs.y1;\n\tconst y2 = textureUvs.y2;\n\tconst y3 = textureUvs.y3;\n\n\tconst x4 = 0.5 * (x0 + x1);\n\tconst y4 = 0.5 * (y0 + y1);\n\n\tconst c = worldSize[4];\n\tconst x5 = x4 + c * (x3 - x0);\n\tconst y5 = y4 + c * (y3 - y0);\n\n\tconst rx = worldSize[1];\n\tconst ry = worldSize[2];\n\tconst rz = worldSize[3];\n\tconst x6 = x4 + rz * (x3 - x4);\n\tconst y6 = y4 + rz * (y3 - y4);\n\tconst x7 = x4 + radius * (x5 - x4);\n\tconst y7 = y4 + radius * (y5 - y4);\n\tconst x8 = x4 + rz * (x2 - x4);\n\tconst y8 = y4 + rz * (y2 - y4);\n\n\tconst x9 = x2 + ry * (x4 - x2);\n\tconst y9 = y2 + ry * (y4 - y2);\n\tconst x10 = x2 + radius * (x5 - x2);\n\tconst y10 = y2 + radius * (y5 - y2);\n\tconst x11 = x2 + rx * (x3 - x2);\n\tconst y11 = y2 + rx * (y3 - y2);\n\n\tconst x12 = x3 + rx * (x2 - x3);\n\tconst y12 = y3 + rx * (y2 - y3);\n\tconst x13 = x3 + radius * (x5 - x3);\n\tconst y13 = y3 + radius * (y5 - y3);\n\tconst x14 = x3 + ry * (x4 - x3);\n\tconst y14 = y3 + ry * (y4 - y3);\n\n\t// Uvs\n\t// Top corner\n\tlet iuv = voffset * 2 - 1;\n\tuvs[++iuv] = x7;\n\tuvs[++iuv] = y7;\n\tuvs[++iuv] = x6;\n\tuvs[++iuv] = y6;\n\tuvs[++iuv] = x4;\n\tuvs[++iuv] = y4;\n\tuvs[++iuv] = x8;\n\tuvs[++iuv] = y8;\n\n\t// Bottom-right corner\n\tuvs[++iuv] = x10;\n\tuvs[++iuv] = y10;\n\tuvs[++iuv] = x9;\n\tuvs[++iuv] = y9;\n\tuvs[++iuv] = x2;\n\tuvs[++iuv] = y2;\n\tuvs[++iuv] = x11;\n\tuvs[++iuv] = y11;\n\n\t// Bottom-left corner\n\tuvs[++iuv] = x13;\n\tuvs[++iuv] = y13;\n\tuvs[++iuv] = x12;\n\tuvs[++iuv] = y12;\n\tuvs[++iuv] = x3;\n\tuvs[++iuv] = y3;\n\tuvs[++iuv] = x14;\n\tuvs[++iuv] = y14;\n\n\t// Others\n\tuvs[++iuv] = x5;\n\tuvs[++iuv] = y5;\n\n\tuvs[++iuv] = x7;\n\tuvs[++iuv] = y7;\n\n\tuvs[++iuv] = x8;\n\tuvs[++iuv] = y8;\n\tuvs[++iuv] = x9;\n\tuvs[++iuv] = y9;\n\n\tuvs[++iuv] = x10;\n\tuvs[++iuv] = y10;\n\n\tuvs[++iuv] = x11;\n\tuvs[++iuv] = y11;\n\tuvs[++iuv] = x12;\n\tuvs[++iuv] = y12;\n\n\tuvs[++iuv] = x13;\n\tuvs[++iuv] = y13;\n\n\tuvs[++iuv] = x14;\n\tuvs[++iuv] = y14;\n\tuvs[++iuv] = x6;\n\tuvs[++iuv] = y6;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeBuffer } from \"../e-shape-buffer\";\nimport { EShapeCorner } from \"../e-shape-corner\";\nimport { buildNullClipping, buildNullStep, buildNullUv, buildNullVertex } from \"./build-null\";\nimport {\n\tbuildTriangleRoundedClipping,\n\tbuildTriangleRoundedIndex,\n\tbuildTriangleRoundedStep,\n\tbuildTriangleRoundedUv,\n\tbuildTriangleRoundedVertex,\n\tTRIANGLE_ROUNDED_INDEX_COUNT,\n\tTRIANGLE_ROUNDED_VERTEX_COUNT,\n\tTRIANGLE_ROUNDED_WORLD_SIZE\n} from \"./build-triangle-rounded\";\nimport { BuilderLineOfAny } from \"./builder-line-of-any\";\nimport { toTexture, toTextureTransformId, toTextureUvs, toTransformLocalId } from \"./builders\";\nimport { copyClipping } from \"./copy-clipping\";\nimport { copyIndex } from \"./copy-index\";\nimport { copyStep } from \"./copy-step\";\nimport { copyUvs } from \"./copy-uv\";\nimport { copyVertex } from \"./copy-vertex\";\nimport { EShapeLineOfAnyPoints } from \"./e-shape-line-of-any-points\";\nimport { EShapeLineOfAnyPointsImpl } from \"./e-shape-line-of-any-points-impl\";\n\nexport class BuilderLineOfTriangleRoundeds extends BuilderLineOfAny {\n\tprotected radius: number;\n\tprotected corner: EShapeCorner;\n\n\tconstructor(\n\t\tvertexOffset: number,\n\t\tindexOffset: number,\n\t\tvertexCount: number,\n\t\tindexCount: number,\n\t\tpointCountReserved: number\n\t) {\n\t\tsuper(vertexOffset, indexOffset, vertexCount, indexCount, pointCountReserved);\n\t\tthis.radius = NaN;\n\t\tthis.corner = NaN;\n\t}\n\n\tinit(buffer: EShapeBuffer): void {\n\t\tbuffer.updateIndices();\n\t\tconst voffset = this.vertexOffset;\n\t\tconst ioffset = this.indexOffset;\n\t\tconst pointCountReserved = this.pointCountReserved;\n\t\tif (0 < pointCountReserved) {\n\t\t\tbuildTriangleRoundedIndex(buffer.indices, voffset, ioffset);\n\t\t\tcopyIndex(\n\t\t\t\tbuffer.indices,\n\t\t\t\tTRIANGLE_ROUNDED_VERTEX_COUNT,\n\t\t\t\tioffset,\n\t\t\t\tTRIANGLE_ROUNDED_INDEX_COUNT,\n\t\t\t\tpointCountReserved\n\t\t\t);\n\t\t}\n\t}\n\n\tupdate(buffer: EShapeBuffer, shape: EShape): void {\n\t\tconst points = shape.points;\n\t\tif (points instanceof EShapeLineOfAnyPointsImpl) {\n\t\t\tthis.updateVertexClippingStepAndUv(buffer, shape, points);\n\t\t\tthis.updateLineOfAnyColorFill(buffer, shape, points, TRIANGLE_ROUNDED_VERTEX_COUNT);\n\t\t\tthis.updateLineOfAnyColorStroke(buffer, shape, points, TRIANGLE_ROUNDED_VERTEX_COUNT);\n\t\t}\n\t}\n\n\tprotected updateVertexClippingStepAndUv(\n\t\tbuffer: EShapeBuffer,\n\t\tshape: EShape,\n\t\tpoints: EShapeLineOfAnyPoints\n\t): void {\n\t\tconst pointId = points.id;\n\t\tconst pointOffset = points.offset;\n\t\tconst pointOffsetId = pointOffset.id;\n\t\tconst isPointChanged = pointId !== this.pointId || pointOffsetId !== this.pointOffsetId;\n\n\t\tconst pointSize = points.size;\n\t\tconst pointSizeId = pointSize.id;\n\t\tconst isPointSizeChanged = pointSizeId !== this.pointSizeId;\n\n\t\tconst size = shape.size;\n\t\tconst sizeX = size.x;\n\t\tconst sizeY = size.y;\n\t\tconst isSizeChanged = sizeX !== this.sizeX || sizeY !== this.sizeY;\n\n\t\tconst radius = shape.radius;\n\t\tconst isRadiusChanged = radius !== this.radius;\n\n\t\tconst transformLocalId = toTransformLocalId(shape);\n\t\tconst isTransformChanged = this.transformLocalId !== transformLocalId;\n\n\t\tconst stroke = shape.stroke;\n\t\tconst strokeAlign = stroke.align;\n\t\tconst strokeWidth = stroke.enable ? stroke.width : 0;\n\t\tconst strokeStyle = stroke.style;\n\t\tconst isStrokeChanged =\n\t\t\tthis.strokeAlign !== strokeAlign ||\n\t\t\tthis.strokeWidth !== strokeWidth ||\n\t\t\tthis.strokeStyle !== strokeStyle;\n\n\t\tconst corner = shape.corner;\n\t\tconst isCornerChanged = this.corner !== corner;\n\n\t\tconst texture = toTexture(shape);\n\t\tconst textureTransformId = toTextureTransformId(texture);\n\t\tconst isTextureChanged =\n\t\t\ttexture !== this.texture || textureTransformId !== this.textureTransformId;\n\n\t\tconst isVertexChanged =\n\t\t\tisPointChanged ||\n\t\t\tisPointSizeChanged ||\n\t\t\tisSizeChanged ||\n\t\t\tisRadiusChanged ||\n\t\t\tisStrokeChanged;\n\n\t\tif (isVertexChanged || isTransformChanged || isCornerChanged || isTextureChanged) {\n\t\t\tthis.pointId = pointId;\n\t\t\tconst formatted = points.formatted;\n\t\t\tthis.pointCount = formatted.length;\n\t\t\tthis.pointOffsetId = pointOffsetId;\n\t\t\tthis.pointSizeId = pointSizeId;\n\t\t\tthis.sizeX = sizeX;\n\t\t\tthis.sizeY = sizeY;\n\t\t\tthis.radius = radius;\n\t\t\tthis.transformLocalId = transformLocalId;\n\t\t\tthis.strokeAlign = strokeAlign;\n\t\t\tthis.strokeWidth = strokeWidth;\n\t\t\tthis.strokeStyle = strokeStyle;\n\t\t\tthis.corner = corner;\n\t\t\tthis.texture = texture;\n\t\t\tthis.textureTransformId = textureTransformId;\n\n\t\t\t// Buffer\n\t\t\tbuffer.updateVertices();\n\t\t\tif (isVertexChanged || isCornerChanged) {\n\t\t\t\tbuffer.updateClippings();\n\t\t\t}\n\t\t\tif (isVertexChanged || isTransformChanged || isCornerChanged) {\n\t\t\t\tbuffer.updateSteps();\n\t\t\t}\n\t\t\tif (isVertexChanged || isTextureChanged) {\n\t\t\t\tbuffer.updateUvs();\n\t\t\t}\n\t\t\tconst pointCount = this.pointCount;\n\t\t\tconst pointsValues = formatted.values;\n\t\t\tconst voffset = this.vertexOffset;\n\t\t\tconst vertices = buffer.vertices;\n\t\t\tconst clippings = buffer.clippings;\n\t\t\tconst steps = buffer.steps;\n\t\t\tconst uvs = buffer.uvs;\n\t\t\tconst internalTransform = shape.transform.internalTransform;\n\t\t\tconst textureUvs = toTextureUvs(texture);\n\t\t\tif (0 < pointCount && pointSize.isStaticX() && pointSize.isStaticY()) {\n\t\t\t\tconst pointSizeX = pointSize.getX(0);\n\t\t\t\tconst pointSizeY = pointSize.getY(0);\n\n\t\t\t\t// Vertices\n\t\t\t\tbuildTriangleRoundedVertex(\n\t\t\t\t\tvertices,\n\t\t\t\t\tvoffset,\n\t\t\t\t\t0,\n\t\t\t\t\t0,\n\t\t\t\t\tpointSizeX,\n\t\t\t\t\tpointSizeY,\n\t\t\t\t\tstrokeAlign,\n\t\t\t\t\tstrokeWidth,\n\t\t\t\t\tradius,\n\t\t\t\t\tinternalTransform,\n\t\t\t\t\tTRIANGLE_ROUNDED_WORLD_SIZE\n\t\t\t\t);\n\t\t\t\tcopyVertex(\n\t\t\t\t\tvertices,\n\t\t\t\t\tinternalTransform,\n\t\t\t\t\tvoffset,\n\t\t\t\t\tTRIANGLE_ROUNDED_VERTEX_COUNT,\n\t\t\t\t\tpointCount,\n\t\t\t\t\tpointsValues,\n\t\t\t\t\tpointOffset\n\t\t\t\t);\n\n\t\t\t\t// Clippings\n\t\t\t\tif (isVertexChanged || isCornerChanged) {\n\t\t\t\t\tbuildTriangleRoundedClipping(clippings, voffset, corner, radius);\n\t\t\t\t\tcopyClipping(clippings, voffset, TRIANGLE_ROUNDED_VERTEX_COUNT, pointCount);\n\t\t\t\t}\n\n\t\t\t\t// Steps\n\t\t\t\tif (isVertexChanged || isTransformChanged || isCornerChanged) {\n\t\t\t\t\tbuildTriangleRoundedStep(\n\t\t\t\t\t\tsteps,\n\t\t\t\t\t\tclippings,\n\t\t\t\t\t\tvoffset,\n\t\t\t\t\t\tstrokeWidth,\n\t\t\t\t\t\tstrokeStyle,\n\t\t\t\t\t\tradius,\n\t\t\t\t\t\tTRIANGLE_ROUNDED_WORLD_SIZE\n\t\t\t\t\t);\n\t\t\t\t\tcopyStep(steps, voffset, TRIANGLE_ROUNDED_VERTEX_COUNT, pointCount);\n\t\t\t\t}\n\n\t\t\t\t// UVs\n\t\t\t\tif (isVertexChanged || isTextureChanged) {\n\t\t\t\t\tbuildTriangleRoundedUv(\n\t\t\t\t\t\tuvs,\n\t\t\t\t\t\tvoffset,\n\t\t\t\t\t\ttextureUvs,\n\t\t\t\t\t\tradius,\n\t\t\t\t\t\tTRIANGLE_ROUNDED_WORLD_SIZE\n\t\t\t\t\t);\n\t\t\t\t\tcopyUvs(uvs, voffset, TRIANGLE_ROUNDED_VERTEX_COUNT, pointCount);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (let i = 0; i < pointCount; ++i) {\n\t\t\t\t\tconst ip = i << 1;\n\t\t\t\t\tconst px = pointsValues[ip] + pointOffset.getX(i);\n\t\t\t\t\tconst py = pointsValues[ip + 1] + pointOffset.getY(i);\n\t\t\t\t\tconst pointSizeX = pointSize.getX(i);\n\t\t\t\t\tconst pointSizeY = pointSize.getY(i);\n\n\t\t\t\t\tconst iv = voffset + i * TRIANGLE_ROUNDED_VERTEX_COUNT;\n\n\t\t\t\t\t// Vertices\n\t\t\t\t\tbuildTriangleRoundedVertex(\n\t\t\t\t\t\tvertices,\n\t\t\t\t\t\tiv,\n\t\t\t\t\t\tpx,\n\t\t\t\t\t\tpy,\n\t\t\t\t\t\tpointSizeX,\n\t\t\t\t\t\tpointSizeY,\n\t\t\t\t\t\tstrokeAlign,\n\t\t\t\t\t\tstrokeWidth,\n\t\t\t\t\t\tradius,\n\t\t\t\t\t\tinternalTransform,\n\t\t\t\t\t\tTRIANGLE_ROUNDED_WORLD_SIZE\n\t\t\t\t\t);\n\n\t\t\t\t\t// Clippings\n\t\t\t\t\tif (isVertexChanged || isCornerChanged) {\n\t\t\t\t\t\tbuildTriangleRoundedClipping(clippings, iv, corner, radius);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Steps\n\t\t\t\t\tif (isVertexChanged || isTransformChanged || isCornerChanged) {\n\t\t\t\t\t\tbuildTriangleRoundedStep(\n\t\t\t\t\t\t\tsteps,\n\t\t\t\t\t\t\tclippings,\n\t\t\t\t\t\t\tiv,\n\t\t\t\t\t\t\tstrokeWidth,\n\t\t\t\t\t\t\tstrokeStyle,\n\t\t\t\t\t\t\tradius,\n\t\t\t\t\t\t\tTRIANGLE_ROUNDED_WORLD_SIZE\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\t// UVs\n\t\t\t\t\tif (isVertexChanged || isTextureChanged) {\n\t\t\t\t\t\tbuildTriangleRoundedUv(\n\t\t\t\t\t\t\tuvs,\n\t\t\t\t\t\t\tiv,\n\t\t\t\t\t\t\ttextureUvs,\n\t\t\t\t\t\t\tradius,\n\t\t\t\t\t\t\tTRIANGLE_ROUNDED_WORLD_SIZE\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Fill the rest\n\t\t\tconst pointCountReserved = this.pointCountReserved;\n\t\t\tconst voffsetReserved = voffset + pointCount * TRIANGLE_ROUNDED_VERTEX_COUNT;\n\t\t\tconst vcountReserved =\n\t\t\t\tTRIANGLE_ROUNDED_VERTEX_COUNT * (pointCountReserved - pointCount);\n\t\t\tbuildNullVertex(vertices, voffsetReserved, vcountReserved);\n\t\t\tbuildNullStep(steps, voffsetReserved, vcountReserved);\n\t\t\tbuildNullClipping(clippings, voffsetReserved, vcountReserved);\n\t\t\tbuildNullUv(uvs, voffsetReserved, vcountReserved);\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeBuffer } from \"../e-shape-buffer\";\nimport { EShapeUploaded } from \"../e-shape-uploaded\";\nimport {\n\tTRIANGLE_ROUNDED_INDEX_COUNT,\n\tTRIANGLE_ROUNDED_VERTEX_COUNT\n} from \"./build-triangle-rounded\";\nimport { BuilderLineOfTriangleRoundeds } from \"./builder-line-of-triangle-roundeds\";\nimport { createLineOfAnyUploaded } from \"./create-line-of-any-uploaded\";\n\nexport const createLineOfTriangleRoundedsUploaded = (\n\tbuffer: EShapeBuffer,\n\tshape: EShape,\n\tvoffset: number,\n\tioffset: number,\n\tantialiasWeight: number\n): EShapeUploaded | null => {\n\treturn createLineOfAnyUploaded(\n\t\tbuffer,\n\t\tshape,\n\t\tvoffset,\n\t\tTRIANGLE_ROUNDED_VERTEX_COUNT,\n\t\tioffset,\n\t\tTRIANGLE_ROUNDED_INDEX_COUNT,\n\t\tantialiasWeight,\n\t\tBuilderLineOfTriangleRoundeds\n\t);\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeCorner } from \"../e-shape-corner\";\nimport { hitTestTriangleFilled } from \"./hit-test-triangle\";\n\nconst containsCorner_ = (\n\tshape: EShape,\n\tx: number,\n\ty: number,\n\tr: number,\n\taw: number,\n\tsw: number,\n\tss: number\n): boolean => {\n\tconst fill = shape.fill;\n\tif (fill.enable) {\n\t\tif (x * x + y * y <= r * r) {\n\t\t\treturn true;\n\t\t}\n\t} else {\n\t\tif (0 < sw) {\n\t\t\tconst d = x * x + y * y;\n\t\t\tif (d <= r * r) {\n\t\t\t\tconst w = Math.max(0.0, r * (1 - (sw * ss) / aw));\n\t\t\t\tif (w * w <= d) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn false;\n};\n\nconst containsCorner = (\n\tshape: EShape,\n\tx: number,\n\ty: number,\n\tx0: number,\n\ty0: number,\n\tx1: number,\n\ty1: number,\n\tx2: number,\n\ty2: number,\n\tx3: number,\n\ty3: number,\n\tr12: number,\n\tr13: number,\n\taw: number,\n\tradius: number,\n\tsw: number,\n\tss: number\n): boolean => {\n\tconst xl = x1 + r12 * (x2 - x1) - x0;\n\tconst yl = y1 + r12 * (y2 - y1) - y0;\n\tconst n = Math.sqrt(xl * xl + yl * yl);\n\tconst threshold = 0.00001;\n\tif (threshold < n) {\n\t\tconst ni = 1 / n;\n\t\tconst nlx = xl * ni;\n\t\tconst nly = yl * ni;\n\n\t\tconst xr = x1 + r13 * (x3 - x1) - x0;\n\t\tconst yr = y1 + r13 * (y3 - y1) - y0;\n\t\tconst nrx = xr * ni;\n\t\tconst nry = yr * ni;\n\n\t\tconst det = nlx * nry - nrx * nly;\n\t\tif (threshold < Math.abs(det)) {\n\t\t\tconst deti = 1 / det;\n\t\t\tconst xc = x - x0;\n\t\t\tconst yc = y - y0;\n\t\t\tconst dx = (+nry * xc - nrx * yc) * deti;\n\t\t\tconst dy = (-nly * xc + nlx * yc) * deti;\n\t\t\tif (containsCorner_(shape, dx, dy, n, aw * radius, sw, ss)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t}\n\treturn false;\n};\n\nexport const hitTestTriangleRounded = (\n\tshape: EShape,\n\tx: number,\n\ty: number,\n\tax: number,\n\tay: number,\n\tsw: number,\n\tss: number\n): boolean => {\n\tconst a = (2 * ay) / ax;\n\tif (hitTestTriangleFilled(x, y, a, -ay, +ay)) {\n\t\tconst az = Math.sqrt(ax * ax + 4 * ay * ay);\n\t\tconst aw = (2 * ax * ay) / (ax + az);\n\t\tconst radius = shape.radius;\n\n\t\tconst x0 = 0;\n\t\tconst y0 = ay - aw;\n\t\tconst x1 = 0;\n\t\tconst y1 = -ay;\n\t\tconst x4 = +ax;\n\t\tconst y4 = +ay;\n\t\tconst x7 = -x4;\n\t\tconst y7 = +y4;\n\t\tconst x10 = x1 + radius * (x0 - x1);\n\t\tconst y10 = y1 + radius * (y0 - y1);\n\t\tconst x11 = x4 + radius * (x0 - x4);\n\t\tconst y11 = y4 + radius * (y0 - y4);\n\t\tconst y12 = +y11;\n\t\tconst x12 = -x11;\n\n\t\tconst c0 = -a * x + y10 - y <= 0;\n\t\tconst c1 = +a * x + y10 - y <= 0;\n\t\tconst c2 = y <= y11;\n\t\tconst corner = shape.corner;\n\t\tif (!c0 && !c1 && corner & EShapeCorner.TOP) {\n\t\t\t// Top corner\n\t\t\tconst rz = (0.5 * (az - aw) * radius) / az;\n\t\t\tif (\n\t\t\t\tcontainsCorner(\n\t\t\t\t\tshape,\n\t\t\t\t\tx,\n\t\t\t\t\ty,\n\t\t\t\t\tx10,\n\t\t\t\t\ty10,\n\t\t\t\t\tx1,\n\t\t\t\t\ty1,\n\t\t\t\t\tx7,\n\t\t\t\t\ty7,\n\t\t\t\t\tx4,\n\t\t\t\t\ty4,\n\t\t\t\t\trz,\n\t\t\t\t\trz,\n\t\t\t\t\taw,\n\t\t\t\t\tradius,\n\t\t\t\t\tsw,\n\t\t\t\t\tss\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t} else if (!c0 && !c2 && corner & EShapeCorner.BOTTOM_LEFT) {\n\t\t\t// Bottom-left corner\n\t\t\tconst ry = (aw * radius) / (2 * ay);\n\t\t\tconst rx = (ry * az) / (2 * ax);\n\t\t\tif (\n\t\t\t\tcontainsCorner(\n\t\t\t\t\tshape,\n\t\t\t\t\tx,\n\t\t\t\t\ty,\n\t\t\t\t\tx12,\n\t\t\t\t\ty12,\n\t\t\t\t\tx7,\n\t\t\t\t\ty7,\n\t\t\t\t\tx4,\n\t\t\t\t\ty4,\n\t\t\t\t\tx1,\n\t\t\t\t\ty1,\n\t\t\t\t\trx,\n\t\t\t\t\try,\n\t\t\t\t\taw,\n\t\t\t\t\tradius,\n\t\t\t\t\tsw,\n\t\t\t\t\tss\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t} else if (!c1 && !c2 && corner & EShapeCorner.BOTTOM_RIGHT) {\n\t\t\t// Bottom-right corner\n\t\t\tconst ry = (aw * radius) / (2 * ay);\n\t\t\tconst rx = (ry * az) / (2 * ax);\n\t\t\tif (\n\t\t\t\tcontainsCorner(\n\t\t\t\t\tshape,\n\t\t\t\t\tx,\n\t\t\t\t\ty,\n\t\t\t\t\tx11,\n\t\t\t\t\ty11,\n\t\t\t\t\tx4,\n\t\t\t\t\ty4,\n\t\t\t\t\tx1,\n\t\t\t\t\ty1,\n\t\t\t\t\tx7,\n\t\t\t\t\ty7,\n\t\t\t\t\try,\n\t\t\t\t\trx,\n\t\t\t\t\taw,\n\t\t\t\t\tradius,\n\t\t\t\t\tsw,\n\t\t\t\t\tss\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t} else {\n\t\t\t// Others\n\t\t\tconst fill = shape.fill;\n\t\t\tif (fill.enable) {\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\tif (0 < sw) {\n\t\t\t\t\tconst s = sw * ss;\n\t\t\t\t\tconst cy = ay - aw;\n\t\t\t\t\tconst ay1 = cy + ((-ay - cy) * Math.max(0.0, aw - s)) / aw;\n\t\t\t\t\tconst ay2 = ay - s;\n\t\t\t\t\tif (!hitTestTriangleFilled(x, y, a, ay1, ay2)) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn false;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapePrimitive } from \"./e-shape-primitive\";\nimport { hitTestTriangleRounded } from \"./hit-test-triangle-rounded\";\n\nexport class EShapeTriangleRounded extends EShapePrimitive {\n\tconstructor(type: EShapeType = EShapeType.TRIANGLE_ROUNDED) {\n\t\tsuper(type);\n\t}\n\n\tclone(): EShapeTriangleRounded {\n\t\treturn new EShapeTriangleRounded(this.type).copy(this);\n\t}\n\n\tcontainsAbs(\n\t\tx: number,\n\t\ty: number,\n\t\tax: number,\n\t\tay: number,\n\t\tsw: number,\n\t\tss: number,\n\t\tsa: number\n\t): boolean {\n\t\tif (super.containsAbsBBox(x, y, ax, ay)) {\n\t\t\treturn hitTestTriangleRounded(this, x, y, ax, ay, sw, ss);\n\t\t}\n\t\treturn false;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapeLineOfAny } from \"./e-shape-line-of-any\";\nimport { EShapeLineOfAnyPoints } from \"./e-shape-line-of-any-points\";\nimport { EShapeLineOfAnyPointsHitTester } from \"./e-shape-line-of-any-points-hit-tester\";\nimport { EShapeLineOfAnyPointsHitTesterToRange } from \"./e-shape-line-of-any-points-hit-tester-to-range\";\nimport { EShapeLineOfAnyPointsHitTesterToThreshold } from \"./e-shape-line-of-any-points-hit-tester-to-threshold\";\nimport { EShapeLineOfAnyPointsImpl } from \"./e-shape-line-of-any-points-impl\";\nimport { EShapeTriangleRounded } from \"./e-shape-triangle-rounded\";\nimport { toThresholdDefault } from \"./to-threshold-default\";\n\nexport class EShapeLineOfTriangleRoundeds extends EShapeTriangleRounded implements EShapeLineOfAny {\n\tprotected declare _points: EShapeLineOfAnyPoints;\n\tprotected _tester: EShapeLineOfAnyPointsHitTester<unknown>;\n\n\tconstructor(type: EShapeType = EShapeType.LINE_OF_TRIANGLE_ROUNDEDS) {\n\t\tsuper(type);\n\t\tthis._points = new EShapeLineOfAnyPointsImpl(this);\n\n\t\tthis._tester = (x, y, ax, ay, ox, oy, px, py, sw, ss, sa): boolean => {\n\t\t\treturn this.containsPointAbs(x, y, ax, ay, ox, oy, px, py, sw, ss, sa);\n\t\t};\n\t}\n\n\tget points(): EShapeLineOfAnyPoints {\n\t\treturn this._points;\n\t}\n\n\tclone(): EShapeLineOfTriangleRoundeds {\n\t\treturn new EShapeLineOfTriangleRoundeds(this.type).copy(this);\n\t}\n\n\tcontainsAbs(\n\t\tx: number,\n\t\ty: number,\n\t\tax: number,\n\t\tay: number,\n\t\tsw: number,\n\t\tss: number,\n\t\tsa: number\n\t): boolean {\n\t\tconst threshold = toThresholdDefault(sw, ss, this._points.size.getLimit());\n\t\tif (this.containsAbsBBox(x, y, ax + threshold, ay + threshold)) {\n\t\t\treturn this._points.calcHitPointAbs(\n\t\t\t\tx,\n\t\t\t\ty,\n\t\t\t\tsw,\n\t\t\t\tss,\n\t\t\t\tsa,\n\t\t\t\tthreshold,\n\t\t\t\tnull,\n\t\t\t\tthis._tester,\n\t\t\t\tnull\n\t\t\t);\n\t\t}\n\t\treturn false;\n\t}\n\n\tcontainsPointAbs(\n\t\tx: number,\n\t\ty: number,\n\t\tax: number,\n\t\tay: number,\n\t\tox: number,\n\t\toy: number,\n\t\tpx: number,\n\t\tpy: number,\n\t\tsw: number,\n\t\tss: number,\n\t\tsa: number\n\t): boolean {\n\t\treturn super.containsAbs(x - px - ox, y - py - oy, ax, ay, sw, ss, sa);\n\t}\n\n\tcalcHitPoint<RESULT>(\n\t\tx: number,\n\t\ty: number,\n\t\ttoThreshold: EShapeLineOfAnyPointsHitTesterToThreshold | null,\n\t\ttoRange: EShapeLineOfAnyPointsHitTesterToRange | null,\n\t\ttester: EShapeLineOfAnyPointsHitTester<RESULT> | null,\n\t\tresult: RESULT\n\t): boolean {\n\t\tconst data = this.toHitTestData(x, y);\n\t\tconst threshold = (toThreshold || toThresholdDefault)(\n\t\t\tdata.strokeWidth,\n\t\t\tdata.strokeScale,\n\t\t\tthis._points.size.getLimit()\n\t\t);\n\t\tif (this.containsAbsBBox(data.x, data.y, data.width + threshold, data.height + threshold)) {\n\t\t\treturn this._points.calcHitPointAbs(\n\t\t\t\tdata.x,\n\t\t\t\tdata.y,\n\t\t\t\tdata.strokeWidth,\n\t\t\t\tdata.strokeScale,\n\t\t\t\tdata.strokeAlign,\n\t\t\t\tthreshold,\n\t\t\t\ttoRange,\n\t\t\t\ttester || this._tester,\n\t\t\t\tresult\n\t\t\t);\n\t\t}\n\t\treturn false;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { deserializeBase } from \"./deserialize-base\";\nimport { EShapeLineOfTriangleRoundeds } from \"./e-shape-line-of-triangle-roundeds\";\n\nexport const deserializeLineOfTriangleRoundeds = (\n\titem: DDiagramSerializedItem,\n\tmanager: EShapeResourceManagerDeserialization,\n\tshape?: EShapeLineOfTriangleRoundeds\n): Promise<EShapeLineOfTriangleRoundeds> | EShapeLineOfTriangleRoundeds => {\n\treturn deserializeBase(item, manager, shape || new EShapeLineOfTriangleRoundeds());\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeCapabilities } from \"../e-shape-capabilities\";\nimport { EShapeCapability } from \"../e-shape-capability\";\nimport { EShapeDeserializers } from \"../e-shape-deserializers\";\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapeUploadeds } from \"../e-shape-uploadeds\";\nimport { createLineOfTriangleRoundedsUploaded } from \"../variant/create-line-of-triangle-roundeds-uploaded\";\nimport { deserializeLineOfTriangleRoundeds } from \"../variant/deserialize-line-of-triangle-roundeds\";\n\nexport const loadShapeLineOfTriangleRoundeds = (): void => {\n\tEShapeUploadeds[EShapeType.LINE_OF_TRIANGLE_ROUNDEDS] = createLineOfTriangleRoundedsUploaded;\n\tEShapeDeserializers[EShapeType.LINE_OF_TRIANGLE_ROUNDEDS] = deserializeLineOfTriangleRoundeds;\n\tEShapeCapabilities.set(\n\t\tEShapeType.LINE_OF_TRIANGLE_ROUNDEDS,\n\t\tEShapeCapability.PRIMITIVE | EShapeCapability.STROKE_SIDE | EShapeCapability.BORDER_RADIUS\n\t);\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeBuffer } from \"../e-shape-buffer\";\nimport { buildNullStep, buildNullUv, buildNullVertex } from \"./build-null\";\nimport {\n\tbuildTriangleClipping,\n\tbuildTriangleIndex,\n\tbuildTriangleStep,\n\tbuildTriangleUv,\n\tbuildTriangleVertex,\n\tTRIANGLE_INDEX_COUNT,\n\tTRIANGLE_VERTEX_COUNT,\n\tTRIANGLE_WORLD_SIZE\n} from \"./build-triangle\";\nimport { BuilderLineOfAny } from \"./builder-line-of-any\";\nimport { toTexture, toTextureTransformId, toTextureUvs, toTransformLocalId } from \"./builders\";\nimport { copyClipping } from \"./copy-clipping\";\nimport { copyIndex } from \"./copy-index\";\nimport { copyStep } from \"./copy-step\";\nimport { copyUvs } from \"./copy-uv\";\nimport { copyVertex } from \"./copy-vertex\";\nimport { EShapeLineOfAnyPoints } from \"./e-shape-line-of-any-points\";\nimport { EShapeLineOfAnyPointsImpl } from \"./e-shape-line-of-any-points-impl\";\n\nexport class BuilderLineOfTriangles extends BuilderLineOfAny {\n\tinit(buffer: EShapeBuffer): void {\n\t\tbuffer.updateClippings();\n\t\tbuffer.updateIndices();\n\t\tconst clippings = buffer.clippings;\n\t\tconst indices = buffer.indices;\n\t\tconst voffset = this.vertexOffset;\n\t\tconst ioffset = this.indexOffset;\n\t\tconst pointCountReserved = this.pointCountReserved;\n\t\tif (0 < pointCountReserved) {\n\t\t\tbuildTriangleClipping(clippings, voffset);\n\t\t\tcopyClipping(clippings, voffset, TRIANGLE_VERTEX_COUNT, pointCountReserved);\n\t\t\tbuildTriangleIndex(indices, voffset, ioffset);\n\t\t\tcopyIndex(\n\t\t\t\tindices,\n\t\t\t\tTRIANGLE_VERTEX_COUNT,\n\t\t\t\tioffset,\n\t\t\t\tTRIANGLE_INDEX_COUNT,\n\t\t\t\tpointCountReserved\n\t\t\t);\n\t\t}\n\t}\n\n\tupdate(buffer: EShapeBuffer, shape: EShape): void {\n\t\tconst points = shape.points;\n\t\tif (points instanceof EShapeLineOfAnyPointsImpl) {\n\t\t\tthis.updateVertexStepAndUvs(buffer, shape, points);\n\t\t\tthis.updateLineOfAnyColorFill(buffer, shape, points, TRIANGLE_VERTEX_COUNT);\n\t\t\tthis.updateLineOfAnyColorStroke(buffer, shape, points, TRIANGLE_VERTEX_COUNT);\n\t\t}\n\t}\n\n\tprotected updateVertexStepAndUvs(\n\t\tbuffer: EShapeBuffer,\n\t\tshape: EShape,\n\t\tpoints: EShapeLineOfAnyPoints\n\t): void {\n\t\tconst pointId = points.id;\n\t\tconst pointOffset = points.offset;\n\t\tconst pointOffsetId = pointOffset.id;\n\t\tconst isPointChanged = pointId !== this.pointId || pointOffsetId !== this.pointOffsetId;\n\n\t\tconst pointSize = points.size;\n\t\tconst pointSizeId = pointSize.id;\n\t\tconst isPointSizeChanged = pointSizeId !== this.pointSizeId;\n\n\t\tconst size = shape.size;\n\t\tconst sizeX = size.x;\n\t\tconst sizeY = size.y;\n\t\tconst isSizeChanged = sizeX !== this.sizeX || sizeY !== this.sizeY;\n\n\t\tconst transformLocalId = toTransformLocalId(shape);\n\t\tconst isTransformChanged = this.transformLocalId !== transformLocalId;\n\n\t\tconst stroke = shape.stroke;\n\t\tconst strokeAlign = stroke.align;\n\t\tconst strokeWidth = stroke.enable ? stroke.width : 0;\n\t\tconst strokeStyle = stroke.style;\n\t\tconst isStrokeChanged =\n\t\t\tthis.strokeAlign !== strokeAlign ||\n\t\t\tthis.strokeWidth !== strokeWidth ||\n\t\t\tthis.strokeStyle !== strokeStyle;\n\n\t\tconst texture = toTexture(shape);\n\t\tconst textureTransformId = toTextureTransformId(texture);\n\t\tconst isTextureChanged =\n\t\t\ttexture !== this.texture || textureTransformId !== this.textureTransformId;\n\n\t\tconst isVertexChanged =\n\t\t\tisPointChanged || isPointSizeChanged || isSizeChanged || isStrokeChanged;\n\n\t\tif (isVertexChanged || isTransformChanged || isTextureChanged) {\n\t\t\tthis.pointId = pointId;\n\t\t\tconst formatted = points.formatted;\n\t\t\tthis.pointCount = formatted.length;\n\t\t\tthis.pointOffsetId = pointOffsetId;\n\t\t\tthis.pointSizeId = pointSizeId;\n\t\t\tthis.sizeX = sizeX;\n\t\t\tthis.sizeY = sizeY;\n\t\t\tthis.transformLocalId = transformLocalId;\n\t\t\tthis.strokeAlign = strokeAlign;\n\t\t\tthis.strokeWidth = strokeWidth;\n\t\t\tthis.strokeStyle = strokeStyle;\n\n\t\t\t// Buffer\n\t\t\tbuffer.updateVertices();\n\t\t\tif (isVertexChanged || isTransformChanged) {\n\t\t\t\tbuffer.updateSteps();\n\t\t\t}\n\t\t\tif (isVertexChanged || isTextureChanged) {\n\t\t\t\tbuffer.updateUvs();\n\t\t\t}\n\n\t\t\tconst pointCount = this.pointCount;\n\t\t\tconst pointsValues = formatted.values;\n\t\t\tconst voffset = this.vertexOffset;\n\t\t\tconst vertices = buffer.vertices;\n\t\t\tconst steps = buffer.steps;\n\t\t\tconst clippings = buffer.clippings;\n\t\t\tconst uvs = buffer.uvs;\n\t\t\tconst textureUvs = toTextureUvs(texture);\n\t\t\tconst internalTransform = shape.transform.internalTransform;\n\t\t\tif (0 < pointCount && pointSize.isStaticX() && pointSize.isStaticY()) {\n\t\t\t\tconst pointSizeX = pointSize.getX(0);\n\t\t\t\tconst pointSizeY = pointSize.getY(0);\n\n\t\t\t\tbuildTriangleVertex(\n\t\t\t\t\tvertices,\n\t\t\t\t\tvoffset,\n\t\t\t\t\t0,\n\t\t\t\t\t0,\n\t\t\t\t\tpointSizeX,\n\t\t\t\t\tpointSizeY,\n\t\t\t\t\tstrokeAlign,\n\t\t\t\t\tstrokeWidth,\n\t\t\t\t\tinternalTransform,\n\t\t\t\t\tTRIANGLE_WORLD_SIZE\n\t\t\t\t);\n\t\t\t\tcopyVertex(\n\t\t\t\t\tvertices,\n\t\t\t\t\tinternalTransform,\n\t\t\t\t\tvoffset,\n\t\t\t\t\tTRIANGLE_VERTEX_COUNT,\n\t\t\t\t\tpointCount,\n\t\t\t\t\tpointsValues,\n\t\t\t\t\tpointOffset\n\t\t\t\t);\n\t\t\t\tif (isVertexChanged || isTransformChanged) {\n\t\t\t\t\tbuildTriangleStep(\n\t\t\t\t\t\tsteps,\n\t\t\t\t\t\tclippings,\n\t\t\t\t\t\tvoffset,\n\t\t\t\t\t\tTRIANGLE_VERTEX_COUNT,\n\t\t\t\t\t\tstrokeWidth,\n\t\t\t\t\t\tstrokeStyle,\n\t\t\t\t\t\tTRIANGLE_WORLD_SIZE\n\t\t\t\t\t);\n\t\t\t\t\tcopyStep(steps, voffset, TRIANGLE_VERTEX_COUNT, pointCount);\n\t\t\t\t}\n\t\t\t\tif (isVertexChanged || isTextureChanged) {\n\t\t\t\t\tbuildTriangleUv(uvs, textureUvs, voffset, TRIANGLE_WORLD_SIZE);\n\t\t\t\t\tcopyUvs(uvs, voffset, TRIANGLE_VERTEX_COUNT, pointCount);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (let i = 0; i < pointCount; ++i) {\n\t\t\t\t\tconst ip = i << 1;\n\t\t\t\t\tconst px = pointsValues[ip] + pointOffset.getX(i);\n\t\t\t\t\tconst py = pointsValues[ip + 1] + pointOffset.getY(i);\n\t\t\t\t\tconst pointSizeX = pointSize.getX(i);\n\t\t\t\t\tconst pointSizeY = pointSize.getY(i);\n\t\t\t\t\tconst iv = voffset + i * TRIANGLE_VERTEX_COUNT;\n\n\t\t\t\t\tbuildTriangleVertex(\n\t\t\t\t\t\tvertices,\n\t\t\t\t\t\tiv,\n\t\t\t\t\t\tpx,\n\t\t\t\t\t\tpy,\n\t\t\t\t\t\tpointSizeX,\n\t\t\t\t\t\tpointSizeY,\n\t\t\t\t\t\tstrokeAlign,\n\t\t\t\t\t\tstrokeWidth,\n\t\t\t\t\t\tinternalTransform,\n\t\t\t\t\t\tTRIANGLE_WORLD_SIZE\n\t\t\t\t\t);\n\t\t\t\t\tif (isVertexChanged || isTransformChanged) {\n\t\t\t\t\t\tbuildTriangleStep(\n\t\t\t\t\t\t\tsteps,\n\t\t\t\t\t\t\tclippings,\n\t\t\t\t\t\t\tiv,\n\t\t\t\t\t\t\tTRIANGLE_VERTEX_COUNT,\n\t\t\t\t\t\t\tstrokeWidth,\n\t\t\t\t\t\t\tstrokeStyle,\n\t\t\t\t\t\t\tTRIANGLE_WORLD_SIZE\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tif (isVertexChanged || isTextureChanged) {\n\t\t\t\t\t\tbuildTriangleUv(uvs, textureUvs, iv, TRIANGLE_WORLD_SIZE);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Fill the rest\n\t\t\tconst pointCountReserved = this.pointCountReserved;\n\t\t\tconst voffsetReserved = voffset + pointCount * TRIANGLE_VERTEX_COUNT;\n\t\t\tconst vcountReserved = TRIANGLE_VERTEX_COUNT * (pointCountReserved - pointCount);\n\t\t\tbuildNullVertex(vertices, voffsetReserved, vcountReserved);\n\t\t\tbuildNullStep(steps, voffsetReserved, vcountReserved);\n\t\t\tbuildNullUv(uvs, voffsetReserved, vcountReserved);\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeBuffer } from \"../e-shape-buffer\";\nimport { EShapeUploaded } from \"../e-shape-uploaded\";\nimport { TRIANGLE_INDEX_COUNT, TRIANGLE_VERTEX_COUNT } from \"./build-triangle\";\nimport { BuilderLineOfTriangles } from \"./builder-line-of-triangles\";\nimport { createLineOfAnyUploaded } from \"./create-line-of-any-uploaded\";\n\nexport const createLineOfTrianglesUploaded = (\n\tbuffer: EShapeBuffer,\n\tshape: EShape,\n\tvoffset: number,\n\tioffset: number,\n\tantialiasWeight: number\n): EShapeUploaded | null => {\n\treturn createLineOfAnyUploaded(\n\t\tbuffer,\n\t\tshape,\n\t\tvoffset,\n\t\tTRIANGLE_VERTEX_COUNT,\n\t\tioffset,\n\t\tTRIANGLE_INDEX_COUNT,\n\t\tantialiasWeight,\n\t\tBuilderLineOfTriangles\n\t);\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapePrimitive } from \"./e-shape-primitive\";\nimport { hitTestTriangle } from \"./hit-test-triangle\";\n\nexport class EShapeTriangle extends EShapePrimitive {\n\tconstructor(type: EShapeType = EShapeType.TRIANGLE) {\n\t\tsuper(type);\n\t}\n\n\tclone(): EShapeTriangle {\n\t\treturn new EShapeTriangle(this.type).copy(this);\n\t}\n\n\tcontainsAbs(\n\t\tx: number,\n\t\ty: number,\n\t\tax: number,\n\t\tay: number,\n\t\tsw: number,\n\t\tss: number,\n\t\tsa: number\n\t): boolean {\n\t\tif (super.containsAbsBBox(x, y, ax, ay)) {\n\t\t\treturn hitTestTriangle(this, x, y, ax, ay, sw, ss);\n\t\t}\n\t\treturn false;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapeLineOfAny } from \"./e-shape-line-of-any\";\nimport { EShapeLineOfAnyPoints } from \"./e-shape-line-of-any-points\";\nimport { EShapeLineOfAnyPointsHitTester } from \"./e-shape-line-of-any-points-hit-tester\";\nimport { EShapeLineOfAnyPointsHitTesterToRange } from \"./e-shape-line-of-any-points-hit-tester-to-range\";\nimport { EShapeLineOfAnyPointsHitTesterToThreshold } from \"./e-shape-line-of-any-points-hit-tester-to-threshold\";\nimport { EShapeLineOfAnyPointsImpl } from \"./e-shape-line-of-any-points-impl\";\nimport { EShapeTriangle } from \"./e-shape-triangle\";\nimport { toThresholdDefault } from \"./to-threshold-default\";\n\nexport class EShapeLineOfTriangles extends EShapeTriangle implements EShapeLineOfAny {\n\tprotected declare _points: EShapeLineOfAnyPoints;\n\tprotected _tester: EShapeLineOfAnyPointsHitTester<unknown>;\n\n\tconstructor(type: EShapeType = EShapeType.LINE_OF_TRIANGLES) {\n\t\tsuper(type);\n\t\tthis._points = new EShapeLineOfAnyPointsImpl(this);\n\n\t\tthis._tester = (x, y, ax, ay, ox, oy, px, py, sw, ss, sa): boolean => {\n\t\t\treturn this.containsPointAbs(x, y, ax, ay, ox, oy, px, py, sw, ss, sa);\n\t\t};\n\t}\n\n\tget points(): EShapeLineOfAnyPoints {\n\t\treturn this._points;\n\t}\n\n\tclone(): EShapeLineOfTriangles {\n\t\treturn new EShapeLineOfTriangles(this.type).copy(this);\n\t}\n\n\tcontainsAbs(\n\t\tx: number,\n\t\ty: number,\n\t\tax: number,\n\t\tay: number,\n\t\tsw: number,\n\t\tss: number,\n\t\tsa: number\n\t): boolean {\n\t\tconst threshold = toThresholdDefault(sw, ss, this._points.size.getLimit());\n\t\tif (this.containsAbsBBox(x, y, ax + threshold, ay + threshold)) {\n\t\t\treturn this._points.calcHitPointAbs(\n\t\t\t\tx,\n\t\t\t\ty,\n\t\t\t\tsw,\n\t\t\t\tss,\n\t\t\t\tsa,\n\t\t\t\tthreshold,\n\t\t\t\tnull,\n\t\t\t\tthis._tester,\n\t\t\t\tnull\n\t\t\t);\n\t\t}\n\t\treturn false;\n\t}\n\n\tcontainsPointAbs(\n\t\tx: number,\n\t\ty: number,\n\t\tax: number,\n\t\tay: number,\n\t\tox: number,\n\t\toy: number,\n\t\tpx: number,\n\t\tpy: number,\n\t\tsw: number,\n\t\tss: number,\n\t\tsa: number\n\t): boolean {\n\t\treturn super.containsAbs(x - px - ox, y - py - oy, ax, ay, sw, ss, sa);\n\t}\n\n\tcalcHitPoint<RESULT>(\n\t\tx: number,\n\t\ty: number,\n\t\ttoThreshold: EShapeLineOfAnyPointsHitTesterToThreshold | null,\n\t\ttoRange: EShapeLineOfAnyPointsHitTesterToRange | null,\n\t\ttester: EShapeLineOfAnyPointsHitTester<RESULT> | null,\n\t\tresult: RESULT\n\t): boolean {\n\t\tconst data = this.toHitTestData(x, y);\n\t\tconst threshold = (toThreshold || toThresholdDefault)(\n\t\t\tdata.strokeWidth,\n\t\t\tdata.strokeScale,\n\t\t\tthis._points.size.getLimit()\n\t\t);\n\t\tif (this.containsAbsBBox(data.x, data.y, data.width + threshold, data.height + threshold)) {\n\t\t\treturn this._points.calcHitPointAbs(\n\t\t\t\tdata.x,\n\t\t\t\tdata.y,\n\t\t\t\tdata.strokeWidth,\n\t\t\t\tdata.strokeScale,\n\t\t\t\tdata.strokeAlign,\n\t\t\t\tthreshold,\n\t\t\t\ttoRange,\n\t\t\t\ttester || this._tester,\n\t\t\t\tresult\n\t\t\t);\n\t\t}\n\t\treturn false;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { deserializeBase } from \"./deserialize-base\";\nimport { EShapeLineOfTriangles } from \"./e-shape-line-of-triangles\";\n\nexport const deserializeLineOfTriangles = (\n\titem: DDiagramSerializedItem,\n\tmanager: EShapeResourceManagerDeserialization,\n\tshape?: EShapeLineOfTriangles\n): Promise<EShapeLineOfTriangles> | EShapeLineOfTriangles => {\n\treturn deserializeBase(item, manager, shape || new EShapeLineOfTriangles());\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeDeserializers } from \"../e-shape-deserializers\";\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapeUploadeds } from \"../e-shape-uploadeds\";\nimport { createLineOfTrianglesUploaded } from \"../variant/create-line-of-triangles-uploaded\";\nimport { deserializeLineOfTriangles } from \"../variant/deserialize-line-of-triangles\";\n\nexport const loadShapeLineOfTriangles = (): void => {\n\tEShapeUploadeds[EShapeType.LINE_OF_TRIANGLES] = createLineOfTrianglesUploaded;\n\tEShapeDeserializers[EShapeType.LINE_OF_TRIANGLES] = deserializeLineOfTriangles;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeBuffer } from \"../e-shape-buffer\";\nimport { EShapeUploadedImpl } from \"../e-shape-uploaded\";\nimport { BuilderNull } from \"./builder-null\";\n\nexport const createNullUploaded = (\n\tbuffer: EShapeBuffer,\n\tshape: EShape,\n\tvoffset: number,\n\tioffset: number\n): EShapeUploadedImpl | null => {\n\treturn new EShapeUploadedImpl(buffer, voffset, ioffset, 0, 0, [\n\t\tnew BuilderNull(voffset, ioffset)\n\t]).init(shape);\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapePrimitive } from \"./e-shape-primitive\";\n\nexport class EShapeNull extends EShapePrimitive {\n\tconstructor(type: EShapeType = EShapeType.NULL) {\n\t\tsuper(type);\n\t}\n\n\tclone(): EShapeNull {\n\t\treturn new EShapeNull(this.type).copy(this);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { deserializeBase } from \"./deserialize-base\";\nimport { EShapeNull } from \"./e-shape-null\";\n\nexport const deserializeNull = (\n\titem: DDiagramSerializedItem,\n\tmanager: EShapeResourceManagerDeserialization,\n\tshape?: EShapeNull\n): Promise<EShapeNull> | EShapeNull => {\n\treturn deserializeBase(item, manager, shape || new EShapeNull());\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeDeserializers } from \"../e-shape-deserializers\";\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapeUploadeds } from \"../e-shape-uploadeds\";\nimport { createNullUploaded } from \"../variant/create-null-uploaded\";\nimport { deserializeNull } from \"../variant/deserialize-null\";\n\nexport const loadShapeNull = (): void => {\n\tEShapeUploadeds[EShapeType.NULL] = createNullUploaded;\n\tEShapeDeserializers[EShapeType.NULL] = deserializeNull;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { deserializeBase } from \"./deserialize-base\";\nimport { EShapeRectangle } from \"./e-shape-rectangle\";\n\nexport const deserializeRectangle = (\n\titem: DDiagramSerializedItem,\n\tmanager: EShapeResourceManagerDeserialization,\n\tshape?: EShapeRectangle\n): Promise<EShapeRectangle> | EShapeRectangle => {\n\treturn deserializeBase(item, manager, shape || new EShapeRectangle());\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeCapabilities } from \"../e-shape-capabilities\";\nimport { EShapeCapability } from \"../e-shape-capability\";\nimport { EShapeDeserializers } from \"../e-shape-deserializers\";\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapeUploadeds } from \"../e-shape-uploadeds\";\nimport { createRectangleUploaded } from \"../variant/create-rectangle-uploaded\";\nimport { deserializeRectangle } from \"../variant/deserialize-rectangle\";\n\nexport const loadShapeRectangle = (): void => {\n\tEShapeUploadeds[EShapeType.RECTANGLE] = createRectangleUploaded;\n\tEShapeDeserializers[EShapeType.RECTANGLE] = deserializeRectangle;\n\tEShapeCapabilities.set(\n\t\tEShapeType.RECTANGLE,\n\t\tEShapeCapability.PRIMITIVE | EShapeCapability.STROKE_SIDE\n\t);\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeBuffer } from \"../e-shape-buffer\";\nimport { EShapeCorner } from \"../e-shape-corner\";\nimport {\n\tbuildTriangleRoundedClipping,\n\tbuildTriangleRoundedIndex,\n\tbuildTriangleRoundedStep,\n\tbuildTriangleRoundedUv,\n\tbuildTriangleRoundedVertex,\n\tTRIANGLE_ROUNDED_WORLD_SIZE\n} from \"./build-triangle-rounded\";\nimport { BuilderBase } from \"./builder-base\";\nimport { toTexture, toTextureTransformId, toTextureUvs, toTransformLocalId } from \"./builders\";\n\nexport class BuilderTriangleRounded extends BuilderBase {\n\tprotected radius: number;\n\tprotected corner: EShapeCorner;\n\n\tconstructor(\n\t\tvertexOffset: number,\n\t\tindexOffset: number,\n\t\tvertexCount: number,\n\t\tindexCount: number\n\t) {\n\t\tsuper(vertexOffset, indexOffset, vertexCount, indexCount);\n\t\tthis.radius = NaN;\n\t\tthis.corner = NaN;\n\t}\n\n\tinit(buffer: EShapeBuffer): void {\n\t\tbuffer.updateIndices();\n\t\tbuildTriangleRoundedIndex(buffer.indices, this.vertexOffset, this.indexOffset);\n\t}\n\n\tupdate(buffer: EShapeBuffer, shape: EShape): void {\n\t\tthis.updateVertexClippingStepAndUv(buffer, shape);\n\t\tthis.updateColorFill(buffer, shape);\n\t\tthis.updateColorStroke(buffer, shape);\n\t}\n\n\tprotected updateVertexClippingStepAndUv(buffer: EShapeBuffer, shape: EShape): void {\n\t\tconst size = shape.size;\n\t\tconst sizeX = size.x;\n\t\tconst sizeY = size.y;\n\t\tconst isSizeChanged = sizeX !== this.sizeX || sizeY !== this.sizeY;\n\n\t\tconst radius = shape.radius;\n\t\tconst isRadiusChanged = radius !== this.radius;\n\n\t\tconst transformLocalId = toTransformLocalId(shape);\n\t\tconst isTransformChanged = this.transformLocalId !== transformLocalId;\n\n\t\tconst stroke = shape.stroke;\n\t\tconst strokeAlign = stroke.align;\n\t\tconst strokeWidth = stroke.enable ? stroke.width : 0;\n\t\tconst strokeStyle = stroke.style;\n\t\tconst isStrokeChanged =\n\t\t\tthis.strokeAlign !== strokeAlign ||\n\t\t\tthis.strokeWidth !== strokeWidth ||\n\t\t\tthis.strokeStyle !== strokeStyle;\n\n\t\tconst corner = shape.corner;\n\t\tconst isCornerChanged = corner !== this.corner;\n\n\t\tconst texture = toTexture(shape);\n\t\tconst textureTransformId = toTextureTransformId(texture);\n\t\tconst isTextureChanged =\n\t\t\ttexture !== this.texture || textureTransformId !== this.textureTransformId;\n\n\t\tconst isVertexChanged = isSizeChanged || isRadiusChanged || isStrokeChanged;\n\n\t\tif (isVertexChanged || isTransformChanged || isCornerChanged || isTextureChanged) {\n\t\t\tthis.sizeX = sizeX;\n\t\t\tthis.sizeY = sizeY;\n\t\t\tthis.radius = radius;\n\t\t\tthis.transformLocalId = transformLocalId;\n\t\t\tthis.strokeAlign = strokeAlign;\n\t\t\tthis.strokeWidth = strokeWidth;\n\t\t\tthis.strokeStyle = strokeStyle;\n\t\t\tthis.corner = corner;\n\t\t\tthis.texture = texture;\n\t\t\tthis.textureTransformId = textureTransformId;\n\n\t\t\tconst voffset = this.vertexOffset;\n\n\t\t\tbuffer.updateVertices();\n\t\t\tbuildTriangleRoundedVertex(\n\t\t\t\tbuffer.vertices,\n\t\t\t\tvoffset,\n\t\t\t\t0,\n\t\t\t\t0,\n\t\t\t\tsizeX,\n\t\t\t\tsizeY,\n\t\t\t\tstrokeAlign,\n\t\t\t\tstrokeWidth,\n\t\t\t\tradius,\n\t\t\t\tshape.transform.internalTransform,\n\t\t\t\tTRIANGLE_ROUNDED_WORLD_SIZE\n\t\t\t);\n\n\t\t\tif (isRadiusChanged || isCornerChanged) {\n\t\t\t\tbuffer.updateClippings();\n\t\t\t\tbuildTriangleRoundedClipping(buffer.clippings, voffset, corner, radius);\n\t\t\t}\n\n\t\t\tif (isVertexChanged || isTransformChanged || isCornerChanged) {\n\t\t\t\tbuffer.updateSteps();\n\t\t\t\tbuildTriangleRoundedStep(\n\t\t\t\t\tbuffer.steps,\n\t\t\t\t\tbuffer.clippings,\n\t\t\t\t\tvoffset,\n\t\t\t\t\tstrokeWidth,\n\t\t\t\t\tstrokeStyle,\n\t\t\t\t\tshape.radius,\n\t\t\t\t\tTRIANGLE_ROUNDED_WORLD_SIZE\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (isVertexChanged || isTextureChanged) {\n\t\t\t\tbuffer.updateUvs();\n\t\t\t\tbuildTriangleRoundedUv(\n\t\t\t\t\tbuffer.uvs,\n\t\t\t\t\tvoffset,\n\t\t\t\t\ttoTextureUvs(texture),\n\t\t\t\t\tradius,\n\t\t\t\t\tTRIANGLE_ROUNDED_WORLD_SIZE\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeBuffer } from \"../e-shape-buffer\";\nimport {\n\tbuildTriangleClipping,\n\tbuildTriangleIndex,\n\tbuildTriangleStep,\n\tbuildTriangleUv,\n\tbuildTriangleVertex,\n\tTRIANGLE_VERTEX_COUNT,\n\tTRIANGLE_WORLD_SIZE\n} from \"./build-triangle\";\nimport { BuilderBase } from \"./builder-base\";\nimport { toTexture, toTextureTransformId, toTextureUvs, toTransformLocalId } from \"./builders\";\n\nexport class BuilderTriangle extends BuilderBase {\n\tinit(buffer: EShapeBuffer): void {\n\t\tbuffer.updateClippings();\n\t\tbuffer.updateIndices();\n\t\tbuildTriangleClipping(buffer.clippings, this.vertexOffset);\n\t\tbuildTriangleIndex(buffer.indices, this.vertexOffset, this.indexOffset);\n\t}\n\n\tupdate(buffer: EShapeBuffer, shape: EShape): void {\n\t\tthis.updateVertexStepAndUv(buffer, shape);\n\t\tthis.updateColorFill(buffer, shape);\n\t\tthis.updateColorStroke(buffer, shape);\n\t}\n\n\tprotected updateVertexStepAndUv(buffer: EShapeBuffer, shape: EShape): void {\n\t\tconst size = shape.size;\n\t\tconst sizeX = size.x;\n\t\tconst sizeY = size.y;\n\t\tconst isSizeChanged = sizeX !== this.sizeX || sizeY !== this.sizeY;\n\n\t\tconst transformLocalId = toTransformLocalId(shape);\n\t\tconst isTransformChanged = this.transformLocalId !== transformLocalId;\n\n\t\tconst stroke = shape.stroke;\n\t\tconst strokeAlign = stroke.align;\n\t\tconst strokeWidth = stroke.enable ? stroke.width : 0;\n\t\tconst strokeStyle = stroke.style;\n\t\tconst isStrokeChanged =\n\t\t\tthis.strokeAlign !== strokeAlign ||\n\t\t\tthis.strokeWidth !== strokeWidth ||\n\t\t\tthis.strokeStyle !== strokeStyle;\n\n\t\tconst texture = toTexture(shape);\n\t\tconst textureTransformId = toTextureTransformId(texture);\n\t\tconst isTextureChanged =\n\t\t\ttexture !== this.texture || textureTransformId !== this.textureTransformId;\n\n\t\tconst isVertexChanged = isSizeChanged || isStrokeChanged;\n\n\t\tif (isVertexChanged || isTransformChanged || isTextureChanged) {\n\t\t\tthis.sizeX = sizeX;\n\t\t\tthis.sizeY = sizeY;\n\t\t\tthis.transformLocalId = transformLocalId;\n\t\t\tthis.strokeAlign = strokeAlign;\n\t\t\tthis.strokeWidth = strokeWidth;\n\t\t\tthis.strokeStyle = strokeStyle;\n\t\t\tthis.texture = texture;\n\t\t\tthis.textureTransformId = textureTransformId;\n\n\t\t\tconst voffset = this.vertexOffset;\n\n\t\t\tbuffer.updateVertices();\n\t\t\tbuildTriangleVertex(\n\t\t\t\tbuffer.vertices,\n\t\t\t\tvoffset,\n\t\t\t\t0,\n\t\t\t\t0,\n\t\t\t\tsizeX,\n\t\t\t\tsizeY,\n\t\t\t\tstrokeAlign,\n\t\t\t\tstrokeWidth,\n\t\t\t\tshape.transform.internalTransform,\n\t\t\t\tTRIANGLE_WORLD_SIZE\n\t\t\t);\n\n\t\t\tif (isVertexChanged || isTransformChanged) {\n\t\t\t\tbuffer.updateSteps();\n\t\t\t\tbuildTriangleStep(\n\t\t\t\t\tbuffer.steps,\n\t\t\t\t\tbuffer.clippings,\n\t\t\t\t\tvoffset,\n\t\t\t\t\tTRIANGLE_VERTEX_COUNT,\n\t\t\t\t\tstrokeWidth,\n\t\t\t\t\tstrokeStyle,\n\t\t\t\t\tTRIANGLE_WORLD_SIZE\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (isVertexChanged || isTextureChanged) {\n\t\t\t\tbuffer.updateUvs();\n\t\t\t\tbuildTriangleUv(buffer.uvs, toTextureUvs(texture), voffset, TRIANGLE_WORLD_SIZE);\n\t\t\t}\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DynamicSDFFontGenerator } from \"../../util/dynamic-sdf-font-generator\";\nimport { EShapeImageSdf } from \"./e-shape-image-sdf\";\nimport { toImageElement } from \"./to-image-element\";\n\nexport const createImageSdf = (dataUrl: string, convertToSdf: boolean): Promise<EShapeImageSdf> => {\n\tif (convertToSdf) {\n\t\treturn toImageElement(dataUrl).then(\n\t\t\t(imageElement: HTMLImageElement): Promise<EShapeImageSdf> => {\n\t\t\t\tconst generator = DynamicSDFFontGenerator.getInstance().init();\n\t\t\t\tgenerator.updateTexture(imageElement);\n\t\t\t\tgenerator.render();\n\n\t\t\t\tconst canvas = document.createElement(\"canvas\");\n\t\t\t\tgenerator.read(canvas);\n\n\t\t\t\treturn createImageSdf(canvas.toDataURL(), false);\n\t\t\t}\n\t\t);\n\t} else {\n\t\treturn toImageElement(dataUrl).then((imageElement: HTMLImageElement): EShapeImageSdf => {\n\t\t\treturn new EShapeImageSdf(imageElement);\n\t\t});\n\t}\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeBuffer } from \"../e-shape-buffer\";\nimport { EShapeUploaded, EShapeUploadedImpl } from \"../e-shape-uploaded\";\nimport { TEXT_INDEX_COUNT, TEXT_VERTEX_COUNT, toTextBufferCount } from \"./build-text\";\nimport {\n\tTRIANGLE_ROUNDED_INDEX_COUNT,\n\tTRIANGLE_ROUNDED_VERTEX_COUNT\n} from \"./build-triangle-rounded\";\nimport { BuilderText } from \"./builder-text\";\nimport { BuilderTriangleRounded } from \"./builder-triangle-rounded\";\n\nexport const createTriangleRoundedUploaded = (\n\tbuffer: EShapeBuffer,\n\tshape: EShape,\n\tvoffset: number,\n\tioffset: number,\n\tantialiasWeight: number\n): EShapeUploaded | null => {\n\tconst tcount = toTextBufferCount(shape);\n\tconst tvcount = tcount * TEXT_VERTEX_COUNT;\n\tconst ticount = tcount * TEXT_INDEX_COUNT;\n\tconst vcount = TRIANGLE_ROUNDED_VERTEX_COUNT + tvcount;\n\tconst icount = TRIANGLE_ROUNDED_INDEX_COUNT + ticount;\n\tif (buffer.check(voffset, ioffset, vcount, icount)) {\n\t\treturn new EShapeUploadedImpl(buffer, voffset, ioffset, vcount, icount, [\n\t\t\tnew BuilderTriangleRounded(voffset, ioffset, vcount - tvcount, icount - ticount),\n\t\t\tnew BuilderText(\n\t\t\t\tvoffset + TRIANGLE_ROUNDED_VERTEX_COUNT,\n\t\t\t\tioffset + TRIANGLE_ROUNDED_INDEX_COUNT,\n\t\t\t\ttvcount,\n\t\t\t\tticount\n\t\t\t)\n\t\t]).init(shape);\n\t}\n\treturn null;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"../e-shape\";\nimport { EShapeBuffer } from \"../e-shape-buffer\";\nimport { EShapeUploaded, EShapeUploadedImpl } from \"../e-shape-uploaded\";\nimport { TEXT_INDEX_COUNT, TEXT_VERTEX_COUNT, toTextBufferCount } from \"./build-text\";\nimport { TRIANGLE_INDEX_COUNT, TRIANGLE_VERTEX_COUNT } from \"./build-triangle\";\nimport { BuilderText } from \"./builder-text\";\nimport { BuilderTriangle } from \"./builder-triangle\";\n\nexport const createTriangleUploaded = (\n\tbuffer: EShapeBuffer,\n\tshape: EShape,\n\tvoffset: number,\n\tioffset: number,\n\tantialiasWeight: number\n): EShapeUploaded | null => {\n\tconst tcount = toTextBufferCount(shape);\n\tconst tvcount = tcount * TEXT_VERTEX_COUNT;\n\tconst ticount = tcount * TEXT_INDEX_COUNT;\n\tconst vcount = TRIANGLE_VERTEX_COUNT + tvcount;\n\tconst icount = TRIANGLE_INDEX_COUNT + ticount;\n\tif (buffer.check(voffset, ioffset, vcount, icount)) {\n\t\treturn new EShapeUploadedImpl(buffer, voffset, ioffset, vcount, icount, [\n\t\t\tnew BuilderTriangle(voffset, ioffset, vcount - tvcount, icount - ticount),\n\t\t\tnew BuilderText(\n\t\t\t\tvoffset + TRIANGLE_VERTEX_COUNT,\n\t\t\t\tioffset + TRIANGLE_INDEX_COUNT,\n\t\t\t\ttvcount,\n\t\t\t\tticount\n\t\t\t)\n\t\t]).init(shape);\n\t}\n\treturn null;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"./e-shape\";\nimport { EShapeUuidMapping } from \"./e-shape-uuid-mapping\";\n\nexport class EShapeUuidMappingImpl implements EShapeUuidMapping {\n\tprotected _shapes: EShape[];\n\tprotected _uuidToShape?: Map<number, EShape>;\n\n\tconstructor(shapes: EShape[]) {\n\t\tthis._shapes = shapes;\n\t}\n\n\tfind(uuid: number): EShape | undefined {\n\t\treturn this.getUuidToShape().get(uuid);\n\t}\n\n\tprotected getUuidToShape(): Map<number, EShape> {\n\t\tlet result = this._uuidToShape;\n\t\tif (result == null) {\n\t\t\tresult = this.newUuidToShape();\n\t\t\tthis._uuidToShape = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected newUuidToShape(): Map<number, EShape> {\n\t\tconst result = new Map<number, EShape>();\n\t\tthis.fillUuidToShape(this._shapes, result);\n\t\treturn result;\n\t}\n\n\tprotected fillUuidToShape(shapes: EShape[], result: Map<number, EShape>): void {\n\t\tfor (let i = 0, imax = shapes.length; i < imax; ++i) {\n\t\t\tconst shape = shapes[i];\n\t\t\tresult.set(shape.uuid, shape);\n\n\t\t\tconst children = shape.children;\n\t\t\tif (0 < children.length) {\n\t\t\t\tthis.fillUuidToShape(children, result);\n\t\t\t}\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\nimport { EShape } from \"../e-shape\";\nimport { EShapeOnDeserializeds } from \"../e-shape-deserializers\";\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeUuidMapping } from \"../e-shape-uuid-mapping\";\nimport { EShapeUuidMappingImpl } from \"../e-shape-uuid-mapping-impl\";\nimport { deserialize } from \"./deserialize\";\n\nexport const deserializeAll = (\n\tserializeds: DDiagramSerializedItem[],\n\tmanager: EShapeResourceManagerDeserialization\n): Promise<EShape[]> | null => {\n\tconst shapes: Array<Promise<EShape> | EShape> = [];\n\tfor (let i = 0, imax = serializeds.length; i < imax; ++i) {\n\t\tshapes.push(deserialize(serializeds[i], manager));\n\t}\n\tif (0 < shapes.length) {\n\t\treturn Promise.all(shapes).then((resolved: EShape[]): EShape[] => {\n\t\t\tcallOnDeserialized(serializeds, resolved, new EShapeUuidMappingImpl(resolved), manager);\n\t\t\treturn resolved;\n\t\t});\n\t}\n\treturn null;\n};\n\nconst callOnDeserialized = (\n\tserializeds: DDiagramSerializedItem[],\n\tshapes: EShape[],\n\tmapping: EShapeUuidMapping,\n\tmanager: EShapeResourceManagerDeserialization\n): void => {\n\tfor (let i = 0, imax = serializeds.length; i < imax; ++i) {\n\t\tconst serialized = serializeds[i];\n\t\tconst shape = shapes[i];\n\t\tconst onDeserialized = EShapeOnDeserializeds[serialized[0]];\n\t\tif (onDeserialized) {\n\t\t\tonDeserialized(serialized, shape, mapping, manager);\n\t\t}\n\t\tcallOnDeserialized(serialized[20], shape.children, mapping, manager);\n\t}\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { deserializeBase } from \"./deserialize-base\";\nimport { EShapeRectangleRounded } from \"./e-shape-rectangle-rounded\";\n\nexport const deserializeRectangleRounded = (\n\titem: DDiagramSerializedItem,\n\tmanager: EShapeResourceManagerDeserialization,\n\tshape?: EShapeRectangleRounded\n): Promise<EShapeRectangleRounded> | EShapeRectangleRounded => {\n\treturn deserializeBase(item, manager, shape || new EShapeRectangleRounded());\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { deserializeBase } from \"./deserialize-base\";\nimport { EShapeTriangleRounded } from \"./e-shape-triangle-rounded\";\n\nexport const deserializeTriangleRounded = (\n\titem: DDiagramSerializedItem,\n\tmanager: EShapeResourceManagerDeserialization,\n\tshape?: EShapeTriangleRounded\n): Promise<EShapeTriangleRounded> | EShapeTriangleRounded => {\n\treturn deserializeBase(item, manager, shape || new EShapeTriangleRounded());\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { deserializeBase } from \"./deserialize-base\";\nimport { EShapeTriangle } from \"./e-shape-triangle\";\n\nexport const deserializeTriangle = (\n\titem: DDiagramSerializedItem,\n\tmanager: EShapeResourceManagerDeserialization,\n\tshape?: EShapeTriangle\n): Promise<EShapeTriangle> | EShapeTriangle => {\n\treturn deserializeBase(item, manager, shape || new EShapeTriangle());\n};\n","import { EShapeLayerContainer } from \"../e-shape-layer-container\";\n\nexport class EShapeEmbeddedDatum {\n\tname: string;\n\twidth: number;\n\theight: number;\n\tlayer: EShapeLayerContainer;\n\n\tconstructor(name: string, width: number, height: number, layer: EShapeLayerContainer) {\n\t\tthis.name = name;\n\t\tthis.width = width;\n\t\tthis.height = height;\n\t\tthis.layer = layer;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"./e-shape\";\nimport { EShapeConnector } from \"./e-shape-connector\";\nimport { EShapeType } from \"./e-shape-type\";\n\nexport class EShapeConnectors {\n\tprotected static _MAPPING?: Map<EShape, EShape>;\n\n\tprotected static isConnector(target: EShape | null): target is EShapeConnector {\n\t\treturn target != null && target.type === EShapeType.CONNECTOR_LINE;\n\t}\n\n\tprotected static newMapping(\n\t\tsources: EShape[],\n\t\tdestinations: EShape[],\n\t\tresult?: Map<EShape, EShape>\n\t): Map<EShape, EShape> {\n\t\tif (result == null) {\n\t\t\tresult = EShapeConnectors._MAPPING ??= new Map<EShape, EShape>();\n\t\t\tresult.clear();\n\t\t}\n\t\tfor (let i = 0, imax = sources.length; i < imax; ++i) {\n\t\t\tconst fromChild = sources[i];\n\t\t\tconst toChild = destinations[i];\n\t\t\tresult.set(fromChild, toChild);\n\t\t\tthis.newMapping(fromChild.children, toChild.children, result);\n\t\t}\n\t\treturn result;\n\t}\n\n\tstatic moveAll(\n\t\trootSources: EShape[],\n\t\trootDestinations: EShape[],\n\t\tsources: EShape[],\n\t\tdestinations: EShape[],\n\t\tmapping?: Map<EShape, EShape>\n\t): Map<EShape, EShape> | undefined {\n\t\tfor (let i = 0, imax = sources.length; i < imax; ++i) {\n\t\t\tconst source = sources[i];\n\t\t\tconst destination = destinations[i];\n\t\t\tif (this.isConnector(source)) {\n\t\t\t\tif (this.isConnector(destination)) {\n\t\t\t\t\tconst sourceEdge = source.edge;\n\t\t\t\t\tconst destEdge = destination.edge;\n\t\t\t\t\tconst sourceHead = sourceEdge.head;\n\t\t\t\t\tconst sourceHeadShape = sourceHead.acceptor.shape;\n\t\t\t\t\tif (sourceHeadShape) {\n\t\t\t\t\t\tif (mapping == null) {\n\t\t\t\t\t\t\tmapping = this.newMapping(rootSources, rootDestinations);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst destHeadShape = mapping.get(sourceHeadShape);\n\t\t\t\t\t\tif (destHeadShape) {\n\t\t\t\t\t\t\tconst destHead = destEdge.head;\n\t\t\t\t\t\t\tdestHead.detach();\n\t\t\t\t\t\t\tdestHead.set(destHeadShape);\n\t\t\t\t\t\t\tdestHead.attach();\n\n\t\t\t\t\t\t\tdestHeadShape.connector.remove(sourceHead);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tconst sourceTail = sourceEdge.tail;\n\t\t\t\t\tconst sourceTailShape = sourceTail.acceptor.shape;\n\t\t\t\t\tif (sourceTailShape) {\n\t\t\t\t\t\tif (mapping == null) {\n\t\t\t\t\t\t\tmapping = this.newMapping(rootSources, rootDestinations);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst destTailShape = mapping.get(sourceTailShape);\n\t\t\t\t\t\tif (destTailShape) {\n\t\t\t\t\t\t\tconst destTail = destEdge.tail;\n\t\t\t\t\t\t\tdestTail.detach();\n\t\t\t\t\t\t\tdestTail.set(destTailShape);\n\t\t\t\t\t\t\tdestTail.attach();\n\n\t\t\t\t\t\t\tdestTailShape.connector.remove(sourceTail);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tmapping = this.moveAll(\n\t\t\t\trootSources,\n\t\t\t\trootDestinations,\n\t\t\t\tsource.children,\n\t\t\t\tdestination.children,\n\t\t\t\tmapping\n\t\t\t);\n\t\t}\n\t\treturn mapping;\n\t}\n\n\tstatic move(from: EShape, to: EShape): void {\n\t\tconst fromChildren = from.children;\n\t\tconst toChildren = to.children;\n\t\tthis.moveAll(fromChildren, toChildren, fromChildren, toChildren);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDiagramSerializedLayer } from \"../../d-diagram-serialized\";\nimport { EShape } from \"../e-shape\";\nimport { EShapeConnectors } from \"../e-shape-connectors\";\nimport { EShapeLayerContainer } from \"../e-shape-layer-container\";\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapeEmbeddedLayer } from \"./e-shape-embedded-layer\";\n\nexport class EShapeEmbeddedLayerContainer implements EShapeLayerContainer {\n\tchildren: EShapeEmbeddedLayer[];\n\tprotected _width: number;\n\tprotected _height: number;\n\tprotected _isEditMode: boolean;\n\tprotected _hasConnectors?: Map<EShapeEmbeddedLayer, boolean>;\n\n\tconstructor(width: number, height: number, isEditMode: boolean) {\n\t\tthis.children = [];\n\t\tthis._width = width;\n\t\tthis._height = height;\n\t\tthis._isEditMode = isEditMode;\n\t}\n\n\tprotected hasConnectors(shapes: EShape[]): boolean {\n\t\tfor (let i = 0, imax = shapes.length; i < imax; ++i) {\n\t\t\tconst shape = shapes[i];\n\t\t\tif (shape.type === EShapeType.CONNECTOR_LINE) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tconst children = shape.children;\n\t\t\tif (0 < children.length) {\n\t\t\t\tif (this.hasConnectors(children)) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tprotected newHasConnectors(): Map<EShapeEmbeddedLayer, boolean> {\n\t\tconst result = new Map<EShapeEmbeddedLayer, boolean>();\n\t\tconst layers = this.children;\n\t\tfor (let i = 0, imax = layers.length; i < imax; ++i) {\n\t\t\tconst layer = layers[i];\n\t\t\tresult.set(layer, this.hasConnectors(layer.children));\n\t\t}\n\t\treturn result;\n\t}\n\n\tcopyTo(destination: EShape): void {\n\t\tconst hasConnectors = (this._hasConnectors ??= this.newHasConnectors());\n\t\tconst layers = this.children;\n\t\tconst children = destination.children;\n\t\tfor (let i = 0, imax = layers.length; i < imax; ++i) {\n\t\t\tconst layer = layers[i];\n\t\t\tconst clone = layer.clone();\n\t\t\tclone.parent = destination;\n\t\t\tchildren.push(clone);\n\t\t\tif (hasConnectors.get(layer)) {\n\t\t\t\tEShapeConnectors.move(layer, clone);\n\t\t\t}\n\t\t}\n\t\tdestination.onChildTransformChange();\n\t\tdestination.toDirty();\n\t\tdestination.onAttach();\n\t}\n\n\tdeserialize(\n\t\tserializedLayers: DDiagramSerializedLayer[],\n\t\tmanager: EShapeResourceManagerDeserialization\n\t): void {\n\t\tconst serializedLayersLength = serializedLayers.length;\n\t\tif (0 < serializedLayersLength) {\n\t\t\tconst width = this._width;\n\t\t\tconst height = this._height;\n\t\t\tfor (let i = 0; i < serializedLayersLength; ++i) {\n\t\t\t\tthis.children.push(\n\t\t\t\t\tEShapeEmbeddedLayer.deserialize(serializedLayers[i], manager, width, height)\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {\n\tDDiagramSerializedFill,\n\tDDiagramSerializedStroke,\n\tDDiagramSerializedDataRange,\n\tDDiagramSerializedDataValue,\n\tDDiagramSerializedText,\n\tDDiagramSerializedTextOutline\n} from \"../d-diagram-serialized\";\nimport { EShapeActionValue } from \"./action/e-shape-action-value\";\nimport { EShapeTextAlignHorizontal } from \"./e-shape-text-align-horizontal\";\nimport { EShapeTextAlignVertical } from \"./e-shape-text-align-vertical\";\nimport { EShapeEmbeddedDatum } from \"./variant/e-shape-embedded-datum\";\n\nexport interface EShapeResourceManagerDeserializationSerialized {\n\tresources: string[];\n\ttags?: string[];\n\tdata?: string[];\n}\n\nexport class EShapeResourceManagerDeserialization {\n\tresources: string[];\n\tdata: string[];\n\tpieces?: string[];\n\tpieceData?: Map<string, EShapeEmbeddedDatum | null>;\n\tisEditMode: boolean;\n\n\tprotected _actions: Map<number, EShapeActionValue>;\n\tprotected _fills: Map<number, DDiagramSerializedFill>;\n\tprotected _strokes: Map<number, DDiagramSerializedStroke>;\n\tprotected _dataValues: Map<number, DDiagramSerializedDataValue>;\n\tprotected _data: Map<number, number[]>;\n\tprotected _ranges: Map<number, DDiagramSerializedDataRange>;\n\tprotected _aligns: Map<number, [EShapeTextAlignHorizontal, EShapeTextAlignVertical]>;\n\tprotected _margins: Map<number, [number, number]>;\n\tprotected _texts: Map<number, DDiagramSerializedText>;\n\tprotected _textOutlines: Map<number, DDiagramSerializedTextOutline>;\n\tprotected _extensions: Map<number, unknown>;\n\n\tconstructor(\n\t\tserialized: EShapeResourceManagerDeserializationSerialized,\n\t\tpieces: string[] | undefined,\n\t\tpieceData: Map<string, EShapeEmbeddedDatum | null> | undefined,\n\t\tisEditMode: boolean\n\t) {\n\t\tthis.resources = serialized.resources;\n\t\tthis.data = serialized.data || serialized.tags || serialized.resources;\n\t\tthis.pieces = pieces;\n\t\tthis.pieceData = pieceData;\n\t\tthis.isEditMode = isEditMode;\n\n\t\tthis._actions = new Map<number, EShapeActionValue>();\n\t\tthis._fills = new Map<number, DDiagramSerializedFill>();\n\t\tthis._strokes = new Map<number, DDiagramSerializedStroke>();\n\t\tthis._data = new Map<number, number[]>();\n\t\tthis._dataValues = new Map<number, DDiagramSerializedDataValue>();\n\t\tthis._ranges = new Map<number, DDiagramSerializedDataRange>();\n\t\tthis._aligns = new Map<number, [EShapeTextAlignHorizontal, EShapeTextAlignVertical]>();\n\t\tthis._margins = new Map<number, [number, number]>();\n\t\tthis._texts = new Map<number, DDiagramSerializedText>();\n\t\tthis._textOutlines = new Map<number, DDiagramSerializedTextOutline>();\n\t\tthis._extensions = new Map<number, unknown>();\n\t}\n\n\tgetAction(id: number): EShapeActionValue | undefined {\n\t\treturn this._actions.get(id);\n\t}\n\n\tsetAction(id: number, action: EShapeActionValue): void {\n\t\tthis._actions.set(id, action);\n\t}\n\n\tgetFill(id: number): DDiagramSerializedFill | undefined {\n\t\treturn this._fills.get(id);\n\t}\n\n\tsetFill(id: number, fill: DDiagramSerializedFill): void {\n\t\tthis._fills.set(id, fill);\n\t}\n\n\tgetStroke(id: number): DDiagramSerializedStroke | undefined {\n\t\treturn this._strokes.get(id);\n\t}\n\n\tsetStroke(id: number, stroke: DDiagramSerializedStroke): void {\n\t\tthis._strokes.set(id, stroke);\n\t}\n\n\tgetData(id: number): number[] | undefined {\n\t\treturn this._data.get(id);\n\t}\n\n\tsetData(id: number, data: number[]): void {\n\t\tthis._data.set(id, data);\n\t}\n\n\tgetDataValue(id: number): DDiagramSerializedDataValue | undefined {\n\t\treturn this._dataValues.get(id);\n\t}\n\n\tsetDataValue(id: number, dataValue: DDiagramSerializedDataValue): void {\n\t\tthis._dataValues.set(id, dataValue);\n\t}\n\n\tgetRange(id: number): DDiagramSerializedDataRange | undefined {\n\t\treturn this._ranges.get(id);\n\t}\n\n\tsetRange(id: number, range: DDiagramSerializedDataRange): void {\n\t\tthis._ranges.set(id, range);\n\t}\n\n\tgetAlign(id: number): [EShapeTextAlignHorizontal, EShapeTextAlignVertical] | undefined {\n\t\treturn this._aligns.get(id);\n\t}\n\n\tsetAlign(id: number, align: [EShapeTextAlignHorizontal, EShapeTextAlignVertical]): void {\n\t\tthis._aligns.set(id, align);\n\t}\n\n\tgetMargin(id: number): [number, number] | undefined {\n\t\treturn this._margins.get(id);\n\t}\n\n\tsetMargin(id: number, margin: [number, number]): void {\n\t\tthis._margins.set(id, margin);\n\t}\n\n\tgetText(id: number): DDiagramSerializedText | undefined {\n\t\treturn this._texts.get(id);\n\t}\n\n\tsetText(id: number, text: DDiagramSerializedText): void {\n\t\tthis._texts.set(id, text);\n\t}\n\n\tgetTextOutline(id: number): DDiagramSerializedTextOutline | undefined {\n\t\treturn this._textOutlines.get(id);\n\t}\n\n\tsetTextOutline(id: number, textOutline: DDiagramSerializedTextOutline): void {\n\t\tthis._textOutlines.set(id, textOutline);\n\t}\n\n\tgetExtension<T>(id: number): T | undefined {\n\t\treturn this._extensions.get(id) as T | undefined;\n\t}\n\n\tsetExtension(id: number, extension: unknown): void {\n\t\tthis._extensions.set(id, extension);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDiagramBaseController } from \"./d-diagram-base\";\nimport { DDiagramLayerContainer } from \"./d-diagram-layer-container\";\nimport {\n\tDDiagramSerialized,\n\tDDiagramSerializedSimple,\n\tDDiagramSerializedSimpleData\n} from \"./d-diagram-serialized\";\nimport { EShape } from \"./shape/e-shape\";\nimport { EShapeLayerContainer } from \"./shape/e-shape-layer-container\";\nimport { EShapeResourceManagerDeserialization } from \"./shape/e-shape-resource-manager-deserialization\";\nimport { deserializeAll } from \"./shape/variant/deserialize-all\";\nimport { EShapeEmbeddedDatum } from \"./shape/variant/e-shape-embedded-datum\";\nimport { EShapeEmbeddedLayerContainer } from \"./shape/variant/e-shape-embedded-layer-container\";\n\nexport class DDiagrams {\n\tstatic toSimple(serialized: DDiagramSerialized): DDiagramSerializedSimple {\n\t\treturn {\n\t\t\tversion: serialized.version,\n\t\t\tid: serialized.id,\n\t\t\tname: serialized.name,\n\t\t\tthumbnail: serialized.thumbnail,\n\t\t\tdata: JSON.stringify({\n\t\t\t\twidth: serialized.width,\n\t\t\t\theight: serialized.height,\n\t\t\t\tbackground: serialized.background,\n\t\t\t\ttile: serialized.tile,\n\t\t\t\tresources: serialized.resources,\n\t\t\t\tdata: serialized.data || serialized.tags,\n\t\t\t\tpieces: serialized.pieces,\n\t\t\t\tlayers: serialized.layers,\n\t\t\t\titems: serialized.items,\n\t\t\t\tsnap: serialized.snap\n\t\t\t})\n\t\t};\n\t}\n\n\tstatic toSerialized(target: DDiagramSerializedSimple | DDiagramSerialized): DDiagramSerialized {\n\t\tif (!(\"items\" in target)) {\n\t\t\tconst data: DDiagramSerializedSimpleData = JSON.parse(target.data);\n\t\t\tconst result: DDiagramSerialized = {\n\t\t\t\tversion: target.version,\n\t\t\t\tid: target.id,\n\t\t\t\tname: target.name,\n\t\t\t\twidth: data.width,\n\t\t\t\theight: data.height,\n\t\t\t\tbackground: data.background,\n\t\t\t\ttile: data.tile,\n\t\t\t\tresources: data.resources,\n\t\t\t\tdata: data.data || data.tags,\n\t\t\t\tpieces: data.pieces,\n\t\t\t\tlayers: data.layers,\n\t\t\t\titems: data.items,\n\t\t\t\tsnap: data.snap,\n\t\t\t\tthumbnail: target.thumbnail\n\t\t\t};\n\t\t\tif (result.data == null) {\n\t\t\t\tconst tags = target.tags;\n\t\t\t\tif (tags != null) {\n\t\t\t\t\tresult.data = JSON.parse(tags);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (result.pieces == null) {\n\t\t\t\tconst pieces = target.pieces;\n\t\t\t\tif (pieces != null) {\n\t\t\t\t\tresult.pieces = JSON.parse(pieces);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn result;\n\t\t}\n\t\treturn target;\n\t}\n\n\tstatic newLayer(\n\t\tserialized: DDiagramSerialized,\n\t\tcontainer: DDiagramLayerContainer | EShapeLayerContainer,\n\t\tmanager: EShapeResourceManagerDeserialization\n\t): Promise<EShape[]> {\n\t\t// Layers\n\t\tcontainer.deserialize(serialized.layers, manager);\n\n\t\t// Items\n\t\tconst serializedItems = serialized.items;\n\t\tconst shapePromises = deserializeAll(serializedItems, manager);\n\t\tif (shapePromises != null) {\n\t\t\treturn shapePromises.then((shapes: EShape[]): EShape[] => {\n\t\t\t\tconst layers = container.children;\n\t\t\t\tfor (let i = 0, imax = shapes.length; i < imax; ++i) {\n\t\t\t\t\tconst serializedItem = serializedItems[i];\n\t\t\t\t\tconst shape = shapes[i];\n\t\t\t\t\tconst layer = layers[serializedItem[16]];\n\t\t\t\t\tif (layer != null) {\n\t\t\t\t\t\tshape.parent = layer;\n\t\t\t\t\t\tshape.uploaded = undefined;\n\t\t\t\t\t\tlayer.children.push(shape);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor (let i = 0, imax = layers.length; i < imax; ++i) {\n\t\t\t\t\tconst layer = layers[i];\n\t\t\t\t\tlayer.onChildTransformChange();\n\t\t\t\t\tlayer.toDirty();\n\t\t\t\t\tconst children = layer.children;\n\t\t\t\t\tfor (let j = 0, jmax = children.length; j < jmax; ++j) {\n\t\t\t\t\t\tchildren[j].onAttach();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn shapes;\n\t\t\t});\n\t\t} else {\n\t\t\treturn Promise.resolve([]);\n\t\t}\n\t}\n\n\tstatic toPieceData(\n\t\tcontroller: DDiagramBaseController | null | undefined,\n\t\tpieces: string[] | null | undefined,\n\t\tisEditMode: boolean\n\t): Promise<Map<string, EShapeEmbeddedDatum | null>> {\n\t\tconst result = new Map<string, EShapeEmbeddedDatum | null>();\n\t\tconst onFulfilled = () => {\n\t\t\treturn result;\n\t\t};\n\t\treturn this.toPieceData_(controller, pieces, result, isEditMode).then(\n\t\t\tonFulfilled,\n\t\t\tonFulfilled\n\t\t);\n\t}\n\n\tprivate static toPieceData_(\n\t\tcontroller: DDiagramBaseController | null | undefined,\n\t\tpieces: string[] | null | undefined,\n\t\tpieceData: Map<string, EShapeEmbeddedDatum | null>,\n\t\tisEditMode: boolean\n\t): Promise<Array<EShape[] | null>> {\n\t\tconst promises: Array<Promise<EShape[] | null>> = [];\n\t\tif (pieces && 0 < pieces.length && controller) {\n\t\t\tfor (let i = 0, imax = pieces.length; i < imax; ++i) {\n\t\t\t\tconst piece = pieces[i];\n\t\t\t\tif (!pieceData.has(piece)) {\n\t\t\t\t\tpieceData.set(piece, null);\n\t\t\t\t\tpromises.push(\n\t\t\t\t\t\tcontroller.piece.getByName(piece).then(\n\t\t\t\t\t\t\t(found) => {\n\t\t\t\t\t\t\t\treturn this.toPieceData__(\n\t\t\t\t\t\t\t\t\tcontroller,\n\t\t\t\t\t\t\t\t\tpiece,\n\t\t\t\t\t\t\t\t\tfound,\n\t\t\t\t\t\t\t\t\tisEditMode,\n\t\t\t\t\t\t\t\t\tpieceData\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t)\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn Promise.all(promises);\n\t}\n\n\tprivate static toPieceData__(\n\t\tcontroller: DDiagramBaseController,\n\t\tname: string,\n\t\tserializedOrSimple: DDiagramSerialized | DDiagramSerializedSimple,\n\t\tisEditMode: boolean,\n\t\tpieceData: Map<string, EShapeEmbeddedDatum | null>\n\t): Promise<EShape[]> {\n\t\tconst serialized = this.toSerialized(serializedOrSimple);\n\t\tconst width = serialized.width;\n\t\tconst height = serialized.height;\n\t\tconst container = new EShapeEmbeddedLayerContainer(width, height, isEditMode);\n\n\t\tpieceData.set(name, new EShapeEmbeddedDatum(name, width, height, container));\n\n\t\tconst pieces = serialized.pieces;\n\t\treturn this.toPieceData_(controller, pieces, pieceData, isEditMode).then(() => {\n\t\t\treturn this.newLayer(\n\t\t\t\tserialized,\n\t\t\t\tcontainer,\n\t\t\t\tnew EShapeResourceManagerDeserialization(serialized, pieces, pieceData, isEditMode)\n\t\t\t);\n\t\t});\n\t}\n}\n","import { DDiagramBaseController } from \"../../d-diagram-base\";\nimport { DDiagramSerialized, DDiagramSerializedSimple } from \"../../d-diagram-serialized\";\nimport { DDiagrams } from \"../../d-diagrams\";\nimport { EShapeLayerContainer } from \"../e-shape-layer-container\";\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { EShapeEmbedded } from \"./e-shape-embedded\";\nimport { EShapeEmbeddedDatum } from \"./e-shape-embedded-datum\";\nimport { EShapeEmbeddedLayerContainer } from \"./e-shape-embedded-layer-container\";\n\nexport class EShapeEmbeddeds {\n\tstatic from(\n\t\tserializedOrSimple: DDiagramSerialized | DDiagramSerializedSimple,\n\t\tcontroller: DDiagramBaseController | null | undefined,\n\t\tisEditMode: boolean\n\t): Promise<EShapeEmbedded> {\n\t\tconst serialized = DDiagrams.toSerialized(serializedOrSimple);\n\t\tconst pieces = serialized.pieces;\n\t\treturn DDiagrams.toPieceData(controller, pieces, isEditMode).then((pieceData) => {\n\t\t\treturn this.from_(serialized, isEditMode, pieces, pieceData);\n\t\t});\n\t}\n\n\tprivate static from_(\n\t\tserialized: DDiagramSerialized,\n\t\tisEditMode: boolean,\n\t\tpieces?: string[],\n\t\tpieceData?: Map<string, EShapeEmbeddedDatum | null>\n\t): Promise<EShapeEmbedded> {\n\t\tconst width = serialized.width;\n\t\tconst height = serialized.height;\n\t\tconst container = new EShapeEmbeddedLayerContainer(width, height, isEditMode);\n\t\tconst manager = new EShapeResourceManagerDeserialization(\n\t\t\tserialized,\n\t\t\tpieces,\n\t\t\tpieceData,\n\t\t\tisEditMode\n\t\t);\n\t\treturn DDiagrams.newLayer(serialized, container, manager).then(() => {\n\t\t\treturn this.create(serialized.name, width, height, container, manager);\n\t\t});\n\t}\n\n\tstatic create(\n\t\tname: string,\n\t\twidth: number,\n\t\theight: number,\n\t\tcontainer: EShapeLayerContainer,\n\t\tmanager: EShapeResourceManagerDeserialization\n\t): EShapeEmbedded {\n\t\tconst shape = new EShapeEmbedded(name, manager.isEditMode);\n\t\tshape.size.set(width, height);\n\t\tcontainer.copyTo(shape);\n\t\tshape.size.init();\n\t\treturn shape;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapeBaseHitTestData } from \"./e-shape-base-hit-test-data\";\nimport { EShapeRectangle } from \"./e-shape-rectangle\";\n\nexport class EShapeRectanglePivoted extends EShapeRectangle {\n\tconstructor(type: EShapeType = EShapeType.RECTANGLE_PIVOTED) {\n\t\tsuper(type);\n\t}\n\n\ttoHitTestData(x: number, y: number): EShapeBaseHitTestData {\n\t\tconst result = super.toHitTestData(x, y);\n\t\tresult.x -= result.width;\n\t\tresult.y -= result.height;\n\t\treturn result;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const toSvgUrl = (svg: string): string => {\n\treturn `data:image/svg+xml;base64,${btoa(svg)}`;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const toSizeRounded = (value: number): number => {\n\treturn Math.round(value * 100) / 100;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\nimport { deserializeBase } from \"./deserialize-base\";\nimport { EShapeRectanglePivoted } from \"./e-shape-rectangle-pivoted\";\n\nexport const deserializeRectanglePivoted = (\n\titem: DDiagramSerializedItem,\n\tmanager: EShapeResourceManagerDeserialization,\n\tshape?: EShapeRectanglePivoted\n): Promise<EShapeRectanglePivoted> | EShapeRectanglePivoted => {\n\treturn deserializeBase(item, manager, shape || new EShapeRectanglePivoted());\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeCapabilities } from \"../e-shape-capabilities\";\nimport { EShapeCapability } from \"../e-shape-capability\";\nimport { EShapeDeserializers } from \"../e-shape-deserializers\";\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapeUploadeds } from \"../e-shape-uploadeds\";\nimport { createRectangleRoundedUploaded } from \"../variant/create-rectangle-rounded-uploaded\";\nimport { deserializeRectangleRounded } from \"../variant/deserialize-rectangle-rounded\";\n\nexport const loadShapeRectangleRounded = (): void => {\n\tEShapeUploadeds[EShapeType.RECTANGLE_ROUNDED] = createRectangleRoundedUploaded;\n\tEShapeDeserializers[EShapeType.RECTANGLE_ROUNDED] = deserializeRectangleRounded;\n\tEShapeCapabilities.set(\n\t\tEShapeType.RECTANGLE_ROUNDED,\n\t\tEShapeCapability.PRIMITIVE | EShapeCapability.STROKE_SIDE | EShapeCapability.BORDER_RADIUS\n\t);\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeDeserializers } from \"../e-shape-deserializers\";\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapeUploadeds } from \"../e-shape-uploadeds\";\nimport { createTriangleUploaded } from \"../variant/create-triangle-uploaded\";\nimport { deserializeTriangle } from \"../variant/deserialize-triangle\";\n\nexport const loadShapeTriangle = (): void => {\n\tEShapeUploadeds[EShapeType.TRIANGLE] = createTriangleUploaded;\n\tEShapeDeserializers[EShapeType.TRIANGLE] = deserializeTriangle;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeCapabilities } from \"../e-shape-capabilities\";\nimport { EShapeCapability } from \"../e-shape-capability\";\nimport { EShapeDeserializers } from \"../e-shape-deserializers\";\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapeUploadeds } from \"../e-shape-uploadeds\";\nimport { createTriangleRoundedUploaded } from \"../variant/create-triangle-rounded-uploaded\";\nimport { deserializeTriangleRounded } from \"../variant/deserialize-triangle-rounded\";\n\nexport const loadShapeTriangleRounded = (): void => {\n\tEShapeUploadeds[EShapeType.TRIANGLE_ROUNDED] = createTriangleRoundedUploaded;\n\tEShapeDeserializers[EShapeType.TRIANGLE_ROUNDED] = deserializeTriangleRounded;\n\tEShapeCapabilities.set(\n\t\tEShapeType.TRIANGLE_ROUNDED,\n\t\tEShapeCapability.PRIMITIVE | EShapeCapability.STROKE_SIDE | EShapeCapability.BORDER_RADIUS\n\t);\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { loadShapeBar } from \"./load-shape-bar\";\nimport { loadShapeButton } from \"./load-shape-button\";\nimport { loadShapeCircle } from \"./load-shape-circle\";\nimport { loadShapeConnectorLine } from \"./load-shape-connector-line\";\nimport { loadShapeEmbedded } from \"./load-shape-embedded\";\nimport { loadShapeGroup } from \"./load-shape-group\";\nimport { loadShapeGroupShadowed } from \"./load-shape-group-shadowed\";\nimport { loadShapeImage } from \"./load-shape-image\";\nimport { loadShapeImageSdf } from \"./load-shape-image-sdf\";\nimport { loadShapeLabel } from \"./load-shape-label\";\nimport { loadShapeLine } from \"./load-shape-line\";\nimport { loadShapeLineOfCircles } from \"./load-shape-line-of-circles\";\nimport { loadShapeLineOfRectangleRoundeds } from \"./load-shape-line-of-rectangle-roundeds\";\nimport { loadShapeLineOfRectangles } from \"./load-shape-line-of-rectangles\";\nimport { loadShapeLineOfTriangleRoundeds } from \"./load-shape-line-of-triangle-roundeds\";\nimport { loadShapeLineOfTriangles } from \"./load-shape-line-of-triangles\";\nimport { loadShapeNull } from \"./load-shape-null\";\nimport { loadShapeRectangle } from \"./load-shape-rectangle\";\nimport { loadShapeRectanglePivoted } from \"./load-shape-rectangle-pivoted\";\nimport { loadShapeRectangleRounded } from \"./load-shape-rectangle-rounded\";\nimport { loadShapeTriangle } from \"./load-shape-triangle\";\nimport { loadShapeTriangleRounded } from \"./load-shape-triangle-rounded\";\n\nexport const loadShapeAll = (): void => {\n\tloadShapeBar();\n\tloadShapeButton();\n\tloadShapeCircle();\n\tloadShapeConnectorLine();\n\tloadShapeEmbedded();\n\tloadShapeGroupShadowed();\n\tloadShapeGroup();\n\tloadShapeImage();\n\tloadShapeImageSdf();\n\tloadShapeLabel();\n\tloadShapeLine();\n\tloadShapeNull();\n\tloadShapeRectanglePivoted();\n\tloadShapeRectangleRounded();\n\tloadShapeRectangle();\n\tloadShapeTriangleRounded();\n\tloadShapeTriangle();\n\tloadShapeLineOfCircles();\n\tloadShapeLineOfRectangleRoundeds();\n\tloadShapeLineOfRectangles();\n\tloadShapeLineOfTriangleRoundeds();\n\tloadShapeLineOfTriangles();\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeDeserializers } from \"../e-shape-deserializers\";\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapeUploadeds } from \"../e-shape-uploadeds\";\nimport { createImageSdfUploaded } from \"../variant/create-image-sdf-uploaded\";\nimport { deserializeImageSdf } from \"../variant/deserialize-image-sdf\";\n\nexport const loadShapeImageSdf = (): void => {\n\tEShapeUploadeds[EShapeType.IMAGE_SDF] = createImageSdfUploaded;\n\tEShapeDeserializers[EShapeType.IMAGE_SDF] = deserializeImageSdf;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeCapabilities } from \"../e-shape-capabilities\";\nimport { EShapeCapability } from \"../e-shape-capability\";\nimport { EShapeDeserializers } from \"../e-shape-deserializers\";\nimport { EShapeType } from \"../e-shape-type\";\nimport { EShapeUploadeds } from \"../e-shape-uploadeds\";\nimport { createRectanglePivotedUploaded } from \"../variant\";\nimport { deserializeRectanglePivoted } from \"../variant/deserialize-rectangle-pivoted\";\n\nexport const loadShapeRectanglePivoted = (): void => {\n\tEShapeUploadeds[EShapeType.RECTANGLE_PIVOTED] = createRectanglePivotedUploaded;\n\tEShapeDeserializers[EShapeType.RECTANGLE_PIVOTED] = deserializeRectanglePivoted;\n\tEShapeCapabilities.set(\n\t\tEShapeType.RECTANGLE_PIVOTED,\n\t\tEShapeCapability.PRIMITIVE | EShapeCapability.STROKE_SIDE\n\t);\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DImageBase, DImageBaseOptions, DThemeImageBase } from \"./d-image-base\";\n\nexport interface DImageOptions<\n\tVALUE = unknown,\n\tTHEME extends DThemeImage<VALUE> = DThemeImage<VALUE>\n> extends DImageBaseOptions<VALUE, THEME> {}\n\nexport interface DThemeImage<VALUE = unknown> extends DThemeImageBase<VALUE> {}\n\nexport class DImage<\n\tVALUE = unknown,\n\tTHEME extends DThemeImage<VALUE> = DThemeImage<VALUE>,\n\tOPTIONS extends DImageOptions<VALUE, THEME> = DImageOptions<VALUE, THEME>\n> extends DImageBase<VALUE, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DImage\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction } from \"pixi.js\";\nimport { DImage, DImageOptions, DThemeImage } from \"./d-image\";\nimport { DMenuItemBaseSelection } from \"./d-menu-item-base-selection\";\nimport { UtilKeyboardEvent } from \"./util/util-keyboard-event\";\nimport { UtilPointerEvent } from \"./util/util-pointer-event\";\n\nexport interface DMenuItemBaseOptions<\n\tVALUE = unknown,\n\tTHEME extends DThemeMenuItemBase = DThemeMenuItemBase\n> extends DImageOptions<string, THEME> {\n\tvalue?: VALUE;\n}\n\nexport interface DThemeMenuItemBase extends DThemeImage<string> {}\n\nexport class DMenuItemBase<\n\tVALUE = unknown,\n\tTHEME extends DThemeMenuItemBase = DThemeMenuItemBase,\n\tOPTIONS extends DMenuItemBaseOptions<VALUE, THEME> = DMenuItemBaseOptions<VALUE, THEME>\n> extends DImage<string, THEME, OPTIONS> {\n\tprotected _value: VALUE | null;\n\n\tconstructor(options?: OPTIONS) {\n\t\tsuper(options);\n\t\tthis._value = options?.value ?? null;\n\t}\n\n\tprotected init(options?: OPTIONS): void {\n\t\tsuper.init(options);\n\t\tthis.initOnClick(options);\n\t}\n\n\tprotected initOnClick(options?: OPTIONS): void {\n\t\tUtilPointerEvent.onClick(this, (e: interaction.InteractionEvent): void => {\n\t\t\tif (this.state.isActionable) {\n\t\t\t\tthis.onSelect(e);\n\t\t\t}\n\t\t});\n\t}\n\n\tget value(): VALUE | null {\n\t\treturn this._value;\n\t}\n\n\tset value(value: VALUE | null) {\n\t\tthis._value = value;\n\t}\n\n\tprotected hasSelection(target: any): target is { selection: DMenuItemBaseSelection } {\n\t\treturn target && target.selection && target.selection.add;\n\t}\n\n\tprotected getSelection(): DMenuItemBaseSelection | null {\n\t\tlet parent = this.parent as any;\n\t\twhile (parent) {\n\t\t\tif (this.hasSelection(parent)) {\n\t\t\t\treturn parent.selection;\n\t\t\t}\n\t\t\tparent = parent.parent;\n\t\t}\n\t\treturn null;\n\t}\n\n\tprotected onSelect(e: KeyboardEvent | interaction.InteractionEvent): void {\n\t\tthis.emit(\"select\", this);\n\t\tconst selection = this.getSelection();\n\t\tif (selection) {\n\t\t\tselection.add(this);\n\t\t}\n\t}\n\n\tonKeyDown(e: KeyboardEvent): boolean {\n\t\tif (UtilKeyboardEvent.isActivateKey(e)) {\n\t\t\tthis.onKeyDownActivate(e);\n\t\t}\n\t\treturn super.onKeyDown(e);\n\t}\n\n\tprotected onKeyDownActivate(e: KeyboardEvent): boolean {\n\t\tif (this.state.isActionable && this.state.isFocused) {\n\t\t\tthis.onSelect(e);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DMenuItemBase\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Closeable, DMenuContext } from \"./d-menu-context\";\nimport { DMenuItemBase, DMenuItemBaseOptions, DThemeMenuItemBase } from \"./d-menu-item-base\";\n\nexport interface DMenuItemOptions<VALUE = unknown, THEME extends DThemeMenuItem = DThemeMenuItem>\n\textends DMenuItemBaseOptions<VALUE, THEME> {}\n\nexport interface DThemeMenuItem extends DThemeMenuItemBase {}\n\nexport class DMenuItem<\n\tVALUE = unknown,\n\tTHEME extends DThemeMenuItem = DThemeMenuItem,\n\tOPTIONS extends DMenuItemOptions<VALUE, THEME> = DMenuItemOptions<VALUE, THEME>\n> extends DMenuItemBase<VALUE, THEME, OPTIONS> {\n\tgetContext(): DMenuContext | null {\n\t\tlet parent = this.parent as any;\n\t\twhile (parent) {\n\t\t\tif (parent.getContext) {\n\t\t\t\treturn parent.getContext();\n\t\t\t}\n\t\t\tparent = parent.parent;\n\t\t}\n\t\treturn null;\n\t}\n\n\tgetCloseable(): Closeable | null {\n\t\tlet parent = this.parent as any;\n\t\twhile (parent) {\n\t\t\tif (parent.getCloseable) {\n\t\t\t\treturn parent.getCloseable();\n\t\t\t}\n\t\t\tparent = parent.parent;\n\t\t}\n\t\treturn null;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DMenuItem\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction } from \"pixi.js\";\nimport { DBase } from \"./d-base\";\nimport { DBaseStateSet } from \"./d-base-state-set\";\nimport { DDynamicText } from \"./d-dynamic-text\";\nimport { DMenuItem, DMenuItemOptions, DThemeMenuItem } from \"./d-menu-item\";\nimport { UtilKeyboardEvent } from \"./util/util-keyboard-event\";\nimport { UtilPointerEvent } from \"./util/util-pointer-event\";\n\nexport interface DMenuItemTextOptions<\n\tVALUE = unknown,\n\tTHEME extends DThemeMenuItemText = DThemeMenuItemText\n> extends DMenuItemOptions<VALUE, THEME> {}\n\nexport interface DThemeMenuItemText extends DThemeMenuItem {\n\tgetShortcutTextMargin(): number;\n\tgetShortcutColor(state: DBaseStateSet): number;\n\tgetShortcutAlpha(state: DBaseStateSet): number;\n}\n\nexport class DMenuItemText<\n\tVALUE = unknown,\n\tTHEME extends DThemeMenuItemText = DThemeMenuItemText,\n\tOPTIONS extends DMenuItemTextOptions<VALUE, THEME> = DMenuItemTextOptions<VALUE, THEME>\n> extends DMenuItem<VALUE, THEME, OPTIONS> {\n\tprotected _shortcutText?: DDynamicText | null;\n\tprotected _shortcutMargin?: number;\n\n\tprotected init(options?: OPTIONS): void {\n\t\tsuper.init(options);\n\t\tthis.initOnOver(options);\n\t\tthis.initShortcuts(options);\n\t}\n\n\tprotected initOnOver(options?: OPTIONS): void {\n\t\tthis.on(UtilPointerEvent.over, (): void => {\n\t\t\tconst context = this.getContext();\n\t\t\tif (context != null) {\n\t\t\t\tconst parent = this.parent;\n\t\t\t\tif (parent instanceof DBase) {\n\t\t\t\t\tcontext.trim(this.getCloseable());\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tprotected initShortcuts(options?: OPTIONS): void {\n\t\tconst shortcuts = this._shortcuts;\n\t\tif (shortcuts != null && 0 < shortcuts.length) {\n\t\t\tconst shortcut = shortcuts[0];\n\t\t\tconst shortcutTextValue = UtilKeyboardEvent.toString(shortcut);\n\t\t\tthis._shortcutText = this.createText(shortcutTextValue);\n\t\t\tthis.snippet.add(this._shortcutText, true);\n\t\t} else {\n\t\t\tthis._shortcutText = null;\n\t\t}\n\n\t\tthis._shortcutMargin = this.theme.getShortcutTextMargin();\n\t}\n\n\tprotected updateShortcutText(): void {\n\t\tconst text = this._shortcutText;\n\t\tconst margin = this._shortcutMargin;\n\t\tif (text != null && margin != null) {\n\t\t\tconst toRounded = this.toRounded;\n\t\t\ttext.position.set(\n\t\t\t\ttoRounded(this.width - margin - text.width),\n\t\t\t\ttoRounded((this.height - text.height) * 0.5)\n\t\t\t);\n\t\t}\n\t}\n\n\tprotected updateTextColor(text: DDynamicText): void {\n\t\tsuper.updateTextColor(text);\n\n\t\tconst shortcutText = this._shortcutText;\n\t\tif (shortcutText != null) {\n\t\t\tconst theme = this.theme;\n\t\t\tconst state = this.state;\n\t\t\tshortcutText.style.fill = theme.getShortcutColor(state);\n\t\t\tshortcutText.alpha = theme.getShortcutAlpha(state);\n\t\t}\n\t}\n\n\tprotected updateText(): void {\n\t\tsuper.updateText();\n\t\tthis.updateShortcutText();\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DMenuItemText\";\n\t}\n\n\tprotected onSelect(e: KeyboardEvent | interaction.InteractionEvent): void {\n\t\tsuper.onSelect(e);\n\t\tconst closeable = this.getCloseable();\n\t\tif (closeable != null) {\n\t\t\tcloseable.emit(\"select\", this.value, this, closeable);\n\t\t}\n\t}\n\n\tprotected onShortcut(e: KeyboardEvent): void {\n\t\tsuper.onShortcut(e);\n\t\tthis.onSelect(e);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction } from \"pixi.js\";\nimport { DMenuItemText, DMenuItemTextOptions, DThemeMenuItemText } from \"./d-menu-item-text\";\n\nexport interface DMenuItemCheckOptions<\n\tVALUE = unknown,\n\tTHEME extends DThemeMenuItemCheck = DThemeMenuItemCheck\n> extends DMenuItemTextOptions<VALUE, THEME> {\n\tcheck: boolean;\n}\n\nexport interface DThemeMenuItemCheck extends DThemeMenuItemText {}\n\nexport class DMenuItemCheck<\n\tVALUE = unknown,\n\tTHEME extends DThemeMenuItemCheck = DThemeMenuItemCheck,\n\tOPTIONS extends DMenuItemCheckOptions<VALUE, THEME> = DMenuItemCheckOptions<VALUE, THEME>\n> extends DMenuItemText<VALUE, THEME, OPTIONS> {\n\tprotected init(options?: OPTIONS): void {\n\t\tsuper.init(options);\n\t\tif (options?.check) {\n\t\t\tthis.state.isActive = true;\n\t\t}\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DMenuItemCheck\";\n\t}\n\n\tprotected onSelect(e: KeyboardEvent | interaction.InteractionEvent): void {\n\t\tthis.state.isActive = !this.state.isActive;\n\t\tsuper.onSelect(e);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DMenuItemCheckOptions } from \"./d-menu-item-check\";\nimport { DMenuItemOptionsUnion } from \"./d-menu-item-options-union\";\n\nexport const DMenuItemCheckIsCompatible = <VALUE>(\n\toptions: DMenuItemOptionsUnion<VALUE>\n): options is DMenuItemCheckOptions<VALUE> => {\n\treturn \"check\" in options;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const DLinkMenuItemId = {\n\tOPEN_LINK: 0,\n\tOPEN_LINK_IN_NEW_WINDOW: 1,\n\tCOPY_LINK_ADDRESS: 2\n} as const;\n\nexport type DLinkMenuItemId = typeof DLinkMenuItemId[keyof typeof DLinkMenuItemId];\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Container, DisplayObject } from \"pixi.js\";\nimport { DMenu, DMenuOptions } from \"./d-menu\";\nimport { DMenuItemOptionsUnion } from \"./d-menu-item-options-union\";\n\nexport type DMenuItemCreator = (\n\toptions: DMenuItemOptionsUnion<any>,\n\tsticky: boolean\n) => DisplayObject | null;\n\nexport type DMenuMenuCreator = (options?: DMenuOptions) => DMenu<any>;\n\nexport class DMenus {\n\tprotected static CREATORS: DMenuItemCreator[] = [];\n\tprotected static CREATOR_DEFAULT: DMenuItemCreator | null = null;\n\tprotected static MENU_CREATOR?: DMenuMenuCreator;\n\n\tstatic addItemCreator(creator: DMenuItemCreator): void {\n\t\tthis.CREATORS.push(creator);\n\t}\n\n\tstatic setItemCreatorDefault(creator: DMenuItemCreator): void {\n\t\tthis.CREATOR_DEFAULT = creator;\n\t}\n\n\tstatic setMenuCreator(creator: DMenuMenuCreator): void {\n\t\tthis.MENU_CREATOR = creator;\n\t}\n\n\tstatic newItemOf<VALUE>(\n\t\tcreators: DMenuItemCreator[],\n\t\tcreatorDefault: DMenuItemCreator | null,\n\t\toptions: DMenuItemOptionsUnion<VALUE>,\n\t\tsticky: boolean\n\t): DisplayObject | null {\n\t\tfor (let i = 0, imax = creators.length; i < imax; ++i) {\n\t\t\tconst created = creators[i](options, sticky);\n\t\t\tif (created != null) {\n\t\t\t\treturn created;\n\t\t\t}\n\t\t}\n\t\tif (creatorDefault) {\n\t\t\treturn creatorDefault(options, sticky);\n\t\t}\n\t\treturn null;\n\t}\n\n\tstatic newItem<VALUE>(\n\t\toptions: DMenuItemOptionsUnion<VALUE>,\n\t\tsticky: boolean\n\t): DisplayObject | null {\n\t\treturn this.newItemOf(this.CREATORS, this.CREATOR_DEFAULT, options, sticky);\n\t}\n\n\tstatic newItemsOf<VALUE>(\n\t\tcreator: {\n\t\t\tnewItem(options: DMenuItemOptionsUnion<VALUE>, sticky: boolean): DisplayObject | null;\n\t\t},\n\t\tparent: Container,\n\t\titems: Array<DMenuItemOptionsUnion<VALUE> | DisplayObject | null | undefined>,\n\t\tsticky: boolean\n\t): void {\n\t\tfor (let i = 0, imax = items.length; i < imax; ++i) {\n\t\t\tconst item = items[i];\n\t\t\tif (item instanceof DisplayObject) {\n\t\t\t\tparent.addChild(item);\n\t\t\t} else if (item != null) {\n\t\t\t\tconst created = creator.newItem(item, sticky);\n\t\t\t\tif (created != null) {\n\t\t\t\t\tparent.addChild(created);\n\t\t\t\t} else {\n\t\t\t\t\tthrow new Error(`No matching menu item creator found: ${JSON.stringify(item)}`);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic newItems<VALUE>(\n\t\tparent: Container,\n\t\titems: Array<DMenuItemOptionsUnion<VALUE> | DisplayObject | null | undefined>,\n\t\tsticky: boolean\n\t): void {\n\t\tthis.newItemsOf(this, parent, items, sticky);\n\t}\n\n\tstatic newMenu<VALUE>(options?: DMenuOptions<VALUE>): DMenu<VALUE> {\n\t\tif (this.MENU_CREATOR != null) {\n\t\t\treturn this.MENU_CREATOR(options);\n\t\t} else {\n\t\t\tthrow new Error(\"Missing DMenu creator.\");\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2021 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DisplayObject } from \"pixi.js\";\nimport { DBase } from \"./d-base\";\nimport { DLinkMenuItemId } from \"./d-link-menu-item-id\";\nimport { DMenu, DMenuOptions } from \"./d-menu\";\nimport { DMenuItem } from \"./d-menu-item\";\nimport { DMenus } from \"./d-menus\";\n\nexport type DLinkMenuOptions = DMenuOptions<DLinkMenuItemId> | DMenu<DLinkMenuItemId>;\n\nexport interface DLinkMenuParent {\n\tcopy(): void;\n\topen(inNewWindow: boolean): void;\n}\n\nexport class DLinkMenu {\n\tprotected _parent: DLinkMenuParent;\n\tprotected _menu?: DMenu<DLinkMenuItemId>;\n\tprotected _options: DMenuOptions<DLinkMenuItemId> | DMenu<DLinkMenuItemId>;\n\tprotected _isEnabled: boolean;\n\n\tconstructor(parent: DLinkMenuParent, options: DLinkMenuOptions) {\n\t\tthis._parent = parent;\n\t\tthis._options = options;\n\t\tthis._isEnabled = true;\n\t}\n\n\tget enable(): boolean {\n\t\treturn this._isEnabled;\n\t}\n\n\tset enable(enable: boolean) {\n\t\tthis._isEnabled = enable;\n\t}\n\n\topen(target: DBase): void {\n\t\tthis.get().open(target);\n\t}\n\n\tget(): DMenu<DLinkMenuItemId> {\n\t\tlet result = this._menu;\n\t\tif (result == null) {\n\t\t\tresult = this.toMenu(this._options);\n\t\t\tthis._menu = result;\n\t\t\tresult.on(\n\t\t\t\t\"select\",\n\t\t\t\t(\n\t\t\t\t\tvalue: DLinkMenuItemId,\n\t\t\t\t\titem: DMenuItem<DLinkMenuItemId>,\n\t\t\t\t\tmenu: DMenu<DLinkMenuItemId>\n\t\t\t\t): void => {\n\t\t\t\t\tthis.onSelect(value, item, menu);\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected toMenu(\n\t\toptions: DMenuOptions<DLinkMenuItemId> | DMenu<DLinkMenuItemId>\n\t): DMenu<DLinkMenuItemId> {\n\t\tif (options instanceof DisplayObject) {\n\t\t\treturn options;\n\t\t}\n\t\treturn this.newMenu(options);\n\t}\n\n\tprotected newMenu(options: DMenuOptions<DLinkMenuItemId>): DMenu<DLinkMenuItemId> {\n\t\treturn DMenus.newMenu(options);\n\t}\n\n\tprotected onSelect(\n\t\tvalue: DLinkMenuItemId,\n\t\titem: DMenuItem<DLinkMenuItemId>,\n\t\tmenu: DMenu<DLinkMenuItemId>\n\t): void {\n\t\tconst parent = this._parent;\n\t\tswitch (value) {\n\t\t\tcase DLinkMenuItemId.OPEN_LINK:\n\t\t\t\tparent.open(false);\n\t\t\t\tbreak;\n\t\t\tcase DLinkMenuItemId.OPEN_LINK_IN_NEW_WINDOW:\n\t\t\t\tparent.open(true);\n\t\t\t\tbreak;\n\t\t\tcase DLinkMenuItemId.COPY_LINK_ADDRESS:\n\t\t\t\tparent.copy();\n\t\t\t\tbreak;\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const DLinkTarget = {\n\tAUTO: 0,\n\tTHIS_WINDOW: 1,\n\tNEW_WINDOW: 2\n} as const;\n\nexport type DLinkTarget = typeof DLinkTarget[keyof typeof DLinkTarget];\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { utils } from \"pixi.js\";\n\nconst getSelection = (element: Element): Selection | null => {\n\tconst selection = document.getSelection();\n\tif (selection) {\n\t\tconst range = document.createRange();\n\t\trange.selectNodeContents(element);\n\t\tselection.removeAllRanges();\n\t\tselection.addRange(range);\n\t}\n\treturn selection;\n};\n\nconst toClipboardData = (e: ClipboardEvent): DataTransfer => {\n\treturn e.clipboardData || (window as any).clipboardData;\n};\n\nconst copyUsingDiv = (text: string): boolean => {\n\tconst div = document.createElement(\"div\");\n\tdiv.setAttribute(\"style\", \"-webkit-user-select: text !important\");\n\tdiv.textContent = \"Dummy\";\n\tdocument.body.appendChild(div);\n\tconst selection = getSelection(div);\n\tlet result = false;\n\tif (selection) {\n\t\tconst handler = (e: ClipboardEvent): void => {\n\t\t\tif (e.target === div) {\n\t\t\t\tconst clipboardData = toClipboardData(e);\n\t\t\t\tclipboardData.setData(\"text/plain\", text);\n\t\t\t\tresult = clipboardData.getData(\"text/plain\") === text;\n\t\t\t\te.preventDefault();\n\t\t\t}\n\t\t};\n\t\tdocument.addEventListener(\"copy\", handler);\n\t\ttry {\n\t\t\tdocument.execCommand(\"copy\");\n\t\t} finally {\n\t\t\tdocument.removeEventListener(\"copy\", handler);\n\t\t}\n\t\tselection.removeAllRanges();\n\t}\n\tdocument.body.removeChild(div);\n\treturn result;\n};\n\nconst copyUsingSpan = (text: string): boolean => {\n\tconst div = document.createElement(\"div\");\n\tdiv.setAttribute(\"style\", \"-webkit-user-select: text !important\");\n\tconst span = document.createElement(\"span\");\n\tspan.innerText = text;\n\tconst root: Node = div.attachShadow ? div.attachShadow({ mode: \"open\" }) : div;\n\troot.appendChild(span);\n\tdocument.body.appendChild(div);\n\tlet result = false;\n\tconst selection = getSelection(div);\n\tif (selection) {\n\t\tresult = document.execCommand(\"copy\");\n\t\tselection.removeAllRanges();\n\t}\n\tdocument.body.removeChild(div);\n\treturn result;\n};\n\nconst copyUsingWindow = (window: Window, text: string): boolean => {\n\tif (typeof ClipboardEvent === \"undefined\") {\n\t\tconst clipboardData = (window as any).clipboardData;\n\t\tif (typeof clipboardData !== \"undefined\" && typeof clipboardData.setData !== \"undefined\") {\n\t\t\tclipboardData.setData(\"Text\", text);\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n};\n\nexport class UtilClipboard extends utils.EventEmitter {\n\tconstructor() {\n\t\tsuper();\n\n\t\tconst element = document.body;\n\t\telement.addEventListener(\"copy\", (e: ClipboardEvent): void => {\n\t\t\tif (e.target === element) {\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\t\t\t\tthis.emit(\"copy\", toClipboardData(e));\n\t\t\t}\n\t\t});\n\n\t\telement.addEventListener(\"cut\", (e: ClipboardEvent): void => {\n\t\t\tif (e.target === element) {\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\t\t\t\tthis.emit(\"cut\", toClipboardData(e));\n\t\t\t}\n\t\t});\n\n\t\telement.addEventListener(\"paste\", (e: ClipboardEvent): void => {\n\t\t\tif (e.target === element) {\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\t\t\t\tthis.emit(\"paste\", toClipboardData(e));\n\t\t\t}\n\t\t});\n\t}\n\n\tstatic copy(text: string): void {\n\t\tconst clipboard = navigator.clipboard;\n\t\tif (clipboard && clipboard.writeText) {\n\t\t\tclipboard.writeText(text);\n\t\t} else {\n\t\t\tif (!copyUsingWindow(window, text)) {\n\t\t\t\tif (!copyUsingDiv(text)) {\n\t\t\t\t\tif (navigator.userAgent.indexOf(\"Edge\") < 0) {\n\t\t\t\t\t\tcopyUsingSpan(text);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DisplayObject, interaction, Texture } from \"pixi.js\";\nimport InteractionEvent = interaction.InteractionEvent;\nimport { DBase } from \"./d-base\";\nimport { DLinkMenu } from \"./d-link-menu\";\nimport { DLinkMenuItemId } from \"./d-link-menu-item-id\";\nimport { DLinkTarget } from \"./d-link-target\";\nimport { DMenu, DMenuOptions } from \"./d-menu\";\nimport { isFunction } from \"./util/is-function\";\nimport { isString } from \"./util/is-string\";\nimport { toEnum } from \"./util/to-enum\";\nimport { UtilClipboard } from \"./util/util-clipboard\";\nimport { UtilPointerEvent } from \"./util/util-pointer-event\";\nimport { DThemes } from \"./theme/d-themes\";\nimport { DBaseStateSet } from \"./d-base-state-set\";\n\nexport type DLinkUrlValue = string | null | undefined;\n\nexport type DLinkUrlMaker = () => DLinkUrlValue | Promise<DLinkUrlValue>;\n\nexport type DLinkTargetValue = DLinkTarget | null | undefined | keyof typeof DLinkTarget;\n\nexport type DLinkChecker = () => boolean | Promise<boolean>;\n\nexport interface DLinkOptions {\n\turl?: DLinkUrlValue | DLinkUrlMaker;\n\ttarget?: DLinkTargetValue;\n\tchecker?: DLinkChecker;\n\tmenu?: DMenuOptions<DLinkMenuItemId> | DMenu<DLinkMenuItemId>;\n}\n\nexport interface DThemeLink {\n\tgetImageSource(state: DBaseStateSet): Texture | DisplayObject | null;\n\tgetMenuOptions(): DMenuOptions<DLinkMenuItemId>;\n}\n\nexport class DLink {\n\tprotected static ANCHOR_ELEMENT?: HTMLAnchorElement;\n\tprotected static MENU?: DLinkMenu;\n\n\tprotected _options?: DLinkOptions;\n\n\tprotected _url: DLinkUrlValue | DLinkUrlMaker;\n\tprotected _target: DLinkTarget;\n\tprotected _checker?: DLinkChecker;\n\tprotected _menu?: DLinkMenu;\n\tprotected _isEnabled: boolean;\n\n\tconstructor(options?: DLinkOptions) {\n\t\tthis._options = options;\n\n\t\tthis._url = options?.url;\n\t\tthis._target = this.toNormalizedTarget(options?.target);\n\t\tthis._checker = options?.checker;\n\t\tthis._isEnabled = true;\n\t}\n\n\tget enable(): boolean {\n\t\treturn this._isEnabled;\n\t}\n\n\tset enable(enable: boolean) {\n\t\tthis._isEnabled = enable;\n\t}\n\n\tget url(): DLinkUrlValue | DLinkUrlMaker {\n\t\treturn this._url;\n\t}\n\n\tset url(url: DLinkUrlValue | DLinkUrlMaker) {\n\t\tthis._url = url;\n\t}\n\n\tget target(): DLinkTarget {\n\t\treturn this._target;\n\t}\n\n\tset target(target: DLinkTargetValue) {\n\t\tthis._target = this.toNormalizedTarget(target);\n\t}\n\n\tget checker(): DLinkChecker | undefined {\n\t\treturn this._checker;\n\t}\n\n\tset checker(checker: DLinkChecker | undefined) {\n\t\tthis._checker = checker;\n\t}\n\n\tget menu(): DLinkMenu {\n\t\tlet result = this._menu;\n\t\tif (result == null) {\n\t\t\tresult = this.newMenu();\n\t\t\tthis._menu = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected newMenu(): DLinkMenu {\n\t\tconst options = this._options;\n\t\tif (options) {\n\t\t\tconst menu = options.menu;\n\t\t\tif (menu) {\n\t\t\t\treturn new DLinkMenu(this, menu);\n\t\t\t}\n\t\t}\n\t\tlet result = DLink.MENU;\n\t\tif (result == null) {\n\t\t\tresult = new DLinkMenu(\n\t\t\t\tthis,\n\t\t\t\tDThemes.getInstance().get<DThemeLink>(\"DLink\").getMenuOptions()\n\t\t\t);\n\t\t\tDLink.MENU = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected toStringifiedUrl(\n\t\ttarget: DLinkUrlValue | DLinkUrlMaker,\n\t\tonResolved: (url: string) => void\n\t): void {\n\t\tconst url = isFunction(target) ? target() : target;\n\t\tif (url != null) {\n\t\t\tif (isString(url)) {\n\t\t\t\tonResolved(url);\n\t\t\t} else {\n\t\t\t\turl.then((resolved: DLinkUrlValue): void => {\n\t\t\t\t\tif (resolved != null) {\n\t\t\t\t\t\tonResolved(resolved);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected toNormalizedUrl(url: string): string {\n\t\tconst a = DLink.ANCHOR_ELEMENT || document.createElement(\"a\");\n\t\tDLink.ANCHOR_ELEMENT = a;\n\t\ta.href = url;\n\t\treturn a.href;\n\t}\n\n\tprotected toNormalizedTarget(target: DLinkTargetValue): DLinkTarget {\n\t\treturn toEnum(target ?? DLinkTarget.AUTO, DLinkTarget);\n\t}\n\n\t/**\n\t * Copys the URL to the clipboard.\n\t */\n\tcopy(): void {\n\t\tthis.toStringifiedUrl(this._url, (url: string): void => {\n\t\t\tUtilClipboard.copy(this.toNormalizedUrl(url));\n\t\t});\n\t}\n\n\t/**\n\t * Checks and opens the URL.\n\t *\n\t * @param e An event object which triggered this method call.\n\t */\n\topen(e?: InteractionEvent | KeyboardEvent | MouseEvent | TouchEvent): void;\n\n\t/**\n\t * Checks and opens the URL.\n\t *\n\t * @param inNewWindow True to open in a new window\n\t */\n\topen(inNewWindow: boolean): void;\n\topen(\n\t\tx: InteractionEvent | KeyboardEvent | MouseEvent | TouchEvent | undefined | boolean\n\t): void {\n\t\tthis.toStringifiedUrl(this._url, (url): void => {\n\t\t\tconst inNewWindow = x === true || x === false ? x : this.inNewWindow(x);\n\t\t\tthis.check(url, inNewWindow, (): void => {\n\t\t\t\tthis.exec(url, inNewWindow);\n\t\t\t});\n\t\t});\n\t}\n\n\tcheck(url: string, inNewWindow: boolean, onResolved: () => void): void {\n\t\tconst checker = this._checker;\n\t\tif (checker) {\n\t\t\tconst checked = checker();\n\t\t\tif (checked === true) {\n\t\t\t\tonResolved();\n\t\t\t} else if (checked === false) {\n\t\t\t\t// DO NOTHING\n\t\t\t} else {\n\t\t\t\tchecked.then((resolved: boolean): void => {\n\t\t\t\t\tif (resolved) {\n\t\t\t\t\t\tonResolved();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\tonResolved();\n\t\t}\n\t}\n\n\t/**\n\t * Opens the given URL.\n\t *\n\t * @param url An URL to be opened\n\t * @param inNewWindow True to open in a new window.\n\t */\n\texec(url: string, inNewWindow: boolean): void {\n\t\tif (inNewWindow) {\n\t\t\tconst a = document.createElement(\"a\");\n\t\t\ta.href = url;\n\t\t\ta.target = \"_blank\";\n\t\t\ta.style.display = \"none\";\n\t\t\ta.rel = \"noopener noreferrer\";\n\t\t\tdocument.body.appendChild(a);\n\t\t\ta.click();\n\t\t\tsetTimeout((): void => {\n\t\t\t\tdocument.body.removeChild(a);\n\t\t\t}, 100);\n\t\t} else {\n\t\t\twindow.location.href = url;\n\t\t}\n\t}\n\n\t/**\n\t * Returns true if the URL need to be opened in a new window.\n\t *\n\t * @param e An event object.\n\t */\n\tinNewWindow(e?: InteractionEvent | KeyboardEvent | MouseEvent | TouchEvent): boolean {\n\t\tswitch (this._target) {\n\t\t\tcase DLinkTarget.NEW_WINDOW:\n\t\t\t\treturn true;\n\t\t\tcase DLinkTarget.THIS_WINDOW:\n\t\t\t\treturn false;\n\t\t\tcase DLinkTarget.AUTO:\n\t\t\t\tif (e != null) {\n\t\t\t\t\tconst oe = e instanceof InteractionEvent ? e.data.originalEvent : e;\n\t\t\t\t\treturn (\n\t\t\t\t\t\toe.ctrlKey ||\n\t\t\t\t\t\toe.shiftKey ||\n\t\t\t\t\t\toe.altKey ||\n\t\t\t\t\t\toe.metaKey ||\n\t\t\t\t\t\t(\"button\" in oe && oe.button !== 0)\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t}\n\t}\n\n\tadd(base: DBase, onSelect: (e: InteractionEvent) => void): void {\n\t\tUtilPointerEvent.onClick(base, (e: InteractionEvent, isSimulated: boolean): void => {\n\t\t\tif (!this.onClick(base, isSimulated)) {\n\t\t\t\tonSelect(e);\n\t\t\t}\n\t\t});\n\t}\n\n\tonClick(base: DBase, isSimulated: boolean): boolean {\n\t\tif (this._target === DLinkTarget.AUTO && isSimulated) {\n\t\t\tconst menu = this.menu;\n\t\t\tif (menu.enable) {\n\t\t\t\tif (this._isEnabled && base.state.isActionable) {\n\t\t\t\t\tmenu.open(base);\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\tif (this._isEnabled && base.state.isActionable) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n}\n","/*\n * Copyright (C) 2021 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBaseState } from \"./d-base-state\";\nimport { DLinkTarget } from \"./d-link-target\";\nimport { isString } from \"./util/is-string\";\n\nexport interface DLinksStateOptions {\n\tstate?: string | string[];\n}\n\nexport class DLinks {\n\tstatic toStateOptions<OPTIONS extends DLinksStateOptions>(\n\t\ttarget?: DLinkTarget | keyof typeof DLinkTarget,\n\t\toptions?: OPTIONS\n\t): OPTIONS | undefined {\n\t\tif (options) {\n\t\t\tif (target === DLinkTarget.NEW_WINDOW || target === \"NEW_WINDOW\") {\n\t\t\t\tconst state = options.state;\n\t\t\t\tif (state == null) {\n\t\t\t\t\toptions.state = DBaseState.NEW_WINDOW;\n\t\t\t\t} else if (isString(state)) {\n\t\t\t\t\tif (state !== DBaseState.NEW_WINDOW) {\n\t\t\t\t\t\toptions.state = [state, DBaseState.NEW_WINDOW];\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (state.indexOf(DBaseState.NEW_WINDOW) < 0) {\n\t\t\t\t\t\tstate.push(DBaseState.NEW_WINDOW);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn options;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction } from \"pixi.js\";\nimport { DLink, DLinkChecker, DLinkOptions, DLinkUrlMaker } from \"./d-link\";\nimport { DLinkMenuItemId } from \"./d-link-menu-item-id\";\nimport { DLinkTarget } from \"./d-link-target\";\nimport { DLinks } from \"./d-links\";\nimport { DMenu, DMenuOptions } from \"./d-menu\";\nimport { DMenuItemText, DMenuItemTextOptions, DThemeMenuItemText } from \"./d-menu-item-text\";\nimport { isString } from \"./util/is-string\";\n\nexport type DMenuItemLinkUrlMaker = (item: DMenuItemLink) => string | null | Promise<string | null>;\nexport type DMenuItemLinkChecker = (item: DMenuItemLink) => boolean | Promise<boolean>;\n\nexport interface DMenuItemLinkOptions<\n\tVALUE = unknown,\n\tTHEME extends DThemeMenuItemLink = DThemeMenuItemLink\n> extends DMenuItemTextOptions<VALUE, THEME> {\n\turl?: string | DMenuItemLinkUrlMaker;\n\ttarget?: DLinkTarget | keyof typeof DLinkTarget;\n\tchecker?: DMenuItemLinkChecker;\n\tmenu?: DMenuOptions<DLinkMenuItemId> | DMenu<DLinkMenuItemId>;\n}\n\nexport interface DThemeMenuItemLink extends DThemeMenuItemText {}\n\nexport class DMenuItemLink<\n\tVALUE = unknown,\n\tTHEME extends DThemeMenuItemLink = DThemeMenuItemLink,\n\tOPTIONS extends DMenuItemLinkOptions<VALUE, THEME> = DMenuItemLinkOptions<VALUE, THEME>\n> extends DMenuItemText<VALUE, THEME, OPTIONS> {\n\tprotected _link!: DLink;\n\n\tprotected toLinkOptions(options?: OPTIONS): DLinkOptions | undefined {\n\t\tif (options) {\n\t\t\treturn {\n\t\t\t\turl: this.toUrl(options.url),\n\t\t\t\ttarget: options.target,\n\t\t\t\tchecker: this.toChecker(options.checker),\n\t\t\t\tmenu: options.menu\n\t\t\t};\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprotected toUrl(url?: string | DMenuItemLinkUrlMaker): string | DLinkUrlMaker | undefined {\n\t\tif (isString(url) || url == null) {\n\t\t\treturn url;\n\t\t} else {\n\t\t\treturn () => {\n\t\t\t\treturn url(this);\n\t\t\t};\n\t\t}\n\t}\n\n\tprotected toChecker(checker?: DMenuItemLinkChecker): DLinkChecker | undefined {\n\t\tif (checker != null) {\n\t\t\treturn () => {\n\t\t\t\treturn checker(this);\n\t\t\t};\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprotected init(options?: OPTIONS): void {\n\t\tthis._link = new DLink(this.toLinkOptions(options));\n\t\tsuper.init(DLinks.toStateOptions(options?.target, options));\n\t}\n\n\tget link(): DLink {\n\t\treturn this._link;\n\t}\n\n\tprotected initOnClick(options?: OPTIONS): void {\n\t\tthis._link.add(this, (e) => this.onSelect(e));\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DMenuItemLink\";\n\t}\n\n\tprotected onSelect(e: KeyboardEvent | interaction.InteractionEvent): void {\n\t\tsuper.onSelect(e);\n\t\tthis._link.open(e);\n\t}\n\n\topen(inNewWindow: boolean): void {\n\t\tthis._link.open(inNewWindow);\n\t}\n\n\tprotected onShortcut(e: KeyboardEvent): void {\n\t\tsuper.onShortcut(e);\n\t\tthis.onSelect(e);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DMenuItemLinkOptions } from \"./d-menu-item-link\";\nimport { DMenuItemOptionsUnion } from \"./d-menu-item-options-union\";\n\nexport const DMenuItemLinkIsCompatible = <VALUE>(\n\toptions: DMenuItemOptionsUnion<VALUE>\n): options is DMenuItemLinkOptions<VALUE> => {\n\treturn \"url\" in options;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DisplayObject, interaction } from \"pixi.js\";\nimport { DMenu, DMenuOptions } from \"./d-menu\";\nimport { DMenuItem, DMenuItemOptions, DThemeMenuItem } from \"./d-menu-item\";\nimport { DMenus } from \"./d-menus\";\nimport { UtilKeyboardEvent } from \"./util/util-keyboard-event\";\nimport { UtilPointerEvent } from \"./util/util-pointer-event\";\n\nexport interface DMenuItemMenuOptions<\n\tVALUE = unknown,\n\tTHEME extends DThemeMenuItemMenu = DThemeMenuItemMenu\n> extends DMenuItemOptions<VALUE, THEME> {\n\tmenu: DMenuOptions<VALUE> | DMenu<VALUE>;\n}\n\nexport interface DThemeMenuItemMenu extends DThemeMenuItem {}\n\nexport class DMenuItemMenu<\n\tVALUE = unknown,\n\tTHEME extends DThemeMenuItemMenu = DThemeMenuItemMenu,\n\tOPTIONS extends DMenuItemMenuOptions<VALUE, THEME> = DMenuItemMenuOptions<VALUE, THEME>\n> extends DMenuItem<VALUE, THEME, OPTIONS> {\n\tprotected _menu?: DMenu<VALUE>;\n\n\tprotected init(options: OPTIONS): void {\n\t\tsuper.init(options);\n\t\tthis.initHover(options);\n\t}\n\n\tprotected initHover(options: OPTIONS): void {\n\t\tthis.on(UtilPointerEvent.over, (): void => {\n\t\t\tif (this.state.isActionable) {\n\t\t\t\tthis.open();\n\t\t\t}\n\t\t});\n\t}\n\n\tprotected toMenu(options?: OPTIONS): DMenu<VALUE> {\n\t\tconst menu = options?.menu;\n\t\tif (menu instanceof DisplayObject) {\n\t\t\treturn menu;\n\t\t}\n\t\treturn this.newMenu(menu);\n\t}\n\n\tprotected newMenu(options?: DMenuOptions<VALUE>): DMenu<VALUE> {\n\t\treturn DMenus.newMenu(options);\n\t}\n\n\tget menu(): DMenu<VALUE> {\n\t\tlet result = this._menu;\n\t\tif (result == null) {\n\t\t\tresult = this.toMenu(this._options);\n\t\t\tresult.on(\n\t\t\t\t\"select\",\n\t\t\t\t(value: VALUE, item: DMenuItem<VALUE>, menu: DMenu<VALUE>): void => {\n\t\t\t\t\tthis.onMenuSelect(value, item, menu);\n\t\t\t\t}\n\t\t\t);\n\t\t\tthis._menu = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DMenuItemMenu\";\n\t}\n\n\topen(): void {\n\t\tconst menu = this.menu;\n\t\tif (menu.isHidden()) {\n\t\t\tthis.onOpen(menu);\n\t\t}\n\t}\n\n\tprotected onOpen(menu: DMenu<VALUE>): void {\n\t\tconst context = this.getContext();\n\t\tif (context != null) {\n\t\t\tmenu.open(this, this.getCloseable(), context);\n\t\t}\n\t}\n\n\tclose(): void {\n\t\tthis.menu.close();\n\t}\n\n\ttoggle(): void {\n\t\tconst menu = this.menu;\n\t\tif (menu.isHidden()) {\n\t\t\tthis.onOpen(menu);\n\t\t} else {\n\t\t\tmenu.close();\n\t\t}\n\t}\n\n\tprotected onSelect(e: KeyboardEvent | interaction.InteractionEvent): void {\n\t\tthis.open();\n\t\tsuper.onSelect(e);\n\t}\n\n\tprotected onMenuSelect(value: VALUE, item: DMenuItem<VALUE>, menu: DMenu<VALUE>): void {\n\t\tconst closeable = this.getCloseable();\n\t\tif (closeable != null) {\n\t\t\tcloseable.emit(\"select\", value, item, closeable);\n\t\t}\n\t}\n\n\tonKeyDown(e: KeyboardEvent): boolean {\n\t\tif (UtilKeyboardEvent.isArrowRightKey(e)) {\n\t\t\tthis.onKeyDownArrowRight(e);\n\t\t}\n\t\treturn super.onKeyDown(e);\n\t}\n\n\tprotected onKeyDownArrowRight(e: KeyboardEvent): boolean {\n\t\tif (this.state.isActionable && this.state.isFocused) {\n\t\t\tthis.onSelect(e);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DMenuItemMenuOptions } from \"./d-menu-item-menu\";\nimport { DMenuItemOptionsUnion } from \"./d-menu-item-options-union\";\n\nexport const DMenuItemMenuIsCompatible = <VALUE>(\n\toptions: DMenuItemOptionsUnion<VALUE>\n): options is DMenuItemMenuOptions<VALUE> => {\n\treturn \"menu\" in options;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DisplayObject } from \"pixi.js\";\nimport { DMenuAlign } from \"./d-menu-align\";\nimport { DMenuItemMenuOptions } from \"./d-menu-item-menu\";\n\nexport const DMenuItemMenuToSubMenuOptions = <VALUE>(\n\toptions: DMenuItemMenuOptions<VALUE>,\n\tsticky: boolean\n): DMenuItemMenuOptions<VALUE> => {\n\tconst menu = options.menu;\n\tif (!(menu instanceof DisplayObject)) {\n\t\tif (menu.sticky == null) {\n\t\t\tmenu.sticky = sticky;\n\t\t}\n\t\tif (menu.align == null) {\n\t\t\tmenu.align = DMenuAlign.RIGHT;\n\t\t}\n\t}\n\treturn options;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Graphics } from \"pixi.js\";\nimport { DBase } from \"./d-base\";\nimport { DBaseReflowable } from \"./d-base-reflowable\";\n\nexport class DMenuItemSeparatorReflowable extends Graphics implements DBaseReflowable {\n\tconstructor(base: DBase) {\n\t\tsuper();\n\t\tbase.snippet.add(this, true);\n\t\tbase.reflowable.add(this);\n\t}\n\n\tonReflow(base: DBase, width: number, height: number): void {\n\t\tconst state = base.state;\n\t\tconst border = base.border;\n\t\tconst borderWidth = border.getWidth(state);\n\t\tconst borderColor = border.getColor(state);\n\t\tif (borderColor != null) {\n\t\t\tconst borderAlpha = border.getAlpha(state);\n\t\t\tconst borderAlign = border.getAlign(state);\n\t\t\tconst padding = base.padding;\n\t\t\tconst middle = height * 0.5;\n\t\t\tthis.clear();\n\t\t\tthis.lineStyle(borderWidth, borderColor, borderAlpha, borderAlign);\n\t\t\tthis.moveTo(padding.getLeft(), middle);\n\t\t\tthis.lineTo(width - padding.getRight(), middle);\n\t\t\tthis.visible = true;\n\t\t} else {\n\t\t\tthis.clear();\n\t\t\tthis.visible = false;\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DMenuItemSeparatorReflowable } from \"./d-menu-item-separator-reflowable\";\nimport { DMenuItemBase, DMenuItemBaseOptions, DThemeMenuItemBase } from \"./d-menu-item-base\";\nimport { DMenuItemOptionsUnion } from \"./d-menu-item-options-union\";\n\nexport interface DMenuItemSeparatorOptions<\n\tVALUE = unknown,\n\tTHEME extends DThemeMenuItemSeparator = DThemeMenuItemSeparator\n> extends DMenuItemBaseOptions<VALUE, THEME> {\n\tseparator?: true;\n}\n\nexport interface DThemeMenuItemSeparator extends DThemeMenuItemBase {}\n\nexport const DMenuItemSeparatorIsCompatible = (\n\toptions: DMenuItemOptionsUnion<unknown>\n): options is DMenuItemSeparatorOptions<unknown> => {\n\treturn \"separator\" in options;\n};\n\nexport class DMenuItemSeparator<\n\tVALUE = unknown,\n\tTHEME extends DThemeMenuItemSeparator = DThemeMenuItemSeparator,\n\tOPTIONS extends DMenuItemSeparatorOptions<VALUE, THEME> = DMenuItemSeparatorOptions<\n\t\tVALUE,\n\t\tTHEME\n\t>\n> extends DMenuItemBase<VALUE, THEME, OPTIONS> {\n\tprotected initReflowable(): void {\n\t\tnew DMenuItemSeparatorReflowable(this);\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DMenuItemSeparator\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DLayoutSpace, DLayoutSpaceOptions, DThemeLayoutSpace } from \"./d-layout-space\";\n\nexport interface DMenuItemSpaceOptions<THEME extends DThemeMenuItemSpace = DThemeMenuItemSpace>\n\textends DLayoutSpaceOptions<THEME> {\n\tspace: true;\n}\n\nexport interface DThemeMenuItemSpace extends DThemeLayoutSpace {}\n\nexport class DMenuItemSpace<\n\tTHEME extends DThemeMenuItemSpace = DThemeMenuItemSpace,\n\tOPTIONS extends DMenuItemSpaceOptions<THEME> = DMenuItemSpaceOptions<THEME>\n> extends DLayoutSpace<THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DMenuItemSpace\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DMenuItemOptionsUnion } from \"./d-menu-item-options-union\";\nimport { DMenuItemSpaceOptions } from \"./d-menu-item-space\";\n\nexport const DMenuItemSpaceIsCompatible = <VALUE>(\n\toptions: DMenuItemOptionsUnion<VALUE>\n): options is DMenuItemSpaceOptions => {\n\treturn \"space\" in options;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DisplayObject } from \"pixi.js\";\nimport { DMenuItemCheck } from \"../d-menu-item-check\";\nimport { DMenuItemCheckIsCompatible } from \"../d-menu-item-check-is-compatible\";\nimport { DMenuItemLink } from \"../d-menu-item-link\";\nimport { DMenuItemLinkIsCompatible } from \"../d-menu-item-link-is-compatible\";\nimport { DMenuItemMenu } from \"../d-menu-item-menu\";\nimport { DMenuItemMenuIsCompatible } from \"../d-menu-item-menu-is-compatible\";\nimport { DMenuItemMenuToSubMenuOptions } from \"../d-menu-item-menu-to-sub-menu-options\";\nimport { DMenuItemOptionsUnion } from \"../d-menu-item-options-union\";\nimport { DMenuItemSeparator, DMenuItemSeparatorIsCompatible } from \"../d-menu-item-separator\";\nimport { DMenuItemSpace } from \"../d-menu-item-space\";\nimport { DMenuItemSpaceIsCompatible } from \"../d-menu-item-space-is-compatible\";\nimport { DMenuItemText } from \"../d-menu-item-text\";\nimport { DMenus } from \"../d-menus\";\n\nexport const loadMenuItem = (): void => {\n\tDMenus.addItemCreator((options: DMenuItemOptionsUnion<any>): DisplayObject | null => {\n\t\tif (DMenuItemCheckIsCompatible(options)) {\n\t\t\treturn new DMenuItemCheck(options);\n\t\t}\n\t\treturn null;\n\t});\n\n\tDMenus.addItemCreator((options: DMenuItemOptionsUnion<any>): DisplayObject | null => {\n\t\tif (DMenuItemLinkIsCompatible(options)) {\n\t\t\treturn new DMenuItemLink(options);\n\t\t}\n\t\treturn null;\n\t});\n\n\tDMenus.addItemCreator(\n\t\t(options: DMenuItemOptionsUnion<any>, sticky: boolean): DisplayObject | null => {\n\t\t\tif (DMenuItemMenuIsCompatible(options)) {\n\t\t\t\treturn new DMenuItemMenu(DMenuItemMenuToSubMenuOptions(options, sticky));\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\t);\n\n\tDMenus.addItemCreator((options: DMenuItemOptionsUnion<any>): DisplayObject | null => {\n\t\tif (DMenuItemSeparatorIsCompatible(options)) {\n\t\t\treturn new DMenuItemSeparator(options);\n\t\t}\n\t\treturn null;\n\t});\n\n\tDMenus.addItemCreator((options: DMenuItemOptionsUnion<any>): DisplayObject | null => {\n\t\tif (DMenuItemSpaceIsCompatible(options)) {\n\t\t\treturn new DMenuItemSpace(options);\n\t\t}\n\t\treturn null;\n\t});\n\n\tDMenus.setItemCreatorDefault((options: any): DisplayObject | null => {\n\t\treturn new DMenuItemText(options);\n\t});\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DLayoutVertical, DLayoutVerticalOptions, DThemeLayoutVertical } from \"./d-layout-vertical\";\n\nexport interface DMenuItemExpandableBodyOptions<\n\tTHEME extends DThemeMenuItemExpandableBody = DThemeMenuItemExpandableBody\n> extends DLayoutVerticalOptions<THEME> {}\n\nexport interface DThemeMenuItemExpandableBody extends DThemeLayoutVertical {}\n\nexport class DMenuItemExpandableBody<\n\tTHEME extends DThemeMenuItemExpandableBody = DThemeMenuItemExpandableBody,\n\tOPTIONS extends DMenuItemExpandableBodyOptions<THEME> = DMenuItemExpandableBodyOptions<THEME>\n> extends DLayoutVertical<THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DMenuItemExpandableBody\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DMenuItemBase, DMenuItemBaseOptions, DThemeMenuItemBase } from \"./d-menu-item-base\";\nimport { DMenuItemBaseSelection } from \"./d-menu-item-base-selection\";\n\nexport interface DMenuItemExpandableHeaderOptions<\n\tVALUE = unknown,\n\tTHEME extends DThemeMenuItemExpandableHeader = DThemeMenuItemExpandableHeader\n> extends DMenuItemBaseOptions<VALUE, THEME> {}\n\nexport interface DThemeMenuItemExpandableHeader extends DThemeMenuItemBase {}\n\nexport class DMenuItemExpandableHeader<\n\tVALUE = unknown,\n\tTHEME extends DThemeMenuItemExpandableHeader = DThemeMenuItemExpandableHeader,\n\tOPTIONS extends DMenuItemExpandableHeaderOptions<\n\t\tVALUE,\n\t\tTHEME\n\t> = DMenuItemExpandableHeaderOptions<VALUE, THEME>\n> extends DMenuItemBase<VALUE, THEME, OPTIONS> {\n\tprotected getSelection(): DMenuItemBaseSelection | null {\n\t\treturn null;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DMenuItemExpandableHeader\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Container, DisplayObject } from \"pixi.js\";\nimport { DMenuItemOptionsUnion } from \"./d-menu-item-options-union\";\nimport { DMenuItemCreator, DMenus } from \"./d-menus\";\n\nexport class DMenuItemExpandables {\n\tprotected static CREATORS: DMenuItemCreator[] = [];\n\tprotected static CREATOR_DEFAULT: DMenuItemCreator | null = null;\n\n\tstatic addItemCreator(creator: DMenuItemCreator): void {\n\t\tthis.CREATORS.push(creator);\n\t}\n\n\tstatic setItemCreatorDefault(creator: DMenuItemCreator): void {\n\t\tthis.CREATOR_DEFAULT = creator;\n\t}\n\n\tstatic newItem<VALUE>(\n\t\toptions: DMenuItemOptionsUnion<VALUE>,\n\t\tsticky: boolean\n\t): DisplayObject | null {\n\t\treturn (\n\t\t\tDMenus.newItemOf(this.CREATORS, this.CREATOR_DEFAULT, options, sticky) ||\n\t\t\tDMenus.newItem(options, sticky)\n\t\t);\n\t}\n\n\tstatic newItems<VALUE>(\n\t\tparent: Container,\n\t\titems: Array<DMenuItemOptionsUnion<VALUE> | DisplayObject>,\n\t\tsticky: boolean\n\t): void {\n\t\tDMenus.newItemsOf(this, parent, items, sticky);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Container, DisplayObject } from \"pixi.js\";\nimport { DBase } from \"./d-base\";\nimport { DBaseStateSet } from \"./d-base-state-set\";\nimport { DLayoutVertical, DLayoutVerticalOptions, DThemeLayoutVertical } from \"./d-layout-vertical\";\nimport {\n\tDMenuItemExpandableBody,\n\tDMenuItemExpandableBodyOptions\n} from \"./d-menu-item-expandable-body\";\nimport {\n\tDMenuItemExpandableHeader,\n\tDMenuItemExpandableHeaderOptions\n} from \"./d-menu-item-expandable-header\";\nimport { DMenuItemExpandables } from \"./d-menu-item-expandables\";\nimport { DMenuItemOptionsUnion } from \"./d-menu-item-options-union\";\nimport { UtilKeyboardEvent } from \"./util/util-keyboard-event\";\n\nexport interface DMenuItemExpandableOptions<\n\tVALUE = unknown,\n\tTHEME extends DThemeMenuItemExpandable = DThemeMenuItemExpandable\n> extends DLayoutVerticalOptions<THEME> {\n\theader: DisplayObject | DMenuItemExpandableHeaderOptions<VALUE>;\n\tbody?: Container | DMenuItemExpandableBodyOptions;\n\titems?: Array<DMenuItemOptionsUnion<VALUE> | DisplayObject>;\n\tsticky?: boolean;\n}\n\nexport interface DThemeMenuItemExpandable extends DThemeLayoutVertical {}\n\nexport class DMenuItemExpandable<\n\tVALUE = unknown,\n\tTHEME extends DThemeMenuItemExpandable = DThemeMenuItemExpandable,\n\tOPTIONS extends DMenuItemExpandableOptions<VALUE, THEME> = DMenuItemExpandableOptions<\n\t\tVALUE,\n\t\tTHEME\n\t>\n> extends DLayoutVertical<THEME, OPTIONS> {\n\tprotected _header!: DisplayObject;\n\tprotected _body!: DisplayObject;\n\n\tprotected init(options?: OPTIONS): void {\n\t\tsuper.init(options);\n\n\t\t// Header\n\t\tconst theme = this.theme;\n\t\tconst header = this.toHeader(theme, options);\n\t\tthis._header = header;\n\t\theader.on(\"select\", (): void => {\n\t\t\tthis.toggle();\n\t\t});\n\t\tthis.addChild(header);\n\n\t\t// Body\n\t\tconst body = this.toBody(theme, options);\n\t\tthis._body = body;\n\t\tconst sticky = options?.sticky ?? false;\n\t\tthis.newItems(body, sticky, theme, options);\n\t\tthis.addChild(body);\n\n\t\t//\n\t\tif (this.state.isActive) {\n\t\t\tthis.onActivated();\n\t\t} else {\n\t\t\tthis.onDeactivated();\n\t\t}\n\t}\n\n\tprotected newItems(\n\t\tbody: Container,\n\t\tsticky: boolean,\n\t\ttheme: THEME,\n\t\toptions: OPTIONS | undefined\n\t): void {\n\t\tconst items = options?.items;\n\t\tif (items != null) {\n\t\t\tDMenuItemExpandables.newItems(body, items, sticky);\n\t\t}\n\t}\n\n\tprotected toHeader(theme: THEME, options?: OPTIONS): DisplayObject {\n\t\tif (options) {\n\t\t\tif (options.header instanceof DisplayObject) {\n\t\t\t\treturn options.header;\n\t\t\t} else {\n\t\t\t\treturn this.newHeader(theme, options.header);\n\t\t\t}\n\t\t}\n\t\treturn this.newHeader(theme);\n\t}\n\n\tprotected newHeader(\n\t\ttheme: THEME,\n\t\toptions?: DMenuItemExpandableHeaderOptions<VALUE>\n\t): DisplayObject {\n\t\treturn new DMenuItemExpandableHeader<VALUE>(options);\n\t}\n\n\tprotected toBody(theme: THEME, options?: OPTIONS): Container {\n\t\tconst body = options?.body;\n\t\tif (body) {\n\t\t\tif (body instanceof DisplayObject) {\n\t\t\t\treturn body;\n\t\t\t} else {\n\t\t\t\treturn this.newBody(theme, body);\n\t\t\t}\n\t\t}\n\t\treturn this.newBody(theme);\n\t}\n\n\tprotected newBody(theme: THEME, options?: DMenuItemExpandableBodyOptions): Container {\n\t\treturn new DMenuItemExpandableBody(options);\n\t}\n\n\topen(): void {\n\t\tthis.state.isActive = true;\n\t}\n\n\tclose(): void {\n\t\tthis.state.isActive = false;\n\t}\n\n\ttoggle(): void {\n\t\tthis.state.isActive = !this.state.isActive;\n\t}\n\n\tprotected onActivated(): void {\n\t\tconst body = this._body;\n\t\tif (body instanceof DBase) {\n\t\t\tbody.show();\n\t\t} else {\n\t\t\tbody.visible = true;\n\t\t}\n\t}\n\n\tprotected onDeactivated(): void {\n\t\tconst body = this._body;\n\t\tif (body instanceof DBase) {\n\t\t\tbody.hide();\n\t\t} else {\n\t\t\tbody.visible = false;\n\t\t}\n\t}\n\n\tprotected onStateChange(newState: DBaseStateSet, oldState: DBaseStateSet): void {\n\t\tsuper.onStateChange(newState, oldState);\n\n\t\tif (newState.isActive) {\n\t\t\tif (!oldState.isActive) {\n\t\t\t\tthis.onActivated();\n\t\t\t}\n\t\t} else {\n\t\t\tif (oldState.isActive) {\n\t\t\t\tthis.onDeactivated();\n\t\t\t}\n\t\t}\n\t}\n\n\tonKeyDown(e: KeyboardEvent): boolean {\n\t\tif (UtilKeyboardEvent.isArrowRightKey(e)) {\n\t\t\tif (this.state.isActionable && !this.state.isActive) {\n\t\t\t\tconst header = this._header;\n\t\t\t\tif (header instanceof DBase && header.state.isFocused) {\n\t\t\t\t\tthis.state.isActive = true;\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (UtilKeyboardEvent.isArrowLeftKey(e)) {\n\t\t\tif (this.state.isActionable && this.state.isActive) {\n\t\t\t\t// Move the focus\n\t\t\t\tconst header = this._header;\n\t\t\t\tif (header instanceof DBase) {\n\t\t\t\t\theader.focus();\n\t\t\t\t} else {\n\t\t\t\t\tthis.focus();\n\t\t\t\t}\n\n\t\t\t\t// Deactivate\n\t\t\t\tthis.state.isActive = false;\n\n\t\t\t\t// Key handling\n\t\t\t\tsuper.onKeyDown(e);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn super.onKeyDown(e);\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DMenuItemExpandable\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DMenuItemExpandableOptions } from \"./d-menu-item-expandable\";\nimport { DMenuItemOptionsUnion } from \"./d-menu-item-options-union\";\n\nexport const DMenuItemExpandableIsCompatible = <VALUE>(\n\toptions: DMenuItemOptionsUnion<VALUE>\n): options is DMenuItemExpandableOptions<VALUE> => {\n\treturn \"header\" in options;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DMenuItemCheck, DMenuItemCheckOptions, DThemeMenuItemCheck } from \"./d-menu-item-check\";\n\nexport class DMenuItemExpandableItemCheck<\n\tVALUE = unknown,\n\tTHEME extends DThemeMenuItemCheck = DThemeMenuItemCheck,\n\tOPTIONS extends DMenuItemCheckOptions<VALUE, THEME> = DMenuItemCheckOptions<VALUE, THEME>\n> extends DMenuItemCheck<VALUE, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DMenuItemExpandableItemCheck\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DMenuItemLink, DMenuItemLinkOptions, DThemeMenuItemLink } from \"./d-menu-item-link\";\n\nexport class DMenuItemExpandableItemLink<\n\tVALUE = unknown,\n\tTHEME extends DThemeMenuItemLink = DThemeMenuItemLink,\n\tOPTIONS extends DMenuItemLinkOptions<VALUE, THEME> = DMenuItemLinkOptions<VALUE, THEME>\n> extends DMenuItemLink<VALUE, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DMenuItemExpandableItemLink\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {\n\tDMenuItemSeparator,\n\tDMenuItemSeparatorOptions,\n\tDThemeMenuItemSeparator\n} from \"./d-menu-item-separator\";\n\nexport class DMenuItemExpandableItemSeparator<\n\tVALUE = unknown,\n\tTHEME extends DThemeMenuItemSeparator = DThemeMenuItemSeparator,\n\tOPTIONS extends DMenuItemSeparatorOptions<VALUE, THEME> = DMenuItemSeparatorOptions<\n\t\tVALUE,\n\t\tTHEME\n\t>\n> extends DMenuItemSeparator<VALUE, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DMenuItemExpandableItemSeparator\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DMenuItemSpace, DMenuItemSpaceOptions, DThemeMenuItemSpace } from \"./d-menu-item-space\";\n\nexport class DMenuItemExpandableItemSpace<\n\tTHEME extends DThemeMenuItemSpace = DThemeMenuItemSpace,\n\tOPTIONS extends DMenuItemSpaceOptions<THEME> = DMenuItemSpaceOptions<THEME>\n> extends DMenuItemSpace<THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DMenuItemExpandableItemSpace\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DMenuItemText, DMenuItemTextOptions, DThemeMenuItemText } from \"./d-menu-item-text\";\n\nexport class DMenuItemExpandableItemText<\n\tVALUE = unknown,\n\tTHEME extends DThemeMenuItemText = DThemeMenuItemText,\n\tOPTIONS extends DMenuItemTextOptions<VALUE, THEME> = DMenuItemTextOptions<VALUE, THEME>\n> extends DMenuItemText<VALUE, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DMenuItemExpandableItemText\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DisplayObject } from \"pixi.js\";\nimport { DMenuItemCheckIsCompatible } from \"../d-menu-item-check-is-compatible\";\nimport { DMenuItemExpandable } from \"../d-menu-item-expandable\";\nimport { DMenuItemExpandableIsCompatible } from \"../d-menu-item-expandable-is-compatible\";\nimport { DMenuItemExpandableItemCheck } from \"../d-menu-item-expandable-item-check\";\nimport { DMenuItemExpandableItemLink } from \"../d-menu-item-expandable-item-link\";\nimport { DMenuItemExpandableItemSeparator } from \"../d-menu-item-expandable-item-separator\";\nimport { DMenuItemExpandableItemSpace } from \"../d-menu-item-expandable-item-space\";\nimport { DMenuItemExpandableItemText } from \"../d-menu-item-expandable-item-text\";\nimport { DMenuItemExpandables } from \"../d-menu-item-expandables\";\nimport { DMenuItemLinkIsCompatible } from \"../d-menu-item-link-is-compatible\";\nimport { DMenuItemOptionsUnion } from \"../d-menu-item-options-union\";\nimport { DMenuItemSeparatorIsCompatible } from \"../d-menu-item-separator\";\nimport { DMenuItemSpaceIsCompatible } from \"../d-menu-item-space-is-compatible\";\nimport { DMenus } from \"../d-menus\";\n\nexport const loadMenuItemExpandable = (): void => {\n\tDMenus.addItemCreator((options: DMenuItemOptionsUnion<any>): DisplayObject | null => {\n\t\tif (DMenuItemExpandableIsCompatible(options)) {\n\t\t\treturn new DMenuItemExpandable(options);\n\t\t}\n\t\treturn null;\n\t});\n\n\tDMenuItemExpandables.addItemCreator(\n\t\t(options: DMenuItemOptionsUnion<any>): DisplayObject | null => {\n\t\t\tif (DMenuItemCheckIsCompatible(options)) {\n\t\t\t\treturn new DMenuItemExpandableItemCheck(options);\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\t);\n\n\tDMenuItemExpandables.addItemCreator(\n\t\t(options: DMenuItemOptionsUnion<any>): DisplayObject | null => {\n\t\t\tif (DMenuItemLinkIsCompatible(options)) {\n\t\t\t\treturn new DMenuItemExpandableItemLink(options);\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\t);\n\n\tDMenuItemExpandables.addItemCreator(\n\t\t(options: DMenuItemOptionsUnion<any>): DisplayObject | null => {\n\t\t\tif (DMenuItemSeparatorIsCompatible(options)) {\n\t\t\t\treturn new DMenuItemExpandableItemSeparator(options);\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\t);\n\n\tDMenuItemExpandables.addItemCreator(\n\t\t(options: DMenuItemOptionsUnion<any>): DisplayObject | null => {\n\t\t\tif (DMenuItemSpaceIsCompatible(options)) {\n\t\t\t\treturn new DMenuItemExpandableItemSpace(options);\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\t);\n\n\tDMenuItemExpandables.setItemCreatorDefault((options: any): DisplayObject | null => {\n\t\treturn new DMenuItemExpandableItemText(options);\n\t});\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DMenuItemCheck, DMenuItemCheckOptions, DThemeMenuItemCheck } from \"./d-menu-item-check\";\n\nexport class DMenuSidedItemCheck<\n\tVALUE = unknown,\n\tTHEME extends DThemeMenuItemCheck = DThemeMenuItemCheck,\n\tOPTIONS extends DMenuItemCheckOptions<VALUE, THEME> = DMenuItemCheckOptions<VALUE, THEME>\n> extends DMenuItemCheck<VALUE, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DMenuSidedItemCheck\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DMenuItemBaseSelection } from \"./d-menu-item-base-selection\";\nimport { DMenuItemLink, DMenuItemLinkOptions, DThemeMenuItemLink } from \"./d-menu-item-link\";\n\nexport class DMenuSidedItemLink<\n\tVALUE = unknown,\n\tTHEME extends DThemeMenuItemLink = DThemeMenuItemLink,\n\tOPTIONS extends DMenuItemLinkOptions<VALUE, THEME> = DMenuItemLinkOptions<VALUE, THEME>\n> extends DMenuItemLink<VALUE, THEME, OPTIONS> {\n\tprotected getSelection(): DMenuItemBaseSelection | null {\n\t\treturn null;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DMenuSidedItemLink\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DMenu } from \"./d-menu\";\nimport { DMenuItem } from \"./d-menu-item\";\nimport { DMenuItemBaseSelection } from \"./d-menu-item-base-selection\";\nimport { DMenuItemMenu, DMenuItemMenuOptions, DThemeMenuItemMenu } from \"./d-menu-item-menu\";\n\nexport class DMenuSidedItemMenu<\n\tVALUE = unknown,\n\tTHEME extends DThemeMenuItemMenu = DThemeMenuItemMenu,\n\tOPTIONS extends DMenuItemMenuOptions<VALUE, THEME> = DMenuItemMenuOptions<VALUE, THEME>\n> extends DMenuItemMenu<VALUE, THEME, OPTIONS> {\n\tprotected initHover(options: OPTIONS): void {\n\t\t// DO NOTHING\n\t}\n\n\tprotected onMenuSelect(value: VALUE, item: DMenuItem<VALUE>, menu: DMenu<VALUE>): void {\n\t\tsuper.onMenuSelect(value, item, menu);\n\t\tconst selection = super.getSelection();\n\t\tif (selection) {\n\t\t\tselection.add(item);\n\t\t}\n\t}\n\n\tprotected onOpen(menu: DMenu<VALUE>): void {\n\t\tmenu.open(this, this);\n\t}\n\n\tprotected getSelection(): DMenuItemBaseSelection | null {\n\t\treturn null;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DMenuSidedItemMenu\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {\n\tDMenuItemSeparator,\n\tDMenuItemSeparatorOptions,\n\tDThemeMenuItemSeparator\n} from \"./d-menu-item-separator\";\n\nexport class DMenuSidedItemSeparator<\n\tVALUE = unknown,\n\tTHEME extends DThemeMenuItemSeparator = DThemeMenuItemSeparator,\n\tOPTIONS extends DMenuItemSeparatorOptions<VALUE, THEME> = DMenuItemSeparatorOptions<\n\t\tVALUE,\n\t\tTHEME\n\t>\n> extends DMenuItemSeparator<VALUE, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DMenuSidedItemSeparator\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DMenuItemSpace, DMenuItemSpaceOptions, DThemeMenuItemSpace } from \"./d-menu-item-space\";\n\nexport class DMenuSidedItemSpace<\n\tTHEME extends DThemeMenuItemSpace = DThemeMenuItemSpace,\n\tOPTIONS extends DMenuItemSpaceOptions<THEME> = DMenuItemSpaceOptions<THEME>\n> extends DMenuItemSpace<THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DMenuSidedItemSpace\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DMenuItemText, DMenuItemTextOptions, DThemeMenuItemText } from \"./d-menu-item-text\";\n\nexport class DMenuSidedItemText<\n\tVALUE = unknown,\n\tTHEME extends DThemeMenuItemText = DThemeMenuItemText,\n\tOPTIONS extends DMenuItemTextOptions<VALUE, THEME> = DMenuItemTextOptions<VALUE, THEME>\n> extends DMenuItemText<VALUE, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DMenuSidedItemText\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Container, DisplayObject } from \"pixi.js\";\nimport { DMenuItemOptionsUnion } from \"./d-menu-item-options-union\";\nimport { DMenuItemCreator, DMenus } from \"./d-menus\";\n\nexport class DMenuSideds {\n\tprotected static CREATORS: DMenuItemCreator[] = [];\n\tprotected static CREATOR_DEFAULT: DMenuItemCreator | null = null;\n\n\tstatic addItemCreator(creator: DMenuItemCreator): void {\n\t\tthis.CREATORS.push(creator);\n\t}\n\n\tstatic setItemCreatorDefault(creator: DMenuItemCreator): void {\n\t\tthis.CREATOR_DEFAULT = creator;\n\t}\n\n\tstatic newItem<VALUE>(\n\t\toptions: DMenuItemOptionsUnion<VALUE>,\n\t\tsticky: boolean\n\t): DisplayObject | null {\n\t\treturn (\n\t\t\tDMenus.newItemOf(this.CREATORS, this.CREATOR_DEFAULT, options, sticky) ||\n\t\t\tDMenus.newItem(options, sticky)\n\t\t);\n\t}\n\n\tstatic newItems<VALUE>(\n\t\tparent: Container,\n\t\titems: Array<DMenuItemOptionsUnion<VALUE> | DisplayObject>,\n\t\tsticky: boolean\n\t): void {\n\t\tDMenus.newItemsOf(this, parent, items, sticky);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DisplayObject } from \"pixi.js\";\nimport { DMenuItemCheckIsCompatible } from \"../d-menu-item-check-is-compatible\";\nimport { DMenuItemLinkIsCompatible } from \"../d-menu-item-link-is-compatible\";\nimport { DMenuItemMenuIsCompatible } from \"../d-menu-item-menu-is-compatible\";\nimport { DMenuItemMenuToSubMenuOptions } from \"../d-menu-item-menu-to-sub-menu-options\";\nimport { DMenuItemOptionsUnion } from \"../d-menu-item-options-union\";\nimport { DMenuItemSeparatorIsCompatible } from \"../d-menu-item-separator\";\nimport { DMenuItemSpaceIsCompatible } from \"../d-menu-item-space-is-compatible\";\nimport { DMenuSidedItemCheck } from \"../d-menu-sided-item-check\";\nimport { DMenuSidedItemLink } from \"../d-menu-sided-item-link\";\nimport { DMenuSidedItemMenu } from \"../d-menu-sided-item-menu\";\nimport { DMenuSidedItemSeparator } from \"../d-menu-sided-item-separator\";\nimport { DMenuSidedItemSpace } from \"../d-menu-sided-item-space\";\nimport { DMenuSidedItemText } from \"../d-menu-sided-item-text\";\nimport { DMenuSideds } from \"../d-menu-sideds\";\n\nexport const loadMenuSidedItem = (): void => {\n\tDMenuSideds.setItemCreatorDefault((options: any): DisplayObject | null => {\n\t\treturn new DMenuSidedItemText(options);\n\t});\n\n\tDMenuSideds.addItemCreator((options: DMenuItemOptionsUnion<any>): DisplayObject | null => {\n\t\tif (DMenuItemSpaceIsCompatible(options)) {\n\t\t\treturn new DMenuSidedItemSpace(options);\n\t\t}\n\t\treturn null;\n\t});\n\n\tDMenuSideds.addItemCreator((options: DMenuItemOptionsUnion<any>): DisplayObject | null => {\n\t\tif (DMenuItemSeparatorIsCompatible(options)) {\n\t\t\treturn new DMenuSidedItemSeparator(options);\n\t\t}\n\t\treturn null;\n\t});\n\n\tDMenuSideds.addItemCreator(\n\t\t(options: DMenuItemOptionsUnion<any>, sticky: boolean): DisplayObject | null => {\n\t\t\tif (DMenuItemMenuIsCompatible(options)) {\n\t\t\t\treturn new DMenuSidedItemMenu(DMenuItemMenuToSubMenuOptions(options, sticky));\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\t);\n\n\tDMenuSideds.addItemCreator((options: DMenuItemOptionsUnion<any>): DisplayObject | null => {\n\t\tif (DMenuItemLinkIsCompatible(options)) {\n\t\t\treturn new DMenuSidedItemLink(options);\n\t\t}\n\t\treturn null;\n\t});\n\n\tDMenuSideds.addItemCreator((options: DMenuItemOptionsUnion<any>): DisplayObject | null => {\n\t\tif (DMenuItemCheckIsCompatible(options)) {\n\t\t\treturn new DMenuSidedItemCheck(options);\n\t\t}\n\t\treturn null;\n\t});\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Container, DisplayObject } from \"pixi.js\";\nimport { DMenuItemOptionsUnion } from \"./d-menu-item-options-union\";\nimport { DMenuSideds } from \"./d-menu-sideds\";\nimport { DMenuItemCreator, DMenus } from \"./d-menus\";\n\nexport class DMenuSidedItemExpandables {\n\tprotected static CREATORS: DMenuItemCreator[] = [];\n\tprotected static CREATOR_DEFAULT: DMenuItemCreator | null = null;\n\n\tstatic addItemCreator(creator: DMenuItemCreator): void {\n\t\tthis.CREATORS.push(creator);\n\t}\n\n\tstatic setItemCreatorDefault(creator: DMenuItemCreator): void {\n\t\tthis.CREATOR_DEFAULT = creator;\n\t}\n\n\tstatic newItem<VALUE>(\n\t\toptions: DMenuItemOptionsUnion<VALUE>,\n\t\tsticky: boolean\n\t): DisplayObject | null {\n\t\treturn (\n\t\t\tDMenus.newItemOf(this.CREATORS, this.CREATOR_DEFAULT, options, sticky) ||\n\t\t\tDMenuSideds.newItem(options, sticky)\n\t\t);\n\t}\n\n\tstatic newItems<VALUE>(\n\t\tparent: Container,\n\t\titems: Array<DMenuItemOptionsUnion<VALUE> | DisplayObject>,\n\t\tsticky: boolean\n\t): void {\n\t\tDMenus.newItemsOf(this, parent, items, sticky);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Container } from \"pixi.js\";\nimport {\n\tDMenuItemExpandable,\n\tDMenuItemExpandableOptions,\n\tDThemeMenuItemExpandable\n} from \"./d-menu-item-expandable\";\nimport { DMenuSidedItemExpandables } from \"./d-menu-sided-item-expandables\";\n\nexport class DMenuSidedItemExpandable<\n\tVALUE = unknown,\n\tTHEME extends DThemeMenuItemExpandable = DThemeMenuItemExpandable,\n\tOPTIONS extends DMenuItemExpandableOptions<VALUE, THEME> = DMenuItemExpandableOptions<\n\t\tVALUE,\n\t\tTHEME\n\t>\n> extends DMenuItemExpandable<VALUE, THEME, OPTIONS> {\n\tprotected newItems(\n\t\tbody: Container,\n\t\tsticky: boolean,\n\t\ttheme: THEME,\n\t\toptions: OPTIONS | undefined\n\t): void {\n\t\tif (options != null && options.items != null) {\n\t\t\tDMenuSidedItemExpandables.newItems(body, options.items, sticky);\n\t\t}\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DMenuSidedItemExpandable\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DMenuItemCheckOptions, DThemeMenuItemCheck } from \"./d-menu-item-check\";\nimport { DMenuItemExpandableItemCheck } from \"./d-menu-item-expandable-item-check\";\n\nexport class DMenuSidedItemExpandableItemCheck<\n\tVALUE = unknown,\n\tTHEME extends DThemeMenuItemCheck = DThemeMenuItemCheck,\n\tOPTIONS extends DMenuItemCheckOptions<VALUE, THEME> = DMenuItemCheckOptions<VALUE, THEME>\n> extends DMenuItemExpandableItemCheck<VALUE, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DMenuSidedItemExpandableItemCheck\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DMenuItemLink, DMenuItemLinkOptions, DThemeMenuItemLink } from \"./d-menu-item-link\";\n\nexport class DMenuSidedItemExpandableItemLink<\n\tVALUE = unknown,\n\tTHEME extends DThemeMenuItemLink = DThemeMenuItemLink,\n\tOPTIONS extends DMenuItemLinkOptions<VALUE, THEME> = DMenuItemLinkOptions<VALUE, THEME>\n> extends DMenuItemLink<VALUE, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DMenuSidedItemExpandableItemLink\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DMenuItemMenu, DMenuItemMenuOptions, DThemeMenuItemMenu } from \"./d-menu-item-menu\";\n\nexport class DMenuItemExpandableItemMenu<\n\tVALUE = unknown,\n\tTHEME extends DThemeMenuItemMenu = DThemeMenuItemMenu,\n\tOPTIONS extends DMenuItemMenuOptions<VALUE, THEME> = DMenuItemMenuOptions<VALUE, THEME>\n> extends DMenuItemMenu<VALUE, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DMenuItemExpandableItemMenu\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DMenu } from \"./d-menu\";\nimport { DMenuItemExpandableItemMenu } from \"./d-menu-item-expandable-item-menu\";\nimport { DMenuItemMenuOptions, DThemeMenuItemMenu } from \"./d-menu-item-menu\";\n\nexport class DMenuSidedItemExpandableItemMenu<\n\tVALUE = unknown,\n\tTHEME extends DThemeMenuItemMenu = DThemeMenuItemMenu,\n\tOPTIONS extends DMenuItemMenuOptions<VALUE, THEME> = DMenuItemMenuOptions<VALUE, THEME>\n> extends DMenuItemExpandableItemMenu<VALUE, THEME, OPTIONS> {\n\tprotected onOpen(menu: DMenu<VALUE>): void {\n\t\tmenu.open(this, this);\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DMenuSidedItemExpandableItemMenu\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DMenuItemExpandableItemSeparator } from \"./d-menu-item-expandable-item-separator\";\nimport { DMenuItemSeparatorOptions, DThemeMenuItemSeparator } from \"./d-menu-item-separator\";\n\nexport class DMenuSidedItemExpandableItemSeparator<\n\tVALUE = unknown,\n\tTHEME extends DThemeMenuItemSeparator = DThemeMenuItemSeparator,\n\tOPTIONS extends DMenuItemSeparatorOptions<VALUE, THEME> = DMenuItemSeparatorOptions<\n\t\tVALUE,\n\t\tTHEME\n\t>\n> extends DMenuItemExpandableItemSeparator<VALUE, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DMenuSidedItemSeparator\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DMenuItemExpandableItemSpace } from \"./d-menu-item-expandable-item-space\";\nimport { DMenuItemSpaceOptions, DThemeMenuItemSpace } from \"./d-menu-item-space\";\n\nexport class DMenuSidedItemExpandableItemSpace<\n\tTHEME extends DThemeMenuItemSpace = DThemeMenuItemSpace,\n\tOPTIONS extends DMenuItemSpaceOptions<THEME> = DMenuItemSpaceOptions<THEME>\n> extends DMenuItemExpandableItemSpace<THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DMenuSidedItemExpandableItemSpace\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DMenuItemExpandableItemText } from \"./d-menu-item-expandable-item-text\";\nimport { DMenuItemTextOptions, DThemeMenuItemText } from \"./d-menu-item-text\";\n\nexport class DMenuSidedItemExpandableItemText<\n\tVALUE = unknown,\n\tTHEME extends DThemeMenuItemText = DThemeMenuItemText,\n\tOPTIONS extends DMenuItemTextOptions<VALUE, THEME> = DMenuItemTextOptions<VALUE, THEME>\n> extends DMenuItemExpandableItemText<VALUE, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DMenuSidedItemExpandableItemText\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DisplayObject } from \"pixi.js\";\nimport { DMenuItemCheckIsCompatible } from \"../d-menu-item-check-is-compatible\";\nimport { DMenuItemExpandableIsCompatible } from \"../d-menu-item-expandable-is-compatible\";\nimport { DMenuItemLinkIsCompatible } from \"../d-menu-item-link-is-compatible\";\nimport { DMenuItemMenuIsCompatible } from \"../d-menu-item-menu-is-compatible\";\nimport { DMenuItemMenuToSubMenuOptions } from \"../d-menu-item-menu-to-sub-menu-options\";\nimport { DMenuItemOptionsUnion } from \"../d-menu-item-options-union\";\nimport { DMenuItemSeparatorIsCompatible } from \"../d-menu-item-separator\";\nimport { DMenuItemSpaceIsCompatible } from \"../d-menu-item-space-is-compatible\";\nimport { DMenuSidedItemExpandable } from \"../d-menu-sided-item-expandable\";\nimport { DMenuSidedItemExpandableItemCheck } from \"../d-menu-sided-item-expandable-item-check\";\nimport { DMenuSidedItemExpandableItemLink } from \"../d-menu-sided-item-expandable-item-link\";\nimport { DMenuSidedItemExpandableItemMenu } from \"../d-menu-sided-item-expandable-item-menu\";\nimport { DMenuSidedItemExpandableItemSeparator } from \"../d-menu-sided-item-expandable-item-separator\";\nimport { DMenuSidedItemExpandableItemSpace } from \"../d-menu-sided-item-expandable-item-space\";\nimport { DMenuSidedItemExpandableItemText } from \"../d-menu-sided-item-expandable-item-text\";\nimport { DMenuSidedItemExpandables } from \"../d-menu-sided-item-expandables\";\nimport { DMenuSideds } from \"../d-menu-sideds\";\n\nexport const loadMenuSidedItemExpandable = (): void => {\n\tDMenuSideds.addItemCreator((options: DMenuItemOptionsUnion<any>): DisplayObject | null => {\n\t\tif (DMenuItemExpandableIsCompatible(options)) {\n\t\t\treturn new DMenuSidedItemExpandable(options);\n\t\t}\n\t\treturn null;\n\t});\n\n\tDMenuSidedItemExpandables.addItemCreator(\n\t\t(options: DMenuItemOptionsUnion<any>): DisplayObject | null => {\n\t\t\tif (DMenuItemCheckIsCompatible(options)) {\n\t\t\t\treturn new DMenuSidedItemExpandableItemCheck(options);\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\t);\n\n\tDMenuSidedItemExpandables.addItemCreator(\n\t\t(options: DMenuItemOptionsUnion<any>): DisplayObject | null => {\n\t\t\tif (DMenuItemLinkIsCompatible(options)) {\n\t\t\t\treturn new DMenuSidedItemExpandableItemLink(options);\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\t);\n\n\tDMenuSidedItemExpandables.addItemCreator(\n\t\t(options: DMenuItemOptionsUnion<any>, sticky: boolean): DisplayObject | null => {\n\t\t\tif (DMenuItemMenuIsCompatible(options)) {\n\t\t\t\treturn new DMenuSidedItemExpandableItemMenu(\n\t\t\t\t\tDMenuItemMenuToSubMenuOptions(options, sticky)\n\t\t\t\t);\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\t);\n\n\tDMenuSidedItemExpandables.addItemCreator(\n\t\t(options: DMenuItemOptionsUnion<any>): DisplayObject | null => {\n\t\t\tif (DMenuItemSeparatorIsCompatible(options)) {\n\t\t\t\treturn new DMenuSidedItemExpandableItemSeparator(options);\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\t);\n\n\tDMenuSidedItemExpandables.addItemCreator(\n\t\t(options: DMenuItemOptionsUnion<any>): DisplayObject | null => {\n\t\t\tif (DMenuItemSpaceIsCompatible(options)) {\n\t\t\t\treturn new DMenuSidedItemExpandableItemSpace(options);\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\t);\n\n\tDMenuSidedItemExpandables.setItemCreatorDefault((options: any): DisplayObject | null => {\n\t\treturn new DMenuSidedItemExpandableItemText(options);\n\t});\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { loadMenuItem } from \"./load-menu-item\";\nimport { loadMenuItemExpandable } from \"./load-menu-item-expandable\";\nimport { loadMenuSidedItem } from \"./load-menu-sided-item\";\nimport { loadMenuSidedItemExpandable } from \"./load-menu-sided-item-expandable\";\n\nexport const loadMenuItemAll = (): void => {\n\tloadMenuItem();\n\tloadMenuItemExpandable();\n\tloadMenuSidedItem();\n\tloadMenuSidedItemExpandable();\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { loadShapeAll } from \"../shape/load/load-shape-all\";\nimport { loadMenuItemAll } from \"./load-menu-item-all\";\n\nexport const loadAll = (): void => {\n\tloadMenuItemAll();\n\tloadShapeAll();\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"./e-shape\";\nimport { EShapeContainer } from \"./e-shape-container\";\nimport { EShapeType } from \"./e-shape-type\";\nimport { EShapeBase } from \"./variant/e-shape-base\";\n\n/**\n * {@link EShape} search utility.\n */\nexport class EShapeSearch {\n\tstatic COMPARATOR_INDEX = (a: EShape, b: EShape): number => {\n\t\treturn a.index - b.index;\n\t};\n\n\t/**\n\t * Returns indices of the given shapes.\n\t *\n\t * @param shapes shapes\n\t * @return indices\n\t */\n\tstatic toIndices(shapes: EShape[]): number[] {\n\t\tconst result = [];\n\t\tfor (let i = 0, imax = shapes.length; i < imax; ++i) {\n\t\t\tresult.push(shapes[i].index);\n\t\t}\n\t\treturn result;\n\t}\n\n\t/**\n\t * Returns a depth of the given shape.\n\t *\n\t * @param shape a shape\n\t * @return a depth\n\t */\n\tstatic toDepth(shape: EShape): number {\n\t\tlet result = 0;\n\t\tlet parent = shape.parent;\n\t\twhile (parent instanceof EShapeBase) {\n\t\t\tresult += 1;\n\t\t\tparent = parent.parent;\n\t\t}\n\t\treturn result;\n\t}\n\n\t/**\n\t * Returns a deepest shape on the path to the given shapes.\n\t *\n\t * @param shapeA a shape\n\t * @param shapeB a shape\n\t * @return a found shape\n\t */\n\tstatic toSharedParent(shapeA: EShape, shapeB: EShape): EShape | EShapeContainer {\n\t\tconst depthA = this.toDepth(shapeA);\n\t\tconst depthB = this.toDepth(shapeB);\n\t\tif (depthA < depthB) {\n\t\t\tlet parent = shapeA.parent;\n\t\t\twhile (parent instanceof EShapeBase) {\n\t\t\t\tif (this.isParent(shapeB, parent)) {\n\t\t\t\t\treturn parent;\n\t\t\t\t}\n\t\t\t\tparent = parent.parent;\n\t\t\t}\n\t\t\treturn parent!;\n\t\t} else {\n\t\t\tlet parent = shapeB.parent;\n\t\t\twhile (parent instanceof EShapeBase) {\n\t\t\t\tif (this.isParent(shapeA, parent)) {\n\t\t\t\t\treturn parent;\n\t\t\t\t}\n\t\t\t\tparent = parent.parent;\n\t\t\t}\n\t\t\treturn parent!;\n\t\t}\n\t}\n\n\t/**\n\t * Returns a shape on the path to the given shape whose parent is equals to the given parent.\n\t * If there is no such shape, returns a root shape on the path.\n\t *\n\t * @param shape a shape\n\t * @param parent a parent\n\t * @returns a found shape\n\t */\n\tstatic toOfParent(shape: EShape, parent: EShape | EShapeContainer): EShape {\n\t\tlet shapeParent = shape.parent;\n\t\twhile (shapeParent !== parent && shapeParent instanceof EShapeBase) {\n\t\t\tshape = shapeParent;\n\t\t\tshapeParent = shapeParent.parent;\n\t\t}\n\t\treturn shape;\n\t}\n\n\t/**\n\t * Returns true if the given target is on the path to the given shape.\n\t *\n\t * @param shape a shape\n\t * @param target a check target\n\t * @return true if the given target is on the path to the given shape\n\t */\n\tstatic isParent(shape: EShape, target: EShape | null): boolean {\n\t\tlet parent = shape.parent;\n\t\twhile (parent instanceof EShapeBase) {\n\t\t\tif (parent === target) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tparent = parent.parent;\n\t\t}\n\t\treturn false;\n\t}\n\n\t/**\n\t * Returns a selected shape on the path to the given shape.\n\t * If there are more than one selected shapes, returns a deepest selected shape.\n\t *\n\t * @param shape a shape\n\t * @return a found selected shape or null\n\t */\n\tstatic toSelected(shape: EShape): EShape | null {\n\t\tlet target: EShape | EShapeContainer | null = shape;\n\t\twhile (target instanceof EShapeBase) {\n\t\t\tif (target.selected) {\n\t\t\t\treturn target;\n\t\t\t}\n\t\t\ttarget = target.parent;\n\t\t}\n\t\treturn null;\n\t}\n\n\tstatic findChildById(\n\t\tshape: { children: EShape[] },\n\t\tid: string,\n\t\trecursively?: boolean\n\t): EShape | null {\n\t\tconst children = shape.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tconst child = children[i];\n\t\t\tif (child.id === id) {\n\t\t\t\treturn child;\n\t\t\t}\n\t\t\tif (recursively === true) {\n\t\t\t\tconst result = EShapeSearch.findChildById(child, id, recursively);\n\t\t\t\tif (result != null) {\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tstatic findChildByType(\n\t\tshape: { children: EShape[] },\n\t\ttype: EShapeType,\n\t\trecursively?: boolean\n\t): EShape | null {\n\t\tconst children = shape.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tconst child = children[i];\n\t\t\tif (child.type === type) {\n\t\t\t\treturn child;\n\t\t\t}\n\t\t\tif (recursively === true) {\n\t\t\t\tconst result = EShapeSearch.findChildByType(child, type, recursively);\n\t\t\t\tif (result != null) {\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tstatic findChild(\n\t\tshape: { children: EShape[] },\n\t\tmatcher: (shape: EShape) => boolean,\n\t\trecursively?: boolean\n\t): EShape | null {\n\t\tconst children = shape.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tconst child = children[i];\n\t\t\tif (matcher(child)) {\n\t\t\t\treturn child;\n\t\t\t}\n\t\t\tif (recursively === true) {\n\t\t\t\tconst result = EShapeSearch.findChild(child, matcher, recursively);\n\t\t\t\tif (result != null) {\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tstatic findChildrenByType(\n\t\tshape: { children: EShape[] },\n\t\ttype: EShapeType,\n\t\trecursively?: boolean,\n\t\tresult?: EShape[]\n\t): EShape[] {\n\t\tresult = result || [];\n\t\tconst children = shape.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tconst child = children[i];\n\t\t\tif (child.type === type) {\n\t\t\t\tresult.push(child);\n\t\t\t}\n\t\t\tif (recursively === true) {\n\t\t\t\tEShapeSearch.findChildrenByType(child, type, recursively, result);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tstatic findChildren(\n\t\tshape: { children: EShape[] },\n\t\tmatcher: (shape: EShape) => boolean,\n\t\trecursively?: boolean,\n\t\tresult?: EShape[]\n\t): EShape[] {\n\t\tresult = result || [];\n\t\tconst children = shape.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tconst child = children[i];\n\t\t\tif (matcher(child)) {\n\t\t\t\tresult.push(child);\n\t\t\t}\n\t\t\tif (recursively === true) {\n\t\t\t\tEShapeSearch.findChildren(child, matcher, recursively, result);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShape } from \"./e-shape\";\nimport { EShapeContainer } from \"./e-shape-container\";\nimport { EShapeSearch } from \"./e-shape-search\";\n\nexport class EShapeDeleter {\n\tstatic delete(\n\t\tparent: EShape | EShapeContainer,\n\t\tshapes?: EShape[],\n\t\tgenerateListOfDetachedShapes?: boolean\n\t): EShape[] | null {\n\t\tconst children = parent.children;\n\t\tconst length = children.length;\n\n\t\t// Update indices\n\t\tfor (let i = 0; i < length; ++i) {\n\t\t\tconst child = children[i];\n\t\t\tif (child.selected) {\n\t\t\t\tchild.index = length + i;\n\t\t\t} else {\n\t\t\t\tchild.index = i;\n\t\t\t}\n\t\t}\n\n\t\t// Sort\n\t\tchildren.sort(EShapeSearch.COMPARATOR_INDEX);\n\n\t\t// Detach\n\t\tif (generateListOfDetachedShapes === true) {\n\t\t\tfor (let i = length - 1; 0 <= i; --i) {\n\t\t\t\tconst child = children[i];\n\t\t\t\tif (child.selected) {\n\t\t\t\t\tchild.index -= length;\n\t\t\t\t\tchild.parent = null;\n\t\t\t\t\tchild.selected = false;\n\t\t\t\t\tchild.uploaded = undefined;\n\t\t\t\t\tchild.onDetach();\n\t\t\t\t} else {\n\t\t\t\t\tconst size = children.length - (i + 1);\n\t\t\t\t\tif (0 < size) {\n\t\t\t\t\t\tconst result = children.splice(i + 1, size);\n\t\t\t\t\t\tif (shapes != null) {\n\t\t\t\t\t\t\tshapes.length = 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tparent.onChildTransformChange();\n\t\t\t\t\t\tparent.toDirty();\n\t\t\t\t\t\treturn result;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (shapes != null) {\n\t\t\t\t\t\t\tshapes.length = 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (0 < children.length) {\n\t\t\t\tconst result = children.splice(0, children.length);\n\t\t\t\tif (shapes != null) {\n\t\t\t\t\tshapes.length = 0;\n\t\t\t\t}\n\t\t\t\tparent.onChildTransformChange();\n\t\t\t\tparent.toDirty();\n\t\t\t\treturn result;\n\t\t\t} else {\n\t\t\t\tif (shapes != null) {\n\t\t\t\t\tshapes.length = 0;\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t}\n\t\t} else {\n\t\t\tfor (let i = length - 1; 0 <= i; --i) {\n\t\t\t\tconst child = children[i];\n\t\t\t\tif (child.selected) {\n\t\t\t\t\tchild.parent = null;\n\t\t\t\t\tchild.selected = false;\n\t\t\t\t\tchild.uploaded = undefined;\n\t\t\t\t\tchild.onDetach();\n\t\t\t\t} else {\n\t\t\t\t\tchildren.length = i + 1;\n\t\t\t\t\tif (shapes != null) {\n\t\t\t\t\t\tshapes.length = 0;\n\t\t\t\t\t}\n\t\t\t\t\tparent.onChildTransformChange();\n\t\t\t\t\tparent.toDirty();\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (0 < children.length) {\n\t\t\t\tchildren.length = 0;\n\t\t\t\tif (shapes != null) {\n\t\t\t\t\tshapes.length = 0;\n\t\t\t\t}\n\t\t\t\tparent.onChildTransformChange();\n\t\t\t\tparent.toDirty();\n\t\t\t} else {\n\t\t\t\tif (shapes != null) {\n\t\t\t\t\tshapes.length = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\t}\n}\n","import { isNumber } from \"../util/is-number\";\nimport { isString } from \"../util/is-string\";\nimport { EShapePointsStyle } from \"./e-shape-points-style\";\n\nexport type EShapePointsStyleOption =\n\t| EShapePointsStyle\n\t| keyof typeof EShapePointsStyle\n\t| Array<keyof typeof EShapePointsStyle>;\n\nexport class EShapePointsStyles {\n\tstatic from(style: EShapePointsStyleOption | undefined): EShapePointsStyle {\n\t\tif (isString(style)) {\n\t\t\treturn EShapePointsStyle[style];\n\t\t} else if (isNumber(style)) {\n\t\t\treturn style;\n\t\t} else if (style != null) {\n\t\t\tlet result = EShapePointsStyle.NONE;\n\t\t\tfor (let i = 0, imax = style.length; i < imax; ++i) {\n\t\t\t\tresult |= EShapePointsStyle[style[i]];\n\t\t\t}\n\t\t\treturn result;\n\t\t} else {\n\t\t\treturn EShapePointsStyle.NONE;\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport class EShapeResourceManagerSerialization {\n\tresources: string[];\n\tdata: string[];\n\tpieces: string[];\n\tprotected resourceToIndex: Map<string, number>;\n\tprotected dataToIndex: Map<string, number>;\n\tprotected pieceToIndex: Map<string, number>;\n\tprotected uuids: Set<number>;\n\tprotected uuidNext: number;\n\n\tconstructor() {\n\t\tthis.resources = [];\n\t\tthis.resourceToIndex = new Map<string, number>();\n\t\tthis.data = [];\n\t\tthis.dataToIndex = new Map<string, number>();\n\t\tthis.pieces = [];\n\t\tthis.pieceToIndex = new Map<string, number>();\n\t\tthis.uuids = new Set<number>();\n\t\tthis.uuidNext = 0;\n\t}\n\n\taddResource(resource: string): number {\n\t\treturn this.add_(resource, this.resources, this.resourceToIndex);\n\t}\n\n\taddData(data: string): number {\n\t\treturn this.add_(data, this.data, this.dataToIndex);\n\t}\n\n\taddPiece(piece: string): number {\n\t\treturn this.add_(piece, this.pieces, this.pieceToIndex);\n\t}\n\n\taddUuid(uuid: number): number {\n\t\tif (uuid !== 0) {\n\t\t\tconst uuids = this.uuids;\n\t\t\tif (uuids.has(uuid)) {\n\t\t\t\treturn 0;\n\t\t\t} else {\n\t\t\t\tuuids.add(uuid);\n\t\t\t\treturn uuid;\n\t\t\t}\n\t\t}\n\t\treturn 0;\n\t}\n\n\tupdateUuid(uuid: number): number {\n\t\tconst uuids = this.uuids;\n\t\tif (uuid !== 0) {\n\t\t\treturn uuid;\n\t\t} else {\n\t\t\tconst newUuid = this.newUuid();\n\t\t\tuuids.add(newUuid);\n\t\t\treturn newUuid;\n\t\t}\n\t}\n\n\tnewUuid(): number {\n\t\tconst uuids = this.uuids;\n\t\tlet uuidNext = this.uuidNext;\n\t\twhile (true) {\n\t\t\tuuidNext += 1;\n\t\t\tif (uuidNext !== 0 && !uuids.has(uuidNext)) {\n\t\t\t\tthis.uuidNext = uuidNext;\n\t\t\t\treturn uuidNext;\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected add_(target: string, array: string[], map: Map<string, number>): number {\n\t\tconst result = map.get(target);\n\t\tif (result != null) {\n\t\t\treturn result;\n\t\t}\n\t\tconst index = array.length;\n\t\tarray.push(target);\n\t\tmap.set(target, index);\n\t\treturn index;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { utils } from \"pixi.js\";\nimport { DDiagramSerializedSnapGrid } from \"../d-diagram-serialized\";\nimport { ESnapperResult } from \"./e-snapper-result\";\n\nexport class ESnapperGrid extends utils.EventEmitter {\n\tprotected _isEnabled: boolean;\n\tprotected _size: number;\n\tprotected _isVisible: boolean;\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis._isVisible = true;\n\t\tthis._isEnabled = true;\n\t\tthis._size = 10;\n\t}\n\n\tget visible(): boolean {\n\t\treturn this._isVisible;\n\t}\n\n\tset visible(visible: boolean) {\n\t\tif (this._isVisible !== visible) {\n\t\t\tthis._isVisible = visible;\n\t\t\tthis.emit(\"change\", this);\n\t\t}\n\t}\n\n\tget enable(): boolean {\n\t\treturn this._isEnabled;\n\t}\n\n\tset enable(enable: boolean) {\n\t\tif (this._isEnabled !== enable) {\n\t\t\tthis._isEnabled = enable;\n\t\t\tthis.emit(\"change\", this);\n\t\t}\n\t}\n\n\tget size(): number {\n\t\treturn this._size;\n\t}\n\n\tset size(size: number) {\n\t\tif (this._size !== size) {\n\t\t\tthis._size = size;\n\t\t\tthis.emit(\"change\", size, this);\n\t\t}\n\t}\n\n\tsnap(value: number, result: ESnapperResult): void {\n\t\tif (this._isEnabled) {\n\t\t\tconst size = this._size;\n\t\t\tresult.set(value, Math.round(value / size) * size);\n\t\t}\n\t}\n\n\treset(): void {\n\t\tthis._isEnabled = true;\n\t\tthis._size = 10;\n\t\tthis.emit(\"change\", this);\n\t}\n\n\tserialize(): DDiagramSerializedSnapGrid {\n\t\treturn [this._isEnabled ? 1 : 0, this._isVisible ? 1 : 0, this._size];\n\t}\n\n\tdeserialize(serialized: DDiagramSerializedSnapGrid): void {\n\t\tthis.enable = !!serialized[0];\n\t\tif (2 in serialized) {\n\t\t\tthis.visible = !!serialized[1];\n\t\t\tthis.size = (serialized as any)[2];\n\t\t} else {\n\t\t\tthis.visible = false;\n\t\t\tthis.size = serialized[1];\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport class ESnapperResult {\n\tdistance: number;\n\tresult: number;\n\tthreshold: number;\n\n\tconstructor() {\n\t\tthis.distance = NaN;\n\t\tthis.result = 0;\n\t\tthis.threshold = 10;\n\t}\n\n\treset(value: number, scale: number): void {\n\t\tthis.distance = NaN;\n\t\tthis.result = value;\n\t\tthis.threshold = 0.0001 < scale ? 10 / scale : 10;\n\t}\n\n\tset(value: number, snapped: number): void {\n\t\tconst newDistance = Math.abs(snapped - value);\n\t\tif (newDistance <= this.threshold) {\n\t\t\tconst oldDistance = this.distance;\n\t\t\tif (oldDistance !== oldDistance || newDistance < oldDistance) {\n\t\t\t\tthis.distance = newDistance;\n\t\t\t\tthis.result = snapped;\n\t\t\t}\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDiagramSerializedSnapTargetValue } from \"../d-diagram-serialized\";\n\nexport const ESnapperTargetValueType = {\n\tHORIZONTAL: 0,\n\tVERTICAL: 1\n} as const;\n\nexport type ESnapperTargetValueType =\n\ttypeof ESnapperTargetValueType[keyof typeof ESnapperTargetValueType];\n\nexport class ESnapperTargetValue {\n\ttype: ESnapperTargetValueType;\n\tposition: number;\n\n\tconstructor(type: ESnapperTargetValueType, position: number) {\n\t\tthis.type = type;\n\t\tthis.position = position;\n\t}\n\n\tserialize(): DDiagramSerializedSnapTargetValue {\n\t\treturn [this.type, this.position];\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { utils } from \"pixi.js\";\nimport {\n\tDDiagramSerializedSnapTarget,\n\tDDiagramSerializedSnapTargetValue\n} from \"../d-diagram-serialized\";\nimport { ESnapperResult } from \"./e-snapper-result\";\nimport { ESnapperTargetValue, ESnapperTargetValueType } from \"./e-snapper-target-value\";\n\nexport class ESnapperTarget extends utils.EventEmitter {\n\tvalues: ESnapperTargetValue[];\n\tprotected _isVisible: boolean;\n\tprotected _isEnabled: boolean;\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis.values = [];\n\t\tthis._isVisible = true;\n\t\tthis._isEnabled = true;\n\t}\n\n\tget enable(): boolean {\n\t\treturn this._isEnabled;\n\t}\n\n\tset enable(enable: boolean) {\n\t\tif (this._isEnabled !== enable) {\n\t\t\tthis._isEnabled = enable;\n\t\t\tthis.emit(\"change\", this);\n\t\t}\n\t}\n\n\tget visible(): boolean {\n\t\treturn this._isVisible;\n\t}\n\n\tset visible(visible: boolean) {\n\t\tif (this._isVisible !== visible) {\n\t\t\tthis._isVisible = visible;\n\t\t\tthis.emit(\"change\", this);\n\t\t}\n\t}\n\n\tget size(): number {\n\t\treturn this.values.length;\n\t}\n\n\tadd(target: ESnapperTargetValue, index?: number): void {\n\t\tif (index != null) {\n\t\t\tthis.values.splice(index, 0, target);\n\t\t} else {\n\t\t\tthis.values.push(target);\n\t\t}\n\t\tthis.emit(\"change\", this);\n\t}\n\n\tremove(index: number): void {\n\t\tconst values = this.values;\n\t\tif (0 <= index && index < values.length) {\n\t\t\tvalues.splice(index, 1);\n\t\t\tthis.emit(\"change\", this);\n\t\t}\n\t}\n\n\treplace(index: number, value: ESnapperTargetValue): ESnapperTargetValue | null {\n\t\tconst values = this.values;\n\t\tif (0 <= index && index < values.length) {\n\t\t\tconst result = values[index];\n\t\t\tvalues[index] = value;\n\t\t\tthis.emit(\"change\", this);\n\t\t\treturn result;\n\t\t}\n\t\treturn null;\n\t}\n\n\tswap(indexA: number, indexB: number): void {\n\t\tif (indexA !== indexB) {\n\t\t\tconst values = this.values;\n\t\t\tconst valueA = values[indexA];\n\t\t\tvalues[indexA] = values[indexB];\n\t\t\tvalues[indexB] = valueA;\n\t\t\tthis.emit(\"change\", this);\n\t\t}\n\t}\n\n\tsnap(px: number, py: number, x: ESnapperResult, y: ESnapperResult): void {\n\t\tif (this._isEnabled) {\n\t\t\tconst values = this.values;\n\t\t\tfor (let i = 0, imax = values.length; i < imax; ++i) {\n\t\t\t\tconst value = values[i];\n\t\t\t\tif (value.type === ESnapperTargetValueType.VERTICAL) {\n\t\t\t\t\tx.set(px, value.position);\n\t\t\t\t} else {\n\t\t\t\t\ty.set(py, value.position);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treset(): void {\n\t\tthis._isEnabled = true;\n\t\tthis._isVisible = true;\n\t\tthis.values.length = 0;\n\t\tthis.emit(\"change\", this);\n\t}\n\n\tserialize(): DDiagramSerializedSnapTarget {\n\t\tconst targets: DDiagramSerializedSnapTargetValue[] = [];\n\t\tconst values = this.values;\n\t\tfor (let i = 0, imax = values.length; i < imax; ++i) {\n\t\t\ttargets.push(values[i].serialize());\n\t\t}\n\t\treturn [this._isEnabled ? 1 : 0, this._isVisible ? 1 : 0, targets];\n\t}\n\n\tdeserialize(serialized: DDiagramSerializedSnapTarget): void {\n\t\t// Availability\n\t\tthis._isEnabled = !!serialized[0];\n\n\t\t// Visibility\n\t\tthis._isVisible = !!serialized[1];\n\n\t\t// Values\n\t\tconst sources = serialized[2];\n\t\tconst values = this.values;\n\t\tvalues.length = 0;\n\t\tfor (let i = 0, imax = sources.length; i < imax; ++i) {\n\t\t\tconst source = sources[i];\n\t\t\tvalues.push(new ESnapperTargetValue(source[0], source[1]));\n\t\t}\n\t\tthis.emit(\"change\", this);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DisplayObject, IPoint, Matrix, Point, Rectangle, utils } from \"pixi.js\";\nimport { DDiagramSerializedSnap } from \"../d-diagram-serialized\";\nimport { isNaN } from \"../util/is-nan\";\nimport { ESnapperGrid } from \"./e-snapper-grid\";\nimport { ESnapperResult } from \"./e-snapper-result\";\nimport { ESnapperResultScale } from \"./e-snapper-result-scale\";\nimport { ESnapperTarget } from \"./e-snapper-target\";\n\nconst EPSILON = 0.00001;\n\nexport interface ESnapperModifier extends DisplayObject {\n\twidth: number;\n\theight: number;\n}\n\nexport const ESnapperModifierAnchor = {\n\tNONE: 0,\n\tTOP_LEFT: 1,\n\tTOP_CENTER: 2,\n\tTOP_RIGHT: 3,\n\tMIDDLE_LEFT: 4,\n\tMIDDLE_RIGHT: 5,\n\tBOTTOM_LEFT: 6,\n\tBOTTOM_CENTER: 7,\n\tBOTTOM_RIGHT: 8,\n\tROTATION: 9\n} as const;\n\nexport type ESnapperModifierAnchor =\n\ttypeof ESnapperModifierAnchor[keyof typeof ESnapperModifierAnchor];\n\nexport interface ESnapperParentCanvas {\n\tscale: {\n\t\tx: number;\n\t\ty: number;\n\t};\n\twidth: number;\n\theight: number;\n}\n\nexport interface ESnapperParent {\n\tcanvas: ESnapperParentCanvas | null;\n}\n\nexport class ESnapper extends utils.EventEmitter {\n\tprotected _points: Point[];\n\tprotected _normals: Point[];\n\tprotected _lengths: number[];\n\n\tprotected _workScale: Point;\n\tprotected _workScaleResult: ESnapperResultScale;\n\n\tprotected _workTranslate: Point;\n\n\tprotected _workSnap: Point;\n\tprotected _workSnapRectangle: Rectangle;\n\tprotected _workSnapResultX: ESnapperResult;\n\tprotected _workSnapResultY: ESnapperResult;\n\n\tprotected _parent: ESnapperParent;\n\n\tprotected _isEnabled: boolean;\n\n\tgrid: ESnapperGrid;\n\n\ttarget: ESnapperTarget;\n\n\tconstructor(parent: ESnapperParent) {\n\t\tsuper();\n\n\t\tthis._points = [\n\t\t\tnew Point(), // Top left\n\t\t\tnew Point(), // Top right\n\t\t\tnew Point(), // Bottom left\n\t\t\tnew Point(), // Bottom right\n\t\t\tnew Point() // Center\n\t\t];\n\n\t\tthis._normals = [new Point(), new Point()];\n\n\t\tthis._lengths = [1, 1];\n\n\t\tthis._workScale = new Point();\n\t\tthis._workSnapResultX = new ESnapperResult();\n\t\tthis._workSnapResultY = new ESnapperResult();\n\t\tthis._workScaleResult = {\n\t\t\tdistance: 0,\n\t\t\tscale: new Point()\n\t\t};\n\n\t\tthis._workTranslate = new Point();\n\n\t\tthis._workSnapRectangle = new Rectangle();\n\t\tthis._workSnap = new Point();\n\n\t\t// Grid\n\t\tthis.grid = new ESnapperGrid();\n\n\t\t// Target\n\t\tthis.target = new ESnapperTarget();\n\n\t\t//\n\t\tthis._parent = parent;\n\t\tthis._isEnabled = true;\n\t}\n\n\tget enable(): boolean {\n\t\treturn this._isEnabled;\n\t}\n\n\tset enable(enable: boolean) {\n\t\tif (this._isEnabled !== enable) {\n\t\t\tthis._isEnabled = enable;\n\t\t\tthis.emit(\"change\", this);\n\t\t}\n\t}\n\n\tprotected prepare(modifier: ESnapperModifier): void {\n\t\tmodifier.updateTransform();\n\t\tconst localTransform = modifier.transform.localTransform;\n\t\tconst sx = modifier.width;\n\t\tconst sy = modifier.height;\n\n\t\tconst points = this._points;\n\t\tpoints[0].set(0, 0);\n\t\tpoints[1].set(sx, 0);\n\t\tpoints[2].set(sx, sy);\n\t\tpoints[3].set(0, sy);\n\t\tpoints[4].set(sx * 0.5, sy * 0.5);\n\n\t\tlocalTransform.apply(points[0], points[0]);\n\t\tlocalTransform.apply(points[1], points[1]);\n\t\tlocalTransform.apply(points[2], points[2]);\n\t\tlocalTransform.apply(points[3], points[3]);\n\t\tlocalTransform.apply(points[4], points[4]);\n\t}\n\n\tprepareForTranslate(modifier: ESnapperModifier): void {\n\t\tif (this._isEnabled) {\n\t\t\tthis.prepare(modifier);\n\t\t}\n\t}\n\n\tprotected snap(point: IPoint, result: IPoint): IPoint {\n\t\tconst px = point.x;\n\t\tconst py = point.y;\n\t\tconst canvas = this._parent.canvas;\n\t\tconst x = this._workSnapResultX;\n\t\tconst y = this._workSnapResultY;\n\n\t\t// Canvas\n\t\tif (canvas != null) {\n\t\t\tconst scale = Math.max(canvas.scale.x, canvas.scale.y);\n\t\t\tx.reset(px, scale);\n\t\t\ty.reset(py, scale);\n\t\t\tx.set(px, 0);\n\t\t\tx.set(px, canvas.width);\n\t\t\ty.set(py, 0);\n\t\t\ty.set(py, canvas.height);\n\t\t} else {\n\t\t\tx.reset(px, 1);\n\t\t\ty.reset(py, 1);\n\t\t}\n\n\t\t// Target\n\t\tthis.target.snap(px, py, x, y);\n\n\t\t// Grid\n\t\tthis.grid.snap(px, x);\n\t\tthis.grid.snap(py, y);\n\n\t\t//\n\t\tresult.x = isNaN(x.distance) ? NaN : x.result;\n\t\tresult.y = isNaN(y.distance) ? NaN : y.result;\n\t\treturn result;\n\t}\n\n\ttoSnapped(point: IPoint, result: IPoint): IPoint {\n\t\tconst px = point.x;\n\t\tconst py = point.y;\n\t\tif (this._isEnabled) {\n\t\t\tthis.snap(point, result);\n\t\t\tconst x = result.x;\n\t\t\tconst y = result.y;\n\t\t\tresult.set(isNaN(x) ? px : x, isNaN(y) ? py : y);\n\t\t} else {\n\t\t\tresult.set(px, py);\n\t\t}\n\t\treturn result;\n\t}\n\n\ttoTranslationSnapped(delta: IPoint, result: IPoint): IPoint {\n\t\tconst dx = delta.x;\n\t\tconst dy = delta.y;\n\t\tlet x = NaN;\n\t\tlet y = NaN;\n\t\tif (this._isEnabled) {\n\t\t\tconst workTranslate = this._workTranslate;\n\t\t\tconst points = this._points;\n\t\t\tfor (let i = 0, imax = points.length; i < imax; ++i) {\n\t\t\t\tconst point = points[i];\n\t\t\t\tworkTranslate.set(point.x + dx, point.y + dy);\n\t\t\t\tthis.snap(workTranslate, workTranslate);\n\n\t\t\t\t// X\n\t\t\t\tif (!isNaN(workTranslate.x)) {\n\t\t\t\t\tconst newDx = workTranslate.x - point.x;\n\t\t\t\t\tif (isNaN(x) || Math.abs(newDx - dx) < Math.abs(x - dx)) {\n\t\t\t\t\t\tx = newDx;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Y\n\t\t\t\tif (!isNaN(workTranslate.y)) {\n\t\t\t\t\tconst newDy = workTranslate.y - point.y;\n\t\t\t\t\tif (isNaN(y) || Math.abs(newDy - dy) < Math.abs(y - dy)) {\n\t\t\t\t\t\ty = newDy;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tresult.x = isNaN(x) ? dx : x;\n\t\tresult.y = isNaN(y) ? dy : y;\n\t\treturn result;\n\t}\n\n\tprepareForRotate(modifier: ESnapperModifier): void {\n\t\t//\n\t}\n\n\tprotected getGridSizeRotation(): number {\n\t\treturn 5;\n\t}\n\n\tprotected toRadian(value: number): number {\n\t\treturn (value / 180) * Math.PI;\n\t}\n\n\tprotected toDegree(value: number): number {\n\t\treturn (value / Math.PI) * 180;\n\t}\n\n\ttoRotationSnapped(baseRotation: number, deltaRotation: number): number {\n\t\tif (this._isEnabled) {\n\t\t\tconst gridSize = this.getGridSizeRotation();\n\t\t\tconst newRotation = baseRotation + deltaRotation;\n\t\t\tconst newRotationDegree = Math.round(this.toDegree(newRotation));\n\t\t\tconst newRotationDegreeResidual = newRotationDegree % 90;\n\t\t\tif (Math.abs(newRotationDegreeResidual) <= gridSize) {\n\t\t\t\treturn this.toRadian(newRotationDegree - newRotationDegreeResidual) - baseRotation;\n\t\t\t} else {\n\t\t\t\tif (90 - gridSize <= newRotationDegreeResidual) {\n\t\t\t\t\treturn (\n\t\t\t\t\t\tthis.toRadian(newRotationDegree + (90 - newRotationDegreeResidual)) -\n\t\t\t\t\t\tbaseRotation\n\t\t\t\t\t);\n\t\t\t\t} else if (newRotationDegreeResidual <= -90 + gridSize) {\n\t\t\t\t\treturn (\n\t\t\t\t\t\tthis.toRadian(newRotationDegree - (90 + newRotationDegreeResidual)) -\n\t\t\t\t\t\tbaseRotation\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\treturn deltaRotation;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn deltaRotation;\n\t}\n\n\tprotected calcNormalizedVector(p0: IPoint, p1: IPoint, result: Point): number {\n\t\tconst dx = p1.x - p0.x;\n\t\tconst dy = p1.y - p0.y;\n\t\tconst l = Math.sqrt(dx * dx + dy * dy);\n\t\tif (EPSILON < l) {\n\t\t\tconst d = 1 / l;\n\t\t\tresult.x = dx * d;\n\t\t\tresult.y = dy * d;\n\t\t} else {\n\t\t\tresult.x = 1;\n\t\t\tresult.y = 0;\n\t\t}\n\t\treturn l;\n\t}\n\n\tprepareForScale(modifier: ESnapperModifier, anchor: ESnapperModifierAnchor): void {\n\t\tif (this._isEnabled) {\n\t\t\tthis.prepare(modifier);\n\n\t\t\tconst points = this._points;\n\t\t\tconst normals = this._normals;\n\t\t\tconst lengths = this._lengths;\n\t\t\tswitch (anchor) {\n\t\t\t\tcase ESnapperModifierAnchor.TOP_LEFT:\n\t\t\t\t\tlengths[0] = this.calcNormalizedVector(points[1], points[0], normals[0]);\n\t\t\t\t\tlengths[1] = this.calcNormalizedVector(points[3], points[0], normals[1]);\n\t\t\t\t\tbreak;\n\t\t\t\tcase ESnapperModifierAnchor.TOP_CENTER:\n\t\t\t\t\tlengths[0] = this.calcNormalizedVector(points[3], points[0], normals[0]);\n\t\t\t\t\tbreak;\n\t\t\t\tcase ESnapperModifierAnchor.TOP_RIGHT:\n\t\t\t\t\tlengths[0] = this.calcNormalizedVector(points[0], points[1], normals[0]);\n\t\t\t\t\tlengths[1] = this.calcNormalizedVector(points[2], points[1], normals[1]);\n\t\t\t\t\tbreak;\n\t\t\t\tcase ESnapperModifierAnchor.MIDDLE_LEFT:\n\t\t\t\t\tlengths[0] = this.calcNormalizedVector(points[1], points[0], normals[0]);\n\t\t\t\t\tbreak;\n\t\t\t\tcase ESnapperModifierAnchor.NONE:\n\t\t\t\t\tbreak;\n\t\t\t\tcase ESnapperModifierAnchor.MIDDLE_RIGHT:\n\t\t\t\t\tlengths[0] = this.calcNormalizedVector(points[0], points[1], normals[0]);\n\t\t\t\t\tbreak;\n\t\t\t\tcase ESnapperModifierAnchor.BOTTOM_LEFT:\n\t\t\t\t\tlengths[0] = this.calcNormalizedVector(points[2], points[3], normals[0]);\n\t\t\t\t\tlengths[1] = this.calcNormalizedVector(points[0], points[3], normals[1]);\n\t\t\t\t\tbreak;\n\t\t\t\tcase ESnapperModifierAnchor.BOTTOM_CENTER:\n\t\t\t\t\tlengths[0] = this.calcNormalizedVector(points[0], points[3], normals[0]);\n\t\t\t\t\tbreak;\n\t\t\t\tcase ESnapperModifierAnchor.BOTTOM_RIGHT:\n\t\t\t\t\tlengths[0] = this.calcNormalizedVector(points[3], points[2], normals[0]);\n\t\t\t\t\tlengths[1] = this.calcNormalizedVector(points[1], points[2], normals[1]);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected setScaleSnappedResult(\n\t\tdistance: number,\n\t\tlength: number,\n\t\tmove: number,\n\t\taxis: boolean, // true => x axis, false y axis\n\t\tresult: ESnapperResultScale\n\t): void {\n\t\tif (EPSILON < length) {\n\t\t\tif (isNaN(result.distance) || distance < result.distance) {\n\t\t\t\tresult.distance = distance;\n\t\t\t\tconst newScale = 1 + move / length;\n\t\t\t\tif (axis) {\n\t\t\t\t\tresult.scale.x = newScale;\n\t\t\t\t} else {\n\t\t\t\t\tresult.scale.y = newScale;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected calcScaleSnapped1D(\n\t\ttransform: Matrix,\n\t\tpoint: Point,\n\t\tnormal: IPoint,\n\t\tlength: number,\n\t\taxis: boolean,\n\t\tresult: ESnapperResultScale\n\t): void {\n\t\tconst work = this._workScale;\n\t\ttransform.apply(point, work);\n\t\tconst tx = work.x;\n\t\tconst ty = work.y;\n\t\tthis.snap(work, work);\n\t\tconst x = work.x;\n\t\tconst y = work.y;\n\n\t\t// X coordinate\n\t\tif (!isNaN(x)) {\n\t\t\tconst nx = Math.abs(normal.x);\n\t\t\tif (EPSILON < nx) {\n\t\t\t\tconst dx = (x - tx) / normal.x;\n\t\t\t\tconst distance = Math.abs(dx);\n\t\t\t\tconst mx = (x - point.x) / normal.x;\n\t\t\t\tthis.setScaleSnappedResult(distance, length, mx, axis, result);\n\t\t\t}\n\t\t}\n\n\t\t// Y coordinate\n\t\tif (!isNaN(y)) {\n\t\t\tconst ny = Math.abs(normal.y);\n\t\t\tif (EPSILON < ny) {\n\t\t\t\tconst dy = (y - ty) / normal.y;\n\t\t\t\tconst distance = Math.abs(dy);\n\t\t\t\tconst my = (y - point.y) / normal.y;\n\t\t\t\tthis.setScaleSnappedResult(distance, length, my, axis, result);\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected calcScaleSnappedX(\n\t\ttransform: Matrix,\n\t\tpoint: Point,\n\t\tnormal: IPoint,\n\t\tlength: number,\n\t\tresult: ESnapperResultScale\n\t): void {\n\t\tthis.calcScaleSnapped1D(transform, point, normal, length, true, result);\n\t}\n\n\tprotected calcScaleSnappedY(\n\t\ttransform: Matrix,\n\t\tpoint: Point,\n\t\tnormal: IPoint,\n\t\tlength: number,\n\t\tresult: ESnapperResultScale\n\t): void {\n\t\tthis.calcScaleSnapped1D(transform, point, normal, length, false, result);\n\t}\n\n\tcalcScaleSnapped2D(\n\t\ttransform: Matrix,\n\t\tpoint: Point,\n\t\tnormals: IPoint[],\n\t\tlengths: number[],\n\t\tresult: ESnapperResultScale\n\t): void {\n\t\tconst work = this._workScale;\n\t\ttransform.apply(point, work);\n\t\tconst tx = work.x;\n\t\tconst ty = work.y;\n\n\t\tthis.snap(work, work);\n\t\tlet x = work.x;\n\t\tlet y = work.y;\n\t\tif (isNaN(x)) {\n\t\t\tif (isNaN(y)) {\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tx = tx;\n\t\t\t}\n\t\t} else {\n\t\t\tif (isNaN(y)) {\n\t\t\t\ty = ty;\n\t\t\t}\n\t\t}\n\n\t\t// (x, y) = (tx, ty) + normalA * a + normalB * b\n\t\t// dx = x - tx\n\t\t// dy = y - ty\n\t\t// V = ( a, b )^T\n\t\t// D = ( dx, dy )^T\n\t\t// A = | normalA.x normalB.x |\n\t\t//     | normalA.y normalB.y |\n\t\t// A V = D\n\t\t// det A = normalA.x * normalB.y - normalB.x * normalA.y\n\t\t// A^-1 = |  normalB.y -normalB.x | / det A\n\t\t//        | -normalA.y  normalA.x |\n\t\tconst detA = normals[0].x * normals[1].y - normals[1].x * normals[0].y;\n\t\tif (EPSILON < Math.abs(detA)) {\n\t\t\tconst dx = x - tx;\n\t\t\tconst dy = y - ty;\n\t\t\tconst distance = Math.abs(dx * dx + dy * dy);\n\t\t\tif (isNaN(result.distance) || distance < result.distance) {\n\t\t\t\tresult.distance = distance;\n\t\t\t\tconst mdx = x - point.x;\n\t\t\t\tconst mdy = y - point.y;\n\t\t\t\tconst mx = (+normals[1].y * mdx - normals[1].x * mdy) / detA;\n\t\t\t\tconst my = (-normals[0].y * mdx + normals[0].x * mdy) / detA;\n\t\t\t\tresult.scale.set(1 + mx / lengths[0], 1 + my / lengths[1]);\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected calcScaleSnappedXY(\n\t\ttransform: Matrix,\n\t\tpointO: Point,\n\t\tpointX: Point,\n\t\tpointY: Point,\n\t\tnormals: IPoint[],\n\t\tlengths: number[],\n\t\tresult: ESnapperResultScale\n\t): void {\n\t\tthis.calcScaleSnapped2D(transform, pointO, normals, lengths, result);\n\t\tthis.calcScaleSnappedX(transform, pointY, normals[0], lengths[0], result);\n\t\tthis.calcScaleSnappedY(transform, pointX, normals[1], lengths[1], result);\n\t}\n\n\ttoScaleSnapped(\n\t\ttransform: Matrix,\n\t\tanchor: ESnapperModifierAnchor,\n\t\tkeepRatio: boolean,\n\t\tscale: IPoint\n\t): boolean {\n\t\tif (this._isEnabled) {\n\t\t\tconst points = this._points;\n\t\t\tconst normals = this._normals;\n\t\t\tconst lengths = this._lengths;\n\t\t\tconst work = this._workScaleResult;\n\t\t\twork.distance = NaN;\n\t\t\twork.scale.set(scale.x, scale.y);\n\n\t\t\tswitch (anchor) {\n\t\t\t\tcase ESnapperModifierAnchor.TOP_LEFT:\n\t\t\t\t\tthis.calcScaleSnappedXY(\n\t\t\t\t\t\ttransform,\n\t\t\t\t\t\tpoints[0],\n\t\t\t\t\t\tpoints[1],\n\t\t\t\t\t\tpoints[3],\n\t\t\t\t\t\tnormals,\n\t\t\t\t\t\tlengths,\n\t\t\t\t\t\twork\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\t\t\t\tcase ESnapperModifierAnchor.TOP_CENTER:\n\t\t\t\t\tthis.calcScaleSnappedY(transform, points[0], normals[0], lengths[0], work);\n\t\t\t\t\tthis.calcScaleSnappedY(transform, points[1], normals[0], lengths[0], work);\n\t\t\t\t\tbreak;\n\t\t\t\tcase ESnapperModifierAnchor.TOP_RIGHT:\n\t\t\t\t\tthis.calcScaleSnappedXY(\n\t\t\t\t\t\ttransform,\n\t\t\t\t\t\tpoints[1],\n\t\t\t\t\t\tpoints[0],\n\t\t\t\t\t\tpoints[2],\n\t\t\t\t\t\tnormals,\n\t\t\t\t\t\tlengths,\n\t\t\t\t\t\twork\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\t\t\t\tcase ESnapperModifierAnchor.MIDDLE_LEFT:\n\t\t\t\t\tthis.calcScaleSnappedX(transform, points[0], normals[0], lengths[0], work);\n\t\t\t\t\tthis.calcScaleSnappedX(transform, points[3], normals[0], lengths[0], work);\n\t\t\t\t\tbreak;\n\t\t\t\tcase ESnapperModifierAnchor.NONE:\n\t\t\t\t\tbreak;\n\t\t\t\tcase ESnapperModifierAnchor.MIDDLE_RIGHT:\n\t\t\t\t\tthis.calcScaleSnappedX(transform, points[1], normals[0], lengths[0], work);\n\t\t\t\t\tthis.calcScaleSnappedX(transform, points[2], normals[0], lengths[0], work);\n\t\t\t\t\tbreak;\n\t\t\t\tcase ESnapperModifierAnchor.BOTTOM_LEFT:\n\t\t\t\t\tthis.calcScaleSnappedXY(\n\t\t\t\t\t\ttransform,\n\t\t\t\t\t\tpoints[3],\n\t\t\t\t\t\tpoints[2],\n\t\t\t\t\t\tpoints[0],\n\t\t\t\t\t\tnormals,\n\t\t\t\t\t\tlengths,\n\t\t\t\t\t\twork\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\t\t\t\tcase ESnapperModifierAnchor.BOTTOM_CENTER:\n\t\t\t\t\tthis.calcScaleSnappedY(transform, points[2], normals[0], lengths[0], work);\n\t\t\t\t\tthis.calcScaleSnappedY(transform, points[3], normals[0], lengths[0], work);\n\t\t\t\t\tbreak;\n\t\t\t\tcase ESnapperModifierAnchor.BOTTOM_RIGHT:\n\t\t\t\t\tthis.calcScaleSnappedXY(\n\t\t\t\t\t\ttransform,\n\t\t\t\t\t\tpoints[2],\n\t\t\t\t\t\tpoints[3],\n\t\t\t\t\t\tpoints[1],\n\t\t\t\t\t\tnormals,\n\t\t\t\t\t\tlengths,\n\t\t\t\t\t\twork\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (!isNaN(work.distance)) {\n\t\t\t\tscale.copyFrom(work.scale);\n\t\t\t\tif (keepRatio) {\n\t\t\t\t\tswitch (anchor) {\n\t\t\t\t\t\tcase ESnapperModifierAnchor.TOP_LEFT:\n\t\t\t\t\t\tcase ESnapperModifierAnchor.TOP_RIGHT:\n\t\t\t\t\t\tcase ESnapperModifierAnchor.BOTTOM_LEFT:\n\t\t\t\t\t\tcase ESnapperModifierAnchor.BOTTOM_RIGHT:\n\t\t\t\t\t\t\tscale.x = scale.y = Math.max(scale.x, scale.y);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase ESnapperModifierAnchor.TOP_CENTER:\n\t\t\t\t\t\tcase ESnapperModifierAnchor.BOTTOM_CENTER:\n\t\t\t\t\t\t\tscale.x = scale.y;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase ESnapperModifierAnchor.MIDDLE_LEFT:\n\t\t\t\t\t\tcase ESnapperModifierAnchor.MIDDLE_RIGHT:\n\t\t\t\t\t\t\tscale.y = scale.x;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase ESnapperModifierAnchor.NONE:\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\treset(): void {\n\t\tthis.enable = true;\n\t\tthis.target.reset();\n\t\tthis.grid.reset();\n\t}\n\n\tserialize(): DDiagramSerializedSnap {\n\t\treturn [this._isEnabled ? 1 : 0, this.target.serialize(), this.grid.serialize()];\n\t}\n\n\tdeserialize(serialized: DDiagramSerializedSnap): void {\n\t\tthis.enable = !!serialized[0];\n\t\tthis.target.deserialize(serialized[1]);\n\t\tthis.grid.deserialize(serialized[2]);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { BaseTexture, Text } from \"pixi.js\";\nimport { DynamicAtlasItem } from \"./dynamic-atlas-item\";\n\nexport class DynamicAtlasItemText extends DynamicAtlasItem {\n\tprotected _text: Text;\n\n\tconstructor(id: string, text: Text, baseTexture: BaseTexture) {\n\t\tsuper(id, text.width, text.height, 0, baseTexture);\n\t\tthis._text = text;\n\t}\n\n\trender(context: CanvasRenderingContext2D): void {\n\t\tconst frame = this.frame;\n\t\tcontext.drawImage(this._text.canvas, frame.x, frame.y, frame.width, frame.height);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { TextMetrics, utils } from \"pixi.js\";\n\nexport class DynamicFontAtlasFont {\n\tid: string;\n\tsize: number;\n\tcolor: string;\n\theight: number;\n\n\tascent: number;\n\tdescent: number;\n\n\tconstructor(fontId: string, size: number, color: number, padding: number) {\n\t\tthis.id = fontId;\n\t\tthis.size = size;\n\t\tthis.color = utils.hex2string(color);\n\t\tthis.height = size + padding * 2;\n\t\tconst metrics = TextMetrics.measureFont(fontId);\n\t\tthis.ascent = metrics.ascent;\n\t\tthis.descent = metrics.descent;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { MIPMAP_MODES, SCALE_MODES, Texture } from \"pixi.js\";\nimport { ASCII_CHARACTERS } from \"./ascii\";\nimport { DynamicFontAtlasCharacter } from \"./dynamic-font-atlas-character\";\nimport { DynamicFontAtlasCharacterType } from \"./dynamic-font-atlas-character-type\";\nimport { DynamicFontAtlasCharacters } from \"./dynamic-font-atlas-characters\";\nimport { DynamicFontAtlasFont } from \"./dynamic-font-atlas-font\";\nimport { UtilCharacterIterator } from \"./util-character-iterator\";\n\nexport class DynamicFontAtlas {\n\tprotected _id: string;\n\tprotected _canvas: HTMLCanvasElement | null;\n\tprotected _context: CanvasRenderingContext2D | null;\n\tprotected _font: DynamicFontAtlasFont;\n\tprotected _characters: DynamicFontAtlasCharacters;\n\tprotected _length: number;\n\tprotected _unrefCount: number;\n\tprotected _width: number;\n\tprotected _height: number;\n\tprotected _revision: number;\n\tprotected _revisionUpdated: number;\n\tprotected _texture: Texture;\n\tprotected _padding: number;\n\n\tconstructor(fontId: string, fontSize: number, fontColor: number, resolution: number) {\n\t\tthis._id = fontId;\n\t\tthis._canvas = document.createElement(\"canvas\");\n\t\tthis._context = null;\n\t\tconst padding = this.toPadding(fontSize);\n\t\tthis._padding = padding;\n\t\tthis._font = new DynamicFontAtlasFont(fontId, fontSize, fontColor, padding);\n\t\tthis._characters = {};\n\t\tthis._length = 0;\n\t\tthis._unrefCount = 0;\n\t\tthis._width = 1;\n\t\tthis._height = 1;\n\t\tthis._revision = 0;\n\t\tthis._revisionUpdated = 0;\n\t\tthis._texture = Texture.from(this._canvas, {\n\t\t\tmipmap: MIPMAP_MODES.OFF,\n\t\t\tresolution,\n\t\t\tscaleMode: SCALE_MODES.NEAREST\n\t\t});\n\n\t\tconst characters = this._characters;\n\t\tthis.add_(\" \", \" \", characters, DynamicFontAtlasCharacterType.SPACE_R);\n\t\tthis.add_(\"\\t\", \"    \", characters, DynamicFontAtlasCharacterType.SPACE_R);\n\t\tthis.add_(\"...\", \"...\", characters, DynamicFontAtlasCharacterType.LETTER_RNB);\n\t\tfor (let i = 0, imax = ASCII_CHARACTERS.length; i < imax; ++i) {\n\t\t\tconst char = ASCII_CHARACTERS[i];\n\t\t\tthis.add_(char, char, characters, DynamicFontAtlasCharacterType.LETTER_RNB);\n\t\t}\n\t}\n\n\tprotected toPadding(fontSize: number): number {\n\t\treturn Math.max(3, Math.ceil(fontSize * 0.2));\n\t}\n\n\tget id(): string {\n\t\treturn this._id;\n\t}\n\n\tget font(): DynamicFontAtlasFont {\n\t\treturn this._font;\n\t}\n\n\tget width(): number {\n\t\treturn this._width;\n\t}\n\n\tget height(): number {\n\t\treturn this._height;\n\t}\n\n\tget canvas(): HTMLCanvasElement | null {\n\t\treturn this._canvas;\n\t}\n\n\tget characters(): DynamicFontAtlasCharacters {\n\t\treturn this._characters;\n\t}\n\n\tget texture(): Texture {\n\t\treturn this._texture;\n\t}\n\n\tprotected add_(\n\t\tid: string,\n\t\tcharacter: string,\n\t\tcharacters: DynamicFontAtlasCharacters,\n\t\ttype: DynamicFontAtlasCharacterType\n\t): void {\n\t\tif (!this.isIgnored(character)) {\n\t\t\tconst data = characters[id];\n\t\t\tif (data != null) {\n\t\t\t\tif (!(data.type & DynamicFontAtlasCharacterType.RESERVED)) {\n\t\t\t\t\tif (data.ref === 0) {\n\t\t\t\t\t\tthis._unrefCount -= 1;\n\t\t\t\t\t}\n\t\t\t\t\tdata.ref += 1;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst advance = this.getAdvance(character);\n\t\t\t\tconst padding = this._padding;\n\t\t\t\tconst width = Math.ceil(padding + advance + padding);\n\t\t\t\tconst height = this.font.height;\n\t\t\t\tcharacters[id] = new DynamicFontAtlasCharacter(\n\t\t\t\t\tcharacter,\n\t\t\t\t\tadvance,\n\t\t\t\t\twidth,\n\t\t\t\t\theight,\n\t\t\t\t\ttype\n\t\t\t\t);\n\t\t\t\tthis._length += 1;\n\t\t\t\tthis._revision += 1;\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected isIgnored(character: string): boolean {\n\t\tswitch (character) {\n\t\t\tcase \"\\n\": // Line feed\n\t\t\t\treturn true;\n\t\t\tcase \"\\r\": // Carriage return\n\t\t\t\treturn true;\n\t\t\tcase \"\\v\": // Vertical tab\n\t\t\t\treturn true;\n\t\t\tcase \"\\f\": // Form feed\n\t\t\t\treturn true;\n\t\t\tcase \"\\u0085\": // Next line\n\t\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tprotected remove_(id: string, characters: DynamicFontAtlasCharacters): void {\n\t\tconst data = characters[id];\n\t\tif (data != null) {\n\t\t\tif (!(data.type & DynamicFontAtlasCharacterType.RESERVED) && 0 < data.ref) {\n\t\t\t\tdata.ref -= 1;\n\t\t\t\tif (data.ref === 0) {\n\t\t\t\t\tthis._unrefCount += 1;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected cleanup_(): void {\n\t\tif (this._length >> 1 <= this._unrefCount) {\n\t\t\tconst characters = this._characters;\n\t\t\tfor (const character in characters) {\n\t\t\t\tif (characters[character].ref <= 0) {\n\t\t\t\t\tdelete characters[character];\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._length -= this._unrefCount;\n\t\t\tthis._revision += 1;\n\t\t\tthis._unrefCount = 0;\n\t\t}\n\t}\n\n\tadd(\n\t\ttargets: string,\n\t\ttype: DynamicFontAtlasCharacterType = DynamicFontAtlasCharacterType.LETTER\n\t): void {\n\t\tconst characters = this._characters;\n\t\tconst iterator = UtilCharacterIterator.from(targets);\n\t\twhile (iterator.hasNext()) {\n\t\t\tconst character = iterator.next();\n\t\t\tthis.add_(character, character, characters, type);\n\t\t}\n\t}\n\n\tremove(targets: string): void {\n\t\tconst characters = this._characters;\n\t\tconst iterator = UtilCharacterIterator.from(targets);\n\t\twhile (iterator.hasNext()) {\n\t\t\tthis.remove_(iterator.next(), characters);\n\t\t}\n\t}\n\n\tget(id: string): DynamicFontAtlasCharacter | undefined {\n\t\treturn this._characters[id];\n\t}\n\n\tgetAdvance(target: string): number {\n\t\tconst context = this.getContext();\n\t\tif (context != null) {\n\t\t\treturn context.measureText(target).width;\n\t\t}\n\t\treturn 0;\n\t}\n\n\tgetContext(): CanvasRenderingContext2D | null {\n\t\tlet context = this._context;\n\t\tif (context == null) {\n\t\t\tconst canvas = this._canvas;\n\t\t\tif (canvas != null) {\n\t\t\t\tcontext = this._context = canvas.getContext(\"2d\", { alpha: true });\n\t\t\t\tif (context == null) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\n\t\tconst font = this._font;\n\t\tif (context.font !== font.id) {\n\t\t\tcontext.font = font.id;\n\t\t\tfont.id = context.font;\n\t\t\tcontext.textAlign = \"left\";\n\t\t\tcontext.textBaseline = \"alphabetic\";\n\t\t\tcontext.lineWidth = 0;\n\t\t\tcontext.lineCap = \"round\";\n\t\t\tcontext.lineJoin = \"miter\";\n\t\t\tcontext.miterLimit = 0;\n\t\t\tcontext.fillStyle = font.color;\n\t\t\tcontext.strokeStyle = \"#0000ff\";\n\t\t}\n\t\treturn context;\n\t}\n\n\tupdate(): boolean {\n\t\tthis.cleanup_();\n\n\t\tif (this._revisionUpdated < this._revision) {\n\t\t\tthis._revisionUpdated = this._revision;\n\n\t\t\tconst canvas = this._canvas;\n\t\t\tif (canvas != null) {\n\t\t\t\tconst font = this._font;\n\t\t\t\tconst fontHeight = font.height;\n\t\t\t\tconst characters = this._characters;\n\t\t\t\tconst width = (this._width = this.toPowerOf2(\n\t\t\t\t\tMath.ceil(Math.sqrt(this._length)) * fontHeight\n\t\t\t\t));\n\n\t\t\t\tconst offsetX = this._padding;\n\t\t\t\tconst offsetY = Math.round(\n\t\t\t\t\t(fontHeight - (font.ascent + font.descent)) * 0.5 + font.ascent\n\t\t\t\t);\n\t\t\t\tlet x = 0;\n\t\t\t\tlet y = 0;\n\t\t\t\tfor (const key in characters) {\n\t\t\t\t\tconst character = characters[key];\n\t\t\t\t\tif (width <= x + character.width) {\n\t\t\t\t\t\tx = 0;\n\t\t\t\t\t\ty += fontHeight;\n\t\t\t\t\t}\n\n\t\t\t\t\tcharacter.x = x;\n\t\t\t\t\tcharacter.y = y;\n\t\t\t\t\tcharacter.origin.x = x + offsetX;\n\t\t\t\t\tcharacter.origin.y = y + offsetY;\n\n\t\t\t\t\tx += character.width;\n\t\t\t\t}\n\t\t\t\tconst height = (this._height = y + fontHeight);\n\n\t\t\t\t// Make a input canvas\n\t\t\t\t// Here, we need to reset the context because\n\t\t\t\t// context settings will be lost when we set the width/height.\n\t\t\t\tconst baseTexture = this._texture.baseTexture;\n\t\t\t\tconst resolution = baseTexture.resolution;\n\t\t\t\tconst realWidth = Math.ceil(width * resolution);\n\t\t\t\tconst realHeight = Math.ceil(height * resolution);\n\t\t\t\tcanvas.width = realWidth;\n\t\t\t\tcanvas.height = realHeight;\n\t\t\t\tconst context = this.getContext();\n\t\t\t\tif (context != null) {\n\t\t\t\t\tcontext.save();\n\t\t\t\t\tcontext.scale(resolution, resolution);\n\t\t\t\t\tcontext.clearRect(0, 0, width, height);\n\t\t\t\t\tfor (const key in characters) {\n\t\t\t\t\t\tconst character = characters[key];\n\t\t\t\t\t\tcontext.fillText(key, character.origin.x, character.origin.y);\n\t\t\t\t\t}\n\t\t\t\t\tcontext.restore();\n\t\t\t\t}\n\t\t\t\tbaseTexture.setRealSize(realWidth, realHeight);\n\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tgetRevision(): number {\n\t\treturn this._revision;\n\t}\n\n\tgetRevisionUpdate(): number {\n\t\treturn this._revisionUpdated;\n\t}\n\n\tget length(): number {\n\t\treturn this._length;\n\t}\n\n\tdestroy(): void {\n\t\tconst canvas = this._canvas;\n\t\tif (canvas != null) {\n\t\t\tthis._canvas = null;\n\t\t}\n\n\t\tconst characters = this._characters;\n\t\tfor (const character in characters) {\n\t\t\tdelete characters[character];\n\t\t}\n\t}\n\n\ttoPowerOf2(size: number): number {\n\t\tlet result = 32;\n\t\twhile (result < size) {\n\t\t\tresult <<= 1;\n\t\t}\n\t\treturn result;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DApplicationLayerLike } from \"../d-application-layer-like\";\nimport { DynamicFontAtlas } from \"./dynamic-font-atlas\";\n\nconst update = (atlas: DynamicFontAtlas): void => {\n\tatlas.update();\n};\n\nconst updateAll = (colorToAltas: Map<number, DynamicFontAtlas>): void => {\n\tcolorToAltas.forEach(update);\n};\n\nconst destroy = (atlas: DynamicFontAtlas): void => {\n\tatlas.update();\n};\n\nconst destroyAll = (colorToAltas: Map<number, DynamicFontAtlas>): void => {\n\tcolorToAltas.forEach(destroy);\n};\n\nexport class DynamicFontAtlases {\n\tprotected _atlases: Map<string, Map<number, DynamicFontAtlas>>;\n\tprotected _resolution: number;\n\n\tconstructor(layer: DApplicationLayerLike) {\n\t\tthis._atlases = new Map<string, Map<number, DynamicFontAtlas>>();\n\t\tthis._resolution = layer.renderer.resolution;\n\n\t\tlayer.renderer.on(\"prerender\", (): void => {\n\t\t\tthis.update();\n\t\t});\n\t}\n\n\tadd(fontId: string, fontSize: number, fontColor: number, targets: string): void {\n\t\tconst atlases = this._atlases;\n\t\tlet colorToAtlas = atlases.get(fontId);\n\t\tif (colorToAtlas == null) {\n\t\t\tcolorToAtlas = new Map<number, DynamicFontAtlas>();\n\t\t\tatlases.set(fontId, colorToAtlas);\n\t\t}\n\t\tlet atlas = colorToAtlas.get(fontColor);\n\t\tif (atlas == null) {\n\t\t\tatlas = new DynamicFontAtlas(fontId, fontSize, fontColor, this._resolution);\n\t\t\tcolorToAtlas.set(fontColor, atlas);\n\t\t}\n\t\tatlas.add(targets);\n\t}\n\n\tremove(fontId: string, fontColor: number, targets: string): void {\n\t\tconst colorToAtlas = this._atlases.get(fontId);\n\t\tif (colorToAtlas != null) {\n\t\t\tconst atlas = colorToAtlas.get(fontColor);\n\t\t\tif (atlas != null) {\n\t\t\t\tatlas.remove(targets);\n\t\t\t}\n\t\t}\n\t}\n\n\tget(fontId: string, fontColor: number): DynamicFontAtlas | null {\n\t\tconst atlases = this._atlases;\n\t\tconst colorToAtlas = atlases.get(fontId);\n\t\tif (colorToAtlas == null) {\n\t\t\treturn null;\n\t\t}\n\t\tconst atlas = colorToAtlas.get(fontColor);\n\t\tif (atlas == null) {\n\t\t\treturn null;\n\t\t}\n\t\treturn atlas;\n\t}\n\n\tupdate(): void {\n\t\tthis._atlases.forEach(updateAll);\n\t}\n\n\tdestroy(): void {\n\t\tconst atlases = this._atlases;\n\t\tatlases.forEach(destroyAll);\n\t\tatlases.clear();\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBase } from \"../d-base\";\n\nexport class Lazy<INSTANCE, OPTIONS> {\n\tinstance: INSTANCE | null;\n\tnewInstance: new (options: OPTIONS) => INSTANCE;\n\toptions: OPTIONS;\n\n\tconstructor(newInstance: new (options: OPTIONS) => INSTANCE, options: OPTIONS, base?: DBase) {\n\t\tthis.instance = null;\n\t\tthis.newInstance = newInstance;\n\t\tthis.options = options;\n\n\t\tif (base != null) {\n\t\t\tif (base.state.isActive) {\n\t\t\t\tsetTimeout((): void => {\n\t\t\t\t\tthis.get();\n\t\t\t\t}, 0);\n\t\t\t}\n\n\t\t\tbase.on(\"active\", (): void => {\n\t\t\t\tthis.get();\n\t\t\t});\n\t\t}\n\t}\n\n\tget(): INSTANCE {\n\t\tlet result = this.instance;\n\t\tif (result == null) {\n\t\t\tresult = new this.newInstance(this.options);\n\t\t\tthis.instance = result;\n\t\t}\n\t\treturn result;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Returns a ceiling index of the given value.\n * The array must be sorted in an ascending order.\n *\n * @param array an array sorted in an ascending order\n * @param value a value to be searched\n * @returns a ceiling index of the given value\n */\nexport const toCeilingIndex = <V>(array: V[], value: V, size: number, offset: number): number => {\n\tlet i0 = 0;\n\tlet i1 = Math.floor(array.length / size) - 1;\n\n\twhile (i0 <= i1) {\n\t\tconst i2 = i0 + ((i1 - i0) >> 1);\n\t\tconst v2 = array[i2 * size + offset];\n\t\tif (value < v2) {\n\t\t\ti1 = i2 - 1;\n\t\t} else if (v2 < value) {\n\t\t\ti0 = i2 + 1;\n\t\t} else {\n\t\t\treturn i2;\n\t\t}\n\t}\n\n\treturn Math.max(i0, i1);\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { isNumber } from \"./is-number\";\nimport { isString } from \"./is-string\";\n\nexport const toLabel = (target: any): string => {\n\tif (target != null) {\n\t\tif (isString(target)) {\n\t\t\treturn target;\n\t\t} else if (isNumber(target)) {\n\t\t\treturn String(target);\n\t\t} else if (\"name\" in target) {\n\t\t\treturn target.name;\n\t\t} else if (\"label\" in target) {\n\t\t\treturn target.label;\n\t\t} else if (\"id\" in target) {\n\t\t\treturn target.id;\n\t\t}\n\t}\n\treturn \"\";\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { BaseTexture, Rectangle, SCALE_MODES, Texture } from \"pixi.js\";\nimport { toSvgUrl } from \"./to-svg-url\";\n\nexport interface UtilSvgAtlasBuilderBuildOptions {\n\tforce?: boolean;\n\tscaling?: SCALE_MODES;\n\tresolution?: number;\n}\n\nexport class UtilSvgAtlasBuilder {\n\tprotected _width: number;\n\tprotected _ratio: number;\n\tprotected _margin: number;\n\n\tprotected _frames: Record<string, Rectangle>;\n\tprotected _svg: string;\n\tprotected _nextX: number;\n\tprotected _nextY: number;\n\tprotected _height: number;\n\n\tprotected _built?: Record<string, Texture>;\n\n\tconstructor(width: number, ratio: number, margin: number) {\n\t\tthis._width = width;\n\t\tthis._ratio = ratio;\n\t\tthis._margin = margin;\n\n\t\tthis._frames = {};\n\t\tthis._svg = \"\";\n\t\tthis._nextX = 0;\n\t\tthis._nextY = 0;\n\t\tthis._height = 0;\n\t}\n\n\tget width(): number {\n\t\treturn this._width;\n\t}\n\n\tget ratio(): number {\n\t\treturn this._ratio;\n\t}\n\n\tget margin(): number {\n\t\treturn this._margin;\n\t}\n\n\tadd(name: string, width: number, height: number, path: string): boolean {\n\t\tconst frames = this._frames;\n\t\tif (!(name in frames)) {\n\t\t\t// Position\n\t\t\tconst margin = this._margin;\n\t\t\tlet x = this._nextX;\n\t\t\tlet y = this._nextY;\n\t\t\tif (this._width <= x + width) {\n\t\t\t\tx = 0;\n\t\t\t\ty = this._nextY + this._height + margin;\n\t\t\t\tthis._height = height;\n\t\t\t\tthis._nextY = y;\n\t\t\t} else {\n\t\t\t\tthis._height = Math.max(this._height, height);\n\t\t\t}\n\t\t\tthis._nextX = x + width + margin;\n\n\t\t\t// Frame\n\t\t\tframes[name] = new Rectangle(x, y, width, height);\n\n\t\t\t// Svg\n\t\t\tconst ratio = this._ratio;\n\t\t\tthis._svg += `<g transform=\"translate(${x * ratio},${y * ratio})\">${path}</g>`;\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\thas(name: string): boolean {\n\t\treturn name in this._frames;\n\t}\n\n\tget mappings(): Record<string, Texture> {\n\t\treturn this.build();\n\t}\n\n\tbuild(options?: UtilSvgAtlasBuilderBuildOptions): Record<string, Texture> {\n\t\tlet built = this._built;\n\t\tif (built == null || options?.force) {\n\t\t\tconst resolution = options?.resolution ?? window.devicePixelRatio ?? 1;\n\t\t\tconst width = this._width;\n\t\t\tconst height = Math.pow(2, Math.ceil(Math.log(this._nextY + this._height) / Math.LN2));\n\t\t\tconst realWidth = width * resolution;\n\t\t\tconst realHeight = height * resolution;\n\t\t\tconst ratio = this._ratio;\n\t\t\tconst attrWidth = `width=\"${realWidth}\"`;\n\t\t\tconst attrHeight = `height=\"${realHeight}\"`;\n\t\t\tconst attrViewBox = `viewBox=\"0 0 ${width * ratio} ${height * ratio}\"`;\n\t\t\tconst attrXmlns = `xmlns=\"http://www.w3.org/2000/svg\"`;\n\t\t\tconst url = toSvgUrl(\n\t\t\t\t`<svg ${attrWidth} ${attrHeight} ${attrViewBox} ${attrXmlns}>${this._svg}</svg>`\n\t\t\t);\n\t\t\tconst scaleMode = options?.scaling ?? SCALE_MODES.NEAREST;\n\t\t\tconst baseTexture = BaseTexture.from(url, {\n\t\t\t\tresolution,\n\t\t\t\tscaleMode\n\t\t\t});\n\t\t\tconst frames = this._frames;\n\t\t\tbuilt = this._built = {};\n\t\t\tfor (const name in frames) {\n\t\t\t\tbuilt[name] = new Texture(baseTexture, frames[name]);\n\t\t\t}\n\t\t}\n\t\treturn built;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Extract, Matrix, Renderer, RenderTexture, SCALE_MODES, utils } from \"pixi.js\";\nimport { DApplications } from \"../d-applications\";\nimport { DBase } from \"../d-base\";\nimport { UtilExtractorPixels } from \"./util-extractor-pixels\";\n\nexport class UtilExtractor {\n\tstatic toTexture(\n\t\ttarget: DBase,\n\t\tresolution?: number,\n\t\tclear?: boolean,\n\t\tskipUpdateTransform?: boolean\n\t): RenderTexture {\n\t\tconst scale = target.transform.scale;\n\t\tconst result = RenderTexture.create({\n\t\t\twidth: target.width * scale.x,\n\t\t\theight: target.height * scale.y,\n\t\t\tscaleMode: SCALE_MODES.LINEAR,\n\t\t\tresolution\n\t\t});\n\t\tconst matrix = new Matrix(\n\t\t\tundefined,\n\t\t\tundefined,\n\t\t\tundefined,\n\t\t\tundefined,\n\t\t\t-target.position.x,\n\t\t\t-target.position.y\n\t\t);\n\t\tconst layer = DApplications.getLayer(target);\n\t\tif (layer) {\n\t\t\tlayer.renderer.render(target, result, clear, matrix, skipUpdateTransform);\n\t\t}\n\t\treturn result;\n\t}\n\n\tstatic toPixels(renderTexture: RenderTexture, renderer: Renderer): UtilExtractorPixels {\n\t\tconst resolution = renderTexture.resolution;\n\t\tconst frame = renderTexture.frame;\n\t\tconst width = Math.floor(frame.width * resolution);\n\t\tconst height = Math.floor(frame.height * resolution);\n\t\tconst pixels = new Uint8Array(4 * width * height);\n\n\t\trenderer.renderTexture.bind(renderTexture);\n\t\tconst gl = renderer.gl;\n\t\tgl.readPixels(\n\t\t\tframe.x * resolution,\n\t\t\tframe.y * resolution,\n\t\t\twidth,\n\t\t\theight,\n\t\t\tgl.RGBA,\n\t\t\tgl.UNSIGNED_BYTE,\n\t\t\tpixels\n\t\t);\n\n\t\treturn {\n\t\t\twidth,\n\t\t\theight,\n\t\t\tarray: pixels\n\t\t};\n\t}\n\n\tstatic toCanvas(\n\t\tpixels: UtilExtractorPixels,\n\t\tscale?: number,\n\t\tignorePremutipliedAlpha?: boolean\n\t): utils.CanvasRenderTarget {\n\t\tconst width = pixels.width;\n\t\tconst height = pixels.height;\n\t\tconst array = pixels.array;\n\t\tconst canvasRenderTarget = new utils.CanvasRenderTarget(width, height, 1);\n\n\t\tconst imageData = canvasRenderTarget.context.getImageData(0, 0, width, height);\n\t\tif (ignorePremutipliedAlpha) {\n\t\t\timageData.data.set(array);\n\t\t} else {\n\t\t\t(Extract as any).arrayPostDivide(array, imageData.data);\n\t\t}\n\t\tcanvasRenderTarget.context.putImageData(imageData, 0, 0);\n\n\t\t// Scale down\n\t\tif (scale != null && scale !== 1) {\n\t\t\tcanvasRenderTarget.context.scale(scale, scale);\n\t\t\tcanvasRenderTarget.context.drawImage(canvasRenderTarget.canvas, 0, 0);\n\t\t\tconst scaledWidth = Math.floor(width * scale);\n\t\t\tconst scaledHeight = Math.floor(height * scale);\n\t\t\tconst scaledImageData = canvasRenderTarget.context.getImageData(\n\t\t\t\t0,\n\t\t\t\t0,\n\t\t\t\tscaledWidth,\n\t\t\t\tscaledHeight\n\t\t\t);\n\t\t\tcanvasRenderTarget.resize(scaledWidth, scaledHeight);\n\t\t\tcanvasRenderTarget.context.putImageData(scaledImageData, 0, 0);\n\t\t}\n\n\t\treturn canvasRenderTarget;\n\t}\n\n\tstatic toBase64(canvas: HTMLCanvasElement, format?: string, quality?: number): string {\n\t\treturn canvas.toDataURL(format, quality);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport class UtilFileDownloader {\n\t/**\n\t * Downloads a file of the given name and URL.\n\t *\n\t * @param filename a file name\n\t * @param url a file URL\n\t */\n\tstatic downloadUrl(filename: string, url: string): void {\n\t\tconst a = document.createElement(\"a\");\n\t\tif (\"download\" in a) {\n\t\t\ta.href = url;\n\t\t\ta.setAttribute(\"download\", filename);\n\t\t\ta.style.display = \"none\";\n\t\t\tdocument.body.appendChild(a);\n\t\t\ta.click();\n\t\t\tsetTimeout((): void => {\n\t\t\t\tdocument.body.removeChild(a);\n\t\t\t}, 66);\n\t\t} else {\n\t\t\tif (!window.open(url)) {\n\t\t\t\tlocation.href = url;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Downloads a file of the given name with the given contents.\n\t *\n\t * @param filename a file name\n\t * @param contents file contents\n\t * @param insertBom false to stop the BOM insertion\n\t */\n\tstatic download(filename: string, contents: string, insertBom?: boolean): void {\n\t\tconst blob = new Blob(insertBom !== false ? [\"\\ufeff\", contents] : [contents], {\n\t\t\ttype: \"text/plain\"\n\t\t});\n\t\tconst navigator = window.navigator;\n\t\tif (\"msSaveBlob\" in navigator) {\n\t\t\t// IE10 and 11\n\t\t\t(navigator as any).msSaveBlob(blob, filename);\n\t\t} else {\n\t\t\tthis.downloadUrl(filename, URL.createObjectURL(blob));\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Renderer, RenderTexture, utils } from \"pixi.js\";\nimport { DApplicationLayerLike } from \"../d-application-layer-like\";\nimport { DApplicationLike } from \"../d-application-like\";\nimport { DApplications } from \"../d-applications\";\nimport { DBase } from \"../d-base\";\nimport { isNumber } from \"./is-number\";\nimport { UtilExtractor } from \"./util-extractor\";\nimport { UtilExtractorPixels } from \"./util-extractor-pixels\";\nimport { UtilFileDownloader } from \"./util-file-downloader\";\n\nexport interface UtilExtractTextureResolutionOptions {\n\tsize: number;\n}\n\nexport interface UtilExtractTextureTransformOptions {\n\tupdate?: boolean;\n}\n\nexport interface UtilExtractTextureOptions {\n\ttarget: DBase;\n\tresolution?: number | UtilExtractTextureResolutionOptions;\n\ttransform?: UtilExtractTextureTransformOptions;\n\tclear?: boolean;\n}\n\nexport interface UtilExtractPixelsOptions extends UtilExtractTextureOptions {\n\trenderer?: Renderer;\n\tapplication?: DApplicationLike;\n\tlayer?: DApplicationLayerLike;\n}\n\nexport interface UtilExtractCanvasScaleOptions {\n\tsize: number;\n}\n\nexport interface UtilExtractCanvasAlphaOptions {\n\tpremultiplied?: {\n\t\tignore?: boolean;\n\t};\n}\n\nexport interface UtilExtractCanvasOptions extends UtilExtractPixelsOptions {\n\tscale?: number | UtilExtractCanvasScaleOptions;\n\talpha?: UtilExtractCanvasAlphaOptions;\n}\n\nexport interface UtilExtractBase64Options extends UtilExtractCanvasOptions {\n\tformat?: string;\n\tquality?: number;\n}\n\nexport interface UtilExtractFileOptions extends UtilExtractBase64Options {\n\tfilename: string;\n}\n\nconst toResolution = (options: UtilExtractTextureOptions): number => {\n\tconst target = options.target;\n\tconst resolution = options.resolution;\n\tif (resolution != null) {\n\t\tif (isNumber(resolution)) {\n\t\t\treturn resolution;\n\t\t} else {\n\t\t\tconst scale = target.transform.scale;\n\t\t\tconst size = Math.max(target.width * scale.x, target.height * scale.y);\n\t\t\treturn Math.min(1, resolution.size / size);\n\t\t}\n\t} else {\n\t\treturn window.devicePixelRatio ?? 1;\n\t}\n};\n\nconst toScale = (\n\tpixels: UtilExtractorPixels,\n\toptions: UtilExtractCanvasOptions\n): number | undefined => {\n\tconst scale = options.scale;\n\tif (scale != null) {\n\t\tif (isNumber(scale)) {\n\t\t\treturn scale;\n\t\t} else {\n\t\t\tconst size = scale.size;\n\t\t\treturn Math.min(1, size / pixels.width, size / pixels.height);\n\t\t}\n\t}\n};\n\nconst toRenderer = (options: UtilExtractPixelsOptions): Renderer => {\n\tconst renderer = options.renderer;\n\tif (renderer) {\n\t\treturn renderer;\n\t}\n\tconst application = options.application;\n\tif (application) {\n\t\treturn application.getLayerBase().renderer;\n\t}\n\tconst layer = options.layer || DApplications.getLayer(options.target);\n\tif (layer) {\n\t\treturn layer.renderer;\n\t}\n\tthrow new Error(\"No renderer / application / layer found.\");\n};\n\nexport class UtilExtract {\n\tstatic texture(options: UtilExtractTextureOptions): RenderTexture {\n\t\tconst target = options.target;\n\t\tconst resolution = toResolution(options);\n\t\tconst skipUpdateTransform = options.transform?.update;\n\t\treturn UtilExtractor.toTexture(target, resolution, options.clear, skipUpdateTransform);\n\t}\n\n\tstatic pixels(options: UtilExtractPixelsOptions): UtilExtractorPixels {\n\t\tconst renderer = toRenderer(options);\n\t\tconst texture = this.texture(options);\n\t\ttry {\n\t\t\treturn UtilExtractor.toPixels(texture, renderer);\n\t\t} finally {\n\t\t\tif (texture) {\n\t\t\t\ttexture.destroy();\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic canvas(options: UtilExtractCanvasOptions): utils.CanvasRenderTarget {\n\t\tconst pixels = this.pixels(options);\n\t\tconst ignorePremutipliedAlpha = options.alpha?.premultiplied?.ignore;\n\t\tconst scale = toScale(pixels, options);\n\t\treturn UtilExtractor.toCanvas(pixels, scale, ignorePremutipliedAlpha);\n\t}\n\n\tstatic base64(options: UtilExtractBase64Options): string {\n\t\tconst canvas = this.canvas(options);\n\t\ttry {\n\t\t\treturn UtilExtractor.toBase64(canvas.canvas, options.format, options.quality);\n\t\t} finally {\n\t\t\tif (canvas) {\n\t\t\t\tcanvas.destroy();\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic file(options: UtilExtractFileOptions): void {\n\t\tUtilFileDownloader.downloadUrl(options.filename, this.base64(options));\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * An output format.\n */\nexport const UtilFileAs = {\n\tTEXT: 0,\n\tDATA_URL: 1,\n\tBINARY_STRING: 2,\n\tARRAY_BUTTER: 3,\n\tFILE: 4\n} as const;\n\nexport type UtilFileAs = typeof UtilFileAs[keyof typeof UtilFileAs];\n\nexport interface UtilFileFacade {\n\temit(name: string, ...args: any[]): void;\n}\n\n/**\n * An `open` event handler.\n *\n * @param result a file contents\n * @param file an opened file\n * @param emitter an emitter\n */\nexport type UtilFileOnOpen<RESULT, EMITTER> = (\n\tresult: RESULT,\n\tfile: File,\n\temitter: EMITTER\n) => void;\n\n/**\n * {@link UtilFileOpener} events.\n */\nexport interface UtilFileEvents<EMITTER> {\n\t/**\n\t * Triggered when a file is opened.\n\t */\n\topen:\n\t\t| UtilFileOnOpen<string, EMITTER>\n\t\t| UtilFileOnOpen<ArrayBuffer, EMITTER>\n\t\t| UtilFileOnOpen<File, EMITTER>;\n\n\t/**\n\t * Triggered when an operation is aborted.\n\t *\n\t * @param e an event object\n\t * @param emitter an emitter\n\t */\n\tabort(e: ProgressEvent, emitter: EMITTER): void;\n\n\t/**\n\t * Triggered when an operation is canceled.\n\t *\n\t * @param emitter an emitter\n\t */\n\tcancel(emitter: EMITTER): void;\n}\n\n/**\n * An utility class for opening files.\n */\nexport class UtilFileOpener {\n\tprotected _input: HTMLInputElement | null;\n\tprotected _as: UtilFileAs;\n\tprotected _facade: UtilFileFacade;\n\n\tconstructor(as: UtilFileAs, facade: UtilFileFacade) {\n\t\tthis._input = null;\n\t\tthis._as = as;\n\t\tthis._facade = facade;\n\t}\n\n\topen(): void {\n\t\tconst input = this.getOrCreateInput();\n\t\tif (input != null) {\n\t\t\tinput.click();\n\t\t} else {\n\t\t\tthis.onCancel();\n\t\t}\n\t}\n\n\tprotected getOrCreateInput(): HTMLInputElement | null {\n\t\tif (\"FileReader\" in window && this._input == null) {\n\t\t\tconst input = document.createElement(\"input\");\n\t\t\tthis._input = input;\n\t\t\tinput.setAttribute(\"type\", \"file\");\n\t\t\tinput.setAttribute(\"style\", \"display:none\");\n\t\t\tinput.addEventListener(\"change\", (e: Event): void => {\n\t\t\t\tthis.onInputChange(input);\n\t\t\t\tinput.value = \"\";\n\t\t\t\te.stopImmediatePropagation();\n\t\t\t\te.preventDefault();\n\t\t\t});\n\t\t\tdocument.body.appendChild(input);\n\t\t}\n\t\treturn this._input;\n\t}\n\n\tprotected onInputChange(input: HTMLInputElement): void {\n\t\tconst files = input.files;\n\t\tif (files != null && 0 < files.length) {\n\t\t\tconst file = files[0];\n\t\t\tif (this._as === UtilFileAs.FILE) {\n\t\t\t\tthis.onOpen(file, file);\n\t\t\t} else {\n\t\t\t\tconst fileReader = new FileReader();\n\t\t\t\tfileReader.onload = (e: ProgressEvent) => {\n\t\t\t\t\tif (e.target != null) {\n\t\t\t\t\t\tconst target = e.target as any;\n\t\t\t\t\t\tthis.onOpen(target.result, file);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tfileReader.onabort = (e: ProgressEvent) => {\n\t\t\t\t\tthis.onAboart(e);\n\t\t\t\t};\n\t\t\t\tswitch (this._as) {\n\t\t\t\t\tcase UtilFileAs.TEXT:\n\t\t\t\t\t\tfileReader.readAsText(file);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase UtilFileAs.DATA_URL:\n\t\t\t\t\t\tfileReader.readAsDataURL(file);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase UtilFileAs.BINARY_STRING:\n\t\t\t\t\t\tfileReader.readAsBinaryString(file);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase UtilFileAs.ARRAY_BUTTER:\n\t\t\t\t\t\tfileReader.readAsArrayBuffer(file);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tfileReader.readAsText(file);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tthis.onCancel();\n\t\t}\n\t}\n\n\tprotected onOpen(result: string | ArrayBuffer | File, file: File): void {\n\t\tconst facade = this._facade;\n\t\tfacade.emit(\"open\", result, file, facade);\n\t}\n\n\tprotected onAboart(e: ProgressEvent): void {\n\t\tconst facade = this._facade;\n\t\tfacade.emit(\"abort\", e, facade);\n\t}\n\n\tprotected onCancel(): void {\n\t\tconst facade = this._facade;\n\t\tfacade.emit(\"cancel\", facade);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport class UtilHsv {\n\t/**\n\t * Returns HSV colors.\n\t * Ranges of components are:\n\t *\n\t * * H: [0, 360)\n\t * * S: [0, 255]\n\t * * V: [0, 255]\n\t *\n\t * @param color a rgb color\n\t * @return an array of hsv components\n\t */\n\tstatic fromRgb(color: number): [number, number, number] {\n\t\tconst r = (color & 0xff0000) >> 16;\n\t\tconst g = (color & 0x00ff00) >> 8;\n\t\tconst b = (color & 0x0000ff) | 0;\n\n\t\tconst max = Math.max(r, g, b);\n\t\tconst min = Math.min(r, g, b);\n\t\tconst length = max - min;\n\t\tlet h = 0;\n\t\tif (0 < length) {\n\t\t\tif (r === max) {\n\t\t\t\th = (60 * (g - b)) / length;\n\t\t\t} else if (g === max) {\n\t\t\t\th = (60 * (b - r)) / length + 120;\n\t\t\t} else if (b === max) {\n\t\t\t\th = (60 * (r - g)) / length + 240;\n\t\t\t}\n\t\t\tif (h < 0) {\n\t\t\t\th += 360;\n\t\t\t}\n\t\t}\n\n\t\tconst s = (length / max) * 255;\n\t\tconst v = max;\n\t\treturn [h, s, v];\n\t}\n\n\tstatic toRgb(h: number, s: number, v: number): number {\n\t\tconst max = v;\n\t\tconst min = v - (s / 255) * v;\n\t\tconst length = max - min;\n\n\t\tlet r = 0;\n\t\tlet g = 0;\n\t\tlet b = 0;\n\t\tif (h <= 60) {\n\t\t\tr = max;\n\t\t\tg = (h / 60) * length + min;\n\t\t\tb = min;\n\t\t} else if (h <= 120) {\n\t\t\tr = ((120 - h) / 60) * length + min;\n\t\t\tg = max;\n\t\t\tb = min;\n\t\t} else if (h <= 180) {\n\t\t\tr = min;\n\t\t\tg = max;\n\t\t\tb = ((h - 120) / 60) * length + min;\n\t\t} else if (h <= 240) {\n\t\t\tr = min;\n\t\t\tg = ((240 - h) / 60) * length + min;\n\t\t\tb = max;\n\t\t} else if (h <= 300) {\n\t\t\tr = ((h - 240) / 60) * length + min;\n\t\t\tg = min;\n\t\t\tb = max;\n\t\t} else {\n\t\t\tr = max;\n\t\t\tg = min;\n\t\t\tb = ((360 - h) / 60) * length + min;\n\t\t}\n\n\t\tr = Math.max(0, Math.min(255, r));\n\t\tg = Math.max(0, Math.min(255, g));\n\t\tb = Math.max(0, Math.min(255, b));\n\n\t\treturn (r << 16) | (g << 8) | b;\n\t}\n}\n","/*\n * Copyright (C) 2021 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {\n\tUtilInput,\n\tUtilInputOperation,\n\tUtilInputOptions,\n\tUtilInputTarget,\n\tUtilThemeInput\n} from \"./util-input\";\nimport { UtilKeyboardEvent } from \"./util-keyboard-event\";\n\nexport interface UtilInputTextAreaTarget extends UtilInputTarget {}\n\nexport interface UtilInputTextAreaOperation\n\textends UtilInputOperation<string, HTMLTextAreaElement> {}\n\nexport interface UtilInputTextAreaOptions extends UtilInputOptions<string, HTMLTextAreaElement> {}\n\nexport interface UtilThemeInputTextArea extends UtilThemeInput<string, HTMLTextAreaElement> {}\n\nexport class UtilInputTextArea<\n\tTARGET extends UtilInputTextAreaTarget = UtilInputTextAreaTarget,\n\tOPERATION extends UtilInputTextAreaOperation = UtilInputTextAreaOperation,\n\tTHEME extends UtilThemeInputTextArea = UtilThemeInputTextArea,\n\tOPTIONS extends UtilInputTextAreaOptions = UtilInputTextAreaOptions\n> extends UtilInput<string, HTMLTextAreaElement, TARGET, OPERATION, THEME, OPTIONS> {\n\tprotected onElementAttached(\n\t\telement: HTMLTextAreaElement,\n\t\tbefore?: HTMLDivElement | null,\n\t\tafter?: HTMLDivElement | null\n\t): void {\n\t\telement.addEventListener(\"keydown\", this._onInputKeyDownBound);\n\t\tsuper.onElementAttached(element, before, after);\n\t}\n\n\tprotected onElementDetached(\n\t\telement: HTMLTextAreaElement,\n\t\tbefore?: HTMLDivElement | null,\n\t\tafter?: HTMLDivElement | null\n\t): void {\n\t\telement.removeEventListener(\"keydown\", this._onInputKeyDownBound);\n\t\tsuper.onElementDetached(element, before, after);\n\t}\n\n\tprotected onInputKeyDown(e: KeyboardEvent): void {\n\t\tif (UtilKeyboardEvent.isOkKey(e)) {\n\t\t\tthis._operation.onEnter();\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport class UtilName {\n\tprotected static _mapping: Record<string, number> = {};\n\n\tstatic create(type: string): string {\n\t\tconst mapping = this._mapping;\n\t\tif (type in mapping) {\n\t\t\treturn `${type} ${++mapping[type]}`;\n\t\t} else {\n\t\t\tmapping[type] = 1;\n\t\t\treturn `${type} 1`;\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport class UtilRgba {\n\tstatic toCode(color: number, alpha: number): string {\n\t\tconst r = (color >> 16) & 0xff;\n\t\tconst g = (color >> 8) & 0xff;\n\t\tconst b = color & 0xff;\n\t\treturn `rgba(${r},${g},${b},${alpha})`;\n\t}\n}\n","import { DBase } from \"../d-base\";\n\nexport class UtilStateBlinker {\n\tprotected _isOn: boolean;\n\tprotected _targets: Set<DBase>;\n\tprotected _state: string;\n\tprotected _delay: number;\n\tprotected _interval: number;\n\tprotected _timeout: number | null;\n\tprotected _updateBound: () => void;\n\n\tconstructor(state: string, delay: number, interval: number) {\n\t\tthis._isOn = true;\n\t\tthis._targets = new Set();\n\t\tthis._state = state;\n\t\tthis._delay = delay;\n\t\tthis._interval = interval;\n\t\tthis._timeout = null;\n\n\t\tconst updateBound = (): void => {\n\t\t\tthis.advance();\n\t\t\tthis.update();\n\t\t\tthis._timeout = window.setTimeout(updateBound, interval);\n\t\t};\n\t\tthis._updateBound = updateBound;\n\t}\n\n\tstart(): this {\n\t\tif (this._timeout == null) {\n\t\t\tthis._timeout = window.setTimeout(this._updateBound, this._delay);\n\t\t}\n\t\treturn this;\n\t}\n\n\tstop(): this {\n\t\tconst timeout = this._timeout;\n\t\tif (timeout != null) {\n\t\t\tthis._timeout = null;\n\t\t\tclearTimeout(timeout);\n\t\t}\n\t\treturn this;\n\t}\n\n\tadd(target: DBase): this {\n\t\tthis._targets.add(target);\n\t\ttarget.state.set(this._state, this.isOn());\n\t\treturn this;\n\t}\n\n\tremove(target: DBase): boolean {\n\t\tif (this._targets.delete(target)) {\n\t\t\ttarget.state.remove(this._state);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tcontains(target: DBase): boolean {\n\t\treturn this._targets.has(target);\n\t}\n\n\tclear(): this {\n\t\tthis._targets.clear();\n\t\treturn this;\n\t}\n\n\tisOn(): boolean {\n\t\treturn this._isOn;\n\t}\n\n\tisOff(): boolean {\n\t\treturn !this._isOn;\n\t}\n\n\tadvance(): this {\n\t\tthis._isOn = !this._isOn;\n\t\treturn this;\n\t}\n\n\tupdate(): this {\n\t\tconst isOn = this.isOn();\n\t\tconst state = this._state;\n\t\tthis._targets.forEach((target: DBase): void => {\n\t\t\ttarget.state.set(state, isOn);\n\t\t});\n\t\treturn this;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBase } from \"../d-base\";\n\nexport interface UtilTransitionOptions {\n\tduration?: number;\n}\n\nexport class UtilTransition {\n\tprotected _duration: number;\n\tprotected _current: DBase | null | undefined;\n\tprotected _lastUpdate: number;\n\tprotected _updateId: number | null;\n\n\tconstructor(options?: UtilTransitionOptions) {\n\t\tthis._duration = options?.duration ?? 300;\n\t\tthis._current = null;\n\t\tthis._lastUpdate = 0;\n\t\tthis._updateId = null;\n\t}\n\n\tshow(next: DBase | null | undefined, forcibly?: boolean): void {\n\t\tconst updateId = this._updateId;\n\t\tif (updateId != null) {\n\t\t\tclearTimeout(updateId);\n\t\t}\n\n\t\tconst current = this._current;\n\t\tif (next !== current) {\n\t\t\tconst duration = this._duration;\n\t\t\tconst lastUpdate = this._lastUpdate;\n\t\t\tconst now = Date.now();\n\t\t\tconst remaining = lastUpdate + duration - now;\n\t\t\tif (forcibly === true || remaining <= 0) {\n\t\t\t\tthis.update(now, next);\n\t\t\t} else {\n\t\t\t\tthis._updateId = window.setTimeout(() => {\n\t\t\t\t\tthis.update(Date.now(), next);\n\t\t\t\t}, remaining);\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected update(now: number, next: DBase | null | undefined): void {\n\t\tconst current = this._current;\n\t\tif (current !== next) {\n\t\t\tthis._lastUpdate = now;\n\n\t\t\tif (current != null) {\n\t\t\t\tcurrent.hide();\n\t\t\t}\n\n\t\t\tthis._current = next;\n\t\t\tif (next != null) {\n\t\t\t\tnext.show();\n\t\t\t}\n\t\t}\n\t}\n\n\thide(): void {\n\t\tthis.show(null);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DThemeFont } from \"../d-font\";\nimport { DThemes } from \"../theme/d-themes\";\n\nexport type UtilWheelEventName = \"wheel\" | \"mousewheel\" | \"DOMMouseScroll\" | \"MozMousePixelScroll\";\n\nexport type UtilWheelEventHandler = (e: WheelEvent | Event) => void;\n\nexport interface UtilWheelEventDeltas {\n\tmode: number;\n\tdelta: number;\n\tdeltaX: number;\n\tdeltaY: number;\n\tlowest: number;\n}\n\n/*!\n * jQuery Mousewheel 3.1.13\n *\n * Copyright jQuery Foundation and other contributors\n * Released under the MIT license\n * http://jquery.org/license\n *\n * See also https://github.com/mapbox/mapbox-gl-js/blob/001c7b9/js/ui/handler/scroll_zoom.js\n * and https://github.com/openlayers/openlayers/blob/v5.2.0/src/ol/interaction/MouseWheelZoom.js#L51\n */\nexport class UtilWheelEvent {\n\tprivate static INSTANCE: UtilWheelEvent | null;\n\tprivate _names?: UtilWheelEventName[];\n\tprivate _lowest: number | null = null;\n\tprivate _timestamp: number = 0;\n\tprivate _lineHeight: number | null = null;\n\tprivate _pageHeight: number | null = null;\n\n\tgetNames(): UtilWheelEventName[] {\n\t\tlet result = this._names;\n\t\tif (result == null) {\n\t\t\tif (\"onwheel\" in document || 9 <= (document as any).documentMode) {\n\t\t\t\tresult = [\"wheel\"];\n\t\t\t} else {\n\t\t\t\tresult = [\"mousewheel\", \"DOMMouseScroll\", \"MozMousePixelScroll\"];\n\t\t\t}\n\t\t\tthis._names = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\ton(target: HTMLElement, handler: UtilWheelEventHandler, useCapture: boolean = false): void {\n\t\tconst names = this.getNames();\n\t\tfor (let i = names.length - 1; 0 <= i; --i) {\n\t\t\tconst name = names[i];\n\t\t\ttarget.addEventListener(name, handler, useCapture);\n\t\t}\n\t}\n\n\toff(target: HTMLElement, handler: UtilWheelEventHandler, useCapture: boolean = false): void {\n\t\tconst names = this.getNames();\n\t\tfor (let i = names.length - 1; 0 <= i; --i) {\n\t\t\tconst name = names[i];\n\t\t\ttarget.removeEventListener(name, handler, useCapture);\n\t\t}\n\t}\n\n\tgetLineHeight(): number {\n\t\tif (this._lineHeight == null) {\n\t\t\tconst theme = DThemes.getInstance().get(\"DBase\") as DThemeFont;\n\t\t\tthis._lineHeight = theme.getLineHeight();\n\t\t}\n\t\treturn this._lineHeight;\n\t}\n\n\tgetPageHeight(): number {\n\t\tif (this._pageHeight == null) {\n\t\t\tthis._pageHeight = this.getLineHeight() * 12;\n\t\t}\n\t\treturn this._pageHeight;\n\t}\n\n\tnormalize(e: any): UtilWheelEventDeltas | null {\n\t\tlet deltaX = 0;\n\t\tlet deltaY = 0;\n\n\t\t// Old school scrollwheel delta\n\t\tif (\"detail\" in e) {\n\t\t\tdeltaY = e.detail * -1;\n\t\t}\n\t\tif (\"wheelDelta\" in e) {\n\t\t\tdeltaY = e.wheelDelta;\n\t\t}\n\t\tif (\"wheelDeltaY\" in e) {\n\t\t\tdeltaY = e.wheelDeltaY;\n\t\t}\n\t\tif (\"wheelDeltaX\" in e) {\n\t\t\tdeltaX = e.wheelDeltaX * -1;\n\t\t}\n\n\t\t// Firefox < 17 horizontal scrolling related to DOMMouseScroll event\n\t\tif (\"axis\" in e && e.axis === e.HORIZONTAL_AXIS) {\n\t\t\tdeltaX = deltaY * -1;\n\t\t\tdeltaY = 0;\n\t\t}\n\n\t\t// New school wheel delta (wheel event)\n\t\tif (\"deltaY\" in e) {\n\t\t\tdeltaY = e.deltaY * -1;\n\t\t}\n\t\tif (\"deltaX\" in e) {\n\t\t\tdeltaX = e.deltaX;\n\t\t}\n\n\t\t// No change actually happened, no reason to go any further\n\t\tif (deltaY === 0 && deltaX === 0) {\n\t\t\treturn null;\n\t\t}\n\n\t\t// Store lowest absolute delta to normalize the delta values\n\t\tlet delta = Math.max(Math.abs(deltaY), Math.abs(deltaX));\n\n\t\t// Reset the this._lowest to better handle multiple device types\n\t\t// that give different a different lowestDelta\n\t\t// Ex: trackpad = 3 and mouse wheel = 120\n\t\tconst now = Date.now();\n\t\tif (this._timestamp + 200 <= now) {\n\t\t\tthis._lowest = null;\n\t\t}\n\t\tthis._timestamp = now;\n\n\t\t//\n\t\tconst shouldAdjust = e.type === \"mousewheel\" && delta % 120 === 0;\n\t\tif (!this._lowest || delta < this._lowest) {\n\t\t\tthis._lowest = delta;\n\n\t\t\t// Adjust older deltas if necessary\n\t\t\tif (shouldAdjust) {\n\t\t\t\tthis._lowest /= 40;\n\t\t\t}\n\t\t}\n\n\t\t// Adjust older deltas if necessary\n\t\tif (shouldAdjust) {\n\t\t\t// Divide all the things by 40!\n\t\t\tdelta /= 40;\n\t\t\tdeltaX /= 40;\n\t\t\tdeltaY /= 40;\n\t\t}\n\n\t\t// Get a whole, normalized value for the deltas\n\t\tconst lowest = this._lowest;\n\t\tdelta = Math.floor(delta / lowest);\n\t\tdeltaX = Math[1 <= deltaX ? \"floor\" : \"ceil\"](deltaX / lowest);\n\t\tdeltaY = Math[1 <= deltaY ? \"floor\" : \"ceil\"](deltaY / lowest);\n\n\t\t// Mode\n\t\tconst mode = e.deltaMode || 0;\n\t\tif (mode !== 0) {\n\t\t\tconst scale = mode === 1 ? this.getLineHeight() : this.getPageHeight();\n\t\t\tdelta *= scale;\n\t\t\tdeltaX *= scale;\n\t\t\tdeltaY *= scale;\n\t\t}\n\n\t\treturn {\n\t\t\tmode,\n\t\t\tdelta,\n\t\t\tdeltaX,\n\t\t\tdeltaY,\n\t\t\tlowest\n\t\t};\n\t}\n\n\tstatic getInstance(): UtilWheelEvent {\n\t\tif (this.INSTANCE == null) {\n\t\t\tthis.INSTANCE = new UtilWheelEvent();\n\t\t}\n\t\treturn this.INSTANCE;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { utils } from \"pixi.js\";\nimport { DAnimation, DAnimationOnEnd, DAnimationOnTime, DAnimationOptions } from \"./d-animation\";\n\nexport class DAnimationEmpty<TARGET = unknown>\n\textends utils.EventEmitter\n\timplements DAnimation<TARGET>\n{\n\tprotected _reverse: boolean;\n\tprotected _onTime: DAnimationOnTime<TARGET> | undefined;\n\tprotected _onStart: DAnimationOnEnd<TARGET> | undefined;\n\tprotected _onEnd: DAnimationOnEnd<TARGET> | undefined;\n\tprotected _target: TARGET | null;\n\tprotected _isStarted: boolean;\n\n\tconstructor(options?: DAnimationOptions<TARGET>) {\n\t\tsuper();\n\n\t\tthis._target = options?.target ?? null;\n\t\tthis._reverse = false;\n\t\tthis._isStarted = false;\n\t\tthis._onTime = options?.onTime;\n\t\tthis._onStart = options?.onStart;\n\t\tthis._onEnd = options?.onEnd;\n\t}\n\n\tget target(): TARGET | null {\n\t\treturn this._target;\n\t}\n\n\tset target(target: TARGET | null) {\n\t\tthis._target = target;\n\t}\n\n\tget duration(): number {\n\t\treturn 0;\n\t}\n\n\tset duration(duration: number) {\n\t\t// DO NOTHING\n\t}\n\n\tstart(reverse: boolean = false): void {\n\t\tthis.stop();\n\t\tthis._isStarted = true;\n\t\tthis._reverse = reverse;\n\n\t\t// onStart\n\t\tthis.onStart(reverse);\n\t\tif (!this._isStarted) {\n\t\t\treturn;\n\t\t}\n\n\t\t// onTime\n\t\tthis.onTime(reverse ? 1 : 0, reverse, 0);\n\t\tif (!this._isStarted) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.onTime(reverse ? 0 : 1, reverse, 0);\n\t\tif (this._isStarted) {\n\t\t\treturn;\n\t\t}\n\n\t\t// OnEnd\n\t\tthis.onEnd(reverse);\n\t}\n\n\tprotected onStart(isReverse: boolean): void {\n\t\tconst onStart = this._onStart;\n\t\tif (onStart != null) {\n\t\t\tonStart(isReverse, this);\n\t\t}\n\t\tthis.emit(\"start\", isReverse, this);\n\t}\n\n\tprotected onTime(time: number, isReverse: boolean, elapsedTime: number): void {\n\t\tconst onTime = this._onTime;\n\t\tif (onTime != null) {\n\t\t\tonTime(time, isReverse, elapsedTime, this);\n\t\t}\n\t\tthis.emit(\"time\", time, isReverse, elapsedTime, this);\n\t}\n\n\tprotected onEnd(isReverse: boolean): void {\n\t\tconst onEnd = this._onEnd;\n\t\tif (onEnd != null) {\n\t\t\tonEnd(isReverse, this);\n\t\t}\n\t\tthis.emit(\"end\", isReverse, this);\n\t}\n\n\tisStarted(): boolean {\n\t\treturn this._isStarted;\n\t}\n\n\tisReverse(): boolean {\n\t\treturn this._reverse;\n\t}\n\n\tstop(): void {\n\t\tthis._isStarted = false;\n\t}\n\n\tend(): void {\n\t\tconst isStarted = this._isStarted;\n\t\tif (isStarted) {\n\t\t\tthis._isStarted = false;\n\n\t\t\t// OnTime\n\t\t\tconst reverse = this._reverse;\n\t\t\tconst time = reverse ? 0 : 1;\n\t\t\tthis.onTime(time, reverse, 0);\n\n\t\t\t// OnEnd\n\t\t\tthis.onEnd(reverse);\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DThemeBase } from \"./d-base\";\nimport { DPadding, DPaddingLike } from \"./d-padding\";\nimport { isNumber } from \"./util/is-number\";\n\nexport class DApplicationPadding implements DPadding {\n\ttop: number;\n\tright: number;\n\tbottom: number;\n\tleft: number;\n\n\tconstructor(padding?: number | DPaddingLike) {\n\t\tif (isNumber(padding)) {\n\t\t\tthis.top = padding;\n\t\t\tthis.right = padding;\n\t\t\tthis.bottom = padding;\n\t\t\tthis.left = padding;\n\t\t} else if (padding != null) {\n\t\t\tthis.top = padding.top ?? 6;\n\t\t\tthis.right = padding.right ?? 6;\n\t\t\tthis.bottom = padding.bottom ?? 6;\n\t\t\tthis.left = padding.left ?? 6;\n\t\t} else {\n\t\t\tthis.top = 6;\n\t\t\tthis.right = 6;\n\t\t\tthis.bottom = 6;\n\t\t\tthis.left = 6;\n\t\t}\n\t}\n\n\tgetTheme(): DThemeBase {\n\t\tthrow new Error(\"Not supported\");\n\t}\n\n\tsetTheme(theme: DThemeBase): void {\n\t\tthrow new Error(\"Not supported\");\n\t}\n\n\tgetTop(): number {\n\t\treturn this.left;\n\t}\n\n\tgetRight(): number {\n\t\treturn this.right;\n\t}\n\n\tgetBottom(): number {\n\t\treturn this.bottom;\n\t}\n\n\tgetLeft(): number {\n\t\treturn this.left;\n\t}\n\n\tset(padding: number): void;\n\tset(topAndBottom: number, leftAndRight: number): void;\n\tset(top: number, leftAndRight: number, bottom: number): void;\n\tset(top: number, right?: number, bottom?: number, left?: number): void {\n\t\tif (right == null) {\n\t\t\tthis.top = top;\n\t\t\tthis.right = top;\n\t\t\tthis.bottom = top;\n\t\t\tthis.left = top;\n\t\t} else if (bottom == null) {\n\t\t\tthis.top = top;\n\t\t\tthis.right = right;\n\t\t\tthis.bottom = top;\n\t\t\tthis.left = right;\n\t\t} else if (left == null) {\n\t\t\tthis.top = top;\n\t\t\tthis.right = right;\n\t\t\tthis.bottom = bottom;\n\t\t\tthis.left = right;\n\t\t} else {\n\t\t\tthis.top = top;\n\t\t\tthis.right = right;\n\t\t\tthis.bottom = bottom;\n\t\t\tthis.left = left;\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DApplicationPadding } from \"./d-application-padding\";\nimport { DPadding, DPaddingLike } from \"./d-padding\";\n\n/**\n * PixiJS options\n */\nexport interface PixiApplicationOptions {\n\twidth: number;\n\theight: number;\n\tautoStart: boolean;\n\tbackgroundColor: number;\n\ttransparent: boolean;\n\tresolution: number;\n\tantialias: boolean;\n}\n\nexport interface DApplicationLayerBackgroundOptions {\n\tcolor?: number | null;\n}\n\nexport interface DApplicationLayerOptionsOptions {\n\troot: HTMLElement;\n\tpadding?: number | DPaddingLike;\n\twidth?: number;\n\theight?: number;\n\tbackground?: DApplicationLayerBackgroundOptions;\n\tresolution: number;\n\tantialias?: boolean;\n\n\t/**\n\t * Sets to true if a layer is a overlay layer.\n\t */\n\toverlay: boolean;\n}\n\n/**\n * DApplicationLayer options\n */\nexport class DApplicationLayerOptions {\n\tprivate _root: HTMLElement;\n\tprivate _pixi: PixiApplicationOptions;\n\tprivate _padding: DPadding;\n\tprivate _overlay: boolean;\n\n\tconstructor(options: DApplicationLayerOptionsOptions) {\n\t\t// Root\n\t\tconst root = options.root;\n\t\tthis._root = root;\n\n\t\t// Overlay mode or not\n\t\tthis._overlay = options.overlay;\n\n\t\t// Padding\n\t\tthis._padding = new DApplicationPadding(options?.padding);\n\n\t\t// Width & height\n\t\tlet width = 100;\n\t\tlet height = 100;\n\t\tif (options) {\n\t\t\tif (options.width != null) {\n\t\t\t\twidth = options.width;\n\t\t\t\tif (options.height != null) {\n\t\t\t\t\theight = options.height;\n\t\t\t\t} else {\n\t\t\t\t\theight = root.getBoundingClientRect().height;\n\t\t\t\t}\n\t\t\t} else if (options.height != null) {\n\t\t\t\twidth = root.getBoundingClientRect().width;\n\t\t\t\theight = options.height;\n\t\t\t} else {\n\t\t\t\tconst bbox = root.getBoundingClientRect();\n\t\t\t\twidth = bbox.width;\n\t\t\t\theight = bbox.height;\n\t\t\t}\n\t\t} else {\n\t\t\tconst bbox = root.getBoundingClientRect();\n\t\t\twidth = bbox.width;\n\t\t\theight = bbox.height;\n\t\t}\n\n\t\t// Background color\n\t\tconst background = options?.background;\n\t\tlet backgroundColor = 0;\n\t\tlet transparent = true;\n\t\tif (background != null) {\n\t\t\tconst color = background.color;\n\t\t\tif (color != null) {\n\t\t\t\tbackgroundColor = color;\n\t\t\t\ttransparent = false;\n\t\t\t}\n\t\t}\n\n\t\t// Resolution\n\t\tconst resolution = options.resolution;\n\n\t\t// Antialias\n\t\tconst antialias = options?.antialias ?? false;\n\n\t\t// Pixi\n\t\tthis._pixi = {\n\t\t\twidth,\n\t\t\theight,\n\t\t\tautoStart: false,\n\t\t\tbackgroundColor,\n\t\t\ttransparent,\n\t\t\tresolution,\n\t\t\tantialias\n\t\t};\n\t}\n\n\t/**\n\t * Returns a root element.\n\t * `HTMLCanvasElement` and other DOM elements are created in this element.\n\t * The default root element is `document.body`.\n\t */\n\tgetRootElement(): HTMLElement {\n\t\treturn this._root;\n\t}\n\n\t/**\n\t * Sets a root element and updates the canvas width and height\n\t * if `updateWidthAndHeight` is not false.\n\t *\n\t * @param root new root element\n\t * @param updateWidthAndHeight false to preserve the canvas width / height\n\t */\n\tsetRootElement(root: HTMLElement, updateWidthAndHeight?: boolean): this {\n\t\tif (this._root !== root) {\n\t\t\tthis._root = root;\n\t\t\tif (updateWidthAndHeight !== false) {\n\t\t\t\tconst bbox = root.getBoundingClientRect();\n\t\t\t\tconst pixi = this._pixi;\n\t\t\t\tpixi.width = bbox.width;\n\t\t\t\tpixi.height = bbox.height;\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n\n\t/**\n\t * Returns a canvas width.\n\t */\n\tgetWidth(): number {\n\t\treturn this._pixi.width;\n\t}\n\n\t/**\n\t * Sets a canvas width.\n\t *\n\t * @param width new canvas width\n\t */\n\tsetWidth(width: number): this {\n\t\tthis._pixi.width = width;\n\t\treturn this;\n\t}\n\n\t/**\n\t * Returns a canvas height.\n\t */\n\tgetHeight(): number {\n\t\treturn this._pixi.height;\n\t}\n\n\t/**\n\t * Sets a canvas height.\n\t *\n\t * @param height new canvas height\n\t */\n\tsetHeight(height: number): this {\n\t\tthis._pixi.height = height;\n\t\treturn this;\n\t}\n\n\t/**\n\t * Returns padding sizes.\n\t * The default padding size is 6.\n\t */\n\tgetPadding(): DPadding {\n\t\treturn this._padding;\n\t}\n\n\t/**\n\t * Sets padding sizes.\n\t *\n\t * @param left new left padding\n\t * @param top new top padding\n\t * @param right new right padding\n\t * @param bottom new bottom padding\n\t */\n\tsetPadding(left: number, top: number, right: number, bottom: number): this {\n\t\tconst padding = this._padding;\n\t\tpadding.left = left;\n\t\tpadding.top = top;\n\t\tpadding.right = right;\n\t\tpadding.bottom = bottom;\n\t\treturn this;\n\t}\n\n\t/**\n\t * Returns a background color.\n\t */\n\tgetBackgroundColor(): number {\n\t\treturn this._pixi.backgroundColor;\n\t}\n\n\t/**\n\t * Sets a background color.\n\t *\n\t * @param color new background color\n\t */\n\tsetBackgroundColor(color: number): this {\n\t\tthis._pixi.backgroundColor = color;\n\t\treturn this;\n\t}\n\n\t/**\n\t * Returns an antialias setting.\n\t * The default antialias setting is false.\n\t */\n\tgetAntialias(): boolean {\n\t\treturn this._pixi.antialias;\n\t}\n\n\t/**\n\t * Sets an antialias setting.\n\t *\n\t * @param antialias new antialias setting\n\t */\n\tsetAntialias(antialias: boolean): this {\n\t\tthis._pixi.antialias = antialias;\n\t\treturn this;\n\t}\n\n\t/**\n\t * Returns true if a layer is supposed to be an overlay layer.\n\t */\n\tisOverlay(): boolean {\n\t\treturn this._overlay;\n\t}\n\n\tgetPixiApplicationOptions(): PixiApplicationOptions {\n\t\treturn this._pixi;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const DCommandFlag = {\n\tNONE: 0,\n\n\t/**\n\t * Commands with a `UNSTORABLE` flag will not be queued to the `done` queue.\n\t */\n\tUNSTORABLE: 1,\n\n\t/**\n\t * Commands with a `CLEAR` flag clears the command queue.\n\t */\n\tCLEAR: 2\n} as const;\n\nexport type DCommandFlag = number;\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DCommand } from \"./d-command\";\nimport { DCommandFlag } from \"./d-command-flag\";\n\nexport class DCommandClear implements DCommand {\n\texecute(): Promise<unknown> | boolean {\n\t\treturn true;\n\t}\n\n\tredo(): Promise<unknown> | boolean {\n\t\tthrow new Error(\"Method not implemented.\");\n\t}\n\n\tundo(): Promise<unknown> | boolean {\n\t\tthrow new Error(\"Method not implemented.\");\n\t}\n\n\tdestroy(): void {\n\t\t// DO NOTHING\n\t}\n\n\tgetFlag(): DCommandFlag {\n\t\treturn DCommandFlag.UNSTORABLE | DCommandFlag.CLEAR;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DCommand } from \"./d-command\";\nimport { DCommandFlag } from \"./d-command-flag\";\n\nexport class DCommandRedo implements DCommand {\n\texecute(): Promise<void> | boolean {\n\t\tthrow new Error(\"Not supported\");\n\t}\n\n\tredo(): Promise<void> | boolean {\n\t\tthrow new Error(\"Not supported\");\n\t}\n\n\tundo(): Promise<void> | boolean {\n\t\tthrow new Error(\"Not supported\");\n\t}\n\n\tdestroy(): void {\n\t\t// DO NOTHING\n\t}\n\n\tgetFlag(): DCommandFlag {\n\t\treturn DCommandFlag.UNSTORABLE;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DCommand } from \"./d-command\";\nimport { DCommandFlag } from \"./d-command-flag\";\n\nexport class DCommandUndo implements DCommand {\n\texecute(): Promise<void> | boolean {\n\t\tthrow new Error(\"Not supported\");\n\t}\n\n\tredo(): Promise<void> | boolean {\n\t\tthrow new Error(\"Not supported\");\n\t}\n\n\tundo(): Promise<void> | boolean {\n\t\tthrow new Error(\"Not supported\");\n\t}\n\n\tdestroy(): void {\n\t\t// DO NOTHING\n\t}\n\n\tgetFlag(): DCommandFlag {\n\t\treturn DCommandFlag.UNSTORABLE;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { utils } from \"pixi.js\";\nimport { DCommand } from \"./d-command\";\nimport { DCommandClear } from \"./d-command-clear\";\nimport { DCommandFlag } from \"./d-command-flag\";\nimport { DCommandRedo } from \"./d-command-redo\";\nimport { DCommandUndo } from \"./d-command-undo\";\nimport { DControllerCommand } from \"./d-controller-command\";\n\nconst isCommandStorable = (command: DCommand): boolean => {\n\treturn !(command.getFlag() & DCommandFlag.UNSTORABLE);\n};\n\nconst isCommandClear = (command: DCommand): boolean => {\n\treturn !!(command.getFlag() & DCommandFlag.CLEAR);\n};\n\nexport class DControllerDefaultCommand extends utils.EventEmitter implements DControllerCommand {\n\tprotected _position: number;\n\tprotected _done: DCommand[];\n\tprotected _waiting: DCommand[];\n\tprotected _executing: Promise<void> | null;\n\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis._position = 0;\n\t\tthis._done = [];\n\t\tthis._waiting = [];\n\t\tthis._executing = null;\n\t}\n\n\tlast(): DCommand | null {\n\t\tconst done = this._done;\n\t\tconst waiting = this._waiting;\n\n\t\tif (waiting.length <= 0) {\n\t\t\tif (0 < done.length) {\n\t\t\t\treturn done[done.length - 1];\n\t\t\t} else {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t} else {\n\t\t\treturn waiting[waiting.length - 1];\n\t\t}\n\t}\n\n\tpush(command: DCommand): void {\n\t\tconst waiting = this._waiting;\n\t\twaiting.push(command);\n\t\tthis.next();\n\t}\n\n\tnext(): void {\n\t\tif (this._executing == null) {\n\t\t\tconst waiting = this._waiting;\n\t\t\tif (0 < waiting.length) {\n\t\t\t\tconst command = waiting.shift();\n\t\t\t\tif (command != null) {\n\t\t\t\t\tif (command instanceof DCommandUndo) {\n\t\t\t\t\t\tconst done = this._done;\n\t\t\t\t\t\tif (this._position < done.length) {\n\t\t\t\t\t\t\tconst current = done[done.length - 1 - this._position];\n\t\t\t\t\t\t\tthis._position += 1;\n\t\t\t\t\t\t\tthis.emit(\"change\", this);\n\t\t\t\t\t\t\tconst result = current.undo();\n\t\t\t\t\t\t\tif (result === true) {\n\t\t\t\t\t\t\t\tthis.onSuccess(command);\n\t\t\t\t\t\t\t} else if (result === false) {\n\t\t\t\t\t\t\t\tthis.onFail(command);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tthis._executing = result.then(\n\t\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\t\tthis.onSuccess(command);\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\t\tthis.onFail(command);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (command instanceof DCommandRedo) {\n\t\t\t\t\t\tconst done = this._done;\n\t\t\t\t\t\tif (0 < this._position) {\n\t\t\t\t\t\t\tconst current = done[done.length - this._position];\n\t\t\t\t\t\t\tthis._position -= 1;\n\t\t\t\t\t\t\tthis.emit(\"change\", this);\n\t\t\t\t\t\t\tconst result = current.redo();\n\t\t\t\t\t\t\tif (result === true) {\n\t\t\t\t\t\t\t\tthis.onSuccess(command);\n\t\t\t\t\t\t\t} else if (result === false) {\n\t\t\t\t\t\t\t\tthis.onFail(command);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tthis._executing = result.then(\n\t\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\t\tthis.onSuccess(command);\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\t\tthis.onFail(command);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst isClear = isCommandClear(command);\n\t\t\t\t\t\tconst isStorable = isCommandStorable(command);\n\t\t\t\t\t\tif (isClear || isStorable) {\n\t\t\t\t\t\t\tconst size = isClear ? this._done.length : this._position;\n\t\t\t\t\t\t\tif (0 < size) {\n\t\t\t\t\t\t\t\tthis.remove(size);\n\t\t\t\t\t\t\t\tthis._position = 0;\n\t\t\t\t\t\t\t\tthis.emit(\"change\", this);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tthis.cleanup();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst result = command.execute();\n\t\t\t\t\t\tif (result === true) {\n\t\t\t\t\t\t\tthis.onSuccess(command);\n\t\t\t\t\t\t} else if (result === false) {\n\t\t\t\t\t\t\tthis.onFail(command);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis._executing = result.then(\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\tthis.onSuccess(command);\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\tthis.onFail(command);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected cleanup(): void {\n\t\tconst done = this._done;\n\t\tconst size = done.length - 100;\n\t\tif (0 < size) {\n\t\t\tfor (let i = 0; i < size; ++i) {\n\t\t\t\tdone[i].destroy();\n\t\t\t\tdone.shift();\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected remove(size: number): boolean {\n\t\tconst done = this._done;\n\t\tif (0 < size) {\n\t\t\tconst ifrom = Math.max(0, done.length - size);\n\t\t\tsize = done.length - ifrom;\n\t\t\tif (0 < size) {\n\t\t\t\tfor (let i = ifrom, imax = done.length; i < imax; ++i) {\n\t\t\t\t\tdone[i].destroy();\n\t\t\t\t}\n\n\t\t\t\tdone.splice(ifrom, done.length - ifrom);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tprotected onSuccess(command: DCommand): void {\n\t\tthis._executing = null;\n\t\tif (isCommandStorable(command)) {\n\t\t\tthis._done.push(command);\n\t\t\tthis.emit(\"dirty\", this);\n\t\t} else if (command instanceof DCommandUndo || command instanceof DCommandRedo) {\n\t\t\tthis.emit(\"dirty\", this);\n\t\t}\n\t\tthis.emit(\"change\", this);\n\t\tthis.next();\n\t}\n\n\tprotected onFail(command: DCommand): void {\n\t\tthis._executing = null;\n\t\tconst waiting = this._waiting;\n\t\tcommand.destroy();\n\t\tfor (let i = 0, imax = waiting.length; i < imax; ++i) {\n\t\t\twaiting[i].destroy();\n\t\t}\n\t\twaiting.length = 0;\n\t\tthis.emit(\"change\", this);\n\t}\n\n\tsize(): number {\n\t\treturn this._done.length;\n\t}\n\n\tclear(): void {\n\t\tthis.push(new DCommandClear());\n\t}\n\n\tredo(): void {\n\t\tif (this.isRedoable()) {\n\t\t\tthis._waiting.push(new DCommandRedo());\n\t\t\tthis.next();\n\t\t}\n\t}\n\n\tundo(): void {\n\t\tif (this.isUndoable()) {\n\t\t\tthis._waiting.push(new DCommandUndo());\n\t\t\tthis.next();\n\t\t}\n\t}\n\n\tisRedoable(): boolean {\n\t\treturn 0 < this._position && this._executing == null;\n\t}\n\n\tisUndoable(): boolean {\n\t\treturn this._position < this._done.length && this._executing == null;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Container, utils } from \"pixi.js\";\nimport { DControllerFocus, DFocusable, DFocusableContainer } from \"./d-controller-focus\";\nimport { UtilKeyboardEvent } from \"./util/util-keyboard-event\";\n\nexport class DControllerKeyboard extends utils.EventEmitter {\n\tinit(element: HTMLElement, stage: Container, focusController: DControllerFocus): void {\n\t\telement.addEventListener(\"keydown\", (e: KeyboardEvent): void => {\n\t\t\tthis.emit(\"keydown\", e);\n\n\t\t\tconst focused = focusController.get();\n\t\t\tif (focused != null) {\n\t\t\t\tlet current: DFocusable | DFocusableContainer | null = focused;\n\t\t\t\twhile (current != null) {\n\t\t\t\t\tif (this.hasOnKeyDown(current)) {\n\t\t\t\t\t\tif (current.onKeyDown(e)) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tcurrent = current.parent;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (UtilKeyboardEvent.isFocusKey(e)) {\n\t\t\t\tconst direction = UtilKeyboardEvent.getFocusDirection(e);\n\t\t\t\tconst next =\n\t\t\t\t\tfocused != null\n\t\t\t\t\t\t? focusController.find(\n\t\t\t\t\t\t\t\tfocused,\n\t\t\t\t\t\t\t\tfalse,\n\t\t\t\t\t\t\t\tfocused.state.isFocusRoot || direction,\n\t\t\t\t\t\t\t\tdirection\n\t\t\t\t\t\t  )\n\t\t\t\t\t\t: focusController.find(stage, false, true, direction);\n\t\t\t\tif (next != null) {\n\t\t\t\t\tfocusController.focus(next);\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\telement.addEventListener(\"keyup\", (e: KeyboardEvent): void => {\n\t\t\tthis.emit(\"keyup\", e);\n\n\t\t\tconst focused = focusController.get();\n\t\t\tif (focused != null) {\n\t\t\t\tlet current: DFocusable | DFocusableContainer | null = focused;\n\t\t\t\twhile (current != null) {\n\t\t\t\t\tif (this.hasOnKeyUp(current)) {\n\t\t\t\t\t\tif (current.onKeyUp(e)) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tcurrent = current.parent;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tprotected hasOnKeyDown(target: any): target is { onKeyDown(e: KeyboardEvent): boolean } {\n\t\treturn \"onKeyDown\" in target;\n\t}\n\n\tprotected hasOnKeyUp(target: any): target is { onKeyUp(e: KeyboardEvent): boolean } {\n\t\treturn \"onKeyUp\" in target;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DControllerCommand } from \"./d-controller-command\";\nimport { DControllerDefaultCommand } from \"./d-controller-default-command\";\nimport { DControllerDocument } from \"./d-controller-document\";\nimport { DControllerKeyboard } from \"./d-controller-keyboard\";\nimport { DDocument } from \"./d-document\";\n\nexport class DControllers {\n\tprotected static KEYBOARD: DControllerKeyboard | null;\n\tprotected static COMMAND: DControllerCommand | null;\n\tprotected static DOCUMENT: DControllerDocument<any> | null;\n\n\t// Keyboard\n\tstatic getKeyboardController(): DControllerKeyboard {\n\t\tif (this.KEYBOARD == null) {\n\t\t\tthis.KEYBOARD = new DControllerKeyboard();\n\t\t}\n\t\treturn this.KEYBOARD;\n\t}\n\n\tstatic setKeyboardController(instance: DControllerKeyboard): DControllerKeyboard | null {\n\t\tconst result = this.KEYBOARD;\n\t\tthis.KEYBOARD = instance;\n\t\treturn result;\n\t}\n\n\t// Command\n\tstatic getCommandController(): DControllerCommand {\n\t\tif (this.COMMAND == null) {\n\t\t\tthis.COMMAND = new DControllerDefaultCommand();\n\t\t}\n\t\treturn this.COMMAND;\n\t}\n\n\tstatic setCommandController(instance: DControllerCommand): DControllerCommand | null {\n\t\tconst result = this.COMMAND;\n\t\tthis.COMMAND = instance;\n\t\treturn result;\n\t}\n\n\t// Document\n\tstatic getDocumentController<DOCUMENT extends DDocument>(): DControllerDocument<DOCUMENT> {\n\t\tif (this.DOCUMENT == null) {\n\t\t\tthrow new Error(\"Not supported\");\n\t\t}\n\t\treturn this.DOCUMENT;\n\t}\n\n\tstatic setDocumentController<DOCUMENT extends DDocument>(\n\t\tinstance: DControllerDocument<DOCUMENT>\n\t): DControllerDocument<DOCUMENT> | null {\n\t\tconst result = this.DOCUMENT;\n\t\tthis.DOCUMENT = instance;\n\t\treturn result;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Application, interaction, Point } from \"pixi.js\";\nimport { DApplicationLayerLike } from \"./d-application-layer-like\";\nimport { DApplicationLayerOptions } from \"./d-application-layer-options\";\nimport { DApplicationLike } from \"./d-application-like\";\nimport { DBase } from \"./d-base\";\nimport { DControllerFocus, DFocusable, DFocusableContainer } from \"./d-controller-focus\";\nimport { DControllers } from \"./d-controllers\";\nimport { DPadding } from \"./d-padding\";\nimport { DynamicFontAtlases } from \"./util/dynamic-font-atlases\";\nimport { UtilPointerEvent } from \"./util/util-pointer-event\";\nimport { UtilWheelEvent, UtilWheelEventDeltas } from \"./util/util-wheel-event\";\n\ninterface DblClickable {\n\tonDblClick(\n\t\te: MouseEvent | TouchEvent,\n\t\tinteractionManager: interaction.InteractionManager\n\t): boolean;\n}\n\nconst isDblClickable = (target: any): target is DblClickable => {\n\treturn target != null && target.onDblClick != null;\n};\n\ninterface Wheelable {\n\tonWheel(e: WheelEvent, deltas: UtilWheelEventDeltas, global: Point): boolean;\n}\n\nconst isWheelable = (target: any): target is Wheelable => {\n\treturn target != null && target.onWheel != null;\n};\n\nexport class DApplicationLayer extends Application implements DApplicationLayerLike {\n\tprotected _options: DApplicationLayerOptions;\n\tprotected _renderId: number | null = null;\n\tprotected _renderBound: () => void;\n\tprotected _isLocked: boolean;\n\tprotected _isOverlay: boolean;\n\tprotected _refitLimit: number;\n\tprotected _reflowLimit: number;\n\tprotected _rootElement: HTMLElement;\n\tprotected _elementContainer: HTMLElement;\n\tprotected _padding: DPadding;\n\tprotected _dynamicFontAtlases: DynamicFontAtlases | null = null;\n\tprotected _isVisible: boolean;\n\n\treadonly application: DApplicationLike;\n\n\tconstructor(application: DApplicationLike, options: DApplicationLayerOptions) {\n\t\tsuper(options.getPixiApplicationOptions());\n\n\t\tthis._options = options;\n\t\tthis._isLocked = false;\n\t\tthis._isVisible = true;\n\t\tthis._isOverlay = options.isOverlay();\n\t\tthis._padding = options.getPadding();\n\t\tthis._rootElement = options.getRootElement();\n\t\tthis._refitLimit = 5;\n\t\tthis._reflowLimit = 5;\n\t\tthis._elementContainer = this.newElementContainer();\n\n\t\tthis.application = application;\n\n\t\tthis._renderBound = (): void => {\n\t\t\tif (this._renderId != null) {\n\t\t\t\tthis.render();\n\t\t\t}\n\t\t};\n\n\t\tthis.initStage();\n\t\tthis.initView();\n\t\tthis.initRootElement();\n\t\tthis.initFocusHandling();\n\t\tthis.initResizeHandling();\n\t\tthis.initWheelHandling();\n\t\tthis.initDoubleClickHandling();\n\t}\n\n\tprotected newElementContainer(): HTMLElement {\n\t\tconst result = document.createElement(\"div\");\n\t\tresult.setAttribute(\n\t\t\t\"style\",\n\t\t\t\"position: absolute; top: 0; left: 0; width: 0; height: 0;\" +\n\t\t\t\t\"margin: 0; padding: 0; outline: none;\"\n\t\t);\n\t\treturn result;\n\t}\n\n\tprotected initStage(): void {\n\t\tconst stage = this.stage;\n\t\t(stage as any).layer = this;\n\t\t(stage as any).application = this.application;\n\t\tstage.interactive = true;\n\t}\n\n\tprotected initView(): void {\n\t\tconst view = this.view;\n\t\tconst style = view.style;\n\t\tstyle.position = \"absolute\";\n\t\tstyle.top = \"0\";\n\t\tstyle.left = \"0\";\n\t\tstyle.width = \"100%\";\n\t\tstyle.height = \"100%\";\n\t\tstyle.display = \"block\";\n\t\tstyle.outline = \"none\";\n\t\t(style as any).webkitTapHighlightColor = \"rgba(255,255,255,0)\";\n\t\tstyle.webkitUserSelect = \"none\";\n\t\tstyle.setProperty(\"-khtml-user-select\", \"none\");\n\t\tstyle.setProperty(\"-moz-user-select\", \"none\");\n\t\tstyle.setProperty(\"-ms-user-select\", \"none\");\n\t\tstyle.userSelect = \"none\";\n\t}\n\n\tprotected initRootElement(): void {\n\t\tconst view = this.view;\n\t\tconst isOverlay = this._isOverlay;\n\t\tconst rootElement = this._rootElement;\n\t\tconst elementContainer = this._elementContainer;\n\n\t\t// Insert elements\n\t\tconst insertionPosition = isOverlay ? 2 : 0;\n\t\tconst children = rootElement.children;\n\t\tif (insertionPosition < children.length) {\n\t\t\tconst child = children[insertionPosition];\n\t\t\trootElement.insertBefore(view, child);\n\t\t\trootElement.insertBefore(elementContainer, child);\n\t\t} else {\n\t\t\trootElement.appendChild(view);\n\t\t\trootElement.appendChild(elementContainer);\n\t\t}\n\n\t\tif (isOverlay) {\n\t\t\tconst stage = this.stage;\n\t\t\tconst oldOnChildrenChange = (stage as any).onChildrenChange;\n\t\t\t(stage as any).onChildrenChange = (): void => {\n\t\t\t\tthis.onStageDirty();\n\t\t\t\toldOnChildrenChange.call(stage);\n\t\t\t};\n\t\t}\n\n\t\t// Init styles\n\t\tconst rootElementStyle = rootElement.style;\n\t\tif (rootElement !== document.body) {\n\t\t\tconst rootElementStylePosition = window.getComputedStyle(rootElement).position;\n\t\t\tif (rootElementStylePosition === \"static\") {\n\t\t\t\trootElementStyle.position = \"relative\";\n\t\t\t}\n\t\t}\n\t\trootElementStyle.margin = \"0\";\n\t\trootElementStyle.padding = \"0\";\n\t\trootElementStyle.overflow = \"hidden\";\n\t}\n\n\tprotected initFocusHandling(): void {\n\t\tconst view = this.view;\n\t\tconst stage = this.stage;\n\t\tconst focusController = this.getFocusController();\n\n\t\tview.setAttribute(\"tabindex\", \"0\");\n\n\t\tDControllers.getKeyboardController().init(view, stage, focusController);\n\n\t\tconst interactionManager = this.renderer.plugins.interaction;\n\t\tinteractionManager.on(UtilPointerEvent.down, (e: interaction.InteractionEvent): void => {\n\t\t\tif (e.target == null || e.target === stage) {\n\t\t\t\tfocusController.clear();\n\t\t\t}\n\t\t});\n\t}\n\n\tprotected initResizeHandling(): void {\n\t\tconst onResizeBound = (): void => {\n\t\t\tthis.onResize();\n\t\t};\n\t\twindow.addEventListener(\"resize\", onResizeBound);\n\t\twindow.addEventListener(\"orientationchange\", onResizeBound);\n\t}\n\n\tprotected onResize(): void {\n\t\tconst bbox = this._rootElement.getBoundingClientRect();\n\t\tconst bboxWidth = bbox.width;\n\t\tconst bboxHeight = bbox.height;\n\t\tthis.renderer.resize(bboxWidth, bboxHeight);\n\n\t\tconst padding = this._padding;\n\t\tconst children = this.stage.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tconst child = children[i];\n\t\t\tif (child instanceof DBase) {\n\t\t\t\tchild.onParentResize(bboxWidth, bboxHeight, padding);\n\t\t\t}\n\t\t}\n\n\t\tthis.update();\n\t}\n\n\tprotected initWheelHandling(): void {\n\t\tconst global = new Point();\n\t\tconst util = UtilWheelEvent.getInstance();\n\t\tconst interactionManager = this.renderer.plugins.interaction;\n\t\tutil.on(this.view, (e: WheelEvent | Event): void => {\n\t\t\tconst wheelEvent = e as WheelEvent;\n\t\t\tUtilPointerEvent.toGlobal(wheelEvent, interactionManager, global);\n\t\t\tlet current = interactionManager.hitTest(global);\n\t\t\tconst deltas = util.normalize(e);\n\t\t\tif (deltas != null) {\n\t\t\t\twhile (current != null) {\n\t\t\t\t\tif (isWheelable(current)) {\n\t\t\t\t\t\tif (current.onWheel(wheelEvent, deltas, global)) {\n\t\t\t\t\t\t\twheelEvent.preventDefault();\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tcurrent = current.parent;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tprotected initDoubleClickHandling(): void {\n\t\tconst focusController = this.getFocusController();\n\t\tconst interactionManager = this.renderer.plugins.interaction;\n\t\tUtilPointerEvent.onDblClick(this.view, (e: MouseEvent | TouchEvent): void => {\n\t\t\tconst focused = focusController.get();\n\t\t\tif (focused != null) {\n\t\t\t\tlet current: DFocusable | DFocusableContainer | null = focused;\n\t\t\t\twhile (current != null) {\n\t\t\t\t\tif (isDblClickable(current)) {\n\t\t\t\t\t\tif (current.onDblClick(e, interactionManager)) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tcurrent = current.parent;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tlock(): void {\n\t\tthis._isLocked = true;\n\t}\n\n\tunlock(): void {\n\t\tthis._isLocked = false;\n\t}\n\n\tupdate(): void {\n\t\tif (!this._isLocked && this._renderId == null) {\n\t\t\tthis._renderId = requestAnimationFrame(this._renderBound);\n\t\t}\n\t}\n\n\tprotected onStageDirty(): void {\n\t\t// Update the visibility if this is a overlay layer.\n\t\tif (this._isOverlay) {\n\t\t\tif (0 < this.stage.children.length) {\n\t\t\t\t// There are more than one children,\n\t\t\t\t// therefore must be visible.\n\t\t\t\tif (!this._isVisible) {\n\t\t\t\t\tthis._isVisible = true;\n\t\t\t\t\tthis.view.style.display = \"block\";\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// There is no child,\n\t\t\t\t// therefore must not be visible.\n\t\t\t\tif (this._isVisible) {\n\t\t\t\t\tthis._isVisible = false;\n\t\t\t\t\tthis.view.style.display = \"none\";\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\trender(): void {\n\t\tthis.refit();\n\t\tthis.reflow();\n\n\t\t// Please note why the following line is here.\n\t\t//\n\t\t// Before this line, the update method does not enque a rendering task\n\t\t// because `this._renderId` is not null. As a result, this prevents\n\t\t// an unintentional rendering loop caused by the refit or the reflow.\n\t\t//\n\t\t// After this line, the update method enques a rendering task.\n\t\t// Namely, in the DisplayObject#render(Renderer) method, allowed to enque\n\t\t// a rendering task. For instance, please refer to the DDiagramShape#update().\n\t\tthis._renderId = null;\n\n\t\t// Render\n\t\tsuper.render();\n\t}\n\n\tget width(): number {\n\t\treturn this.screen.width;\n\t}\n\n\tget height(): number {\n\t\treturn this.screen.height;\n\t}\n\n\tget padding(): DPadding {\n\t\treturn this._padding;\n\t}\n\n\trefit(): void {\n\t\tconst children = this.stage.children;\n\t\tfor (let ilimit = 0, limit = this._refitLimit; ilimit < limit; ++ilimit) {\n\t\t\tlet isChildrenDirty = false;\n\t\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\t\tconst child = children[i];\n\t\t\t\tif (child instanceof DBase) {\n\t\t\t\t\tchild.refit();\n\t\t\t\t\tisChildrenDirty = isChildrenDirty || child.isChildrenDirty();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// If DBases are changed during the `refit` process, need to refit again.\n\t\t\tif (!isChildrenDirty) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\treflow(): void {\n\t\tconst children = this.stage.children;\n\t\tfor (let ilimit = 0, limit = this._refitLimit; ilimit < limit; ++ilimit) {\n\t\t\tlet isDirty = false;\n\t\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\t\tconst child = children[i];\n\t\t\t\tif (child instanceof DBase) {\n\t\t\t\t\tchild.reflow();\n\t\t\t\t\tisDirty = isDirty || child.isDirty() || child.hasDirty();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// If DBases are changed during the `reflow` process, need to reflow again.\n\t\t\tif (!isDirty) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tgetFocusController(): DControllerFocus {\n\t\treturn this.application.getFocusController();\n\t}\n\n\tgetRootElement(): HTMLElement {\n\t\treturn this._rootElement;\n\t}\n\n\tgetElementContainer(): HTMLElement {\n\t\treturn this._elementContainer;\n\t}\n\n\tgetDynamicFontAtlases(): DynamicFontAtlases {\n\t\tif (this._dynamicFontAtlases == null) {\n\t\t\tthis._dynamicFontAtlases = new DynamicFontAtlases(this);\n\t\t}\n\t\treturn this._dynamicFontAtlases;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {\n\tDControllerFocus,\n\tDFocusable,\n\tDFocusableContainer,\n\tDFocusableMightBe\n} from \"./d-controller-focus\";\n\nexport class DControllerDefaultFocus implements DControllerFocus {\n\tprivate _focused: DFocusable | null = null;\n\n\tfocus(focusable: DFocusable | null): DFocusable | null {\n\t\tconst previous = this._focused;\n\t\tif (previous !== focusable) {\n\t\t\tif (previous != null) {\n\t\t\t\tprevious.state.isFocused = false;\n\t\t\t}\n\n\t\t\tthis._focused = focusable;\n\t\t\tif (this.isFocusable(focusable)) {\n\t\t\t\tfocusable.state.isFocused = true;\n\t\t\t}\n\t\t\treturn previous;\n\t\t}\n\t\treturn null;\n\t}\n\n\tblur(focusable: DFocusable | null): DFocusable | null {\n\t\tif (focusable != null && this._focused === focusable) {\n\t\t\tthis._focused = null;\n\t\t\tfocusable.state.isFocused = false;\n\t\t\treturn focusable;\n\t\t}\n\t\treturn null;\n\t}\n\n\tclear(): DFocusable | null {\n\t\treturn this.focus(null);\n\t}\n\n\tset(focusable: DFocusable | null, isFocused: boolean): DFocusable | null {\n\t\tif (isFocused) {\n\t\t\treturn this.focus(focusable);\n\t\t} else {\n\t\t\treturn this.blur(focusable);\n\t\t}\n\t}\n\n\tget(): DFocusable | null {\n\t\treturn this._focused;\n\t}\n\n\tfindParent(mightBeFocusable: DFocusableMightBe | null): DFocusable | null {\n\t\tlet current: DFocusableMightBe | DFocusableContainer | null = mightBeFocusable;\n\t\twhile (current != null) {\n\t\t\tif (this.isFocusable(current)) {\n\t\t\t\treturn current;\n\t\t\t} else {\n\t\t\t\tcurrent = current.parent;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tfind(\n\t\ttarget: DFocusableMightBe,\n\t\tincludesTarget: boolean,\n\t\tincludesTargetChildren: boolean,\n\t\tdirection: boolean,\n\t\troot?: unknown\n\t): DFocusable | null {\n\t\tif (direction) {\n\t\t\tconst result = this.findNext(target, includesTarget, includesTargetChildren);\n\t\t\tif (result != null) {\n\t\t\t\treturn result;\n\t\t\t}\n\t\t\tif (this.isFocusRoot(target, root)) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tconst parent = target.parent;\n\t\t\tif (parent != null) {\n\t\t\t\tconst children = parent.children;\n\t\t\t\tconst index = children.indexOf(target);\n\t\t\t\tif (0 <= index) {\n\t\t\t\t\tconst childrenLength = children.length;\n\t\t\t\t\tif (this.isFocusReverse(parent)) {\n\t\t\t\t\t\tfor (let i = index - 1; 0 <= i; --i) {\n\t\t\t\t\t\t\tconst found = this.findNext(children[i], true, true);\n\t\t\t\t\t\t\tif (found != null) {\n\t\t\t\t\t\t\t\treturn found;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!this.isFocusRoot(parent, root)) {\n\t\t\t\t\t\t\tconst found = this.find(parent, false, false, true, root);\n\t\t\t\t\t\t\tif (found != null) {\n\t\t\t\t\t\t\t\treturn found;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfor (let i = childrenLength - 1; index <= i; --i) {\n\t\t\t\t\t\t\tconst found = this.findNext(children[i], true, true);\n\t\t\t\t\t\t\tif (found != null) {\n\t\t\t\t\t\t\t\treturn found;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfor (let i = index + 1; i < childrenLength; ++i) {\n\t\t\t\t\t\t\tconst found = this.findNext(children[i], true, true);\n\t\t\t\t\t\t\tif (found != null) {\n\t\t\t\t\t\t\t\treturn found;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!this.isFocusRoot(parent, root)) {\n\t\t\t\t\t\t\tconst found = this.find(parent, false, false, true, root);\n\t\t\t\t\t\t\tif (found != null) {\n\t\t\t\t\t\t\t\treturn found;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfor (let i = 0; i <= index; ++i) {\n\t\t\t\t\t\t\tconst found = this.findNext(children[i], true, true);\n\t\t\t\t\t\t\tif (found != null) {\n\t\t\t\t\t\t\t\treturn found;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tconst result = this.findPrevious(target, includesTarget, includesTargetChildren);\n\t\t\tif (result != null) {\n\t\t\t\treturn result;\n\t\t\t}\n\n\t\t\tconst parent = target.parent;\n\t\t\tif (parent != null) {\n\t\t\t\tconst children = parent.children;\n\t\t\t\tconst index = children.indexOf(target);\n\t\t\t\tif (0 <= index) {\n\t\t\t\t\tconst childrenLength = children.length;\n\t\t\t\t\tif (this.isFocusReverse(parent)) {\n\t\t\t\t\t\tfor (let i = index + 1; i < childrenLength; ++i) {\n\t\t\t\t\t\t\tconst found = this.findPrevious(children[i], true, true);\n\t\t\t\t\t\t\tif (found != null) {\n\t\t\t\t\t\t\t\treturn found;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!this.isFocusRoot(parent, root)) {\n\t\t\t\t\t\t\tconst found = this.find(parent, true, false, false, root);\n\t\t\t\t\t\t\tif (found != null) {\n\t\t\t\t\t\t\t\treturn found;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfor (let i = 0; i <= index; ++i) {\n\t\t\t\t\t\t\tconst found = this.findPrevious(children[i], true, true);\n\t\t\t\t\t\t\tif (found != null) {\n\t\t\t\t\t\t\t\treturn found;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfor (let i = index - 1; 0 <= i; --i) {\n\t\t\t\t\t\t\tconst found = this.findPrevious(children[i], true, true);\n\t\t\t\t\t\t\tif (found != null) {\n\t\t\t\t\t\t\t\treturn found;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!this.isFocusRoot(parent, root)) {\n\t\t\t\t\t\t\tconst found = this.find(parent, true, false, false, root);\n\t\t\t\t\t\t\tif (found != null) {\n\t\t\t\t\t\t\t\treturn found;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfor (let i = childrenLength - 1; index <= i; --i) {\n\t\t\t\t\t\t\tconst found = this.findPrevious(children[i], true, true);\n\t\t\t\t\t\t\tif (found != null) {\n\t\t\t\t\t\t\t\treturn found;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tprotected findNext(\n\t\ttarget: DFocusableMightBe,\n\t\tincludesTarget: boolean,\n\t\tincludesTargetChildren: boolean\n\t): DFocusable | null {\n\t\t// Target itself\n\t\tif (includesTarget) {\n\t\t\tif (this.isFocusable(target)) {\n\t\t\t\treturn target;\n\t\t\t}\n\t\t}\n\n\t\t// Target children\n\t\tif (includesTargetChildren && this.isFocusableContainer(target) && target.visible) {\n\t\t\tconst children = target.children;\n\t\t\tconst childrenLength = children.length;\n\t\t\tif (this.isFocusReverse(target)) {\n\t\t\t\tfor (let i = childrenLength - 1; 0 <= i; --i) {\n\t\t\t\t\tconst found = this.findNext(children[i], true, true);\n\t\t\t\t\tif (found != null) {\n\t\t\t\t\t\treturn found;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (let i = 0; i < childrenLength; ++i) {\n\t\t\t\t\tconst found = this.findNext(children[i], true, true);\n\t\t\t\t\tif (found != null) {\n\t\t\t\t\t\treturn found;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Found nothing\n\t\treturn null;\n\t}\n\n\tprotected findPrevious(\n\t\ttarget: DFocusableMightBe,\n\t\tincludesTarget: boolean,\n\t\tincludesTargetChildren: boolean\n\t): DFocusable | null {\n\t\t// Target children\n\t\tif (includesTargetChildren && this.isFocusableContainer(target) && target.visible) {\n\t\t\tconst children = target.children;\n\t\t\tconst childrenLength = children.length;\n\t\t\tif (this.isFocusReverse(target)) {\n\t\t\t\tfor (let i = 0; i < childrenLength; ++i) {\n\t\t\t\t\tconst found = this.findPrevious(children[i], true, true);\n\t\t\t\t\tif (found != null) {\n\t\t\t\t\t\treturn found;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (let i = childrenLength - 1; 0 <= i; --i) {\n\t\t\t\t\tconst found = this.findPrevious(children[i], true, true);\n\t\t\t\t\tif (found != null) {\n\t\t\t\t\t\treturn found;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Target itself\n\t\tif (includesTarget) {\n\t\t\tif (this.isFocusable(target)) {\n\t\t\t\treturn target;\n\t\t\t}\n\t\t}\n\n\t\t// Found nothing\n\t\treturn null;\n\t}\n\n\tprotected isFocusable(target: any): target is DFocusable {\n\t\treturn (\n\t\t\ttarget != null &&\n\t\t\t\"state\" in target &&\n\t\t\ttarget.state.inEnabled &&\n\t\t\ttarget.state.isFocusable &&\n\t\t\ttarget.visible\n\t\t);\n\t}\n\n\tprotected isFocusableContainer(target: any): target is DFocusableContainer {\n\t\treturn target != null && \"children\" in target;\n\t}\n\n\tprotected isFocusRoot(target: any, root: unknown): target is DFocusable {\n\t\tif (target === root) {\n\t\t\treturn true;\n\t\t}\n\t\treturn target != null && \"state\" in target && target.state.isFocusRoot && target.visible;\n\t}\n\n\tprotected isFocusReverse(target: any): boolean {\n\t\treturn target != null && \"state\" in target && target.state.isFocusReverse;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Container, Renderer } from \"pixi.js\";\nimport { DApplicationLayer } from \"./d-application-layer\";\nimport { DApplicationLayerOptions } from \"./d-application-layer-options\";\nimport { DApplicationLike } from \"./d-application-like\";\nimport { DApplications } from \"./d-applications\";\nimport { DControllerDefaultFocus } from \"./d-controller-default-focus\";\nimport { DControllerFocus } from \"./d-controller-focus\";\nimport { DPaddingLike } from \"./d-padding\";\nimport { isString } from \"./util/is-string\";\n\nexport interface DApplicationBackgroundOptions {\n\tcolor?: number;\n}\n\nexport interface DApplicationOptions {\n\t/**\n\t * A root element selector or a root element.\n\t * `HTMLCanvasElement` and other DOM elements are created in this element.\n\t * The default root element is `document.body`.\n\t */\n\troot?: string | HTMLElement;\n\n\t/**\n\t * Padding settings.\n\t */\n\tpadding?: number | DPaddingLike;\n\n\t/**\n\t * A canvas width.\n\t */\n\twidth?: number;\n\n\t/**\n\t * A canvas height.\n\t */\n\theight?: number;\n\n\t/**\n\t * A background setting.\n\t */\n\tbackground?: DApplicationBackgroundOptions;\n\n\t/**\n\t * An antialias setting.\n\t */\n\tantialias?: boolean;\n\n\t/**\n\t * A resolution.\n\t * The default value is `devicePixelRatio`.\n\t */\n\tresolution?: number;\n\n\t/**\n\t * An overlay layer setting.\n\t * The overlay layer is used by modal UI elements including DDialog\n\t * to provide the better interoperability with DOM-based UI elements\n\t * and WebGL-based UI elements.\n\t * However, an extra layer requires extra memory.\n\t * Set to true to enable the overlay layer.\n\t * The default value is false.\n\t */\n\toverlay?: boolean;\n}\n\nexport class DApplication implements DApplicationLike {\n\tprotected _options?: DApplicationOptions;\n\tprotected _root: HTMLElement;\n\tprotected _base: DApplicationLayer;\n\tprotected _overlay?: DApplicationLayer;\n\tprotected _resolution: number;\n\tprotected _isOverlayEnabled: boolean;\n\tprotected _focus?: DControllerFocus;\n\n\tconstructor(options?: DApplicationOptions) {\n\t\tDApplications.add(this);\n\n\t\t// Root\n\t\tconst root = this.toRootElement(options);\n\t\tthis._root = root;\n\t\tthis.initFocusHandling(root);\n\n\t\t// Resolution\n\t\tconst resolution = options?.resolution ?? window.devicePixelRatio ?? 1;\n\t\tthis._resolution = resolution;\n\n\t\t// Remove the accessibility plugin\n\t\tdelete (Renderer as any).__plugins.accessibility;\n\n\t\t// Options\n\t\tthis._options = options;\n\n\t\t// Base layer\n\t\tconst base = this.newLayerBase(options);\n\t\tthis._base = base;\n\n\t\t// Overlay layer\n\t\tthis._isOverlayEnabled = !!options?.overlay;\n\t\tif (!this._isOverlayEnabled) {\n\t\t\tthis._overlay = base;\n\t\t}\n\t}\n\n\tget stage(): Container {\n\t\treturn this._base.stage;\n\t}\n\n\tgetRootElement(): HTMLElement {\n\t\treturn this._root;\n\t}\n\n\tgetResolution(): number {\n\t\treturn this._resolution;\n\t}\n\n\tprotected toRootElement(options?: DApplicationOptions): HTMLElement {\n\t\tconst root = options?.root;\n\t\tif (root != null) {\n\t\t\tif (isString(root)) {\n\t\t\t\tconst found = document.querySelector<HTMLElement>(root);\n\t\t\t\tif (found) {\n\t\t\t\t\treturn found;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn root;\n\t\t\t}\n\t\t}\n\t\treturn document.body;\n\t}\n\n\tprotected toLayerBaseOptions(options?: DApplicationOptions): DApplicationLayerOptions {\n\t\tconst root = this._root;\n\t\tconst resolution = this._resolution;\n\t\tif (options) {\n\t\t\treturn new DApplicationLayerOptions({\n\t\t\t\troot,\n\t\t\t\tpadding: options.padding,\n\t\t\t\twidth: options.width,\n\t\t\t\theight: options.height,\n\t\t\t\tbackground: options.background,\n\t\t\t\tresolution,\n\t\t\t\tantialias: options.antialias,\n\t\t\t\toverlay: false\n\t\t\t});\n\t\t}\n\t\treturn new DApplicationLayerOptions({\n\t\t\troot,\n\t\t\tresolution,\n\t\t\toverlay: false\n\t\t});\n\t}\n\n\tgetFocusController(): DControllerFocus {\n\t\tif (this._focus == null) {\n\t\t\tthis._focus = new DControllerDefaultFocus();\n\t\t}\n\t\treturn this._focus;\n\t}\n\n\tprotected initFocusHandling(root: HTMLElement): void {\n\t\tlet hasFocus = false;\n\t\tconst onFocus = (): void => {\n\t\t\thasFocus = true;\n\t\t};\n\t\tconst onBlured = (): void => {\n\t\t\tif (!hasFocus) {\n\t\t\t\tthis.getFocusController().clear();\n\t\t\t}\n\t\t};\n\t\tconst onBlur = (): void => {\n\t\t\thasFocus = false;\n\t\t\tsetTimeout(onBlured, 0);\n\t\t};\n\t\troot.addEventListener(\"focus\", onFocus, true);\n\t\troot.addEventListener(\"blur\", onBlur, true);\n\t}\n\n\tprotected newLayerBase(options?: DApplicationOptions): DApplicationLayer {\n\t\treturn new DApplicationLayer(this, this.toLayerBaseOptions(options));\n\t}\n\n\tgetLayerBase(): DApplicationLayer {\n\t\treturn this._base;\n\t}\n\n\tprotected toLayerOverlayOptions(options?: DApplicationOptions): DApplicationLayerOptions {\n\t\tconst root = this._root;\n\t\tconst resolution = this._resolution;\n\t\tif (options) {\n\t\t\treturn new DApplicationLayerOptions({\n\t\t\t\troot,\n\t\t\t\tpadding: options.padding,\n\t\t\t\twidth: options.width,\n\t\t\t\theight: options.height,\n\t\t\t\tbackground: {\n\t\t\t\t\tcolor: null\n\t\t\t\t},\n\t\t\t\tresolution,\n\t\t\t\tantialias: options.antialias,\n\t\t\t\toverlay: true\n\t\t\t});\n\t\t}\n\t\treturn new DApplicationLayerOptions({\n\t\t\troot,\n\t\t\tresolution,\n\t\t\toverlay: true\n\t\t});\n\t}\n\n\tprotected newLayerOverlay(options?: DApplicationOptions): DApplicationLayer {\n\t\treturn new DApplicationLayer(this, this.toLayerOverlayOptions(options));\n\t}\n\n\tgetLayerOverlay(): DApplicationLayer {\n\t\tif (this._isOverlayEnabled) {\n\t\t\tif (this._overlay == null) {\n\t\t\t\tthis._overlay = this.newLayerOverlay(this._options);\n\t\t\t}\n\t\t\treturn this._overlay;\n\t\t} else {\n\t\t\treturn this._base;\n\t\t}\n\t}\n\n\tupdate(): void {\n\t\tif (this._isOverlayEnabled) {\n\t\t\tconst base = this._base;\n\t\t\tbase.update();\n\n\t\t\tconst overlay = this._overlay;\n\t\t\tif (overlay) {\n\t\t\t\toverlay.update();\n\t\t\t}\n\t\t} else {\n\t\t\treturn this._base.update();\n\t\t}\n\t}\n\n\trender(): void {\n\t\tif (this._isOverlayEnabled) {\n\t\t\tconst base = this._base;\n\t\t\tbase.render();\n\n\t\t\tconst overlay = this._overlay;\n\t\t\tif (overlay) {\n\t\t\t\toverlay.render();\n\t\t\t}\n\t\t} else {\n\t\t\treturn this._base.render();\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DThemeBase } from \"./d-base\";\nimport { DBasePadding } from \"./d-base-padding\";\nimport { DPadding } from \"./d-padding\";\n\nexport interface DBasePaddingAdjuster {\n\tleft: number;\n\ttop: number;\n\tright: number;\n\tbottom: number;\n}\n\nexport class DBasePaddingAdjustable implements DPadding {\n\tprotected _target: DPadding;\n\tprotected _top: number;\n\tprotected _right: number;\n\tprotected _bottom: number;\n\tprotected _left: number;\n\tprotected _callback?: () => void;\n\n\tconstructor(target: DPadding) {\n\t\tthis._target = target;\n\t\tthis._top = 0;\n\t\tthis._right = 0;\n\t\tthis._bottom = 0;\n\t\tthis._left = 0;\n\t\tif (target instanceof DBasePadding) {\n\t\t\tthis._callback = target.getCallback();\n\t\t}\n\t}\n\n\tgetTheme(): DThemeBase {\n\t\treturn this._target.getTheme();\n\t}\n\n\tsetTheme(theme: DThemeBase): void {\n\t\tthis._target.setTheme(theme);\n\t}\n\n\tgetLeft(): number {\n\t\treturn this._target.getLeft() + this._left;\n\t}\n\n\tadjLeft(left: number): void {\n\t\tif (this._left !== left) {\n\t\t\tthis._left = left;\n\t\t\tconst callback = this._callback;\n\t\t\tif (callback) {\n\t\t\t\tcallback();\n\t\t\t}\n\t\t}\n\t}\n\n\tget left(): number | undefined {\n\t\treturn this._target.left;\n\t}\n\n\tset left(left: number | undefined) {\n\t\tthis._target.left = left;\n\t}\n\n\tgetTop(): number {\n\t\treturn this._target.getTop() + this._top;\n\t}\n\n\tadjTop(top: number): void {\n\t\tif (this._top !== top) {\n\t\t\tthis._top = top;\n\t\t\tconst callback = this._callback;\n\t\t\tif (callback) {\n\t\t\t\tcallback();\n\t\t\t}\n\t\t}\n\t}\n\n\tget top(): number | undefined {\n\t\treturn this._target.top;\n\t}\n\n\tset top(top: number | undefined) {\n\t\tthis._target.top = top;\n\t}\n\n\tgetRight(): number {\n\t\treturn this._target.getRight() + this._right;\n\t}\n\n\tadjRight(right: number): void {\n\t\tif (this._right !== right) {\n\t\t\tthis._right = right;\n\t\t\tconst callback = this._callback;\n\t\t\tif (callback) {\n\t\t\t\tcallback();\n\t\t\t}\n\t\t}\n\t}\n\n\tget right(): number | undefined {\n\t\treturn this._target.right;\n\t}\n\n\tset right(right: number | undefined) {\n\t\tthis._target.right = right;\n\t}\n\n\tgetBottom(): number {\n\t\treturn this._target.getBottom() + this._bottom;\n\t}\n\n\tadjBottom(bottom: number): void {\n\t\tif (this._bottom !== bottom) {\n\t\t\tthis._bottom = bottom;\n\t\t\tconst callback = this._callback;\n\t\t\tif (callback) {\n\t\t\t\tcallback();\n\t\t\t}\n\t\t}\n\t}\n\n\tget bottom(): number | undefined {\n\t\treturn this._target.bottom;\n\t}\n\n\tset bottom(bottom: number | undefined) {\n\t\tthis._target.bottom = bottom;\n\t}\n\n\tset(padding: number): void;\n\tset(topAndBottom: number, leftAndRight: number): void;\n\tset(top: number, leftAndRight: number, bottom: number): void;\n\tset(top: number, right: number, bottom: number, left: number): void;\n\tset(top: number, right?: number, bottom?: number, left?: number): void {\n\t\tconst target = this._target;\n\t\tif (right == null) {\n\t\t\ttarget.set(top);\n\t\t} else if (bottom == null) {\n\t\t\ttarget.set(top, right);\n\t\t} else if (left == null) {\n\t\t\ttarget.set(top, right, bottom);\n\t\t} else {\n\t\t\ttarget.set(top, right, bottom, left);\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBase, DBaseOptions, DThemeBase } from \"./d-base\";\n\nexport interface DBoardOptions<THEME extends DThemeBoard = DThemeBoard>\n\textends DBaseOptions<THEME> {}\n\nexport interface DThemeBoard extends DThemeBase {}\n\nexport class DBoard<\n\tTHEME extends DThemeBoard = DThemeBoard,\n\tOPTIONS extends DBoardOptions<THEME> = DBoardOptions<THEME>\n> extends DBase<THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DBoard\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DButtonBase, DButtonBaseOptions, DThemeButtonBase } from \"./d-button-base\";\n\nexport interface DButtonCheckOptions<\n\tVALUE = unknown,\n\tTHEME extends DThemeButtonCheck<VALUE> = DThemeButtonCheck<VALUE>\n> extends DButtonBaseOptions<VALUE, THEME> {}\n\nexport interface DThemeButtonCheck<VALUE = unknown> extends DThemeButtonBase<VALUE> {}\n\nexport class DButtonCheck<\n\tVALUE = unknown,\n\tTHEME extends DThemeButtonCheck<VALUE> = DThemeButtonCheck<VALUE>,\n\tOPTIONS extends DButtonCheckOptions<VALUE, THEME> = DButtonCheckOptions<VALUE, THEME>\n> extends DButtonBase<VALUE, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DButtonCheck\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DButtonCheck, DButtonCheckOptions, DThemeButtonCheck } from \"./d-button-check\";\n\nexport interface DButtonCheckRightOptions<\n\tVALUE = unknown,\n\tTHEME extends DThemeButtonCheckRight<VALUE> = DThemeButtonCheckRight<VALUE>\n> extends DButtonCheckOptions<VALUE, THEME> {}\n\nexport interface DThemeButtonCheckRight<VALUE = unknown> extends DThemeButtonCheck<VALUE> {}\n\nexport class DButtonCheckRight<\n\tVALUE = unknown,\n\tTHEME extends DThemeButtonCheck<VALUE> = DThemeButtonCheck<VALUE>,\n\tOPTIONS extends DButtonCheckOptions<VALUE, THEME> = DButtonCheckOptions<VALUE, THEME>\n> extends DButtonCheck<VALUE, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DButtonCheckRight\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DColorGradientPoint } from \"./d-color-gradient\";\n\nexport class DColorGradientPointObservable implements DColorGradientPoint {\n\tprotected _color: number;\n\tprotected _alpha: number;\n\tprotected _position: number;\n\tprotected _callback: (target: DColorGradientPointObservable) => void;\n\tprotected _selected: boolean;\n\n\tconstructor(\n\t\tcolor: number,\n\t\talpha: number,\n\t\tposition: number,\n\t\tselected: boolean,\n\t\tcallback: (target: DColorGradientPointObservable) => void\n\t) {\n\t\tthis._color = color;\n\t\tthis._alpha = alpha;\n\t\tthis._position = position;\n\t\tthis._callback = callback;\n\t\tthis._selected = selected;\n\t}\n\n\tset(color: number, alpha: number, position: number, selected: boolean): void {\n\t\tif (\n\t\t\tthis._color !== color ||\n\t\t\tthis._alpha !== alpha ||\n\t\t\tthis._position !== position ||\n\t\t\tthis._selected !== selected\n\t\t) {\n\t\t\tthis._color = color;\n\t\t\tthis._alpha = alpha;\n\t\t\tthis._position = position;\n\t\t\tthis._selected = selected;\n\t\t\tthis._callback(this);\n\t\t}\n\t}\n\n\tget color(): number {\n\t\treturn this._color;\n\t}\n\n\tset color(color: number) {\n\t\tif (this._color !== color) {\n\t\t\tthis._color = color;\n\t\t\tthis._callback(this);\n\t\t}\n\t}\n\n\tget alpha(): number {\n\t\treturn this._alpha;\n\t}\n\n\tset alpha(alpha: number) {\n\t\tif (this._alpha !== alpha) {\n\t\t\tthis._alpha = alpha;\n\t\t\tthis._callback(this);\n\t\t}\n\t}\n\n\tget position(): number {\n\t\treturn this._position;\n\t}\n\n\tset position(position: number) {\n\t\tif (this._position !== position) {\n\t\t\tthis._position = position;\n\t\t\tthis._callback(this);\n\t\t}\n\t}\n\n\tget selected(): boolean {\n\t\treturn this._selected;\n\t}\n\n\tset selected(selected: boolean) {\n\t\tif (this._selected !== selected) {\n\t\t\tthis._selected = selected;\n\t\t\tthis._callback(this);\n\t\t}\n\t}\n\n\ttoObject(): DColorGradientPoint {\n\t\treturn {\n\t\t\tcolor: this._color,\n\t\t\talpha: this._alpha,\n\t\t\tposition: this._position\n\t\t};\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { utils } from \"pixi.js\";\nimport { DColorGradient, DColorGradientPoint } from \"./d-color-gradient\";\nimport { DColorGradientPointObservable } from \"./d-color-gradient-point-observable\";\n\nconst POINT_SORTER = (a: DColorGradientPoint, b: DColorGradientPoint): number => {\n\treturn a.position - b.position;\n};\n\nexport class DColorGradientObservable extends utils.EventEmitter implements DColorGradient {\n\tprotected _points: DColorGradientPointObservable[];\n\tprotected _direction: number;\n\tprotected _selected: DColorGradientPointObservable | null;\n\n\tprotected _onChangeBound: (target: DColorGradientPointObservable) => void;\n\tprotected _workColor: number[];\n\n\tconstructor() {\n\t\tsuper();\n\n\t\tconst onChangeBound = (target: DColorGradientPointObservable): void => {\n\t\t\tthis.onChange(target);\n\t\t};\n\t\tthis._onChangeBound = onChangeBound;\n\n\t\tconst first = new DColorGradientPointObservable(0xffffff, 1, 0, false, onChangeBound);\n\t\tconst second = new DColorGradientPointObservable(0x808080, 1, 1, true, onChangeBound);\n\t\tthis._points = [first, second];\n\t\tthis._direction = -90;\n\t\tthis._selected = second;\n\t\tthis._workColor = [0, 0, 0];\n\t}\n\n\tprotected onChange(target: DColorGradientPointObservable): void {\n\t\tconst isSelectionChanged = target.selected && this._selected !== target;\n\t\tif (isSelectionChanged) {\n\t\t\tconst selected = this._selected;\n\t\t\tif (selected != null) {\n\t\t\t\t(selected as any)._selected = false;\n\t\t\t}\n\t\t\tthis._selected = target;\n\t\t}\n\t\tthis._points.sort(POINT_SORTER);\n\t\tif (isSelectionChanged) {\n\t\t\tthis.emit(\"selectionchange\", this._selected, this);\n\t\t}\n\t\tthis.emit(\"change\", this);\n\t}\n\n\tget points(): DColorGradientPointObservable[] {\n\t\treturn this._points;\n\t}\n\n\tget direction(): number {\n\t\treturn this._direction;\n\t}\n\n\tset direction(direction: number) {\n\t\tif (this._direction !== direction) {\n\t\t\tthis._direction = direction;\n\t\t\tthis.emit(\"directionchange\", direction, this);\n\t\t\tthis.emit(\"change\", this);\n\t\t}\n\t}\n\n\tget selected(): DColorGradientPointObservable | null {\n\t\treturn this._selected;\n\t}\n\n\tsize(): number {\n\t\treturn this._points.length;\n\t}\n\n\tget(index: number): DColorGradientPointObservable | null {\n\t\tconst points = this._points;\n\t\tif (0 <= index && index < points.length) {\n\t\t\treturn points[index];\n\t\t}\n\t\treturn null;\n\t}\n\n\taddAt(position: number): DColorGradientPointObservable {\n\t\tconst points = this._points;\n\t\tlet previous: DColorGradientPointObservable | null = null;\n\t\tfor (let i = 0, imax = points.length; i < imax; ++i) {\n\t\t\tconst point = points[i];\n\t\t\tif (position <= point.position) {\n\t\t\t\tif (previous != null) {\n\t\t\t\t\tconst span = point.position - previous.position;\n\t\t\t\t\tif (0.001 < span) {\n\t\t\t\t\t\tconst rgb0 = utils.hex2rgb(point.color, this._workColor);\n\t\t\t\t\t\tconst r0 = rgb0[0];\n\t\t\t\t\t\tconst g0 = rgb0[1];\n\t\t\t\t\t\tconst b0 = rgb0[2];\n\n\t\t\t\t\t\tconst rgb1 = utils.hex2rgb(previous.color, this._workColor);\n\t\t\t\t\t\tconst r1 = rgb1[0];\n\t\t\t\t\t\tconst g1 = rgb1[1];\n\t\t\t\t\t\tconst b1 = rgb1[2];\n\n\t\t\t\t\t\tconst ratio = (position - previous.position) / span;\n\t\t\t\t\t\tconst r = r0 * ratio + r1 * (1 - ratio);\n\t\t\t\t\t\tconst g = g0 * ratio + g1 * (1 - ratio);\n\t\t\t\t\t\tconst b = b0 * ratio + b1 * (1 - ratio);\n\n\t\t\t\t\t\tconst rgb = this._workColor;\n\t\t\t\t\t\trgb[0] = r;\n\t\t\t\t\t\trgb[1] = g;\n\t\t\t\t\t\trgb[2] = b;\n\n\t\t\t\t\t\tconst color = utils.rgb2hex(rgb);\n\t\t\t\t\t\tconst alpha = point.alpha * ratio + previous.alpha * (1 - ratio);\n\t\t\t\t\t\treturn this.add(color, alpha, position, true);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\treturn this.add(point.color, point.alpha, position, true);\n\t\t\t\t}\n\t\t\t}\n\t\t\tprevious = point;\n\t\t}\n\t\tif (previous != null) {\n\t\t\treturn this.add(previous.color, previous.alpha, position, true);\n\t\t} else {\n\t\t\treturn this.add(0xffffff, 1.0, position, true);\n\t\t}\n\t}\n\n\tadd(\n\t\tcolor: number,\n\t\talpha: number,\n\t\tposition: number,\n\t\tselected: boolean\n\t): DColorGradientPointObservable {\n\t\tconst onChangeBound = this._onChangeBound;\n\t\tconst result = new DColorGradientPointObservable(\n\t\t\tcolor,\n\t\t\talpha,\n\t\t\tposition,\n\t\t\tselected,\n\t\t\tonChangeBound\n\t\t);\n\t\tthis._points.push(result);\n\t\tonChangeBound(result);\n\t\treturn result;\n\t}\n\n\tremove(point: DColorGradientPointObservable): boolean {\n\t\tconst points = this._points;\n\t\tif (2 < points.length) {\n\t\t\tfor (let i = 0, imax = points.length; i < imax; ++i) {\n\t\t\t\tif (points[i] === point) {\n\t\t\t\t\tpoints.splice(i, 1);\n\t\t\t\t\tconst isSelectionChanged = this._selected === point;\n\t\t\t\t\tif (isSelectionChanged) {\n\t\t\t\t\t\tif (i + 1 < imax) {\n\t\t\t\t\t\t\tthis._selected = points[i];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis._selected = points[i - 1];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (isSelectionChanged) {\n\t\t\t\t\t\tthis.emit(\"selectionchange\", this._selected, this);\n\t\t\t\t\t}\n\t\t\t\t\tthis.emit(\"change\", this);\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\treset(): this {\n\t\tconst oldDirection = this._direction;\n\t\tthis._direction = -90;\n\n\t\tconst points = this._points;\n\t\tconst oldSelected = this._selected;\n\t\tconst index = oldSelected ? points.indexOf(oldSelected) : -1;\n\t\tpoints.length = 0;\n\t\tconst onChangeBound = this._onChangeBound;\n\t\tpoints.push(new DColorGradientPointObservable(0xffffff, 0, 0, false, onChangeBound));\n\t\tpoints.push(new DColorGradientPointObservable(0xffffff, 0, 1, false, onChangeBound));\n\n\t\tif (0 <= index && index < points.length) {\n\t\t\tconst point = points[index];\n\t\t\t(point as any)._selected = true;\n\t\t\tthis._selected = point;\n\t\t} else if (0 < points.length) {\n\t\t\tconst point = points[points.length - 1];\n\t\t\t(point as any)._selected = true;\n\t\t\tthis._selected = point;\n\t\t} else {\n\t\t\tthis._selected = null;\n\t\t}\n\t\tif (oldSelected !== this._selected) {\n\t\t\tthis.emit(\"selectionchange\", this._selected, this);\n\t\t}\n\n\t\tif (oldDirection !== this._direction) {\n\t\t\tthis.emit(\"directionchange\", this._direction, this);\n\t\t}\n\n\t\tthis.emit(\"change\", this);\n\t\treturn this;\n\t}\n\n\ttoObject(): DColorGradient {\n\t\tconst pointsCopy = [];\n\t\tconst points = this._points;\n\t\tfor (let i = 0, imax = points.length; i < imax; ++i) {\n\t\t\tpointsCopy.push(points[i].toObject());\n\t\t}\n\t\treturn {\n\t\t\tpoints: pointsCopy,\n\t\t\tdirection: this._direction\n\t\t};\n\t}\n\n\tfromObject(data: DColorGradient): this {\n\t\tconst oldDirection = this._direction;\n\t\tthis._direction = data.direction;\n\n\t\tconst points = this._points;\n\t\tconst oldSelected = this._selected;\n\t\tconst index = oldSelected ? points.indexOf(oldSelected) : -1;\n\t\tpoints.length = 0;\n\t\tconst onChangeBound = this._onChangeBound;\n\t\tfor (let i = 0, imax = data.points.length; i < imax; ++i) {\n\t\t\tconst pointLike = data.points[i];\n\t\t\tconst point = new DColorGradientPointObservable(\n\t\t\t\tpointLike.color,\n\t\t\t\tpointLike.alpha,\n\t\t\t\tpointLike.position,\n\t\t\t\tfalse,\n\t\t\t\tonChangeBound\n\t\t\t);\n\t\t\tpoints.push(point);\n\t\t}\n\t\tpoints.sort(POINT_SORTER);\n\n\t\tif (0 <= index && index < points.length) {\n\t\t\tconst point = points[index];\n\t\t\t(point as any)._selected = true;\n\t\t\tthis._selected = point;\n\t\t} else if (0 < points.length) {\n\t\t\tconst point = points[points.length - 1];\n\t\t\t(point as any)._selected = true;\n\t\t\tthis._selected = point;\n\t\t} else {\n\t\t\tthis._selected = null;\n\t\t}\n\t\tif (oldSelected !== this._selected) {\n\t\t\tthis.emit(\"selectionchange\", this._selected, this);\n\t\t}\n\n\t\tif (oldDirection !== this._direction) {\n\t\t\tthis.emit(\"directionchange\", this._direction, this);\n\t\t}\n\n\t\tthis.emit(\"change\", this);\n\t\treturn this;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DText, DTextOptions, DThemeText } from \"./d-text\";\n\nexport interface DInputLabelOptions<\n\tVALUE = unknown,\n\tTHEME extends DThemeText<VALUE> = DThemeText<VALUE>\n> extends DTextOptions<VALUE, THEME> {}\n\nexport interface DThemeInputLabel<VALUE = unknown> extends DThemeText<VALUE> {}\n\nexport class DInputLabel<\n\tVALUE = unknown,\n\tTHEME extends DThemeInputLabel<VALUE> = DThemeInputLabel<VALUE>,\n\tOPTIONS extends DInputLabelOptions<VALUE, THEME> = DInputLabelOptions<VALUE, THEME>\n> extends DText<VALUE, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DInputLabel\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DisplayObject } from \"pixi.js\";\nimport { DInputLabel, DInputLabelOptions } from \"./d-input-label\";\nimport { DLayoutOptions } from \"./d-layout\";\nimport { DLayoutHorizontal, DThemeLayoutHorizontal } from \"./d-layout-horizontal\";\nimport { DLayoutSpace, DLayoutSpaceOptions } from \"./d-layout-space\";\n\nexport interface DInputAndLabelInputOptions {\n\tweight?: number;\n}\n\nexport interface DInputAndLabelInput extends DisplayObject {\n\treadonly height: number;\n}\n\nexport interface DInputAndLabelOptions<\n\tINPUT_OPTIONS extends DInputAndLabelInputOptions = DInputAndLabelInputOptions,\n\tTHEME extends DThemeInputAndLabel = DThemeInputAndLabel\n> extends DLayoutOptions<THEME> {\n\tinput?: INPUT_OPTIONS;\n\tlabel?: DInputLabelOptions;\n\tspace?: DLayoutSpaceOptions;\n}\n\nexport interface DThemeInputAndLabel extends DThemeLayoutHorizontal {}\n\nexport abstract class DInputAndLabel<\n\tINPUT extends DInputAndLabelInput,\n\tINPUT_OPTIONS extends DInputAndLabelInputOptions,\n\tTHEME extends DThemeInputAndLabel = DThemeInputAndLabel,\n\tOPTIONS extends DInputAndLabelOptions<INPUT_OPTIONS, THEME> = DInputAndLabelOptions<\n\t\tINPUT_OPTIONS,\n\t\tTHEME\n\t>\n> extends DLayoutHorizontal<THEME, OPTIONS> {\n\tprotected _input: INPUT;\n\tprotected _label: DInputLabel;\n\n\tconstructor(options?: OPTIONS) {\n\t\tsuper(options);\n\t\tthis.addChild((this._label = new DInputLabel(options?.label)));\n\t\tthis.addChild((this._input = this.createInput(options?.input)));\n\t\tconst space = options?.space;\n\t\tif (space != null) {\n\t\t\tthis.addChild(new DLayoutSpace(space));\n\t\t}\n\t}\n\n\tget input(): INPUT {\n\t\treturn this._input;\n\t}\n\n\tget label(): DInputLabel {\n\t\treturn this._label;\n\t}\n\n\tprotected abstract createInput(options?: INPUT_OPTIONS | { weight: number }): INPUT;\n\n\tprotected getType(): string {\n\t\treturn \"DInputAndLabel\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DInputAndLabel, DInputAndLabelOptions, DThemeInputAndLabel } from \"./d-input-and-label\";\nimport { DInputReal, DInputRealOptions, DThemeInputReal } from \"./d-input-real\";\n\nexport interface DInputRealAndLabelOptions<THEME extends DThemeInputAndLabel = DThemeInputAndLabel>\n\textends DInputAndLabelOptions<DInputRealOptions, THEME> {}\n\nexport class DInputRealAndLabel<\n\tTHEME extends DThemeInputAndLabel = DThemeInputAndLabel,\n\tOPTIONS extends DInputRealAndLabelOptions<THEME> = DInputRealAndLabelOptions<THEME>\n> extends DInputAndLabel<DInputReal, DInputRealOptions, THEME, OPTIONS> {\n\tprotected createInput(options?: DInputRealOptions<DThemeInputReal>): DInputReal {\n\t\treturn new DInputReal(options);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DInputAndLabel, DInputAndLabelOptions, DThemeInputAndLabel } from \"./d-input-and-label\";\nimport { DInputText, DInputTextOptions, DThemeInputText } from \"./d-input-text\";\n\nexport interface DInputTextAndLabelOptions<THEME extends DThemeInputAndLabel = DThemeInputAndLabel>\n\textends DInputAndLabelOptions<DInputTextOptions, THEME> {}\n\nexport class DInputTextAndLabel<\n\tTHEME extends DThemeInputAndLabel = DThemeInputAndLabel,\n\tOPTIONS extends DInputTextAndLabelOptions<THEME> = DInputTextAndLabelOptions<THEME>\n> extends DInputAndLabel<DInputText, DInputTextOptions, THEME, OPTIONS> {\n\tprotected createInput(options?: DInputTextOptions<DThemeInputText>): DInputText {\n\t\treturn new DInputText(options);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DColorAndAlpha } from \"./d-color-and-alpha\";\n\nexport class DPickerColorAndAlpha implements DColorAndAlpha {\n\tprotected _colorAndAlpha: DColorAndAlpha;\n\tprotected _onColorChange: (color: number) => void;\n\tprotected _onAlphaChange: (alpha: number) => void;\n\n\tconstructor(\n\t\tcolorAndAlpha: DColorAndAlpha,\n\t\tonColorChange: (color: number) => void,\n\t\tonAlphaChange: (alpha: number) => void\n\t) {\n\t\tthis._colorAndAlpha = colorAndAlpha;\n\t\tthis._onColorChange = onColorChange;\n\t\tthis._onAlphaChange = onAlphaChange;\n\t}\n\n\tget color(): number {\n\t\treturn this._colorAndAlpha.color;\n\t}\n\n\tset color(color: number) {\n\t\tif (this._colorAndAlpha.color !== color) {\n\t\t\tconst callback = this._onColorChange;\n\t\t\tif (callback != null) {\n\t\t\t\tcallback(color);\n\t\t\t}\n\t\t}\n\t}\n\n\tget alpha(): number {\n\t\treturn this._colorAndAlpha.alpha;\n\t}\n\n\tset alpha(alpha: number) {\n\t\tif (this._colorAndAlpha.alpha !== alpha) {\n\t\t\tconst callback = this._onAlphaChange;\n\t\t\tif (callback != null) {\n\t\t\t\tcallback(alpha);\n\t\t\t}\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { utils } from \"pixi.js\";\nimport { DColorAndAlpha } from \"./d-color-and-alpha\";\n\nexport class DPickerColorRecent extends utils.EventEmitter {\n\tprotected _recents: DColorAndAlpha[];\n\tprotected _capacity: number;\n\n\tconstructor(recents: DColorAndAlpha[], capacity: number) {\n\t\tsuper();\n\n\t\tthis._recents = recents;\n\t\tthis._capacity = capacity;\n\t}\n\n\tget(index: number): DColorAndAlpha | null {\n\t\tconst recents = this._recents;\n\t\tif (0 <= index && index < recents.length) {\n\t\t\treturn recents[recents.length - 1 - index];\n\t\t}\n\t\treturn null;\n\t}\n\n\tset(index: number, colorAndAlpha: DColorAndAlpha): DColorAndAlpha | null {\n\t\tconst recents = this._recents;\n\t\tif (0 <= index && index < recents.length) {\n\t\t\tconst result = recents[recents.length - 1 - index];\n\t\t\trecents[recents.length - 1 - index] = {\n\t\t\t\tcolor: colorAndAlpha.color,\n\t\t\t\talpha: colorAndAlpha.alpha\n\t\t\t};\n\t\t\tthis.emit(\"change\", this);\n\t\t\treturn result;\n\t\t}\n\t\treturn null;\n\t}\n\n\tcontains(colorAndAlpha: DColorAndAlpha): boolean {\n\t\tconst recents = this._recents;\n\t\tfor (let i = 0, imax = recents.length; i < imax; ++i) {\n\t\t\tconst recent = recents[i];\n\t\t\tif (recent.color === colorAndAlpha.color && recent.alpha === colorAndAlpha.alpha) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tadd(colorAndAlpha: DColorAndAlpha): this {\n\t\tconst recents = this._recents;\n\t\trecents.push({\n\t\t\tcolor: colorAndAlpha.color,\n\t\t\talpha: colorAndAlpha.alpha\n\t\t});\n\t\tif (this._capacity < recents.length) {\n\t\t\trecents.shift();\n\t\t}\n\t\tthis.emit(\"change\", this);\n\t\treturn this;\n\t}\n\n\tpop(): DColorAndAlpha | null {\n\t\tconst recents = this._recents;\n\t\tconst result = recents.shift();\n\t\tif (result != null) {\n\t\t\tthis.emit(\"change\", this);\n\t\t\treturn result;\n\t\t}\n\t\treturn null;\n\t}\n\n\tsize(): number {\n\t\treturn this._recents.length;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Container, interaction, Point, Sprite, Texture } from \"pixi.js\";\nimport InteractionEvent = interaction.InteractionEvent;\nimport { DApplications } from \"./d-applications\";\nimport { DBase, DBaseOptions, DThemeBase } from \"./d-base\";\nimport { DColorAndAlpha } from \"./d-color-and-alpha\";\nimport { DInputRealAndLabel } from \"./d-input-real-and-label\";\nimport { DInputTextAndLabel } from \"./d-input-text-and-label\";\nimport { DPickerColorAndAlpha } from \"./d-picker-color-and-alpha\";\nimport { DPickerColorRecent } from \"./d-picker-color-recent\";\nimport { UtilHsv } from \"./util/util-hsv\";\nimport { UtilPointerEvent } from \"./util/util-pointer-event\";\nimport { UtilRgb } from \"./util/util-rgb\";\n\nexport interface DPickerColorOptions<THEME extends DThemePickerColor = DThemePickerColor>\n\textends DBaseOptions<THEME> {}\n\nexport interface DThemePickerColor extends DThemeBase {\n\tgetMainWidth(): number;\n\tgetMainHeight(): number;\n\tgetMainTexture(): Texture;\n\tgetMainPointerTexture(): Texture;\n\tgetMainPointerColor(): number;\n\tgetMainPointerAlpha(): number;\n\n\tgetBaseHeight(): number;\n\tgetBaseMargin(): number;\n\tgetBaseTexture(): Texture;\n\tgetBasePointerTexture(): Texture;\n\tgetBasePointerColor(): number;\n\tgetBasePointerAlpha(): number;\n\n\tgetAlphaHeight(): number;\n\tgetAlphaMargin(): number;\n\tgetAlphaTexture(): Texture;\n\tgetAlphaCheckerboardTexture(): Texture;\n\tgetAlphaPointerTexture(): Texture;\n\tgetAlphaPointerColor(): number;\n\tgetAlphaPointerAlpha(): number;\n\n\tgetRecentMargin(): number;\n\tgetRecentColorMargin(): number;\n\tgetRecentColorWidth(): number;\n\tgetRecentColorHeight(): number;\n\tgetRecentColorCount(): number;\n\tgetRecentCheckerboardTexture(): Texture;\n\tgetRecents(): DColorAndAlpha[];\n\n\tgetInputMargin(): number;\n\tgetInputLabelWidth(): number;\n\n\tgetSampleCheckerboardTexture(): Texture;\n}\n\nexport class DPickerColor<\n\tTHEME extends DThemePickerColor = DThemePickerColor,\n\tOPTIONS extends DPickerColorOptions<THEME> = DPickerColorOptions<THEME>\n> extends DBase<THEME, OPTIONS> {\n\tprotected static RECENT_COLORS: DPickerColorRecent | null = null;\n\n\tprotected _mainBaseSprite!: Sprite;\n\tprotected _mainSprite!: Sprite;\n\tprotected _mainPointerSprite!: Sprite;\n\tprotected _pointerPoint!: Point;\n\tprotected _onMainMoveBound!: (e: InteractionEvent) => void;\n\tprotected _onMainUpBound!: (e: InteractionEvent) => void;\n\n\tprotected _baseSprite!: Sprite;\n\tprotected _basePointerSprite!: Sprite;\n\tprotected _onBaseMoveBound!: (e: InteractionEvent) => void;\n\tprotected _onBaseUpBound!: (e: InteractionEvent) => void;\n\n\tprotected _alphaCheckerboardSprite!: Sprite;\n\tprotected _alphaSprite!: Sprite;\n\tprotected _alphaPointerSprite!: Sprite;\n\tprotected _onAlphaMoveBound!: (e: InteractionEvent) => void;\n\tprotected _onAlphaUpBound!: (e: InteractionEvent) => void;\n\n\tprotected _recentColorSprites!: Sprite[];\n\tprotected _recent!: DPickerColorRecent;\n\n\tprotected _inputAndLabelColor!: DInputTextAndLabel;\n\tprotected _inputAndLabelAlpha!: DInputRealAndLabel;\n\n\tprotected _sampleCurrentCheckerboardSprite!: Sprite;\n\tprotected _sampleCurrentSprite!: Sprite;\n\tprotected _sampleNewCheckerboardSprite!: Sprite;\n\tprotected _sampleNewSprite!: Sprite;\n\n\tprotected _current!: DColorAndAlpha;\n\tprotected _currentPicker!: DPickerColorAndAlpha;\n\tprotected _base!: number;\n\tprotected _new!: DColorAndAlpha;\n\tprotected _newPicker!: DPickerColorAndAlpha;\n\n\tget current(): DColorAndAlpha {\n\t\treturn this._currentPicker;\n\t}\n\n\tget new(): DColorAndAlpha {\n\t\treturn this._newPicker;\n\t}\n\n\tget recent(): DPickerColorRecent {\n\t\treturn this._recent;\n\t}\n\n\tprotected init(options?: OPTIONS): void {\n\t\tsuper.init(options);\n\n\t\tthis._base = 0xff0000;\n\t\tthis._new = { color: 0xffffff, alpha: 1 };\n\t\tthis._newPicker = new DPickerColorAndAlpha(\n\t\t\tthis._new,\n\t\t\t(color) => {\n\t\t\t\tthis.setColorNew(color);\n\t\t\t},\n\t\t\t(alpha: number) => {\n\t\t\t\tthis.setAlphaNew(alpha);\n\t\t\t}\n\t\t);\n\t\tthis._current = { color: 0xffffff, alpha: 1 };\n\t\tthis._currentPicker = new DPickerColorAndAlpha(\n\t\t\tthis._current,\n\t\t\t(color) => {\n\t\t\t\tthis.setColorCurrent(color);\n\t\t\t},\n\t\t\t(alpha: number) => {\n\t\t\t\tthis.setAlphaCurrent(alpha);\n\t\t\t}\n\t\t);\n\n\t\tconst theme = this.theme;\n\t\tconst padding = this._padding;\n\t\tconst paddingTop = padding.getTop();\n\t\tconst paddingRight = padding.getRight();\n\t\tconst paddingBottom = padding.getBottom();\n\t\tconst paddingLeft = padding.getLeft();\n\t\tthis._pointerPoint = new Point();\n\n\t\t// Main\n\t\tconst mainWidth = theme.getMainWidth();\n\t\tconst mainHeight = theme.getMainHeight();\n\t\tconst mainBaseSprite = new Sprite(Texture.WHITE);\n\t\tthis._mainBaseSprite = mainBaseSprite;\n\t\tmainBaseSprite.x = paddingLeft;\n\t\tmainBaseSprite.y = paddingTop;\n\t\tmainBaseSprite.width = mainWidth;\n\t\tmainBaseSprite.height = mainHeight;\n\t\tmainBaseSprite.interactive = true;\n\t\tthis.addChild(mainBaseSprite);\n\n\t\tconst mainSprite = new Sprite(theme.getMainTexture());\n\t\tthis._mainSprite = mainSprite;\n\t\tmainSprite.x = paddingLeft;\n\t\tmainSprite.y = paddingTop;\n\t\tmainSprite.tint = this._base;\n\t\tmainSprite.interactive = false;\n\t\tthis.addChild(mainSprite);\n\n\t\t// Main event handling\n\t\tthis._onMainMoveBound = (e: InteractionEvent): void => {\n\t\t\tthis.onMainMove(e);\n\t\t};\n\t\tthis._onMainUpBound = (e: InteractionEvent): void => {\n\t\t\tthis.onMainUp(e);\n\t\t};\n\t\tmainBaseSprite.on(UtilPointerEvent.down, (e: InteractionEvent) => {\n\t\t\tthis.onMainDown(e);\n\t\t});\n\n\t\t// Base color picker\n\t\tconst baseSprite = new Sprite(theme.getBaseTexture());\n\t\tthis._baseSprite = baseSprite;\n\t\tbaseSprite.x = paddingLeft;\n\t\tbaseSprite.y = mainBaseSprite.y + mainBaseSprite.height + theme.getBaseMargin();\n\t\tbaseSprite.interactive = true;\n\t\tthis.addChild(baseSprite);\n\n\t\t// Base event\n\t\tthis._onBaseMoveBound = (e: InteractionEvent): void => {\n\t\t\tthis.onBaseMove(e);\n\t\t};\n\t\tthis._onBaseUpBound = (e: InteractionEvent): void => {\n\t\t\tthis.onBaseUp(e);\n\t\t};\n\t\tbaseSprite.on(UtilPointerEvent.down, (e: InteractionEvent) => {\n\t\t\tthis.onBaseDown(e);\n\t\t});\n\n\t\t// Alpha picker\n\t\tconst alphaCheckerboardSprite = new Sprite(theme.getAlphaCheckerboardTexture());\n\t\tthis._alphaCheckerboardSprite = alphaCheckerboardSprite;\n\t\talphaCheckerboardSprite.x = padding.getLeft();\n\t\talphaCheckerboardSprite.y = baseSprite.y + theme.getBaseHeight() + theme.getBaseMargin();\n\t\talphaCheckerboardSprite.interactive = false;\n\t\tthis.addChild(alphaCheckerboardSprite);\n\n\t\tconst alphaSprite = new Sprite(theme.getAlphaTexture());\n\t\talphaSprite.tint = this._new.color;\n\t\talphaSprite.interactive = true;\n\t\talphaCheckerboardSprite.addChild(alphaSprite);\n\n\t\t// Alpha event\n\t\tthis._onAlphaMoveBound = (e: InteractionEvent): void => {\n\t\t\tthis.onAlphaMove(e);\n\t\t};\n\t\tthis._onAlphaUpBound = (e: InteractionEvent): void => {\n\t\t\tthis.onAlphaUp(e);\n\t\t};\n\t\talphaSprite.on(UtilPointerEvent.down, (e: InteractionEvent) => {\n\t\t\tthis.onAlphaDown(e);\n\t\t});\n\n\t\t// Pointers\n\t\tconst mainPointerSprite = new Sprite(theme.getMainPointerTexture());\n\t\tthis._mainPointerSprite = mainPointerSprite;\n\t\tmainPointerSprite.x = paddingLeft;\n\t\tmainPointerSprite.y = paddingTop;\n\t\tmainPointerSprite.anchor.x = 0.5;\n\t\tmainPointerSprite.anchor.y = 0.5;\n\t\tmainPointerSprite.tint = theme.getMainPointerColor();\n\t\tmainPointerSprite.alpha = theme.getMainPointerAlpha();\n\t\tmainPointerSprite.interactive = false;\n\t\tthis.addChild(mainPointerSprite);\n\n\t\tconst alphaPointerSprite = new Sprite(theme.getAlphaPointerTexture());\n\t\tthis._alphaPointerSprite = alphaPointerSprite;\n\t\talphaPointerSprite.x = mainWidth;\n\t\talphaPointerSprite.y = alphaCheckerboardSprite.height * 0.5;\n\t\talphaPointerSprite.tint = theme.getAlphaPointerColor();\n\t\talphaPointerSprite.alpha = theme.getAlphaPointerAlpha();\n\t\talphaPointerSprite.anchor.set(0.5, 0.5);\n\t\talphaPointerSprite.interactive = false;\n\t\talphaCheckerboardSprite.addChild(alphaPointerSprite);\n\n\t\tconst basePointerSprite = new Sprite(theme.getBasePointerTexture());\n\t\tthis._basePointerSprite = basePointerSprite;\n\t\tbasePointerSprite.x = 0;\n\t\tbasePointerSprite.y = baseSprite.height * 0.5;\n\t\tbasePointerSprite.tint = theme.getBasePointerColor();\n\t\tbasePointerSprite.alpha = theme.getBasePointerAlpha();\n\t\tbasePointerSprite.anchor.set(0.5, 0.5);\n\t\tbasePointerSprite.interactive = false;\n\t\tbaseSprite.addChild(basePointerSprite);\n\n\t\t// Recently used\n\t\tthis._recentColorSprites = [];\n\t\tconst recentColorSprites = this._recentColorSprites;\n\t\tconst recentColorCount = theme.getRecentColorCount();\n\t\tconst recentColorWidth = theme.getRecentColorWidth();\n\t\tconst recentColorHeight = theme.getRecentColorHeight();\n\t\tconst recentColorWidthHalf = recentColorWidth * 0.5;\n\t\tconst recentColorHeightHalf = recentColorHeight * 0.5;\n\t\tconst recentColorMargin = theme.getRecentColorMargin();\n\t\tconst recentColorY =\n\t\t\talphaCheckerboardSprite.y + theme.getAlphaHeight() + theme.getRecentMargin();\n\t\tconst recentCheckerboardTexture = theme.getRecentCheckerboardTexture();\n\t\tif (DPickerColor.RECENT_COLORS == null) {\n\t\t\tDPickerColor.RECENT_COLORS = new DPickerColorRecent(\n\t\t\t\ttheme.getRecents().slice(0),\n\t\t\t\trecentColorCount\n\t\t\t);\n\t\t}\n\t\tconst recent = (this._recent = DPickerColor.RECENT_COLORS);\n\t\trecent.on(\"change\", () => {\n\t\t\tthis.onRecentChange();\n\t\t});\n\t\tconst onRecentClick = (e: InteractionEvent) => {\n\t\t\tconst checkerboardSprite = e.currentTarget;\n\t\t\tif (checkerboardSprite instanceof Container) {\n\t\t\t\tconst sprite = checkerboardSprite.children[0];\n\t\t\t\tif (sprite instanceof Sprite) {\n\t\t\t\t\tthis.setColorNew(sprite.tint);\n\t\t\t\t\tthis.setAlphaNew(sprite.alpha);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tfor (let i = 0; i < recentColorCount; ++i) {\n\t\t\tconst x = paddingLeft + i * (recentColorWidth + recentColorMargin);\n\n\t\t\tconst checkerboardSprite = new Sprite(recentCheckerboardTexture);\n\t\t\tcheckerboardSprite.x = x + recentColorWidthHalf;\n\t\t\tcheckerboardSprite.y = recentColorY + recentColorHeightHalf;\n\t\t\tcheckerboardSprite.anchor.x = 0.5;\n\t\t\tcheckerboardSprite.anchor.y = 0.5;\n\t\t\tcheckerboardSprite.buttonMode = true;\n\t\t\tcheckerboardSprite.interactive = true;\n\t\t\tUtilPointerEvent.onClick(checkerboardSprite, onRecentClick);\n\t\t\tthis.addChild(checkerboardSprite);\n\n\t\t\tconst sprite = new Sprite(Texture.WHITE);\n\t\t\tconst recentColorAndAlpha = recent.get(i);\n\t\t\tif (recentColorAndAlpha != null) {\n\t\t\t\tsprite.tint = recentColorAndAlpha.color;\n\t\t\t\tsprite.alpha = recentColorAndAlpha.alpha;\n\t\t\t} else {\n\t\t\t\tsprite.tint = 0xffffff;\n\t\t\t\tsprite.alpha = 0;\n\t\t\t}\n\t\t\tsprite.width = recentColorWidth;\n\t\t\tsprite.height = recentColorHeight;\n\t\t\tsprite.anchor.x = 0.5;\n\t\t\tsprite.anchor.y = 0.5;\n\t\t\tsprite.interactive = false;\n\t\t\tcheckerboardSprite.addChild(sprite);\n\t\t\trecentColorSprites.push(sprite);\n\t\t}\n\n\t\t// Input color\n\t\tconst inputMargin = theme.getInputMargin();\n\t\tconst inputLabelWidth = theme.getInputLabelWidth();\n\t\tconst inputY = recentColorY + recentColorHeight + inputMargin;\n\t\tconst inputWidth = (mainWidth - inputMargin) * 0.5;\n\t\tconst inputAndLabelColor = new DInputTextAndLabel({\n\t\t\tparent: this,\n\t\t\tx: paddingLeft,\n\t\t\ty: inputY,\n\t\t\twidth: inputWidth,\n\t\t\tlabel: {\n\t\t\t\twidth: inputLabelWidth,\n\t\t\t\ttext: {\n\t\t\t\t\tvalue: \"#\"\n\t\t\t\t}\n\t\t\t},\n\t\t\tinput: {\n\t\t\t\tweight: 1,\n\t\t\t\ttext: {\n\t\t\t\t\tvalue: \"FFFFFF\"\n\t\t\t\t},\n\t\t\t\ton: {\n\t\t\t\t\tinput: (code: string): void => {\n\t\t\t\t\t\tconst color = UtilRgb.fromCode(code);\n\t\t\t\t\t\tif (color != null) {\n\t\t\t\t\t\t\tthis.setColorNew(color);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis._inputAndLabelColor = inputAndLabelColor;\n\t\tconst inputHeight = inputAndLabelColor.height;\n\n\t\tconst inputAndLabelAlpha = new DInputRealAndLabel({\n\t\t\tparent: this,\n\t\t\tx: paddingLeft,\n\t\t\ty: inputY + inputHeight + inputMargin,\n\t\t\twidth: inputWidth,\n\t\t\tlabel: {\n\t\t\t\twidth: inputLabelWidth,\n\t\t\t\ttext: {\n\t\t\t\t\tvalue: \"A\"\n\t\t\t\t}\n\t\t\t},\n\t\t\tinput: {\n\t\t\t\tweight: 1,\n\t\t\t\ttext: {\n\t\t\t\t\tvalue: 1\n\t\t\t\t},\n\t\t\t\tmin: 0,\n\t\t\t\tmax: 1,\n\t\t\t\ton: {\n\t\t\t\t\tinput: (value: number) => {\n\t\t\t\t\t\tthis.setAlphaNew(value);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis._inputAndLabelAlpha = inputAndLabelAlpha;\n\n\t\t// Samples\n\t\tconst sampleWidth = (inputWidth - inputLabelWidth - inputMargin) * 0.5;\n\t\tconst sampleHeight = inputHeight + inputMargin + inputHeight;\n\t\tconst sampleX = paddingLeft + (mainWidth - inputMargin) * 0.5 + inputMargin;\n\t\tconst sampleY =\n\t\t\tinputY + (inputHeight + inputMargin + inputAndLabelAlpha.height - sampleHeight) * 0.5;\n\n\t\tconst sampleCurrentCheckerboardSprite = new Sprite(theme.getSampleCheckerboardTexture());\n\t\tthis._sampleCurrentCheckerboardSprite = sampleCurrentCheckerboardSprite;\n\t\tsampleCurrentCheckerboardSprite.x = sampleX;\n\t\tsampleCurrentCheckerboardSprite.y = sampleY;\n\t\tsampleCurrentCheckerboardSprite.width = sampleWidth;\n\t\tsampleCurrentCheckerboardSprite.height = sampleHeight;\n\t\tsampleCurrentCheckerboardSprite.interactive = false;\n\t\tthis.addChild(sampleCurrentCheckerboardSprite);\n\n\t\tconst current = this._current;\n\t\tconst sampleCurrentSprite = new Sprite(Texture.WHITE);\n\t\tthis._sampleCurrentSprite = sampleCurrentSprite;\n\t\tsampleCurrentSprite.x = sampleX;\n\t\tsampleCurrentSprite.y = sampleY;\n\t\tsampleCurrentSprite.tint = current.color;\n\t\tsampleCurrentSprite.alpha = current.alpha;\n\t\tsampleCurrentSprite.width = sampleWidth;\n\t\tsampleCurrentSprite.height = sampleHeight;\n\t\tsampleCurrentSprite.interactive = true;\n\t\tsampleCurrentSprite.buttonMode = true;\n\t\tUtilPointerEvent.onClick(sampleCurrentSprite, (): void => {\n\t\t\tthis.setColorNew(current.color);\n\t\t\tthis.setAlphaNew(current.alpha);\n\t\t});\n\t\tthis.addChild(sampleCurrentSprite);\n\n\t\tconst sampleNewCheckerboardSprite = new Sprite(theme.getSampleCheckerboardTexture());\n\t\tthis._sampleNewCheckerboardSprite = sampleNewCheckerboardSprite;\n\t\tsampleNewCheckerboardSprite.x = sampleX + sampleWidth;\n\t\tsampleNewCheckerboardSprite.y = sampleY;\n\t\tsampleNewCheckerboardSprite.width = sampleWidth;\n\t\tsampleNewCheckerboardSprite.height = sampleHeight;\n\t\tsampleNewCheckerboardSprite.interactive = false;\n\t\tthis.addChild(sampleNewCheckerboardSprite);\n\n\t\tconst sampleNewSprite = new Sprite(Texture.WHITE);\n\t\tthis._sampleNewSprite = sampleNewSprite;\n\t\tsampleNewSprite.x = sampleX + sampleWidth;\n\t\tsampleNewSprite.y = sampleY;\n\t\tsampleNewSprite.tint = this._new.color;\n\t\tsampleNewSprite.alpha = this._new.alpha;\n\t\tsampleNewSprite.width = sampleWidth;\n\t\tsampleNewSprite.height = sampleHeight;\n\t\tsampleNewSprite.interactive = false;\n\t\tthis.addChild(sampleNewSprite);\n\n\t\t// Width\n\t\tif (options == null || options.width == null) {\n\t\t\tthis.width = paddingLeft + mainWidth + paddingRight;\n\t\t}\n\n\t\t// Height\n\t\tif (options == null || options.height == null) {\n\t\t\tthis.height =\n\t\t\t\tinputY +\n\t\t\t\tinputAndLabelColor.height +\n\t\t\t\tinputMargin +\n\t\t\t\tinputAndLabelAlpha.height +\n\t\t\t\tpaddingBottom;\n\t\t}\n\t}\n\n\tprotected onMainDown(e: InteractionEvent): void {\n\t\tthis.onMainPick(e.data.global);\n\n\t\tconst layer = DApplications.getLayer(this);\n\t\tif (layer) {\n\t\t\tconst stage = layer.stage;\n\t\t\tstage.on(UtilPointerEvent.move, this._onMainMoveBound);\n\t\t\tstage.on(UtilPointerEvent.up, this._onMainUpBound);\n\t\t}\n\t}\n\n\tprotected onMainMove(e: InteractionEvent): void {\n\t\tthis.onMainPick(e.data.global);\n\t}\n\n\tprotected onMainUp(e: InteractionEvent): void {\n\t\tconst layer = DApplications.getLayer(this);\n\t\tif (layer) {\n\t\t\tconst stage = layer.stage;\n\t\t\tstage.off(UtilPointerEvent.move, this._onMainMoveBound);\n\t\t\tstage.off(UtilPointerEvent.up, this._onMainUpBound);\n\t\t}\n\t}\n\n\tprotected toMainHex(b: number, w0: number, w1: number, shift: number): number {\n\t\treturn Math.max(0, Math.min(255, w0 * 255 + w1 * ((b >> shift) & 0xff))) << shift;\n\t}\n\n\tprotected toMainColor(\n\t\tbase: number,\n\t\ttx: number,\n\t\tty: number,\n\t\twidth: number,\n\t\theight: number\n\t): number {\n\t\tconst hw = width * 0.5;\n\t\tconst ux = Math.max(0, Math.min(1, ((tx - hw) * (1 - ty / height) + hw) / width));\n\t\tconst uy = Math.max(0, Math.min(1, ty / height));\n\t\tconst w1 = Math.abs(0.5 * uy - ux);\n\t\tconst w0 = 1 - w1 - uy;\n\t\tconst r = this.toMainHex(base, w0, w1, 16);\n\t\tconst g = this.toMainHex(base, w0, w1, 8);\n\t\tconst b = this.toMainHex(base, w0, w1, 0);\n\t\treturn r | g | b;\n\t}\n\n\tprotected onMainPick(global: Point): void {\n\t\tconst point = this._pointerPoint;\n\t\tconst padding = this._padding;\n\t\tconst paddingLeft = padding.getLeft();\n\t\tconst paddingTop = padding.getTop();\n\t\tconst theme = this.theme;\n\t\tconst mainWidth = theme.getMainWidth();\n\t\tconst mainHeight = theme.getMainHeight();\n\t\tthis.toLocal(global, undefined, point);\n\t\tconst x = Math.max(0, Math.min(mainWidth, point.x - paddingLeft));\n\t\tconst y = Math.max(0, Math.min(mainHeight, point.y - paddingTop));\n\t\tconst mainPointerSprite = this._mainPointerSprite;\n\t\tmainPointerSprite.position.set(paddingLeft + x, paddingTop + y);\n\t\tthis.onColorNew(this.toMainColor(this._base, x, y, mainWidth, mainHeight));\n\t}\n\n\tprotected setColorCurrent(color: number): void {\n\t\tthis._sampleCurrentSprite.tint = this._current.color = color;\n\t}\n\n\tprotected setAlphaCurrent(alpha: number): void {\n\t\tthis._sampleCurrentSprite.alpha = this._current.alpha = alpha;\n\t}\n\n\tprotected setColorNew(color: number): void {\n\t\tconst theme = this.theme;\n\t\tconst mainWidth = theme.getMainWidth();\n\t\tconst mainHeight = theme.getMainHeight();\n\t\tconst padding = this._padding;\n\n\t\t// Base color\n\t\tconst hsv = UtilHsv.fromRgb(color);\n\t\tthis._mainSprite.tint = this._base = UtilHsv.toRgb(hsv[0], 255, 255);\n\n\t\t// Move the base pointer\n\t\tconst basePointerSprite = this._basePointerSprite;\n\t\tbasePointerSprite.x = Math.max(0, Math.min(1, hsv[0] / 360)) * mainWidth;\n\n\t\t// Move the main pointer\n\t\tconst ns = Math.max(0, Math.min(1, hsv[1] / 255));\n\t\tconst nv = Math.max(0, Math.min(1, 1 - hsv[2] / 255));\n\t\tconst mainPointerSprite = this._mainPointerSprite;\n\t\tmainPointerSprite.tint = nv < 0.45 ? theme.getMainPointerColor() : 0xffffff;\n\t\tmainPointerSprite.position.set(\n\t\t\tpadding.getLeft() + ns * mainWidth,\n\t\t\tpadding.getTop() + nv * mainHeight\n\t\t);\n\n\t\t// New color\n\t\tthis.onColorNew(color);\n\t}\n\n\tprotected onColorNew(color: number): void {\n\t\tconst layer = DApplications.getLayer(this);\n\t\tif (layer) {\n\t\t\tlayer.lock();\n\t\t}\n\t\tthis._sampleNewSprite.tint = this._new.color = color;\n\t\tthis._inputAndLabelColor.input.value = UtilRgb.toCode(color);\n\t\tthis.emit(\"newcolorchange\", color, this);\n\t\tif (layer) {\n\t\t\tlayer.unlock();\n\t\t\tlayer.update();\n\t\t}\n\t}\n\n\tprotected onBaseDown(e: InteractionEvent): void {\n\t\tthis.onBasePick(e.data.global);\n\n\t\tconst layer = DApplications.getLayer(this);\n\t\tif (layer) {\n\t\t\tconst stage = layer.stage;\n\t\t\tstage.on(UtilPointerEvent.move, this._onBaseMoveBound);\n\t\t\tstage.on(UtilPointerEvent.up, this._onBaseUpBound);\n\t\t}\n\t}\n\n\tprotected onBaseMove(e: InteractionEvent): void {\n\t\tthis.onBasePick(e.data.global);\n\t}\n\n\tprotected onBaseUp(e: InteractionEvent): void {\n\t\tconst layer = DApplications.getLayer(this);\n\t\tif (layer) {\n\t\t\tconst stage = layer.stage;\n\t\t\tstage.off(UtilPointerEvent.move, this._onBaseMoveBound);\n\t\t\tstage.off(UtilPointerEvent.up, this._onBaseUpBound);\n\t\t}\n\t}\n\n\tprotected toBaseHex(t: number, shift: number): number {\n\t\treturn Math.max(0, Math.min(255, t * 6 * 255)) << shift;\n\t}\n\n\tprotected toBaseColor(t: number): number {\n\t\tif (t <= 0.167) {\n\t\t\treturn 0xff0000 + this.toBaseHex(t, 8);\n\t\t} else if (t <= 0.333) {\n\t\t\tt = 0.333 - t;\n\t\t\treturn 0x00ff00 + this.toBaseHex(t, 16);\n\t\t} else if (t <= 0.5) {\n\t\t\tt -= 0.333;\n\t\t\treturn 0x00ff00 + this.toBaseHex(t, 0);\n\t\t} else if (t < 0.667) {\n\t\t\tt = 0.667 - t;\n\t\t\treturn 0x0000ff + this.toBaseHex(t, 8);\n\t\t} else if (t < 0.883) {\n\t\t\tt -= 0.667;\n\t\t\treturn 0x0000ff + this.toBaseHex(t, 16);\n\t\t} else {\n\t\t\tt = 0.883 - t;\n\t\t\treturn 0xff0000 + this.toBaseHex(t, 0);\n\t\t}\n\t}\n\n\tprotected onBasePick(global: Point): void {\n\t\tconst point = this._pointerPoint;\n\t\tconst padding = this._padding;\n\t\tconst theme = this.theme;\n\t\tconst mainWidth = theme.getMainWidth();\n\t\tthis.toLocal(global, undefined, point);\n\t\tconst x = Math.max(0, Math.min(mainWidth, point.x - padding.getLeft()));\n\t\tconst basePointerSprite = this._basePointerSprite;\n\t\tbasePointerSprite.x = x;\n\t\tthis.onColorBase(this.toBaseColor(x / mainWidth));\n\t}\n\n\tprotected setColorBase(h: number): void {\n\t\tconst theme = this.theme;\n\t\tconst mainWidth = theme.getMainWidth();\n\t\tconst basePointerSprite = this._basePointerSprite;\n\t\tbasePointerSprite.x = Math.max(0, Math.min(1, h / 360)) * mainWidth;\n\t\tthis.onColorBase(UtilHsv.toRgb(h, 255, 255));\n\t}\n\n\tprotected onColorBase(color: number): void {\n\t\tthis._mainSprite.tint = this._base = color;\n\n\t\tconst mainPointerSprite = this._mainPointerSprite;\n\t\tconst theme = this.theme;\n\t\tconst mainWidth = theme.getMainWidth();\n\t\tconst mainHeight = theme.getMainHeight();\n\t\tconst padding = this._padding;\n\t\tthis.onColorNew(\n\t\t\tthis.toMainColor(\n\t\t\t\tthis._base,\n\t\t\t\tmainPointerSprite.x - padding.getLeft(),\n\t\t\t\tmainPointerSprite.y - padding.getTop(),\n\t\t\t\tmainWidth,\n\t\t\t\tmainHeight\n\t\t\t)\n\t\t);\n\t}\n\n\tprotected onAlphaDown(e: InteractionEvent): void {\n\t\tthis.onAlphaPick(e.data.global);\n\n\t\tconst layer = DApplications.getLayer(this);\n\t\tif (layer) {\n\t\t\tconst stage = layer.stage;\n\t\t\tstage.on(UtilPointerEvent.move, this._onAlphaMoveBound);\n\t\t\tstage.on(UtilPointerEvent.up, this._onAlphaUpBound);\n\t\t}\n\t}\n\n\tprotected onAlphaMove(e: InteractionEvent): void {\n\t\tthis.onAlphaPick(e.data.global);\n\t}\n\n\tprotected onAlphaUp(e: InteractionEvent): void {\n\t\tconst layer = DApplications.getLayer(this);\n\t\tif (layer) {\n\t\t\tconst stage = layer.stage;\n\t\t\tstage.off(UtilPointerEvent.move, this._onAlphaMoveBound);\n\t\t\tstage.off(UtilPointerEvent.up, this._onAlphaUpBound);\n\t\t}\n\t}\n\n\tprotected onAlphaPick(global: Point): void {\n\t\tconst point = this._pointerPoint;\n\t\tconst padding = this._padding;\n\t\tconst theme = this.theme;\n\t\tconst mainWidth = theme.getMainWidth();\n\t\tthis.toLocal(global, undefined, point);\n\t\tconst x = Math.max(0, Math.min(mainWidth, point.x - padding.getLeft()));\n\t\tthis._alphaPointerSprite.x = x;\n\t\tthis.onAlphaNew(x / mainWidth);\n\t}\n\n\tprotected setAlphaNew(alpha: number): void {\n\t\tconst theme = this.theme;\n\t\tconst mainWidth = theme.getMainWidth();\n\t\tthis._alphaPointerSprite.x = Math.max(0, Math.min(1, alpha)) * mainWidth;\n\t\tthis.onAlphaNew(alpha);\n\t}\n\n\tprotected onAlphaNew(alpha: number): void {\n\t\tconst layer = DApplications.getLayer(this);\n\t\tif (layer) {\n\t\t\tlayer.lock();\n\t\t}\n\t\tthis._sampleNewSprite.alpha = this._new.alpha = alpha;\n\t\tthis._inputAndLabelAlpha.input.value = Number(alpha.toFixed(2));\n\t\tthis.emit(\"newalphachange\", alpha, this);\n\t\tif (layer) {\n\t\t\tlayer.unlock();\n\t\t\tlayer.update();\n\t\t}\n\t}\n\n\tprotected onRecentChange(): void {\n\t\tconst sprites = this._recentColorSprites;\n\t\tconst recent = this._recent;\n\t\tfor (let i = 0, imax = sprites.length; i < imax; ++i) {\n\t\t\tconst sprite = sprites[i];\n\t\t\tconst colorAndAlpha = recent.get(i);\n\t\t\tif (colorAndAlpha != null) {\n\t\t\t\tsprite.tint = colorAndAlpha.color;\n\t\t\t\tsprite.alpha = colorAndAlpha.alpha;\n\t\t\t} else {\n\t\t\t\tsprite.tint = 0xffffff;\n\t\t\t\tsprite.alpha = 0;\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DPickerColor\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { utils } from \"pixi.js\";\nimport { DColorGradient } from \"./d-color-gradient\";\n\nconst isEqual = (a: DColorGradient, b: DColorGradient) => {\n\tif (a.direction !== b.direction) {\n\t\treturn false;\n\t}\n\n\tconst ap = a.points;\n\tconst bp = b.points;\n\tif (ap.length !== bp.length) {\n\t\treturn false;\n\t}\n\n\tfor (let j = 0, jmax = ap.length; j < jmax; ++j) {\n\t\tconst apj = ap[j];\n\t\tconst bpj = bp[j];\n\t\tif (apj.color !== bpj.color || apj.alpha !== bpj.alpha || apj.position !== bpj.position) {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\treturn true;\n};\n\nexport class DPickerColorGradientRecent extends utils.EventEmitter {\n\tprotected _recents: DColorGradient[];\n\tprotected _capacity: number;\n\n\tconstructor(recents: DColorGradient[], capacity: number) {\n\t\tsuper();\n\n\t\tthis._recents = recents;\n\t\tthis._capacity = capacity;\n\t}\n\n\tgetCapacity(): number {\n\t\treturn this._capacity;\n\t}\n\n\tget(index: number): DColorGradient | null {\n\t\tconst recents = this._recents;\n\t\tif (0 <= index && index < recents.length) {\n\t\t\treturn recents[recents.length - 1 - index];\n\t\t}\n\t\treturn null;\n\t}\n\n\tset(index: number, points: DColorGradient): DColorGradient | null {\n\t\tconst recents = this._recents;\n\t\tif (0 <= index && index < recents.length) {\n\t\t\tconst result = recents[recents.length - 1 - index];\n\t\t\trecents[recents.length - 1 - index] = points;\n\t\t\tthis.emit(\"change\", this);\n\t\t\treturn result;\n\t\t}\n\t\treturn null;\n\t}\n\n\tcontains(points: DColorGradient): boolean {\n\t\tconst recents = this._recents;\n\t\tfor (let i = 0, imax = recents.length; i < imax; ++i) {\n\t\t\tif (isEqual(recents[i], points)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tadd(points: DColorGradient): this {\n\t\tconst recents = this._recents;\n\t\trecents.push(points);\n\t\tif (this._capacity < recents.length) {\n\t\t\trecents.shift();\n\t\t}\n\t\tthis.emit(\"change\", this);\n\t\treturn this;\n\t}\n\n\tpop(): DColorGradient | null {\n\t\tconst recents = this._recents;\n\t\tconst result = recents.shift();\n\t\tif (result != null) {\n\t\t\tthis.emit(\"change\", this);\n\t\t\treturn result;\n\t\t}\n\t\treturn null;\n\t}\n\n\tsize(): number {\n\t\treturn this._recents.length;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {\n\tBuffer,\n\tGeometry,\n\tMesh,\n\tPoint,\n\tRectangle,\n\tShader,\n\tTexture,\n\tTextureUvs,\n\tutils\n} from \"pixi.js\";\nimport { DApplications } from \"./d-applications\";\nimport { DColorGradient } from \"./d-color-gradient\";\n\nconst VERTEX_SHADER = `\nattribute vec2 aPosition;\nattribute vec2 aUv;\nattribute vec4 aColor;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\n\nvarying vec2 vUv;\nvarying vec4 vColor;\n\nvoid main(void) {\n\tvec3 position = vec3(aPosition.x, aPosition.y, 1.0);\n\tgl_Position = vec4((projectionMatrix * translationMatrix * position).xy, 0.0, 1.0);\n\tvUv = aUv;\n\tvColor = aColor;\n}\n`;\n\nconst FRAGMENT_SHADER = `\nvarying vec2 vUv;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\nuniform vec2 uCheckerColors;\n\nvoid main(void) {\n\tvec4 texture = texture2D(uSampler, vUv);\n\tfloat cy = step( 1.0, mod( gl_FragCoord.y / 10.0, 2.0 ) );\n\tfloat cx = step( 1.0, mod( gl_FragCoord.x / 10.0 + cy, 2.0 ) );\n\tfloat c = mix( uCheckerColors.x, uCheckerColors.y, cx );\n\tgl_FragColor = texture * vec4( mix( vec3( c ), vColor.xyz, vColor.a ), 1.0 );\n}`;\n\nexport interface DPickerColorGradientViewPart {\n\tdata: DColorGradient | null;\n\trect: Rectangle;\n}\n\nexport class DPickerColorGradientView extends Mesh {\n\tprotected _nPointsPerData: number;\n\tprotected _vertices: Float32Array;\n\tprotected _uvs: Float32Array;\n\tprotected _colors: Float32Array;\n\tprotected _indices: Uint16Array;\n\tprotected _lastHitIndex: number;\n\n\tprotected _workColor: number[];\n\tprotected _workPoint: Point;\n\n\tprotected _parts: DPickerColorGradientViewPart[];\n\n\tprotected constructor(\n\t\tnPointsPerData: number,\n\t\tvertices: Float32Array,\n\t\tuvs: Float32Array,\n\t\tcolors: Float32Array,\n\t\tindices: Uint16Array,\n\t\tparts: DPickerColorGradientViewPart[],\n\t\tgeometry: Geometry,\n\t\tshader: Shader\n\t) {\n\t\tsuper(geometry, shader);\n\n\t\tthis.interactive = true;\n\t\tthis.interactiveChildren = false;\n\t\tthis.cursor = \"pointer\";\n\n\t\tthis._nPointsPerData = nPointsPerData;\n\t\tthis._vertices = vertices;\n\t\tthis._uvs = uvs;\n\t\tthis._colors = colors;\n\t\tthis._indices = indices;\n\t\tthis._lastHitIndex = -1;\n\t\tthis._workColor = [0, 0, 0];\n\t\tthis._workPoint = new Point();\n\t\tthis._parts = parts;\n\n\t\tshader.uniforms.uSampler.on(\"update\", (): void => {\n\t\t\tthis.update();\n\t\t\tDApplications.update(this);\n\t\t});\n\t\tthis.update();\n\t}\n\n\tgetRectangle(index: number): Rectangle | null {\n\t\tconst parts = this._parts;\n\t\tif (0 <= index && index < parts.length) {\n\t\t\treturn parts[index].rect;\n\t\t}\n\t\treturn null;\n\t}\n\n\tsetRectangle(index: number, x: number, y: number, width: number, height: number): void {\n\t\tconst parts = this._parts;\n\t\tif (0 <= index && index < parts.length) {\n\t\t\tconst rect = parts[index].rect;\n\t\t\trect.x = x;\n\t\t\trect.y = y;\n\t\t\trect.width = width;\n\t\t\trect.height = height;\n\t\t}\n\t}\n\n\tgetData(index: number): DColorGradient | null {\n\t\tconst parts = this._parts;\n\t\tif (0 <= index && index < parts.length) {\n\t\t\treturn parts[index].data;\n\t\t}\n\t\treturn null;\n\t}\n\n\tsetData(index: number, data: DColorGradient | null): void {\n\t\tconst parts = this._parts;\n\t\tif (0 <= index && index < parts.length) {\n\t\t\tparts[index].data = data;\n\t\t}\n\t}\n\n\tgetLastHitIndex(): number {\n\t\treturn this._lastHitIndex;\n\t}\n\n\tprivate setColors(ic: number, colors: Float32Array, rgb: number[], alpha: number) {\n\t\tcolors[ic + 0] = rgb[0];\n\t\tcolors[ic + 1] = rgb[1];\n\t\tcolors[ic + 2] = rgb[2];\n\t\tcolors[ic + 3] = alpha;\n\t\tcolors[ic + 4] = rgb[0];\n\t\tcolors[ic + 5] = rgb[1];\n\t\tcolors[ic + 6] = rgb[2];\n\t\tcolors[ic + 7] = alpha;\n\t}\n\n\tprivate setColorsHex(ic: number, colors: Float32Array, color: number, alpha: number) {\n\t\tconst rgb = utils.hex2rgb(color, this._workColor);\n\t\tthis.setColors(ic, colors, rgb, alpha);\n\t}\n\n\tprivate setColorsWhite(ic: number, colors: Float32Array) {\n\t\tconst rgb = this._workColor;\n\t\trgb[0] = 1;\n\t\trgb[1] = 1;\n\t\trgb[2] = 1;\n\t\tthis.setColors(ic, colors, rgb, 0);\n\t}\n\n\tprivate setColorsPoint(ic: number, data: DColorGradient, index: number, colors: Float32Array) {\n\t\tconst point = data.points[index];\n\t\tif (point != null) {\n\t\t\tthis.setColorsHex(ic, colors, point.color, point.alpha);\n\t\t} else {\n\t\t\tthis.setColorsWhite(ic, colors);\n\t\t}\n\t}\n\n\tprotected setVertices(\n\t\tiv: number,\n\t\tvertices: Float32Array,\n\t\tposition: number,\n\t\trect: Rectangle\n\t): void {\n\t\tconst y = rect.y + rect.height * position;\n\t\tvertices[iv + 0] = rect.x;\n\t\tvertices[iv + 1] = y;\n\t\tvertices[iv + 2] = rect.x + rect.width;\n\t\tvertices[iv + 3] = y;\n\t}\n\n\tprotected setUvs(\n\t\tiv: number,\n\t\tuvs: Float32Array,\n\t\tposition: number,\n\t\ttextureUvs: TextureUvs\n\t): void {\n\t\tconst x0 = textureUvs.x0 + (textureUvs.x3 - textureUvs.x0) * position;\n\t\tconst y0 = textureUvs.y0 + (textureUvs.y3 - textureUvs.y0) * position;\n\t\tconst x1 = textureUvs.x1 + (textureUvs.x2 - textureUvs.x1) * position;\n\t\tconst y1 = textureUvs.y1 + (textureUvs.y2 - textureUvs.y1) * position;\n\t\tuvs[iv + 0] = x0;\n\t\tuvs[iv + 1] = y0;\n\t\tuvs[iv + 2] = x1;\n\t\tuvs[iv + 3] = y1;\n\t}\n\n\tprivate newIndices(ii: number, iv: number, size: number, indices: Uint16Array): Uint16Array {\n\t\tfor (let i = 0; i < size; ++i) {\n\t\t\tindices[ii + 0] = iv + 0;\n\t\t\tindices[ii + 1] = iv + 1;\n\t\t\tindices[ii + 2] = iv + 2;\n\n\t\t\tindices[ii + 3] = iv + 2;\n\t\t\tindices[ii + 4] = iv + 1;\n\t\t\tindices[ii + 5] = iv + 3;\n\n\t\t\tii += 6;\n\t\t\tiv += 2;\n\t\t}\n\t\treturn indices;\n\t}\n\n\tprotected _calculateBounds(): void {\n\t\tconst rect = this._parts[0].rect;\n\t\tconst bounds = this._bounds;\n\t\tconst work = this._workPoint;\n\t\twork.set(rect.x, rect.y);\n\t\tbounds.addPoint(work);\n\t\twork.set(rect.x + rect.width, rect.y + rect.height);\n\t\tbounds.addPoint(work);\n\t}\n\n\tupdate(): void {\n\t\tconst vertices = this._vertices;\n\t\tconst uvs = this._uvs;\n\t\tconst colors = this._colors;\n\t\tconst indices = this._indices;\n\n\t\tconst texture = this.shader.uniforms.uSampler;\n\t\tif (texture._uvs == null) {\n\t\t\ttexture.updateUvs();\n\t\t}\n\t\tconst textureUvs: TextureUvs = texture._uvs;\n\n\t\tlet iv = 0;\n\t\tlet nv = 0;\n\t\tlet ic = 0;\n\t\tlet ii = 0;\n\n\t\tconst parts = this._parts;\n\t\tfor (let i = 0, imax = parts.length; i < imax; ++i) {\n\t\t\tconst data = parts[i].data;\n\t\t\tconst rect = parts[i].rect;\n\t\t\tif (data == null) {\n\t\t\t\tthis.setVertices(iv, vertices, 0, rect);\n\t\t\t\tthis.setUvs(iv, uvs, 0, textureUvs);\n\t\t\t\tthis.setColorsWhite(ic, colors);\n\t\t\t\tthis.setVertices(iv + 4, vertices, 1, rect);\n\t\t\t\tthis.setUvs(iv, uvs, 1, textureUvs);\n\t\t\t\tthis.setColorsWhite(ic + 8, colors);\n\t\t\t\tthis.newIndices(ii, nv, 1, indices);\n\t\t\t\tiv += 4 * 2;\n\t\t\t\tic += 4 * 4;\n\t\t\t\tnv += 4;\n\t\t\t\tii += 6;\n\t\t\t} else {\n\t\t\t\tthis.setVertices(iv, vertices, 0, rect);\n\t\t\t\tthis.setUvs(iv, uvs, 0, textureUvs);\n\t\t\t\tthis.setColorsPoint(ic, data, 0, colors);\n\t\t\t\tiv += 2 * 2;\n\t\t\t\tic += 2 * 4;\n\t\t\t\tconst pointSize = data.points.length;\n\t\t\t\tfor (let j = 0, jmax = Math.min(pointSize, this._nPointsPerData); j < jmax; ++j) {\n\t\t\t\t\tconst point = data.points[j];\n\t\t\t\t\tthis.setVertices(iv, vertices, point.position, rect);\n\t\t\t\t\tthis.setUvs(iv, uvs, point.position, textureUvs);\n\t\t\t\t\tthis.setColorsHex(ic, colors, point.color, point.alpha);\n\t\t\t\t\tiv += 2 * 2;\n\t\t\t\t\tic += 2 * 4;\n\t\t\t\t}\n\t\t\t\tthis.setVertices(iv, vertices, 1, rect);\n\t\t\t\tthis.setUvs(iv, uvs, 1, textureUvs);\n\t\t\t\tthis.setColorsPoint(ic, data, pointSize - 1, colors);\n\t\t\t\tiv += 2 * 2;\n\t\t\t\tic += 2 * 4;\n\n\t\t\t\tthis.newIndices(ii, nv, pointSize + 1, indices);\n\t\t\t\tii += (pointSize + 1) * 6;\n\t\t\t\tnv += (pointSize + 2) * 2;\n\t\t\t}\n\t\t}\n\n\t\tthis.size = ii;\n\n\t\tconst geometry = this.geometry;\n\t\tgeometry.getBuffer(\"aPosition\").update();\n\t\tgeometry.getBuffer(\"aUv\").update();\n\t\tgeometry.getBuffer(\"aColor\").update();\n\t\tgeometry.getIndex().update();\n\t}\n\n\tcontainsPoint(point: Point): boolean {\n\t\tconst local = this.toLocal(point, undefined, this._workPoint);\n\t\tconst parts = this._parts;\n\t\tfor (let i = 0, imax = parts.length; i < imax; ++i) {\n\t\t\tconst rect = parts[i].rect;\n\t\t\tif (rect.contains(local.x, local.y)) {\n\t\t\t\tthis._lastHitIndex = i;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tstatic from(\n\t\tsize: number,\n\t\tnPointsPerData: number,\n\t\tcheckerColors: [number, number],\n\t\ttexture: Texture = Texture.WHITE\n\t): DPickerColorGradientView {\n\t\tconst vertices = new Float32Array(size * (nPointsPerData + 2) * 2 * 2);\n\t\tconst uvs = new Float32Array(size * (nPointsPerData + 2) * 2 * 2);\n\t\tconst colors = new Float32Array(size * (nPointsPerData + 2) * 2 * 4);\n\t\tconst indices = new Uint16Array(size * (nPointsPerData + 1) * 6);\n\n\t\tconst parts: DPickerColorGradientViewPart[] = [];\n\t\tfor (let i = 0; i < size; ++i) {\n\t\t\tparts.push({\n\t\t\t\tdata: null,\n\t\t\t\trect: new Rectangle()\n\t\t\t});\n\t\t}\n\n\t\tconst geometry = new Geometry()\n\t\t\t.addIndex(new Buffer(indices, false, true))\n\t\t\t.addAttribute(\"aPosition\", new Buffer(vertices, false, false), 2)\n\t\t\t.addAttribute(\"aUv\", new Buffer(uvs, false, false), 2)\n\t\t\t.addAttribute(\"aColor\", new Buffer(colors, false, false), 4);\n\t\tconst shader = Shader.from(VERTEX_SHADER, FRAGMENT_SHADER, {\n\t\t\tuSampler: texture,\n\t\t\tuCheckerColors: checkerColors\n\t\t});\n\n\t\treturn new DPickerColorGradientView(\n\t\t\tnPointsPerData,\n\t\t\tvertices,\n\t\t\tuvs,\n\t\t\tcolors,\n\t\t\tindices,\n\t\t\tparts,\n\t\t\tgeometry,\n\t\t\tshader\n\t\t);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction, Point, Sprite, Texture } from \"pixi.js\";\nimport InteractionEvent = interaction.InteractionEvent;\nimport { DAlignWith } from \"./d-align-with\";\nimport { DApplications } from \"./d-applications\";\nimport { DBase, DBaseOptions, DThemeBase } from \"./d-base\";\nimport { DColorGradient, DColorGradientPoint } from \"./d-color-gradient\";\nimport { DColorGradientObservable } from \"./d-color-gradient-observable\";\nimport { DInputReal } from \"./d-input-real\";\nimport { DPickerColor } from \"./d-picker-color\";\nimport { DPickerColorGradientRecent } from \"./d-picker-color-gradient-recent\";\nimport { DPickerColorGradientView } from \"./d-picker-color-gradient-view\";\nimport { UtilKeyboardEvent } from \"./util/util-keyboard-event\";\nimport { UtilPointerEvent } from \"./util/util-pointer-event\";\n\nexport interface DPickerColorGradientOptions<\n\tTHEME extends DThemePickerColorGradient = DThemePickerColorGradient\n> extends DBaseOptions<THEME> {}\n\nexport interface DThemePickerColorGradient extends DThemeBase {\n\tgetGradientPointsWidth(): number;\n\tgetGradientPointsMargin(): number;\n\n\tgetGradientAnchorTexture(): Texture;\n\tgetGradientAnchorOutlinedTexture(): Texture;\n\tgetGradientAnchorOutlineTexture(): Texture;\n\n\tgetGradientDirectionMargin(): number;\n\tgetGradientDirectionTexture(): Texture;\n\n\tgetGradientRecentColumn(): number;\n\tgetGradientRecentWidth(): number;\n\tgetGradientRecentMargin(): number;\n\tgetGradientRecentCount(): number;\n\tgetGradientRecents(): DColorGradient[];\n\n\tgetGradientCheckerColors(): [number, number];\n}\n\nexport class DPickerColorGradient<\n\tTHEME extends DThemePickerColorGradient = DThemePickerColorGradient,\n\tOPTIONS extends DPickerColorGradientOptions<THEME> = DPickerColorGradientOptions<THEME>\n> extends DBase<THEME, OPTIONS> {\n\tprotected static RECENT_COLOR_GRADIENT: DPickerColorGradientRecent | null = null;\n\n\tprotected _picker!: DPickerColor;\n\tprotected _view!: DPickerColorGradientView;\n\tprotected _anchors!: Sprite[];\n\tprotected _recent!: DPickerColorGradientRecent;\n\n\tprotected _onAnchorDownBound!: (e: InteractionEvent) => void;\n\tprotected _onAnchorMoveBound!: (e: InteractionEvent) => void;\n\tprotected _onAnchorUpBound!: (e: InteractionEvent) => void;\n\n\tprotected _value!: DColorGradientObservable;\n\tprotected _work!: Point;\n\n\tprotected init(options?: OPTIONS): void {\n\t\tsuper.init(options);\n\n\t\tconst theme = this.theme;\n\t\tconst padding = this._padding;\n\t\tconst paddingTop = padding.getTop();\n\t\tconst paddingRight = padding.getRight();\n\t\tconst paddingBottom = padding.getBottom();\n\t\tconst paddingLeft = padding.getLeft();\n\t\tthis._work = new Point();\n\n\t\t// Picker\n\t\tconst gradientPointsWidth = theme.getGradientPointsWidth();\n\t\tconst gradientPointsMargin = theme.getGradientPointsMargin();\n\t\tconst picker = new DPickerColor({\n\t\t\tx: paddingLeft + gradientPointsWidth + gradientPointsMargin,\n\t\t\ty: paddingTop\n\t\t});\n\t\tthis._picker = picker;\n\t\tpicker.on(\"newcolorchange\", (color: number): void => {\n\t\t\tthis.onAnchorColorChange(color);\n\t\t});\n\t\tpicker.on(\"newalphachange\", (alpha: number): void => {\n\t\t\tthis.onAnchorAlphaChange(alpha);\n\t\t});\n\t\tthis.addChild(picker);\n\n\t\t// Points view\n\t\tconst view = (this._view = DPickerColorGradientView.from(\n\t\t\t17,\n\t\t\t10,\n\t\t\ttheme.getGradientCheckerColors()\n\t\t));\n\t\tview.setRectangle(0, paddingLeft, paddingTop, gradientPointsWidth, picker.height);\n\t\tthis.addChild(view);\n\t\tview.on(UtilPointerEvent.down, (e: InteractionEvent): void => {\n\t\t\tif (view.getLastHitIndex() === 0) {\n\t\t\t\tthis.onViewDown(e);\n\t\t\t}\n\t\t});\n\n\t\t// Anchor\n\t\tthis._onAnchorDownBound = (e: InteractionEvent): void => {\n\t\t\tthis.onAnchorDown(e);\n\t\t};\n\t\tthis._onAnchorMoveBound = (e: InteractionEvent): void => {\n\t\t\tthis.onAnchorMove(e);\n\t\t};\n\t\tthis._onAnchorUpBound = (e: InteractionEvent): void => {\n\t\t\tthis.onAnchorUp(e);\n\t\t};\n\t\tthis._anchors = [];\n\n\t\t//\n\t\tconst recentColumn = theme.getGradientRecentColumn();\n\t\tconst recentWidth = theme.getGradientRecentWidth();\n\t\tconst recentMargin = theme.getGradientRecentMargin();\n\t\tconst recentWidthAndMargin = recentWidth + recentMargin;\n\t\tconst inputLabelWidth = picker.theme.getInputLabelWidth();\n\t\tconst inputWidth = recentWidth * recentColumn + recentMargin * (recentColumn - 1);\n\t\tconst inputMargin = 5;\n\t\tconst inputDirectionMargin = theme.getGradientDirectionMargin();\n\t\tconst inputDirectionTexture = theme.getGradientDirectionTexture();\n\t\tconst inputLeft = picker.x + picker.width + inputDirectionMargin;\n\t\tconst inputDirection = new DInputReal({\n\t\t\tparent: this,\n\t\t\tx: inputLeft + inputLabelWidth + inputMargin,\n\t\t\ty: paddingTop,\n\t\t\twidth: inputWidth - (inputLabelWidth + inputMargin) * 2,\n\t\t\tstep: 1,\n\t\t\timage: {\n\t\t\t\tsource: inputDirectionTexture,\n\t\t\t\talign: {\n\t\t\t\t\twith: DAlignWith.BORDER\n\t\t\t\t},\n\t\t\t\tmargin: {\n\t\t\t\t\thorizontal: -inputDirectionTexture.width - inputMargin\n\t\t\t\t}\n\t\t\t},\n\t\t\ton: {\n\t\t\t\tchange: (value: number) => {\n\t\t\t\t\t(this._value as any)._direction = value;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t// Recent gradients\n\t\tconst x0 = inputLeft;\n\t\tconst y0 = inputDirection.y + inputDirection.height + inputDirectionMargin;\n\t\tif (DPickerColorGradient.RECENT_COLOR_GRADIENT == null) {\n\t\t\tDPickerColorGradient.RECENT_COLOR_GRADIENT = new DPickerColorGradientRecent(\n\t\t\t\ttheme.getGradientRecents(),\n\t\t\t\ttheme.getGradientRecentCount()\n\t\t\t);\n\t\t}\n\t\tthis._recent = DPickerColorGradient.RECENT_COLOR_GRADIENT;\n\t\tconst recent = this._recent;\n\t\tfor (let i = 0, imax = recent.getCapacity(); i < imax; ++i) {\n\t\t\tconst ix = i % recentColumn;\n\t\t\tconst x = x0 + ix * recentWidthAndMargin;\n\t\t\tconst iy = (i / recentColumn) | 0;\n\t\t\tconst y = y0 + iy * recentWidthAndMargin;\n\t\t\tview.setRectangle(1 + i, x, y, recentWidth, recentWidth);\n\t\t}\n\t\trecent.on(\"change\", (): void => {\n\t\t\tthis.onRecentUpdate();\n\t\t});\n\t\tUtilPointerEvent.onClick(view, (e: InteractionEvent): void => {\n\t\t\tconst lastHitIndex = view.getLastHitIndex();\n\t\t\tif (1 <= lastHitIndex) {\n\t\t\t\tthis.onRecentClick(view.getData(lastHitIndex));\n\t\t\t}\n\t\t});\n\n\t\t// Points\n\t\tconst data = new DColorGradientObservable();\n\t\tthis._value = data;\n\t\tdata.on(\"change\", (): void => {\n\t\t\tthis.updateAnchors();\n\t\t\tview.update();\n\t\t});\n\t\tdata.on(\"selectionchange\", (point: DColorGradientPoint): void => {\n\t\t\tthis.onAnchorSelect(point);\n\t\t});\n\t\tdata.on(\"directionchange\", (value: number): void => {\n\t\t\tinputDirection.value = value;\n\t\t});\n\t\tview.setData(0, data);\n\t\tview.update();\n\t\tinputDirection.value = data.direction;\n\t\tthis.updateAnchors();\n\t\tconst selected = data.selected;\n\t\tif (selected != null) {\n\t\t\tthis.onAnchorSelect(selected);\n\t\t}\n\n\t\t// Width\n\t\tif (options == null || options.width == null) {\n\t\t\tthis.width =\n\t\t\t\tpaddingLeft +\n\t\t\t\tgradientPointsWidth +\n\t\t\t\tgradientPointsMargin +\n\t\t\t\tpicker.width +\n\t\t\t\tinputDirectionMargin +\n\t\t\t\t(recentColumn - 1) * recentMargin +\n\t\t\t\trecentColumn * recentWidth +\n\t\t\t\tpaddingRight;\n\t\t}\n\n\t\t// Height\n\t\tif (options == null || options.height == null) {\n\t\t\tthis.height = paddingTop + picker.height + paddingBottom;\n\t\t}\n\t}\n\n\tget value(): DColorGradientObservable {\n\t\treturn this._value;\n\t}\n\n\tget recent(): DPickerColorGradientRecent {\n\t\treturn this._recent;\n\t}\n\n\tprotected onRecentClick(recentData: DColorGradient | null): void {\n\t\tconst value = this._value;\n\t\tif (recentData != null) {\n\t\t\tvalue.fromObject(recentData);\n\t\t} else {\n\t\t\tvalue.reset();\n\t\t}\n\t}\n\n\tprotected onRecentUpdate(): void {\n\t\tconst recent = this._recent;\n\t\tconst view = this._view;\n\t\tfor (let i = 0, imax = recent.size(); i < imax; ++i) {\n\t\t\tview.setData(1 + i, recent.get(i));\n\t\t}\n\t\tview.update();\n\t\tDApplications.update(this);\n\t}\n\n\tprotected toAnchorPosition(e: InteractionEvent): number {\n\t\tconst local = this.toLocal(e.data.global, undefined, this._work);\n\t\treturn Math.max(0, Math.min(1, (local.y - this.padding.getTop()) / this._picker.height));\n\t}\n\n\tprotected onViewDown(e: InteractionEvent): void {\n\t\tthis._value.addAt(this.toAnchorPosition(e));\n\t\tthis.onAnchorDragStart();\n\t}\n\n\tprotected onAnchorDown(e: InteractionEvent): void {\n\t\tconst target = e.target;\n\t\tif (target instanceof Sprite) {\n\t\t\tconst value = this._value;\n\t\t\tconst index = this._anchors.indexOf(target);\n\t\t\tif (0 <= index && index < value.points.length) {\n\t\t\t\tvalue.points[index].selected = true;\n\t\t\t\tthis.onAnchorDragStart();\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected onAnchorSelect(point: DColorGradientPoint): void {\n\t\tconst picker = this._picker;\n\t\tpicker.current.color = point.color;\n\t\tpicker.current.alpha = point.alpha;\n\t\tpicker.new.color = point.color;\n\t\tpicker.new.alpha = point.alpha;\n\t}\n\n\tprotected onAnchorColorChange(color: number): void {\n\t\tconst value = this._value;\n\t\tif (value != null) {\n\t\t\tconst selected = value.selected;\n\t\t\tif (selected != null) {\n\t\t\t\tselected.color = color;\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected onAnchorAlphaChange(alpha: number): void {\n\t\tconst value = this._value;\n\t\tif (value != null) {\n\t\t\tconst selected = value.selected;\n\t\t\tif (selected != null) {\n\t\t\t\tselected.alpha = alpha;\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected onAnchorDragStart(): void {\n\t\tconst layer = DApplications.getLayer(this);\n\t\tif (layer) {\n\t\t\tconst stage = layer.stage;\n\t\t\tstage.on(UtilPointerEvent.move, this._onAnchorMoveBound);\n\t\t\tstage.on(UtilPointerEvent.up, this._onAnchorUpBound);\n\t\t}\n\t}\n\n\tprotected onAnchorMove(e: InteractionEvent): void {\n\t\tconst value = this._value;\n\t\tif (value != null) {\n\t\t\tconst selected = value.selected;\n\t\t\tif (selected != null) {\n\t\t\t\tselected.position = this.toAnchorPosition(e);\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected onAnchorUp(e: InteractionEvent): void {\n\t\tconst layer = DApplications.getLayer(this);\n\t\tif (layer) {\n\t\t\tconst stage = layer.stage;\n\t\t\tstage.off(UtilPointerEvent.move, this._onAnchorMoveBound);\n\t\t\tstage.off(UtilPointerEvent.up, this._onAnchorUpBound);\n\t\t}\n\t}\n\n\tprotected updateAnchors(): void {\n\t\tconst theme = this.theme;\n\t\tconst anchorTexture = theme.getGradientAnchorTexture();\n\t\tconst anchorOutlinedTexture = theme.getGradientAnchorOutlinedTexture();\n\t\tconst gradientPointsWidth = theme.getGradientPointsWidth();\n\n\t\tconst value = this._value;\n\t\tconst pointSize = value.points.length;\n\n\t\tconst anchors = this._anchors;\n\t\tconst anchorSize = anchors.length;\n\t\tfor (let i = anchorSize; i < pointSize; ++i) {\n\t\t\tconst newAnchor = new Sprite(anchorTexture);\n\t\t\tnewAnchor.anchor.set(0.5, 0.5);\n\t\t\tnewAnchor.cursor = \"pointer\";\n\t\t\tnewAnchor.interactive = true;\n\t\t\tnewAnchor.on(UtilPointerEvent.down, this._onAnchorDownBound);\n\t\t\tanchors.push(newAnchor);\n\t\t\tthis.addChild(newAnchor);\n\t\t}\n\n\t\tfor (let i = anchorSize - 1; pointSize <= i; --i) {\n\t\t\tconst oldAnchor = anchors[i];\n\t\t\toldAnchor.off(UtilPointerEvent.down, this._onAnchorDownBound);\n\t\t\toldAnchor.destroy();\n\t\t}\n\t\tanchors.length = pointSize;\n\n\t\tconst y = this.padding.getTop();\n\t\tconst right = this.padding.getLeft() + gradientPointsWidth;\n\t\tconst height = this._picker.height;\n\t\tfor (let i = 0; i < pointSize; ++i) {\n\t\t\tconst point = value.points[i];\n\t\t\tconst anchor = anchors[i];\n\t\t\tanchor.tint = point.color;\n\t\t\tanchor.position.set(right, y + height * point.position);\n\t\t\tanchor.texture = point.selected ? anchorOutlinedTexture : anchorTexture;\n\t\t}\n\n\t\tDApplications.update(this);\n\t}\n\n\tonKeyDown(e: KeyboardEvent): boolean {\n\t\tif (UtilKeyboardEvent.isDeleteKey(e)) {\n\t\t\tconst value = this._value;\n\t\t\tif (value != null) {\n\t\t\t\tconst selected = value.selected;\n\t\t\t\tif (selected != null) {\n\t\t\t\t\tvalue.remove(selected);\n\t\t\t\t\tsuper.onKeyDown(e);\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn super.onKeyDown(e);\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DPickerColorGradient\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DColorGradient } from \"./d-color-gradient\";\nimport { DColorGradientObservable } from \"./d-color-gradient-observable\";\nimport { DDialogCommand, DDialogCommandOptions, DThemeDialogCommand } from \"./d-dialog-command\";\nimport { DLayoutVertical } from \"./d-layout-vertical\";\nimport { DPickerColorGradient, DPickerColorGradientOptions } from \"./d-picker-color-gradient\";\nimport { DPickerColorGradientRecent } from \"./d-picker-color-gradient-recent\";\n\nexport interface DDialogColorGradientOptions<\n\tTHEME extends DThemeDialogColorGradient = DThemeDialogColorGradient\n> extends DDialogCommandOptions<DColorGradient, THEME> {\n\tpicker?: DPickerColorGradientOptions;\n}\n\nexport interface DThemeDialogColorGradient extends DThemeDialogCommand {}\n\nexport class DDialogColorGradient<\n\tTHEME extends DThemeDialogColorGradient = DThemeDialogColorGradient,\n\tOPTIONS extends DDialogColorGradientOptions<THEME> = DDialogColorGradientOptions<THEME>\n> extends DDialogCommand<DColorGradient, THEME, OPTIONS> {\n\tprotected _picker?: DPickerColorGradient;\n\n\tprotected onInit(layout: DLayoutVertical, options?: OPTIONS): void {\n\t\tsuper.onInit(layout, options);\n\t\tlayout.addChild(this.picker);\n\t}\n\n\tprotected onOk(value: DColorGradient | PromiseLike<DColorGradient>): void {\n\t\tsuper.onOk(value);\n\n\t\tconst picker = this.picker;\n\t\tconst data = picker.value;\n\t\tconst recent = picker.recent;\n\t\tif (!recent.contains(data)) {\n\t\t\trecent.add(data.toObject());\n\t\t}\n\t}\n\n\tget value(): DColorGradientObservable {\n\t\treturn this.picker.value;\n\t}\n\n\tget recent(): DPickerColorGradientRecent {\n\t\treturn this.picker.recent;\n\t}\n\n\tget picker(): DPickerColorGradient {\n\t\tlet result = this._picker;\n\t\tif (result == null) {\n\t\t\tresult = new DPickerColorGradient(this._options?.picker);\n\t\t\tthis._picker = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected getResolvedValue(): DColorGradient | PromiseLike<DColorGradient> {\n\t\treturn this.picker.value;\n\t}\n\n\tonKeyDown(e: KeyboardEvent): boolean {\n\t\tthis.picker.onKeyDown(e);\n\t\treturn super.onKeyDown(e);\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DDialogColorGradient\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction, Texture } from \"pixi.js\";\nimport { DApplications } from \"./d-applications\";\nimport { DButton, DButtonEvents, DButtonOptions, DThemeButton } from \"./d-button\";\nimport { DColorGradientObservable } from \"./d-color-gradient-observable\";\nimport { DDialogColorGradient, DDialogColorGradientOptions } from \"./d-dialog-color-gradient\";\nimport { DOnOptions } from \"./d-on-options\";\nimport { DPickerColorGradientView } from \"./d-picker-color-gradient-view\";\n\n/**\n * {@link DButtonColorGradient} events.\n */\nexport interface DButtonColorGradientEvents<EMITTER>\n\textends DButtonEvents<DColorGradientObservable, EMITTER> {\n\t/**\n\t * Triggered when a selection is changed.\n\t *\n\t * @param newValue a newly selected value\n\t * @param oldValue a previously selected value\n\t * @param emitter an emitter\n\t */\n\tchange(\n\t\tnewValue: DColorGradientObservable,\n\t\toldValue: DColorGradientObservable,\n\t\temitter: EMITTER\n\t): void;\n}\n\n/**\n * {@link DButtonColorGradient} \"on\" options.\n */\nexport interface DButtonColorGradientOnOptions<EMITTER>\n\textends Partial<DButtonColorGradientEvents<EMITTER>>,\n\t\tDOnOptions {}\n\n/**\n * {@link DButtonColorGradient} options.\n */\nexport interface DButtonColorGradientOptions<\n\tTHEME extends DThemeButtonColorGradient = DThemeButtonColorGradient,\n\tEMITTER = any\n> extends DButtonOptions<DColorGradientObservable, THEME, EMITTER> {\n\tdialog?: DDialogColorGradientOptions;\n\ton?: DButtonColorGradientOnOptions<EMITTER>;\n}\n\n/**\n * {@link DButtonColorGradient} theme.\n */\nexport interface DThemeButtonColorGradient extends DThemeButton<DColorGradientObservable> {\n\tgetViewBaseTexture(): Texture | null;\n\tgetCheckerColors(): [number, number];\n}\n\nexport class DButtonColorGradient<\n\tTHEME extends DThemeButtonColorGradient = DThemeButtonColorGradient,\n\tOPTIONS extends DButtonColorGradientOptions<THEME> = DButtonColorGradientOptions<THEME>\n> extends DButton<DColorGradientObservable, THEME, OPTIONS> {\n\tprotected static DIALOG?: DDialogColorGradient;\n\tprotected _dialog?: DDialogColorGradient;\n\tprotected _view?: DPickerColorGradientView;\n\n\tprotected init(options?: OPTIONS): void {\n\t\tsuper.init(options);\n\n\t\tconst source = options?.image?.source;\n\t\tif (source === undefined) {\n\t\t\tconst theme = this.theme;\n\t\t\tconst texture = theme.getViewBaseTexture();\n\t\t\tif (texture instanceof Texture) {\n\t\t\t\tconst checkers = theme.getCheckerColors();\n\t\t\t\tconst view = DPickerColorGradientView.from(1, 10, checkers, texture);\n\t\t\t\tthis._view = view;\n\t\t\t\tview.setRectangle(0, 0, 0, texture.width, texture.height);\n\t\t\t\tview.setData(0, this._textValueComputed!);\n\t\t\t\tview.update();\n\t\t\t\tthis.image = view;\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected onActivate(\n\t\te?: interaction.InteractionEvent | KeyboardEvent | MouseEvent | TouchEvent\n\t): void {\n\t\tsuper.onActivate(e);\n\t\tconst value = this._textValueComputed!;\n\t\tconst dialog = this.dialog;\n\t\tdialog.value.fromObject(value);\n\t\tdialog.open().then((): void => {\n\t\t\tconst newValue = dialog.value;\n\t\t\tconst oldValue = new DColorGradientObservable().fromObject(value);\n\t\t\tvalue.fromObject(newValue);\n\t\t\tconst view = this._view;\n\t\t\tif (view != null) {\n\t\t\t\tview.update();\n\t\t\t}\n\t\t\tthis.onTextChange();\n\t\t\tthis.createOrUpdateText();\n\t\t\tDApplications.update(this);\n\t\t\tthis.emit(\"change\", newValue, oldValue, this);\n\t\t});\n\t}\n\n\tget dialog(): DDialogColorGradient {\n\t\tlet dialog = this._dialog;\n\t\tif (dialog == null) {\n\t\t\tconst options = this._options?.dialog;\n\t\t\tif (options) {\n\t\t\t\tdialog = new DDialogColorGradient(options);\n\t\t\t} else {\n\t\t\t\tif (DButtonColorGradient.DIALOG == null) {\n\t\t\t\t\tDButtonColorGradient.DIALOG = new DDialogColorGradient();\n\t\t\t\t}\n\t\t\t\tdialog = DButtonColorGradient.DIALOG;\n\t\t\t}\n\t\t\tthis._dialog = dialog;\n\t\t}\n\t\treturn dialog;\n\t}\n\n\tget value(): DColorGradientObservable {\n\t\treturn this._textValueComputed!;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DButtonColorGradient\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DColorAndAlpha } from \"./d-color-and-alpha\";\nimport { DDialogCommand, DDialogCommandOptions, DThemeDialogCommand } from \"./d-dialog-command\";\nimport { DLayoutVertical } from \"./d-layout-vertical\";\nimport { DPickerColor, DPickerColorOptions } from \"./d-picker-color\";\nimport { DPickerColorRecent } from \"./d-picker-color-recent\";\n\nexport interface DDialogColorOptions<THEME extends DThemeDialogColor = DThemeDialogColor>\n\textends DDialogCommandOptions<DColorAndAlpha, THEME> {\n\tpicker?: DPickerColorOptions;\n}\n\nexport interface DThemeDialogColor extends DThemeDialogCommand {}\n\nexport class DDialogColor<\n\tTHEME extends DThemeDialogColor = DThemeDialogColor,\n\tOPTIONS extends DDialogColorOptions<THEME> = DDialogColorOptions<THEME>\n> extends DDialogCommand<DColorAndAlpha, THEME, OPTIONS> {\n\tprotected _picker?: DPickerColor;\n\n\tprotected onInit(layout: DLayoutVertical, options?: OPTIONS): void {\n\t\tsuper.onInit(layout, options);\n\t\tlayout.addChild(this.picker);\n\t}\n\n\tprotected onOk(value: DColorAndAlpha | PromiseLike<DColorAndAlpha>): void {\n\t\tsuper.onOk(value);\n\n\t\tconst picker = this.picker;\n\t\tconst recent = picker.recent;\n\t\tif (!recent.contains(picker.new)) {\n\t\t\trecent.add(picker.new);\n\t\t}\n\t}\n\n\tget current(): DColorAndAlpha {\n\t\treturn this.picker.current;\n\t}\n\n\tget new(): DColorAndAlpha {\n\t\treturn this.picker.new;\n\t}\n\n\tget recent(): DPickerColorRecent {\n\t\treturn this.picker.recent;\n\t}\n\n\tget picker(): DPickerColor {\n\t\tlet result = this._picker;\n\t\tif (result == null) {\n\t\t\tresult = new DPickerColor(this._options?.picker);\n\t\t\tthis._picker = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected getResolvedValue(): DColorAndAlpha | PromiseLike<DColorAndAlpha> {\n\t\treturn this.picker.new;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DDialogColor\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction } from \"pixi.js\";\nimport { DApplications } from \"./d-applications\";\nimport { DButton, DButtonEvents, DButtonOptions, DThemeButton } from \"./d-button\";\nimport { DColorAndAlpha } from \"./d-color-and-alpha\";\nimport { DDialogColor, DDialogColorOptions } from \"./d-dialog-color\";\nimport { DImagePieceOptions, DImagePieceTintOptions } from \"./d-image-piece\";\nimport { DOnOptions } from \"./d-on-options\";\nimport { DPickerColorAndAlpha } from \"./d-picker-color-and-alpha\";\n\n/**\n * {@link DButtonColor} events.\n */\nexport interface DButtonColorEvents<EMITTER> extends DButtonEvents<DColorAndAlpha, EMITTER> {\n\t/**\n\t * Triggered when a selection is changed.\n\t *\n\t * @param newValue a newly selected value\n\t * @param oldValue a previously selected value\n\t * @param emitter an emitter\n\t */\n\tchange(newValue: DColorAndAlpha, oldValue: DColorAndAlpha, emitter: EMITTER): void;\n}\n\n/**\n * {@link DButtonColor} \"on\" options.\n */\nexport interface DButtonColorOnOptions<EMITTER>\n\textends Partial<DButtonColorEvents<EMITTER>>,\n\t\tDOnOptions {}\n\n/**\n * {@link DButtonColor} options.\n */\nexport interface DButtonColorOptions<\n\tTHEME extends DThemeButtonColor = DThemeButtonColor,\n\tEMITTER = any\n> extends DButtonOptions<DColorAndAlpha, THEME, EMITTER> {\n\t/**\n\t * A dialog to pick a color.\n\t */\n\tdialog?: DDialogColorOptions;\n\n\ton?: DButtonColorOnOptions<EMITTER>;\n}\n\n/**\n * {@link DButtonColor} theme.\n */\nexport interface DThemeButtonColor extends DThemeButton<DColorAndAlpha> {}\n\nexport class DButtonColor<\n\tTHEME extends DThemeButtonColor = DThemeButtonColor,\n\tOPTIONS extends DButtonColorOptions<THEME> = DButtonColorOptions<THEME>\n> extends DButton<DColorAndAlpha, THEME, OPTIONS> {\n\tprotected static DIALOG?: DDialogColor;\n\tprotected _dialog?: DDialogColor;\n\tprotected _value!: DPickerColorAndAlpha;\n\n\tprotected init(options?: OPTIONS): void {\n\t\tsuper.init(options);\n\n\t\tconst value = this._textValueComputed!;\n\t\tthis._value = new DPickerColorAndAlpha(\n\t\t\tvalue,\n\t\t\t(color: number): void => {\n\t\t\t\tvalue.color = color;\n\t\t\t\tthis.onColorChange();\n\t\t\t},\n\t\t\t(alpha: number): void => {\n\t\t\t\tvalue.alpha = alpha;\n\t\t\t\tthis.updateTextForcibly();\n\t\t\t}\n\t\t);\n\t}\n\n\tprotected onActivate(\n\t\te?: interaction.InteractionEvent | KeyboardEvent | MouseEvent | TouchEvent\n\t): void {\n\t\tsuper.onActivate(e);\n\t\tconst value = this._textValueComputed!;\n\t\tconst dialog = this.dialog;\n\t\tconst dialogCurrent = dialog.current;\n\t\tconst dialogNew = dialog.new;\n\t\tdialogCurrent.color = value.color;\n\t\tdialogCurrent.alpha = value.alpha;\n\t\tdialogNew.color = value.color;\n\t\tdialogNew.alpha = value.alpha;\n\t\tdialog.open().then((): void => {\n\t\t\tvalue.color = dialogNew.color;\n\t\t\tvalue.alpha = dialogNew.alpha;\n\t\t\tthis.onColorChange();\n\t\t\tthis.onValueChange(this.toClone(dialogNew), this.toClone(dialogCurrent));\n\t\t});\n\t}\n\n\tprotected toClone(value: DColorAndAlpha): DColorAndAlpha {\n\t\treturn {\n\t\t\tcolor: value.color,\n\t\t\talpha: value.alpha\n\t\t};\n\t}\n\n\tprotected onValueChange(newValue: DColorAndAlpha, oldValue: DColorAndAlpha): void {\n\t\tthis.emit(\"change\", newValue, oldValue, this);\n\t}\n\n\tprotected toImageTintOptions(tint?: DImagePieceTintOptions): DImagePieceTintOptions {\n\t\tconst color = () => this._textValueComputed!.color;\n\t\tif (tint) {\n\t\t\treturn {\n\t\t\t\tcolor: tint.color || color,\n\t\t\t\talpha: tint.alpha\n\t\t\t};\n\t\t}\n\t\treturn {\n\t\t\tcolor\n\t\t};\n\t}\n\n\tprotected toImageOptions(\n\t\ttheme: THEME,\n\t\toptions?: DImagePieceOptions\n\t): DImagePieceOptions | undefined {\n\t\tif (options) {\n\t\t\treturn {\n\t\t\t\tsource: options.source,\n\t\t\t\ttint: this.toImageTintOptions(options.tint),\n\t\t\t\talign: options.align,\n\t\t\t\tmargin: options.margin\n\t\t\t};\n\t\t}\n\t\treturn {\n\t\t\ttint: this.toImageTintOptions()\n\t\t};\n\t}\n\n\tprotected onColorChange(): void {\n\t\tif (this._images[0].updateTint()) {\n\t\t\tDApplications.update(this);\n\t\t}\n\t\tthis.updateTextForcibly();\n\t}\n\n\tprotected updateTextForcibly(): void {\n\t\tthis.onTextChange();\n\t\tthis.createOrUpdateText();\n\t}\n\n\tget dialog(): DDialogColor {\n\t\tlet dialog = this._dialog;\n\t\tif (dialog == null) {\n\t\t\tconst options = this._options?.dialog;\n\t\t\tif (options) {\n\t\t\t\tdialog = new DDialogColor(options);\n\t\t\t} else {\n\t\t\t\tif (DButtonColor.DIALOG == null) {\n\t\t\t\t\tDButtonColor.DIALOG = new DDialogColor();\n\t\t\t\t}\n\t\t\t\tdialog = DButtonColor.DIALOG;\n\t\t\t}\n\t\t\tthis._dialog = dialog;\n\t\t}\n\t\treturn dialog;\n\t}\n\n\tget value(): DColorAndAlpha {\n\t\treturn this._value;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DButtonColor\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DButton, DButtonOptions, DThemeButton } from \"./d-button\";\n\nexport interface DButtonDangerOptions<\n\tVALUE = unknown,\n\tTHEME extends DThemeButtonDanger<VALUE> = DThemeButtonDanger<VALUE>\n> extends DButtonOptions<VALUE, THEME> {}\n\nexport interface DThemeButtonDanger<VALUE = unknown> extends DThemeButton<VALUE> {}\n\nexport class DButtonDanger<\n\tVALUE = unknown,\n\tTHEME extends DThemeButtonDanger<VALUE> = DThemeButtonDanger<VALUE>,\n\tOPTIONS extends DButtonDangerOptions<VALUE, THEME> = DButtonDangerOptions<VALUE, THEME>\n> extends DButton<VALUE, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DButtonDanger\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDialogDate } from \"./d-dialog-date\";\n\nexport class DDialogDates {\n\tprotected static INSTANCE?: DDialogDate;\n\tstatic getInstance(): DDialogDate {\n\t\tif (DDialogDates.INSTANCE == null) {\n\t\t\tDDialogDates.INSTANCE = new DDialogDate();\n\t\t}\n\t\treturn DDialogDates.INSTANCE;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction } from \"pixi.js\";\nimport { DButton, DButtonEvents, DButtonOptions, DThemeButton } from \"./d-button\";\nimport { DDialogDate, DDialogDateOptions } from \"./d-dialog-date\";\nimport { DDialogDates } from \"./d-dialog-dates\";\nimport { DOnOptions } from \"./d-on-options\";\n\n/**\n * {@link DButtonDate} events.\n */\nexport interface DButtonDateEvents<EMITTER> extends DButtonEvents<Date, EMITTER> {\n\t/**\n\t * Triggered when a selection is changed.\n\t *\n\t * @param newValue a newly selected value\n\t * @param oldValue a previously selected value\n\t * @param emitter an emitter\n\t */\n\tchange(newValue: Date, oldValue: Date, emitter: EMITTER): void;\n}\n\n/**\n * {@link DButtonDate} \"on\" options.\n */\nexport interface DButtonDateOnOptions<EMITTER>\n\textends Partial<DButtonDateEvents<EMITTER>>,\n\t\tDOnOptions {}\n\n/**\n * {@link DButtonDate} options.\n */\nexport interface DButtonDateOptions<\n\tTHEME extends DThemeButtonDate = DThemeButtonDate,\n\tEMITTER = any\n> extends DButtonOptions<Date, THEME, EMITTER> {\n\tdialog?: DDialogDateOptions;\n\ton?: DButtonDateOnOptions<EMITTER>;\n}\n\n/**\n * {@link DButtonDate} theme.\n */\nexport interface DThemeButtonDate extends DThemeButton<Date> {}\n\nexport class DButtonDate<\n\tTHEME extends DThemeButtonDate = DThemeButtonDate,\n\tOPTIONS extends DButtonDateOptions<THEME> = DButtonDateOptions<THEME>\n> extends DButton<Date, THEME, OPTIONS> {\n\tprotected _dialog?: DDialogDate;\n\n\tprotected onActivate(\n\t\te?: interaction.InteractionEvent | KeyboardEvent | MouseEvent | TouchEvent\n\t): void {\n\t\tsuper.onActivate(e);\n\t\tconst value = this._textValueComputed?.getTime() ?? Date.now();\n\t\tconst dialog = this.dialog;\n\t\tdialog.current = new Date(value);\n\t\tdialog.new = new Date(value);\n\t\tdialog.page = new Date(value);\n\t\tdialog.open().then((): void => {\n\t\t\tconst newValue = dialog.new;\n\t\t\tconst oldValue = dialog.current;\n\t\t\tthis.text = new Date(newValue.getTime());\n\t\t\tthis.emit(\"change\", newValue, oldValue, this);\n\t\t});\n\t}\n\n\tget dialog(): DDialogDate {\n\t\tlet dialog = this._dialog;\n\t\tif (dialog == null) {\n\t\t\tconst options = this._options?.dialog;\n\t\t\tif (options) {\n\t\t\t\tdialog = new DDialogDate(options);\n\t\t\t} else {\n\t\t\t\tdialog = DDialogDates.getInstance();\n\t\t\t}\n\t\t\tthis._dialog = dialog;\n\t\t}\n\t\treturn dialog;\n\t}\n\n\tget value(): Date {\n\t\treturn this._textValueComputed ?? new Date();\n\t}\n\n\tset value(value: Date) {\n\t\tconst textValueComputed = this._textValueComputed;\n\t\tif (textValueComputed === undefined || textValueComputed.getTime() !== value.getTime()) {\n\t\t\tthis.text = value;\n\t\t}\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DButtonDate\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDialogDatetime } from \"./d-dialog-datetime\";\n\nexport class DDialogDatetimes {\n\tprotected static INSTANCE?: DDialogDatetime;\n\tstatic getInstance(): DDialogDatetime {\n\t\tif (DDialogDatetimes.INSTANCE == null) {\n\t\t\tDDialogDatetimes.INSTANCE = new DDialogDatetime();\n\t\t}\n\t\treturn DDialogDatetimes.INSTANCE;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { toPadded } from \"./util/to-padded\";\n\nexport class DPickerDates {\n\tstatic format(date: Date): string {\n\t\tconst y = toPadded(String(date.getFullYear()), 4, \"0\");\n\t\tconst M = toPadded(String(date.getMonth() + 1), 2, \"0\");\n\t\tconst S = toPadded(String(date.getDate()), 2, \"0\");\n\t\treturn `${y}/${M}/${S}`;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DPickerDatetimeMask } from \"./d-picker-datetime-mask\";\nimport { DPickerDatetimeMaskOptions, DPickerDatetimeMasks } from \"./d-picker-datetime-masks\";\nimport { toPadded } from \"./util/to-padded\";\n\nexport class DPickerTimes {\n\tstatic format(date: Date, mask: DPickerDatetimeMask): string {\n\t\tlet result = \"\";\n\t\tif (mask & DPickerDatetimeMask.HOURS) {\n\t\t\tresult += toPadded(String(date.getHours()), 2, \"0\");\n\t\t}\n\t\tif (mask & DPickerDatetimeMask.MINUTES) {\n\t\t\tif (0 < result.length) {\n\t\t\t\tresult += \":\";\n\t\t\t}\n\t\t\tresult += toPadded(String(date.getMinutes()), 2, \"0\");\n\t\t}\n\t\tif (mask & DPickerDatetimeMask.SECONDS) {\n\t\t\tif (0 < result.length) {\n\t\t\t\tresult += \":\";\n\t\t\t}\n\t\t\tresult += toPadded(String(date.getSeconds()), 2, \"0\");\n\t\t}\n\t\treturn result;\n\t}\n\n\tstatic toMask(options?: DPickerDatetimeMaskOptions): DPickerDatetimeMask {\n\t\treturn DPickerDatetimeMasks.from(\"DPickerTime\", options);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DPickerDates } from \"./d-picker-dates\";\nimport { DPickerDatetimeMask } from \"./d-picker-datetime-mask\";\nimport { DPickerDatetimeMaskOptions, DPickerDatetimeMasks } from \"./d-picker-datetime-masks\";\nimport { DPickerTimes } from \"./d-picker-times\";\n\nexport class DPickerDatetimes {\n\tstatic format(date: Date, mask: DPickerDatetimeMask): string {\n\t\tconst hms = DPickerTimes.format(date, mask);\n\t\tif (0 < hms.length) {\n\t\t\treturn `${DPickerDates.format(date)} ${hms}`;\n\t\t} else {\n\t\t\treturn `${DPickerDates.format(date)}`;\n\t\t}\n\t}\n\n\tstatic toMask(options?: DPickerDatetimeMaskOptions): DPickerDatetimeMask {\n\t\treturn DPickerDatetimeMasks.from(\"DPickerDatetime\", options);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction } from \"pixi.js\";\nimport { DButton, DButtonEvents, DButtonOptions, DThemeButton } from \"./d-button\";\nimport { DDialogDatetime, DDialogDatetimeOptions } from \"./d-dialog-datetime\";\nimport { DDialogDatetimes } from \"./d-dialog-datetimes\";\nimport { DOnOptions } from \"./d-on-options\";\nimport { DPickerDatetimeMask } from \"./d-picker-datetime-mask\";\nimport { DPickerDatetimes } from \"./d-picker-datetimes\";\n\n/**\n * {@link DButtonDatetime} events.\n */\nexport interface DButtonDatetimeEvents<EMITTER> extends DButtonEvents<Date, EMITTER> {\n\t/**\n\t * Triggered when a selection is changed.\n\t *\n\t * @param emitter an emitter\n\t */\n\tchange(newValue: Date, oldValue: Date, emitter: EMITTER): void;\n}\n\n/**\n * {@link DButtonDatetime} \"on\" options.\n */\nexport interface DButtonDatetimeOnOptions<EMITTER>\n\textends Partial<DButtonDatetimeEvents<EMITTER>>,\n\t\tDOnOptions {}\n\n/**\n * {@link DButtonDatetime} options.\n */\nexport interface DButtonDatetimeOptions<\n\tTHEME extends DThemeButtonDatetime = DThemeButtonDatetime,\n\tEMITTER = any\n> extends DButtonOptions<Date, THEME, EMITTER> {\n\tdialog?: DDialogDatetimeOptions;\n\ton?: DButtonDatetimeOnOptions<EMITTER>;\n}\n\n/**\n * {@link DButtonDatetime} theme.\n */\nexport interface DThemeButtonDatetime extends DThemeButton<Date> {}\n\nexport class DButtonDatetime<\n\tTHEME extends DThemeButtonDatetime = DThemeButtonDatetime,\n\tOPTIONS extends DButtonDatetimeOptions<THEME> = DButtonDatetimeOptions<THEME>\n> extends DButton<Date, THEME, OPTIONS> {\n\tprotected _dialog?: DDialogDatetime;\n\tprotected _datetimeMask?: DPickerDatetimeMask;\n\n\tprotected onActivate(\n\t\te?: interaction.InteractionEvent | KeyboardEvent | MouseEvent | TouchEvent\n\t): void {\n\t\tsuper.onActivate(e);\n\t\tconst value = this._textValueComputed?.getTime() ?? Date.now();\n\t\tconst dialog = this.dialog;\n\t\tdialog.current = new Date(value);\n\t\tdialog.new = new Date(value);\n\t\tdialog.page = new Date(value);\n\t\tdialog.open().then((): void => {\n\t\t\tconst newValue = dialog.new;\n\t\t\tconst oldValue = dialog.current;\n\t\t\tthis.text = new Date(newValue.getTime());\n\t\t\tthis.emit(\"change\", newValue, oldValue, this);\n\t\t});\n\t}\n\n\tgetDatetimeMask(): DPickerDatetimeMask {\n\t\tlet result = this._datetimeMask;\n\t\tif (result == null) {\n\t\t\tresult = DPickerDatetimes.toMask(this._options?.dialog?.picker);\n\t\t\tthis._datetimeMask = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tget dialog(): DDialogDatetime {\n\t\tlet dialog = this._dialog;\n\t\tif (dialog == null) {\n\t\t\tconst options = this._options?.dialog;\n\t\t\tif (options) {\n\t\t\t\tdialog = new DDialogDatetime(options);\n\t\t\t} else {\n\t\t\t\tdialog = DDialogDatetimes.getInstance();\n\t\t\t}\n\t\t\tthis._dialog = dialog;\n\t\t}\n\t\treturn dialog;\n\t}\n\n\tget value(): Date {\n\t\treturn this._textValueComputed ?? new Date();\n\t}\n\n\tset value(value: Date) {\n\t\tconst textValueComputed = this._textValueComputed;\n\t\tif (textValueComputed === undefined || textValueComputed.getTime() !== value.getTime()) {\n\t\t\tthis.text = value;\n\t\t}\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DButtonDatetime\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction } from \"pixi.js\";\nimport { DButton, DButtonEvents, DButtonOptions, DThemeButton } from \"./d-button\";\nimport { DOnOptions } from \"./d-on-options\";\nimport { toEnum } from \"./util/to-enum\";\nimport {\n\tUtilFileAs as DButtonFileAs,\n\tUtilFileEvents,\n\tUtilFileOpener\n} from \"./util/util-file-opener\";\n\nexport { DButtonFileAs };\n\n/**\n * {@link DButtonFile} events.\n */\nexport interface DButtonFileEvents<VALUE, EMITTER>\n\textends DButtonEvents<VALUE, EMITTER>,\n\t\tUtilFileEvents<EMITTER> {}\n\n/**\n * {@link DButtonFile} \"on\" options.\n */\nexport interface DButtonFileOnOptions<VALUE, EMITTER>\n\textends Partial<DButtonFileEvents<VALUE, EMITTER>>,\n\t\tDOnOptions {}\n\nexport type DButtonFileChecker = () => Promise<unknown> | boolean;\n\n/**\n * {@link DButtonFile} options.\n */\nexport interface DButtonFileOptions<\n\tVALUE = unknown,\n\tTHEME extends DThemeButtonFile<VALUE> = DThemeButtonFile<VALUE>,\n\tEMITTER = any\n> extends DButtonOptions<VALUE, THEME, EMITTER> {\n\t/**\n\t * An output format.\n\t */\n\tas?: keyof typeof DButtonFileAs | DButtonFileAs;\n\n\t/**\n\t * A checker called before opening a file.\n\t * If the checker returns false or the returned promise object is rejected,\n\t * files will not be opened.\n\t */\n\tchecker?: DButtonFileChecker;\n\n\ton?: DButtonFileOnOptions<VALUE, EMITTER>;\n}\n\n/**\n * {@link DButtonFile} theme.\n */\nexport interface DThemeButtonFile<VALUE = unknown> extends DThemeButton<VALUE> {}\n\n/**\n * A file selector.\n */\nexport class DButtonFile<\n\tVALUE = unknown,\n\tTHEME extends DThemeButtonFile<VALUE> = DThemeButtonFile<VALUE>,\n\tOPTIONS extends DButtonFileOptions<VALUE, THEME> = DButtonFileOptions<VALUE, THEME>\n> extends DButton<VALUE, THEME, OPTIONS> {\n\tprotected _checker?: DButtonFileChecker | null;\n\tprotected _opener?: UtilFileOpener;\n\n\tprotected getChecker(): DButtonFileChecker | null {\n\t\tlet result = this._checker;\n\t\tif (result === undefined) {\n\t\t\tresult = this._options?.checker ?? null;\n\t\t\tthis._checker = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected getOpener(): UtilFileOpener {\n\t\tlet result = this._opener;\n\t\tif (result == null) {\n\t\t\tresult = this.newOpener();\n\t\t\tthis._opener = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected newOpener(): UtilFileOpener {\n\t\treturn new UtilFileOpener(\n\t\t\ttoEnum(this._options?.as ?? DButtonFileAs.TEXT, DButtonFileAs),\n\t\t\tthis\n\t\t);\n\t}\n\n\tprotected onActivate(\n\t\te?: interaction.InteractionEvent | KeyboardEvent | MouseEvent | TouchEvent\n\t): void {\n\t\tsuper.onActivate(e);\n\t\tthis.check((): void => {\n\t\t\tthis.open();\n\t\t});\n\t}\n\n\tprotected check(onResolve: () => void): void {\n\t\tconst checker = this.getChecker();\n\t\tif (checker != null) {\n\t\t\tconst result = checker();\n\t\t\tif (result === true) {\n\t\t\t\tonResolve();\n\t\t\t} else if (result === false) {\n\t\t\t\t// DO NOTHING\n\t\t\t} else {\n\t\t\t\tresult.then((): void => {\n\t\t\t\t\tonResolve();\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\tonResolve();\n\t\t}\n\t}\n\n\topen(): void {\n\t\tthis.getOpener().open();\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DButtonFile\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction } from \"pixi.js\";\nimport { DButtonBase, DButtonBaseOptions, DThemeButtonBase } from \"./d-button-base\";\nimport { DButtonBaseWhen } from \"./d-button-base-when\";\nimport { DLink, DLinkOptions } from \"./d-link\";\n\nexport interface DButtonLinkOptions<\n\tVALUE = unknown,\n\tTHEME extends DThemeButtonLink<VALUE> = DThemeButtonLink<VALUE>\n> extends DButtonBaseOptions<VALUE, THEME>,\n\t\tDLinkOptions {}\n\nexport interface DThemeButtonLink<VALUE = unknown> extends DThemeButtonBase<VALUE> {}\n\nexport class DButtonLink<\n\tVALUE = unknown,\n\tTHEME extends DThemeButtonLink<VALUE> = DThemeButtonLink<VALUE>,\n\tOPTIONS extends DButtonLinkOptions<VALUE, THEME> = DButtonLinkOptions<VALUE, THEME>\n> extends DButtonBase<VALUE, THEME, OPTIONS> {\n\tprotected _link!: DLink;\n\n\tprotected initOnClick(when: DButtonBaseWhen, theme: THEME, options?: OPTIONS): void {\n\t\tconst link = new DLink(options);\n\t\tthis._link = link;\n\t\tlink.add(this, (e: interaction.InteractionEvent): void => {\n\t\t\tif (when === DButtonBaseWhen.CLICKED) {\n\t\t\t\tthis.onClick(e);\n\t\t\t}\n\t\t});\n\t}\n\n\tget link(): DLink {\n\t\treturn this._link;\n\t}\n\n\tprotected onActivate(\n\t\te?: interaction.InteractionEvent | KeyboardEvent | MouseEvent | TouchEvent\n\t): void {\n\t\tsuper.onActivate(e);\n\t\tthis._link.open(e);\n\t}\n\n\topen(inNewWindow: boolean): void {\n\t\tthis._link.open(inNewWindow);\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DButtonLink\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DButtonBase, DButtonBaseOptions, DThemeButtonBase } from \"./d-button-base\";\n\nexport interface DButtonRadioOptions<\n\tVALUE = unknown,\n\tTHEME extends DThemeButtonRadio<VALUE> = DThemeButtonRadio<VALUE>\n> extends DButtonBaseOptions<VALUE, THEME> {}\n\nexport interface DThemeButtonRadio<VALUE = unknown> extends DThemeButtonBase<VALUE> {}\n\nexport class DButtonRadio<\n\tVALUE = unknown,\n\tTHEME extends DThemeButtonRadio<VALUE> = DThemeButtonRadio<VALUE>,\n\tOPTIONS extends DButtonRadioOptions<VALUE, THEME> = DButtonRadioOptions<VALUE, THEME>\n> extends DButtonBase<VALUE, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DButtonRadio\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DButtonRadio, DButtonRadioOptions, DThemeButtonRadio } from \"./d-button-radio\";\n\nexport interface DButtonRadioRightOptions<\n\tVALUE = unknown,\n\tTHEME extends DThemeButtonRadioRight<VALUE> = DThemeButtonRadioRight<VALUE>\n> extends DButtonRadioOptions<VALUE, THEME> {}\n\nexport interface DThemeButtonRadioRight<VALUE = unknown> extends DThemeButtonRadio<VALUE> {}\n\nexport class DButtonRadioRight<\n\tVALUE = unknown,\n\tTHEME extends DThemeButtonRadioRight<VALUE> = DThemeButtonRadioRight<VALUE>,\n\tOPTIONS extends DButtonRadioRightOptions<VALUE, THEME> = DButtonRadioRightOptions<VALUE, THEME>\n> extends DButtonRadio<VALUE, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DButtonRadioRight\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction } from \"pixi.js\";\nimport { DButton, DButtonOptions, DThemeButton } from \"./d-button\";\nimport { DControllers } from \"./d-controllers\";\n\nexport class DButtonRedo<\n\tVALUE = unknown,\n\tTHEME extends DThemeButton<VALUE> = DThemeButton<VALUE>,\n\tOPTIONS extends DButtonOptions<VALUE, THEME> = DButtonOptions<VALUE, THEME>\n> extends DButton<VALUE, THEME, OPTIONS> {\n\tconstructor(options?: OPTIONS) {\n\t\tsuper(options);\n\n\t\tconst state = this.state;\n\t\tconst commandController = DControllers.getCommandController();\n\t\tstate.isDisabled = !commandController.isRedoable();\n\t\tcommandController.on(\"change\", (): void => {\n\t\t\tstate.isDisabled = !commandController.isRedoable();\n\t\t});\n\t}\n\n\tprotected onActivate(\n\t\te?: interaction.InteractionEvent | KeyboardEvent | MouseEvent | TouchEvent\n\t): void {\n\t\tsuper.onActivate(e);\n\t\tDControllers.getCommandController().redo();\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DButton, DButtonOptions, DThemeButton } from \"./d-button\";\n\nexport interface DButtonSecondaryOptions<\n\tVALUE = unknown,\n\tTHEME extends DThemeButtonSecondary<VALUE> = DThemeButtonSecondary<VALUE>\n> extends DButtonOptions<VALUE, THEME> {}\n\nexport interface DThemeButtonSecondary<VALUE = unknown> extends DThemeButton<VALUE> {}\n\nexport class DButtonSecondary<\n\tVALUE = unknown,\n\tTHEME extends DThemeButtonSecondary<VALUE> = DThemeButtonSecondary<VALUE>,\n\tOPTIONS extends DButtonSecondaryOptions<VALUE, THEME> = DButtonSecondaryOptions<VALUE, THEME>\n> extends DButton<VALUE, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DButtonSecondary\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { utils } from \"pixi.js\";\nimport { DOnOptions } from \"./d-on-options\";\n\nexport const DListDataSelectionType = {\n\tNONE: 0,\n\tSINGLE: 1,\n\tMULTIPLE: 2\n} as const;\n\nexport type DListDataSelectionType =\n\ttypeof DListDataSelectionType[keyof typeof DListDataSelectionType];\n\n/**\n * {@link DListSelection} events.\n */\nexport interface DListDataSelectionEvents<EMITTER> {\n\t/**\n\t * Triggered when a selection is changed.\n\t *\n\t * @param emitter an emitter\n\t */\n\tchange(emitter: EMITTER): void;\n}\n\n/**\n * {@link DListSelection} \"on\" options.\n */\nexport interface DListDataSelectionOnOptions<EMITTER>\n\textends Partial<DListDataSelectionEvents<EMITTER>>,\n\t\tDOnOptions {}\n\n/**\n * {@link DListSelection} options.\n */\nexport interface DListDataSelectionOptions<ITEM, EMITTER = any> {\n\t/**\n\t * @deprecated in favor of {@link type}\n\t */\n\tmode?: DListDataSelectionType | keyof typeof DListDataSelectionType;\n\n\t/**\n\t * A type.\n\t */\n\ttype?: DListDataSelectionType | keyof typeof DListDataSelectionType;\n\n\t/**\n\t * Mappings of event names and handlers.\n\t */\n\ton?: DListDataSelectionOnOptions<EMITTER>;\n}\n\nexport interface DListDataSelection<ITEM> extends utils.EventEmitter {\n\treadonly type: DListDataSelectionType;\n\treadonly first: ITEM | null;\n\treadonly last: ITEM | null;\n\n\t/**\n\t * Returns an item at the given index or null.\n\t *\n\t * @param index an index\n\t * @returns an item at the given index or null\n\t */\n\tget(index: number): ITEM | null;\n\n\t/**\n\t * Adds the given item\n\t *\n\t * @param target an item\n\t * @return true if succeeded.\n\t */\n\tadd(target: ITEM): boolean;\n\n\t/**\n\t * Removes the given item.\n\t *\n\t * @param target an item\n\t * @return true if succeeded\n\t */\n\tremove(target: ITEM): boolean;\n\n\t/**\n\t * Toggles the given item.\n\t *\n\t * @param target an item\n\t * @return true if succeeded.\n\t */\n\ttoggle(target: ITEM): boolean;\n\n\t/**\n\t * Clears all the items.\n\t */\n\tclear(): void;\n\n\t/**\n\t * Clears all the existing items and adds the given item.\n\t *\n\t * @param target an item to be added\n\t * @returns true if the selection is changed\n\t */\n\tclearAndAdd(target: ITEM): boolean;\n\n\t/**\n\t * Clears the existing items and add all the given items.\n\t *\n\t * @param targets items to be added\n\t * @returns true if the selection is changed\n\t */\n\tclearAndAddAll(targets: ITEM[]): boolean;\n\n\t/**\n\t * Returns true if the given item is selected.\n\t *\n\t * @param target an item to be checked\n\t * @returns true if the given item is selected\n\t */\n\tcontains(target: ITEM): boolean;\n\n\t/**\n\t * Returns the number of selected items.\n\t *\n\t * @returns the number of selected items\n\t */\n\tsize(): number;\n\n\t/**\n\t * Returns true if the selection is empty.\n\t *\n\t * @returns true if the selection is empty\n\t */\n\tisEmpty(): boolean;\n\n\t/**\n\t * Iterates over selected items.\n\t *\n\t * @param iteratee an iteratee\n\t */\n\teach(iteratee: (item: ITEM) => boolean | void): void;\n\n\t/**\n\t * Returns an array of selected items.\n\t */\n\ttoArray(): ITEM[];\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction } from \"pixi.js\";\nimport { DBaseState } from \"./d-base-state\";\nimport { DImageBase, DImageBaseEvents, DImageBaseOptions, DThemeImageBase } from \"./d-image-base\";\nimport { DLink, DLinkChecker, DLinkOptions, DLinkUrlMaker, DLinkUrlValue } from \"./d-link\";\nimport { DListData } from \"./d-list-data\";\nimport { DListDataSelectionType } from \"./d-list-data-selection\";\nimport {\n\tDListItemAccessorLink,\n\tDListItemLinkChecker,\n\tDListItemToLinkUrl\n} from \"./d-list-item-accessor\";\nimport { DOnOptions } from \"./d-on-options\";\nimport { UtilKeyboardEvent } from \"./util/util-keyboard-event\";\nimport { UtilPointerEvent } from \"./util/util-pointer-event\";\n\n/**\n * {@link DListItem} events.\n */\nexport interface DListItemEvents<VALUE, EMITTER> extends DImageBaseEvents<VALUE, EMITTER> {\n\t/**\n\t * Triggered when a value is set.\n\t *\n\t *     on( \"set\", ( node, index, emitter ) => {} )\n\t *\n\t * @param emitter an emitter\n\t */\n\tset(node: VALUE, index: number, emitter: EMITTER): void;\n\n\t/**\n\t * Triggered when set to undefined.\n\t *\n\t *     on( \"unset\", ( emitter ) => {} )\n\t *\n\t * @param emitter an emitter\n\t */\n\tunset(emitter: EMITTER): void;\n}\n\n/**\n * {@link DListItem} \"on\" options.\n */\nexport interface DListItemOnOptions<NODE, EMITTER>\n\textends Partial<DListItemEvents<NODE, EMITTER>>,\n\t\tDOnOptions {}\n\n/**\n * {@link DListItem} options.\n */\nexport interface DListItemOptions<\n\tVALUE = unknown,\n\tTHEME extends DThemeListItem = DThemeListItem,\n\tEMITTER = any\n> extends DImageBaseOptions<string, THEME> {\n\ton?: DListItemOnOptions<VALUE, EMITTER>;\n}\n\nexport interface DThemeListItem extends DThemeImageBase<string> {}\n\nexport class DListItem<\n\tVALUE = unknown,\n\tTHEME extends DThemeListItem = DThemeListItem,\n\tOPTIONS extends DListItemOptions<VALUE, THEME> = DListItemOptions<VALUE, THEME>\n> extends DImageBase<string, THEME, OPTIONS> {\n\tprotected _data: DListData<VALUE>;\n\tprotected _value?: VALUE;\n\tprotected _index?: number;\n\tprotected _link?: DLink;\n\n\tconstructor(data: DListData<VALUE>, options?: OPTIONS) {\n\t\tsuper(options);\n\t\tthis._data = data;\n\t\tthis.initOnClick(data, options);\n\t}\n\n\tprotected initOnClick(data: DListData<VALUE>, options?: OPTIONS): void {\n\t\tconst accessor = data.accessor.link;\n\t\tif (accessor) {\n\t\t\tconst link = new DLink(this.toLinkOptions(accessor));\n\t\t\tlink.add(this, (e): void => {\n\t\t\t\tconst value = this._value;\n\t\t\t\tif (value !== undefined) {\n\t\t\t\t\tthis.onSelect(e, value);\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis._link = link;\n\t\t} else {\n\t\t\tUtilPointerEvent.onClick(this, (e: interaction.InteractionEvent): void => {\n\t\t\t\tif (this.state.isActionable) {\n\t\t\t\t\tconst value = this._value;\n\t\t\t\t\tif (value !== undefined) {\n\t\t\t\t\t\tthis.onSelect(e, value);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tprotected toLinkOptions(accessor: DListItemAccessorLink<VALUE>): DLinkOptions {\n\t\treturn {\n\t\t\turl: this.toLinkUrl(accessor.toUrl),\n\t\t\ttarget: accessor.target,\n\t\t\tchecker: this.toLinkChecker(accessor.checker)\n\t\t};\n\t}\n\n\tprotected toLinkUrl(toUrl: DListItemToLinkUrl<VALUE>): DLinkUrlMaker {\n\t\treturn (): DLinkUrlValue | Promise<DLinkUrlValue> => {\n\t\t\tconst value = this._value;\n\t\t\tif (value !== undefined) {\n\t\t\t\treturn toUrl(value);\n\t\t\t}\n\t\t};\n\t}\n\n\tprotected toLinkChecker(checker?: DListItemLinkChecker<VALUE>): DLinkChecker | undefined {\n\t\tif (checker) {\n\t\t\treturn (): boolean | Promise<boolean> => {\n\t\t\t\tconst value = this._value;\n\t\t\t\tif (value != null) {\n\t\t\t\t\treturn checker(value);\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t};\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tget value(): VALUE | undefined {\n\t\treturn this._value;\n\t}\n\n\tget index(): number | undefined {\n\t\treturn this._index;\n\t}\n\n\tprotected onSelect(\n\t\te: interaction.InteractionEvent | KeyboardEvent | MouseEvent | TouchEvent | undefined,\n\t\tvalue: VALUE\n\t): void {\n\t\tconst data = this._data;\n\t\tconst selection = data.selection;\n\t\tif (selection.type !== DListDataSelectionType.MULTIPLE) {\n\t\t\tselection.clearAndAdd(value);\n\t\t} else {\n\t\t\tconst originalEvent = e && \"data\" in e ? e.data.originalEvent : e;\n\t\t\tif (originalEvent?.ctrlKey) {\n\t\t\t\tselection.toggle(value);\n\t\t\t} else if (originalEvent?.shiftKey) {\n\t\t\t\tconst mapped = data.mapped;\n\t\t\t\tconst last = selection.last;\n\t\t\t\tif (value === last) {\n\t\t\t\t\tselection.clearAndAdd(value);\n\t\t\t\t} else {\n\t\t\t\t\tlet isFound = false;\n\t\t\t\t\tlet isReverse = false;\n\t\t\t\t\tconst newSelection: VALUE[] = [];\n\t\t\t\t\tmapped.each((item): boolean | void => {\n\t\t\t\t\t\tif (isFound) {\n\t\t\t\t\t\t\tif (isReverse) {\n\t\t\t\t\t\t\t\tnewSelection.unshift(item);\n\t\t\t\t\t\t\t\tif (item === value) {\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tnewSelection.push(item);\n\t\t\t\t\t\t\t\tif (item === last) {\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (item === value) {\n\t\t\t\t\t\t\t\tisFound = true;\n\t\t\t\t\t\t\t\tisReverse = false;\n\t\t\t\t\t\t\t\tnewSelection.push(item);\n\t\t\t\t\t\t\t} else if (item === last) {\n\t\t\t\t\t\t\t\tisFound = true;\n\t\t\t\t\t\t\t\tisReverse = true;\n\t\t\t\t\t\t\t\tnewSelection.push(item);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tselection.clearAndAddAll(newSelection);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tselection.clearAndAdd(value);\n\t\t\t}\n\t\t}\n\n\t\tthis._link?.open(e);\n\t}\n\n\tset(value: VALUE, index: number, forcibly?: boolean): void {\n\t\tconst data = this._data;\n\t\tconst isValueChanged = forcibly || this._value !== value;\n\t\tif (isValueChanged) {\n\t\t\tthis._value = value;\n\t\t\tthis._index = index;\n\n\t\t\tconst accessor = data.accessor;\n\t\t\tthis.text = accessor.toLabel(value);\n\t\t\tthis.title = accessor.toTitle(value) || \"\";\n\t\t\tthis.image = accessor.toImage(value);\n\t\t}\n\n\t\tconst state = this.state;\n\t\tstate.lock();\n\t\tstate.set(DBaseState.ACTIVE, data.selection.contains(value));\n\t\tstate.remove(DBaseState.DISABLED);\n\t\tstate.unlock();\n\n\t\tif (isValueChanged) {\n\t\t\tthis.emit(\"set\", value, index, this);\n\t\t}\n\t}\n\n\tunset(): void {\n\t\tif (this._value !== undefined) {\n\t\t\tthis._value = undefined;\n\t\t\tthis._index = undefined;\n\n\t\t\tthis.text = undefined;\n\t\t\tthis.title = \"\";\n\t\t\tthis.image = undefined;\n\n\t\t\tconst state = this.state;\n\t\t\tstate.lock();\n\t\t\tstate.add(DBaseState.DISABLED);\n\t\t\tstate.remove(DBaseState.ACTIVE);\n\t\t\tstate.unlock();\n\n\t\t\tthis.emit(\"unset\", this);\n\t\t}\n\t}\n\n\tonKeyDown(e: KeyboardEvent): boolean {\n\t\tif (UtilKeyboardEvent.isActivateKey(e)) {\n\t\t\tthis.onKeyDownActivate(e);\n\t\t}\n\t\treturn super.onKeyDown(e);\n\t}\n\n\tprotected onKeyDownActivate(e: KeyboardEvent): boolean {\n\t\tif (this.state.isActionable && this.state.isFocused) {\n\t\t\tconst value = this._value;\n\t\t\tif (value !== undefined) {\n\t\t\t\tthis.onSelect(e, value);\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DListItem\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DListItem, DListItemOptions, DThemeListItem } from \"./d-list-item\";\n\nexport interface DDialogSelectListItemOptions<\n\tVALUE = unknown,\n\tTHEME extends DThemeDialogSelecListItem = DThemeDialogSelecListItem\n> extends DListItemOptions<VALUE, THEME> {}\n\nexport interface DThemeDialogSelecListItem extends DThemeListItem {}\n\nexport class DDialogSelectListItem<\n\tVALUE = unknown,\n\tTHEME extends DThemeDialogSelecListItem = DThemeDialogSelecListItem,\n\tOPTIONS extends DDialogSelectListItemOptions<VALUE, THEME> = DDialogSelectListItemOptions<\n\t\tVALUE,\n\t\tTHEME\n\t>\n> extends DListItem<VALUE, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DDialogSelectListItem\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DApplications } from \"./d-applications\";\nimport { DBase } from \"./d-base\";\nimport { isNumber } from \"./util/is-number\";\nimport { UtilKeyboardEvent } from \"./util/util-keyboard-event\";\n\nexport interface DItemUpdaterItem<VALUE> extends DBase {\n\treadonly value?: VALUE;\n\treadonly index?: number;\n\tset(value: VALUE, index: number, forcibly?: boolean): void;\n\tunset(): void;\n}\n\nexport type DItemUpdaterNewItem<DATA, ITEM> = (data: DATA) => ITEM;\n\nexport type DItemUpdaterInitItem<DATA, ITEM> = (item: ITEM, index: number, data: DATA) => ITEM;\n\n/**\n * Item updater options.\n */\nexport interface DItemUpdaterOptions<VALUE, DATA, ITEM> {\n\t/**\n\t * Called to create items.\n\t */\n\tnewItem?: DItemUpdaterNewItem<DATA, ITEM>;\n\n\t/**\n\t * Called to initialize items.\n\t */\n\tinitItem?: DItemUpdaterInitItem<DATA, ITEM>;\n\n\t/**\n\t * True to make stripe-colored items. Defaults to true.\n\t */\n\tstripe?: boolean;\n}\n\nexport interface DItemUpdaterDataSelection<VALUE> {\n\tcontains(value: VALUE): boolean;\n}\n\nexport interface DItemUpdaterDataMapped<VALUE> {\n\tsize(): number;\n\teach(iteratee: (value: VALUE, index: number) => void | boolean, from: number, to: number): void;\n}\n\nexport interface DItemUpdaterData<VALUE> {\n\treadonly selection: DItemUpdaterDataSelection<VALUE>;\n}\n\n/**\n * The primary purpose of this class is to minimize the number of rendered items (e.g., {@link DListItem})\n * as low as possible and to update their positions and states. For this sake, the updater calculates the\n * required number of items whenever their container size changes and creates items if needed.\n */\nexport abstract class DItemUpdater<\n\tVALUE = unknown,\n\tDATA extends DItemUpdaterData<VALUE> = DItemUpdaterData<VALUE>,\n\tDATA_MAPPED extends DItemUpdaterDataMapped<VALUE> = DItemUpdaterDataMapped<VALUE>,\n\tITEM extends DItemUpdaterItem<VALUE> = DItemUpdaterItem<VALUE>,\n\tOPTIONS extends DItemUpdaterOptions<VALUE, DATA, ITEM> = DItemUpdaterOptions<VALUE, DATA, ITEM>\n> {\n\tprotected _updateItemsCount: number;\n\tprotected _isUpdateItemsCalled: boolean;\n\tprotected _isUpdateItemsCalledForcibly: boolean;\n\tprotected _itemHeight: number;\n\tprotected _itemWidth: number;\n\tprotected _multiplicity: number;\n\tprotected _itemIndexStart: number;\n\tprotected _itemIndexEnd: number;\n\tprotected _workItems: ITEM[];\n\tprotected _data: DATA;\n\tprotected _content: DBase;\n\tprotected _container: DBase;\n\tprotected _newItem: DItemUpdaterNewItem<DATA, ITEM>;\n\tprotected _initItem: DItemUpdaterInitItem<DATA, ITEM>;\n\n\tconstructor(data: DATA, content: DBase, container: DBase, options?: OPTIONS) {\n\t\tthis._updateItemsCount = 0;\n\t\tthis._isUpdateItemsCalled = false;\n\t\tthis._isUpdateItemsCalledForcibly = false;\n\t\tthis._itemHeight = -1;\n\t\tthis._itemWidth = -1;\n\t\tthis._multiplicity = 1;\n\t\tthis._itemIndexStart = 0;\n\t\tthis._itemIndexEnd = 0;\n\t\tthis._workItems = [];\n\t\tthis._data = data;\n\t\tthis._content = content;\n\t\tthis._container = container;\n\t\tthis._newItem = this.toNewItem(options);\n\t\tthis._initItem = this.toInitItem(options);\n\t}\n\n\tprotected toNewItem(\n\t\toptions?: DItemUpdaterOptions<VALUE, DATA, ITEM>\n\t): DItemUpdaterNewItem<DATA, ITEM> {\n\t\treturn options?.newItem || this.newItem;\n\t}\n\n\tprotected abstract newItem(this: undefined, data: DATA): ITEM;\n\n\tprotected toInitItem(\n\t\toptions?: DItemUpdaterOptions<VALUE, DATA, ITEM>\n\t): DItemUpdaterInitItem<DATA, ITEM> {\n\t\tif (options) {\n\t\t\tconst initItem = options.initItem;\n\t\t\tif (initItem) {\n\t\t\t\treturn initItem;\n\t\t\t}\n\t\t\tif (options.stripe !== false) {\n\t\t\t\treturn this.initItem;\n\t\t\t}\n\t\t\treturn this.initItemNoStriping;\n\t\t}\n\t\treturn this.initItem;\n\t}\n\n\tprotected initItem(this: undefined, item: ITEM, index: number, data: DATA): ITEM {\n\t\titem.state.isAlternated = index % 2 === 1;\n\t\treturn item;\n\t}\n\n\tprotected initItemNoStriping(this: undefined, item: ITEM, index: number, data: DATA): ITEM {\n\t\treturn item;\n\t}\n\n\tget multiplicity(): number {\n\t\treturn this._multiplicity;\n\t}\n\n\tlock(): void {\n\t\tthis._updateItemsCount += 1;\n\t\tif (this._updateItemsCount === 1) {\n\t\t\tthis._isUpdateItemsCalled = false;\n\t\t\tthis._isUpdateItemsCalledForcibly = false;\n\t\t}\n\t}\n\n\tunlock(callIfNeeded: boolean): void {\n\t\tthis._updateItemsCount -= 1;\n\t\tif (this._updateItemsCount === 0) {\n\t\t\tif (callIfNeeded && this._isUpdateItemsCalled) {\n\t\t\t\tthis.update(this._isUpdateItemsCalledForcibly);\n\t\t\t}\n\t\t\tthis._isUpdateItemsCalled = false;\n\t\t\tthis._isUpdateItemsCalledForcibly = false;\n\t\t}\n\t}\n\n\tupdate(forcibly?: boolean): void {\n\t\tif (0 < this._updateItemsCount) {\n\t\t\tthis._isUpdateItemsCalled = true;\n\t\t\tif (forcibly) {\n\t\t\t\tthis._isUpdateItemsCalledForcibly = true;\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tconst content = this._content;\n\t\tconst contentParent = content.parent;\n\t\tif (contentParent == null) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst container = this._container;\n\t\tconst items = container.children as ITEM[];\n\t\tconst height = contentParent.height;\n\n\t\tconst data = this._data;\n\t\tconst mapped = this.toMapped(data);\n\t\tconst dataSize = mapped.size();\n\n\t\tconst oldItemIndexStart = this._itemIndexStart;\n\t\tlet oldItemIndexEnd = this._itemIndexEnd;\n\t\tlet oldItemCount = oldItemIndexEnd - oldItemIndexStart;\n\n\t\tconst newItem = this._newItem;\n\t\tconst initItem = this._initItem;\n\t\tlet itemHeight = this._itemHeight;\n\t\tlet itemWidth = this._itemWidth;\n\t\tif (this._itemHeight < 0) {\n\t\t\tlet item: ITEM;\n\t\t\tif (0 < items.length) {\n\t\t\t\titem = items[0];\n\t\t\t} else {\n\t\t\t\titem = initItem(newItem(data), oldItemIndexStart, data);\n\t\t\t\tcontainer.addChild(item);\n\t\t\t\toldItemIndexEnd += 1;\n\t\t\t\toldItemCount += 1;\n\t\t\t}\n\t\t\titemHeight = Math.max(1, item.height);\n\t\t\tif (isNumber(item.getWidth())) {\n\t\t\t\titemWidth = Math.max(1, item.width);\n\t\t\t}\n\t\t\tthis._itemHeight = itemHeight;\n\t\t\tthis._itemWidth = itemWidth;\n\t\t}\n\t\tconst contentPadding = content.padding;\n\t\tconst contentPaddingTop = contentPadding.getTop();\n\t\tconst contentPaddingBottom = contentPadding.getBottom();\n\t\tconst contentPaddingLeft = contentPadding.getLeft();\n\t\tconst contentPaddingRight = contentPadding.getRight();\n\t\tconst contentWidthAvailable = Math.max(\n\t\t\t0,\n\t\t\tcontent.width - contentPaddingLeft - contentPaddingRight\n\t\t);\n\t\tconst multiplicity =\n\t\t\t0 < itemWidth ? Math.max(1, Math.floor(contentWidthAvailable / itemWidth)) : 1;\n\t\tthis._multiplicity = multiplicity;\n\n\t\tconst y = content !== container ? container.transform.position.y : contentPaddingTop;\n\t\tconst newHeight = Math.ceil(dataSize / multiplicity) * itemHeight;\n\t\tconst newContentHeight = Math.max(\n\t\t\theight,\n\t\t\tcontentPaddingTop + newHeight + contentPaddingBottom\n\t\t);\n\t\tconst newContentY = Math.max(height - newContentHeight, content.position.y);\n\n\t\tconst newItemIndexLowerBound = Math.floor(\n\t\t\t((0 - (newContentY + y)) * multiplicity) / itemHeight\n\t\t);\n\t\tconst newItemIndexUpperBound = Math.floor(\n\t\t\t((height - (newContentY + y)) * multiplicity) / itemHeight\n\t\t);\n\t\tlet newItemIndexStart = newItemIndexLowerBound - multiplicity;\n\t\tif (newItemIndexStart % 2 !== 0) {\n\t\t\tnewItemIndexStart -= 1;\n\t\t}\n\t\tlet newItemIndexEnd = newItemIndexUpperBound + multiplicity + multiplicity;\n\t\tif (newItemIndexEnd % 2 !== 0) {\n\t\t\tnewItemIndexEnd += 1;\n\t\t}\n\t\tlet newItemCount = newItemIndexEnd - newItemIndexStart;\n\t\tif (newItemCount < oldItemCount && oldItemCount - 2 <= newItemCount) {\n\t\t\tnewItemCount = oldItemCount;\n\t\t\tnewItemIndexEnd = newItemIndexStart + newItemCount;\n\t\t}\n\n\t\tif (oldItemCount < newItemCount) {\n\t\t\tfor (let i = oldItemCount; i < newItemCount; ++i) {\n\t\t\t\tconst oldItemIndex = oldItemIndexStart + i;\n\t\t\t\tconst item = initItem(newItem(data), oldItemIndex, data);\n\t\t\t\tcontainer.addChild(item);\n\t\t\t}\n\t\t\toldItemCount = newItemCount;\n\t\t\toldItemIndexEnd = oldItemIndexStart + oldItemCount;\n\t\t} else if (newItemCount < oldItemCount) {\n\t\t\tfor (let i = oldItemCount - 1; newItemCount <= i; --i) {\n\t\t\t\tcontainer.removeChild(items[i]);\n\t\t\t}\n\t\t\toldItemCount = newItemCount;\n\t\t\toldItemIndexEnd = oldItemIndexStart + oldItemCount;\n\t\t}\n\n\t\tthis._itemIndexStart = newItemIndexStart;\n\t\tthis._itemIndexEnd = newItemIndexEnd;\n\n\t\tconst itemIndexStartDelta = newItemIndexStart - oldItemIndexStart;\n\t\tconst itemIndexStartDeltaAbs = Math.abs(itemIndexStartDelta);\n\t\tconst itemsLength = items.length;\n\t\tif (0 < itemIndexStartDeltaAbs && itemIndexStartDeltaAbs < itemsLength) {\n\t\t\tconst work = this._workItems;\n\t\t\tif (0 < itemIndexStartDelta) {\n\t\t\t\tfor (let i = 0; i < itemIndexStartDeltaAbs; ++i) {\n\t\t\t\t\tconst item = items[i];\n\t\t\t\t\tthis.reset(item);\n\t\t\t\t\twork.push(item);\n\t\t\t\t}\n\t\t\t\tfor (let i = itemIndexStartDeltaAbs; i < itemsLength; ++i) {\n\t\t\t\t\titems[i - itemIndexStartDeltaAbs] = items[i];\n\t\t\t\t}\n\t\t\t\tfor (let i = 0; i < itemIndexStartDeltaAbs; ++i) {\n\t\t\t\t\titems[itemsLength - itemIndexStartDeltaAbs + i] = work[i];\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (let i = 0; i < itemIndexStartDeltaAbs; ++i) {\n\t\t\t\t\tconst item = items[itemsLength - itemIndexStartDeltaAbs + i];\n\t\t\t\t\tthis.reset(item);\n\t\t\t\t\twork.push(item);\n\t\t\t\t}\n\t\t\t\tfor (let i = itemsLength - itemIndexStartDeltaAbs - 1; 0 <= i; --i) {\n\t\t\t\t\titems[i + itemIndexStartDeltaAbs] = items[i];\n\t\t\t\t}\n\t\t\t\tfor (let i = 0; i < itemIndexStartDeltaAbs; ++i) {\n\t\t\t\t\titems[i] = work[i];\n\t\t\t\t}\n\t\t\t}\n\t\t\twork.length = 0;\n\t\t}\n\n\t\tlet itemOffsetX = 0;\n\t\tlet itemOffsetY = 0;\n\t\tif (content === container) {\n\t\t\titemOffsetX = contentPaddingLeft;\n\t\t\titemOffsetY = contentPaddingTop;\n\t\t}\n\t\tmapped.each(\n\t\t\t(datum: VALUE, index: number): void | boolean => {\n\t\t\t\tconst item = items[index - newItemIndexStart];\n\t\t\t\tconst ix = index % multiplicity;\n\t\t\t\tconst iy = Math.floor(index / multiplicity);\n\t\t\t\titem.position.set(itemOffsetX + ix * itemWidth, itemOffsetY + iy * itemHeight);\n\t\t\t\tthis.set(item, datum, index, forcibly);\n\t\t\t},\n\t\t\tnewItemIndexStart,\n\t\t\tnewItemIndexStart + itemsLength\n\t\t);\n\n\t\tfor (let i = 0; newItemIndexStart + i < 0 && i < itemsLength; ++i) {\n\t\t\tconst item = items[i];\n\t\t\tconst index = newItemIndexStart + i;\n\t\t\tconst ix = index % multiplicity;\n\t\t\tconst iy = Math.floor(index / multiplicity);\n\t\t\titem.position.set(itemOffsetX + ix * itemWidth, itemOffsetY + iy * itemHeight);\n\t\t\tthis.unset(item);\n\t\t}\n\n\t\tfor (let i = itemsLength - 1; dataSize <= newItemIndexStart + i && 0 <= i; --i) {\n\t\t\tconst item = items[i];\n\t\t\tconst index = newItemIndexStart + i;\n\t\t\tconst ix = index % multiplicity;\n\t\t\tconst iy = Math.floor(index / multiplicity);\n\t\t\titem.position.set(itemOffsetX + ix * itemWidth, itemOffsetY + iy * itemHeight);\n\t\t\tthis.unset(item);\n\t\t}\n\n\t\tthis.lock();\n\t\tcontent.position.y = newContentY;\n\t\tcontent.height = newContentHeight;\n\t\tif (content !== container) {\n\t\t\tcontainer.height = newHeight;\n\t\t}\n\t\tthis.unlock(false);\n\t}\n\n\tprotected abstract toMapped(data: DATA): DATA_MAPPED;\n\n\tprotected set(item: ITEM, value: VALUE, index: number, forcibly?: boolean): void {\n\t\titem.set(value, index, forcibly);\n\t}\n\n\tprotected unset(item: ITEM): void {\n\t\titem.unset();\n\t}\n\n\tprotected reset(item: ITEM): ITEM {\n\t\titem.blur(true);\n\t\tconst cells = item.children;\n\t\tfor (let i = 0, imax = cells.length; i < imax; ++i) {\n\t\t\tconst cell = cells[i];\n\t\t\tif (cell instanceof DBase) {\n\t\t\t\tconst state = cell.state;\n\t\t\t\tstate.lock();\n\t\t\t\tstate.isPressed = false;\n\t\t\t\tstate.isHovered = false;\n\t\t\t\tstate.unlock();\n\t\t\t}\n\t\t}\n\t\titem.state.isHovered = false;\n\t\treturn item;\n\t}\n\n\tmoveFocus(\n\t\te: KeyboardEvent,\n\t\ttarget: DBase,\n\t\tmoveVertically: boolean,\n\t\tmoveHorizontally: boolean\n\t): boolean {\n\t\tif (!(moveVertically || moveHorizontally)) {\n\t\t\treturn false;\n\t\t}\n\t\tconst isUp = moveVertically && UtilKeyboardEvent.isArrowUpKey(e);\n\t\tconst isDown = moveVertically && UtilKeyboardEvent.isArrowDownKey(e);\n\t\tconst isLeft = moveHorizontally && UtilKeyboardEvent.isArrowLeftKey(e);\n\t\tconst isRight = moveHorizontally && UtilKeyboardEvent.isArrowRightKey(e);\n\t\tif (!(isUp || isDown || isLeft || isRight)) {\n\t\t\treturn false;\n\t\t}\n\t\tif (!target.state.isActionable) {\n\t\t\treturn false;\n\t\t}\n\t\tconst layer = DApplications.getLayer(target);\n\t\tif (layer == null) {\n\t\t\treturn false;\n\t\t}\n\t\tconst focusController = layer.getFocusController();\n\t\tconst focused = focusController.get();\n\t\tif (focused == null) {\n\t\t\treturn false;\n\t\t}\n\t\tconst container = this._container;\n\t\tif (focused.parent !== container) {\n\t\t\treturn false;\n\t\t}\n\t\tconst item = focused as ITEM;\n\t\tconst index = item.index;\n\t\tif (index == null) {\n\t\t\treturn false;\n\t\t}\n\t\tconst multiplicity = this._multiplicity;\n\t\tconst data = this._data;\n\t\tconst mapped = this.toMapped(data);\n\t\tconst dataSize = mapped.size();\n\t\tlet newIndex = index;\n\t\tif (isLeft || isRight) {\n\t\t\tif (isLeft) {\n\t\t\t\tif (0 <= newIndex - 1) {\n\t\t\t\t\tnewIndex -= 1;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (newIndex + 1 < dataSize) {\n\t\t\t\t\tnewIndex += 1;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (isUp || isDown) {\n\t\t\tif (isUp) {\n\t\t\t\tif (0 <= newIndex - multiplicity) {\n\t\t\t\t\tnewIndex -= multiplicity;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (newIndex + multiplicity < dataSize) {\n\t\t\t\t\tnewIndex += multiplicity;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (newIndex === index) {\n\t\t\treturn false;\n\t\t}\n\t\tconst items = container.children as ITEM[];\n\t\tconst itemIndex = items.indexOf(item);\n\t\tif (itemIndex < 0) {\n\t\t\treturn false;\n\t\t}\n\t\tconst newItemIndex = itemIndex + (newIndex - index);\n\t\tif (newItemIndex < 0 || items.length <= newItemIndex) {\n\t\t\treturn false;\n\t\t}\n\t\tconst newItem = items[newItemIndex];\n\t\tfocusController.focus(newItem);\n\t\treturn true;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DListData } from \"./d-list-data\";\nimport { DListDataMapped } from \"./d-list-data-mapped\";\nimport { DListItem } from \"./d-list-item\";\nimport { DItemUpdater, DItemUpdaterOptions } from \"./d-item-updater\";\n\nexport interface DListItemUpdaterOptions<VALUE>\n\textends DItemUpdaterOptions<VALUE, DListData<VALUE>, DListItem<VALUE>> {}\n\nexport class DListItemUpdater<VALUE = unknown> extends DItemUpdater<\n\tVALUE,\n\tDListData<VALUE>,\n\tDListDataMapped<VALUE>,\n\tDListItem<VALUE>,\n\tDListItemUpdaterOptions<VALUE>\n> {\n\tprotected toMapped(data: DListData<VALUE>): DListDataMapped<VALUE> {\n\t\treturn data.mapped;\n\t}\n\n\tprotected newItem(this: undefined, data: DListData<VALUE>): DListItem<VALUE> {\n\t\treturn new DListItem<VALUE>(data);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDialogSelectListItem } from \"./d-dialog-select-list-item\";\nimport { DListData } from \"./d-list-data\";\nimport { DListItemUpdater } from \"./d-list-item-updater\";\n\nexport class DDialogSelectListItemUpdater<VALUE = unknown> extends DListItemUpdater<VALUE> {\n\tprotected newItem(this: undefined, data: DListData<VALUE>): DDialogSelectListItem<VALUE> {\n\t\treturn new DDialogSelectListItem<VALUE>(data);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DListDataMapped } from \"./d-list-data-mapped\";\n\nexport interface DListDataMppedImplParent<NODE> {\n\treadonly before: NODE[];\n\treadonly items: NODE[];\n\treadonly after: NODE[];\n}\n\nexport class DListDataMappedImpl<ITEM> implements DListDataMapped<ITEM> {\n\tprotected readonly _parent: DListDataMppedImplParent<ITEM>;\n\n\tconstructor(parent: DListDataMppedImplParent<ITEM>) {\n\t\tthis._parent = parent;\n\t}\n\n\tsize(): number {\n\t\tconst parent = this._parent;\n\t\treturn parent.before.length + parent.items.length + parent.after.length;\n\t}\n\n\teach(\n\t\titeratee: (value: ITEM, index: number) => boolean | void,\n\t\tfrom?: number,\n\t\tto?: number\n\t): void {\n\t\tconst parent = this._parent;\n\t\tconst index0 = this.each_(iteratee, parent.before, 0, from, to);\n\t\tif (index0 < 0) {\n\t\t\treturn;\n\t\t}\n\t\tconst index1 = this.each_(iteratee, parent.items, index0, from, to);\n\t\tif (index1 < 0) {\n\t\t\treturn;\n\t\t}\n\t\tthis.each_(iteratee, parent.after, index1, from, to);\n\t}\n\n\teach_(\n\t\titeratee: (value: ITEM, index: number) => boolean | void,\n\t\titems: ITEM[],\n\t\tstart: number,\n\t\tfrom?: number,\n\t\tto?: number\n\t): number {\n\t\tconst end = start + items.length;\n\t\tconst ifrom = from != null ? Math.max(start, from) : start;\n\t\tconst ito = to != null ? Math.min(end, to) : end;\n\t\tfor (let i = ifrom; i < ito; ++i) {\n\t\t\tif (iteratee(items[i - start], i) === false) {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t}\n\t\treturn ito;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { utils } from \"pixi.js\";\nimport { DListDataSelectionParent } from \"./d-list-data-selection-parent\";\nimport {\n\tDListDataSelection,\n\tDListDataSelectionType,\n\tDListDataSelectionOptions\n} from \"./d-list-data-selection\";\nimport { DListItemAccessor, DListItemToId } from \"./d-list-item-accessor\";\n\nexport class DListDataSelectionMultiple<ITEM>\n\textends utils.EventEmitter\n\timplements DListDataSelection<ITEM>\n{\n\tprotected _parent: DListDataSelectionParent<ITEM>;\n\tprotected _accessor: DListItemAccessor<ITEM>;\n\tprotected _items: Set<ITEM>;\n\n\tconstructor(\n\t\tparent: DListDataSelectionParent<ITEM>,\n\t\taccessor: DListItemAccessor<ITEM>,\n\t\toptions?: DListDataSelectionOptions<ITEM>\n\t) {\n\t\tsuper();\n\n\t\tthis._parent = parent;\n\t\tthis._accessor = accessor;\n\t\tthis._items = new Set<ITEM>();\n\n\t\t// Events\n\t\tconst on = options?.on;\n\t\tif (on) {\n\t\t\tfor (const name in on) {\n\t\t\t\tconst handler = on[name];\n\t\t\t\tif (handler) {\n\t\t\t\t\tthis.on(name, handler);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tget type(): DListDataSelectionType {\n\t\treturn DListDataSelectionType.MULTIPLE;\n\t}\n\n\tget first(): ITEM | null {\n\t\treturn this.get(0);\n\t}\n\n\tget last(): ITEM | null {\n\t\treturn this.get(this.size() - 1);\n\t}\n\n\tget(index: number): ITEM | null {\n\t\tconst items = this._items;\n\t\tif (0 <= index && index < items.size) {\n\t\t\tlet counter = 0;\n\t\t\tlet result: ITEM | null = null;\n\t\t\titems.forEach((item): void => {\n\t\t\t\tif (counter === index) {\n\t\t\t\t\tresult = item;\n\t\t\t\t}\n\t\t\t\tcounter += 1;\n\t\t\t});\n\t\t\treturn result;\n\t\t}\n\t\treturn null;\n\t}\n\n\tadd(target: ITEM): boolean {\n\t\tconst items = this._items;\n\t\tif (!items.has(target)) {\n\t\t\titems.add(target);\n\t\t\tthis.onChange();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tremove(target: ITEM): boolean {\n\t\tconst items = this._items;\n\t\tif (items.has(target)) {\n\t\t\titems.delete(target);\n\t\t\tthis.onChange();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\ttoggle(target: ITEM): boolean {\n\t\tconst items = this._items;\n\t\tif (items.has(target)) {\n\t\t\titems.delete(target);\n\t\t} else {\n\t\t\titems.add(target);\n\t\t}\n\t\tthis.onChange();\n\t\treturn true;\n\t}\n\n\tclear(): void {\n\t\tconst items = this._items;\n\t\tif (0 < items.size) {\n\t\t\titems.clear();\n\t\t\tthis.onChange();\n\t\t}\n\t}\n\n\tclearAndAdd(target: ITEM): boolean {\n\t\tconst items = this._items;\n\t\tconst size = items.size;\n\t\tif (size === 1) {\n\t\t\tif (items.has(target)) {\n\t\t\t\treturn false;\n\t\t\t} else {\n\t\t\t\titems.clear();\n\t\t\t\titems.add(target);\n\t\t\t\tthis.onChange();\n\t\t\t\treturn true;\n\t\t\t}\n\t\t} else {\n\t\t\titems.clear();\n\t\t\titems.add(target);\n\t\t\tthis.onChange();\n\t\t\treturn true;\n\t\t}\n\t}\n\n\tclearAndAddAll(targets: ITEM[]): boolean {\n\t\tlet isDirty = false;\n\t\tconst newNodes = new Set<ITEM>();\n\t\tconst oldNodes = this._items;\n\t\tfor (let i = 0, imax = targets.length; i < imax; ++i) {\n\t\t\tconst target = targets[i];\n\t\t\tif (!oldNodes.has(target)) {\n\t\t\t\tisDirty = true;\n\t\t\t}\n\t\t\tnewNodes.add(target);\n\t\t}\n\t\tif (!isDirty) {\n\t\t\toldNodes.forEach((oldItem): void => {\n\t\t\t\tif (!newNodes.has(oldItem)) {\n\t\t\t\t\tisDirty = true;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tif (isDirty) {\n\t\t\tthis._items = newNodes;\n\t\t\tthis.onChange();\n\t\t}\n\t\treturn isDirty;\n\t}\n\n\tcontains(target: ITEM): boolean {\n\t\treturn this._items.has(target);\n\t}\n\n\tsize(): number {\n\t\treturn this._items.size;\n\t}\n\n\tisEmpty(): boolean {\n\t\treturn this.size() <= 0;\n\t}\n\n\teach(iteratee: (item: ITEM) => boolean | void): void {\n\t\tlet isCanceled = false;\n\t\tthis._items.forEach((item): void => {\n\t\t\tif (!isCanceled) {\n\t\t\t\tif (iteratee(item) === false) {\n\t\t\t\t\tisCanceled = true;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\ttoArray(): ITEM[] {\n\t\tconst result: ITEM[] = [];\n\t\tthis._items.forEach((item) => {\n\t\t\tresult.push(item);\n\t\t});\n\t\treturn result;\n\t}\n\n\tprotected onChange(): void {\n\t\tthis._parent.update();\n\t\tthis.emit(\"change\", this);\n\t}\n\n\tprotected toItemIdMap(\n\t\titems: ITEM[],\n\t\ttoId: DListItemToId<ITEM>,\n\t\tresult: Map<unknown, ITEM>\n\t): void {\n\t\tfor (let i = 0, imax = items.length; i < imax; ++i) {\n\t\t\tconst item = items[i];\n\t\t\tresult.set(toId(item), item);\n\t\t}\n\t}\n\n\tprotected toItemSet(items: ITEM[], result: Set<ITEM>): void {\n\t\tfor (let i = 0, imax = items.length; i < imax; ++i) {\n\t\t\tresult.add(items[i]);\n\t\t}\n\t}\n\n\tonItemChange(before: ITEM[], items: ITEM[], after: ITEM[]): void {\n\t\tconst oldItems = this._items;\n\t\tconst newItems = new Set<ITEM>();\n\t\tconst toId = this._accessor.toId;\n\t\tif (toId) {\n\t\t\tconst newItemIdMap = new Map<unknown, ITEM>();\n\t\t\tthis.toItemIdMap(before, toId, newItemIdMap);\n\t\t\tthis.toItemIdMap(items, toId, newItemIdMap);\n\t\t\tthis.toItemIdMap(after, toId, newItemIdMap);\n\t\t\toldItems.forEach((oldItem): void => {\n\t\t\t\tconst oldItemId = toId(oldItem);\n\t\t\t\tconst newItem = newItemIdMap.get(oldItemId);\n\t\t\t\tif (newItem != null) {\n\t\t\t\t\tnewItems.add(newItem);\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis._items = newItems;\n\t\t\tthis.onChange();\n\t\t} else {\n\t\t\tconst newItemSet = new Set<ITEM>();\n\t\t\tthis.toItemSet(before, newItemSet);\n\t\t\tthis.toItemSet(items, newItemSet);\n\t\t\tthis.toItemSet(after, newItemSet);\n\t\t\toldItems.forEach((oldItem): void => {\n\t\t\t\tif (newItemSet.has(oldItem)) {\n\t\t\t\t\tnewItems.add(oldItem);\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (oldItems.size !== newItems.size) {\n\t\t\t\tthis._items = newItems;\n\t\t\t\tthis.onChange();\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected newItems(items: ITEM[], existing: Set<ITEM>, result: Set<ITEM>): Set<ITEM> {\n\t\tfor (let i = 0, imax = items.length; i < imax; ++i) {\n\t\t\tconst item = items[i];\n\t\t\tif (existing.has(item)) {\n\t\t\t\tresult.add(item);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { utils } from \"pixi.js\";\nimport { DListDataSelectionParent } from \"./d-list-data-selection-parent\";\nimport {\n\tDListDataSelection,\n\tDListDataSelectionType,\n\tDListDataSelectionOptions\n} from \"./d-list-data-selection\";\nimport { DListItemAccessor } from \"./d-list-item-accessor\";\n\nexport class DListDataSelectionNone<ITEM>\n\textends utils.EventEmitter\n\timplements DListDataSelection<ITEM>\n{\n\tprotected _parent: DListDataSelectionParent<ITEM>;\n\n\tconstructor(\n\t\tparent: DListDataSelectionParent<ITEM>,\n\t\taccessor: DListItemAccessor<ITEM>,\n\t\toptions?: DListDataSelectionOptions<ITEM>\n\t) {\n\t\tsuper();\n\n\t\tthis._parent = parent;\n\n\t\t// Events\n\t\tconst on = options?.on;\n\t\tif (on) {\n\t\t\tfor (const name in on) {\n\t\t\t\tconst handler = on[name];\n\t\t\t\tif (handler) {\n\t\t\t\t\tthis.on(name, handler);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tget type(): DListDataSelectionType {\n\t\treturn DListDataSelectionType.NONE;\n\t}\n\n\tget first(): ITEM | null {\n\t\treturn null;\n\t}\n\n\tget last(): ITEM | null {\n\t\treturn null;\n\t}\n\n\tget(index: number): ITEM | null {\n\t\treturn null;\n\t}\n\n\tadd(target: ITEM): boolean {\n\t\treturn false;\n\t}\n\n\tremove(target: ITEM): boolean {\n\t\treturn false;\n\t}\n\n\ttoggle(target: ITEM): boolean {\n\t\treturn false;\n\t}\n\n\tclear(): void {\n\t\t// DO NOTHING\n\t}\n\n\tclearAndAdd(target: ITEM): boolean {\n\t\treturn false;\n\t}\n\n\tclearAndAddAll(targets: ITEM[]): boolean {\n\t\treturn false;\n\t}\n\n\tcontains(target: ITEM): boolean {\n\t\treturn false;\n\t}\n\n\tsize(): number {\n\t\treturn 0;\n\t}\n\n\tisEmpty(): boolean {\n\t\treturn true;\n\t}\n\n\teach(iteratee: (item: ITEM) => boolean | void): void {\n\t\t// DO NOTHING\n\t}\n\n\ttoArray(): ITEM[] {\n\t\treturn [];\n\t}\n\n\tprotected onChange(): void {\n\t\tthis._parent.update();\n\t\tthis.emit(\"change\", this);\n\t}\n\n\tonItemChange(before: ITEM[], items: ITEM[], after: ITEM[]): void {\n\t\t// DO NOTHING\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { utils } from \"pixi.js\";\nimport { DListDataSelectionParent } from \"./d-list-data-selection-parent\";\nimport {\n\tDListDataSelection,\n\tDListDataSelectionType,\n\tDListDataSelectionOptions\n} from \"./d-list-data-selection\";\nimport { DListItemAccessor, DListItemToId } from \"./d-list-item-accessor\";\n\nexport class DListDataSelectionSingle<ITEM>\n\textends utils.EventEmitter\n\timplements DListDataSelection<ITEM>\n{\n\tprotected _parent: DListDataSelectionParent<ITEM>;\n\tprotected _accessor: DListItemAccessor<ITEM>;\n\tprotected _item: ITEM | null;\n\n\tconstructor(\n\t\tparent: DListDataSelectionParent<ITEM>,\n\t\taccessor: DListItemAccessor<ITEM>,\n\t\toptions?: DListDataSelectionOptions<ITEM>\n\t) {\n\t\tsuper();\n\n\t\tthis._parent = parent;\n\t\tthis._accessor = accessor;\n\t\tthis._item = null;\n\n\t\t// Events\n\t\tconst on = options?.on;\n\t\tif (on) {\n\t\t\tfor (const name in on) {\n\t\t\t\tconst handler = on[name];\n\t\t\t\tif (handler) {\n\t\t\t\t\tthis.on(name, handler);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tget type(): DListDataSelectionType {\n\t\treturn DListDataSelectionType.SINGLE;\n\t}\n\n\tget first(): ITEM | null {\n\t\treturn this._item;\n\t}\n\n\tget last(): ITEM | null {\n\t\treturn this.get(this.size() - 1);\n\t}\n\n\tget(index: number): ITEM | null {\n\t\tif (0 === index) {\n\t\t\treturn this._item;\n\t\t}\n\t\treturn null;\n\t}\n\n\tadd(target: ITEM): boolean {\n\t\tif (this._item !== target) {\n\t\t\tthis._item = target;\n\t\t\tthis.onChange();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tremove(target: ITEM): boolean {\n\t\tif (this._item === target) {\n\t\t\tthis._item = null;\n\t\t\tthis.onChange();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\ttoggle(target: ITEM): boolean {\n\t\tif (this._item === target) {\n\t\t\tthis._item = null;\n\t\t} else {\n\t\t\tthis._item = target;\n\t\t}\n\t\tthis.onChange();\n\t\treturn true;\n\t}\n\n\tclear(): void {\n\t\tif (this._item != null) {\n\t\t\tthis._item = null;\n\t\t\tthis.onChange();\n\t\t}\n\t}\n\n\tclearAndAdd(target: ITEM): boolean {\n\t\tif (this._item !== target) {\n\t\t\tthis._item = target;\n\t\t\tthis.onChange();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tclearAndAddAll(targets: ITEM[]): boolean {\n\t\tconst targetsLength = targets.length;\n\t\tif (0 < targetsLength) {\n\t\t\tconst last = targets[targetsLength - 1];\n\t\t\tif (this._item !== last) {\n\t\t\t\tthis._item = last;\n\t\t\t\tthis.onChange();\n\t\t\t\treturn true;\n\t\t\t}\n\t\t} else {\n\t\t\tif (this._item != null) {\n\t\t\t\tthis._item = null;\n\t\t\t\tthis.onChange();\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tcontains(target: ITEM): boolean {\n\t\treturn this._item === target;\n\t}\n\n\tsize(): number {\n\t\treturn this._item != null ? 1 : 0;\n\t}\n\n\tisEmpty(): boolean {\n\t\treturn this.size() <= 0;\n\t}\n\n\teach(iteratee: (item: ITEM) => boolean | void): void {\n\t\tconst item = this._item;\n\t\tif (item != null) {\n\t\t\titeratee(item);\n\t\t}\n\t}\n\n\ttoArray(): ITEM[] {\n\t\tconst item = this._item;\n\t\tif (item != null) {\n\t\t\treturn [item];\n\t\t}\n\t\treturn [];\n\t}\n\n\tprotected onChange(): void {\n\t\tthis._parent.update();\n\t\tthis.emit(\"change\", this);\n\t}\n\n\tprotected findById(id: unknown, toId: DListItemToId<ITEM>, items: ITEM[]): ITEM | null {\n\t\tfor (let i = 0, imax = items.length; i < imax; ++i) {\n\t\t\tconst item = items[i];\n\t\t\tconst itemId = toId(item);\n\t\t\tif (id === itemId) {\n\t\t\t\treturn item;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tprotected find(target: ITEM, items: ITEM[]): ITEM | null {\n\t\tfor (let i = 0, imax = items.length; i < imax; ++i) {\n\t\t\tconst item = items[i];\n\t\t\tif (target === item) {\n\t\t\t\treturn item;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tonItemChange(before: ITEM[], items: ITEM[], after: ITEM[]): void {\n\t\tconst oldItem = this._item;\n\t\tif (oldItem == null) {\n\t\t\treturn;\n\t\t}\n\t\tlet newItem: ITEM | null = null;\n\t\tconst toId = this._accessor.toId;\n\t\tif (toId) {\n\t\t\tconst oldItemId = toId(oldItem);\n\t\t\tnewItem =\n\t\t\t\tthis.findById(oldItemId, toId, before) ||\n\t\t\t\tthis.findById(oldItemId, toId, items) ||\n\t\t\t\tthis.findById(oldItemId, toId, after);\n\t\t} else {\n\t\t\tnewItem =\n\t\t\t\tthis.find(oldItem, before) ||\n\t\t\t\tthis.find(oldItem, items) ||\n\t\t\t\tthis.find(oldItem, after);\n\t\t}\n\t\tif (oldItem !== newItem) {\n\t\t\tthis._item = newItem;\n\t\t\tthis.onChange();\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DisplayObject, Texture } from \"pixi.js\";\nimport { DLinkUrlValue } from \"./d-link\";\nimport {\n\tDListItemAccessor,\n\tDListItemAccessorLink,\n\tDListItemAccessorOptions,\n\tDListItemToId,\n\tDListItemToImage,\n\tDListItemToLabel,\n\tDListItemToTitle\n} from \"./d-list-item-accessor\";\nimport { toLabel as toLabelDefault } from \"./util/to-label\";\n\nconst toImage = (value: any): DisplayObject | Texture | null | undefined => {\n\treturn value.image;\n};\n\nconst toTitle = (value: any): string | undefined => {\n\treturn value.title;\n};\n\nconst toLinkUrl = (value: any): DLinkUrlValue | Promise<DLinkUrlValue> => {\n\treturn value.url;\n};\n\nexport class DListItemAccessorImpl<VALUE> implements DListItemAccessor<VALUE> {\n\ttoLabel: DListItemToLabel<VALUE>;\n\ttoTitle: DListItemToTitle<VALUE>;\n\ttoImage: DListItemToImage<VALUE>;\n\ttoId?: DListItemToId<VALUE>;\n\tlink?: DListItemAccessorLink<VALUE>;\n\n\tconstructor(options?: DListItemAccessorOptions<VALUE>) {\n\t\tthis.toLabel = options?.toLabel || toLabelDefault;\n\t\tthis.toTitle = options?.toTitle || toTitle;\n\t\tthis.toImage = options?.toImage || toImage;\n\t\tthis.toId = options?.toId;\n\t\tthis.link = this.toLink(options);\n\t}\n\n\tprotected toLink(\n\t\toptions?: DListItemAccessorOptions<VALUE>\n\t): DListItemAccessorLink<VALUE> | undefined {\n\t\tif (options) {\n\t\t\tconst link = options.link;\n\t\t\tif (link) {\n\t\t\t\tconst toUrl = link.toUrl;\n\t\t\t\tconst target = link.target;\n\t\t\t\tconst checker = link.checker;\n\t\t\t\tif (toUrl !== undefined || target !== undefined || checker !== undefined) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\ttoUrl: toUrl || toLinkUrl,\n\t\t\t\t\t\ttarget,\n\t\t\t\t\t\tchecker\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DListData, DListDataIteratee, DListDataOptions } from \"./d-list-data\";\nimport { DListDataMapped } from \"./d-list-data-mapped\";\nimport { DListDataMappedImpl } from \"./d-list-data-mapped-impl\";\nimport { DListDataSelection, DListDataSelectionType } from \"./d-list-data-selection\";\nimport { DListDataSelectionMultiple } from \"./d-list-data-selection-multiple\";\nimport { DListDataSelectionNone } from \"./d-list-data-selection-none\";\nimport { DListDataSelectionSingle } from \"./d-list-data-selection-single\";\nimport { DListItemAccessor } from \"./d-list-item-accessor\";\nimport { DListItemAccessorImpl } from \"./d-list-item-accessor-impl\";\n\nexport interface DListDataImplParent {\n\tupdate(forcibly?: boolean): void;\n}\n\nexport interface DListDataImplSelection<ITEM> extends DListDataSelection<ITEM> {\n\tonItemChange(before: ITEM[], items: ITEM[], after: ITEM[]): void;\n}\n\nexport class DListDataImpl<ITEM> implements DListData<ITEM> {\n\tprotected _parent: DListDataImplParent;\n\tprotected _before: ITEM[];\n\tprotected _items: ITEM[];\n\tprotected _after: ITEM[];\n\tprotected _accessor: DListItemAccessorImpl<ITEM>;\n\tprotected _selection: DListDataImplSelection<ITEM>;\n\tprotected _mapped: DListDataMapped<ITEM>;\n\n\tconstructor(parent: DListDataImplParent, options?: DListDataOptions<ITEM>) {\n\t\tthis._parent = parent;\n\t\tif (options) {\n\t\t\tthis._before = options.before || [];\n\t\t\tthis._items = options.items || [];\n\t\t\tthis._after = options.after || [];\n\t\t} else {\n\t\t\tthis._before = [];\n\t\t\tthis._items = [];\n\t\t\tthis._after = [];\n\t\t}\n\t\tconst accessor = new DListItemAccessorImpl<ITEM>(options);\n\t\tthis._accessor = accessor;\n\t\tthis._selection = this.toSelection(accessor, options);\n\t\tthis._mapped = new DListDataMappedImpl<ITEM>(this);\n\t}\n\n\tprotected toSelection(\n\t\taccessor: DListItemAccessorImpl<ITEM>,\n\t\toptions?: DListDataOptions<ITEM>\n\t): DListDataImplSelection<ITEM> {\n\t\tconst selection = options?.selection;\n\t\tswitch (selection?.type) {\n\t\t\tcase DListDataSelectionType.NONE:\n\t\t\tcase \"NONE\":\n\t\t\t\treturn new DListDataSelectionNone<ITEM>(this, accessor, selection);\n\t\t\tcase DListDataSelectionType.MULTIPLE:\n\t\t\tcase \"MULTIPLE\":\n\t\t\t\treturn new DListDataSelectionMultiple<ITEM>(this, accessor, selection);\n\t\t\tdefault:\n\t\t\t\treturn new DListDataSelectionSingle<ITEM>(this, accessor, selection);\n\t\t}\n\t}\n\n\tget before(): ITEM[] {\n\t\treturn this._before;\n\t}\n\n\tset before(before: ITEM[]) {\n\t\tthis._before = before;\n\t\tthis._selection.onItemChange(before, this._items, this._after);\n\t\tthis.update();\n\t}\n\n\tget items(): ITEM[] {\n\t\treturn this._items;\n\t}\n\n\tset items(items: ITEM[]) {\n\t\tthis._items = items;\n\t\tthis._selection.onItemChange(this._before, items, this._after);\n\t\tthis.update();\n\t}\n\n\tget after(): ITEM[] {\n\t\treturn this._after;\n\t}\n\n\tset after(after: ITEM[]) {\n\t\tthis._after = after;\n\t\tthis._selection.onItemChange(this._before, this._items, after);\n\t\tthis.update();\n\t}\n\n\tget mapped(): DListDataMapped<ITEM> {\n\t\treturn this._mapped;\n\t}\n\n\tget accessor(): DListItemAccessor<ITEM> {\n\t\treturn this._accessor;\n\t}\n\n\tget selection(): DListDataSelection<ITEM> {\n\t\treturn this._selection;\n\t}\n\n\tupdate(forcibly?: boolean): void {\n\t\tthis._parent.update(forcibly);\n\t}\n\n\tsize(): number {\n\t\treturn this._items.length;\n\t}\n\n\tclear(): boolean {\n\t\tconst items = this._items;\n\t\tif (0 < items.length) {\n\t\t\titems.length = 0;\n\t\t\tthis.onChange();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tclearAndAdd(item: ITEM): boolean {\n\t\tconst items = this._items;\n\t\tif (items.length === 1) {\n\t\t\tconst first = items[0];\n\t\t\tif (first === item) {\n\t\t\t\treturn false;\n\t\t\t} else {\n\t\t\t\titems[0] = item;\n\t\t\t\tthis.onChange();\n\t\t\t\treturn true;\n\t\t\t}\n\t\t} else {\n\t\t\titems.length = 0;\n\t\t\titems.push(item);\n\t\t\tthis.onChange();\n\t\t\treturn true;\n\t\t}\n\t}\n\n\tclearAndAddAll(newItems: ITEM[]): boolean {\n\t\tlet isChanged = false;\n\t\tconst items = this._items;\n\t\tif (0 < items.length) {\n\t\t\titems.length = 0;\n\t\t\tisChanged = true;\n\t\t}\n\t\tif (0 < newItems.length) {\n\t\t\tfor (let i = 0, imax = newItems.length; i < imax; ++i) {\n\t\t\t\titems.push(newItems[i]);\n\t\t\t}\n\t\t\tisChanged = true;\n\t\t}\n\t\tif (isChanged) {\n\t\t\tthis.onChange();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tadd(item: ITEM, index?: number): boolean {\n\t\tconst items = this._items;\n\t\tif (index == null) {\n\t\t\titems.push(item);\n\t\t\tthis.onChange();\n\t\t\treturn true;\n\t\t} else if (0 <= index && index < items.length) {\n\t\t\titems.splice(index, 0, item);\n\t\t\tthis.onChange();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\taddAll(newItems: ITEM[], index?: number): boolean {\n\t\tif (0 < newItems.length) {\n\t\t\tconst items = this._items;\n\t\t\tconst itemsLength = items.length;\n\t\t\tif (index == null) {\n\t\t\t\tfor (let i = 0, imax = newItems.length; i < imax; ++i) {\n\t\t\t\t\titems.push(newItems[i]);\n\t\t\t\t}\n\t\t\t\tthis.onChange();\n\t\t\t\treturn true;\n\t\t\t} else if (0 <= index && index < itemsLength) {\n\t\t\t\tfor (let i = 0, imax = newItems.length; i < imax; ++i) {\n\t\t\t\t\titems.splice(index + i, 0, newItems[i]);\n\t\t\t\t}\n\t\t\t\tthis.onChange();\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tget(index: number): ITEM | null {\n\t\tconst items = this._items;\n\t\tif (0 <= index && index < items.length) {\n\t\t\treturn items[index];\n\t\t}\n\t\treturn null;\n\t}\n\n\tset(index: number, item: ITEM): ITEM | null {\n\t\tconst items = this._items;\n\t\tif (0 <= index && index < items.length) {\n\t\t\tconst result = items[index];\n\t\t\titems[index] = item;\n\t\t\tthis.onChange();\n\t\t\treturn result;\n\t\t}\n\t\treturn null;\n\t}\n\n\tremove(index: number): ITEM | null {\n\t\tconst items = this._items;\n\t\tif (0 <= index && index < items.length) {\n\t\t\tconst result = items.splice(index, 1)[0];\n\t\t\tthis.onChange();\n\t\t\treturn result;\n\t\t}\n\t\treturn null;\n\t}\n\n\teach(iteratee: DListDataIteratee<ITEM>, from?: number, to?: number): void {\n\t\tconst items = this._items;\n\t\tconst size = items.length;\n\t\tconst ifrom = from != null ? Math.max(0, from) : 0;\n\t\tconst ito = to != null ? Math.min(size, to) : size;\n\t\tfor (let i = ifrom; i < ito; ++i) {\n\t\t\tif (iteratee(items[i], i) === false) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected onChange(): void {\n\t\tthis.update();\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBase, DBaseOptions, DThemeBase } from \"./d-base\";\n\nexport interface DContentOptions extends DBaseOptions<DThemeContent> {}\n\nexport interface DThemeContent extends DThemeBase {}\n\nexport class DContent extends DBase<DThemeContent, DContentOptions> {\n\tprotected initReflowable(): void {\n\t\t// DO NOTHING\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DContent\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DApplications } from \"./d-applications\";\nimport { DBase, DBaseOptions, DThemeBase } from \"./d-base\";\nimport { DBaseStateSet } from \"./d-base-state-set\";\nimport { DScrollBarThumb, DScrollBarThumbOptions } from \"./d-scroll-bar-thumb\";\n\nexport interface DScrollBarFadeOutOpiotns {\n\tdelay?: number;\n}\n\nexport interface DScrollBarOptions<THEME extends DThemeScrollBar = DThemeScrollBar>\n\textends DBaseOptions<THEME> {\n\tthumb?: DScrollBarThumbOptions;\n\tfadeOut?: DScrollBarFadeOutOpiotns;\n}\n\nexport interface DThemeScrollBar extends DThemeBase {\n\tgetFadeOutDelay(): number;\n}\n\nexport abstract class DScrollBar<\n\tTHEME extends DThemeScrollBar = DThemeScrollBar,\n\tOPTIONS extends DScrollBarOptions<THEME> = DScrollBarOptions<THEME>\n> extends DBase<THEME, OPTIONS> {\n\tprotected _start: number;\n\tprotected _end: number;\n\tprotected _thumb: DScrollBarThumb;\n\tprotected _touchedAt: number;\n\tprotected _isTouched: boolean;\n\tprotected _fadeOutTimeoutId: number | null;\n\tprotected _fadeOutDelay: number;\n\tprotected _onFadeOutTimeoutBound: () => void;\n\tprotected _isSilent: boolean;\n\n\tconstructor(options?: OPTIONS) {\n\t\tsuper(options);\n\n\t\tthis._start = 0;\n\t\tthis._end = 1;\n\t\tthis.visible = false;\n\t\tthis._touchedAt = -1;\n\t\tthis._isTouched = false;\n\t\tthis._fadeOutTimeoutId = null;\n\t\tthis._fadeOutDelay = options?.fadeOut?.delay ?? this.theme.getFadeOutDelay();\n\t\tthis._isSilent = true;\n\t\tthis._onFadeOutTimeoutBound = (): void => {\n\t\t\tthis.onFadeOutTimeout();\n\t\t};\n\t\tconst thumb = this.newThumb(options?.thumb);\n\t\tthumb.on(\"statechange\", (newState: DBaseStateSet, oldState: DBaseStateSet): void => {\n\t\t\tthis.onThumbStateChange(newState, oldState);\n\t\t});\n\t\tthis._thumb = thumb;\n\t\tthis.addChild(thumb);\n\t}\n\n\tget thumb(): DScrollBarThumb {\n\t\treturn this._thumb;\n\t}\n\n\tget start(): number {\n\t\treturn this._start;\n\t}\n\n\tget end(): number {\n\t\treturn this._end;\n\t}\n\n\tset(start: number, end: number, size: number, silently?: boolean): void {\n\t\tif (size < 1) {\n\t\t\tstart = 0;\n\t\t\tend = 1;\n\t\t} else {\n\t\t\tstart = Math.max(0, Math.min(1, start / size));\n\t\t\tend = Math.max(start, Math.min(1, end / size));\n\t\t}\n\t\tif (this._start !== start || this._end !== end) {\n\t\t\tthis._start = start;\n\t\t\tthis._end = end;\n\t\t\tthis.onChange(silently);\n\t\t}\n\t}\n\n\tprotected onChange(silently?: boolean): void {\n\t\tthis.updateThumb(this.width, this.height);\n\n\t\tif (silently) {\n\t\t\tthis._isSilent = true;\n\t\t}\n\t\tif (!this._isTouched) {\n\t\t\tthis._isTouched = true;\n\t\t\tDApplications.update(this);\n\t\t}\n\t}\n\n\tisRegionVisible(): boolean {\n\t\treturn 0 < this._start || this._end < 1;\n\t}\n\n\trender(renderer: PIXI.Renderer): void {\n\t\tif (this._isTouched) {\n\t\t\tthis._isTouched = false;\n\t\t\tif (!this._isSilent && this.isRegionVisible()) {\n\t\t\t\tconst fadeOutDelay = this._fadeOutDelay;\n\t\t\t\tif (0 <= fadeOutDelay) {\n\t\t\t\t\tthis._touchedAt = Date.now();\n\t\t\t\t\tif (this._fadeOutTimeoutId == null) {\n\t\t\t\t\t\tthis._fadeOutTimeoutId = window.setTimeout(\n\t\t\t\t\t\t\tthis._onFadeOutTimeoutBound,\n\t\t\t\t\t\t\tfadeOutDelay\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!this.visible) {\n\t\t\t\t\tthis.visible = true;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (this._fadeOutDelay < 0 && this.visible) {\n\t\t\t\t\tthis.visible = false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (this._isSilent) {\n\t\t\tthis._isSilent = false;\n\t\t}\n\t\tsuper.render(renderer);\n\t}\n\n\tonResize(newWidth: number, newHeight: number, oldWidth: number, oldHeight: number): void {\n\t\tsuper.onResize(newWidth, newHeight, oldWidth, oldHeight);\n\t\tthis.updateThumb(newWidth, newHeight);\n\t}\n\n\tprotected abstract updateThumb(width: number, height: number): void;\n\n\tprotected onFadeOutTimeout(): void {\n\t\tthis._fadeOutTimeoutId = null;\n\n\t\tconst fadeOutInterval = this._fadeOutDelay;\n\t\tconst onTouchTimeoutBound = this._onFadeOutTimeoutBound;\n\n\t\tconst state = this.state;\n\t\tif (state.isGesturing || state.isHovered || state.isPressed) {\n\t\t\tthis._fadeOutTimeoutId = window.setTimeout(onTouchTimeoutBound, fadeOutInterval);\n\t\t\treturn;\n\t\t}\n\n\t\tconst thumbState = this._thumb.state;\n\t\tif (thumbState.isGesturing || thumbState.isHovered || thumbState.isPressed) {\n\t\t\tthis._fadeOutTimeoutId = window.setTimeout(onTouchTimeoutBound, fadeOutInterval);\n\t\t\treturn;\n\t\t}\n\n\t\tconst now = Date.now();\n\t\tconst remainingTime = fadeOutInterval - (now - this._touchedAt);\n\t\tif (0 < remainingTime) {\n\t\t\tthis._fadeOutTimeoutId = window.setTimeout(onTouchTimeoutBound, remainingTime);\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.visible) {\n\t\t\tthis.visible = false;\n\t\t\tDApplications.update(this);\n\t\t}\n\t}\n\n\tprotected onThumbStateChange(newState: DBaseStateSet, oldState: DBaseStateSet): void {\n\t\tif (!newState.isGesturing && !newState.isHovered && !newState.isPressed) {\n\t\t\tif (oldState.isGesturing || oldState.isHovered || oldState.isPressed) {\n\t\t\t\tthis._touchedAt = Date.now();\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected onStateChange(newState: DBaseStateSet, oldState: DBaseStateSet): void {\n\t\tsuper.onStateChange(newState, oldState);\n\n\t\tif (!newState.isGesturing && !newState.isHovered && !newState.isPressed) {\n\t\t\tif (oldState.isGesturing || oldState.isHovered || oldState.isPressed) {\n\t\t\t\tthis._touchedAt = Date.now();\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected abstract newThumb(options?: DScrollBarThumbOptions): DScrollBarThumb;\n\n\tprotected getType(): string {\n\t\treturn \"DScrollBar\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Point } from \"pixi.js\";\nimport { DBase, DBaseOptions, DThemeBase } from \"./d-base\";\nimport { UtilGesture } from \"./util/util-gesture\";\n\nexport interface DScrollBarThumbOptions extends DBaseOptions<DThemeScrollBarThumb> {}\n\nexport interface DThemeScrollBarThumb extends DThemeBase {\n\tgetThumbMinimumLength(): number;\n}\n\nexport abstract class DScrollBarThumb extends DBase<DThemeScrollBarThumb, DScrollBarThumbOptions> {\n\tprotected _gestureUtil!: UtilGesture<DScrollBarThumb>;\n\n\tprotected init(options?: DScrollBarThumbOptions): void {\n\t\tsuper.init(options);\n\n\t\tconst position = new Point();\n\t\tthis._gestureUtil = new UtilGesture<DScrollBarThumb>({\n\t\t\tbind: this,\n\t\t\teasing: true,\n\t\t\ton: {\n\t\t\t\tstart: (): void => {\n\t\t\t\t\tposition.copyFrom(this.position);\n\t\t\t\t},\n\t\t\t\tmove: (target: DScrollBarThumb, dx: number, dy: number): void => {\n\t\t\t\t\tposition.set(position.x + dx, position.y + dy);\n\t\t\t\t\tthis.onGestureMove(position.x, position.y);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tgetMinimumLength(): number {\n\t\treturn this.theme.getThumbMinimumLength();\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DScrollBarThumb\";\n\t}\n\n\tprotected abstract onGestureMove(dx: number, dy: number): void;\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Graphics } from \"pixi.js\";\nimport { DBase } from \"./d-base\";\nimport { DBaseReflowable } from \"./d-base-reflowable\";\nimport { DScrollBarThumb } from \"./d-scroll-bar-thumb\";\n\nexport class DScrollBarThumbReflowableHorizontal extends Graphics implements DBaseReflowable {\n\tconstructor(base: DScrollBarThumb) {\n\t\tsuper();\n\t\tbase.snippet.add(this, true);\n\t\tbase.reflowable.add(this);\n\t}\n\n\tonReflow(base: DBase, width: number, height: number): void {\n\t\tthis.clear();\n\t\tconst state = base.state;\n\t\tconst border = base.border;\n\t\tconst borderColor = border.getColor(state);\n\t\tif (borderColor != null) {\n\t\t\tconst borderAlpha = border.getAlpha(state);\n\t\t\tconst borderWidth = border.getWidth(state);\n\t\t\tconst borderAlign = border.getAlign(state);\n\t\t\tthis.beginFill(borderColor, borderAlpha);\n\t\t\tthis.lineStyle(0, 0, 0, 0);\n\t\t\tthis.drawRect(0, borderAlign * (height - borderWidth), width, borderWidth);\n\t\t\tthis.endFill();\n\t\t\tthis.visible = true;\n\t\t} else {\n\t\t\tthis.visible = false;\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DScrollBarThumb } from \"./d-scroll-bar-thumb\";\nimport { DScrollBarThumbReflowableHorizontal } from \"./d-scroll-bar-thumb-reflowable-horizontal\";\n\nexport class DScrollBarThumbHorizontal extends DScrollBarThumb {\n\tprotected onGestureMove(dx: number, dy: number): void {\n\t\tthis.emit(\"regionmove\", dx, this);\n\t}\n\n\tprotected initReflowable(): void {\n\t\tnew DScrollBarThumbReflowableHorizontal(this);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction } from \"pixi.js\";\nimport InteractionEvent = interaction.InteractionEvent;\nimport { DScrollBar, DScrollBarOptions, DThemeScrollBar } from \"./d-scroll-bar\";\nimport { DScrollBarThumb, DScrollBarThumbOptions } from \"./d-scroll-bar-thumb\";\nimport { DScrollBarThumbHorizontal } from \"./d-scroll-bar-thumb-horizontal\";\n\nexport class DScrollBarHorizontal<\n\tTHEME extends DThemeScrollBar = DThemeScrollBar,\n\tOPTIONS extends DScrollBarOptions<THEME> = DScrollBarOptions<THEME>\n> extends DScrollBar<THEME, OPTIONS> {\n\tconstructor(options?: OPTIONS) {\n\t\tsuper(options);\n\t\tthis._thumb.on(\"regionmove\", (x: number): void => {\n\t\t\tthis.onThumbRegionMove(x);\n\t\t});\n\t}\n\n\tprotected onThumbRegionMove(x: number): void {\n\t\tconst width = this.width;\n\t\tif (0 < width) {\n\t\t\tconst size = this._end - this._start;\n\t\t\tconst newStart = Math.min(1 - size, Math.max(0, x / width));\n\t\t\tif (this._start !== newStart) {\n\t\t\t\tthis.emit(\"regionmove\", newStart, this);\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected onDownThis(e: InteractionEvent): void {\n\t\tsuper.onDownThis(e);\n\n\t\tconst width = this.width;\n\t\tif (0 < width) {\n\t\t\tconst size = this._end - this._start;\n\t\t\tconst position = e.data.getLocalPosition(this);\n\t\t\tconst newStart = Math.min(1 - size, Math.max(0, position.x / width - size * 0.5));\n\t\t\tif (this._start !== newStart) {\n\t\t\t\tthis.emit(\"regionmove\", newStart, this);\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected newThumb(options?: DScrollBarThumbOptions): DScrollBarThumb {\n\t\treturn new DScrollBarThumbHorizontal(options);\n\t}\n\n\tprotected updateThumb(width: number, height: number): void {\n\t\tconst thumb = this._thumb;\n\t\tconst thumbMinimumLength = Math.min(width * 0.5, thumb.getMinimumLength());\n\t\tconst space = width - thumbMinimumLength;\n\t\tconst barStart = space * this._start;\n\t\tconst barLength = space * this._end + thumbMinimumLength - barStart;\n\n\t\tthumb.position.set(barStart, 0);\n\t\tthumb.resize(barLength, height);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Graphics } from \"pixi.js\";\nimport { DBase } from \"./d-base\";\nimport { DBaseReflowable } from \"./d-base-reflowable\";\n\nexport class DScrollBarThumbReflowableVertical extends Graphics implements DBaseReflowable {\n\tconstructor(base: DBase) {\n\t\tsuper();\n\t\tbase.snippet.add(this, true);\n\t\tbase.reflowable.add(this);\n\t}\n\n\tonReflow(base: DBase, width: number, height: number): void {\n\t\tthis.clear();\n\t\tconst state = base.state;\n\t\tconst border = base.border;\n\t\tconst borderColor = border.getColor(state);\n\t\tif (borderColor != null) {\n\t\t\tconst borderAlpha = border.getAlpha(state);\n\t\t\tconst borderWidth = border.getWidth(state);\n\t\t\tconst borderAlign = border.getAlign(state);\n\t\t\tthis.beginFill(borderColor, borderAlpha);\n\t\t\tthis.lineStyle(0, 0, 0, 0);\n\t\t\tthis.drawRect(borderAlign * (width - borderWidth), 0, borderWidth, height);\n\t\t\tthis.endFill();\n\t\t\tthis.visible = true;\n\t\t} else {\n\t\t\tthis.visible = false;\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DScrollBarThumb } from \"./d-scroll-bar-thumb\";\nimport { DScrollBarThumbReflowableVertical } from \"./d-scroll-bar-thumb-reflowable-vertical\";\n\nexport class DScrollBarThumbVertical extends DScrollBarThumb {\n\tprotected onGestureMove(dx: number, dy: number): void {\n\t\tthis.emit(\"regionmove\", dy, this);\n\t}\n\n\tprotected initReflowable(): void {\n\t\tnew DScrollBarThumbReflowableVertical(this);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction } from \"pixi.js\";\nimport InteractionEvent = interaction.InteractionEvent;\nimport { DScrollBar, DScrollBarOptions, DThemeScrollBar } from \"./d-scroll-bar\";\nimport { DScrollBarThumb, DScrollBarThumbOptions } from \"./d-scroll-bar-thumb\";\nimport { DScrollBarThumbVertical } from \"./d-scroll-bar-thumb-vertical\";\n\nexport class DScrollBarVertical<\n\tTHEME extends DThemeScrollBar = DThemeScrollBar,\n\tOPTIONS extends DScrollBarOptions<THEME> = DScrollBarOptions<THEME>\n> extends DScrollBar<THEME, OPTIONS> {\n\tconstructor(options?: OPTIONS) {\n\t\tsuper(options);\n\t\tthis._thumb.on(\"regionmove\", (y: number): void => {\n\t\t\tthis.onThumbRegionMove(y);\n\t\t});\n\t}\n\n\tprotected onThumbRegionMove(y: number): void {\n\t\tconst height = this.height;\n\t\tif (0 < height) {\n\t\t\tconst size = this._end - this._start;\n\t\t\tconst newStart = Math.min(1 - size, Math.max(0, y / height));\n\t\t\tif (this._start !== newStart) {\n\t\t\t\tthis.emit(\"regionmove\", newStart, this);\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected onDownThis(e: InteractionEvent): void {\n\t\tsuper.onDownThis(e);\n\n\t\tconst height = this.height;\n\t\tif (0 < height) {\n\t\t\tconst size = this._end - this._start;\n\t\t\tconst position = e.data.getLocalPosition(this);\n\t\t\tconst newStart = Math.min(1 - size, Math.max(0, position.y / height - size * 0.5));\n\t\t\tif (this._start !== newStart) {\n\t\t\t\tthis.emit(\"regionmove\", newStart, this);\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected newThumb(options?: DScrollBarThumbOptions): DScrollBarThumb {\n\t\treturn new DScrollBarThumbVertical(options);\n\t}\n\n\tprotected updateThumb(width: number, height: number): void {\n\t\tconst thumb = this._thumb;\n\t\tconst thumbMinimumLength = Math.min(height * 0.5, thumb.getMinimumLength());\n\t\tconst space = height - thumbMinimumLength;\n\t\tconst barStart = space * this._start;\n\t\tconst barLength = space * this._end + thumbMinimumLength - barStart;\n\n\t\tthumb.position.set(0, barStart);\n\t\tthumb.resize(width, barLength);\n\t}\n}\n","import { DApplicationTarget } from \"./d-application-like\";\nimport { DScrollBarOptions } from \"./d-scroll-bar\";\nimport { DScrollBarHorizontal } from \"./d-scroll-bar-horizontal\";\nimport { DScrollBarVertical } from \"./d-scroll-bar-vertical\";\n\nexport interface DPaneScrollBarOptions {\n\tvertical?: DScrollBarOptions;\n\thorizontal?: DScrollBarOptions;\n}\n\nexport interface DPaneScrollBarParent extends DApplicationTarget {\n\twidth: number;\n\theight: number;\n\tcontent: DPaneScrollBarContent;\n}\n\nexport interface DPaneScrollBarContent {\n\tx: number;\n\ty: number;\n\twidth: number;\n\theight: number;\n}\n\nexport class DPaneScrollBar<PARENT extends DPaneScrollBarParent = DPaneScrollBarParent> {\n\tprotected _parent: PARENT;\n\tprotected _onUpdate: (isRegionVisible: boolean) => void;\n\treadonly vertical: DScrollBarVertical;\n\treadonly horizontal: DScrollBarHorizontal;\n\n\tprotected _isLocked: number;\n\tprotected _isCalled: boolean;\n\tprotected _isCalledSilently?: boolean;\n\n\tconstructor(\n\t\tparent: PARENT,\n\t\toptions: DPaneScrollBarOptions | undefined,\n\t\tonUpdate: (isRegionVisible: boolean) => void\n\t) {\n\t\tthis._parent = parent;\n\t\tthis._onUpdate = onUpdate;\n\t\tthis._isLocked = 0;\n\t\tthis._isCalled = false;\n\t\tthis.vertical = new DScrollBarVertical(options?.vertical);\n\t\tthis.horizontal = new DScrollBarHorizontal(options?.horizontal);\n\t}\n\n\tlock(): void {\n\t\tthis._isLocked += 1;\n\t\tif (this._isLocked === 1) {\n\t\t\tthis._isCalled = false;\n\t\t\tthis._isCalledSilently = undefined;\n\t\t}\n\t}\n\n\tunlock(callIfNeeded: boolean): void {\n\t\tthis._isLocked -= 1;\n\t\tif (this._isLocked === 0) {\n\t\t\tif (callIfNeeded && this._isCalled) {\n\t\t\t\tthis.update(this._isCalledSilently);\n\t\t\t}\n\t\t\tthis._isCalled = false;\n\t\t\tthis._isCalledSilently = undefined;\n\t\t}\n\t}\n\n\tupdate(silently?: boolean): void {\n\t\tif (0 < this._isLocked) {\n\t\t\tthis._isCalled = true;\n\t\t\tif (silently != null) {\n\t\t\t\tthis._isCalledSilently ||= silently;\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tconst parent = this._parent;\n\t\tconst width = parent.width;\n\t\tconst height = parent.height;\n\t\tconst content = parent.content;\n\t\tconst x = -content.x;\n\t\tconst y = -content.y;\n\n\t\tconst vertical = this.vertical;\n\t\tconst verticalWidth = vertical.width;\n\t\tconst verticalOffsetStart = this.getOffsetVerticalStart(verticalWidth);\n\t\tconst verticalOffsetEnd = this.getOffsetVerticalEnd(verticalWidth);\n\t\tvertical.set(y, y + height, content.height, silently);\n\t\tvertical.position.set(width - verticalWidth, verticalOffsetStart);\n\t\tvertical.height = height - verticalOffsetStart - verticalOffsetEnd;\n\n\t\tconst horizontal = this.horizontal;\n\t\tconst horizontalHeight = horizontal.height;\n\t\tconst horizontalOffsetStart = this.getOffsetHorizontalStart(horizontalHeight);\n\t\tconst horizontalOffsetEnd = this.getOffsetHorizontalEnd(horizontalHeight);\n\t\thorizontal.set(x, x + width, content.width, silently);\n\t\thorizontal.position.set(horizontalOffsetStart, height - horizontalHeight);\n\t\thorizontal.width = width - horizontalOffsetStart - horizontalOffsetEnd;\n\n\t\tthis._onUpdate(vertical.isRegionVisible() || horizontal.isRegionVisible());\n\t}\n\n\tprotected getOffsetHorizontalStart(size: number): number {\n\t\treturn size * 0.5;\n\t}\n\n\tprotected getOffsetHorizontalEnd(size: number): number {\n\t\treturn size * 0.5;\n\t}\n\n\tprotected getOffsetVerticalStart(size: number): number {\n\t\treturn size * 0.5;\n\t}\n\n\tprotected getOffsetVerticalEnd(size: number): number {\n\t\treturn size * 0.5;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Point, Rectangle } from \"pixi.js\";\nimport { DApplications } from \"./d-applications\";\nimport { DBase, DBaseOptions, DThemeBase } from \"./d-base\";\nimport { DBaseOverflowMask } from \"./d-base-overflow-mask\";\nimport { DContent, DContentOptions } from \"./d-content\";\nimport { UtilGestureMode } from \"./util/util-gesture-mode\";\nimport { DScrollBar } from \"./d-scroll-bar\";\nimport { toEnum } from \"./util/to-enum\";\nimport { UtilGesture } from \"./util/util-gesture\";\nimport { UtilWheelEventDeltas } from \"./util/util-wheel-event\";\nimport { DPaneScrollBar, DPaneScrollBarOptions } from \"./d-pane-scrollbar\";\n\n/**\n * {@link DPane} gesture options.\n */\nexport interface DPaneGestureOptions {\n\tmode?: keyof typeof UtilGestureMode | UtilGestureMode;\n}\n\n/**\n * {@link DPane} options.\n */\nexport interface DPaneOptions<\n\tTHEME extends DThemePane = DThemePane,\n\tCONTENT_OPTIONS extends DBaseOptions = DContentOptions\n> extends DBaseOptions<THEME> {\n\t/**\n\t * True to enable an overflow mask.\n\t */\n\tmask?: boolean;\n\n\t/**\n\t * Content options or a content.\n\t */\n\tcontent?: CONTENT_OPTIONS | DBase;\n\n\t/**\n\t * Scroll bar options.\n\t */\n\tscrollbar?: DPaneScrollBarOptions;\n\n\t/**\n\t * Gesture options.\n\t */\n\tgesture?: DPaneGestureOptions;\n}\n\nexport interface DThemePane extends DThemeBase {\n\tisOverflowMaskEnabled(): boolean;\n\tgetWheelSpeed(): number;\n\tgetGestureMode(): UtilGestureMode;\n}\n\n// Class\nexport class DPane<\n\tTHEME extends DThemePane = DThemePane,\n\tCONTENT_OPTIONS extends DBaseOptions = DContentOptions,\n\tOPTIONS extends DPaneOptions<THEME, CONTENT_OPTIONS> = DPaneOptions<THEME, CONTENT_OPTIONS>\n> extends DBase<THEME, OPTIONS> {\n\tprotected static WORK_POINT?: Point;\n\tprotected static WORK_RECTANGLE?: Rectangle;\n\n\tprotected _content?: DBase;\n\tprotected _overflowMask?: DBaseOverflowMask | null;\n\tprotected _scrollbar?: DPaneScrollBar;\n\tprotected _gestureUtil?: UtilGesture<DPane>;\n\n\tconstructor(options?: OPTIONS) {\n\t\tsuper(options);\n\n\t\t// Mask\n\t\tconst theme = this.theme;\n\t\tif (options?.mask ?? theme.isOverflowMaskEnabled()) {\n\t\t\tthis.mask = this.getOverflowMask();\n\t\t}\n\n\t\t// Content\n\t\tthis.addChild(this.content);\n\n\t\t// Scroll bar\n\t\tconst scrollbar = this.scrollbar;\n\t\tthis.addChild(scrollbar.vertical);\n\t\tthis.addChild(scrollbar.horizontal);\n\t\tscrollbar.update();\n\n\t\t// Gesture\n\t\tthis.initGesture(theme, options);\n\t}\n\n\tprotected initGesture(theme: THEME, options?: OPTIONS): void {\n\t\t// Edge does not fire the wheel event when scrolling using the 2-fingure scroll gesture on a touchpad.\n\t\t// Instead, it fires touch events. This is why the gesture is enabled regardless of the `UtilPointerEvent.touchable`.\n\t\t// https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/7134034/\n\t\tconst mode = toEnum(options?.gesture?.mode ?? theme.getGestureMode(), UtilGestureMode);\n\t\tif (mode === UtilGestureMode.ON || mode === UtilGestureMode.TOUCH) {\n\t\t\tconst position = new Point();\n\t\t\tconst content = this.content;\n\t\t\tthis._gestureUtil = new UtilGesture<DPane>({\n\t\t\t\tbind: this,\n\t\t\t\ttouch: mode === UtilGestureMode.TOUCH,\n\t\t\t\ton: {\n\t\t\t\t\tstart: (): void => {\n\t\t\t\t\t\tposition.copyFrom(content.position);\n\t\t\t\t\t},\n\t\t\t\t\tmove: (target: DPane, dx: number, dy: number): void => {\n\t\t\t\t\t\tposition.set(position.x + dx, position.y + dy);\n\t\t\t\t\t\tcontent.position.set(\n\t\t\t\t\t\t\tthis.toContentX(content, position.x),\n\t\t\t\t\t\t\tthis.toContentY(content, position.y)\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tget scrollbar(): DPaneScrollBar {\n\t\tlet result = this._scrollbar;\n\t\tif (result == null) {\n\t\t\tresult = this.newScrollBar(this._options?.scrollbar);\n\t\t\tthis.initScrollBar(result);\n\t\t\tthis._scrollbar = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected newScrollBar(options?: DPaneScrollBarOptions): DPaneScrollBar {\n\t\treturn new DPaneScrollBar(this, options, (isRegionVisible: boolean): void => {\n\t\t\tthis.onScrollBarUpdate(isRegionVisible);\n\t\t});\n\t}\n\n\tprotected onScrollBarUpdate(isRegionVisible: boolean): void {\n\t\tconst overflowMask = this._overflowMask;\n\t\tif (overflowMask != null) {\n\t\t\tconst content = this.content;\n\t\t\tif (isRegionVisible) {\n\t\t\t\tif (content.mask !== overflowMask) {\n\t\t\t\t\tcontent.mask = overflowMask;\n\t\t\t\t\tDApplications.update(this);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (content.mask) {\n\t\t\t\t\t(content as any).mask = null;\n\t\t\t\t\tDApplications.update(this);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected initScrollBar(scrollbar: DPaneScrollBar): void {\n\t\tscrollbar.vertical.on(\"regionmove\", (start: number): void => {\n\t\t\tthis.onScrollBarMoveY(start);\n\t\t});\n\t\tscrollbar.horizontal.on(\"regionmove\", (start: number): void => {\n\t\t\tthis.onScrollBarMoveX(start);\n\t\t});\n\t}\n\n\tprotected onScrollBarMoveX(start: number): void {\n\t\tconst gestureUtil = this._gestureUtil;\n\t\tif (gestureUtil != null) {\n\t\t\tgestureUtil.stop(this);\n\t\t}\n\t\tconst content = this.content;\n\t\tcontent.x = -content.width * start;\n\t}\n\n\tprotected onScrollBarMoveY(start: number): void {\n\t\tconst gestureUtil = this._gestureUtil;\n\t\tif (gestureUtil != null) {\n\t\t\tgestureUtil.stop(this);\n\t\t}\n\t\tconst content = this.content;\n\t\tcontent.y = -content.height * start;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DPane\";\n\t}\n\n\tget content(): DBase {\n\t\tlet result = this._content;\n\t\tif (result == null) {\n\t\t\tresult = this.toContent(this._options);\n\t\t\tthis.initContent(result);\n\t\t\tthis._content = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected toContent(options?: OPTIONS): DBase {\n\t\tconst content = options?.content;\n\t\tif (content) {\n\t\t\tif (content instanceof DBase) {\n\t\t\t\treturn content;\n\t\t\t} else {\n\t\t\t\treturn this.newContent(content);\n\t\t\t}\n\t\t}\n\t\treturn this.newContent();\n\t}\n\n\tprotected newContent(options?: CONTENT_OPTIONS): DBase {\n\t\treturn new DContent(options);\n\t}\n\n\tprotected initContent(content: DBase): void {\n\t\tcontent.on(\"move\", (): void => {\n\t\t\tthis.onContentChange();\n\t\t});\n\t\tcontent.on(\"resize\", (): void => {\n\t\t\tthis.onContentChange();\n\t\t});\n\t}\n\n\tprotected getOverflowMask(): DBaseOverflowMask {\n\t\tlet result = this._overflowMask;\n\t\tif (result == null) {\n\t\t\tresult = new DBaseOverflowMask(this);\n\t\t\tthis._overflowMask = result;\n\t\t\tthis.reflowable.add(result);\n\t\t\tthis.toDirty();\n\t\t}\n\t\treturn result;\n\t}\n\n\tonWheel(e: WheelEvent, deltas: UtilWheelEventDeltas, global: Point): boolean {\n\t\tconst content = this.content;\n\t\tconst x = this.getWheelContentX(content, deltas.deltaX * deltas.lowest);\n\t\tconst y = this.getWheelContentY(content, deltas.deltaY * deltas.lowest);\n\t\tif (content.x !== x || content.y !== y) {\n\t\t\tconst gestureUtil = this._gestureUtil;\n\t\t\tif (gestureUtil != null) {\n\t\t\t\tgestureUtil.stop(this);\n\t\t\t}\n\t\t\tcontent.position.set(x, y);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tprotected getWheelContentX(content: DBase, delta: number): number {\n\t\tif (0 < delta || delta < 0) {\n\t\t\tconst speed = this.theme.getWheelSpeed();\n\t\t\treturn this.toContentX(content, content.x - delta * speed);\n\t\t}\n\t\treturn content.x;\n\t}\n\n\tprotected getWheelContentY(content: DBase, delta: number): number {\n\t\tif (0 < delta || delta < 0) {\n\t\t\tconst speed = this.theme.getWheelSpeed();\n\t\t\treturn this.toContentY(content, content.y + delta * speed);\n\t\t}\n\t\treturn content.y;\n\t}\n\n\tprotected toContentX(content: DBase, x: number): number {\n\t\treturn Math.min(0, Math.max(this.width - content.width, x));\n\t}\n\n\tprotected toContentY(content: DBase, y: number): number {\n\t\treturn Math.min(0, Math.max(this.height - content.height, y));\n\t}\n\n\tprotected isRefitable(target: any): target is DBase<any, any> {\n\t\treturn super.isRefitable(target) && !(target instanceof DScrollBar);\n\t}\n\n\tonResize(newWidth: number, newHeight: number, oldWidth: number, oldHeight: number): void {\n\t\tconst scrollbar = this.scrollbar;\n\t\tscrollbar.lock();\n\t\tsuper.onResize(newWidth, newHeight, oldWidth, oldHeight);\n\t\tscrollbar.update();\n\t\tscrollbar.unlock(true);\n\t}\n\n\tprotected onContentChange(): void {\n\t\tthis.scrollbar.update();\n\t}\n\n\tprotected getFocusedChildClippingRect(\n\t\tfocused: DBase,\n\t\tcontentX: number,\n\t\tcontentY: number,\n\t\tcontentWidth: number,\n\t\tcontentHeight: number,\n\t\twidth: number,\n\t\theight: number,\n\t\tresult: Rectangle\n\t): Rectangle {\n\t\tresult.x = 0;\n\t\tresult.y = 0;\n\t\tresult.width = width;\n\t\tresult.height = height;\n\t\treturn result;\n\t}\n\n\tprotected onChildFocus(focused: DBase): void {\n\t\tconst point = DPane.WORK_POINT || new Point();\n\t\tDPane.WORK_POINT = point;\n\n\t\t// Content rectangle\n\t\tconst content = this.content;\n\t\tconst contentX = content.x;\n\t\tconst contentY = content.y;\n\t\tconst contentWidth = content.width;\n\t\tconst contentHeight = content.height;\n\n\t\tpoint.set(0, 0);\n\t\tfocused.toGlobal(point, point, false);\n\t\tcontent.toLocal(point, undefined, point, false);\n\t\tconst x0 = contentX + Math.min(contentWidth, Math.max(0, point.x));\n\t\tconst y0 = contentY + Math.min(contentHeight, Math.max(0, point.y));\n\n\t\tpoint.set(focused.width, focused.height);\n\t\tfocused.toGlobal(point, point, true);\n\t\tcontent.toLocal(point, undefined, point, true);\n\t\tconst x1 = contentX + Math.min(contentWidth, Math.max(0, point.x));\n\t\tconst y1 = contentY + Math.min(contentHeight, Math.max(0, point.y));\n\n\t\tconst width = this.width;\n\t\tconst height = this.height;\n\t\tconst clippingRect = DPane.WORK_RECTANGLE || new Rectangle();\n\t\tDPane.WORK_RECTANGLE = clippingRect;\n\t\tthis.getFocusedChildClippingRect(\n\t\t\tfocused,\n\t\t\tcontentX,\n\t\t\tcontentY,\n\t\t\tcontentWidth,\n\t\t\tcontentHeight,\n\t\t\twidth,\n\t\t\theight,\n\t\t\tclippingRect\n\t\t);\n\t\tconst clippingRectX = clippingRect.x;\n\t\tconst clippingRectY = clippingRect.y;\n\t\tconst clippingRectX0 = clippingRectX;\n\t\tconst clippingRectY0 = clippingRectY;\n\t\tconst clippingRectX1 = clippingRectX + clippingRect.width;\n\t\tconst clippingRectY1 = clippingRectY + clippingRect.height;\n\n\t\tlet newX: number | null = null;\n\t\tif (x0 < clippingRectX0) {\n\t\t\tif (x1 <= clippingRectX1) {\n\t\t\t\tnewX = contentX + Math.min(clippingRectX0 - x0, clippingRectX1 - x1);\n\t\t\t\tnewX = Math.max(width - contentWidth, Math.min(0, newX));\n\t\t\t}\n\t\t} else if (clippingRectX1 < x1) {\n\t\t\tnewX = contentX - Math.min(x0 - clippingRectX0, x1 - clippingRectX1);\n\t\t\tnewX = Math.max(width - contentWidth, Math.min(0, newX));\n\t\t}\n\n\t\tlet newY: number | null = null;\n\t\tif (y0 < clippingRectY0) {\n\t\t\tif (y1 <= clippingRectY1) {\n\t\t\t\tnewY = contentY + Math.min(clippingRectY0 - y0, clippingRectY1 - y1);\n\t\t\t\tnewY = Math.max(height - contentHeight, Math.min(0, newY));\n\t\t\t}\n\t\t} else if (clippingRectY1 < y1) {\n\t\t\tnewY = contentY - Math.min(y0 - clippingRectY0, y1 - clippingRectY1);\n\t\t\tnewY = Math.max(height - contentHeight, Math.min(0, newY));\n\t\t}\n\n\t\tconst contentPosition = content.position;\n\t\tif (newX != null) {\n\t\t\tif (newY != null) {\n\t\t\t\tcontentPosition.set(newX, newY);\n\t\t\t} else {\n\t\t\t\tcontentPosition.x = newX;\n\t\t\t}\n\t\t} else {\n\t\t\tif (newY != null) {\n\t\t\t\tcontentPosition.y = newY;\n\t\t\t}\n\t\t}\n\n\t\tsuper.onChildFocus(focused);\n\t}\n\n\tdestroy(): void {\n\t\t// Overflow mask\n\t\tconst overflowMask = this._overflowMask;\n\t\tif (overflowMask != null) {\n\t\t\tthis._overflowMask = null;\n\t\t\toverflowMask.destroy();\n\t\t}\n\t\t(this as any).mask = null;\n\n\t\tsuper.destroy();\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBase, DBaseOptions } from \"./d-base\";\nimport { DContentOptions } from \"./d-content\";\nimport { DListData, DListDataOptions } from \"./d-list-data\";\nimport { DListDataImpl } from \"./d-list-data-impl\";\nimport { DListDataSelection, DListDataSelectionOptions } from \"./d-list-data-selection\";\nimport { DPane, DPaneOptions, DThemePane } from \"./d-pane\";\nimport { isArray } from \"./util/is-array\";\nimport { DListItemUpdater, DListItemUpdaterOptions } from \"./d-list-item-updater\";\n\nexport interface DListOptions<\n\tVALUE = unknown,\n\tDATA extends DListData<VALUE> = DListData<VALUE>,\n\tTHEME extends DThemeList = DThemeList,\n\tCONTENT_OPTIONS extends DBaseOptions = DContentOptions\n> extends DPaneOptions<THEME, CONTENT_OPTIONS> {\n\titems?: VALUE[];\n\tdata?: VALUE[] | DListDataOptions<VALUE> | DATA;\n\tselection?: DListDataSelectionOptions<VALUE>;\n\tupdater?: DListItemUpdaterOptions<VALUE>;\n}\n\nexport interface DThemeList extends DThemePane {}\n\nexport class DList<\n\tVALUE = unknown,\n\tDATA extends DListData<VALUE> = DListData<VALUE>,\n\tTHEME extends DThemeList = DThemeList,\n\tCONTENT_OPTIONS extends DBaseOptions = DContentOptions,\n\tOPTIONS extends DListOptions<VALUE, DATA, THEME, CONTENT_OPTIONS> = DListOptions<\n\t\tVALUE,\n\t\tDATA,\n\t\tTHEME,\n\t\tCONTENT_OPTIONS\n\t>\n> extends DPane<THEME, CONTENT_OPTIONS, OPTIONS> {\n\tprotected _data?: DATA;\n\tprotected _updater?: DListItemUpdater<VALUE>;\n\n\tconstructor(options?: OPTIONS) {\n\t\tsuper(options);\n\t\tthis.update();\n\t}\n\n\tprotected get updater(): DListItemUpdater<VALUE> {\n\t\tlet result = this._updater;\n\t\tif (result == null) {\n\t\t\tresult = this.newUpdater(this.data, this.content, this._options);\n\t\t\tthis._updater = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected newUpdater(data: DATA, content: DBase, options?: OPTIONS): DListItemUpdater<VALUE> {\n\t\treturn new DListItemUpdater<VALUE>(data, content, content, options?.updater);\n\t}\n\n\tget data(): DATA {\n\t\tlet result = this._data;\n\t\tif (result == null) {\n\t\t\tresult = this.toData(this._options);\n\t\t\tthis._data = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected toData(options?: OPTIONS): DATA {\n\t\tconst data = options && (options.data || options.items);\n\t\tconst selection = options?.selection;\n\t\tif (data == null) {\n\t\t\tif (selection) {\n\t\t\t\treturn new DListDataImpl<VALUE>(this, {\n\t\t\t\t\tselection\n\t\t\t\t}) as any;\n\t\t\t} else {\n\t\t\t\treturn new DListDataImpl<VALUE>(this) as any;\n\t\t\t}\n\t\t} else if (isArray(data)) {\n\t\t\tif (selection) {\n\t\t\t\treturn new DListDataImpl<VALUE>(this, {\n\t\t\t\t\titems: data,\n\t\t\t\t\tselection\n\t\t\t\t}) as any;\n\t\t\t} else {\n\t\t\t\treturn new DListDataImpl<VALUE>(this, {\n\t\t\t\t\titems: data\n\t\t\t\t}) as any;\n\t\t\t}\n\t\t} else if (\"each\" in data) {\n\t\t\treturn data;\n\t\t} else {\n\t\t\tif (selection) {\n\t\t\t\tif (data.selection === undefined) {\n\t\t\t\t\tdata.selection = selection;\n\t\t\t\t}\n\t\t\t\treturn new DListDataImpl<VALUE>(this, data) as any;\n\t\t\t} else {\n\t\t\t\treturn new DListDataImpl<VALUE>(this, data) as any;\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected onContentChange(): void {\n\t\tsuper.onContentChange();\n\t\tthis.update();\n\t}\n\n\tonResize(newWidth: number, newHeight: number, oldWidth: number, oldHeight: number): void {\n\t\tconst updater = this.updater;\n\t\tupdater.lock();\n\t\tsuper.onResize(newWidth, newHeight, oldWidth, oldHeight);\n\t\tupdater.update();\n\t\tupdater.unlock(true);\n\t}\n\n\tget selection(): DListDataSelection<VALUE> {\n\t\treturn this.data.selection;\n\t}\n\n\tlock(): void {\n\t\tthis.updater.lock();\n\t}\n\n\tunlock(callIfNeeded: boolean): void {\n\t\tthis.updater.unlock(callIfNeeded);\n\t}\n\n\t/**\n\t * Updates items. If the `forcibly` is true, some dirty checkings for\n\t * avoiding unnecessary state changes are skipped.\n\t *\n\t * @param forcibly true to update forcibly\n\t */\n\tupdate(forcibly?: boolean): void {\n\t\tthis.updater.update(forcibly);\n\t}\n\n\tonKeyDown(e: KeyboardEvent): boolean {\n\t\tthis.updater.moveFocus(e, this, true, true);\n\t\treturn super.onKeyDown(e);\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DList\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBase, DBaseOptions } from \"./d-base\";\nimport { DContentOptions } from \"./d-content\";\nimport { DDialogSelectListItemUpdater } from \"./d-dialog-select-list-item-updater\";\nimport { DList, DListOptions, DThemeList } from \"./d-list\";\nimport { DListData } from \"./d-list-data\";\n\nexport interface DDialogSelectListOptions<\n\tVALUE = unknown,\n\tDATA extends DListData<VALUE> = DListData<VALUE>,\n\tTHEME extends DThemeDialogSelecList = DThemeDialogSelecList,\n\tCONTENT_OPTIONS extends DBaseOptions = DContentOptions\n> extends DListOptions<VALUE, DATA, THEME, CONTENT_OPTIONS> {}\n\nexport interface DThemeDialogSelecList extends DThemeList {}\n\nexport class DDialogSelectList<\n\tVALUE = unknown,\n\tDATA extends DListData<VALUE> = DListData<VALUE>,\n\tTHEME extends DThemeDialogSelecList = DThemeDialogSelecList,\n\tCONTENT_OPTIONS extends DBaseOptions = DContentOptions,\n\tOPTIONS extends DDialogSelectListOptions<\n\t\tVALUE,\n\t\tDATA,\n\t\tTHEME,\n\t\tCONTENT_OPTIONS\n\t> = DDialogSelectListOptions<VALUE, DATA, THEME, CONTENT_OPTIONS>\n> extends DList<VALUE, DATA, THEME, CONTENT_OPTIONS, OPTIONS> {\n\tprotected newUpdater(\n\t\tdata: DATA,\n\t\tcontent: DBase,\n\t\toptions?: OPTIONS\n\t): DDialogSelectListItemUpdater<VALUE> {\n\t\treturn new DDialogSelectListItemUpdater<VALUE>(data, content, content, options?.updater);\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DDialogSelectList\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { utils } from \"pixi.js\";\n\nexport class DDialogSelectSearh<SEARCH_RESULT> extends utils.EventEmitter {\n\tprotected _search: (word: string) => Promise<SEARCH_RESULT[]>;\n\tprotected _id: number;\n\tprotected _idCompleted: number;\n\tprotected _result: SEARCH_RESULT[] | null;\n\n\tconstructor(search?: (word: string) => Promise<SEARCH_RESULT[]>) {\n\t\tsuper();\n\n\t\tthis._search = search || ((_: string) => Promise.resolve([]));\n\t\tthis._id = 0;\n\t\tthis._idCompleted = 0;\n\t\tthis._result = null;\n\t}\n\n\tcreate(args: [string]): void {\n\t\tconst id = ++this._id;\n\t\tthis._search(args[0]).then(\n\t\t\t(searchResult: SEARCH_RESULT[]) => {\n\t\t\t\tif (this._id === id) {\n\t\t\t\t\tthis._idCompleted = id;\n\t\t\t\t\tthis._result = searchResult;\n\t\t\t\t\tthis.emit(\"success\", this, searchResult);\n\t\t\t\t\tthis.emit(\"change\", this);\n\t\t\t\t}\n\t\t\t},\n\t\t\t() => {\n\t\t\t\tif (this._id === id) {\n\t\t\t\t\tthis._idCompleted = id;\n\t\t\t\t\tthis._result = null;\n\t\t\t\t\tthis.emit(\"fail\", this);\n\t\t\t\t\tthis.emit(\"change\", this);\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t\tthis.emit(\"change\", this);\n\t}\n\n\tisDone(): boolean {\n\t\treturn this._id === this._idCompleted;\n\t}\n\n\tgetResult(): SEARCH_RESULT[] | null {\n\t\treturn this._result;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DInputText, DInputTextOptions, DThemeInputText } from \"./d-input-text\";\n\nexport interface DInputSearchOptions<THEME extends DThemeInputSearch = DThemeInputSearch>\n\textends DInputTextOptions<THEME> {}\n\nexport interface DThemeInputSearch extends DThemeInputText {}\n\nexport class DInputSearch<\n\tTHEME extends DThemeInputSearch = DThemeInputSearch,\n\tOPTIONS extends DInputSearchOptions<THEME> = DInputSearchOptions<THEME>\n> extends DInputText<THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DInputSearch\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DImageBase, DImageBaseOptions, DThemeImageBase } from \"./d-image-base\";\n\nexport interface DNoteOptions<THEME extends DThemeNote = DThemeNote>\n\textends DImageBaseOptions<string, THEME> {}\n\nexport interface DThemeNote extends DThemeImageBase<string> {}\n\nexport class DNote<\n\tTHEME extends DThemeNote = DThemeNote,\n\tOPTIONS extends DNoteOptions<THEME> = DNoteOptions<THEME>\n> extends DImageBase<string, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DNote\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DNote, DNoteOptions, DThemeNote } from \"./d-note\";\n\nexport interface DNoteSmallOptions<THEME extends DThemeNoteSmall = DThemeNoteSmall>\n\textends DNoteOptions<THEME> {}\n\nexport interface DThemeNoteSmall extends DThemeNote {}\n\nexport class DNoteSmall<\n\tTHEME extends DThemeNoteSmall = DThemeNoteSmall,\n\tOPTIONS extends DNoteSmallOptions<THEME> = DNoteSmallOptions<THEME>\n> extends DNote<THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DNoteSmall\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DNoteSmall, DNoteSmallOptions, DThemeNoteSmall } from \"./d-note-small\";\n\nexport interface DNoteSmallErrorOptions<THEME extends DThemeNoteSmallError = DThemeNoteSmallError>\n\textends DNoteSmallOptions<THEME> {}\n\nexport interface DThemeNoteSmallError extends DThemeNoteSmall {}\n\nexport class DNoteSmallError<\n\tTHEME extends DThemeNoteSmallError = DThemeNoteSmallError,\n\tOPTIONS extends DNoteSmallErrorOptions<THEME> = DNoteSmallErrorOptions<THEME>\n> extends DNoteSmall<THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DNoteSmallError\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DNoteSmall, DNoteSmallOptions, DThemeNoteSmall } from \"./d-note-small\";\n\nexport interface DNoteSmallNoItemsFoundOptions<\n\tTHEME extends DThemeNoteSmallNoItemsFound = DThemeNoteSmallNoItemsFound\n> extends DNoteSmallOptions<THEME> {}\n\nexport interface DThemeNoteSmallNoItemsFound extends DThemeNoteSmall {}\n\nexport class DNoteSmallNoItemsFound<\n\tTHEME extends DThemeNoteSmallNoItemsFound = DThemeNoteSmallNoItemsFound,\n\tOPTIONS extends DNoteSmallNoItemsFoundOptions<THEME> = DNoteSmallNoItemsFoundOptions<THEME>\n> extends DNoteSmall<THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DNoteSmallNoItemsFound\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DNoteSmall, DNoteSmallOptions, DThemeNoteSmall } from \"./d-note-small\";\n\nexport interface DNoteSmallSearchingOptions<\n\tTHEME extends DThemeNoteSmallSearching = DThemeNoteSmallSearching\n> extends DNoteSmallOptions<THEME> {}\n\nexport interface DThemeNoteSmallSearching extends DThemeNoteSmall {}\n\nexport class DNoteSmallSearching<\n\tTHEME extends DThemeNoteSmallSearching = DThemeNoteSmallSearching,\n\tOPTIONS extends DNoteSmallSearchingOptions<THEME> = DNoteSmallSearchingOptions<THEME>\n> extends DNoteSmall<THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DNoteSmallSearching\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBase } from \"./d-base\";\nimport {\n\tDDialogCommand,\n\tDDialogCommandEvents,\n\tDDialogCommandOptions,\n\tDThemeDialogCommand\n} from \"./d-dialog-command\";\nimport { DDialogSelectList, DDialogSelectListOptions } from \"./d-dialog-select-list\";\nimport { DDialogSelectSearh } from \"./d-dialog-select-search\";\nimport { DInputSearch, DInputSearchOptions } from \"./d-input-search\";\nimport { DLayoutHorizontal, DLayoutHorizontalOptions } from \"./d-layout-horizontal\";\nimport { DLayoutSpace } from \"./d-layout-space\";\nimport { DLayoutVertical } from \"./d-layout-vertical\";\nimport { DListOptions } from \"./d-list\";\nimport { DListDataSelection } from \"./d-list-data-selection\";\nimport { DNote, DNoteOptions } from \"./d-note\";\nimport { DNoteSmallError } from \"./d-note-small-error\";\nimport { DNoteSmallNoItemsFound } from \"./d-note-small-no-items-found\";\nimport { DNoteSmallSearching } from \"./d-note-small-searching\";\nimport { DOnOptions } from \"./d-on-options\";\nimport { isNumber } from \"./util/is-number\";\nimport { UtilTransition } from \"./util/util-transition\";\n\nexport interface DDialogSelectInputMargin {\n\thorizontal: number;\n\tvertical: number;\n}\n\nexport interface DDialogSelectInputMarginOptions extends Partial<DDialogSelectInputMargin> {}\n\nexport interface DDialogSelectInputOpitons extends DInputSearchOptions {\n\tmargin?: DDialogSelectInputMarginOptions;\n}\n\n/**\n * {@link DDialogSelect} search object.\n */\nexport interface DDialogSelectSearch<VALUE> {\n\tcreate(args: [string]): void;\n\ton(event: \"success\", handler: (e: unknown, searchResults: VALUE[]) => void): void;\n\ton(event: \"fail\", handler: () => void): void;\n\ton(event: \"change\", handler: () => void): void;\n\tisDone(): boolean;\n\tgetResult(): VALUE[] | null;\n}\n\n/**\n * {@link DDialogSelect} search function.\n */\nexport type DDialogSelectSearchFunction<VALUE> = (word: string) => Promise<VALUE[]>;\n\n/**\n * {@link DDialogSelect} controller.\n */\nexport interface DDialogSelectController<VALUE> {\n\tsearch: DDialogSelectSearch<VALUE> | DDialogSelectSearchFunction<VALUE>;\n}\n\n/**\n * {@link DDialogSelect} note options.\n */\nexport interface DDialogSelectNoteOptions {\n\terror?: DNoteOptions | null;\n\tnoItemsFound?: DNoteOptions | null;\n\tsearching?: DNoteOptions | null;\n}\n\nexport type DDialogSelectItemToLabel<VALUE> = (result: VALUE, caller: any) => string;\n\nexport type DDialogSelectItemIsEqual<VALUE> = (a: VALUE, b: VALUE, caller: any) => boolean;\n\n/**\n * {@link DDialogSelect} events.\n */\nexport interface DDialogSelectEvents<VALUE, EMITTER> extends DDialogCommandEvents<VALUE, EMITTER> {\n\tselect(value: VALUE, self: EMITTER): void;\n}\n\n/**\n * {@link DDialogSelect} \"on\" options.\n */\nexport interface DDialogSelectOnOptions<VALUE, EMITTER>\n\textends Partial<DDialogSelectEvents<VALUE, EMITTER>>,\n\t\tDOnOptions {}\n\n/**\n * {@link DDialogSelect} options.\n */\nexport interface DDialogSelectOptions<\n\tVALUE,\n\tTHEME extends DThemeDialogSelect<VALUE> = DThemeDialogSelect<VALUE>,\n\tEMITTER = any\n> extends DDialogCommandOptions<VALUE, THEME> {\n\tcontroller?: DDialogSelectController<VALUE>;\n\tinput?: DDialogSelectInputOpitons;\n\tlist?: DListOptions<VALUE>;\n\tnote?: DDialogSelectNoteOptions;\n\ton?: DDialogSelectOnOptions<VALUE, EMITTER>;\n}\n\n/**\n * {@link DDialogSelect} theme.\n */\nexport interface DThemeDialogSelect<VALUE = unknown> extends DThemeDialogCommand {\n\tgetInputMarginVertical(): number;\n\tgetInputMarginHorizontal(): number;\n}\n\nexport class DDialogSelect<\n\tVALUE = unknown,\n\tTHEME extends DThemeDialogSelect<VALUE> = DThemeDialogSelect<VALUE>,\n\tOPTIONS extends DDialogSelectOptions<VALUE, THEME> = DDialogSelectOptions<VALUE, THEME>\n> extends DDialogCommand<VALUE | null, THEME, OPTIONS> {\n\tprotected _value!: VALUE | null;\n\tprotected _input!: DInputSearch;\n\tprotected _list!: DDialogSelectList<VALUE>;\n\tprotected _search!: DDialogSelectSearch<VALUE>;\n\tprotected _noteError?: DNote | null;\n\tprotected _noteNoItemsFound?: DNote | null;\n\tprotected _noteSearching?: DNote | null;\n\n\tprotected onInit(layout: DLayoutVertical, options?: OPTIONS): void {\n\t\tthis._value = null;\n\t\tconst theme = this.theme;\n\n\t\t// Search box\n\t\tconst input = this.newInput(theme, options);\n\t\tthis._input = input;\n\t\tlayout.addChild(this.newInputLayout(layout, input, theme, options));\n\n\t\t// List\n\t\tconst list = this.newList(theme, options);\n\t\tthis._list = list;\n\t\tlayout.addChild(list);\n\n\t\t// Error note\n\t\tconst noteOptions = options?.note;\n\t\tconst noteError = this.newNoteError(list, noteOptions);\n\t\tthis._noteError = noteError;\n\n\t\t// No items found note\n\t\tconst noteNoItemsFound = this.newNoteNoItemsFound(list, noteOptions);\n\t\tthis._noteNoItemsFound = noteNoItemsFound;\n\n\t\t// Searching note\n\t\tconst noteSearching = this.newNoteSearching(list, noteOptions);\n\t\tthis._noteSearching = noteSearching;\n\n\t\t// Controller binding\n\t\tconst search = this.toSearch(options?.controller);\n\t\tthis._search = search;\n\t\tinput.on(\"input\", (value: string): void => {\n\t\t\tsearch.create([value]);\n\t\t});\n\n\t\tsearch.on(\"success\", (e: unknown, results: VALUE[]): void => {\n\t\t\tthis.onSearched(results);\n\t\t});\n\t\tsearch.on(\"fail\", (): void => {\n\t\t\tthis.onSearched([]);\n\t\t});\n\n\t\t// Visibility\n\t\tconst transition = new UtilTransition();\n\t\tsearch.on(\"change\", (): void => {\n\t\t\tif (search.isDone()) {\n\t\t\t\tconst result = search.getResult();\n\t\t\t\tif (result != null) {\n\t\t\t\t\tif (0 < result.length) {\n\t\t\t\t\t\ttransition.hide();\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttransition.show(noteNoItemsFound);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\ttransition.show(noteError);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (noteSearching) {\n\t\t\t\t\ttransition.show(noteSearching);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tprotected newInput(theme: THEME, options?: OPTIONS): DInputSearch {\n\t\treturn new DInputSearch(this.toInputOptions(theme, options));\n\t}\n\n\tprotected toInputOptions(theme: THEME, options?: OPTIONS): DInputSearchOptions {\n\t\tconst result = options?.input || {};\n\t\tif (result.width === undefined && result.weight === undefined) {\n\t\t\tresult.weight = 1;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected newInputLayout(\n\t\tlayout: DLayoutHorizontal | DLayoutVertical,\n\t\tinput: DInputSearch,\n\t\ttheme: THEME,\n\t\toptions: OPTIONS | undefined\n\t): DLayoutHorizontal {\n\t\treturn new DLayoutHorizontal(this.toInputLayoutOptions(layout, input, theme, options));\n\t}\n\n\tprotected toInputLayoutOptions(\n\t\tlayout: DLayoutHorizontal | DLayoutVertical,\n\t\tinput: DInputSearch,\n\t\ttheme: THEME,\n\t\toptions: OPTIONS | undefined\n\t): DLayoutHorizontalOptions {\n\t\tconst margin = this.toInputMargin(theme, options);\n\t\tconst marginHorizontal = margin.horizontal;\n\t\tconst marginVertical = margin.vertical + this.padding.getTop() - layout.margin.vertical;\n\t\treturn {\n\t\t\twidth: \"padding\",\n\t\t\theight: \"auto\",\n\t\t\tpadding: {\n\t\t\t\tbottom: Math.max(0, marginVertical)\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tnew DLayoutSpace({ width: marginHorizontal }),\n\t\t\t\tinput,\n\t\t\t\tnew DLayoutSpace({ width: marginHorizontal })\n\t\t\t]\n\t\t};\n\t}\n\n\tprotected toInputMargin(theme: THEME, options?: OPTIONS): DDialogSelectInputMargin {\n\t\tconst margin = options?.input?.margin;\n\t\tif (margin != null) {\n\t\t\tif (isNumber(margin)) {\n\t\t\t\treturn {\n\t\t\t\t\thorizontal: margin,\n\t\t\t\t\tvertical: margin\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tconst horizontal = margin.horizontal;\n\t\t\t\tconst vertical = margin.vertical;\n\t\t\t\treturn {\n\t\t\t\t\thorizontal: horizontal ?? theme.getInputMarginHorizontal(),\n\t\t\t\t\tvertical: vertical ?? theme.getInputMarginVertical()\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t\treturn {\n\t\t\thorizontal: theme.getInputMarginHorizontal(),\n\t\t\tvertical: theme.getInputMarginVertical()\n\t\t};\n\t}\n\n\tprotected toListOptions(theme: THEME, options?: OPTIONS): DDialogSelectListOptions<VALUE> {\n\t\tconst result = options?.list || {};\n\t\tif (result.width === undefined) {\n\t\t\tresult.width = \"padding\";\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected newList(theme: THEME, options?: OPTIONS): DDialogSelectList<VALUE> {\n\t\tconst result = new DDialogSelectList<VALUE>(this.toListOptions(theme, options));\n\t\tresult.selection.on(\"change\", (selection: DListDataSelection<VALUE>): void => {\n\t\t\tconst first = selection.first;\n\t\t\tif (first != null) {\n\t\t\t\tthis._value = first;\n\t\t\t\tthis.onOk(first);\n\t\t\t}\n\t\t});\n\t\treturn result;\n\t}\n\n\tprotected toNoteOptions(parent: DBase, options?: DNoteOptions): DNoteOptions {\n\t\tif (options != null) {\n\t\t\tif (options.parent == null) {\n\t\t\t\toptions.parent = parent;\n\t\t\t}\n\t\t\tif (options.visible == null) {\n\t\t\t\toptions.visible = false;\n\t\t\t}\n\t\t\treturn options;\n\t\t}\n\t\treturn {\n\t\t\tparent,\n\t\t\tvisible: false\n\t\t};\n\t}\n\n\tprotected newNoteError(\n\t\tlist: DDialogSelectList<VALUE>,\n\t\toptions?: DDialogSelectNoteOptions\n\t): DNote | null | undefined {\n\t\tconst error = options?.error;\n\t\tif (error !== null) {\n\t\t\treturn new DNoteSmallError(this.toNoteOptions(list, error));\n\t\t}\n\t\treturn null;\n\t}\n\n\tprotected newNoteNoItemsFound(\n\t\tlist: DDialogSelectList<VALUE>,\n\t\toptions?: DDialogSelectNoteOptions\n\t): DNote | null | undefined {\n\t\tconst noItemsFound = options?.noItemsFound;\n\t\tif (noItemsFound !== null) {\n\t\t\treturn new DNoteSmallNoItemsFound(this.toNoteOptions(list, noItemsFound));\n\t\t}\n\t\treturn null;\n\t}\n\n\tprotected newNoteSearching(\n\t\tlist: DDialogSelectList<VALUE>,\n\t\toptions?: DDialogSelectNoteOptions\n\t): DNote | null | undefined {\n\t\tconst searching = options?.searching;\n\t\t// Because the `searcing` note is disabled by default,\n\t\t// if options.searching is missing, i.e., if its value is undefined,\n\t\t// this method returns null. This is why `!=` is used here instead of `!==`.\n\t\tif (searching != null) {\n\t\t\treturn new DNoteSmallSearching(this.toNoteOptions(list, searching));\n\t\t}\n\t\treturn null;\n\t}\n\n\tprotected toSearch(controller?: DDialogSelectController<VALUE>): DDialogSelectSearch<VALUE> {\n\t\tif (controller) {\n\t\t\tconst search = controller.search;\n\t\t\tif (\"create\" in search) {\n\t\t\t\treturn search;\n\t\t\t} else {\n\t\t\t\treturn new DDialogSelectSearh(search);\n\t\t\t}\n\t\t} else {\n\t\t\treturn new DDialogSelectSearh();\n\t\t}\n\t}\n\n\tget input(): DInputSearch {\n\t\treturn this._input;\n\t}\n\n\tget list(): DDialogSelectList<VALUE> {\n\t\treturn this._list;\n\t}\n\n\tget value(): VALUE | null {\n\t\treturn this._value;\n\t}\n\n\tprotected onSearched(results: VALUE[]): void {\n\t\tthis._list.data.items = results;\n\t}\n\n\tprotected getResolvedValue(): VALUE | null | PromiseLike<VALUE | null> {\n\t\treturn this._value;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DDialogSelect\";\n\t}\n\n\tprotected onOpen(): void {\n\t\tsuper.onOpen();\n\t\tthis._list.selection.clear();\n\t\tthis._search.create([this._input.value]);\n\t}\n\n\tprotected onOk(value: VALUE | null | PromiseLike<VALUE | null>): void {\n\t\tthis.emit(\"select\", value, this);\n\t\tsuper.onOk(value);\n\t}\n\n\tdestroy(): void {\n\t\tthis._input.destroy();\n\t\tthis._noteError?.destroy();\n\t\tthis._noteNoItemsFound?.destroy();\n\t\tthis._noteSearching?.destroy();\n\t\tthis._list.destroy();\n\t\tsuper.destroy();\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction } from \"pixi.js\";\nimport { DButton, DButtonEvents, DButtonOptions, DThemeButton } from \"./d-button\";\nimport { DDialogSelect, DDialogSelectOptions } from \"./d-dialog-select\";\nimport { DOnOptions } from \"./d-on-options\";\n\n/**\n * A dialog to select values.\n */\nexport interface DButtonSelectDialog<VALUE> {\n\treadonly value: VALUE | null;\n\topen(): Promise<unknown>;\n}\n\n/**\n * A function to retrieve a selected value from a dialog.\n */\nexport type DButtonSelectGetter<VALUE, DIALOG> = (dialog: DIALOG) => VALUE | null;\n\n/**\n * A function to set a selecte value to a dialog.\n * Called before opening a dialog.\n */\nexport type DButtonSelectSetter<VALUE, DIALOG> = (dialog: DIALOG, value: VALUE | null) => void;\n\n/**\n * {@link DButtonSelect} events.\n */\nexport interface DButtonSelectEvents<VALUE, EMITTER> extends DButtonEvents<VALUE, EMITTER> {\n\t/**\n\t * Triggered when a selection is changed.\n\t *\n\t * @param newValue a newly selected value\n\t * @param oldValue a previously selected value\n\t * @param emitter an emitter\n\t */\n\tchange(newValue: VALUE | null, oldValue: VALUE | null, emitter: EMITTER): void;\n}\n\n/**\n * {@link DButtonSelect} \"on\" options.\n */\nexport interface DButtonSelectOnOptions<VALUE, EMITTER>\n\textends Partial<DButtonSelectEvents<VALUE, EMITTER>>,\n\t\tDOnOptions {}\n\n/**\n * {@link DButtonSelect} options.\n */\nexport interface DButtonSelectOptions<\n\tVALUE extends unknown = unknown,\n\tDIALOG_VALUE extends unknown = unknown,\n\tDIALOG extends DButtonSelectDialog<DIALOG_VALUE> = DButtonSelectDialog<DIALOG_VALUE>,\n\tTHEME extends DThemeButtonSelect<VALUE> = DThemeButtonSelect<VALUE>,\n\tEMITTER = any\n> extends DButtonOptions<VALUE | null, THEME, EMITTER> {\n\t/**\n\t * A function to retrieve a selected value from a dialog.\n\t */\n\tgetter?: DButtonSelectGetter<VALUE, DIALOG>;\n\n\t/**\n\t * A function to set a selected value to a dialog.\n\t * Called before opening a dialog.\n\t */\n\tsetter?: DButtonSelectSetter<VALUE, DIALOG>;\n\n\t/**\n\t * A dialog to select values.\n\t */\n\tdialog?: DDialogSelectOptions<DIALOG_VALUE> | DIALOG;\n\n\ton?: DButtonSelectOnOptions<VALUE, EMITTER>;\n}\n\n/**\n * {@link DButtonSelect} theme.\n */\nexport interface DThemeButtonSelect<VALUE = unknown> extends DThemeButton<VALUE | null> {}\n\nconst defaultGetter = (dialog: DButtonSelectDialog<any>): any => {\n\t// Assumes the dialog.value is VALUE.\n\treturn dialog.value;\n};\n\nconst defaultSetter = (): void => {\n\t// DO NOTHING\n};\n\nconst toOptions = <OPTIONS extends DButtonSelectOptions<any, any, any, any>>(\n\toptions?: OPTIONS\n): OPTIONS | undefined => {\n\tif (options) {\n\t\t// Try to copy text.formatter to dialog.item.text.formatter at first\n\t\tconst formatter = options.text?.formatter;\n\t\tif (formatter !== undefined) {\n\t\t\tlet dialog = options.dialog;\n\t\t\tif (!(dialog && \"open\" in dialog)) {\n\t\t\t\tdialog = dialog || {};\n\t\t\t\tconst item = (dialog.item = dialog.item || {});\n\t\t\t\tconst text = (item.text = item.text || {});\n\t\t\t\tif (text.formatter === undefined) {\n\t\t\t\t\t// Assumes formatter is ( value: DIALOG_VALUE | null, caller: any ) => string.\n\t\t\t\t\ttext.formatter = formatter as any;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\t// Try to copy dialog.item.text.formatter to text.formatter\n\t\t\tconst dialog = options.dialog;\n\t\t\tif (!(dialog && \"open\" in dialog)) {\n\t\t\t\tconst dialogFormatter = dialog?.item?.text?.formatter;\n\t\t\t\tif (dialogFormatter !== undefined) {\n\t\t\t\t\tconst text = options.text || {};\n\t\t\t\t\toptions.text = text;\n\t\t\t\t\tif (text.formatter === undefined) {\n\t\t\t\t\t\t// Assumes dialogFormatter is ( value: VALUE | null, caller: any ) => string.\n\t\t\t\t\t\ttext.formatter = dialogFormatter as any;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn options;\n};\n\nexport class DButtonSelect<\n\tVALUE extends unknown = unknown,\n\tDIALOG_VALUE extends unknown = unknown,\n\tDIALOG extends DButtonSelectDialog<DIALOG_VALUE> = DButtonSelectDialog<DIALOG_VALUE>,\n\tTHEME extends DThemeButtonSelect<VALUE> = DThemeButtonSelect<VALUE>,\n\tOPTIONS extends DButtonSelectOptions<VALUE, DIALOG_VALUE, DIALOG, THEME> = DButtonSelectOptions<\n\t\tVALUE,\n\t\tDIALOG_VALUE,\n\t\tDIALOG,\n\t\tTHEME\n\t>\n> extends DButton<VALUE | null, THEME, OPTIONS> {\n\tprotected _dialog?: DIALOG;\n\tprotected _dialogGetter: DButtonSelectGetter<VALUE, DIALOG>;\n\tprotected _dialogSetter: DButtonSelectSetter<VALUE, DIALOG>;\n\n\tconstructor(options?: OPTIONS) {\n\t\tsuper(toOptions(options));\n\t\tthis._dialogGetter = options?.getter ?? defaultGetter;\n\t\tthis._dialogSetter = options?.setter ?? defaultSetter;\n\t}\n\n\tprotected onActivate(\n\t\te?: interaction.InteractionEvent | KeyboardEvent | MouseEvent | TouchEvent\n\t): void {\n\t\tsuper.onActivate(e);\n\t\tconst dialog = this.dialog;\n\t\tconst oldValue = this._textValueComputed ?? null;\n\t\tthis._dialogSetter(dialog, oldValue);\n\t\tdialog.open().then((): void => {\n\t\t\tconst newValue = this._dialogGetter(dialog);\n\t\t\tif (newValue !== oldValue) {\n\t\t\t\tthis.text = newValue;\n\t\t\t\tthis.emit(\"change\", newValue, oldValue, this);\n\t\t\t}\n\t\t});\n\t}\n\n\tget dialog(): DIALOG {\n\t\tlet dialog = this._dialog;\n\t\tif (dialog == null) {\n\t\t\tconst options = this._options?.dialog;\n\t\t\tif (options && \"open\" in options) {\n\t\t\t\tdialog = options;\n\t\t\t} else {\n\t\t\t\t// Assumes DIALOG === DDialogSelect<DIALOG_VALUE>.\n\t\t\t\tdialog = new DDialogSelect<DIALOG_VALUE>(options) as any as DIALOG;\n\t\t\t}\n\t\t\tthis._dialog = dialog;\n\t\t}\n\t\treturn dialog;\n\t}\n\n\tget value(): VALUE | null {\n\t\treturn this._textValueComputed ?? null;\n\t}\n\n\tset value(value: VALUE | null) {\n\t\tthis.text = value;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DButtonSelect\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDialogTime } from \"./d-dialog-time\";\n\nexport class DDialogTimes {\n\tprotected static INSTANCE?: DDialogTime;\n\tstatic getInstance(): DDialogTime {\n\t\tif (DDialogTimes.INSTANCE == null) {\n\t\t\tDDialogTimes.INSTANCE = new DDialogTime();\n\t\t}\n\t\treturn DDialogTimes.INSTANCE;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction } from \"pixi.js\";\nimport { DButton, DButtonEvents, DButtonOptions, DThemeButton } from \"./d-button\";\nimport { DDialogTime, DDialogTimeOptions } from \"./d-dialog-time\";\nimport { DDialogTimes } from \"./d-dialog-times\";\nimport { DOnOptions } from \"./d-on-options\";\nimport { DPickerDatetimeMask } from \"./d-picker-datetime-mask\";\nimport { DPickerTimes } from \"./d-picker-times\";\n\n/**\n * {@link DButtonTime} events.\n */\nexport interface DButtonTimeEvents<EMITTER> extends DButtonEvents<Date, EMITTER> {\n\t/**\n\t * Triggered when a selection is changed.\n\t *\n\t * @param emitter an emitter\n\t */\n\tchange(newValue: Date, oldValue: Date, emitter: EMITTER): void;\n}\n\n/**\n * {@link DButtonTime} \"on\" options.\n */\nexport interface DButtonTimeOnOptions<EMITTER>\n\textends Partial<DButtonTimeEvents<EMITTER>>,\n\t\tDOnOptions {}\n\n/**\n * {@link DButtonTime} options.\n */\nexport interface DButtonTimeOptions<\n\tTHEME extends DThemeButtonTime = DThemeButtonTime,\n\tEMITTER = any\n> extends DButtonOptions<Date, THEME, EMITTER> {\n\tdialog?: DDialogTimeOptions;\n\ton?: DButtonTimeOnOptions<EMITTER>;\n}\n\n/**\n * {@link DButtonTime} theme.\n */\nexport interface DThemeButtonTime extends DThemeButton<Date> {}\n\nexport class DButtonTime<\n\tTHEME extends DThemeButtonTime = DThemeButtonTime,\n\tOPTIONS extends DButtonTimeOptions<THEME> = DButtonTimeOptions<THEME>\n> extends DButton<Date, THEME, OPTIONS> {\n\tprotected _dialog?: DDialogTime;\n\tprotected _datetimeMask?: DPickerDatetimeMask;\n\n\tprotected onActivate(\n\t\te?: interaction.InteractionEvent | KeyboardEvent | MouseEvent | TouchEvent\n\t): void {\n\t\tsuper.onActivate(e);\n\t\tconst value = this._textValueComputed?.getTime() ?? Date.now();\n\t\tconst dialog = this.dialog;\n\t\tdialog.current = new Date(value);\n\t\tdialog.new = new Date(value);\n\t\tdialog.open().then((): void => {\n\t\t\tconst newValue = dialog.new;\n\t\t\tconst oldValue = dialog.current;\n\t\t\tthis.text = new Date(newValue.getTime());\n\t\t\tthis.emit(\"change\", newValue, oldValue, this);\n\t\t});\n\t}\n\n\tgetDatetimeMask(): DPickerDatetimeMask {\n\t\tlet result = this._datetimeMask;\n\t\tif (result == null) {\n\t\t\tresult = DPickerTimes.toMask(this._options?.dialog?.picker);\n\t\t\tthis._datetimeMask = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tget dialog(): DDialogTime {\n\t\tlet dialog = this._dialog;\n\t\tif (dialog == null) {\n\t\t\tconst options = this._options?.dialog;\n\t\t\tif (options) {\n\t\t\t\tdialog = new DDialogTime(options);\n\t\t\t} else {\n\t\t\t\tdialog = DDialogTimes.getInstance();\n\t\t\t}\n\t\t\tthis._dialog = dialog;\n\t\t}\n\t\treturn dialog;\n\t}\n\n\tget value(): Date {\n\t\treturn this._textValueComputed ?? new Date();\n\t}\n\n\tset value(value: Date) {\n\t\tconst textValueComputed = this._textValueComputed;\n\t\tif (textValueComputed === undefined || textValueComputed.getTime() !== value.getTime()) {\n\t\t\tthis.text = value;\n\t\t}\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DButtonTime\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction } from \"pixi.js\";\nimport { DButton, DButtonOptions, DThemeButton } from \"./d-button\";\nimport { DControllers } from \"./d-controllers\";\n\nexport class DButtonUndo<\n\tVALUE = unknown,\n\tTHEME extends DThemeButton<VALUE> = DThemeButton<VALUE>,\n\tOPTIONS extends DButtonOptions<VALUE, THEME> = DButtonOptions<VALUE, THEME>\n> extends DButton<VALUE, THEME, OPTIONS> {\n\tconstructor(options?: OPTIONS) {\n\t\tsuper(options);\n\n\t\tconst state = this.state;\n\t\tconst commandController = DControllers.getCommandController();\n\t\tstate.isDisabled = !commandController.isUndoable();\n\t\tcommandController.on(\"change\", (): void => {\n\t\t\tstate.isDisabled = !commandController.isUndoable();\n\t\t});\n\t}\n\n\tprotected onActivate(\n\t\te?: interaction.InteractionEvent | KeyboardEvent | MouseEvent | TouchEvent\n\t): void {\n\t\tsuper.onActivate(e);\n\t\tDControllers.getCommandController().undo();\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBase, DBaseOptions, DThemeBase } from \"./d-base\";\n\nexport interface DCanvasOptions<THEME extends DThemeCanvas = DThemeCanvas>\n\textends DBaseOptions<THEME> {}\n\nexport interface DThemeCanvas extends DThemeBase {}\n\nexport class DCanvas<\n\tTHEME extends DThemeCanvas = DThemeCanvas,\n\tOPTIONS extends DCanvasOptions<THEME> = DCanvasOptions<THEME>\n> extends DBase<THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DCanvas\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const DChartAxisPosition = {\n\tTOP: 0,\n\tBOTTOM: 1,\n\tLEFT: 2,\n\tRIGHT: 3\n} as const;\n\nexport type DChartAxisPosition = typeof DChartAxisPosition[keyof typeof DChartAxisPosition];\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const DChartAxisTickPosition = {\n\tINSIDE: 0,\n\tOUTSIDE: 1\n} as const;\n\nexport type DChartAxisTickPosition =\n\ttypeof DChartAxisTickPosition[keyof typeof DChartAxisTickPosition];\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {\n\tDChartAxisBaseOptions,\n\tDChartAxisBaseTickContainerOptions,\n\tDChartAxisBaseTickMajorGridlineOptions,\n\tDChartAxisBaseTickMajorOptions,\n\tDChartAxisBaseTickMajorTextOptions,\n\tDThemeChartAxisBase\n} from \"./d-chart-axis-base-options\";\nimport { DChartAxisPosition } from \"./d-chart-axis-position\";\nimport { DChartAxisTickPosition } from \"./d-chart-axis-tick-position\";\nimport { DChartCoordinateTickMajorStepFunction } from \"./d-chart-coordinate-tick-major-step-function\";\nimport { DChartCoordinateTickMinorStepFunction } from \"./d-chart-coordinate-tick-minor-step-function\";\nimport { EShapePointsStyle } from \"./shape/e-shape-points-style\";\nimport { EShapePointsStyleOption, EShapePointsStyles } from \"./shape/e-shape-points-styles\";\nimport { EShapeStrokeLike } from \"./shape/e-shape-stroke\";\nimport { EShapeStrokeSide } from \"./shape/e-shape-stroke-side\";\nimport { EShapeStrokeStyle } from \"./shape/e-shape-stroke-style\";\nimport { EShapeTextLike } from \"./shape/e-shape-text\";\nimport { EShapeTextAlignLike } from \"./shape/e-shape-text-align\";\nimport { EShapeTextDirection } from \"./shape/e-shape-text-direction\";\nimport { EShapeTextOffsetLike } from \"./shape/e-shape-text-offset\";\nimport { EShapeTextOutlineLike } from \"./shape/e-shape-text-outline\";\nimport { EShapeBar } from \"./shape/variant/e-shape-bar\";\nimport { EShapeBarPosition } from \"./shape/variant/e-shape-bar-position\";\nimport { DeepPartial } from \"./util/deep-partial\";\nimport { isString } from \"./util/is-string\";\nimport { NumberFormatter } from \"./util/number-formatter\";\nimport { NumberFormatters } from \"./util/number-formatters\";\n\nexport interface DChartAxisBaseGridline {\n\tenable: boolean;\n\tstyle?: EShapePointsStyle;\n\tstroke?: Partial<EShapeStrokeLike>;\n\tshapes?: EShapeBar[];\n}\n\nexport interface DChartAxisBaseTickMajor {\n\tcount: number;\n\tstep: number | DChartCoordinateTickMajorStepFunction | undefined;\n\tsize: number;\n\tposition: EShapeBarPosition;\n\tstyle?: EShapePointsStyle;\n\tstroke?: Partial<EShapeStrokeLike>;\n\ttext?: DChartAxisBaseTickMajorTextOptions;\n\tformatter: NumberFormatter;\n\tshapes?: EShapeBar[];\n\n\tgridline: DChartAxisBaseGridline;\n}\n\nexport interface DChartAxisBaseTickMinor {\n\tcount: number;\n\tstep: number | DChartCoordinateTickMinorStepFunction | undefined;\n\tsize: number;\n\tposition: EShapeBarPosition;\n\tstyle?: EShapePointsStyle;\n\tstroke?: Partial<EShapeStrokeLike>;\n\tshapes?: EShapeBar[];\n}\n\nexport interface DChartAxisBaseBar {\n\tstyle?: EShapePointsStyle;\n\tstroke?: Partial<EShapeStrokeLike>;\n\tshape?: EShapeBar;\n}\n\nexport interface DChartAxisBaseTickContainer {\n\tenable: boolean;\n\tmajor: DChartAxisBaseTickMajor;\n\tminor: DChartAxisBaseTickMinor;\n}\n\nexport class DChartAxisBaseOptionParser {\n\tprotected _coordinateIndex: number;\n\tprotected _position: DChartAxisPosition;\n\tprotected _tick: DChartAxisBaseTickContainer;\n\tprotected _label: DeepPartial<EShapeTextLike> | undefined;\n\tprotected _padding: number;\n\tprotected _bar: DChartAxisBaseBar;\n\n\tconstructor(theme: DThemeChartAxisBase, options?: DChartAxisBaseOptions) {\n\t\tthis._coordinateIndex = options?.coordinate ?? 0;\n\t\tthis._position = this.toPosition(theme, options);\n\t\tthis._tick = this.toTickContainer(theme, options);\n\t\tthis._label = this.toLabel(theme, options);\n\t\tthis._padding = options?.padding ?? theme.getPadding();\n\t\tthis._bar = this.toBar(theme, options);\n\t}\n\n\tget coordinateIndex(): number {\n\t\treturn this._coordinateIndex;\n\t}\n\n\tget padding(): number {\n\t\treturn this._padding;\n\t}\n\n\tget position(): DChartAxisPosition {\n\t\treturn this._position;\n\t}\n\n\tget bar(): DChartAxisBaseBar {\n\t\treturn this._bar;\n\t}\n\n\tget tick(): DChartAxisBaseTickContainer {\n\t\treturn this._tick;\n\t}\n\n\tget label(): DeepPartial<EShapeTextLike> | undefined {\n\t\treturn this._label;\n\t}\n\n\tprotected toPosition(\n\t\ttheme: DThemeChartAxisBase,\n\t\toptions?: DChartAxisBaseOptions\n\t): DChartAxisPosition {\n\t\tconst position = options?.position;\n\t\tif (isString(position)) {\n\t\t\treturn DChartAxisPosition[position];\n\t\t} else if (position != null) {\n\t\t\treturn position;\n\t\t}\n\t\treturn theme.getPosition();\n\t}\n\n\tprotected toBar(\n\t\ttheme: DThemeChartAxisBase,\n\t\toptions?: DChartAxisBaseOptions\n\t): DChartAxisBaseBar {\n\t\treturn {\n\t\t\tstyle: options?.style ?? theme.getStyle(),\n\t\t\tstroke: this.toBarStroke(theme, options?.stroke),\n\t\t\tshape: undefined\n\t\t};\n\t}\n\n\tprotected toTickContainer(\n\t\ttheme: DThemeChartAxisBase,\n\t\toptions?: DChartAxisBaseOptions\n\t): DChartAxisBaseTickContainer {\n\t\tconst tick = options?.tick;\n\t\treturn {\n\t\t\tenable: tick?.enable ?? theme.getTickEnable(),\n\t\t\tmajor: this.toTickMajor(theme, tick),\n\t\t\tminor: this.toMinorTick(theme, tick)\n\t\t};\n\t}\n\n\tprotected toTickMajor(\n\t\ttheme: DThemeChartAxisBase,\n\t\toptions?: DChartAxisBaseTickContainerOptions\n\t): DChartAxisBaseTickMajor {\n\t\tconst major = options?.major;\n\t\tconst position = major?.position ?? options?.position ?? theme.getMajorTickPosition();\n\t\tconst optionsStyle = options?.style;\n\t\tconst style = EShapePointsStyles.from(\n\t\t\tmajor?.style ?? optionsStyle ?? theme.getMajorTickStyle()\n\t\t);\n\t\tconst optionsStroke = options?.stroke;\n\t\tconst stroke = this.toTickMajorStroke(theme, major?.stroke, optionsStroke);\n\t\treturn {\n\t\t\tcount: major?.count ?? theme.getMajorTickCount(),\n\t\t\tstep: major?.step ?? theme.getMajorTickStep(),\n\t\t\tsize: major?.size ?? theme.getMajorTickSize(),\n\t\t\tposition: this.toTickPosition(position),\n\t\t\tstyle,\n\t\t\tstroke,\n\t\t\ttext: this.toMajorTickText(theme, major?.text),\n\t\t\tformatter: this.toMajorTickFormatter(theme, major),\n\t\t\tshapes: undefined,\n\t\t\tgridline: this.toTickMajorGridline(theme, major?.gridline, optionsStyle, optionsStroke)\n\t\t};\n\t}\n\n\tprotected toTickMajorGridline(\n\t\ttheme: DThemeChartAxisBase,\n\t\toptions: DChartAxisBaseTickMajorGridlineOptions | undefined,\n\t\toptionsStyle: EShapePointsStyleOption | undefined,\n\t\toptionsStroke: Partial<EShapeStrokeLike> | undefined\n\t): DChartAxisBaseGridline {\n\t\tconst style = EShapePointsStyles.from(\n\t\t\toptions?.style ?? optionsStyle ?? theme.getMajorTickGridlineStyle()\n\t\t);\n\t\treturn {\n\t\t\tenable: options?.enable ?? theme.getMajorTickGridlineEnable(),\n\t\t\tstyle,\n\t\t\tstroke: this.toTickMajorGridlineStroke(theme, options?.stroke, optionsStroke),\n\t\t\tshapes: undefined\n\t\t};\n\t}\n\n\tprotected toTickPosition(\n\t\ttickPosition: DChartAxisTickPosition | keyof typeof DChartAxisTickPosition\n\t): EShapeBarPosition {\n\t\tconst position = this._position;\n\t\tif (tickPosition === DChartAxisTickPosition.OUTSIDE || tickPosition === \"OUTSIDE\") {\n\t\t\tswitch (position) {\n\t\t\t\tcase DChartAxisPosition.TOP:\n\t\t\t\t\treturn EShapeBarPosition.BOTTOM;\n\t\t\t\tcase DChartAxisPosition.BOTTOM:\n\t\t\t\t\treturn EShapeBarPosition.TOP;\n\t\t\t\tcase DChartAxisPosition.LEFT:\n\t\t\t\t\treturn EShapeBarPosition.RIGHT;\n\t\t\t\tcase DChartAxisPosition.RIGHT:\n\t\t\t\t\treturn EShapeBarPosition.LEFT;\n\t\t\t\tdefault:\n\t\t\t\t\treturn EShapeBarPosition.TOP;\n\t\t\t}\n\t\t} else {\n\t\t\tswitch (position) {\n\t\t\t\tcase DChartAxisPosition.TOP:\n\t\t\t\t\treturn EShapeBarPosition.TOP;\n\t\t\t\tcase DChartAxisPosition.BOTTOM:\n\t\t\t\t\treturn EShapeBarPosition.BOTTOM;\n\t\t\t\tcase DChartAxisPosition.LEFT:\n\t\t\t\t\treturn EShapeBarPosition.LEFT;\n\t\t\t\tcase DChartAxisPosition.RIGHT:\n\t\t\t\t\treturn EShapeBarPosition.RIGHT;\n\t\t\t\tdefault:\n\t\t\t\t\treturn EShapeBarPosition.TOP;\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected toMinorTick(\n\t\ttheme: DThemeChartAxisBase,\n\t\toptions?: DChartAxisBaseTickContainerOptions\n\t): DChartAxisBaseTickMinor {\n\t\tconst minor = options?.minor;\n\t\tconst position = minor?.position ?? options?.position ?? theme.getMinorTickPosition();\n\t\tconst style = EShapePointsStyles.from(\n\t\t\tminor?.style ?? options?.style ?? theme.getMinorTickStyle()\n\t\t);\n\t\treturn {\n\t\t\tcount: minor?.count ?? theme.getMinorTickCount(),\n\t\t\tstep: minor?.step ?? theme.getMinorTickStep(),\n\t\t\tsize: minor?.size ?? theme.getMinorTickSize(),\n\t\t\tposition: this.toTickPosition(position),\n\t\t\tstyle,\n\t\t\tstroke: this.toTickMinorStroke(theme, minor?.stroke, options?.stroke),\n\t\t\tshapes: undefined\n\t\t};\n\t}\n\n\tprotected toBarStroke(\n\t\ttheme: DThemeChartAxisBase,\n\t\toptions?: Partial<EShapeStrokeLike>\n\t): Partial<EShapeStrokeLike> {\n\t\treturn this.toStroke(\n\t\t\toptions,\n\t\t\tundefined,\n\t\t\ttheme.getStrokeEnable(),\n\t\t\ttheme.getStrokeColor(),\n\t\t\ttheme.getStrokeAlpha(),\n\t\t\ttheme.getStrokeWidth(),\n\t\t\ttheme.getStrokeAlign(),\n\t\t\ttheme.getStrokeSide(),\n\t\t\ttheme.getStrokeStyle()\n\t\t);\n\t}\n\n\tprotected toTickMajorStroke(\n\t\ttheme: DThemeChartAxisBase,\n\t\toptionsA?: Partial<EShapeStrokeLike>,\n\t\toptionsB?: Partial<EShapeStrokeLike>\n\t): Partial<EShapeStrokeLike> {\n\t\treturn this.toStroke(\n\t\t\toptionsA,\n\t\t\toptionsB,\n\t\t\ttheme.getMajorTickStrokeEnable(),\n\t\t\ttheme.getMajorTickStrokeColor(),\n\t\t\ttheme.getMajorTickStrokeAlpha(),\n\t\t\ttheme.getMajorTickStrokeWidth(),\n\t\t\ttheme.getMajorTickStrokeAlign(),\n\t\t\ttheme.getMajorTickStrokeSide(),\n\t\t\ttheme.getMajorTickStrokeStyle()\n\t\t);\n\t}\n\n\tprotected toTickMajorGridlineStroke(\n\t\ttheme: DThemeChartAxisBase,\n\t\toptionsA?: Partial<EShapeStrokeLike>,\n\t\toptionsB?: Partial<EShapeStrokeLike>\n\t): Partial<EShapeStrokeLike> {\n\t\treturn this.toStroke(\n\t\t\toptionsA,\n\t\t\toptionsB,\n\t\t\ttheme.getMajorTickGridlineStrokeEnable(),\n\t\t\ttheme.getMajorTickGridlineStrokeColor(),\n\t\t\ttheme.getMajorTickGridlineStrokeAlpha(),\n\t\t\ttheme.getMajorTickGridlineStrokeWidth(),\n\t\t\ttheme.getMajorTickGridlineStrokeAlign(),\n\t\t\ttheme.getMajorTickGridlineStrokeSide(),\n\t\t\ttheme.getMajorTickGridlineStrokeStyle()\n\t\t);\n\t}\n\n\tprotected toTickMinorStroke(\n\t\ttheme: DThemeChartAxisBase,\n\t\toptionsA?: Partial<EShapeStrokeLike>,\n\t\toptionsB?: Partial<EShapeStrokeLike>\n\t): Partial<EShapeStrokeLike> {\n\t\treturn this.toStroke(\n\t\t\toptionsA,\n\t\t\toptionsB,\n\t\t\ttheme.getMinorTickStrokeEnable(),\n\t\t\ttheme.getMinorTickStrokeColor(),\n\t\t\ttheme.getMinorTickStrokeAlpha(),\n\t\t\ttheme.getMinorTickStrokeWidth(),\n\t\t\ttheme.getMinorTickStrokeAlign(),\n\t\t\ttheme.getMinorTickStrokeSide(),\n\t\t\ttheme.getMinorTickStrokeStyle()\n\t\t);\n\t}\n\n\tprotected toStroke(\n\t\toptionsA: Partial<EShapeStrokeLike> | undefined,\n\t\toptionsB: Partial<EShapeStrokeLike> | undefined,\n\t\tenable: boolean | undefined,\n\t\tcolor: number | undefined,\n\t\talpha: number | undefined,\n\t\twidth: number | undefined,\n\t\talign: number | undefined,\n\t\tside: EShapeStrokeSide | undefined,\n\t\tstyle: EShapeStrokeStyle | undefined\n\t): Partial<EShapeStrokeLike> {\n\t\tif (optionsA) {\n\t\t\tif (optionsB) {\n\t\t\t\treturn {\n\t\t\t\t\tenable: optionsA.enable ?? optionsB.enable ?? enable,\n\t\t\t\t\tcolor: optionsA.color ?? optionsB.color ?? color,\n\t\t\t\t\talpha: optionsA.alpha ?? optionsB.alpha ?? alpha,\n\t\t\t\t\twidth: optionsA.width ?? optionsB.width ?? width,\n\t\t\t\t\talign: optionsA.align ?? optionsB.align ?? align,\n\t\t\t\t\tside: optionsA.side ?? optionsB.side ?? side,\n\t\t\t\t\tstyle: optionsA.style ?? optionsB.style ?? style\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\treturn {\n\t\t\t\t\tenable: optionsA.enable ?? enable,\n\t\t\t\t\tcolor: optionsA.color ?? color,\n\t\t\t\t\talpha: optionsA.alpha ?? alpha,\n\t\t\t\t\twidth: optionsA.width ?? width,\n\t\t\t\t\talign: optionsA.align ?? align,\n\t\t\t\t\tside: optionsA.side ?? side,\n\t\t\t\t\tstyle: optionsA.style ?? style\n\t\t\t\t};\n\t\t\t}\n\t\t} else if (optionsB) {\n\t\t\treturn {\n\t\t\t\tenable: optionsB.enable ?? enable,\n\t\t\t\tcolor: optionsB.color ?? color,\n\t\t\t\talpha: optionsB.alpha ?? alpha,\n\t\t\t\twidth: optionsB.width ?? width,\n\t\t\t\talign: optionsB.align ?? align,\n\t\t\t\tside: optionsB.side ?? side,\n\t\t\t\tstyle: optionsB.style ?? style\n\t\t\t};\n\t\t} else {\n\t\t\treturn {\n\t\t\t\tenable,\n\t\t\t\tcolor,\n\t\t\t\talpha,\n\t\t\t\twidth,\n\t\t\t\talign,\n\t\t\t\tside,\n\t\t\t\tstyle\n\t\t\t};\n\t\t}\n\t}\n\n\tprotected toMajorTickFormatter(\n\t\ttheme: DThemeChartAxisBase,\n\t\toptions?: DChartAxisBaseTickMajorOptions\n\t): NumberFormatter {\n\t\tconst text = options?.text;\n\t\tif (text) {\n\t\t\tconst format = text.format;\n\t\t\tif (format != null) {\n\t\t\t\treturn NumberFormatters.create(format);\n\t\t\t} else {\n\t\t\t\tconst formatter = text.formatter;\n\t\t\t\tif (formatter) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tformat: formatter\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn NumberFormatters.create(theme.getMajorTickTextFormat());\n\t}\n\n\tprotected toMajorTickText(\n\t\ttheme: DThemeChartAxisBase,\n\t\toptions?: DChartAxisBaseTickMajorTextOptions\n\t): DChartAxisBaseTickMajorTextOptions | undefined {\n\t\toptions = options || {};\n\t\treturn {\n\t\t\tformat: options.format,\n\t\t\tcolor: this.toMajorTickTextColor(theme, options.color),\n\t\t\talpha: options.alpha,\n\t\t\tfamily: options.family,\n\t\t\tsize: options.size,\n\t\t\tweight: options.weight,\n\t\t\talign: this.toMajorTickTextAlign(theme, options.align),\n\t\t\toffset: this.toMajorTickTextOffset(theme, options.offset),\n\t\t\tstyle: options.style,\n\t\t\toutline: this.toMajorTickTextOutline(theme, options.outline),\n\t\t\tspacing: this.toMajorTickTextSpacing(theme, options.spacing),\n\t\t\tdirection: this.toTickMajorTextDirection(theme, options.direction),\n\t\t\tpadding: this.toMajorTickTextPadding(theme, options.padding),\n\t\t\tclipping: options.clipping\n\t\t};\n\t}\n\n\tprotected toMajorTickTextOutline(\n\t\ttheme: DThemeChartAxisBase,\n\t\toptions?: Partial<EShapeTextOutlineLike>\n\t): Partial<EShapeTextOutlineLike> | undefined {\n\t\tif (options) {\n\t\t\treturn {\n\t\t\t\tenable: options.enable,\n\t\t\t\tcolor: options.color,\n\t\t\t\talpha: options.alpha,\n\t\t\t\twidth: options.width\n\t\t\t};\n\t\t}\n\t}\n\n\tprotected toMajorTickTextAlign(\n\t\ttheme: DThemeChartAxisBase,\n\t\toptions?: Partial<EShapeTextAlignLike>\n\t): Partial<EShapeTextAlignLike> | undefined {\n\t\tconst position = this._position;\n\t\treturn {\n\t\t\thorizontal: options?.horizontal ?? theme.getMajorTickTextAlignHorizontal(position),\n\t\t\tvertical: options?.vertical ?? theme.getMajorTickTextAlignVertical(position)\n\t\t};\n\t}\n\n\tprotected toMajorTickTextOffset(\n\t\ttheme: DThemeChartAxisBase,\n\t\toptions?: Partial<EShapeTextOffsetLike>\n\t): Partial<EShapeTextOffsetLike> | undefined {\n\t\tif (options) {\n\t\t\treturn {\n\t\t\t\thorizontal: options.horizontal,\n\t\t\t\tvertical: options.vertical\n\t\t\t};\n\t\t}\n\t}\n\n\tprotected toMajorTickTextSpacing(\n\t\ttheme: DThemeChartAxisBase,\n\t\toptions?: Partial<EShapeTextOffsetLike>\n\t): Partial<EShapeTextOffsetLike> | undefined {\n\t\tif (options) {\n\t\t\treturn {\n\t\t\t\thorizontal: options.horizontal,\n\t\t\t\tvertical: options.vertical\n\t\t\t};\n\t\t}\n\t}\n\n\tprotected toMajorTickTextPadding(\n\t\ttheme: DThemeChartAxisBase,\n\t\toptions?: Partial<EShapeTextOffsetLike>\n\t): Partial<EShapeTextOffsetLike> {\n\t\treturn {\n\t\t\thorizontal: options?.horizontal ?? theme.getMajorTickTextPaddingHorizontal(),\n\t\t\tvertical: options?.vertical ?? theme.getMajorTickTextPaddingVertical()\n\t\t};\n\t}\n\n\tprotected toTickMajorTextDirection(\n\t\ttheme: DThemeChartAxisBase,\n\t\toptions?: EShapeTextDirection\n\t): EShapeTextDirection {\n\t\treturn options ?? theme.getMajorTickTextDirection();\n\t}\n\n\tprotected toMajorTickTextColor(\n\t\ttheme: DThemeChartAxisBase,\n\t\toptions?: number\n\t): number | undefined {\n\t\treturn options ?? theme.getMajorTickTextColor();\n\t}\n\n\tprotected toLabel(\n\t\ttheme: DThemeChartAxisBase,\n\t\toptions?: DChartAxisBaseOptions\n\t): DeepPartial<EShapeTextLike> | undefined {\n\t\tconst label = options?.label;\n\t\tif (label) {\n\t\t\treturn {\n\t\t\t\tvalue: label.value,\n\t\t\t\tcolor: this.toLabelColor(theme, label.color),\n\t\t\t\talpha: label.alpha,\n\t\t\t\tfamily: label.family,\n\t\t\t\tsize: label.size,\n\t\t\t\tweight: label.weight,\n\t\t\t\talign: this.toLabelAlign(theme, label.align),\n\t\t\t\toffset: this.toLabelOffset(theme, label.offset),\n\t\t\t\tstyle: label.style,\n\t\t\t\toutline: this.toLabelOutline(theme, label.outline),\n\t\t\t\tspacing: this.toLabelSpacing(theme, label.spacing),\n\t\t\t\tdirection: this.toLabelDirection(theme, label.direction),\n\t\t\t\tpadding: this.toLabelPadding(theme, label.padding),\n\t\t\t\tclipping: label.clipping\n\t\t\t};\n\t\t}\n\t}\n\n\tprotected toLabelOutline(\n\t\ttheme: DThemeChartAxisBase,\n\t\toptions?: Partial<EShapeTextOutlineLike>\n\t): Partial<EShapeTextOutlineLike> | undefined {\n\t\tif (options) {\n\t\t\treturn {\n\t\t\t\tenable: options.enable,\n\t\t\t\tcolor: options.color,\n\t\t\t\talpha: options.alpha,\n\t\t\t\twidth: options.width\n\t\t\t};\n\t\t}\n\t}\n\n\tprotected toLabelAlign(\n\t\ttheme: DThemeChartAxisBase,\n\t\toptions?: Partial<EShapeTextAlignLike>\n\t): Partial<EShapeTextAlignLike> | undefined {\n\t\tconst position = this._position;\n\t\treturn {\n\t\t\thorizontal: options?.horizontal ?? theme.getLabelAlignHorizontal(position),\n\t\t\tvertical: options?.vertical ?? theme.getLabelAlignVertical(position)\n\t\t};\n\t}\n\n\tprotected toLabelOffset(\n\t\ttheme: DThemeChartAxisBase,\n\t\toptions?: Partial<EShapeTextOffsetLike>\n\t): Partial<EShapeTextOffsetLike> | undefined {\n\t\tif (options) {\n\t\t\treturn {\n\t\t\t\thorizontal: options.horizontal,\n\t\t\t\tvertical: options.vertical\n\t\t\t};\n\t\t}\n\t}\n\n\tprotected toLabelSpacing(\n\t\ttheme: DThemeChartAxisBase,\n\t\toptions?: Partial<EShapeTextOffsetLike>\n\t): Partial<EShapeTextOffsetLike> | undefined {\n\t\tif (options) {\n\t\t\treturn {\n\t\t\t\thorizontal: options.horizontal,\n\t\t\t\tvertical: options.vertical\n\t\t\t};\n\t\t}\n\t}\n\n\tprotected toLabelPadding(\n\t\ttheme: DThemeChartAxisBase,\n\t\toptions?: Partial<EShapeTextOffsetLike>\n\t): Partial<EShapeTextOffsetLike> {\n\t\treturn {\n\t\t\thorizontal: options?.horizontal ?? theme.getLabelPaddingHorizontal(),\n\t\t\tvertical: options?.vertical ?? theme.getLabelPaddingVertical()\n\t\t};\n\t}\n\n\tprotected toLabelDirection(\n\t\ttheme: DThemeChartAxisBase,\n\t\toptions?: EShapeTextDirection\n\t): EShapeTextDirection {\n\t\treturn options ?? theme.getLabelDirection();\n\t}\n\n\tprotected toLabelColor(theme: DThemeChartAxisBase, options?: number): number | undefined {\n\t\treturn options ?? theme.getLabelColor();\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Matrix } from \"pixi.js\";\nimport { DBase } from \"./d-base\";\nimport { DChartAxis } from \"./d-chart-axis\";\nimport { DChartAxisBaseOptions, DThemeChartAxisBase } from \"./d-chart-axis-base-options\";\nimport {\n\tDChartAxisBaseBar,\n\tDChartAxisBaseOptionParser,\n\tDChartAxisBaseTickContainer\n} from \"./d-chart-axis-base-options-parser\";\nimport { DChartAxisContainer } from \"./d-chart-axis-container\";\nimport { DChartAxisPosition } from \"./d-chart-axis-position\";\nimport { DChartCoordinate } from \"./d-chart-coordinate\";\nimport { EShapePointsStyle } from \"./shape\";\nimport { EShapeTextLike } from \"./shape/e-shape-text\";\nimport { EShapeBar } from \"./shape/variant/e-shape-bar\";\nimport { EShapeBarPosition } from \"./shape/variant/e-shape-bar-position\";\nimport { DThemes } from \"./theme/d-themes\";\nimport { DeepPartial } from \"./util/deep-partial\";\nimport { isNaN } from \"./util/is-nan\";\n\nexport class DChartAxisBase<\n\tCHART extends DBase = DBase,\n\tOPTIONS extends DChartAxisBaseOptions = DChartAxisBaseOptions\n> implements DChartAxis<CHART>\n{\n\tprotected _coordinateIndex: number;\n\tprotected _padding: number;\n\tprotected _position: DChartAxisPosition;\n\tprotected _container?: DChartAxisContainer<CHART>;\n\tprotected _bar: DChartAxisBaseBar;\n\tprotected _index: number;\n\tprotected _tick: DChartAxisBaseTickContainer;\n\tprotected _majorTicks: Float64Array;\n\tprotected _minorTicks: Float64Array;\n\tprotected _label?: DeepPartial<EShapeTextLike>;\n\tprotected _theme: DThemeChartAxisBase;\n\n\tconstructor(options?: OPTIONS) {\n\t\tconst theme = this.toTheme(options);\n\t\tthis._theme = theme;\n\t\tthis._index = 0;\n\n\t\tconst parser = new DChartAxisBaseOptionParser(theme, options);\n\t\tthis._coordinateIndex = parser.coordinateIndex;\n\t\tthis._padding = parser.padding;\n\t\tthis._position = parser.position;\n\t\tconst tick = parser.tick;\n\t\tthis._tick = tick;\n\t\tthis._label = parser.label;\n\t\tthis._bar = parser.bar;\n\t\tconst tickMajorCount = tick.major.count;\n\t\tconst tickMinorCount = tick.minor.count;\n\t\tthis._majorTicks = new Float64Array(tickMajorCount * 3);\n\t\tthis._minorTicks = new Float64Array((tickMajorCount + 1) * tickMinorCount * 3);\n\t}\n\n\tget position(): DChartAxisPosition {\n\t\treturn this._position;\n\t}\n\n\tprotected updateBar(container: DChartAxisContainer<CHART>): void {\n\t\tconst bar = this._bar;\n\t\tconst shape = bar.shape;\n\t\tif (shape) {\n\t\t\tconst plotArea = container.plotArea;\n\t\t\tconst plotAreaWidth = plotArea.width;\n\t\t\tconst plotAreaHeight = plotArea.height;\n\t\t\tconst padding = this._padding * this._index;\n\t\t\tshape.disallowUploadedUpdate();\n\t\t\tconst position = shape.transform.position;\n\t\t\tconst size = shape.size;\n\t\t\tswitch (this._position) {\n\t\t\t\tcase DChartAxisPosition.TOP:\n\t\t\t\t\tposition.set(plotAreaWidth * 0.5, 0 - padding);\n\t\t\t\t\tsize.set(plotAreaWidth, 0);\n\t\t\t\t\tbreak;\n\t\t\t\tcase DChartAxisPosition.BOTTOM:\n\t\t\t\t\tposition.set(plotAreaWidth * 0.5, plotAreaHeight + padding);\n\t\t\t\t\tsize.set(plotAreaWidth, 0);\n\t\t\t\t\tbreak;\n\t\t\t\tcase DChartAxisPosition.LEFT:\n\t\t\t\t\tposition.set(0 - padding, plotAreaHeight * 0.5);\n\t\t\t\t\tsize.set(0, plotAreaHeight);\n\t\t\t\t\tbreak;\n\t\t\t\tcase DChartAxisPosition.RIGHT:\n\t\t\t\t\tposition.set(plotAreaWidth + padding, plotAreaHeight * 0.5);\n\t\t\t\t\tsize.set(0, plotAreaHeight);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tshape.allowUploadedUpdate();\n\t\t}\n\t}\n\n\tupdateTicksX(\n\t\tdomainMin: number,\n\t\tdomainMax: number,\n\t\tcoordinate: DChartCoordinate<CHART>,\n\t\tmajorShapes: EShapeBar[],\n\t\tminorShapes: EShapeBar[],\n\t\tgridlineShapes: EShapeBar[] | undefined,\n\t\tshapePositionY: number,\n\t\ttransform: Matrix,\n\t\tplotAreaHeight: number\n\t): void {\n\t\tconst tick = this._tick;\n\t\tconst majorTick = tick.major;\n\t\tconst majorCount = majorTick.count;\n\t\tconst majorStep = majorTick.step;\n\t\tconst majorFormatter = majorTick.formatter;\n\t\tconst minorTick = tick.minor;\n\t\tconst minorCountPerMajor = minorTick.count;\n\t\tconst minorCount = (majorCount + 1) * minorCountPerMajor;\n\t\tconst minorStep = minorTick.step;\n\t\tconst majorTicks = this._majorTicks;\n\t\tconst minorTicks = this._minorTicks;\n\t\tcoordinate.ticks(\n\t\t\tdomainMin,\n\t\t\tdomainMax,\n\t\t\tmajorCount,\n\t\t\tmajorStep,\n\t\t\tminorCountPerMajor,\n\t\t\tminorCount,\n\t\t\tminorStep,\n\t\t\tmajorTicks,\n\t\t\tminorTicks\n\t\t);\n\n\t\tconst a = transform.a;\n\t\tconst tx = transform.tx;\n\t\tfor (let i = 0; i < majorCount; ++i) {\n\t\t\tconst majorShape = majorShapes[i];\n\t\t\tconst imajorTick = i * 3;\n\t\t\tconst majorTickPosition = majorTicks[imajorTick + 0];\n\t\t\tif (!isNaN(majorTickPosition)) {\n\t\t\t\tconst majorTickProjectedPosition = majorTicks[imajorTick + 1];\n\t\t\t\tconst majotTickPositionX = a * majorTickProjectedPosition + tx;\n\t\t\t\tconst majorTickStep = majorTicks[imajorTick + 2];\n\n\t\t\t\tmajorShape.disallowUploadedUpdate();\n\t\t\t\tmajorShape.visible = true;\n\t\t\t\tmajorShape.transform.position.set(majotTickPositionX, shapePositionY);\n\t\t\t\tmajorShape.text.value = majorFormatter.format(majorTickPosition, majorTickStep);\n\t\t\t\tmajorShape.allowUploadedUpdate();\n\n\t\t\t\tif (gridlineShapes) {\n\t\t\t\t\tconst gridlineShape = gridlineShapes[i];\n\t\t\t\t\tgridlineShape.disallowUploadedUpdate();\n\t\t\t\t\tgridlineShape.visible = true;\n\t\t\t\t\tgridlineShape.transform.position.set(majotTickPositionX, plotAreaHeight * 0.5);\n\t\t\t\t\tgridlineShape.size.set(0, plotAreaHeight);\n\t\t\t\t\tgridlineShape.allowUploadedUpdate();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tmajorShape.visible = false;\n\t\t\t\tif (gridlineShapes) {\n\t\t\t\t\tgridlineShapes[i].visible = false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfor (let i = 0; i < minorCount; ++i) {\n\t\t\tconst minorShape = minorShapes[i];\n\t\t\tconst iminorTick = i * 3;\n\t\t\tconst minorTickPosition = minorTicks[iminorTick + 0];\n\t\t\tconst minorTickProjectedPosition = minorTicks[iminorTick + 1];\n\t\t\tif (!isNaN(minorTickPosition)) {\n\t\t\t\tminorShape.disallowUploadedUpdate();\n\t\t\t\tminorShape.visible = true;\n\t\t\t\tminorShape.transform.position.set(\n\t\t\t\t\ta * minorTickProjectedPosition + tx,\n\t\t\t\t\tshapePositionY\n\t\t\t\t);\n\t\t\t\tminorShape.allowUploadedUpdate();\n\t\t\t} else {\n\t\t\t\tminorShape.visible = false;\n\t\t\t}\n\t\t}\n\t}\n\n\tupdateTicksY(\n\t\tdomainMin: number,\n\t\tdomainMax: number,\n\t\tcoordinate: DChartCoordinate<CHART>,\n\t\tmajorShapes: EShapeBar[],\n\t\tminorShapes: EShapeBar[],\n\t\tgridlineShapes: EShapeBar[] | undefined,\n\t\tshapePositionX: number,\n\t\ttransform: Matrix,\n\t\tplotAreaWidth: number\n\t): void {\n\t\tconst tick = this._tick;\n\t\tconst majorTick = tick.major;\n\t\tconst majorCount = majorTick.count;\n\t\tconst majorStep = majorTick.step;\n\t\tconst majorFormatter = majorTick.formatter;\n\t\tconst minorTick = tick.minor;\n\t\tconst minorCountPerMajor = minorTick.count;\n\t\tconst minorCount = (majorCount + 1) * minorCountPerMajor;\n\t\tconst minorStep = minorTick.step;\n\t\tconst majorTicks = this._majorTicks;\n\t\tconst minorTicks = this._minorTicks;\n\t\tcoordinate.ticks(\n\t\t\tdomainMin,\n\t\t\tdomainMax,\n\t\t\tmajorCount,\n\t\t\tmajorStep,\n\t\t\tminorCountPerMajor,\n\t\t\tminorCount,\n\t\t\tminorStep,\n\t\t\tmajorTicks,\n\t\t\tminorTicks\n\t\t);\n\n\t\tconst d = transform.d;\n\t\tconst ty = transform.ty;\n\t\tfor (let i = 0; i < majorCount; ++i) {\n\t\t\tconst majorShape = majorShapes[i];\n\t\t\tconst imajorTick = i * 3;\n\t\t\tconst majorTickPosition = majorTicks[imajorTick + 0];\n\t\t\tif (!isNaN(majorTickPosition)) {\n\t\t\t\tconst majorTickProjectedPosition = majorTicks[imajorTick + 1];\n\t\t\t\tconst majotTickPositionY = d * majorTickProjectedPosition + ty;\n\t\t\t\tconst majorTickStep = majorTicks[imajorTick + 2];\n\n\t\t\t\tmajorShape.disallowUploadedUpdate();\n\t\t\t\tmajorShape.visible = true;\n\t\t\t\tmajorShape.transform.position.set(shapePositionX, majotTickPositionY);\n\t\t\t\tmajorShape.text.value = majorFormatter.format(majorTickPosition, majorTickStep);\n\t\t\t\tmajorShape.allowUploadedUpdate();\n\n\t\t\t\tif (gridlineShapes) {\n\t\t\t\t\tconst gridlineShape = gridlineShapes[i];\n\t\t\t\t\tgridlineShape.disallowUploadedUpdate();\n\t\t\t\t\tgridlineShape.visible = true;\n\t\t\t\t\tgridlineShape.transform.position.set(plotAreaWidth * 0.5, majotTickPositionY);\n\t\t\t\t\tgridlineShape.size.set(plotAreaWidth, 0);\n\t\t\t\t\tgridlineShape.allowUploadedUpdate();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tmajorShape.visible = false;\n\t\t\t\tif (gridlineShapes) {\n\t\t\t\t\tgridlineShapes[i].visible = false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfor (let i = 0; i < minorCount; ++i) {\n\t\t\tconst minorShape = minorShapes[i];\n\t\t\tconst iminorTick = i * 3;\n\t\t\tconst minorTickPosition = minorTicks[iminorTick + 0];\n\t\t\tconst minorTickProjectedPosition = minorTicks[iminorTick + 1];\n\t\t\tif (!isNaN(minorTickPosition)) {\n\t\t\t\tminorShape.disallowUploadedUpdate();\n\t\t\t\tminorShape.visible = true;\n\t\t\t\tminorShape.transform.position.set(\n\t\t\t\t\tshapePositionX,\n\t\t\t\t\td * minorTickProjectedPosition + ty\n\t\t\t\t);\n\t\t\t\tminorShape.allowUploadedUpdate();\n\t\t\t} else {\n\t\t\t\tminorShape.visible = false;\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected updateTicks(container: DChartAxisContainer<CHART>): void {\n\t\tconst tick = this._tick;\n\t\tconst majorShapes = tick.major.shapes;\n\t\tconst minorShapes = tick.minor.shapes;\n\t\tif (majorShapes && minorShapes) {\n\t\t\tconst plotArea = container.plotArea;\n\t\t\tconst bounds = plotArea.getBoundsInContainer();\n\t\t\tconst transform = plotArea.container.transform.localTransform;\n\t\t\tconst gridlineShapes = tick.major.gridline.shapes;\n\n\t\t\tconst coordinateIndex = this._coordinateIndex;\n\t\t\tconst padding = this._padding * this._index;\n\t\t\tlet coordinate: DChartCoordinate<CHART> | null;\n\t\t\tswitch (this._position) {\n\t\t\t\tcase DChartAxisPosition.TOP:\n\t\t\t\t\tcoordinate = plotArea.coordinate.x.get(coordinateIndex);\n\t\t\t\t\tif (coordinate) {\n\t\t\t\t\t\tconst domainFrom = coordinate.unmap(coordinate.transform.unmap(bounds.x));\n\t\t\t\t\t\tconst domainTo = coordinate.unmap(\n\t\t\t\t\t\t\tcoordinate.transform.unmap(bounds.x + bounds.width)\n\t\t\t\t\t\t);\n\t\t\t\t\t\tconst plotAreaHeight = plotArea.height;\n\t\t\t\t\t\tthis.updateTicksX(\n\t\t\t\t\t\t\tdomainFrom,\n\t\t\t\t\t\t\tdomainTo,\n\t\t\t\t\t\t\tcoordinate,\n\t\t\t\t\t\t\tmajorShapes,\n\t\t\t\t\t\t\tminorShapes,\n\t\t\t\t\t\t\tgridlineShapes,\n\t\t\t\t\t\t\t0 - padding,\n\t\t\t\t\t\t\ttransform,\n\t\t\t\t\t\t\tplotAreaHeight\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase DChartAxisPosition.BOTTOM:\n\t\t\t\t\tcoordinate = plotArea.coordinate.x.get(coordinateIndex);\n\t\t\t\t\tif (coordinate) {\n\t\t\t\t\t\tconst domainFrom = coordinate.unmap(coordinate.transform.unmap(bounds.x));\n\t\t\t\t\t\tconst domainTo = coordinate.unmap(\n\t\t\t\t\t\t\tcoordinate.transform.unmap(bounds.x + bounds.width)\n\t\t\t\t\t\t);\n\t\t\t\t\t\tconst plotAreaHeight = plotArea.height;\n\t\t\t\t\t\tthis.updateTicksX(\n\t\t\t\t\t\t\tdomainFrom,\n\t\t\t\t\t\t\tdomainTo,\n\t\t\t\t\t\t\tcoordinate,\n\t\t\t\t\t\t\tmajorShapes,\n\t\t\t\t\t\t\tminorShapes,\n\t\t\t\t\t\t\tgridlineShapes,\n\t\t\t\t\t\t\tplotAreaHeight + padding,\n\t\t\t\t\t\t\ttransform,\n\t\t\t\t\t\t\tplotAreaHeight\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase DChartAxisPosition.LEFT:\n\t\t\t\t\tcoordinate = plotArea.coordinate.y.get(coordinateIndex);\n\t\t\t\t\tif (coordinate) {\n\t\t\t\t\t\tconst domainFrom = coordinate.unmap(coordinate.transform.unmap(bounds.y));\n\t\t\t\t\t\tconst domainTo = coordinate.unmap(\n\t\t\t\t\t\t\tcoordinate.transform.unmap(bounds.y + bounds.height)\n\t\t\t\t\t\t);\n\t\t\t\t\t\tconst plotAreaWidth = plotArea.width;\n\t\t\t\t\t\tthis.updateTicksY(\n\t\t\t\t\t\t\tdomainFrom,\n\t\t\t\t\t\t\tdomainTo,\n\t\t\t\t\t\t\tcoordinate,\n\t\t\t\t\t\t\tmajorShapes,\n\t\t\t\t\t\t\tminorShapes,\n\t\t\t\t\t\t\tgridlineShapes,\n\t\t\t\t\t\t\t0 - padding,\n\t\t\t\t\t\t\ttransform,\n\t\t\t\t\t\t\tplotAreaWidth\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase DChartAxisPosition.RIGHT:\n\t\t\t\t\tcoordinate = plotArea.coordinate.y.get(coordinateIndex);\n\t\t\t\t\tif (coordinate) {\n\t\t\t\t\t\tconst domainFrom = coordinate.unmap(coordinate.transform.unmap(bounds.y));\n\t\t\t\t\t\tconst domainTo = coordinate.unmap(\n\t\t\t\t\t\t\tcoordinate.transform.unmap(bounds.y + bounds.height)\n\t\t\t\t\t\t);\n\t\t\t\t\t\tconst plotAreaWidth = plotArea.width;\n\t\t\t\t\t\tthis.updateTicksY(\n\t\t\t\t\t\t\tdomainFrom,\n\t\t\t\t\t\t\tdomainTo,\n\t\t\t\t\t\t\tcoordinate,\n\t\t\t\t\t\t\tmajorShapes,\n\t\t\t\t\t\t\tminorShapes,\n\t\t\t\t\t\t\tgridlineShapes,\n\t\t\t\t\t\t\tplotAreaWidth + padding,\n\t\t\t\t\t\t\ttransform,\n\t\t\t\t\t\t\tplotAreaWidth\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tbind(container: DChartAxisContainer<CHART>, index: number): void {\n\t\tthis._container = container;\n\t\tthis._index = index;\n\t\tconst tickShapeContainer = container.container;\n\n\t\t// Bar\n\t\tconst bar = this._bar;\n\t\tlet barShape = bar.shape;\n\t\tif (!barShape) {\n\t\t\tconst position = this._position;\n\t\t\tconst barPosition =\n\t\t\t\tposition === DChartAxisPosition.LEFT || position === DChartAxisPosition.RIGHT\n\t\t\t\t\t? EShapeBarPosition.TOP\n\t\t\t\t\t: EShapeBarPosition.LEFT;\n\t\t\tconst barStyle = bar.style || EShapePointsStyle.NONE;\n\t\t\tbarShape = new EShapeBar();\n\t\t\tbarShape.points.position = barPosition;\n\t\t\tbarShape.points.style = barStyle;\n\t\t\tbarShape.stroke.copy(bar.stroke);\n\t\t\tbarShape.text.copy(this._label);\n\t\t\tthis._bar.shape = barShape;\n\t\t}\n\t\tbarShape.attach(container.container);\n\n\t\t// Major tick gridline\n\t\tconst tick = this._tick;\n\t\tconst tickMajor = tick.major;\n\t\tconst gridline = tickMajor.gridline;\n\t\tlet gridlineShapes = gridline.shapes;\n\t\tif (!gridlineShapes && tick.enable && gridline.enable) {\n\t\t\tgridlineShapes = [];\n\t\t\tgridline.shapes = gridlineShapes;\n\t\t\tconst position = this._position;\n\t\t\tconst gridlinePosition =\n\t\t\t\tposition === DChartAxisPosition.LEFT || position === DChartAxisPosition.RIGHT\n\t\t\t\t\t? EShapeBarPosition.LEFT\n\t\t\t\t\t: EShapeBarPosition.TOP;\n\t\t\tconst gridlineCount = tickMajor.count;\n\t\t\tconst gridlineStyle = gridline.style || EShapePointsStyle.NONE;\n\t\t\tfor (let i = 0; i < gridlineCount; ++i) {\n\t\t\t\tconst gridlineShape = new EShapeBar();\n\t\t\t\tgridlineShape.points.position = gridlinePosition;\n\t\t\t\tgridlineShape.points.style = gridlineStyle;\n\t\t\t\tgridlineShape.stroke.copy(gridline.stroke);\n\t\t\t\tgridlineShapes.push(gridlineShape);\n\t\t\t}\n\t\t}\n\t\tif (gridlineShapes) {\n\t\t\tfor (let i = 0, imax = gridlineShapes.length; i < imax; ++i) {\n\t\t\t\tgridlineShapes[i].attach(tickShapeContainer);\n\t\t\t}\n\t\t}\n\n\t\t// Major ticks\n\t\tlet tickMajorShapes = tickMajor.shapes;\n\t\tif (!tickMajorShapes && tick.enable) {\n\t\t\ttickMajorShapes = [];\n\t\t\ttickMajor.shapes = tickMajorShapes;\n\t\t\tconst tickMajorCount = tickMajor.count;\n\t\t\tconst tickMajorSize = tickMajor.size;\n\t\t\tconst tickMajorPosition = tickMajor.position;\n\t\t\tconst tickMajorStyle = tickMajor.style || EShapePointsStyle.NONE;\n\t\t\tfor (let i = 0; i < tickMajorCount; ++i) {\n\t\t\t\tconst tickMajorShape = new EShapeBar();\n\t\t\t\ttickMajorShape.points.position = tickMajorPosition;\n\t\t\t\ttickMajorShape.points.size = tickMajorSize;\n\t\t\t\ttickMajorShape.points.style = tickMajorStyle;\n\t\t\t\ttickMajorShape.stroke.copy(tickMajor.stroke);\n\t\t\t\ttickMajorShape.text.copy(tickMajor.text);\n\t\t\t\ttickMajorShape.size.set(0, 0);\n\t\t\t\ttickMajorShapes.push(tickMajorShape);\n\t\t\t}\n\t\t}\n\t\tif (tickMajorShapes) {\n\t\t\tfor (let i = 0, imax = tickMajorShapes.length; i < imax; ++i) {\n\t\t\t\ttickMajorShapes[i].attach(tickShapeContainer);\n\t\t\t}\n\t\t}\n\n\t\t// Minor ticks\n\t\tconst tickMinor = tick.minor;\n\t\tlet tickMinorShapes = tickMinor.shapes;\n\t\tif (!tickMinorShapes && tick.enable) {\n\t\t\ttickMinorShapes = [];\n\t\t\ttickMinor.shapes = tickMinorShapes;\n\t\t\tconst tickMinorCount = tickMinor.count;\n\t\t\tconst tickMinorSize = tickMinor.size;\n\t\t\tconst tickMinorPosition = tickMinor.position;\n\t\t\tconst tickMinorStyle = tickMinor.style || EShapePointsStyle.NONE;\n\t\t\tfor (let i = 0, imax = (tickMajor.count + 1) * tickMinorCount; i < imax; ++i) {\n\t\t\t\tconst tickMinorShape = new EShapeBar();\n\t\t\t\ttickMinorShape.points.position = tickMinorPosition;\n\t\t\t\ttickMinorShape.points.size = tickMinorSize;\n\t\t\t\ttickMinorShape.points.style = tickMinorStyle;\n\t\t\t\ttickMinorShape.stroke.copy(tickMinor.stroke);\n\t\t\t\ttickMinorShape.size.set(0, 0);\n\t\t\t\ttickMinorShapes.push(tickMinorShape);\n\t\t\t}\n\t\t}\n\t\tif (tickMinorShapes) {\n\t\t\tfor (let i = 0, imax = tickMinorShapes.length; i < imax; ++i) {\n\t\t\t\ttickMinorShapes[i].attach(tickShapeContainer);\n\t\t\t}\n\t\t}\n\t}\n\n\tunbind(): void {\n\t\t// Bar\n\t\tconst barShape = this._bar.shape;\n\t\tif (barShape) {\n\t\t\tbarShape.detach();\n\t\t}\n\n\t\t// Major ticks\n\t\tconst tick = this._tick;\n\t\tconst tickMajorShapes = tick.major.shapes;\n\t\tif (tickMajorShapes) {\n\t\t\tfor (let i = 0, imax = tickMajorShapes.length; i < imax; ++i) {\n\t\t\t\ttickMajorShapes[i].detach();\n\t\t\t}\n\t\t}\n\n\t\t// Major tick gridlines\n\t\tconst tickMajorGridlineShapes = tick.major.gridline.shapes;\n\t\tif (tickMajorGridlineShapes) {\n\t\t\tfor (let i = 0, imax = tickMajorGridlineShapes.length; i < imax; ++i) {\n\t\t\t\ttickMajorGridlineShapes[i].detach();\n\t\t\t}\n\t\t}\n\n\t\t// Minor ticks\n\t\tconst tickMinorShapes = tick.minor.shapes;\n\t\tif (tickMinorShapes) {\n\t\t\tfor (let i = 0, imax = tickMinorShapes.length; i < imax; ++i) {\n\t\t\t\ttickMinorShapes[i].detach();\n\t\t\t}\n\t\t}\n\n\t\t//\n\t\tthis._container = undefined;\n\t}\n\n\tupdate(): void {\n\t\tconst container = this._container;\n\t\tif (container) {\n\t\t\tthis.updateBar(container);\n\t\t\tthis.updateTicks(container);\n\t\t}\n\t}\n\n\tdestroy(): void {\n\t\t// Bar\n\t\tconst barShape = this._bar.shape;\n\t\tif (barShape) {\n\t\t\tbarShape.destroy();\n\t\t}\n\n\t\t// Major ticks\n\t\tconst tick = this._tick;\n\t\tconst tickMajorShapes = tick.major.shapes;\n\t\tif (tickMajorShapes) {\n\t\t\tfor (let i = 0, imax = tickMajorShapes.length; i < imax; ++i) {\n\t\t\t\ttickMajorShapes[i].destroy();\n\t\t\t}\n\t\t}\n\n\t\t// Major tick gridlines\n\t\tconst tickMajorGridlineShapes = tick.major.gridline.shapes;\n\t\tif (tickMajorGridlineShapes) {\n\t\t\tfor (let i = 0, imax = tickMajorGridlineShapes.length; i < imax; ++i) {\n\t\t\t\ttickMajorGridlineShapes[i].destroy();\n\t\t\t}\n\t\t}\n\n\t\t// Minor ticks\n\t\tconst tickMinorShapes = tick.minor.shapes;\n\t\tif (tickMinorShapes) {\n\t\t\tfor (let i = 0, imax = tickMinorShapes.length; i < imax; ++i) {\n\t\t\t\ttickMinorShapes[i].destroy();\n\t\t\t}\n\t\t}\n\n\t\t//\n\t\tthis._container = undefined;\n\t}\n\n\tprotected toTheme(options?: DChartAxisBaseOptions): DThemeChartAxisBase {\n\t\treturn (options && options.theme) || this.getThemeDefault();\n\t}\n\n\tprotected getThemeDefault(): DThemeChartAxisBase {\n\t\treturn DThemes.getInstance().get(this.getType());\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DChartAxisBase\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBase } from \"./d-base\";\nimport { DChartAxis } from \"./d-chart-axis\";\nimport { DChartAxisContainer, DChartAxisContainerOptions } from \"./d-chart-axis-container\";\nimport { DChartAxisPosition } from \"./d-chart-axis-position\";\nimport { DChartPlotArea } from \"./d-chart-plot-area\";\nimport { EShapeContainer } from \"./shape/e-shape-container\";\n\nexport class DChartAxisContainerImpl<CHART extends DBase = DBase>\n\timplements DChartAxisContainer<CHART>\n{\n\tprotected _plotArea: DChartPlotArea<CHART>;\n\tprotected _container: EShapeContainer;\n\tprotected _list: Map<DChartAxisPosition, DChartAxis<CHART>[]>;\n\n\tconstructor(plotArea: DChartPlotArea<CHART>, options?: DChartAxisContainerOptions<CHART>) {\n\t\tthis._plotArea = plotArea;\n\t\tthis._container = new EShapeContainer();\n\n\t\tthis._list = new Map<DChartAxisPosition, DChartAxis<CHART>[]>();\n\t\tconst list = options && options.list;\n\t\tif (list) {\n\t\t\tfor (let i = 0, imax = list.length; i < imax; ++i) {\n\t\t\t\tthis.add(list[i]);\n\t\t\t}\n\t\t}\n\t}\n\n\tget container(): EShapeContainer {\n\t\treturn this._container;\n\t}\n\n\tget plotArea(): DChartPlotArea<CHART> {\n\t\treturn this._plotArea;\n\t}\n\n\tadd(axis: DChartAxis<CHART>): void {\n\t\tconst list = this._list;\n\t\tlet axes = list.get(axis.position);\n\t\tif (axes == null) {\n\t\t\taxes = [];\n\t\t\tlist.set(axis.position, axes);\n\t\t}\n\t\taxes.push(axis);\n\t\taxis.bind(this, axes.length - 1);\n\t}\n\n\tget(position: DChartAxisPosition, index: number): DChartAxis<CHART> | null {\n\t\tconst list = this._list;\n\t\tconst axes = list.get(position);\n\t\tif (axes) {\n\t\t\tif (0 <= index && index < axes.length) {\n\t\t\t\treturn axes[index];\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tindexOf(axis: DChartAxis<CHART>): number {\n\t\tconst list = this._list;\n\t\tconst axes = list.get(axis.position);\n\t\tif (axes) {\n\t\t\treturn axes.indexOf(axis);\n\t\t}\n\t\treturn -1;\n\t}\n\n\tclear(position: DChartAxisPosition): this {\n\t\tconst list = this._list;\n\t\tconst axes = list.get(position);\n\t\tif (axes) {\n\t\t\tfor (let i = 0, imax = axes.length; i < imax; ++i) {\n\t\t\t\taxes[i].destroy();\n\t\t\t}\n\t\t\taxes.length = 0;\n\t\t}\n\t\treturn this;\n\t}\n\n\tsize(position: DChartAxisPosition): number {\n\t\tconst list = this._list;\n\t\tconst axes = list.get(position);\n\t\tif (axes) {\n\t\t\treturn axes.length;\n\t\t}\n\t\treturn 0;\n\t}\n\n\tupdate(): void {\n\t\tthis._list.forEach((axes: DChartAxis<CHART>[]): void => {\n\t\t\tfor (let i = 0, imax = axes.length; i < imax; ++i) {\n\t\t\t\taxes[i].update();\n\t\t\t}\n\t\t});\n\t}\n\n\tdestroy(): void {\n\t\tthis._list.forEach((axes: DChartAxis<CHART>[]): void => {\n\t\t\tfor (let i = 0, imax = axes.length; i < imax; ++i) {\n\t\t\t\taxes[i].destroy();\n\t\t\t}\n\t\t\taxes.length = 0;\n\t\t});\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBase } from \"./d-base\";\nimport { DChartAxisBase } from \"./d-chart-axis-base\";\nimport { DChartAxisBaseOptions } from \"./d-chart-axis-base-options\";\n\nexport interface DChartAxisXOptions extends DChartAxisBaseOptions {}\n\n/**\n * An X axis.\n */\nexport class DChartAxisX<\n\tCHART extends DBase = DBase,\n\tOPTIONS extends DChartAxisXOptions = DChartAxisXOptions\n> extends DChartAxisBase<CHART, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DChartAxisX\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBase } from \"./d-base\";\nimport { DChartAxisX, DChartAxisXOptions } from \"./d-chart-axis-x\";\n\nexport interface DChartAxisXDatetimeOptions extends DChartAxisXOptions {}\n\n/**\n * An X axis for datetimes.\n */\nexport class DChartAxisXDatetime<\n\tCHART extends DBase = DBase,\n\tOPTIONS extends DChartAxisXDatetimeOptions = DChartAxisXDatetimeOptions\n> extends DChartAxisX<CHART, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DChartAxisXDatetime\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBase } from \"./d-base\";\nimport { DChartAxisBase } from \"./d-chart-axis-base\";\nimport { DChartAxisBaseOptions } from \"./d-chart-axis-base-options\";\n\nexport interface DChartAxisYOptions extends DChartAxisBaseOptions {}\n\n/**\n * An Y axis.\n */\nexport class DChartAxisY<\n\tCHART extends DBase = DBase,\n\tOPTIONS extends DChartAxisYOptions = DChartAxisYOptions\n> extends DChartAxisBase<CHART, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DChartAxisY\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { UtilRgb } from \"./util/util-rgb\";\n\nconst DCHART_COLOR_SET_1 = [0x10b7e3, 0xfe5420, 0xf0c312, 0x1c5d71];\n\nconst DCHART_COLOR_SET_2 = [\n\tDCHART_COLOR_SET_1[0],\n\tUtilRgb.brighten(DCHART_COLOR_SET_1[0], 0.4),\n\n\tDCHART_COLOR_SET_1[1],\n\tUtilRgb.brighten(DCHART_COLOR_SET_1[1], 0.4),\n\n\tDCHART_COLOR_SET_1[2],\n\tUtilRgb.brighten(DCHART_COLOR_SET_1[2], 0.4),\n\n\tDCHART_COLOR_SET_1[3],\n\tUtilRgb.brighten(DCHART_COLOR_SET_1[3], 0.4)\n];\n\nexport const DChartColorSet1 = (index: number): number => {\n\treturn DCHART_COLOR_SET_1[index % DCHART_COLOR_SET_1.length];\n};\n\nexport const DChartColorSet2 = (index: number): number => {\n\treturn DCHART_COLOR_SET_2[index % DCHART_COLOR_SET_2.length];\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const DChartCoordinateDirection = {\n\tX: 0,\n\tY: 1\n} as const;\n\nexport type DChartCoordinateDirection =\n\ttypeof DChartCoordinateDirection[keyof typeof DChartCoordinateDirection];\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBase } from \"./d-base\";\nimport { DChartCoordinate } from \"./d-chart-coordinate\";\nimport { DChartCoordinateContainer } from \"./d-chart-coordinate-container\";\nimport { DChartCoordinateContainerSub } from \"./d-chart-coordinate-container-sub\";\nimport { DChartCoordinateDirection } from \"./d-chart-coordinate-direction\";\nimport { isNumber } from \"./util/is-number\";\n\nexport class DChartCoordinateContainerSubImpl<CHART extends DBase = DBase>\n\timplements DChartCoordinateContainerSub<CHART>\n{\n\tprotected _list: DChartCoordinate<CHART>[];\n\tprotected _direction: DChartCoordinateDirection;\n\tprotected _container: DChartCoordinateContainer<CHART>;\n\n\tconstructor(container: DChartCoordinateContainer<CHART>, direction: DChartCoordinateDirection) {\n\t\tthis._container = container;\n\t\tthis._direction = direction;\n\t\tthis._list = [];\n\t}\n\n\tget container(): DChartCoordinateContainer<CHART> {\n\t\treturn this._container;\n\t}\n\n\tadd(coordinate: DChartCoordinate<CHART>, index?: number): this {\n\t\tconst list = this._list;\n\t\tif (index == null) {\n\t\t\tlist.push(coordinate);\n\t\t} else if (0 <= index && index < list.length) {\n\t\t\tlist.splice(index, 0, coordinate);\n\t\t} else {\n\t\t\tlist.push(coordinate);\n\t\t}\n\t\tcoordinate.bind(this, this._direction);\n\t\treturn this;\n\t}\n\n\tget(index: number): DChartCoordinate<CHART> | null {\n\t\tconst list = this._list;\n\t\tif (0 <= index && index < list.length) {\n\t\t\treturn list[index];\n\t\t}\n\t\treturn null;\n\t}\n\n\tindexOf(coordinate: DChartCoordinate<CHART>): number {\n\t\treturn this._list.indexOf(coordinate);\n\t}\n\n\tremove(coordinate: DChartCoordinate<CHART>): DChartCoordinate<CHART> | null;\n\tremove(index: number): DChartCoordinate<CHART> | null;\n\tremove(coordinateOrIndex: DChartCoordinate<CHART> | number): DChartCoordinate<CHART> | null {\n\t\tconst list = this._list;\n\t\tif (isNumber(coordinateOrIndex)) {\n\t\t\tconst index = coordinateOrIndex;\n\t\t\tif (0 <= index && index < list.length) {\n\t\t\t\tconst removed = list.splice(index, 1)[0];\n\t\t\t\tremoved.unbind();\n\t\t\t\treturn removed;\n\t\t\t}\n\t\t} else {\n\t\t\tconst coordinate = coordinateOrIndex;\n\t\t\tconst index = list.indexOf(coordinate);\n\t\t\tif (0 <= index) {\n\t\t\t\tlist.splice(index, 1);\n\t\t\t\tcoordinate.unbind();\n\t\t\t\treturn coordinate;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tclear(): this {\n\t\tconst list = this._list;\n\t\tfor (let i = 0, imax = list.length; i < imax; ++i) {\n\t\t\tlist[i].unbind();\n\t\t}\n\t\tlist.length = 0;\n\t\treturn this;\n\t}\n\n\tdestroy(): this {\n\t\treturn this.clear();\n\t}\n\n\tsize(): number {\n\t\treturn this._list.length;\n\t}\n\n\tfit(from?: number, to?: number): this {\n\t\tconst list = this._list;\n\t\tfor (let i = 0, imax = list.length; i < imax; ++i) {\n\t\t\tlist[i].fit(from, to);\n\t\t}\n\t\treturn this;\n\t}\n\n\tmark(from?: number, to?: number): this {\n\t\tconst list = this._list;\n\t\tfor (let i = 0, imax = list.length; i < imax; ++i) {\n\t\t\tlist[i].mark(from, to);\n\t\t}\n\t\treturn this;\n\t}\n\n\tblend(ratio: number): this {\n\t\tconst list = this._list;\n\t\tfor (let i = 0, imax = list.length; i < imax; ++i) {\n\t\t\tlist[i].blend(ratio);\n\t\t}\n\t\treturn this;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBase } from \"./d-base\";\nimport { DChartCoordinateDirection } from \"./d-chart-coordinate-direction\";\nimport {\n\tDChartCoordinateContainer,\n\tDChartCoordinateContainerOptions\n} from \"./d-chart-coordinate-container\";\nimport { DChartCoordinateContainerSub } from \"./d-chart-coordinate-container-sub\";\nimport { DChartCoordinateContainerSubImpl } from \"./d-chart-coordinate-container-sub-impl\";\nimport { DChartPlotArea } from \"./d-chart-plot-area\";\nimport { isArray } from \"./util/is-array\";\n\nexport class DChartCoordinateContainerImpl<CHART extends DBase = DBase>\n\timplements DChartCoordinateContainer<CHART>\n{\n\tprotected _x: DChartCoordinateContainerSub<CHART>;\n\tprotected _y: DChartCoordinateContainerSub<CHART>;\n\tprotected _plotArea: DChartPlotArea<CHART>;\n\n\tconstructor(\n\t\tplotArea: DChartPlotArea<CHART>,\n\t\toptions?: DChartCoordinateContainerOptions<CHART>\n\t) {\n\t\tthis._plotArea = plotArea;\n\t\tconst x = new DChartCoordinateContainerSubImpl(this, DChartCoordinateDirection.X);\n\t\tthis._x = x;\n\t\tconst y = new DChartCoordinateContainerSubImpl(this, DChartCoordinateDirection.Y);\n\t\tthis._y = y;\n\t\tif (options) {\n\t\t\tconst cxs = options.x;\n\t\t\tif (cxs) {\n\t\t\t\tif (isArray(cxs)) {\n\t\t\t\t\tfor (let i = 0, imax = cxs.length; i < imax; ++i) {\n\t\t\t\t\t\tx.add(cxs[i]);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tx.add(cxs);\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst cys = options.y;\n\t\t\tif (cys) {\n\t\t\t\tif (isArray(cys)) {\n\t\t\t\t\tfor (let i = 0, imax = cys.length; i < imax; ++i) {\n\t\t\t\t\t\ty.add(cys[i]);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\ty.add(cys);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tget x(): DChartCoordinateContainerSub<CHART> {\n\t\treturn this._x;\n\t}\n\n\tget y(): DChartCoordinateContainerSub<CHART> {\n\t\treturn this._y;\n\t}\n\n\tget plotArea(): DChartPlotArea<CHART> {\n\t\treturn this._plotArea;\n\t}\n\n\tfit(domainFrom?: number, domainTo?: number, rangeFrom?: number, rangeTo?: number): this {\n\t\tthis._x.fit(domainFrom, domainTo);\n\t\tthis._y.fit(rangeFrom, rangeTo);\n\t\treturn this;\n\t}\n\n\tmark(domainFrom?: number, domainTo?: number, rangeFrom?: number, rangeTo?: number): this {\n\t\tthis._x.mark(domainFrom, domainTo);\n\t\tthis._y.mark(rangeFrom, rangeTo);\n\t\treturn this;\n\t}\n\n\tblend(ratio: number): this {\n\t\tthis._x.blend(ratio);\n\t\tthis._y.blend(ratio);\n\t\treturn this;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBase } from \"./d-base\";\nimport { DChartCoordinate } from \"./d-chart-coordinate\";\nimport { DChartCoordinateTickOptions, DThemeChartCoordinateTick } from \"./d-chart-coordinate-tick\";\nimport { DChartCoordinateTickMajorStepFunction } from \"./d-chart-coordinate-tick-major-step-function\";\nimport { DChartCoordinateTickMinorStepFunction } from \"./d-chart-coordinate-tick-minor-step-function\";\nimport { DThemes } from \"./theme/d-themes\";\nimport { isNumber } from \"./util/is-number\";\n\nexport class DChartCoordinateLinearTick<CHART extends DBase = DBase> {\n\tprotected _theme: DThemeChartCoordinateTick;\n\n\tconstructor(options?: DChartCoordinateTickOptions) {\n\t\tthis._theme = this.toTheme(options);\n\t}\n\n\tprotected toMajorStep(\n\t\tdomainMin: number,\n\t\tdomainMax: number,\n\t\tmajorCount: number,\n\t\tmajorStep?: number | DChartCoordinateTickMajorStepFunction\n\t): number {\n\t\tif (majorStep == null) {\n\t\t\tif (0 < majorCount) {\n\t\t\t\treturn this.calcStepMajor(domainMin, domainMax, majorCount);\n\t\t\t}\n\t\t\treturn -1;\n\t\t} else if (isNumber(majorStep)) {\n\t\t\treturn majorStep;\n\t\t} else {\n\t\t\treturn majorStep(domainMin, domainMax, majorCount);\n\t\t}\n\t}\n\n\tprotected calcStepMajor(domainMin: number, domainMax: number, majorCount: number): number {\n\t\tconst span = Math.abs(domainMax - domainMin) / majorCount;\n\t\tconst power = Math.floor(Math.log(span) / Math.LN10);\n\t\tconst base = Math.pow(10, power);\n\t\treturn this._theme.toStepScale(span / base) * base;\n\t}\n\n\tprotected toMinorStep(\n\t\tmajorStep: number,\n\t\tminorCount: number,\n\t\tminorStep?: number | DChartCoordinateTickMinorStepFunction\n\t): number {\n\t\tif (minorStep == null) {\n\t\t\tif (0 <= majorStep) {\n\t\t\t\treturn this.calcStepMinor(majorStep, minorCount);\n\t\t\t}\n\t\t\treturn -1;\n\t\t} else if (isNumber(minorStep)) {\n\t\t\treturn minorStep;\n\t\t} else {\n\t\t\treturn minorStep(majorStep, minorCount);\n\t\t}\n\t}\n\n\tprotected calcStepMinor(majorStep: number, minorCount: number): number {\n\t\treturn majorStep / (minorCount + 1);\n\t}\n\n\tprotected calcTickMinorPositions(\n\t\tstep: number,\n\t\tcount: number,\n\t\tmajorPosition: number,\n\t\trangeMin: number,\n\t\trangeMax: number,\n\t\tiresult: number,\n\t\tresult: Float64Array\n\t): void {\n\t\tfor (let i = 0; i < count; i += 1) {\n\t\t\tconst minorPosition = majorPosition + (i + 1) * step;\n\t\t\tif (rangeMin <= minorPosition && minorPosition <= rangeMax) {\n\t\t\t\tresult[iresult++] = minorPosition;\n\t\t\t}\n\t\t}\n\t}\n\n\tcalculate(\n\t\tdomainFrom: number,\n\t\tdomainTo: number,\n\t\tmajorCount: number,\n\t\tmajorStep: number | DChartCoordinateTickMajorStepFunction | undefined,\n\t\tminorCountPerMajor: number,\n\t\tminorCount: number,\n\t\tminorStep: number | DChartCoordinateTickMinorStepFunction | undefined,\n\t\tmajorResult: Float64Array,\n\t\tminorResult: Float64Array,\n\t\tcoordinate: DChartCoordinate<CHART>\n\t): void {\n\t\tif (majorCount <= 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst transform = coordinate.transform;\n\n\t\tconst domainMin = Math.min(domainFrom, domainTo);\n\t\tconst domainMax = Math.max(domainFrom, domainTo);\n\n\t\tconst majorStepMapped = this.toMajorStep(domainMin, domainMax, majorCount, majorStep);\n\t\tif (majorStepMapped <= 0) {\n\t\t\tmajorResult[0] = domainMin;\n\t\t\tmajorResult[1] = transform.map(coordinate.map(domainMin));\n\t\t\tmajorResult[2] = 0;\n\t\t\tfor (let i = 1; i < majorCount; ++i) {\n\t\t\t\tconst imajorResult = i * 3;\n\t\t\t\tmajorResult[imajorResult + 0] = NaN;\n\t\t\t\tmajorResult[imajorResult + 1] = NaN;\n\t\t\t\tmajorResult[imajorResult + 2] = NaN;\n\t\t\t}\n\t\t\tfor (let i = 0; i < minorCount; ++i) {\n\t\t\t\tconst iminorResult = i * 3;\n\t\t\t\tminorResult[iminorResult + 0] = NaN;\n\t\t\t\tminorResult[iminorResult + 1] = NaN;\n\t\t\t\tminorResult[iminorResult + 2] = NaN;\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\t// Major tick start position\n\t\tconst idomainStart = Math.floor(domainMin / majorStepMapped) - 1;\n\t\tconst idomainEnd = Math.ceil(domainMax / majorStepMapped) + 1;\n\t\tconst domainMinMapped = transform.map(coordinate.map(domainMin));\n\t\tconst domainMaxMapped = transform.map(coordinate.map(domainMax));\n\t\tconst from = Math.min(domainMinMapped, domainMaxMapped) - 0.5;\n\t\tconst to = Math.max(domainMinMapped, domainMaxMapped) + 0.5;\n\n\t\t// Major / minor tick positions\n\t\tconst minorStepMapped = this.toMinorStep(majorStepMapped, minorCountPerMajor, minorStep);\n\t\tlet imajor = 0;\n\t\tlet iminor = 0;\n\t\tfor (let i = idomainStart; i <= idomainEnd; ++i) {\n\t\t\tconst majorPosition = i * majorStepMapped;\n\t\t\tif (imajor < majorCount) {\n\t\t\t\tconst majorPositionMapped = transform.map(coordinate.map(majorPosition));\n\t\t\t\tif (from <= majorPositionMapped && majorPositionMapped <= to) {\n\t\t\t\t\tconst imajorResult = imajor * 3;\n\t\t\t\t\tmajorResult[imajorResult + 0] = majorPosition;\n\t\t\t\t\tmajorResult[imajorResult + 1] = majorPositionMapped;\n\t\t\t\t\tmajorResult[imajorResult + 2] = majorStepMapped;\n\t\t\t\t\timajor += 1;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (let j = 0; j < minorCountPerMajor; j += 1) {\n\t\t\t\tif (iminor < minorCount) {\n\t\t\t\t\tconst minorPosition = majorPosition + (j + 1) * minorStepMapped;\n\t\t\t\t\tconst minorPositionMapped = transform.map(coordinate.map(minorPosition));\n\t\t\t\t\tif (from <= minorPositionMapped && minorPositionMapped <= to) {\n\t\t\t\t\t\tconst iminorResult = iminor * 3;\n\t\t\t\t\t\tminorResult[iminorResult + 0] = minorPosition;\n\t\t\t\t\t\tminorResult[iminorResult + 1] = minorPositionMapped;\n\t\t\t\t\t\tminorResult[iminorResult + 2] = minorStepMapped;\n\t\t\t\t\t\timinor += 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfor (let i = imajor; i < majorCount; ++i) {\n\t\t\tconst imajorResult = i * 3;\n\t\t\tmajorResult[imajorResult + 0] = NaN;\n\t\t\tmajorResult[imajorResult + 1] = NaN;\n\t\t\tmajorResult[imajorResult + 2] = NaN;\n\t\t}\n\t\tfor (let i = iminor; i < minorCount; ++i) {\n\t\t\tconst iminorResult = i * 3;\n\t\t\tminorResult[iminorResult + 0] = NaN;\n\t\t\tminorResult[iminorResult + 1] = NaN;\n\t\t\tminorResult[iminorResult + 2] = NaN;\n\t\t}\n\t}\n\n\tprotected toTheme(options?: DChartCoordinateTickOptions): DThemeChartCoordinateTick {\n\t\treturn (options && options.theme) || this.getThemeDefault();\n\t}\n\n\tprotected getThemeDefault(): DThemeChartCoordinateTick {\n\t\treturn DThemes.getInstance().get(this.getType());\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DChartCoordinateTick\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBase } from \"./d-base\";\nimport { DChartCoordinateDirection } from \"./d-chart-coordinate-direction\";\nimport { DChartCoordinateContainerSub } from \"./d-chart-coordinate-container-sub\";\nimport {\n\tDChartCoordinateTransform,\n\tDChartCoordinateTransformOptions,\n\tDThemeChartCoordinateTransform\n} from \"./d-chart-coordinate-transform\";\nimport { DChartCoordinateTransformMark } from \"./d-chart-coordinate-transform-mark\";\nimport { DThemes } from \"./theme/d-themes\";\n\nexport class DChartCoordinateTransformImpl<CHART extends DBase = DBase>\n\timplements DChartCoordinateTransform<CHART>\n{\n\tprotected _theme: DThemeChartCoordinateTransform;\n\tprotected _id: number;\n\tprotected _isTranslationEnabled?: boolean;\n\tprotected _translate: number;\n\tprotected _isScalingEnabled?: boolean;\n\tprotected _scale: number;\n\tprotected _itranslate: number;\n\tprotected _iscale: number;\n\n\tconstructor(options?: DChartCoordinateTransformOptions) {\n\t\tthis._theme = this.toTheme(options);\n\t\tthis._id = 0;\n\t\tthis._isTranslationEnabled = options?.translation;\n\t\tthis._translate = 0;\n\t\tthis._isScalingEnabled = options?.scaling;\n\t\tthis._scale = 1;\n\t\tthis._itranslate = 0;\n\t\tthis._iscale = 1;\n\t}\n\n\tget id(): number {\n\t\treturn this._id;\n\t}\n\n\tget translate(): number {\n\t\treturn this._translate;\n\t}\n\n\tset translate(translate: number) {\n\t\tthis.set(translate);\n\t}\n\n\tget scale(): number {\n\t\treturn this._scale;\n\t}\n\n\tset scale(scale: number) {\n\t\tthis.set(undefined, scale);\n\t}\n\n\tbind(\n\t\tcontainer: DChartCoordinateContainerSub<CHART>,\n\t\tdirection: DChartCoordinateDirection\n\t): void {\n\t\tthis.set(0, direction === DChartCoordinateDirection.X ? +1 : -1);\n\t}\n\n\tunbind(): void {\n\t\t// DO NOTHING\n\t}\n\n\tset(translate?: number, scale?: number): void {\n\t\tlet isChanged = false;\n\n\t\tif (\n\t\t\ttranslate != null &&\n\t\t\tthis._isTranslationEnabled !== false &&\n\t\t\tthis._translate !== translate\n\t\t) {\n\t\t\tisChanged = true;\n\t\t\tthis._translate = translate;\n\t\t}\n\n\t\tif (scale != null && this._isScalingEnabled !== false && this._scale !== scale) {\n\t\t\tisChanged = true;\n\t\t\tthis._scale = scale;\n\t\t}\n\n\t\tif (isChanged) {\n\t\t\tthis._id += 1;\n\t\t\tthis._iscale = this._theme.isZero(this._scale) ? 0 : 1 / this._scale;\n\t\t\tthis._itranslate = -this._translate * this._iscale;\n\t\t}\n\t}\n\n\tblend(ratio: number, mark: DChartCoordinateTransformMark): void {\n\t\tconst ratioi = 1 - ratio;\n\t\tconst newTranslate = mark.newTranslate * ratio + mark.oldTranslate * ratioi;\n\t\tconst newScale = mark.newScale * ratio + mark.oldScale * ratioi;\n\t\tthis.set(newTranslate, newScale);\n\t}\n\n\tmap(value: number): number {\n\t\treturn this._translate + this._scale * value;\n\t}\n\n\tmapAll(values: number[], ifrom: number, iend: number, stride: number, offset: number): void {\n\t\tconst translate = this._translate;\n\t\tconst scale = this._scale;\n\t\tfor (let i = ifrom + offset; i < iend; i += stride) {\n\t\t\tvalues[i] = translate + scale * values[i];\n\t\t}\n\t}\n\n\tunmap(value: number): number {\n\t\treturn this._itranslate + this._iscale * value;\n\t}\n\n\tunmapAll(values: number[], ifrom: number, iend: number, stride: number, offset: number): void {\n\t\tconst itranslate = this._itranslate;\n\t\tconst iscale = this._iscale;\n\t\tfor (let i = ifrom + offset; i < iend; i += stride) {\n\t\t\tvalues[i] = itranslate + iscale * values[i];\n\t\t}\n\t}\n\n\tprotected toTheme(options?: DChartCoordinateTransformOptions): DThemeChartCoordinateTransform {\n\t\treturn (options && options.theme) || this.getThemeDefault();\n\t}\n\n\tprotected getThemeDefault(): DThemeChartCoordinateTransform {\n\t\treturn DThemes.getInstance().get(this.getType());\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DChartCoordinateTransform\";\n\t}\n}\n","export interface DChartCoordinateTransformMark {\n\toldTranslate: number;\n\toldScale: number;\n\tnewTranslate: number;\n\tnewScale: number;\n\tset(translate?: number, scale?: number): void;\n}\n\nexport class DChartCoordinateTransformMarkImpl implements DChartCoordinateTransformMark {\n\toldTranslate: number;\n\toldScale: number;\n\tnewTranslate: number;\n\tnewScale: number;\n\n\tconstructor() {\n\t\tthis.oldTranslate = 0;\n\t\tthis.oldScale = 1;\n\t\tthis.newTranslate = 0;\n\t\tthis.newScale = 1;\n\t}\n\n\tset(translate?: number | undefined, scale?: number | undefined): void {\n\t\tif (translate != null) {\n\t\t\tthis.newTranslate = translate;\n\t\t}\n\n\t\tif (scale != null) {\n\t\t\tthis.newScale = scale;\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DChartRegion } from \"./d-chart-region\";\nimport { isNaN } from \"./util/is-nan\";\n\nexport class DChartRegionImpl implements DChartRegion {\n\tfrom: number;\n\tto: number;\n\n\tconstructor(from: number, to: number) {\n\t\tthis.from = from;\n\t\tthis.to = to;\n\t}\n\n\tset(from?: number, to?: number): this {\n\t\tif (from != null) {\n\t\t\tthis.from = from;\n\t\t}\n\t\tif (to != null) {\n\t\t\tthis.to = to;\n\t\t}\n\t\treturn this;\n\t}\n\n\tadd(from: number, to: number): this {\n\t\tif (!isNaN(from)) {\n\t\t\tthis.from = isNaN(this.from) ? from : Math.min(this.from, from);\n\t\t}\n\n\t\tif (!isNaN(to)) {\n\t\t\tthis.to = isNaN(this.to) ? to : Math.max(this.to, to);\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tclear(): this {\n\t\tthis.from = NaN;\n\t\tthis.to = NaN;\n\t\treturn this;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBase } from \"./d-base\";\nimport {\n\tDChartCoordinate,\n\tDChartCoordinateOptions,\n\tDThemeChartCoordinate\n} from \"./d-chart-coordinate\";\nimport { DChartCoordinateContainerSub } from \"./d-chart-coordinate-container-sub\";\nimport { DChartCoordinateDirection } from \"./d-chart-coordinate-direction\";\nimport { DChartCoordinateLinearTick } from \"./d-chart-coordinate-linear-tick\";\nimport { DChartCoordinateTick } from \"./d-chart-coordinate-tick\";\nimport { DChartCoordinateTickMajorStepFunction } from \"./d-chart-coordinate-tick-major-step-function\";\nimport { DChartCoordinateTickMinorStepFunction } from \"./d-chart-coordinate-tick-minor-step-function\";\nimport { DChartCoordinateTransform } from \"./d-chart-coordinate-transform\";\nimport { DChartCoordinateTransformImpl } from \"./d-chart-coordinate-transform-impl\";\nimport {\n\tDChartCoordinateTransformMark,\n\tDChartCoordinateTransformMarkImpl\n} from \"./d-chart-coordinate-transform-mark\";\nimport { DChartPlotArea } from \"./d-chart-plot-area\";\nimport { DChartRegion } from \"./d-chart-region\";\nimport { DChartRegionImpl } from \"./d-chart-region-impl\";\nimport { DThemes } from \"./theme/d-themes\";\nimport { isNaN } from \"./util/is-nan\";\n\nexport class DChartCoordinateLinear<CHART extends DBase = DBase>\n\timplements DChartCoordinate<CHART>\n{\n\tprotected _id: number;\n\tprotected _transform: DChartCoordinateTransform<CHART>;\n\tprotected _container?: DChartCoordinateContainerSub<CHART>;\n\tprotected _direction: DChartCoordinateDirection;\n\tprotected _theme: DThemeChartCoordinate;\n\tprotected _work: DChartRegionImpl;\n\tprotected _tick: DChartCoordinateTick<CHART>;\n\tprotected _mark: DChartCoordinateTransformMarkImpl;\n\tprotected _from?: number;\n\tprotected _to?: number;\n\n\tconstructor(options?: DChartCoordinateOptions) {\n\t\tthis._id = 0;\n\t\tthis._direction = DChartCoordinateDirection.X;\n\t\tthis._theme = this.toTheme(options);\n\t\tthis._transform = new DChartCoordinateTransformImpl(options?.transform);\n\t\tthis._tick = new DChartCoordinateLinearTick<CHART>(options?.tick);\n\t\tthis._work = new DChartRegionImpl(NaN, NaN);\n\t\tthis._mark = new DChartCoordinateTransformMarkImpl();\n\t\tthis._from = options?.from;\n\t\tthis._to = options?.to;\n\t}\n\n\tget from(): number | undefined {\n\t\treturn this._from;\n\t}\n\n\tset from(from: number | undefined) {\n\t\tthis._from = from;\n\t}\n\n\tget to(): number | undefined {\n\t\treturn this._to;\n\t}\n\n\tset to(to: number | undefined) {\n\t\tthis._to = to;\n\t}\n\n\tbind(\n\t\tcontainer: DChartCoordinateContainerSub<CHART>,\n\t\tdirection: DChartCoordinateDirection\n\t): void {\n\t\tthis._container = container;\n\t\tthis._direction = direction;\n\t\tthis._transform.bind(container, direction);\n\t}\n\n\tunbind(): void {\n\t\tthis._container = undefined;\n\t\tthis._transform.unbind();\n\t}\n\n\tfit(from?: number, to?: number): void {\n\t\tthis.doFit(from, to, this._transform);\n\t}\n\n\tmark(from?: number, to?: number): void {\n\t\tconst mark = this._mark;\n\t\tconst transform = this._transform;\n\t\tmark.oldTranslate = transform.translate;\n\t\tmark.oldScale = transform.scale;\n\t\tthis.doFit(from, to, mark);\n\t}\n\n\tblend(ratio: number): void {\n\t\tthis._transform.blend(ratio, this._mark);\n\t}\n\n\tprotected doFit(\n\t\tfrom: number | undefined,\n\t\tto: number | undefined,\n\t\tresult: DChartCoordinateTransformMark | DChartCoordinateTransform<CHART>\n\t): void {\n\t\tconst container = this._container;\n\t\tif (container) {\n\t\t\tconst plotArea = container.container.plotArea;\n\t\t\tconst padding = plotArea.padding;\n\t\t\tconst work = this._work;\n\t\t\tswitch (this._direction) {\n\t\t\t\tcase DChartCoordinateDirection.X:\n\t\t\t\t\tthis.doFit_(\n\t\t\t\t\t\tpadding.getLeft(),\n\t\t\t\t\t\tplotArea.width - padding.getRight(),\n\t\t\t\t\t\tthis.toFitDomain(from, to, plotArea, work),\n\t\t\t\t\t\tresult\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\t\t\t\tcase DChartCoordinateDirection.Y:\n\t\t\t\t\tthis.doFit_(\n\t\t\t\t\t\tplotArea.height - padding.getBottom(),\n\t\t\t\t\t\tpadding.getTop(),\n\t\t\t\t\t\tthis.toFitRange(from, to, plotArea, work),\n\t\t\t\t\t\tresult\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected toFitDomain(\n\t\tfrom: number | undefined,\n\t\tto: number | undefined,\n\t\tplotArea: DChartPlotArea<CHART>,\n\t\tresult: DChartRegion\n\t): DChartRegion {\n\t\tif (from == null) {\n\t\t\tfrom = this._from;\n\t\t}\n\t\tif (to == null) {\n\t\t\tto = this._to;\n\t\t}\n\t\tif (from != null && to != null) {\n\t\t\tresult.set(from, to);\n\t\t} else {\n\t\t\tplotArea.series.getDomain(this, result);\n\t\t\tresult.set(from, to);\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected toFitRange(\n\t\tfrom: number | undefined,\n\t\tto: number | undefined,\n\t\tplotArea: DChartPlotArea<CHART>,\n\t\tresult: DChartRegion\n\t): DChartRegion {\n\t\tif (from == null) {\n\t\t\tfrom = this._from;\n\t\t}\n\t\tif (to == null) {\n\t\t\tto = this._to;\n\t\t}\n\t\tif (from != null && to != null) {\n\t\t\tresult.set(from, to);\n\t\t} else {\n\t\t\tplotArea.series.getRange(this, result);\n\t\t\tresult.set(from, to);\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected doFit_(\n\t\tpixelFrom: number,\n\t\tpixelTo: number,\n\t\tregion: DChartRegion,\n\t\tresult: DChartCoordinateTransformMark | DChartCoordinateTransform<CHART>\n\t): void {\n\t\tconst regionFrom = region.from;\n\t\tconst regionTo = region.to;\n\t\tif (!(isNaN(regionFrom) || isNaN(regionTo))) {\n\t\t\t// Scale\n\t\t\tlet newScale = 1;\n\t\t\tconst regionSize = regionTo - regionFrom;\n\t\t\tif (!this._theme.isZero(regionSize)) {\n\t\t\t\tconst pixelSize = pixelTo - pixelFrom;\n\t\t\t\tnewScale = pixelSize / regionSize;\n\t\t\t} else {\n\t\t\t\tnewScale = pixelTo < pixelFrom ? -1 : 1;\n\t\t\t}\n\n\t\t\t// Translation\n\t\t\tconst newTranslation = pixelFrom - regionFrom * newScale;\n\n\t\t\t// Done\n\t\t\tresult.set(newTranslation, newScale);\n\t\t}\n\t}\n\n\tget id(): number {\n\t\treturn this._id;\n\t}\n\n\tget transform(): DChartCoordinateTransform<CHART> {\n\t\treturn this._transform;\n\t}\n\n\tmap(value: number): number {\n\t\treturn value;\n\t}\n\n\tmapAll(values: number[], ifrom: number, iend: number, stride: number, offset: number): void {\n\t\t// DO NOTHING\n\t}\n\n\tunmap(value: number): number {\n\t\treturn value;\n\t}\n\n\tunmapAll(values: number[], ifrom: number, iend: number, stride: number, offset: number): void {\n\t\t// DO NOTHING\n\t}\n\n\tticks(\n\t\tdomainFrom: number,\n\t\tdomainTo: number,\n\t\tmajorCount: number,\n\t\tmajorStep: number | DChartCoordinateTickMajorStepFunction | undefined,\n\t\tminorCountPerMajor: number,\n\t\tminorCount: number,\n\t\tminorStep: number | DChartCoordinateTickMinorStepFunction | undefined,\n\t\tmajorResult: Float64Array,\n\t\tminorResult: Float64Array\n\t): void {\n\t\tthis._tick.calculate(\n\t\t\tdomainFrom,\n\t\t\tdomainTo,\n\t\t\tmajorCount,\n\t\t\tmajorStep,\n\t\t\tminorCountPerMajor,\n\t\t\tminorCount,\n\t\t\tminorStep,\n\t\t\tmajorResult,\n\t\t\tminorResult,\n\t\t\tthis\n\t\t);\n\t}\n\n\tprotected toTheme(options?: DChartCoordinateOptions): DThemeChartCoordinate {\n\t\treturn (options && options.theme) || this.getThemeDefault();\n\t}\n\n\tprotected getThemeDefault(): DThemeChartCoordinate {\n\t\treturn DThemes.getInstance().get(this.getType());\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DChartCoordinate\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBase } from \"./d-base\";\nimport { DChartCoordinate } from \"./d-chart-coordinate\";\nimport { DChartCoordinateTickOptions, DThemeChartCoordinateTick } from \"./d-chart-coordinate-tick\";\nimport { DChartCoordinateTickMajorStepFunction } from \"./d-chart-coordinate-tick-major-step-function\";\nimport { DChartCoordinateTickMinorStepFunction } from \"./d-chart-coordinate-tick-minor-step-function\";\nimport { DThemes } from \"./theme/d-themes\";\nimport { isNumber } from \"./util/is-number\";\n\nexport interface DThemeChartCoordinateLogTick extends DThemeChartCoordinateTick {}\n\nexport class DChartCoordinateLogTick<CHART extends DBase = DBase> {\n\tprotected _theme: DThemeChartCoordinateTick;\n\n\tconstructor(options?: DChartCoordinateTickOptions) {\n\t\tthis._theme = this.toTheme(options);\n\t}\n\n\tprotected toMajorStep(\n\t\tdomainMin: number,\n\t\tdomainMax: number,\n\t\tmajorCount: number,\n\t\tmajorStep?: number | DChartCoordinateTickMajorStepFunction\n\t): number {\n\t\tif (majorStep == null) {\n\t\t\tif (0 < majorCount) {\n\t\t\t\treturn this.calcStepMajor(domainMin, domainMax, majorCount);\n\t\t\t}\n\t\t\treturn -1;\n\t\t} else if (isNumber(majorStep)) {\n\t\t\treturn majorStep;\n\t\t} else {\n\t\t\treturn majorStep(domainMin, domainMax, majorCount);\n\t\t}\n\t}\n\n\tprotected calcStepMajor(domainMin: number, domainMax: number, majorCount: number): number {\n\t\tconst span = Math.abs(domainMax - domainMin) / majorCount;\n\t\tconst power = Math.floor(Math.log(span) / Math.LN10);\n\t\tconst base = Math.pow(10, power);\n\t\treturn this._theme.toStepScale(span / base) * base;\n\t}\n\n\tprotected toMinorStep(\n\t\tmajorStep: number,\n\t\tminorCount: number,\n\t\tminorStep?: number | DChartCoordinateTickMinorStepFunction\n\t): number {\n\t\tif (minorStep == null) {\n\t\t\tif (0 <= majorStep) {\n\t\t\t\treturn this.calcStepMinor(majorStep, minorCount);\n\t\t\t}\n\t\t\treturn -1;\n\t\t} else if (isNumber(minorStep)) {\n\t\t\treturn minorStep;\n\t\t} else {\n\t\t\treturn minorStep(majorStep, minorCount);\n\t\t}\n\t}\n\n\tprotected calcStepMinor(majorStep: number, minorCount: number): number {\n\t\treturn majorStep / (minorCount + 1);\n\t}\n\n\tprotected calcTickMinorPositions(\n\t\tstep: number,\n\t\tcount: number,\n\t\tmajorPosition: number,\n\t\trangeMin: number,\n\t\trangeMax: number,\n\t\tiresult: number,\n\t\tresult: Float64Array\n\t): void {\n\t\tfor (let i = 0; i < count; i += 1) {\n\t\t\tconst minorPosition = majorPosition + (i + 1) * step;\n\t\t\tif (rangeMin <= minorPosition && minorPosition <= rangeMax) {\n\t\t\t\tresult[iresult++] = minorPosition;\n\t\t\t}\n\t\t}\n\t}\n\n\tcalculate(\n\t\tdomainFrom: number,\n\t\tdomainTo: number,\n\t\tmajorCount: number,\n\t\tmajorStep: number | DChartCoordinateTickMajorStepFunction | undefined,\n\t\tminorCountPerMajor: number,\n\t\tminorCount: number,\n\t\tminorStep: number | DChartCoordinateTickMinorStepFunction | undefined,\n\t\tmajorResult: Float64Array,\n\t\tminorResult: Float64Array,\n\t\tcoordinate: DChartCoordinate<CHART>\n\t): void {\n\t\tif (majorCount <= 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst transform = coordinate.transform;\n\n\t\tconst domainFromMapped = coordinate.map(domainFrom);\n\t\tconst domainToMapped = coordinate.map(domainTo);\n\n\t\tconst domainMinMapped = Math.min(domainFromMapped, domainToMapped);\n\t\tconst domainMaxMapped = Math.max(domainFromMapped, domainToMapped);\n\n\t\tconst majorStepMapped = this.toMajorStep(\n\t\t\tdomainMinMapped,\n\t\t\tdomainMaxMapped,\n\t\t\tmajorCount,\n\t\t\tmajorStep\n\t\t);\n\t\tif (majorStepMapped <= 0) {\n\t\t\tconst domainMin = Math.min(domainFrom, domainTo);\n\t\t\tmajorResult[0] = domainMin;\n\t\t\tmajorResult[1] = transform.map(coordinate.map(domainMin));\n\t\t\tmajorResult[2] = 0;\n\t\t\tfor (let i = 1; i < majorCount; ++i) {\n\t\t\t\tconst imajorResult = i * 3;\n\t\t\t\tmajorResult[imajorResult + 0] = NaN;\n\t\t\t\tmajorResult[imajorResult + 1] = NaN;\n\t\t\t\tmajorResult[imajorResult + 2] = NaN;\n\t\t\t}\n\t\t\tfor (let i = 0; i < minorCount; ++i) {\n\t\t\t\tconst iminorResult = i * 3;\n\t\t\t\tminorResult[iminorResult + 0] = NaN;\n\t\t\t\tminorResult[iminorResult + 1] = NaN;\n\t\t\t\tminorResult[iminorResult + 2] = NaN;\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\t// Major tick start position\n\t\tconst idomainStartMapped = Math.floor(domainMinMapped / majorStepMapped) - 1;\n\t\tconst idomainEndMapped = Math.ceil(domainMaxMapped / majorStepMapped) + 1;\n\n\t\t// Major / minor tick positions\n\t\tconst minorStepMapped = this.toMinorStep(majorStepMapped, minorCountPerMajor, minorStep);\n\t\tlet imajor = 0;\n\t\tlet iminor = 0;\n\t\tfor (let i = idomainStartMapped; i <= idomainEndMapped; ++i) {\n\t\t\tconst majorPositionMapped = i * majorStepMapped;\n\t\t\tif (imajor < majorCount) {\n\t\t\t\tif (\n\t\t\t\t\tdomainMinMapped <= majorPositionMapped &&\n\t\t\t\t\tmajorPositionMapped <= domainMaxMapped\n\t\t\t\t) {\n\t\t\t\t\tconst imajorResult = imajor * 3;\n\t\t\t\t\tmajorResult[imajorResult + 0] = coordinate.unmap(majorPositionMapped);\n\t\t\t\t\tmajorResult[imajorResult + 1] = transform.map(majorPositionMapped);\n\t\t\t\t\tmajorResult[imajorResult + 2] = coordinate.unmap(majorPositionMapped - 1);\n\t\t\t\t\timajor += 1;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (let j = 0; j < minorCountPerMajor; j += 1) {\n\t\t\t\tif (iminor < minorCount) {\n\t\t\t\t\tconst minorPositionMapped = majorPositionMapped + (j + 1) * minorStepMapped;\n\t\t\t\t\tif (\n\t\t\t\t\t\tdomainMinMapped <= minorPositionMapped &&\n\t\t\t\t\t\tminorPositionMapped <= domainMaxMapped\n\t\t\t\t\t) {\n\t\t\t\t\t\tconst iminorResult = iminor * 3;\n\t\t\t\t\t\tminorResult[iminorResult + 0] = coordinate.unmap(minorPositionMapped);\n\t\t\t\t\t\tminorResult[iminorResult + 1] = transform.map(minorPositionMapped);\n\t\t\t\t\t\tminorResult[iminorResult + 2] = coordinate.unmap(minorPositionMapped - 1);\n\t\t\t\t\t\timinor += 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfor (let i = imajor; i < majorCount; ++i) {\n\t\t\tconst imajorResult = i * 3;\n\t\t\tmajorResult[imajorResult + 0] = NaN;\n\t\t\tmajorResult[imajorResult + 1] = NaN;\n\t\t\tmajorResult[imajorResult + 2] = NaN;\n\t\t}\n\t\tfor (let i = iminor; i < minorCount; ++i) {\n\t\t\tconst iminorResult = i * 3;\n\t\t\tminorResult[iminorResult + 0] = NaN;\n\t\t\tminorResult[iminorResult + 1] = NaN;\n\t\t\tminorResult[iminorResult + 2] = NaN;\n\t\t}\n\t}\n\n\tprotected toTheme(options?: DChartCoordinateTickOptions): DThemeChartCoordinateTick {\n\t\treturn (options && options.theme) || this.getThemeDefault();\n\t}\n\n\tprotected getThemeDefault(): DThemeChartCoordinateTick {\n\t\treturn DThemes.getInstance().get(this.getType());\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DChartCoordinateTick\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBase } from \"./d-base\";\nimport {\n\tDChartCoordinate,\n\tDChartCoordinateOptions,\n\tDThemeChartCoordinate\n} from \"./d-chart-coordinate\";\nimport { DChartCoordinateContainerSub } from \"./d-chart-coordinate-container-sub\";\nimport { DChartCoordinateDirection } from \"./d-chart-coordinate-direction\";\nimport { DChartCoordinateLogTick } from \"./d-chart-coordinate-log-tick\";\nimport { DChartCoordinateTick } from \"./d-chart-coordinate-tick\";\nimport { DChartCoordinateTickMajorStepFunction } from \"./d-chart-coordinate-tick-major-step-function\";\nimport { DChartCoordinateTickMinorStepFunction } from \"./d-chart-coordinate-tick-minor-step-function\";\nimport { DChartCoordinateTransform } from \"./d-chart-coordinate-transform\";\nimport { DChartCoordinateTransformImpl } from \"./d-chart-coordinate-transform-impl\";\nimport {\n\tDChartCoordinateTransformMark,\n\tDChartCoordinateTransformMarkImpl\n} from \"./d-chart-coordinate-transform-mark\";\nimport { DChartPlotArea } from \"./d-chart-plot-area\";\nimport { DChartRegion } from \"./d-chart-region\";\nimport { DChartRegionImpl } from \"./d-chart-region-impl\";\nimport { DThemes } from \"./theme/d-themes\";\nimport { isNaN } from \"./util/is-nan\";\n\nexport class DChartCoordinateLog<CHART extends DBase = DBase> implements DChartCoordinate<CHART> {\n\tprotected _id: number;\n\tprotected _transform: DChartCoordinateTransform<CHART>;\n\tprotected _container?: DChartCoordinateContainerSub<CHART>;\n\tprotected _direction: DChartCoordinateDirection;\n\tprotected _theme: DThemeChartCoordinate;\n\tprotected _work: DChartRegionImpl;\n\tprotected _tick: DChartCoordinateTick<CHART>;\n\tprotected _mark: DChartCoordinateTransformMarkImpl;\n\tprotected _from?: number;\n\tprotected _to?: number;\n\n\tconstructor(options?: DChartCoordinateOptions) {\n\t\tthis._id = 0;\n\t\tthis._direction = DChartCoordinateDirection.X;\n\t\tthis._theme = this.toTheme(options);\n\t\tthis._transform = new DChartCoordinateTransformImpl(options?.transform);\n\t\tthis._tick = new DChartCoordinateLogTick<CHART>(options?.tick);\n\t\tthis._work = new DChartRegionImpl(NaN, NaN);\n\t\tthis._mark = new DChartCoordinateTransformMarkImpl();\n\t\tthis._from = options?.from;\n\t\tthis._to = options?.to;\n\t}\n\n\tget from(): number | undefined {\n\t\treturn this._from;\n\t}\n\n\tset from(from: number | undefined) {\n\t\tthis._from = from;\n\t}\n\n\tget to(): number | undefined {\n\t\treturn this._to;\n\t}\n\n\tset to(to: number | undefined) {\n\t\tthis._to = to;\n\t}\n\n\tbind(\n\t\tcontainer: DChartCoordinateContainerSub<CHART>,\n\t\tdirection: DChartCoordinateDirection\n\t): void {\n\t\tthis._container = container;\n\t\tthis._direction = direction;\n\t}\n\n\tunbind(): void {\n\t\tthis._container = undefined;\n\t}\n\n\tfit(from?: number, to?: number): void {\n\t\tthis.doFit(from, to, this._transform);\n\t}\n\n\tmark(from?: number, to?: number): void {\n\t\tconst mark = this._mark;\n\t\tconst transform = this._transform;\n\t\tmark.oldTranslate = transform.translate;\n\t\tmark.oldScale = transform.scale;\n\t\tthis.doFit(from, to, mark);\n\t}\n\n\tblend(ratio: number): void {\n\t\tthis._transform.blend(ratio, this._mark);\n\t}\n\n\tprotected doFit(\n\t\tfrom: number | undefined,\n\t\tto: number | undefined,\n\t\tresult: DChartCoordinateTransformMark | DChartCoordinateTransform<CHART>\n\t): void {\n\t\tconst container = this._container;\n\t\tif (container) {\n\t\t\tconst plotArea = container.container.plotArea;\n\t\t\tconst padding = plotArea.padding;\n\t\t\tconst work = this._work;\n\t\t\tswitch (this._direction) {\n\t\t\t\tcase DChartCoordinateDirection.X:\n\t\t\t\t\tthis.doFit_(\n\t\t\t\t\t\tpadding.getLeft(),\n\t\t\t\t\t\tplotArea.width - padding.getRight(),\n\t\t\t\t\t\tthis.toFitDomain(from, to, plotArea, work),\n\t\t\t\t\t\tresult\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\t\t\t\tcase DChartCoordinateDirection.Y:\n\t\t\t\t\tthis.doFit_(\n\t\t\t\t\t\tplotArea.height - padding.getBottom(),\n\t\t\t\t\t\tpadding.getTop(),\n\t\t\t\t\t\tthis.toFitRange(from, to, plotArea, work),\n\t\t\t\t\t\tresult\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected toFitDomain(\n\t\tfrom: number | undefined,\n\t\tto: number | undefined,\n\t\tplotArea: DChartPlotArea<CHART>,\n\t\tresult: DChartRegion\n\t): DChartRegion {\n\t\tif (from == null) {\n\t\t\tfrom = this._from;\n\t\t}\n\t\tif (to == null) {\n\t\t\tto = this._to;\n\t\t}\n\t\tif (from != null && to != null) {\n\t\t\tresult.set(from, to);\n\t\t} else {\n\t\t\tplotArea.series.getDomain(this, result);\n\t\t\tresult.set(from, to);\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected toFitRange(\n\t\tfrom: number | undefined,\n\t\tto: number | undefined,\n\t\tplotArea: DChartPlotArea<CHART>,\n\t\tresult: DChartRegion\n\t): DChartRegion {\n\t\tif (from == null) {\n\t\t\tfrom = this._from;\n\t\t}\n\t\tif (to == null) {\n\t\t\tto = this._to;\n\t\t}\n\t\tif (from != null && to != null) {\n\t\t\tresult.set(from, to);\n\t\t} else {\n\t\t\tplotArea.series.getRange(this, result);\n\t\t\tresult.set(from, to);\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected doFit_(\n\t\tpixelFrom: number,\n\t\tpixelTo: number,\n\t\tregion: DChartRegion,\n\t\tresult: DChartCoordinateTransformMark | DChartCoordinateTransform<CHART>\n\t): void {\n\t\tconst regionFrom = region.from;\n\t\tconst regionTo = region.to;\n\t\tif (!(isNaN(regionFrom) || isNaN(regionTo))) {\n\t\t\t// Scale\n\t\t\tlet newScale = 1;\n\t\t\tconst regionFromMapped = this.map(regionFrom);\n\t\t\tconst regionToMapped = this.map(regionTo);\n\t\t\tconst regionSizeMapped = regionToMapped - regionFromMapped;\n\t\t\tif (!this._theme.isZero(regionSizeMapped)) {\n\t\t\t\tconst pixelSize = pixelTo - pixelFrom;\n\t\t\t\tnewScale = pixelSize / regionSizeMapped;\n\t\t\t} else {\n\t\t\t\tnewScale = pixelTo < pixelFrom ? -1 : 1;\n\t\t\t}\n\n\t\t\t// Translation\n\t\t\tconst newTranslation = pixelFrom - regionFromMapped * newScale;\n\n\t\t\t// Done\n\t\t\tresult.set(newTranslation, newScale);\n\t\t}\n\t}\n\n\tget id(): number {\n\t\treturn this._id;\n\t}\n\n\tget transform(): DChartCoordinateTransform<CHART> {\n\t\treturn this._transform;\n\t}\n\n\tmap(value: number): number {\n\t\treturn Math.log(Math.max(0, value)) / Math.LN10;\n\t}\n\n\tmapAll(values: number[], ifrom: number, iend: number, stride: number, offset: number): void {\n\t\tconst factor = 1 / Math.LN10;\n\t\tfor (let i = ifrom + offset; i < iend; i += stride) {\n\t\t\tconst value = values[i];\n\t\t\tvalues[i] = Math.log(Math.max(0, value)) * factor;\n\t\t}\n\t}\n\n\tunmap(value: number): number {\n\t\treturn Math.pow(10, value);\n\t}\n\n\tunmapAll(values: number[], ifrom: number, iend: number, stride: number, offset: number): void {\n\t\tfor (let i = ifrom + offset; i < iend; i += stride) {\n\t\t\tvalues[i] = Math.pow(10, values[i]);\n\t\t}\n\t}\n\n\tticks(\n\t\tdomainFrom: number,\n\t\tdomainTo: number,\n\t\tmajorCount: number,\n\t\tmajorStep: number | DChartCoordinateTickMajorStepFunction | undefined,\n\t\tminorCountPerMajor: number,\n\t\tminorCount: number,\n\t\tminorStep: number | DChartCoordinateTickMinorStepFunction | undefined,\n\t\tmajorResult: Float64Array,\n\t\tminorResult: Float64Array\n\t): void {\n\t\tthis._tick.calculate(\n\t\t\tdomainFrom,\n\t\t\tdomainTo,\n\t\t\tmajorCount,\n\t\t\tmajorStep,\n\t\t\tminorCountPerMajor,\n\t\t\tminorCount,\n\t\t\tminorStep,\n\t\t\tmajorResult,\n\t\t\tminorResult,\n\t\t\tthis\n\t\t);\n\t}\n\n\tprotected toTheme(options?: DChartCoordinateOptions): DThemeChartCoordinate {\n\t\treturn (options && options.theme) || this.getThemeDefault();\n\t}\n\n\tprotected getThemeDefault(): DThemeChartCoordinate {\n\t\treturn DThemes.getInstance().get(this.getType());\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DChartCoordinate\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBase, DBaseOptions, DThemeBase } from \"./d-base\";\n\nexport interface DChartLegendItemOptions<THEME extends DThemeChartLegendItem>\n\textends DBaseOptions<THEME> {}\n\nexport interface DThemeChartLegendItem extends DThemeBase {}\n\nexport class DChartLegendItem<\n\tTHEME extends DThemeChartLegendItem = DThemeChartLegendItem,\n\tOPTIONS extends DChartLegendItemOptions<THEME> = DChartLegendItemOptions<THEME>\n> extends DBase<THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DChartLegendItem\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBase, DBaseOptions, DThemeBase } from \"./d-base\";\n\nexport interface DChartLegendOptions<THEME extends DThemeChartLegend> extends DBaseOptions<THEME> {}\n\nexport interface DThemeChartLegend extends DThemeBase {}\n\nexport class DChartLegend<\n\tTHEME extends DThemeChartLegend = DThemeChartLegend,\n\tOPTIONS extends DChartLegendOptions<THEME> = DChartLegendOptions<THEME>\n> extends DBase<THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DChartLegend\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBase, DBaseOptions, DThemeBase } from \"./d-base\";\n\nexport interface DChartOverviewOptions<THEME extends DThemeChartOverview>\n\textends DBaseOptions<THEME> {}\n\nexport interface DThemeChartOverview extends DThemeBase {}\n\nexport class DChartOverview<\n\tTHEME extends DThemeChartOverview = DThemeChartOverview,\n\tOPTIONS extends DChartOverviewOptions<THEME> = DChartOverviewOptions<THEME>\n> extends DBase<THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DChartOverview\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Rectangle, Transform } from \"pixi.js\";\nimport { DBasePoint } from \"./d-base-point\";\nimport { DViewTarget } from \"./d-view-to-target\";\nimport { EShapeContainer } from \"./shape/e-shape-container\";\n\nexport class DChartPlotAreaContainer extends EShapeContainer implements DViewTarget {\n\tprotected _position: DBasePoint;\n\tprotected _scale: DBasePoint;\n\tprotected _workRect: Rectangle;\n\n\tconstructor(onChange: () => void) {\n\t\tsuper();\n\t\tconst transform: Transform = this.transform;\n\t\tthis._position = new DBasePoint(transform.position, onChange);\n\t\tthis._scale = new DBasePoint(transform.scale, onChange);\n\t\tthis._workRect = new Rectangle();\n\t}\n\n\t// @ts-ignore\n\tget position(): DBasePoint {\n\t\treturn this._position;\n\t}\n\n\t// @ts-ignore\n\tget scale(): DBasePoint {\n\t\treturn this._scale;\n\t}\n\n\tgetBounds(skipUpdate?: boolean, rect?: Rectangle): Rectangle {\n\t\t(this as any)._lastBoundsID = -1;\n\t\treturn super.getBounds(skipUpdate, rect);\n\t}\n\n\tcalculateBounds(): void {\n\t\tconst bounds = this._bounds;\n\t\tconst work = this._work;\n\t\tconst rect = this._workRect;\n\t\tconst worldTransform = this.transform.worldTransform;\n\n\t\tlet xmin = 0;\n\t\tlet xmax = 0;\n\t\tlet ymin = 0;\n\t\tlet ymax = 0;\n\t\tconst children = this.children;\n\t\tif (0 < children.length) {\n\t\t\tlet isFirst = true;\n\t\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\t\tconst child = children[i];\n\t\t\t\tif (child.visible) {\n\t\t\t\t\tchild.getBoundsInternal(work, false, rect);\n\t\t\t\t\tif (isFirst) {\n\t\t\t\t\t\tisFirst = false;\n\t\t\t\t\t\txmin = rect.x;\n\t\t\t\t\t\tymin = rect.y;\n\t\t\t\t\t\txmax = rect.x + rect.width;\n\t\t\t\t\t\tymax = rect.y + rect.height;\n\t\t\t\t\t} else {\n\t\t\t\t\t\txmin = Math.min(xmin, rect.x);\n\t\t\t\t\t\tymin = Math.min(ymin, rect.y);\n\t\t\t\t\t\txmax = Math.max(xmax, rect.x + rect.width);\n\t\t\t\t\t\tymax = Math.max(ymax, rect.y + rect.height);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tbounds.clear();\n\n\t\twork.set(xmin, ymin);\n\t\tworldTransform.apply(work, work);\n\t\tbounds.addPoint(work);\n\n\t\twork.set(xmax, ymax);\n\t\tworldTransform.apply(work, work);\n\t\tbounds.addPoint(work);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBase } from \"./d-base\";\nimport { DBaseStateSet } from \"./d-base-state-set\";\nimport { DChartRegionImmutable } from \"./d-chart-region\";\nimport { DChartSeriesContainer } from \"./d-chart-series-container\";\nimport { DChartSeriesCoordinateContainer } from \"./d-chart-series-coordinate\";\nimport { EShape } from \"./shape/e-shape\";\n\nexport class DChartSeriesHitResult {\n\tshape: EShape | null;\n\tx: number;\n\ty: number;\n\tp0x: number;\n\tp0y: number;\n\tp1x: number;\n\tp1y: number;\n\tindex: number;\n\tt: number;\n\tdistance: number;\n\n\tconstructor() {\n\t\tthis.shape = null;\n\t\tthis.x = 0;\n\t\tthis.y = 0;\n\t\tthis.p0x = 0;\n\t\tthis.p0y = 0;\n\t\tthis.p1x = 0;\n\t\tthis.p1y = 0;\n\t\tthis.index = 0;\n\t\tthis.t = 0;\n\t\tthis.distance = 0;\n\t}\n\n\tcopyFrom(other: DChartSeriesHitResult): this {\n\t\tthis.shape = other.shape;\n\t\tthis.x = other.x;\n\t\tthis.y = other.y;\n\t\tthis.p0x = other.p0x;\n\t\tthis.p0y = other.p0y;\n\t\tthis.p1x = other.p1x;\n\t\tthis.p1y = other.p1y;\n\t\tthis.index = other.index;\n\t\tthis.t = other.t;\n\t\tthis.distance = other.distance;\n\t\treturn this;\n\t}\n}\n\nexport interface DChartSeries<CHART extends DBase = DBase> {\n\treadonly domain: DChartRegionImmutable;\n\treadonly range: DChartRegionImmutable;\n\treadonly shape: EShape | null;\n\treadonly container: DChartSeriesContainer<CHART> | null;\n\treadonly coordinate: DChartSeriesCoordinateContainer<CHART>;\n\treadonly index: number;\n\treadonly state: DBaseStateSet;\n\n\tbind(container: DChartSeriesContainer<CHART>, index: number): void;\n\tunbind(): void;\n\n\ttoDirty(): void;\n\n\tupdate(): void;\n\tdestroy(): void;\n\n\thitTest(x: number, y: number): boolean;\n\tcalcHitPoint(x: number, y: number, result: DChartSeriesHitResult): boolean;\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DChartSeriesFill } from \"./d-chart-series-fill\";\nimport {\n\tDChartSeriesFillComputed,\n\tDChartSeriesFillComputedOptions\n} from \"./d-chart-series-fill-computed\";\n\nexport class DChartSeriesFillComputedImpl implements DChartSeriesFillComputed {\n\tenable: boolean;\n\tcolor: number;\n\talpha: number;\n\n\tconstructor(enable: boolean, color: number, alpha: number) {\n\t\tthis.enable = enable;\n\t\tthis.color = color;\n\t\tthis.alpha = alpha;\n\t}\n\n\tstatic from(\n\t\tbase: DChartSeriesFill,\n\t\tindex: number,\n\t\tfill?: DChartSeriesFillComputedOptions\n\t): DChartSeriesFillComputed {\n\t\treturn new DChartSeriesFillComputedImpl(\n\t\t\tfill?.enable ?? base.enable(index),\n\t\t\tfill?.color ?? base.color(index),\n\t\t\tfill?.alpha ?? base.alpha(index)\n\t\t);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { isArray } from \"./util/is-array\";\nimport { isFunction } from \"./util/is-function\";\n\nexport type DChartSeriesScalar<T> = (index: number) => T;\n\nexport class DChartSeriesScalars {\n\tstatic from<T>(\n\t\tvalue: T | T[] | DChartSeriesScalar<T> | undefined,\n\t\tdef: T | T[] | DChartSeriesScalar<T>\n\t): DChartSeriesScalar<T> {\n\t\tif (isArray(value)) {\n\t\t\treturn (index: number) => value[index % value.length];\n\t\t} else if (isFunction(value)) {\n\t\t\treturn value;\n\t\t} else if (value != null) {\n\t\t\treturn () => value;\n\t\t} else if (isArray(def)) {\n\t\t\treturn (index: number) => def[index % def.length];\n\t\t} else if (isFunction(def)) {\n\t\t\treturn def;\n\t\t} else {\n\t\t\treturn () => def;\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DChartColorSet2 } from \"./d-chart-color-set\";\nimport { DChartSeriesFill, DChartSeriesFillOptions } from \"./d-chart-series-fill\";\nimport { DChartSeriesScalar, DChartSeriesScalars } from \"./d-chart-series-scalar\";\nimport { EShapeDefaults } from \"./shape/e-shape-defaults\";\n\nexport class DChartSeriesFillImpl implements DChartSeriesFill {\n\tenable: DChartSeriesScalar<boolean>;\n\tcolor: DChartSeriesScalar<number>;\n\talpha: DChartSeriesScalar<number>;\n\n\tconstructor(options?: DChartSeriesFillOptions) {\n\t\tthis.enable = DChartSeriesScalars.from(options?.enable, true);\n\t\tthis.color = DChartSeriesScalars.from(options?.color, DChartColorSet2);\n\t\tthis.alpha = DChartSeriesScalars.from(options?.alpha, EShapeDefaults.FILL_ALPHA);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DChartSeriesPadding } from \"./d-chart-series-padding\";\nimport {\n\tDChartSeriesPaddingComputed,\n\tDChartSeriesPaddingComputedOptions\n} from \"./d-chart-series-padding-computed\";\n\nexport class DChartSeriesPaddingComputedImpl implements DChartSeriesPaddingComputed {\n\touter: number;\n\tinner: number;\n\n\tconstructor(outer: number, inner: number) {\n\t\tthis.outer = outer;\n\t\tthis.inner = inner;\n\t}\n\n\tstatic from(\n\t\tbase: DChartSeriesPadding,\n\t\tindex: number,\n\t\tpoint: DChartSeriesPaddingComputedOptions | undefined\n\t): DChartSeriesPaddingComputed {\n\t\treturn new DChartSeriesPaddingComputedImpl(\n\t\t\tpoint?.outer ?? base.outer(index),\n\t\t\tpoint?.inner ?? base.inner(index)\n\t\t);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DChartSeriesPadding, DChartSeriesPaddingOptions } from \"./d-chart-series-padding\";\nimport { DChartSeriesScalar, DChartSeriesScalars } from \"./d-chart-series-scalar\";\n\nexport class DChartSeriesPaddingImpl implements DChartSeriesPadding {\n\touter: DChartSeriesScalar<number>;\n\tinner: DChartSeriesScalar<number>;\n\n\tconstructor(options: DChartSeriesPaddingOptions | undefined) {\n\t\tthis.outer = DChartSeriesScalars.from(options?.outer, 0.2);\n\t\tthis.inner = DChartSeriesScalars.from(options?.inner, 0.1);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DChartSeriesPoint } from \"./d-chart-series-point\";\nimport {\n\tDChartSeriesPointComputed,\n\tDChartSeriesPointComputedOptions\n} from \"./d-chart-series-point-computed\";\n\nexport class DChartSeriesPointComputedImpl implements DChartSeriesPointComputed {\n\tx: number;\n\ty: number;\n\n\tconstructor(x: number, y: number) {\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t}\n\n\tstatic from(\n\t\tbase: DChartSeriesPoint,\n\t\tindex: number,\n\t\tpoint: DChartSeriesPointComputedOptions | undefined,\n\t\tx: number,\n\t\ty: number\n\t): DChartSeriesPointComputed {\n\t\treturn new DChartSeriesPointComputedImpl(\n\t\t\tpoint?.x ?? (base.x != null ? base.x(index) : x),\n\t\t\tpoint?.y ?? (base.y != null ? base.y(index) : y)\n\t\t);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DChartSeriesPoint, DChartSeriesPointOptions } from \"./d-chart-series-point\";\nimport { DChartSeriesScalar, DChartSeriesScalars } from \"./d-chart-series-scalar\";\n\nexport class DChartSeriesPointImpl implements DChartSeriesPoint {\n\tx?: DChartSeriesScalar<number>;\n\ty?: DChartSeriesScalar<number>;\n\n\tconstructor(options: DChartSeriesPointOptions | undefined) {\n\t\tif (options) {\n\t\t\tif (options.x != null) {\n\t\t\t\tthis.x = DChartSeriesScalars.from(options.x, 0);\n\t\t\t}\n\n\t\t\tif (options.y != null) {\n\t\t\t\tthis.y = DChartSeriesScalars.from(options.y, 0);\n\t\t\t}\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DChartSeriesStroke } from \"./d-chart-series-stroke\";\nimport {\n\tDChartSeriesStrokeComputed,\n\tDChartSeriesStrokeComputedOptions\n} from \"./d-chart-series-stroke-computed\";\nimport { EShapeStrokeSide } from \"./shape/e-shape-stroke-side\";\nimport { EShapeStrokeStyle } from \"./shape/e-shape-stroke-style\";\n\nexport class DChartSeriesStrokeComputedImpl implements DChartSeriesStrokeComputed {\n\tenable: boolean;\n\tcolor: number;\n\talpha: number;\n\twidth: number;\n\talign: number;\n\tside: EShapeStrokeSide;\n\tstyle: EShapeStrokeStyle;\n\n\tconstructor(\n\t\tenable: boolean,\n\t\tcolor: number,\n\t\talpha: number,\n\t\twidth: number,\n\t\talign: number,\n\t\tside: EShapeStrokeSide,\n\t\tstyle: EShapeStrokeStyle\n\t) {\n\t\tthis.enable = enable;\n\t\tthis.color = color;\n\t\tthis.alpha = alpha;\n\t\tthis.width = width;\n\t\tthis.align = align;\n\t\tthis.side = side;\n\t\tthis.style = style;\n\t}\n\n\tstatic from(\n\t\tbase: DChartSeriesStroke,\n\t\tindex: number,\n\t\tstroke?: DChartSeriesStrokeComputedOptions\n\t): DChartSeriesStrokeComputed {\n\t\treturn new DChartSeriesStrokeComputedImpl(\n\t\t\tstroke?.enable ?? base.enable(index),\n\t\t\tstroke?.color ?? base.color(index),\n\t\t\tstroke?.alpha ?? base.alpha(index),\n\t\t\tstroke?.width ?? base.width(index),\n\t\t\tstroke?.align ?? base.align(index),\n\t\t\tstroke?.side ?? base.side(index),\n\t\t\tstroke?.style ?? base.style(index)\n\t\t);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DChartColorSet2 } from \"./d-chart-color-set\";\nimport { DChartSeriesScalar, DChartSeriesScalars } from \"./d-chart-series-scalar\";\nimport { DChartSeriesStroke, DChartSeriesStrokeOptions } from \"./d-chart-series-stroke\";\nimport { EShapeDefaults } from \"./shape/e-shape-defaults\";\nimport { EShapeStrokeSide } from \"./shape/e-shape-stroke-side\";\nimport { EShapeStrokeStyle } from \"./shape/e-shape-stroke-style\";\n\nexport class DChartSeriesStrokeImpl implements DChartSeriesStroke {\n\tenable: DChartSeriesScalar<boolean>;\n\tcolor: DChartSeriesScalar<number>;\n\talpha: DChartSeriesScalar<number>;\n\twidth: DChartSeriesScalar<number>;\n\talign: DChartSeriesScalar<number>;\n\tside: DChartSeriesScalar<EShapeStrokeSide>;\n\tstyle: DChartSeriesScalar<EShapeStrokeStyle>;\n\n\tconstructor(options?: DChartSeriesStrokeOptions) {\n\t\tthis.enable = DChartSeriesScalars.from(options?.enable, true);\n\t\tthis.color = DChartSeriesScalars.from(options?.color, DChartColorSet2);\n\t\tthis.alpha = DChartSeriesScalars.from(options?.alpha, EShapeDefaults.STROKE_ALPHA);\n\t\tthis.width = DChartSeriesScalars.from(options?.width, EShapeDefaults.STROKE_WIDTH);\n\t\tthis.align = DChartSeriesScalars.from(options?.width, EShapeDefaults.STROKE_ALIGN);\n\t\tthis.side = DChartSeriesScalars.from(options?.side, EShapeStrokeSide.ALL);\n\t\tthis.style = DChartSeriesScalars.from(options?.style, EShapeStrokeStyle.NON_SCALING);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBase } from \"./d-base\";\nimport { DChartCoordinate } from \"./d-chart-coordinate\";\nimport { DChartPlotArea } from \"./d-chart-plot-area\";\nimport { DChartRegion } from \"./d-chart-region\";\nimport { DChartRegionImpl } from \"./d-chart-region-impl\";\nimport { DChartSelection } from \"./d-chart-selection\";\nimport { DChartSeries, DChartSeriesHitResult } from \"./d-chart-series\";\nimport { DChartSeriesContainer, DChartSeriesContainerOptions } from \"./d-chart-series-container\";\nimport {\n\tDChartSeriesFillComputed,\n\tDChartSeriesFillComputedOptions\n} from \"./d-chart-series-fill-computed\";\nimport { DChartSeriesFillComputedImpl } from \"./d-chart-series-fill-computed-impl\";\nimport { DChartSeriesFillImpl } from \"./d-chart-series-fill-impl\";\nimport {\n\tDChartSeriesPaddingComputed,\n\tDChartSeriesPaddingComputedOptions\n} from \"./d-chart-series-padding-computed\";\nimport { DChartSeriesPaddingComputedImpl } from \"./d-chart-series-padding-computed-impl\";\nimport { DChartSeriesPaddingImpl } from \"./d-chart-series-padding-impl\";\nimport {\n\tDChartSeriesPointComputed,\n\tDChartSeriesPointComputedOptions\n} from \"./d-chart-series-point-computed\";\nimport { DChartSeriesPointComputedImpl } from \"./d-chart-series-point-computed-impl\";\nimport { DChartSeriesPointImpl } from \"./d-chart-series-point-impl\";\nimport {\n\tDChartSeriesStrokeComputed,\n\tDChartSeriesStrokeComputedOptions\n} from \"./d-chart-series-stroke-computed\";\nimport { DChartSeriesStrokeComputedImpl } from \"./d-chart-series-stroke-computed-impl\";\nimport { DChartSeriesStrokeImpl } from \"./d-chart-series-stroke-impl\";\n\nexport class DChartSeriesContainerImpl<CHART extends DBase = DBase>\n\timplements DChartSeriesContainer<CHART>\n{\n\tprotected static WORK_CALCHITPOINT: DChartSeriesHitResult = new DChartSeriesHitResult();\n\n\tprotected _plotArea: DChartPlotArea<CHART>;\n\tprotected _list: DChartSeries<CHART>[];\n\tprotected _domain: DChartRegionImpl;\n\tprotected _range: DChartRegionImpl;\n\tprotected _selection: DChartSelection<CHART> | null;\n\n\tprotected _fill: DChartSeriesFillImpl;\n\tprotected _stroke: DChartSeriesStrokeImpl;\n\tprotected _size: DChartSeriesPointImpl;\n\tprotected _offset: DChartSeriesPointImpl;\n\tprotected _padding: DChartSeriesPaddingImpl;\n\n\tconstructor(plotArea: DChartPlotArea<CHART>, options?: DChartSeriesContainerOptions<CHART>) {\n\t\tthis._plotArea = plotArea;\n\t\tthis._domain = new DChartRegionImpl(NaN, NaN);\n\t\tthis._range = new DChartRegionImpl(NaN, NaN);\n\t\tthis._selection = options?.selection ?? null;\n\n\t\tthis._fill = new DChartSeriesFillImpl(options?.fill);\n\t\tthis._stroke = new DChartSeriesStrokeImpl(options?.stroke);\n\t\tthis._size = new DChartSeriesPointImpl(options?.size);\n\t\tthis._offset = new DChartSeriesPointImpl(options?.offset);\n\t\tthis._padding = new DChartSeriesPaddingImpl(options?.padding);\n\n\t\tthis._list = [];\n\t\tconst list = options && options.list;\n\t\tif (list) {\n\t\t\tconst listLength = list.length;\n\t\t\tif (0 < listLength) {\n\t\t\t\tfor (let i = 0; i < listLength; ++i) {\n\t\t\t\t\tthis.add(list[i]);\n\t\t\t\t}\n\t\t\t\tthis.update();\n\t\t\t}\n\t\t}\n\t}\n\n\tnewFill(\n\t\tindex: number,\n\t\toptions: DChartSeriesFillComputedOptions | undefined\n\t): DChartSeriesFillComputed {\n\t\treturn DChartSeriesFillComputedImpl.from(this._fill, index, options);\n\t}\n\n\tnewStroke(\n\t\tindex: number,\n\t\toptions: DChartSeriesStrokeComputedOptions | undefined\n\t): DChartSeriesStrokeComputed {\n\t\treturn DChartSeriesStrokeComputedImpl.from(this._stroke, index, options);\n\t}\n\n\tnewSize(\n\t\tindex: number,\n\t\toptions: DChartSeriesPointComputedOptions | undefined,\n\t\tx: number,\n\t\ty: number\n\t): DChartSeriesPointComputed {\n\t\treturn DChartSeriesPointComputedImpl.from(this._size, index, options, x, y);\n\t}\n\n\tnewOffset(\n\t\tindex: number,\n\t\toptions: DChartSeriesPointComputedOptions | undefined,\n\t\tx: number,\n\t\ty: number\n\t): DChartSeriesPointComputed {\n\t\treturn DChartSeriesPointComputedImpl.from(this._offset, index, options, x, y);\n\t}\n\n\tnewPadding(\n\t\tindex: number,\n\t\toptions: DChartSeriesPaddingComputedOptions | undefined\n\t): DChartSeriesPaddingComputed {\n\t\treturn DChartSeriesPaddingComputedImpl.from(this._padding, index, options);\n\t}\n\n\tget plotArea(): DChartPlotArea<CHART> {\n\t\treturn this._plotArea;\n\t}\n\n\tget selection(): DChartSelection<CHART> | null {\n\t\treturn this._selection;\n\t}\n\n\tupdate(): void {\n\t\tconst list = this._list;\n\t\tfor (let i = 0, imax = list.length; i < imax; ++i) {\n\t\t\tlist[i].update();\n\t\t}\n\t\tconst selection = this._selection;\n\t\tif (selection) {\n\t\t\tselection.update();\n\t\t}\n\t}\n\n\tadd(series: DChartSeries<CHART>): void {\n\t\tconst list = this._list;\n\t\tseries.bind(this, list.length);\n\t\tlist.push(series);\n\t}\n\n\tget(index: number): DChartSeries<CHART> | null {\n\t\tconst list = this._list;\n\t\tif (0 <= index && index < list.length) {\n\t\t\treturn list[index];\n\t\t}\n\t\treturn null;\n\t}\n\n\tindexOf(series: DChartSeries<CHART>): number {\n\t\treturn this._list.indexOf(series);\n\t}\n\n\tclear(): this {\n\t\tconst list = this._list;\n\t\tfor (let i = 0, imax = list.length; i < imax; ++i) {\n\t\t\tlist[i].destroy();\n\t\t}\n\t\tlist.length = 0;\n\t\treturn this;\n\t}\n\n\tsize(): number {\n\t\treturn this._list.length;\n\t}\n\n\tdestroy(): void {\n\t\tthis.clear();\n\t\tconst selection = this._selection;\n\t\tif (selection) {\n\t\t\tselection.unbind();\n\t\t}\n\t}\n\n\tgetDomain(coordinate: DChartCoordinate<CHART>, result: DChartRegion): DChartRegion {\n\t\tresult.clear();\n\n\t\tconst list = this._list;\n\t\tfor (let i = 0, imax = list.length; i < imax; ++i) {\n\t\t\tconst series = list[i];\n\t\t\tif (series.coordinate.x === coordinate) {\n\t\t\t\tconst domain = series.domain;\n\t\t\t\tresult.add(domain.from, domain.to);\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetRange(coordinate: DChartCoordinate<CHART>, result: DChartRegion): DChartRegion {\n\t\tresult.clear();\n\n\t\tconst list = this._list;\n\t\tfor (let i = 0, imax = list.length; i < imax; ++i) {\n\t\t\tconst series = list[i];\n\t\t\tif (series.coordinate.y === coordinate) {\n\t\t\t\tconst range = series.range;\n\t\t\t\tresult.add(range.from, range.to);\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tget domain(): DChartRegion {\n\t\tconst result = this._domain;\n\t\tresult.clear();\n\n\t\tconst list = this._list;\n\t\tfor (let i = 0, imax = list.length; i < imax; ++i) {\n\t\t\tconst domain = list[i].domain;\n\t\t\tresult.add(domain.from, domain.to);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tget range(): DChartRegion {\n\t\tconst result = this._range;\n\t\tresult.clear();\n\n\t\tconst list = this._list;\n\t\tfor (let i = 0, imax = list.length; i < imax; ++i) {\n\t\t\tconst range = list[i].range;\n\t\t\tresult.add(range.from, range.to);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\thitTest(x: number, y: number): DChartSeries<CHART> | null {\n\t\tconst list = this._list;\n\t\tfor (let i = list.length - 1; 0 <= i; --i) {\n\t\t\tconst series = list[i];\n\t\t\tif (series.hitTest(x, y)) {\n\t\t\t\treturn series;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tcalcHitPoint(x: number, y: number, result: DChartSeriesHitResult): DChartSeries<CHART> | null {\n\t\tlet tmp1 = result;\n\t\tlet tmp2 = DChartSeriesContainerImpl.WORK_CALCHITPOINT;\n\t\tconst list = this._list;\n\t\tlet closest: DChartSeries<CHART> | null = null;\n\t\ttmp2.distance = +Infinity;\n\t\tfor (let i = list.length - 1; 0 <= i; --i) {\n\t\t\tconst series = list[i];\n\t\t\tif (series.calcHitPoint(x, y, tmp1)) {\n\t\t\t\tif (tmp1.distance < tmp2.distance) {\n\t\t\t\t\tclosest = series;\n\t\t\t\t\tconst tmp = tmp1;\n\t\t\t\t\ttmp1 = tmp2;\n\t\t\t\t\ttmp2 = tmp;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (closest && tmp2 !== result) {\n\t\t\tresult.copyFrom(tmp2);\n\t\t}\n\t\treturn closest;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction, Point, Rectangle, Renderer } from \"pixi.js\";\nimport { DAnimationTimings } from \"./d-animation-timings\";\nimport { DApplications } from \"./d-applications\";\nimport { DBase } from \"./d-base\";\nimport { DBaseOverflowMask } from \"./d-base-overflow-mask\";\nimport { DChartAxisContainer } from \"./d-chart-axis-container\";\nimport { DChartAxisContainerImpl } from \"./d-chart-axis-container-impl\";\nimport { DChartCoordinateContainer } from \"./d-chart-coordinate-container\";\nimport { DChartCoordinateContainerImpl } from \"./d-chart-coordinate-container-impl\";\nimport { DChartPlotArea, DThemeChartPlotArea, DChartPlotAreaOptions } from \"./d-chart-plot-area\";\nimport { DChartPlotAreaContainer } from \"./d-chart-plot-area-container\";\nimport { DChartSeriesContainer } from \"./d-chart-series-container\";\nimport { DChartSeriesContainerImpl } from \"./d-chart-series-container-impl\";\nimport { DView } from \"./d-view\";\nimport { DViewImpl } from \"./d-view-impl\";\nimport { UtilWheelEventDeltas } from \"./util/util-wheel-event\";\n\nexport class DChartPlotAreaImpl<\n\t\tCHART extends DBase = DBase,\n\t\tTHEME extends DThemeChartPlotArea = DThemeChartPlotArea,\n\t\tOPTIONS extends DChartPlotAreaOptions<CHART, THEME> = DChartPlotAreaOptions<CHART, THEME>\n\t>\n\textends DBase<THEME, OPTIONS>\n\timplements DChartPlotArea<CHART>\n{\n\tprotected _chart: CHART;\n\tprotected _container!: DChartPlotAreaContainer;\n\tprotected _series!: DChartSeriesContainerImpl<CHART>;\n\tprotected _coordinate!: DChartCoordinateContainer<CHART>;\n\tprotected _axis!: DChartAxisContainerImpl<CHART>;\n\tprotected _view!: DViewImpl;\n\tprotected _isViewDirty!: boolean;\n\tprotected _isBoundsInContainerDirty!: boolean;\n\tprotected _boundsInContainer!: Rectangle;\n\tprotected _overflowMask?: DBaseOverflowMask | null;\n\tprotected _workPoint!: Point;\n\tprotected _blendStartTime: number;\n\tprotected _blendDuration: number;\n\tprotected _blendTimeout: number | null;\n\tprotected _onBlendBound: () => void;\n\n\tconstructor(chart: CHART, options?: OPTIONS) {\n\t\tsuper(options);\n\t\tthis._chart = chart;\n\t\tthis._blendStartTime = 0;\n\t\tthis._blendDuration = 1000;\n\t\tthis._blendTimeout = null;\n\t\tthis._onBlendBound = () => {\n\t\t\tthis.onBlend();\n\t\t};\n\t}\n\n\tprotected init(options?: OPTIONS): void {\n\t\tsuper.init(options);\n\n\t\tconst container = new DChartPlotAreaContainer((): void => {\n\t\t\tthis._isViewDirty = true;\n\t\t\tthis._isBoundsInContainerDirty = true;\n\t\t\tDApplications.update(this);\n\t\t});\n\t\tthis._container = container;\n\t\tthis._coordinate = new DChartCoordinateContainerImpl(this, options?.coordinate);\n\t\tconst series = new DChartSeriesContainerImpl(this, options?.series);\n\t\tthis._series = series;\n\t\tconst axis = new DChartAxisContainerImpl(this, options?.axis);\n\t\tthis._axis = axis;\n\t\tthis._isViewDirty = true;\n\t\tthis._isBoundsInContainerDirty = true;\n\t\tthis._boundsInContainer = new Rectangle();\n\t\tthis._workPoint = new Point();\n\n\t\tthis.addChild(container);\n\t\tthis.addChild(axis.container);\n\n\t\tthis._view = new DViewImpl(this, () => container, options?.view);\n\n\t\tconst selection = series.selection;\n\t\tif (selection) {\n\t\t\tselection.bind(series);\n\t\t}\n\n\t\t// Overflow mask\n\t\tconst mask = options?.mask ?? this.theme.isOverflowMaskEnabled();\n\t\tif (mask) {\n\t\t\tcontainer.mask = this.getOverflowMask();\n\t\t}\n\t}\n\n\tonResize(newWidth: number, newHeight: number, oldWidth: number, oldHeight: number): void {\n\t\tthis._isViewDirty = true;\n\t\tthis._isBoundsInContainerDirty = true;\n\t\tsuper.onResize(newWidth, newHeight, oldWidth, oldHeight);\n\t}\n\n\tprotected getOverflowMask(): DBaseOverflowMask {\n\t\tif (this._overflowMask == null) {\n\t\t\tthis._overflowMask = new DBaseOverflowMask(this);\n\t\t\tthis.reflowable.add(this._overflowMask);\n\t\t\tthis.toDirty();\n\t\t}\n\t\treturn this._overflowMask;\n\t}\n\n\tget coordinate(): DChartCoordinateContainer<CHART> {\n\t\treturn this._coordinate;\n\t}\n\n\tget chart(): CHART {\n\t\treturn this._chart;\n\t}\n\n\tget series(): DChartSeriesContainer<CHART> {\n\t\treturn this._series;\n\t}\n\n\tget container(): DChartPlotAreaContainer {\n\t\treturn this._container;\n\t}\n\n\tget axis(): DChartAxisContainer<CHART> {\n\t\treturn this._axis;\n\t}\n\n\tget view(): DView {\n\t\treturn this._view;\n\t}\n\n\tonWheel(e: WheelEvent, deltas: UtilWheelEventDeltas, global: Point): boolean {\n\t\tconst vresult = this._view.onWheel(e, deltas, global);\n\t\tconst sresult = super.onWheel(e, deltas, global);\n\t\treturn vresult || sresult;\n\t}\n\n\tonDblClick(\n\t\te: MouseEvent | TouchEvent,\n\t\tinteractionManager: interaction.InteractionManager\n\t): boolean {\n\t\tconst vresult = this._view.onDblClick(e, interactionManager);\n\t\tconst sresult = super.onDblClick(e, interactionManager);\n\t\treturn vresult || sresult;\n\t}\n\n\tprotected onDown(e: interaction.InteractionEvent): void {\n\t\tthis._view.onDown(e);\n\t\tsuper.onDown(e);\n\t}\n\n\trender(renderer: Renderer): void {\n\t\tif (this._isViewDirty) {\n\t\t\tthis._isViewDirty = false;\n\n\t\t\tthis._axis.update();\n\n\t\t\tconst selection = this._series.selection;\n\t\t\tif (selection) {\n\t\t\t\tselection.update();\n\t\t\t}\n\t\t}\n\t\tsuper.render(renderer);\n\t}\n\n\tdestroy(): void {\n\t\tthis._container.destroy();\n\t\tthis._series.destroy();\n\t\tthis._axis.destroy();\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DChartPlotArea\";\n\t}\n\n\tgetBoundsInContainer(): Rectangle {\n\t\tconst result = this._boundsInContainer;\n\t\tif (this._isBoundsInContainerDirty) {\n\t\t\tthis._isBoundsInContainerDirty = false;\n\n\t\t\tconst container = this.container;\n\t\t\tcontainer.updateTransform();\n\t\t\tconst transform = container.transform.localTransform;\n\n\t\t\tconst work = this._workPoint;\n\n\t\t\twork.set(0, 0);\n\t\t\ttransform.applyInverse(work, work);\n\t\t\tresult.x = work.x;\n\t\t\tresult.y = work.y;\n\n\t\t\twork.set(this.width, this.height);\n\t\t\ttransform.applyInverse(work, work);\n\t\t\tresult.width = work.x - result.x;\n\t\t\tresult.height = work.y - result.y;\n\t\t}\n\t\treturn result;\n\t}\n\n\tfit(\n\t\tduration?: number,\n\t\tdomainFrom?: number,\n\t\tdomainTo?: number,\n\t\trangeFrom?: number,\n\t\trangeTo?: number\n\t): this {\n\t\tconst coordinate = this._coordinate;\n\t\tconst axis = this._axis;\n\t\tconst series = this._series;\n\t\tif (duration != null && duration <= 0) {\n\t\t\tcoordinate.fit(domainFrom, domainTo, rangeFrom, rangeTo);\n\t\t\taxis.update();\n\t\t\tseries.update();\n\t\t} else {\n\t\t\tthis._blendDuration = duration != null ? duration : 200;\n\t\t\tthis._blendStartTime = Date.now();\n\t\t\tcoordinate.mark(domainFrom, domainTo, rangeFrom, rangeTo);\n\t\t\tconst blendTimeout = this._blendTimeout;\n\t\t\tif (blendTimeout != null) {\n\t\t\t\twindow.clearTimeout(blendTimeout);\n\t\t\t}\n\t\t\tthis._blendTimeout = window.setTimeout(this._onBlendBound, 0);\n\t\t}\n\t\treturn this;\n\t}\n\n\tprotected onBlend(): void {\n\t\tconst now = Date.now();\n\t\tlet ratio = (now - this._blendStartTime) / this._blendDuration;\n\t\tif (ratio < 1) {\n\t\t\tthis._blendTimeout = window.setTimeout(this._onBlendBound, 0);\n\t\t} else {\n\t\t\tthis._blendTimeout = null;\n\t\t\tratio = 1;\n\t\t}\n\t\tthis._coordinate.blend(DAnimationTimings.ELASTIC(ratio));\n\t\tthis._axis.update();\n\t\tthis._series.update();\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DChartRegion } from \"./d-chart-region\";\nimport { isNaN } from \"./util/is-nan\";\n\nexport class DChartRegionImplObservable implements DChartRegion {\n\tprotected _from: number;\n\tprotected _to: number;\n\tprotected _onChange: () => void;\n\n\tconstructor(from: number, to: number, onChange: () => void) {\n\t\tthis._from = from;\n\t\tthis._to = to;\n\t\tthis._onChange = onChange;\n\t}\n\n\tget from(): number {\n\t\treturn this._from;\n\t}\n\n\tset from(from: number) {\n\t\tthis.set(from, undefined);\n\t}\n\n\tget to(): number {\n\t\treturn this._to;\n\t}\n\n\tset to(to: number) {\n\t\tthis.set(undefined, to);\n\t}\n\n\tset(from?: number, to?: number): this {\n\t\tlet isChanged = false;\n\n\t\tif (from != null && this._from !== from) {\n\t\t\tif (!isNaN(this._from) || !isNaN(from)) {\n\t\t\t\tthis._from = from;\n\t\t\t\tisChanged = true;\n\t\t\t}\n\t\t}\n\n\t\tif (to != null && this._to !== to) {\n\t\t\tif (!isNaN(this._to) || !isNaN(to)) {\n\t\t\t\tthis._to = to;\n\t\t\t\tisChanged = true;\n\t\t\t}\n\t\t}\n\n\t\tif (isChanged) {\n\t\t\tthis._onChange();\n\t\t}\n\t\treturn this;\n\t}\n\n\tadd(from: number, to: number): this {\n\t\tlet newFrom: number | undefined;\n\t\tif (!isNaN(from)) {\n\t\t\tnewFrom = isNaN(this.from) ? from : Math.min(this.from, from);\n\t\t}\n\n\t\tlet newTo: number | undefined;\n\t\tif (!isNaN(to)) {\n\t\t\tnewTo = isNaN(this.to) ? to : Math.max(this.to, to);\n\t\t}\n\n\t\treturn this.set(newFrom, newTo);\n\t}\n\n\tclear(): this {\n\t\treturn this.set(NaN, NaN);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { IPoint } from \"pixi.js\";\nimport { DBase } from \"./d-base\";\nimport { DBaseState } from \"./d-base-state\";\nimport { DBaseStateSet } from \"./d-base-state-set\";\nimport { DBaseStateSetImpl } from \"./d-base-state-set-impl\";\nimport { DChartSelectionStyle } from \"./d-chart-selection\";\nimport {\n\tDChartSelectionShape,\n\tDChartSelectionShapeOptions,\n\tDThemeChartSelectionShape\n} from \"./d-chart-selection-shape\";\nimport { DChartSeries } from \"./d-chart-series\";\nimport { DChartSeriesContainer } from \"./d-chart-series-container\";\nimport { EShape } from \"./shape/e-shape\";\nimport { DThemes } from \"./theme/d-themes\";\nimport { isString } from \"./util/is-string\";\n\nexport abstract class DChartSelectionShapeBase<CHART extends DBase = DBase>\n\timplements DChartSelectionShape<CHART>\n{\n\tprotected _isEnabled: boolean;\n\tprotected _shape?: EShape;\n\tprotected _style: DChartSelectionStyle<CHART>;\n\tprotected _state: DBaseStateSet;\n\tprotected _theme: DThemeChartSelectionShape;\n\n\tconstructor(options?: DChartSelectionShapeOptions<CHART>) {\n\t\tconst theme = this.toTheme(options);\n\t\tthis._theme = theme;\n\t\tconst state = new DBaseStateSetImpl().add(options?.state ?? DBaseState.HOVERED);\n\t\tthis._state = state;\n\t\tthis._isEnabled = options?.enable ?? theme.isEnabled(state);\n\t\tthis._shape = options?.shape;\n\t\tthis._style = options?.style ?? this.setStyle;\n\t}\n\n\tbind(container: DChartSeriesContainer<CHART>): void {\n\t\tif (this._isEnabled) {\n\t\t\tconst shape = this._shape || this.newShape(this._theme);\n\t\t\tthis._shape = shape;\n\t\t\tshape.attach(container.plotArea.axis.container);\n\t\t\tshape.visible = false;\n\t\t}\n\t}\n\n\tunbind(): void {\n\t\tconst shape = this._shape;\n\t\tif (shape) {\n\t\t\tshape.detach();\n\t\t}\n\t}\n\n\tprotected newShape(theme: DThemeChartSelectionShape): EShape {\n\t\treturn theme.newShape(this._state);\n\t}\n\n\tset(\n\t\tcontainer: DChartSeriesContainer<CHART>,\n\t\tmappedPosition: IPoint,\n\t\tseries: DChartSeries<CHART>\n\t): void {\n\t\tthis.update(container, mappedPosition);\n\n\t\tconst shape = this._shape;\n\t\tif (shape) {\n\t\t\tthis._style(shape, series);\n\t\t}\n\t}\n\n\tprotected setStyle(this: unknown, shape: EShape, series: DChartSeries<CHART>): void {\n\t\tconst seriesShape = series.shape;\n\t\tif (seriesShape) {\n\t\t\tshape.stroke.color = seriesShape.stroke.color;\n\t\t}\n\t}\n\n\tunset(): void {\n\t\tconst shape = this._shape;\n\t\tif (shape) {\n\t\t\tshape.visible = false;\n\t\t}\n\t}\n\n\tabstract update(container: DChartSeriesContainer<CHART>, mappedPosition: IPoint): void;\n\n\tprotected toTheme(options?: DChartSelectionShapeOptions<CHART>): DThemeChartSelectionShape {\n\t\tconst theme = options?.theme;\n\t\tif (isString(theme)) {\n\t\t\treturn this.getTheme(theme);\n\t\t} else if (theme != null) {\n\t\t\treturn theme;\n\t\t} else {\n\t\t\treturn this.getTheme(this.getType());\n\t\t}\n\t}\n\n\tprotected getTheme(type: string): DThemeChartSelectionShape {\n\t\treturn DThemes.getInstance().get(type);\n\t}\n\n\tprotected abstract getType(): string;\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { IPoint } from \"pixi.js\";\nimport { DBase } from \"./d-base\";\nimport { DChartSelectionShapeBase } from \"./d-chart-selection-shape-base\";\nimport { DChartSeriesContainer } from \"./d-chart-series-container\";\n\nexport class DChartSelectionGridlineX<\n\tCHART extends DBase = DBase\n> extends DChartSelectionShapeBase<CHART> {\n\tupdate(container: DChartSeriesContainer<CHART>, mappedPosition: IPoint): void {\n\t\tconst shape = this._shape;\n\t\tif (shape) {\n\t\t\tconst mappedX = mappedPosition.x;\n\t\t\tconst height = container.plotArea.height;\n\t\t\tshape.transform.position.set(mappedX, height * 0.5);\n\t\t\tshape.size.set(0, height);\n\t\t\tshape.visible = this.isVisible(container, mappedX);\n\t\t}\n\t}\n\n\tprotected isVisible(container: DChartSeriesContainer<CHART>, mappedX: number): boolean {\n\t\treturn 0 <= mappedX && mappedX <= container.plotArea.width;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DChartSelectionGridlineX\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { IPoint } from \"pixi.js\";\nimport { DBase } from \"./d-base\";\nimport { DChartSelectionShapeBase } from \"./d-chart-selection-shape-base\";\nimport { DChartSeriesContainer } from \"./d-chart-series-container\";\n\nexport class DChartSelectionGridlineY<\n\tCHART extends DBase = DBase\n> extends DChartSelectionShapeBase<CHART> {\n\tupdate(container: DChartSeriesContainer<CHART>, mappedPosition: IPoint): void {\n\t\tconst shape = this._shape;\n\t\tif (shape) {\n\t\t\tconst mappedY = mappedPosition.y;\n\t\t\tconst width = container.plotArea.width;\n\t\t\tshape.transform.position.set(width * 0.5, mappedY);\n\t\t\tshape.size.set(width, 0);\n\t\t\tshape.visible = this.isVisible(container, mappedY);\n\t\t}\n\t}\n\n\tprotected isVisible(container: DChartSeriesContainer<CHART>, mappedY: number): boolean {\n\t\treturn 0 <= mappedY && mappedY <= container.plotArea.height;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DChartSelectionGridlineY\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { IPoint } from \"pixi.js\";\nimport { DBase } from \"./d-base\";\nimport {\n\tDChartSelectionGridlineContainer,\n\tDChartSelectionGridlineContainerOptions\n} from \"./d-chart-selection-gridline-container\";\nimport { DChartSelectionGridlineX } from \"./d-chart-selection-gridline-x\";\nimport { DChartSelectionGridlineY } from \"./d-chart-selection-gridline-y\";\nimport { DChartSelectionShape } from \"./d-chart-selection-shape\";\nimport { DChartSeries } from \"./d-chart-series\";\nimport { DChartSeriesContainer } from \"./d-chart-series-container\";\n\nexport class DChartSelectionGridlineContainerImpl<CHART extends DBase = DBase>\n\timplements DChartSelectionGridlineContainer<CHART>\n{\n\tprotected _x: DChartSelectionShape<CHART>;\n\tprotected _y: DChartSelectionShape<CHART>;\n\n\tconstructor(options?: DChartSelectionGridlineContainerOptions<CHART>) {\n\t\tthis._x = new DChartSelectionGridlineX<CHART>(options?.x);\n\t\tthis._y = new DChartSelectionGridlineY<CHART>(options?.y);\n\t}\n\n\tget x(): DChartSelectionShape<CHART> {\n\t\treturn this._x;\n\t}\n\n\tget y(): DChartSelectionShape<CHART> {\n\t\treturn this._y;\n\t}\n\n\tbind(container: DChartSeriesContainer<CHART>): void {\n\t\tthis._x.bind(container);\n\t\tthis._y.bind(container);\n\t}\n\n\tunbind(): void {\n\t\tthis._x.unbind();\n\t\tthis._y.unbind();\n\t}\n\n\tset(\n\t\tcontainer: DChartSeriesContainer<CHART>,\n\t\tmappedPosition: IPoint,\n\t\tseries: DChartSeries<CHART>\n\t): void {\n\t\tthis._x.set(container, mappedPosition, series);\n\t\tthis._y.set(container, mappedPosition, series);\n\t}\n\n\tunset(): void {\n\t\tthis._x.unset();\n\t\tthis._y.unset();\n\t}\n\n\tupdate(container: DChartSeriesContainer<CHART>, mappedPosition: IPoint): void {\n\t\tthis._x.update(container, mappedPosition);\n\t\tthis._y.update(container, mappedPosition);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { IPoint } from \"pixi.js\";\nimport { DBase } from \"./d-base\";\nimport { DChartSelectionShapeBase } from \"./d-chart-selection-shape-base\";\nimport { DChartSeriesContainer } from \"./d-chart-series-container\";\n\nexport class DChartSelectionMarker<\n\tCHART extends DBase = DBase\n> extends DChartSelectionShapeBase<CHART> {\n\tupdate(container: DChartSeriesContainer<CHART>, mappedPosition: IPoint): void {\n\t\tconst shape = this._shape;\n\t\tif (shape) {\n\t\t\tshape.transform.position.copyFrom(mappedPosition);\n\t\t\tshape.visible = this.isVisible(container, mappedPosition);\n\t\t}\n\t}\n\n\tprotected isVisible(container: DChartSeriesContainer<CHART>, mappedPosition: IPoint): boolean {\n\t\tconst x = mappedPosition.x;\n\t\tconst y = mappedPosition.y;\n\t\tconst plotArea = container.plotArea;\n\t\treturn 0 <= x && x <= plotArea.width && 0 <= y && y <= plotArea.height;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DChartSelectionMarker\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { utils } from \"pixi.js\";\nimport { DBase } from \"./d-base\";\nimport { DChartSeries } from \"./d-chart-series\";\nimport { DChartSeriesContainer } from \"./d-chart-series-container\";\nimport { EShape } from \"./shape/e-shape\";\n\nexport const DChartSelectionPoint = {\n\tPREVIOUS: 0,\n\tNEXT: 1,\n\tCLOSER: 2,\n\tINTERSECTION: 3\n} as const;\n\nexport type DChartSelectionPoint = typeof DChartSelectionPoint[keyof typeof DChartSelectionPoint];\n\nexport type DChartSelectionStyle<CHART extends DBase = DBase> = (\n\tshape: EShape,\n\tseries: DChartSeries<CHART>\n) => void;\n\nexport interface DChartSelection<CHART extends DBase = DBase> extends utils.EventEmitter {\n\tbind(container: DChartSeriesContainer<CHART>): void;\n\tunbind(): void;\n\tupdate(): void;\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Point, utils } from \"pixi.js\";\nimport { DApplications } from \"./d-applications\";\nimport { DBase } from \"./d-base\";\nimport { DBaseState } from \"./d-base-state\";\nimport { DChartCoordinate } from \"./d-chart-coordinate\";\nimport { DChartSelectionPoint } from \"./d-chart-selection\";\nimport { DChartSelectionGridlineContainer } from \"./d-chart-selection-gridline-container\";\nimport { DChartSelectionGridlineContainerImpl } from \"./d-chart-selection-gridline-container-impl\";\nimport { DChartSelectionMarker } from \"./d-chart-selection-marker\";\nimport { DChartSelectionSub, DChartSelectionSubOptions } from \"./d-chart-selection-sub\";\nimport { DChartSeries, DChartSeriesHitResult } from \"./d-chart-series\";\nimport { DChartSeriesContainer } from \"./d-chart-series-container\";\nimport { EShape } from \"./shape/e-shape\";\n\nexport class DChartSelectionSubImpl<CHART extends DBase = DBase>\n\textends utils.EventEmitter\n\timplements DChartSelectionSub<CHART>\n{\n\tprotected _container: DChartSeriesContainer<CHART> | null;\n\tprotected _isEnabled: boolean;\n\tprotected _series: DChartSeries<CHART> | null;\n\tprotected _coordinateX: DChartCoordinate<CHART> | null;\n\tprotected _coordinateY: DChartCoordinate<CHART> | null;\n\tprotected _position: Point;\n\tprotected _point: DChartSelectionPoint;\n\tprotected _work: Point;\n\tprotected _gridline: DChartSelectionGridlineContainer<CHART>;\n\tprotected _marker: DChartSelectionMarker<CHART>;\n\tprotected _state: string;\n\n\tconstructor(options: DChartSelectionSubOptions<CHART>) {\n\t\tsuper();\n\n\t\tthis._container = null;\n\t\tthis._series = null;\n\t\tthis._isEnabled = options.enable ?? true;\n\t\tthis._gridline = new DChartSelectionGridlineContainerImpl(options.gridline);\n\t\tthis._marker = new DChartSelectionMarker(options.marker);\n\t\tthis._state = options.state ?? DBaseState.HOVERED;\n\t\tthis._coordinateX = null;\n\t\tthis._coordinateY = null;\n\t\tthis._position = new Point();\n\t\tthis._point = options.point ?? DChartSelectionPoint.CLOSER;\n\t\tthis._work = new Point();\n\n\t\t// Events\n\t\tconst on = options.on;\n\t\tif (on) {\n\t\t\tfor (const name in on) {\n\t\t\t\tconst handler = on[name];\n\t\t\t\tif (handler) {\n\t\t\t\t\tthis.on(name, handler);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tbind(container: DChartSeriesContainer<CHART>): void {\n\t\tif (this._isEnabled) {\n\t\t\tthis._container = container;\n\t\t\tthis._gridline.bind(container);\n\t\t\tthis._marker.bind(container);\n\t\t}\n\t}\n\n\tunbind(): void {\n\t\tthis._marker.unbind();\n\t\tthis._gridline.unbind();\n\t\tthis._container = null;\n\t\tthis._coordinateX = null;\n\t\tthis._coordinateY = null;\n\t}\n\n\tget series(): DChartSeries<CHART> | null {\n\t\treturn this._series;\n\t}\n\n\tget position(): Point {\n\t\treturn this._position;\n\t}\n\n\tget gridline(): DChartSelectionGridlineContainer<CHART> {\n\t\treturn this._gridline;\n\t}\n\n\tget marker(): DChartSelectionMarker<CHART> {\n\t\treturn this._marker;\n\t}\n\n\tset(\n\t\tseries: DChartSeries<CHART>,\n\t\tresult: DChartSeriesHitResult | DChartSelectionSub<CHART>\n\t): void {\n\t\tconst container = this._container;\n\t\tconst coordinateX = (this._coordinateX = series.coordinate.x);\n\t\tconst coordinateY = (this._coordinateY = series.coordinate.y);\n\t\tif (container && coordinateX && coordinateY) {\n\t\t\tconst transform = container.plotArea.container.localTransform;\n\t\t\tconst position = this._position;\n\t\t\tconst work = this._work;\n\t\t\tif (result instanceof DChartSeriesHitResult) {\n\t\t\t\tlet x = result.x;\n\t\t\t\tlet y = result.y;\n\t\t\t\tswitch (this._point) {\n\t\t\t\t\tcase DChartSelectionPoint.PREVIOUS:\n\t\t\t\t\t\tx = result.p0x;\n\t\t\t\t\t\ty = result.p0y;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase DChartSelectionPoint.NEXT:\n\t\t\t\t\t\tx = result.p1x;\n\t\t\t\t\t\ty = result.p1y;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase DChartSelectionPoint.CLOSER:\n\t\t\t\t\t\tif (Math.abs(result.p0x - result.x) < Math.abs(result.p1x - result.x)) {\n\t\t\t\t\t\t\tx = result.p0x;\n\t\t\t\t\t\t\ty = result.p0y;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tx = result.p1x;\n\t\t\t\t\t\t\ty = result.p1y;\n\t\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\twork.set(x, y);\n\t\t\t\ttransform.apply(work, work);\n\t\t\t\tposition.set(\n\t\t\t\t\tcoordinateX.unmap(coordinateX.transform.unmap(x)),\n\t\t\t\t\tcoordinateY.unmap(coordinateY.transform.unmap(y))\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tposition.copyFrom(result.position);\n\t\t\t\twork.set(\n\t\t\t\t\tcoordinateX.transform.map(coordinateX.map(position.x)),\n\t\t\t\t\tcoordinateY.transform.map(coordinateY.map(position.y))\n\t\t\t\t);\n\t\t\t\ttransform.apply(work, work);\n\t\t\t}\n\n\t\t\tthis._gridline.set(container, work, series);\n\t\t\tthis._marker.set(container, work, series);\n\n\t\t\tDApplications.update(container.plotArea);\n\t\t}\n\n\t\tconst oldSeries = this._series;\n\t\tif (oldSeries !== series) {\n\t\t\tconst state = this._state;\n\t\t\tif (oldSeries) {\n\t\t\t\toldSeries.state.remove(state);\n\t\t\t}\n\n\t\t\tthis._series = series;\n\t\t\tseries.state.add(state);\n\t\t}\n\n\t\tthis.emit(\"change\", this);\n\t}\n\n\tprotected setStyle(this: unknown, shape: EShape, series: DChartSeries<CHART>): void {\n\t\tconst seriesShape = series.shape;\n\t\tif (seriesShape) {\n\t\t\tshape.stroke.color = seriesShape.stroke.color;\n\t\t}\n\t}\n\n\tunset(): void {\n\t\tconst series = this._series;\n\t\tif (series) {\n\t\t\tthis._series = null;\n\t\t\tthis._coordinateX = null;\n\t\t\tthis._coordinateY = null;\n\n\t\t\tseries.state.remove(this._state);\n\n\t\t\tthis._gridline.unset();\n\t\t\tthis._marker.unset();\n\n\t\t\tthis.emit(\"change\", this);\n\t\t}\n\t}\n\n\tupdate(): void {\n\t\tconst container = this._container;\n\t\tconst coordinateX = this._coordinateX;\n\t\tconst coordinateY = this._coordinateY;\n\t\tif (container && coordinateX && coordinateY) {\n\t\t\tconst position = this._position;\n\t\t\tconst work = this._work;\n\t\t\twork.set(\n\t\t\t\tcoordinateX.transform.map(coordinateX.map(position.x)),\n\t\t\t\tcoordinateY.transform.map(coordinateY.map(position.y))\n\t\t\t);\n\t\t\tcontainer.plotArea.container.localTransform.apply(work, work);\n\n\t\t\tthis._gridline.update(container, work);\n\t\t\tthis._marker.update(container, work);\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction, utils } from \"pixi.js\";\nimport { DBase, DBaseOnOptions } from \"./d-base\";\nimport { DBaseState } from \"./d-base-state\";\nimport { DChartSelection, DChartSelectionPoint } from \"./d-chart-selection\";\nimport { DChartSelectionSub, DChartSelectionSubOptions } from \"./d-chart-selection-sub\";\nimport { DChartSelectionSubImpl } from \"./d-chart-selection-sub-impl\";\nimport { DChartSeriesHitResult } from \"./d-chart-series\";\nimport { DChartSeriesContainer } from \"./d-chart-series-container\";\nimport { toEnum } from \"./util/to-enum\";\nimport { UtilPointerEvent } from \"./util/util-pointer-event\";\n\nexport interface DChartSelectionSimpleOptions<CHART extends DBase = DBase, EMITTER = any> {\n\tselected?: DChartSelectionSubOptions<CHART>;\n\thovered?: DChartSelectionSubOptions<CHART>;\n\tpoint?: DChartSelectionPoint | keyof typeof DChartSelectionPoint;\n\ton?: DBaseOnOptions<EMITTER>;\n}\n\nexport class DChartSelectionSimple<CHART extends DBase = DBase>\n\textends utils.EventEmitter\n\timplements DChartSelection<CHART>\n{\n\tprotected static WORK_SELECT: DChartSeriesHitResult = new DChartSeriesHitResult();\n\n\tprotected _container: DChartSeriesContainer<CHART> | null;\n\tprotected _selected: DChartSelectionSub<CHART>;\n\tprotected _hovered: DChartSelectionSub<CHART>;\n\n\tprotected _onClickBound!: (e: interaction.InteractionEvent) => void;\n\tprotected _onMoveBound!: (e: interaction.InteractionEvent) => void;\n\n\tconstructor(options?: DChartSelectionSimpleOptions<CHART>) {\n\t\tsuper();\n\n\t\tthis._container = null;\n\t\tconst point = toEnum(options?.point ?? DChartSelectionPoint.CLOSER, DChartSelectionPoint);\n\t\tthis._selected = this.newSelected(point, options?.selected);\n\t\tthis._hovered = this.newHovered(point, options?.hovered);\n\n\t\t// Events\n\t\tconst on = options?.on;\n\t\tif (on != null) {\n\t\t\tfor (const name in on) {\n\t\t\t\tconst handler = on[name];\n\t\t\t\tif (handler) {\n\t\t\t\t\tthis.on(name, handler);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t//\n\t\tthis._onMoveBound = (e: interaction.InteractionEvent): void => {\n\t\t\tthis.onMove(e);\n\t\t};\n\n\t\tthis._onClickBound = (e: interaction.InteractionEvent): void => {\n\t\t\tthis.onClick(e);\n\t\t};\n\t}\n\n\tprotected newSelected(\n\t\tpoint: DChartSelectionPoint,\n\t\toptions?: DChartSelectionSubOptions<CHART>\n\t): DChartSelectionSub<CHART> {\n\t\treturn new DChartSelectionSubImpl(this.toSubOptions(point, options, DBaseState.ACTIVE));\n\t}\n\n\tprotected newHovered(\n\t\tpoint: DChartSelectionPoint,\n\t\toptions?: DChartSelectionSubOptions<CHART>\n\t): DChartSelectionSub<CHART> {\n\t\treturn new DChartSelectionSubImpl(this.toSubOptions(point, options, DBaseState.HOVERED));\n\t}\n\n\tprotected toSubOptions(\n\t\tpoint: DChartSelectionPoint,\n\t\toptions: DChartSelectionSubOptions<CHART> | undefined,\n\t\tstate: string\n\t): DChartSelectionSubOptions<CHART> {\n\t\toptions = options || {};\n\n\t\tif (options.point == null) {\n\t\t\toptions.point = point;\n\t\t}\n\n\t\tif (options.state == null) {\n\t\t\toptions.state = state;\n\t\t}\n\n\t\tconst gridline = options.gridline || {};\n\t\tconst gridlineX = gridline.x || {};\n\t\tif (gridlineX.state == null) {\n\t\t\tgridlineX.state = state;\n\t\t}\n\n\t\tconst gridlineY = gridline.y || {};\n\t\tif (gridlineY.state == null) {\n\t\t\tgridlineY.state = state;\n\t\t}\n\n\t\tconst marker = options.marker || {};\n\t\tif (marker.state == null) {\n\t\t\tmarker.state = state;\n\t\t}\n\n\t\treturn options;\n\t}\n\n\tprotected onClick(e: interaction.InteractionEvent): void {\n\t\tconst container = this._container;\n\t\tif (container && e.target === container.plotArea) {\n\t\t\tconst hovered = this._hovered;\n\t\t\tconst series = hovered.series;\n\t\t\tconst selected = this._selected;\n\t\t\tif (series) {\n\t\t\t\tselected.set(series, hovered);\n\t\t\t} else {\n\t\t\t\tselected.unset();\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected onMove(e: interaction.InteractionEvent): void {\n\t\tconst container = this._container;\n\t\tif (container) {\n\t\t\tconst hovered = this._hovered;\n\t\t\tif (e.target === container.plotArea) {\n\t\t\t\tconst result = DChartSelectionSimple.WORK_SELECT;\n\t\t\t\tconst global = e.data.global;\n\t\t\t\tconst series = container.calcHitPoint(global.x, global.y, result);\n\t\t\t\tif (series) {\n\t\t\t\t\thovered.set(series, result);\n\t\t\t\t} else {\n\t\t\t\t\thovered.unset();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\thovered.unset();\n\t\t\t}\n\t\t}\n\t}\n\n\tbind(container: DChartSeriesContainer<CHART>): void {\n\t\tthis._container = container;\n\t\tthis._selected.bind(container);\n\t\tthis._hovered.bind(container);\n\t\tconst plotArea = container.plotArea;\n\t\tplotArea.on(UtilPointerEvent.move, this._onMoveBound);\n\t\tUtilPointerEvent.onClick(plotArea, this._onClickBound);\n\t}\n\n\tunbind(): void {\n\t\tconst container = this._container;\n\t\tthis._container = null;\n\t\tif (container) {\n\t\t\tconst plotArea = container.plotArea;\n\t\t\tplotArea.off(UtilPointerEvent.move, this._onMoveBound);\n\t\t}\n\n\t\tthis._selected.unbind();\n\t\tthis._hovered.unbind();\n\t}\n\n\tget selected(): DChartSelectionSub<CHART> {\n\t\treturn this._selected;\n\t}\n\n\tget hovered(): DChartSelectionSub<CHART> {\n\t\treturn this._hovered;\n\t}\n\n\tupdate(): void {\n\t\tthis._selected.update();\n\t\tthis._hovered.update();\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBase } from \"./d-base\";\nimport { DChartCoordinate } from \"./d-chart-coordinate\";\nimport { DChartSeriesContainer } from \"./d-chart-series-container\";\nimport {\n\tDChartSeriesCoordinateContainer,\n\tDChartSeriesCoordinateOptions\n} from \"./d-chart-series-coordinate\";\n\nexport interface DChartSeriesBaseCoordinateContainerParent<CHART extends DBase = DBase> {\n\tcontainer: DChartSeriesContainer<CHART> | null;\n}\n\nexport class DChartSeriesBaseCoordinateContainer<CHART extends DBase = DBase>\n\timplements DChartSeriesCoordinateContainer<CHART>\n{\n\tprotected _parent: DChartSeriesBaseCoordinateContainerParent<CHART>;\n\tprotected _coordinateIndexX: number;\n\tprotected _coordinateIndexY: number;\n\tprotected _coordinateIdUpdatedX: number;\n\tprotected _coordinateIdUpdatedY: number;\n\tprotected _coordinateTransformIdUpdatedX: number;\n\tprotected _coordinateTransformIdUpdatedY: number;\n\n\tconstructor(\n\t\tparent: DChartSeriesBaseCoordinateContainerParent<CHART>,\n\t\toptions?: DChartSeriesCoordinateOptions\n\t) {\n\t\tthis._parent = parent;\n\t\tthis._coordinateIndexX = options?.x ?? 0;\n\t\tthis._coordinateIndexY = options?.y ?? 0;\n\t\tthis._coordinateIdUpdatedX = NaN;\n\t\tthis._coordinateIdUpdatedY = NaN;\n\t\tthis._coordinateTransformIdUpdatedX = NaN;\n\t\tthis._coordinateTransformIdUpdatedY = NaN;\n\t}\n\n\tget x(): DChartCoordinate<CHART> | null {\n\t\tconst container = this._parent.container;\n\t\tif (container) {\n\t\t\treturn container.plotArea.coordinate.x.get(this._coordinateIndexX);\n\t\t}\n\t\treturn null;\n\t}\n\n\tget y(): DChartCoordinate<CHART> | null {\n\t\tconst container = this._parent.container;\n\t\tif (container) {\n\t\t\treturn container.plotArea.coordinate.y.get(this._coordinateIndexY);\n\t\t}\n\t\treturn null;\n\t}\n\n\tisDirty(coordinateX: DChartCoordinate<CHART>, coordinateY: DChartCoordinate<CHART>): boolean {\n\t\tconst coordinateIdX = coordinateX.id;\n\t\tconst coordinateIdY = coordinateY.id;\n\t\tconst isCoordinateXChanged = coordinateIdX !== this._coordinateIdUpdatedX;\n\t\tconst isCoordinateYChanged = coordinateIdY !== this._coordinateIdUpdatedY;\n\t\tthis._coordinateIdUpdatedX = coordinateIdX;\n\t\tthis._coordinateIdUpdatedY = coordinateIdY;\n\t\treturn isCoordinateXChanged || isCoordinateYChanged;\n\t}\n\n\tisTransformDirty(\n\t\tcoordinateX: DChartCoordinate<CHART>,\n\t\tcoordinateY: DChartCoordinate<CHART>\n\t): boolean {\n\t\tconst coordinateTransformIdX = coordinateX.transform.id;\n\t\tconst coordinateTransformIdY = coordinateY.transform.id;\n\t\tconst isCoordinateTransformXChanged =\n\t\t\tcoordinateTransformIdX !== this._coordinateTransformIdUpdatedX;\n\t\tconst isCoordinateTransformYChanged =\n\t\t\tcoordinateTransformIdY !== this._coordinateTransformIdUpdatedY;\n\t\tthis._coordinateTransformIdUpdatedX = coordinateTransformIdX;\n\t\tthis._coordinateTransformIdUpdatedY = coordinateTransformIdY;\n\t\treturn isCoordinateTransformXChanged || isCoordinateTransformYChanged;\n\t}\n\n\treset(): void {\n\t\tthis._coordinateIdUpdatedX = NaN;\n\t\tthis._coordinateIdUpdatedY = NaN;\n\t}\n\n\tdestroy(): void {\n\t\tthis.reset();\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { utils } from \"pixi.js\";\nimport { DApplications } from \"./d-applications\";\nimport { DBase, DBaseOnOptions } from \"./d-base\";\nimport { DBaseStateSet } from \"./d-base-state-set\";\nimport { DBaseStateSetImplObservable } from \"./d-base-state-set-impl-observable\";\nimport { DChartRegionImmutable } from \"./d-chart-region\";\nimport { DChartRegionImpl } from \"./d-chart-region-impl\";\nimport { DChartSeries, DChartSeriesHitResult } from \"./d-chart-series\";\nimport { DChartSeriesBaseCoordinateContainer } from \"./d-chart-series-base-coordinate-container\";\nimport { DChartSeriesContainer } from \"./d-chart-series-container\";\nimport {\n\tDChartSeriesCoordinateContainer,\n\tDChartSeriesCoordinateOptions\n} from \"./d-chart-series-coordinate\";\nimport { EShape } from \"./shape/e-shape\";\n\n/**\n * {@link DChartSeriesBase} options.\n */\nexport interface DChartSeriesBaseOptions<EMITTER = any> {\n\tcoordinate?: DChartSeriesCoordinateOptions;\n\ton?: DBaseOnOptions<EMITTER>;\n}\n\n/**\n * A series represents a polyline.\n */\nexport abstract class DChartSeriesBase<CHART extends DBase = DBase>\n\textends utils.EventEmitter\n\timplements DChartSeries<CHART>\n{\n\tprotected _coordinate: DChartSeriesBaseCoordinateContainer<CHART>;\n\n\tprotected _container?: DChartSeriesContainer<CHART>;\n\tprotected _index: number;\n\n\tprotected _domain: DChartRegionImpl;\n\tprotected _range: DChartRegionImpl;\n\tprotected _regionPointId: number;\n\n\tprotected _state: DBaseStateSet;\n\n\tabstract readonly shape: EShape | null;\n\n\tconstructor(options?: DChartSeriesBaseOptions) {\n\t\tsuper();\n\n\t\tthis._coordinate = new DChartSeriesBaseCoordinateContainer(this, options?.coordinate);\n\t\tthis._index = 0;\n\t\tthis._domain = new DChartRegionImpl(NaN, NaN);\n\t\tthis._range = new DChartRegionImpl(NaN, NaN);\n\t\tthis._regionPointId = NaN;\n\n\t\tthis._state = new DBaseStateSetImplObservable((newState, oldState): void => {\n\t\t\tthis.onStateChange(newState, oldState);\n\t\t});\n\n\t\t// Events\n\t\tconst on = options?.on;\n\t\tif (on != null) {\n\t\t\tfor (const name in on) {\n\t\t\t\tconst handler = on[name];\n\t\t\t\tif (handler) {\n\t\t\t\t\tthis.on(name, handler);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tbind(container: DChartSeriesContainer<CHART>, index: number): void {\n\t\tthis._container = container;\n\t\tthis._coordinate.reset();\n\t\tthis._index = index;\n\n\t\tconst chart = container.plotArea.chart;\n\t\tif (chart) {\n\t\t\tthis._state.parent = chart.state;\n\t\t}\n\t}\n\n\tunbind(): void {\n\t\tthis._container = undefined;\n\t}\n\n\tabstract toDirty(): void;\n\tabstract update(): void;\n\n\tget domain(): DChartRegionImmutable {\n\t\tthis.updateRegion();\n\t\treturn this._domain;\n\t}\n\n\tget range(): DChartRegionImmutable {\n\t\tthis.updateRegion();\n\t\treturn this._range;\n\t}\n\n\tget container(): DChartSeriesContainer<CHART> | null {\n\t\treturn this._container || null;\n\t}\n\n\tget index(): number {\n\t\treturn this._index;\n\t}\n\n\tget coordinate(): DChartSeriesCoordinateContainer<CHART> {\n\t\treturn this._coordinate;\n\t}\n\n\tget state(): DBaseStateSet {\n\t\treturn this._state;\n\t}\n\n\tprotected abstract updateRegion(): void;\n\n\tdestroy(): void {\n\t\tthis._container = undefined;\n\t\tthis._coordinate.destroy();\n\t}\n\n\thitTest(x: number, y: number): boolean {\n\t\treturn false;\n\t}\n\n\tcalcHitPoint(x: number, y: number, result: DChartSeriesHitResult): boolean {\n\t\treturn false;\n\t}\n\n\tprotected onStateChange(newState: DBaseStateSet, oldState: DBaseStateSet): void {\n\t\tthis.toDirty();\n\t\tconst chart = this._container?.plotArea.chart;\n\t\tDApplications.update(chart);\n\t\tthis.emit(\"statechange\", newState, oldState, this);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Point } from \"pixi.js\";\nimport { DApplications } from \"./d-applications\";\nimport { DBase } from \"./d-base\";\nimport { DChartCoordinate } from \"./d-chart-coordinate\";\nimport { DChartRegion } from \"./d-chart-region\";\nimport { DChartSeriesHitResult } from \"./d-chart-series\";\nimport { DChartSeriesBase, DChartSeriesBaseOptions } from \"./d-chart-series-base\";\nimport { DChartSeriesContainer } from \"./d-chart-series-container\";\nimport {\n\tDChartSeriesFillComputed,\n\tDChartSeriesFillComputedOptions\n} from \"./d-chart-series-fill-computed\";\nimport { DChartSeriesPaddingComputedOptions } from \"./d-chart-series-padding-computed\";\nimport {\n\tDChartSeriesPointComputed,\n\tDChartSeriesPointComputedOptions\n} from \"./d-chart-series-point-computed\";\nimport {\n\tDChartSeriesStrokeComputed,\n\tDChartSeriesStrokeComputedOptions\n} from \"./d-chart-series-stroke-computed\";\nimport { EShapeLineOfAny } from \"./shape/variant/e-shape-line-of-any\";\nimport { EShapeLineOfCircles } from \"./shape/variant/e-shape-line-of-circles\";\nimport { toCeilingIndex } from \"./util/to-ceiling-index\";\n\n/**\n * {@link DChartSeriesLineOfAny} options.\n */\nexport interface DChartSeriesLineOfAnyOptions extends DChartSeriesBaseOptions {\n\tpoints?: Array<number | null>;\n\tfill?: DChartSeriesFillComputedOptions;\n\tstroke?: DChartSeriesStrokeComputedOptions;\n\tsize?: DChartSeriesPointComputedOptions;\n\toffset?: DChartSeriesPointComputedOptions;\n\tpadding?: DChartSeriesPaddingComputedOptions;\n}\n\nexport interface DChartSeriesLineOfAnyRegion {\n\txmin: number;\n\txmax: number;\n\tymin: number;\n\tymax: number;\n}\n\n/**\n * A series represents a line of anything.\n * Data points must be sorted in ascending order on the X axis.\n */\nexport abstract class DChartSeriesLineOfAny<\n\tCHART extends DBase = DBase\n> extends DChartSeriesBase<CHART> {\n\tprotected static WORK: Point = new Point();\n\tprotected static WORK_REGION?: DChartSeriesLineOfAnyRegion;\n\n\tprotected _line: EShapeLineOfAny | null;\n\tprotected _options?: DChartSeriesLineOfAnyOptions;\n\tprotected _points: Array<number | null>;\n\tprotected _pointId: number;\n\tprotected _pointIdUpdated: number;\n\n\tprotected _stroke?: DChartSeriesStrokeComputed;\n\tprotected _fill?: DChartSeriesFillComputed;\n\tprotected _size?: DChartSeriesPointComputed;\n\tprotected _offset?: DChartSeriesPointComputed;\n\n\tconstructor(options?: DChartSeriesLineOfAnyOptions) {\n\t\tsuper(options);\n\t\tthis._line = null;\n\t\tthis._options = options;\n\t\tthis._points = (options && options.points) || [];\n\t\tthis._pointId = 0;\n\t\tthis._pointIdUpdated = NaN;\n\t}\n\n\tprotected getSizeDefault(): number {\n\t\treturn 10;\n\t}\n\n\tprotected getOffsetDefault(): number {\n\t\treturn 0;\n\t}\n\n\tbind(container: DChartSeriesContainer<CHART>, index: number): void {\n\t\tlet line = this._line;\n\t\tif (!line) {\n\t\t\tline = this._line = this.newLineOfAny();\n\t\t\tconst options = this._options;\n\t\t\tthis.initLine(line, options, container, index);\n\t\t}\n\t\tline.attach(container.plotArea.container, index);\n\t\tthis._pointIdUpdated = NaN;\n\t\tsuper.bind(container, index);\n\t}\n\n\tprotected initLine(\n\t\tline: EShapeLineOfAny,\n\t\toptions: DChartSeriesLineOfAnyOptions | undefined,\n\t\tcontainer: DChartSeriesContainer<CHART>,\n\t\tindex: number\n\t): void {\n\t\tconst fill = container.newFill(index, options?.fill);\n\t\tthis._fill = fill;\n\t\tline.fill.copy(fill);\n\n\t\tconst stroke = container.newStroke(index, options?.stroke);\n\t\tthis._stroke = stroke;\n\t\tline.stroke.copy(stroke);\n\n\t\tconst sizeDefault = this.getSizeDefault();\n\t\tconst size = container.newSize(index, options?.size, sizeDefault, sizeDefault);\n\t\tthis._size = size;\n\t\tline.points.size.set(size.x, size.y);\n\n\t\tconst offsetDefault = this.getOffsetDefault();\n\t\tconst offset = container.newOffset(\n\t\t\tindex,\n\t\t\toptions && options.offset,\n\t\t\toffsetDefault,\n\t\t\toffsetDefault\n\t\t);\n\t\tthis._offset = offset;\n\t\tline.points.offset.set(offset.x, offset.y);\n\t}\n\n\tprotected abstract newLineOfAny(): EShapeLineOfAny;\n\n\tunbind(): void {\n\t\tconst line = this._line;\n\t\tif (line) {\n\t\t\tline.detach();\n\t\t}\n\t\tsuper.unbind();\n\t}\n\n\tget shape(): EShapeLineOfAny | null {\n\t\treturn this._line;\n\t}\n\n\tget points(): Array<number | null> {\n\t\treturn this._points;\n\t}\n\n\tset points(points: Array<number | null>) {\n\t\tthis._points = points;\n\t\tthis._pointId += 1;\n\t}\n\n\ttoDirty(): void {\n\t\tthis._pointId += 1;\n\t}\n\n\tupdate(): void {\n\t\tconst line = this._line;\n\t\tif (line) {\n\t\t\tconst coordinate = this._coordinate;\n\t\t\tconst coordinateX = coordinate.x;\n\t\t\tconst coordinateY = coordinate.y;\n\t\t\tif (coordinateX && coordinateY) {\n\t\t\t\tconst pointId = this._pointId;\n\t\t\t\tconst isPointChanged = pointId !== this._pointIdUpdated;\n\t\t\t\tconst isCoordinateChanged = coordinate.isDirty(coordinateX, coordinateY);\n\t\t\t\tconst isCoordinateTransformChanged = coordinate.isTransformDirty(\n\t\t\t\t\tcoordinateX,\n\t\t\t\t\tcoordinateY\n\t\t\t\t);\n\t\t\t\tif (isPointChanged || isCoordinateChanged || isCoordinateTransformChanged) {\n\t\t\t\t\tthis._pointIdUpdated = pointId;\n\t\t\t\t\tthis.updateLine(line, coordinateX, coordinateY);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected updateLine(\n\t\tline: EShapeLineOfAny,\n\t\txcoordinate: DChartCoordinate<CHART>,\n\t\tycoordinate: DChartCoordinate<CHART>\n\t): void {\n\t\tconst values = line.points.values;\n\t\tconst valuesLength = values.length;\n\t\tlet ivalues = 0;\n\t\tconst points = this._points;\n\t\tlet xmin = NaN;\n\t\tlet xmax = NaN;\n\t\tlet ymin = NaN;\n\t\tlet ymax = NaN;\n\t\tfor (let i = 0, imax = points.length; i < imax; i += 2) {\n\t\t\tconst x = points[i];\n\t\t\tconst y = points[i + 1];\n\t\t\tif (x != null && y != null) {\n\t\t\t\tif (ivalues < valuesLength) {\n\t\t\t\t\tvalues[ivalues] = x;\n\t\t\t\t\tvalues[ivalues + 1] = y;\n\t\t\t\t} else {\n\t\t\t\t\tvalues.push(x, y);\n\t\t\t\t}\n\t\t\t\tivalues += 2;\n\t\t\t\tif (xmin !== xmin) {\n\t\t\t\t\txmin = x;\n\t\t\t\t\txmax = x;\n\t\t\t\t\tymin = y;\n\t\t\t\t\tymax = y;\n\t\t\t\t} else {\n\t\t\t\t\txmin = Math.min(xmin, x);\n\t\t\t\t\txmax = Math.max(xmax, x);\n\t\t\t\t\tymin = Math.min(ymin, y);\n\t\t\t\t\tymax = Math.max(ymax, y);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (values.length !== ivalues) {\n\t\t\tvalues.length = ivalues;\n\t\t}\n\n\t\txcoordinate.mapAll(values, 0, ivalues, 2, 0);\n\t\tycoordinate.mapAll(values, 0, ivalues, 2, 1);\n\t\txcoordinate.transform.mapAll(values, 0, ivalues, 2, 0);\n\t\tycoordinate.transform.mapAll(values, 0, ivalues, 2, 1);\n\n\t\tif (xmin !== xmin) {\n\t\t\txmin = 0;\n\t\t\txmax = 0;\n\t\t\tymin = 0;\n\t\t\tymax = 0;\n\t\t}\n\t\tconst region = DChartSeriesLineOfAny.WORK_REGION || {\n\t\t\txmin: 0,\n\t\t\txmax: 0,\n\t\t\tymin: 0,\n\t\t\tymax: 0\n\t\t};\n\t\tDChartSeriesLineOfAny.WORK_REGION = region;\n\t\tthis.adjustLineRegion(xmin, xmax, ymin, ymax, region);\n\t\txmin = xcoordinate.transform.map(xcoordinate.map(region.xmin));\n\t\txmax = xcoordinate.transform.map(xcoordinate.map(region.xmax));\n\t\tymin = ycoordinate.transform.map(ycoordinate.map(region.ymin));\n\t\tymax = ycoordinate.transform.map(ycoordinate.map(region.ymax));\n\n\t\tconst sx = Math.abs(xmax - xmin);\n\t\tconst sy = Math.abs(ymax - ymin);\n\t\tconst cx = (xmin + xmax) * 0.5;\n\t\tconst cy = (ymin + ymax) * 0.5;\n\t\tfor (let i = 0, imax = values.length; i < imax; i += 2) {\n\t\t\tvalues[i + 0] -= cx;\n\t\t\tvalues[i + 1] -= cy;\n\t\t}\n\n\t\tline.disallowUploadedUpdate();\n\t\tthis.applyLine(line, xcoordinate, ycoordinate, sx, sy, cx, cy, values);\n\t\tline.allowUploadedUpdate();\n\t\tDApplications.update(line);\n\t}\n\n\tprotected adjustLineRegion(\n\t\txmin: number,\n\t\txmax: number,\n\t\tymin: number,\n\t\tymax: number,\n\t\tresult: DChartSeriesLineOfAnyRegion\n\t): DChartSeriesLineOfAnyRegion {\n\t\tresult.xmin = xmin;\n\t\tresult.xmax = xmax;\n\t\tresult.ymin = ymin;\n\t\tresult.ymax = ymax;\n\t\treturn result;\n\t}\n\n\tprotected applyLine(\n\t\tline: EShapeLineOfAny,\n\t\txcoordinate: DChartCoordinate<CHART>,\n\t\tycoordinate: DChartCoordinate<CHART>,\n\t\tsx: number,\n\t\tsy: number,\n\t\tcx: number,\n\t\tcy: number,\n\t\tvalues: number[]\n\t): void {\n\t\tline.points.set(values);\n\t\tline.size.set(sx, sy);\n\t\tline.transform.position.set(cx, cy);\n\t}\n\n\tprotected updateRegion(): void {\n\t\tconst pointId = this._pointId;\n\t\tif (this._regionPointId !== pointId) {\n\t\t\tthis._regionPointId = pointId;\n\t\t\tconst points = this._points;\n\t\t\tconst domain = this._domain;\n\t\t\tconst range = this._range;\n\t\t\tdomain.clear();\n\t\t\trange.clear();\n\t\t\tthis.calcRegion(points, domain, range);\n\t\t}\n\t}\n\n\tprotected calcRegion(\n\t\tpoints: Array<number | null>,\n\t\tdomain: DChartRegion,\n\t\trange: DChartRegion\n\t): void {\n\t\tfor (let i = 0, imax = points.length; i < imax; i += 2) {\n\t\t\tconst xraw = points[i];\n\t\t\tif (xraw != null) {\n\t\t\t\tdomain.add(xraw, xraw);\n\t\t\t}\n\t\t\tconst yraw = points[i + 1];\n\t\t\tif (yraw != null) {\n\t\t\t\trange.add(yraw, yraw);\n\t\t\t}\n\t\t}\n\t}\n\n\tdestroy(): void {\n\t\tconst line = this._line;\n\t\tif (line) {\n\t\t\tthis._line = null;\n\t\t\tline.detach();\n\t\t\tline.destroy();\n\t\t}\n\n\t\tthis._points.length = 0;\n\t\tthis._pointId = 0;\n\t\tthis._pointIdUpdated = NaN;\n\t\tsuper.destroy();\n\t}\n\n\thitTest(x: number, y: number): boolean {\n\t\tconst line = this._line;\n\t\tif (line) {\n\t\t\tconst local = DChartSeriesLineOfAny.WORK;\n\t\t\tlocal.set(x, y);\n\t\t\tline.toLocal(local, undefined, local);\n\t\t\treturn line.contains(local.x, local.y) != null;\n\t\t}\n\t\treturn false;\n\t}\n\n\tcalcHitPoint(x: number, y: number, result: DChartSeriesHitResult): boolean {\n\t\tconst line = this._line;\n\t\tif (line) {\n\t\t\tconst local = DChartSeriesLineOfAny.WORK;\n\t\t\tlocal.set(x, y);\n\t\t\tline.toLocal(local, undefined, local);\n\t\t\tresult.shape = line;\n\t\t\treturn line.calcHitPoint(\n\t\t\t\tlocal.x,\n\t\t\t\tlocal.y,\n\t\t\t\tnull,\n\t\t\t\tthis.calcHitPointTestRange,\n\t\t\t\tthis.calcHitPointHitTester,\n\t\t\t\tresult\n\t\t\t);\n\t\t}\n\t\treturn false;\n\t}\n\n\tcalcHitPointTestRange(\n\t\tthis: unknown,\n\t\tx: number,\n\t\ty: number,\n\t\tax: number,\n\t\tay: number,\n\t\tox: number,\n\t\toy: number,\n\t\tthreshold: number,\n\t\tvalues: number[],\n\t\tresult: [number, number]\n\t): [number, number] {\n\t\tconst to = toCeilingIndex(values, x + ax + ox, 2, 0);\n\t\tlet from = 0;\n\t\tfor (let i = to - 1, iv = i << 1; 0 <= i; i -= 1, iv -= 2) {\n\t\t\tif (values[iv] <= x - ax) {\n\t\t\t\tfrom = i;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tresult[0] = from;\n\t\tresult[1] = from !== to ? to : Math.min(values.length << 1, to + 1);\n\t\treturn result;\n\t}\n\n\tcalcHitPointHitTester(\n\t\tthis: unknown,\n\t\tx: number,\n\t\ty: number,\n\t\tax: number,\n\t\tay: number,\n\t\tox: number,\n\t\toy: number,\n\t\tpx: number,\n\t\tpy: number,\n\t\tsw: number,\n\t\tss: number,\n\t\tsa: number,\n\t\tindex: number,\n\t\tthreshold: number,\n\t\tresult: DChartSeriesHitResult\n\t): boolean {\n\t\tconst shape = result.shape as EShapeLineOfCircles;\n\t\tif (shape.containsPointAbs(x, y, ax, ay, ox, oy, px, py, sw, ss, sa)) {\n\t\t\tconst transform = shape.transform;\n\t\t\tconst position = transform.position;\n\t\t\tconst scale = transform.scale;\n\t\t\tresult.x = result.p0x = result.p1x = position.x + scale.x * px;\n\t\t\tresult.y = result.p0y = result.p1y = position.y + scale.y * py;\n\t\t\tresult.t = threshold;\n\t\t\tresult.index = index;\n\t\t\tconst dx = x - (px + ox);\n\t\t\tconst dy = y - (py + oy);\n\t\t\tresult.distance = Math.sqrt(dx * dx + dy * dy);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBase } from \"./d-base\";\nimport { DChartCoordinate } from \"./d-chart-coordinate\";\nimport { DChartRegion } from \"./d-chart-region\";\nimport { DChartSeriesContainer } from \"./d-chart-series-container\";\nimport {\n\tDChartSeriesLineOfAny,\n\tDChartSeriesLineOfAnyOptions,\n\tDChartSeriesLineOfAnyRegion\n} from \"./d-chart-series-line-of-any\";\nimport { DChartSeriesPaddingComputed } from \"./d-chart-series-padding-computed\";\nimport { DChartSeriesPointComputedOptions } from \"./d-chart-series-point-computed\";\nimport { EShapeLineOfAny } from \"./shape/variant/e-shape-line-of-any\";\nimport { EShapeLineOfRectangles } from \"./shape/variant/e-shape-line-of-rectangles\";\nimport { isArray } from \"./util/is-array\";\n\nexport interface DChartSeriesBarSizeOptions extends DChartSeriesPointComputedOptions {\n\tauto?: boolean;\n}\n\nexport interface DChartSeriesBarOptions extends DChartSeriesLineOfAnyOptions {\n\tsize?: DChartSeriesBarSizeOptions;\n}\n\n/**\n * A series represents bars.\n * Data points must be sorted in ascending order on the X axis.\n */\nexport class DChartSeriesBar<CHART extends DBase = DBase> extends DChartSeriesLineOfAny<CHART> {\n\tprotected _barCount: number;\n\tprotected _barIndex: number;\n\tprotected _xcoordinateId: number;\n\tprotected _xcoordinateTransformId: number;\n\tprotected _padding?: DChartSeriesPaddingComputed;\n\tprotected _isSizeAutomatic: boolean;\n\n\tconstructor(options?: DChartSeriesBarOptions) {\n\t\tsuper(options);\n\t\tthis._barCount = -1;\n\t\tthis._barIndex = -1;\n\t\tthis._xcoordinateId = -1;\n\t\tthis._xcoordinateTransformId = -1;\n\t\tthis._isSizeAutomatic = (options && options.size && options.size.auto) !== false;\n\t}\n\n\tbind(container: DChartSeriesContainer<CHART>, index: number): void {\n\t\tthis._barCount = -1;\n\t\tthis._barIndex = -1;\n\t\tthis._xcoordinateId = -1;\n\t\tthis._xcoordinateTransformId = -1;\n\t\tsuper.bind(container, index);\n\t}\n\n\tprotected initLine(\n\t\tline: EShapeLineOfAny,\n\t\toptions: DChartSeriesLineOfAnyOptions | undefined,\n\t\tcontainer: DChartSeriesContainer<CHART>,\n\t\tindex: number\n\t): void {\n\t\tsuper.initLine(line, options, container, index);\n\t\tthis._padding = container.newPadding(index, options && options.padding);\n\t}\n\n\tprotected newLineOfAny(): EShapeLineOfAny {\n\t\treturn new EShapeLineOfRectangles();\n\t}\n\n\tprotected getSizeDefault(): number {\n\t\treturn 1;\n\t}\n\n\tprotected adjustLineRegion(\n\t\txmin: number,\n\t\txmax: number,\n\t\tymin: number,\n\t\tymax: number,\n\t\tresult: DChartSeriesLineOfAnyRegion\n\t): DChartSeriesLineOfAnyRegion {\n\t\treturn super.adjustLineRegion(xmin, xmax, Math.min(0, ymin), Math.max(0, ymax), result);\n\t}\n\n\tprotected updateBarCountAndIndex(): boolean {\n\t\tif (this._barIndex < 0 || this._barCount < 0) {\n\t\t\tlet barIndex = 0;\n\t\t\tlet barCount = 0;\n\t\t\tconst container = this._container;\n\t\t\tif (container) {\n\t\t\t\tfor (let i = 0, imax = container.size(); i < imax; ++i) {\n\t\t\t\t\tconst series = container.get(i);\n\t\t\t\t\tif (series === this) {\n\t\t\t\t\t\tbarIndex = barCount;\n\t\t\t\t\t}\n\t\t\t\t\tif (series instanceof DChartSeriesBar) {\n\t\t\t\t\t\tbarCount += 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tbarCount = Math.max(1, barCount);\n\t\t\tthis._barCount = barCount;\n\t\t\tthis._barIndex = barIndex;\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tprotected applyLine(\n\t\tline: EShapeLineOfAny,\n\t\txcoordinate: DChartCoordinate<CHART>,\n\t\tycoordinate: DChartCoordinate<CHART>,\n\t\tsx: number,\n\t\tsy: number,\n\t\tcx: number,\n\t\tcy: number,\n\t\tvalues: number[]\n\t): void {\n\t\tconst linePoints = line.points;\n\t\tconst linePointsOffset = linePoints.offset;\n\t\tconst linePointsSize = linePoints.size;\n\n\t\t// Offset\n\t\tconst size = this._size;\n\t\tconst offset = this._offset;\n\t\tconst padding = this._padding;\n\t\tif (size && offset && padding) {\n\t\t\tconst xcoordinateId = xcoordinate.id;\n\t\t\tconst xcoordinateTransformId = xcoordinate.transform.id;\n\t\t\tif (\n\t\t\t\tthis.updateBarCountAndIndex() ||\n\t\t\t\tthis._xcoordinateId !== xcoordinateId ||\n\t\t\t\tthis._xcoordinateTransformId !== xcoordinateTransformId\n\t\t\t) {\n\t\t\t\tconst barCount = this._barCount;\n\t\t\t\tconst barIndex = this._barIndex;\n\t\t\t\tthis._xcoordinateId = xcoordinateId;\n\t\t\t\tthis._xcoordinateTransformId = xcoordinateTransformId;\n\n\t\t\t\tconst x0 = xcoordinate.transform.map(xcoordinate.map(0));\n\t\t\t\tconst x1 = xcoordinate.transform.map(xcoordinate.map(size.x));\n\t\t\t\tconst totalBandWidth = Math.abs(x0 - x1) * (1 - padding.outer);\n\t\t\t\tif (barCount <= 1) {\n\t\t\t\t\tlinePointsOffset.x = offset.x;\n\t\t\t\t\tlinePointsSize.x = totalBandWidth;\n\t\t\t\t} else {\n\t\t\t\t\tconst totalBarWidth = totalBandWidth * (1 - padding.inner);\n\t\t\t\t\tconst totalPaddingInner = totalBandWidth - totalBarWidth;\n\t\t\t\t\tconst barWidth = totalBarWidth / barCount;\n\t\t\t\t\tconst barPadding = totalPaddingInner / (barCount - 1);\n\t\t\t\t\tconst barX = barWidth * (barIndex + 0.5) + barIndex * barPadding;\n\t\t\t\t\tlinePointsOffset.x = offset.x + barX - totalBandWidth * 0.5;\n\t\t\t\t\tlinePointsSize.x = barWidth;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Sizes & Offsets\n\t\tlet sizes = linePointsSize.y;\n\t\tif (!isArray(sizes)) {\n\t\t\tsizes = [];\n\t\t}\n\t\tconst sizesLength = sizes.length;\n\n\t\tlet offsets = linePointsOffset.y;\n\t\tif (!isArray(offsets)) {\n\t\t\toffsets = [];\n\t\t}\n\t\tconst offsetsLength = offsets.length;\n\n\t\tlet isize = 0;\n\t\tconst y0 = ycoordinate.transform.map(ycoordinate.map(0)) - cy;\n\t\tfor (let i = 0, imax = values.length; i < imax; i += 2, isize += 1) {\n\t\t\tconst distance = values[i + 1] - y0;\n\n\t\t\tconst s = Math.abs(distance);\n\t\t\tif (isize < sizesLength) {\n\t\t\t\tsizes[isize] = s;\n\t\t\t} else {\n\t\t\t\tsizes.push(s);\n\t\t\t}\n\n\t\t\tconst o = -0.5 * distance;\n\t\t\tif (isize < offsetsLength) {\n\t\t\t\toffsets[isize] = o;\n\t\t\t} else {\n\t\t\t\toffsets.push(o);\n\t\t\t}\n\t\t}\n\t\tif (sizes.length !== isize) {\n\t\t\tsizes.length = isize;\n\t\t}\n\t\tif (offsets.length !== isize) {\n\t\t\toffsets.length = isize;\n\t\t}\n\n\t\tlinePointsOffset.y = offsets;\n\t\tlinePointsSize.y = sizes;\n\n\t\t// Others\n\t\tsuper.applyLine(line, xcoordinate, ycoordinate, sx, sy, cx, cy, values);\n\t}\n\n\tprotected calcSizeX(def: number): number {\n\t\tconst points = this._points;\n\t\tif (2 < points.length) {\n\t\t\tconst pointsLength = points.length;\n\t\t\tlet x0: number | null = points[pointsLength - 2];\n\t\t\tfor (let i = pointsLength - 4; 0 <= i; i -= 2) {\n\t\t\t\tconst x1 = points[i];\n\t\t\t\tif (x0 != null && x1 != null) {\n\t\t\t\t\treturn Math.abs(x0 - x1);\n\t\t\t\t} else {\n\t\t\t\t\tx0 = x1;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn def;\n\t}\n\n\tprotected calcRegion(\n\t\tpoints: Array<number | null>,\n\t\tdomain: DChartRegion,\n\t\trange: DChartRegion\n\t): void {\n\t\tsuper.calcRegion(points, domain, range);\n\n\t\tconst size = this._size;\n\t\tif (size) {\n\t\t\tlet sx = size.x;\n\t\t\tif (this._isSizeAutomatic) {\n\t\t\t\tsx = this.calcSizeX(sx);\n\t\t\t\tsize.x = sx;\n\t\t\t}\n\t\t\tconst sxh = sx * 0.5;\n\t\t\tdomain.set(domain.from - sxh, domain.to + sxh);\n\t\t}\n\t\trange.add(0, 0);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBase } from \"./d-base\";\nimport { DChartSeriesLineOfAny } from \"./d-chart-series-line-of-any\";\nimport { EShapeLineOfAny } from \"./shape/variant/e-shape-line-of-any\";\nimport { EShapeLineOfCircles } from \"./shape/variant/e-shape-line-of-circles\";\n\n/**\n * A series represents a line of circles.\n * Data points must be sorted in ascending order on the X axis.\n */\nexport class DChartSeriesLineOfCircles<\n\tCHART extends DBase = DBase\n> extends DChartSeriesLineOfAny<CHART> {\n\tprotected newLineOfAny(): EShapeLineOfAny {\n\t\treturn new EShapeLineOfCircles();\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBase } from \"./d-base\";\nimport { DChartSeriesLineOfAny } from \"./d-chart-series-line-of-any\";\nimport { EShapeLineOfAny } from \"./shape/variant/e-shape-line-of-any\";\nimport { EShapeLineOfRectangleRoundeds } from \"./shape/variant/e-shape-line-of-rectangle-roundeds\";\n\n/**\n * A series represents a line of rounded rectangles.\n * Data points must be sorted in ascending order on the X axis.\n */\nexport class DChartSeriesLineOfRectangleRoundeds<\n\tCHART extends DBase = DBase\n> extends DChartSeriesLineOfAny<CHART> {\n\tprotected newLineOfAny(): EShapeLineOfAny {\n\t\treturn new EShapeLineOfRectangleRoundeds();\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBase } from \"./d-base\";\nimport { DChartSeriesLineOfAny } from \"./d-chart-series-line-of-any\";\nimport { EShapeLineOfAny } from \"./shape/variant/e-shape-line-of-any\";\nimport { EShapeLineOfRectangles } from \"./shape/variant/e-shape-line-of-rectangles\";\n\n/**\n * A series represents a line of rectangles.\n * Data points must be sorted in ascending order on the X axis.\n */\nexport class DChartSeriesLineOfRectangles<\n\tCHART extends DBase = DBase\n> extends DChartSeriesLineOfAny<CHART> {\n\tprotected newLineOfAny(): EShapeLineOfAny {\n\t\treturn new EShapeLineOfRectangles();\n\t}\n}\n","/*\n * Copyright (C) 2020 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBase } from \"./d-base\";\nimport { DChartCoordinate } from \"./d-chart-coordinate\";\nimport { DChartSeriesLineOfAny, DChartSeriesLineOfAnyOptions } from \"./d-chart-series-line-of-any\";\nimport { EShapeLineOfAny } from \"./shape/variant/e-shape-line-of-any\";\nimport { EShapeLineOfTriangles } from \"./shape/variant/e-shape-line-of-triangles\";\n\n/**\n * A series represents a line of triangles.\n * Data points must be sorted in ascending order on the X axis.\n */\nexport class DChartSeriesLineOfTriangles<\n\tCHART extends DBase = DBase\n> extends DChartSeriesLineOfAny<CHART> {\n\tprotected _sizeId: number;\n\n\tconstructor(options?: DChartSeriesLineOfAnyOptions) {\n\t\tsuper(options);\n\t\tthis._sizeId = 0;\n\t}\n\n\tprotected newLineOfAny(): EShapeLineOfAny {\n\t\treturn new EShapeLineOfTriangles();\n\t}\n\n\tprotected applyLine(\n\t\tline: EShapeLineOfAny,\n\t\txcoordinate: DChartCoordinate<CHART>,\n\t\tycoordinate: DChartCoordinate<CHART>,\n\t\tsx: number,\n\t\tsy: number,\n\t\tcx: number,\n\t\tcy: number,\n\t\tvalues: number[]\n\t): void {\n\t\t// Offset\n\t\tconst size = this._size;\n\t\tconst offset = this._offset;\n\t\tif (size && offset && this._sizeId !== size.y) {\n\t\t\tthis._sizeId = size.y;\n\t\t\tline.points.offset.y = offset.y - size.y * 0.2;\n\t\t}\n\n\t\t//\n\t\tsuper.applyLine(line, xcoordinate, ycoordinate, sx, sy, cx, cy, values);\n\t}\n}\n","/*\n * Copyright (C) 2020 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBase } from \"./d-base\";\nimport { DChartSeriesLineOfTriangles } from \"./d-chart-series-line-of-triangles\";\nimport { EShapeLineOfAny } from \"./shape/variant/e-shape-line-of-any\";\nimport { EShapeLineOfTriangleRoundeds } from \"./shape/variant/e-shape-line-of-triangle-roundeds\";\n\n/**\n * A series represents a line of rounded triangles.\n * Data points must be sorted in ascending order on the X axis.\n */\nexport class DChartSeriesLineOfTriangleRoundeds<\n\tCHART extends DBase = DBase\n> extends DChartSeriesLineOfTriangles<CHART> {\n\tprotected newLineOfAny(): EShapeLineOfAny {\n\t\treturn new EShapeLineOfTriangleRoundeds();\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Point } from \"pixi.js\";\nimport { DApplications } from \"./d-applications\";\nimport { DBase } from \"./d-base\";\nimport { DChartCoordinate } from \"./d-chart-coordinate\";\nimport { DChartSeriesHitResult } from \"./d-chart-series\";\nimport { DChartSeriesBase, DChartSeriesBaseOptions } from \"./d-chart-series-base\";\nimport { DChartSeriesContainer } from \"./d-chart-series-container\";\nimport {\n\tDChartSeriesStrokeComputed,\n\tDChartSeriesStrokeComputedOptions\n} from \"./d-chart-series-stroke-computed\";\nimport { EShapeLine } from \"./shape/variant/e-shape-line\";\nimport { toCeilingIndex } from \"./util/to-ceiling-index\";\n\n/**\n * {@link DChartSeriesLine} options.\n */\nexport interface DChartSeriesLineOptions extends DChartSeriesBaseOptions {\n\tpoints?: Array<number | null>;\n\tstroke?: DChartSeriesStrokeComputedOptions;\n}\n\n/**\n * A series represents a polyline.\n * Data points must be sorted in ascending order on the X axis.\n */\nexport class DChartSeriesLine<CHART extends DBase = DBase> extends DChartSeriesBase<CHART> {\n\tprotected static WORK: Point = new Point();\n\tprotected _line: EShapeLine | null;\n\tprotected _options?: DChartSeriesLineOptions;\n\tprotected _points: Array<number | null>;\n\tprotected _pointId: number;\n\tprotected _pointIdUpdated: number;\n\tprotected _stroke?: DChartSeriesStrokeComputed;\n\tprotected _centerX: number;\n\tprotected _centerY: number;\n\n\tconstructor(options?: DChartSeriesLineOptions) {\n\t\tsuper(options);\n\t\tthis._line = null;\n\t\tthis._options = options;\n\t\tthis._points = options?.points ?? [];\n\t\tthis._pointId = 0;\n\t\tthis._pointIdUpdated = NaN;\n\t\tthis._centerX = 0;\n\t\tthis._centerY = 0;\n\t}\n\n\tbind(container: DChartSeriesContainer<CHART>, index: number): void {\n\t\tlet line = this._line;\n\t\tif (!line) {\n\t\t\tconst stroke = container.newStroke(index, this._options?.stroke);\n\t\t\tthis._stroke = stroke;\n\t\t\tline = new EShapeLine();\n\t\t\tline.stroke.copy(stroke);\n\t\t\tthis._line = line;\n\t\t}\n\t\tline.attach(container.plotArea.container, index);\n\t\tthis._pointIdUpdated = NaN;\n\t\tsuper.bind(container, index);\n\t}\n\n\tunbind(): void {\n\t\tconst line = this._line;\n\t\tif (line) {\n\t\t\tline.detach();\n\t\t}\n\t\tsuper.unbind();\n\t}\n\n\tget shape(): EShapeLine | null {\n\t\treturn this._line;\n\t}\n\n\tget points(): Array<number | null> {\n\t\treturn this._points;\n\t}\n\n\tset points(points: Array<number | null>) {\n\t\tthis._points = points;\n\t\tthis._pointId += 1;\n\t}\n\n\ttoDirty(): void {\n\t\tthis._pointId += 1;\n\t}\n\n\tupdate(): void {\n\t\tconst line = this._line;\n\t\tif (line) {\n\t\t\tconst coordinate = this._coordinate;\n\t\t\tconst coordinateX = coordinate.x;\n\t\t\tconst coordinateY = coordinate.y;\n\t\t\tif (coordinateX && coordinateY) {\n\t\t\t\tconst pointId = this._pointId;\n\t\t\t\tconst isPointChanged = pointId !== this._pointIdUpdated;\n\t\t\t\tconst isCoordinateChanged = coordinate.isDirty(coordinateX, coordinateY);\n\t\t\t\tconst isCoordinateTransformChanged = coordinate.isTransformDirty(\n\t\t\t\t\tcoordinateX,\n\t\t\t\t\tcoordinateY\n\t\t\t\t);\n\t\t\t\tif (isPointChanged || isCoordinateChanged || isCoordinateTransformChanged) {\n\t\t\t\t\tthis._pointIdUpdated = pointId;\n\t\t\t\t\tthis.updateLine(\n\t\t\t\t\t\tline,\n\t\t\t\t\t\tcoordinateX,\n\t\t\t\t\t\tcoordinateY,\n\t\t\t\t\t\tisPointChanged || isCoordinateChanged\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected updateLine(\n\t\tline: EShapeLine,\n\t\txcoordinate: DChartCoordinate<CHART>,\n\t\tycoordinate: DChartCoordinate<CHART>,\n\t\tisPointsDirty: boolean\n\t): void {\n\t\tline.disallowUploadedUpdate();\n\t\tif (isPointsDirty) {\n\t\t\tconst values = line.points.values;\n\t\t\tconst segments = line.points.segments;\n\t\t\tconst valuesLength = values.length;\n\t\t\tconst segmentsLength = segments.length;\n\t\t\tlet ivalues = 0;\n\t\t\tlet isegments = 0;\n\t\t\tconst points = this._points;\n\t\t\tlet xmin = NaN;\n\t\t\tlet xmax = NaN;\n\t\t\tlet ymin = NaN;\n\t\t\tlet ymax = NaN;\n\t\t\tfor (let i = 0, imax = points.length; i < imax; i += 2) {\n\t\t\t\tconst x = points[i];\n\t\t\t\tconst y = points[i + 1];\n\t\t\t\tif (x != null && y != null) {\n\t\t\t\t\tif (ivalues < valuesLength) {\n\t\t\t\t\t\tvalues[ivalues] = x;\n\t\t\t\t\t\tvalues[ivalues + 1] = y;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvalues.push(x, y);\n\t\t\t\t\t}\n\t\t\t\t\tivalues += 2;\n\t\t\t\t\tif (xmin !== xmin) {\n\t\t\t\t\t\txmin = x;\n\t\t\t\t\t\txmax = x;\n\t\t\t\t\t\tymin = y;\n\t\t\t\t\t\tymax = y;\n\t\t\t\t\t} else {\n\t\t\t\t\t\txmin = Math.min(xmin, x);\n\t\t\t\t\t\txmax = Math.max(xmax, x);\n\t\t\t\t\t\tymin = Math.min(ymin, y);\n\t\t\t\t\t\tymax = Math.max(ymax, y);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconst segment = (i >> 1) - isegments;\n\t\t\t\t\tif (isegments < segmentsLength) {\n\t\t\t\t\t\tsegments[isegments] = segment;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsegments.push(segment);\n\t\t\t\t\t}\n\t\t\t\t\tisegments += 1;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (values.length !== ivalues) {\n\t\t\t\tvalues.length = ivalues;\n\t\t\t}\n\t\t\tif (segments.length !== isegments) {\n\t\t\t\tsegments.length = isegments;\n\t\t\t}\n\n\t\t\txcoordinate.mapAll(values, 0, ivalues, 2, 0);\n\t\t\tycoordinate.mapAll(values, 0, ivalues, 2, 1);\n\n\t\t\tif (xmin !== xmin) {\n\t\t\t\txmin = 0;\n\t\t\t\txmax = 0;\n\t\t\t\tymin = 0;\n\t\t\t\tymax = 0;\n\t\t\t}\n\n\t\t\txmin = xcoordinate.map(xmin);\n\t\t\txmax = xcoordinate.map(xmax);\n\t\t\tymin = ycoordinate.map(ymin);\n\t\t\tymax = ycoordinate.map(ymax);\n\n\t\t\tconst sx = Math.abs(xmax - xmin);\n\t\t\tconst sy = Math.abs(ymax - ymin);\n\t\t\tconst cx = (xmin + xmax) * 0.5;\n\t\t\tconst cy = (ymin + ymax) * 0.5;\n\t\t\tfor (let i = 0, imax = values.length; i < imax; i += 2) {\n\t\t\t\tvalues[i + 0] -= cx;\n\t\t\t\tvalues[i + 1] -= cy;\n\t\t\t}\n\n\t\t\tline.size.set(sx, sy);\n\t\t\tline.points.set(values, segments);\n\t\t\tthis._centerX = cx;\n\t\t\tthis._centerY = cy;\n\t\t}\n\n\t\tline.transform.position.set(\n\t\t\txcoordinate.transform.map(this._centerX),\n\t\t\tycoordinate.transform.map(this._centerY)\n\t\t);\n\t\tline.transform.scale.set(xcoordinate.transform.scale, ycoordinate.transform.scale);\n\n\t\tline.allowUploadedUpdate();\n\t\tDApplications.update(line);\n\t}\n\n\tprotected updateRegion(): void {\n\t\tconst pointId = this._pointId;\n\t\tif (this._regionPointId !== pointId) {\n\t\t\tthis._regionPointId = pointId;\n\n\t\t\tconst points = this._points;\n\t\t\tconst domain = this._domain;\n\t\t\tconst range = this._range;\n\t\t\tdomain.clear();\n\t\t\trange.clear();\n\t\t\tif (points != null) {\n\t\t\t\tfor (let i = 0, imax = points.length; i < imax; i += 2) {\n\t\t\t\t\tconst xraw = points[i];\n\t\t\t\t\tif (xraw != null) {\n\t\t\t\t\t\tdomain.add(xraw, xraw);\n\t\t\t\t\t}\n\t\t\t\t\tconst yraw = points[i + 1];\n\t\t\t\t\tif (yraw != null) {\n\t\t\t\t\t\trange.add(yraw, yraw);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tdestroy(): void {\n\t\tconst line = this._line;\n\t\tif (line) {\n\t\t\tthis._line = null;\n\t\t\tline.detach();\n\t\t\tline.destroy();\n\t\t}\n\n\t\tthis._points.length = 0;\n\t\tthis._pointId = 0;\n\t\tthis._pointIdUpdated = NaN;\n\t\tsuper.destroy();\n\t}\n\n\thitTest(x: number, y: number): boolean {\n\t\tconst line = this._line;\n\t\tif (line) {\n\t\t\tconst local = DChartSeriesLine.WORK;\n\t\t\tlocal.set(x, y);\n\t\t\tline.toLocal(local, undefined, local);\n\t\t\treturn line.contains(local.x, local.y) != null;\n\t\t}\n\t\treturn false;\n\t}\n\n\tcalcHitPoint(x: number, y: number, result: DChartSeriesHitResult): boolean {\n\t\tconst line = this._line;\n\t\tif (line) {\n\t\t\tconst local = DChartSeriesLine.WORK;\n\t\t\tlocal.set(x, y);\n\t\t\tline.toLocal(local, undefined, local);\n\t\t\tresult.shape = line;\n\t\t\treturn line.calcHitPoint(\n\t\t\t\tlocal.x,\n\t\t\t\tlocal.y,\n\t\t\t\tthis.toThreshold,\n\t\t\t\tthis.calcHitPointTestRange,\n\t\t\t\tthis.calcHitPointHitTester,\n\t\t\t\tresult\n\t\t\t);\n\t\t}\n\t\treturn false;\n\t}\n\n\tprotected toThreshold(this: unknown, strokeWidth: number, strokeScale: number): number {\n\t\treturn +Infinity;\n\t}\n\n\tcalcHitPointTestRange(\n\t\tthis: unknown,\n\t\tx: number,\n\t\ty: number,\n\t\tthreshold: number,\n\t\tvalues: number[],\n\t\tresult: [number, number]\n\t): [number, number] {\n\t\tconst index = toCeilingIndex(values, x, 2, 0);\n\t\tresult[0] = Math.max(0, index - 1);\n\t\tresult[1] = index;\n\t\treturn result;\n\t}\n\n\tcalcHitPointHitTester(\n\t\tthis: unknown,\n\t\tx: number,\n\t\ty: number,\n\t\tp0x: number,\n\t\tp0y: number,\n\t\tp1x: number,\n\t\tp1y: number,\n\t\tindex: number,\n\t\tthreshold: number,\n\t\tresult: DChartSeriesHitResult\n\t): boolean {\n\t\tif (p0x <= x && x < p1x) {\n\t\t\tconst l = p1x - p0x;\n\t\t\tif (0.0001 < Math.abs(l)) {\n\t\t\t\tconst t = (x - p0x) / l;\n\t\t\t\tconst p2x = x;\n\t\t\t\tconst p2y = p0y + t * (p1y - p0y);\n\t\t\t\tconst distance = Math.abs(p2y - y);\n\t\t\t\tif (distance < threshold) {\n\t\t\t\t\tconst transform = result.shape!.transform;\n\t\t\t\t\tconst position = transform.position;\n\t\t\t\t\tconst px = position.x;\n\t\t\t\t\tconst py = position.y;\n\t\t\t\t\tconst scale = transform.scale;\n\t\t\t\t\tconst sx = scale.x;\n\t\t\t\t\tconst sy = scale.y;\n\t\t\t\t\tresult.x = px + sx * p2x;\n\t\t\t\t\tresult.y = py + sy * p2y;\n\t\t\t\t\tresult.p0x = px + sx * p0x;\n\t\t\t\t\tresult.p0y = py + sy * p0y;\n\t\t\t\t\tresult.p1x = px + sx * p1x;\n\t\t\t\t\tresult.p1y = py + sy * p1y;\n\t\t\t\t\tresult.t = t;\n\t\t\t\t\tresult.index = index;\n\t\t\t\t\tresult.distance = distance;\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {\n\tDChartSeriesLinearParameters,\n\tDChartSeriesLinearParametersOptions\n} from \"./d-chart-series-linear-parameters\";\n\nexport class DChartSeriesExpressionParametersImpl implements DChartSeriesLinearParameters {\n\tprotected _id: number;\n\tprotected _idUpdated: number;\n\tprotected _a: number;\n\tprotected _b: number;\n\tprotected _x0: number;\n\tprotected _y0: number;\n\n\tconstructor(a: number, b: number, x0: number, y0: number) {\n\t\tthis._id = 0;\n\t\tthis._idUpdated = NaN;\n\t\tthis._a = a;\n\t\tthis._b = b;\n\t\tthis._x0 = x0;\n\t\tthis._y0 = y0;\n\t}\n\n\tget a(): number {\n\t\treturn this._a;\n\t}\n\n\tset a(a: number) {\n\t\tif (this._a !== a) {\n\t\t\tthis._id += 1;\n\t\t\tthis._a = a;\n\t\t}\n\t}\n\n\tget b(): number {\n\t\treturn this._b;\n\t}\n\n\tset b(b: number) {\n\t\tif (this._b !== b) {\n\t\t\tthis._id += 1;\n\t\t\tthis._b = b;\n\t\t}\n\t}\n\n\tget x0(): number {\n\t\treturn this._x0;\n\t}\n\n\tset x0(x0: number) {\n\t\tif (this._x0 !== x0) {\n\t\t\tthis._id += 1;\n\t\t\tthis._x0 = x0;\n\t\t}\n\t}\n\n\tget y0(): number {\n\t\treturn this._y0;\n\t}\n\n\tset y0(y0: number) {\n\t\tif (this._y0 !== y0) {\n\t\t\tthis._id += 1;\n\t\t\tthis._y0 = y0;\n\t\t}\n\t}\n\n\ttoDirty(): void {\n\t\tthis._id += 1;\n\t}\n\n\tisDirty(): boolean {\n\t\treturn this._id !== this._idUpdated;\n\t}\n\n\ttoClean(): void {\n\t\tthis._idUpdated = this._id;\n\t}\n\n\tstatic from(\n\t\toptions?: DChartSeriesLinearParametersOptions\n\t): DChartSeriesExpressionParametersImpl {\n\t\treturn new DChartSeriesExpressionParametersImpl(\n\t\t\toptions?.a ?? 1,\n\t\t\toptions?.b ?? 1,\n\t\t\toptions?.x0 ?? 0,\n\t\t\toptions?.y0 ?? 0\n\t\t);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Point } from \"pixi.js\";\nimport { DApplications } from \"./d-applications\";\nimport { DBase } from \"./d-base\";\nimport { DChartCoordinate } from \"./d-chart-coordinate\";\nimport { DChartSeriesHitResult } from \"./d-chart-series\";\nimport { DChartSeriesBase, DChartSeriesBaseOptions } from \"./d-chart-series-base\";\nimport { DChartSeriesContainer } from \"./d-chart-series-container\";\nimport {\n\tDChartSeriesLinearParameters,\n\tDChartSeriesLinearParametersOptions\n} from \"./d-chart-series-linear-parameters\";\nimport { DChartSeriesExpressionParametersImpl } from \"./d-chart-series-linear-parameters-impl\";\nimport {\n\tDChartSeriesStrokeComputed,\n\tDChartSeriesStrokeComputedOptions\n} from \"./d-chart-series-stroke-computed\";\nimport { EShapeLine } from \"./shape/variant/e-shape-line\";\n\n/**\n * {@link DChartSeriesLinear} options.\n */\nexport interface DChartSeriesLinearOptions\n\textends DChartSeriesLinearParametersOptions,\n\t\tDChartSeriesBaseOptions {\n\tstroke?: DChartSeriesStrokeComputedOptions;\n}\n\n/**\n * A series represents a linear equation `a (x - x0) === b (y - y0)`.\n */\nexport class DChartSeriesLinear<CHART extends DBase = DBase> extends DChartSeriesBase<CHART> {\n\tprotected static WORK: Point = new Point();\n\tprotected _line: EShapeLine | null;\n\tprotected _options?: DChartSeriesLinearOptions;\n\tprotected _plotAreaSizeXUpdated: number;\n\tprotected _plotAreaSizeYUpdated: number;\n\tprotected _parameters: DChartSeriesExpressionParametersImpl;\n\tprotected _stroke?: DChartSeriesStrokeComputed;\n\n\tconstructor(options?: DChartSeriesLinearOptions) {\n\t\tsuper(options);\n\t\tthis._line = null;\n\t\tthis._options = options;\n\t\tthis._plotAreaSizeXUpdated = NaN;\n\t\tthis._plotAreaSizeYUpdated = NaN;\n\t\tthis._parameters = DChartSeriesExpressionParametersImpl.from(options);\n\t}\n\n\tbind(container: DChartSeriesContainer<CHART>, index: number): void {\n\t\tlet line = this._line;\n\t\tif (!line) {\n\t\t\tconst stroke = container.newStroke(index, this._options?.stroke);\n\t\t\tthis._stroke = stroke;\n\t\t\tline = new EShapeLine();\n\t\t\tline.stroke.copy(stroke);\n\t\t\tthis._line = line;\n\t\t}\n\t\tline.attach(container.plotArea.container, index);\n\t\tthis._parameters.toDirty();\n\t\tthis._plotAreaSizeXUpdated = NaN;\n\t\tthis._plotAreaSizeYUpdated = NaN;\n\t\tsuper.bind(container, index);\n\t}\n\n\tunbind(): void {\n\t\tconst line = this._line;\n\t\tif (line) {\n\t\t\tline.detach();\n\t\t}\n\t\tsuper.unbind();\n\t}\n\n\tget shape(): EShapeLine | null {\n\t\treturn this._line;\n\t}\n\n\tget parameters(): DChartSeriesLinearParameters {\n\t\treturn this._parameters;\n\t}\n\n\ttoDirty(): void {\n\t\tthis._parameters.toDirty();\n\t}\n\n\tupdate(): void {\n\t\tconst line = this._line;\n\t\tconst container = this._container;\n\t\tif (line && container) {\n\t\t\tconst plotArea = container.plotArea;\n\t\t\tconst coordinate = this._coordinate;\n\t\t\tconst coordinateX = coordinate.x;\n\t\t\tconst coordinateY = coordinate.y;\n\t\t\tif (coordinateX && coordinateY) {\n\t\t\t\tconst plotAreaWidth = plotArea.width;\n\t\t\t\tconst plotAreaHeight = plotArea.height;\n\n\t\t\t\tconst parameters = this._parameters;\n\t\t\t\tconst isParametersChanged = parameters.isDirty();\n\t\t\t\tconst isCoordinateChanged = coordinate.isDirty(coordinateX, coordinateY);\n\t\t\t\tconst isCoordinateTransformChanged = coordinate.isTransformDirty(\n\t\t\t\t\tcoordinateX,\n\t\t\t\t\tcoordinateY\n\t\t\t\t);\n\t\t\t\tconst isPlotAreaSizeChagned =\n\t\t\t\t\tplotAreaWidth !== this._plotAreaSizeXUpdated ||\n\t\t\t\t\tplotAreaHeight !== this._plotAreaSizeYUpdated;\n\t\t\t\tif (\n\t\t\t\t\tisParametersChanged ||\n\t\t\t\t\tisCoordinateChanged ||\n\t\t\t\t\tisCoordinateTransformChanged ||\n\t\t\t\t\tisPlotAreaSizeChagned\n\t\t\t\t) {\n\t\t\t\t\tparameters.toClean();\n\t\t\t\t\tthis._plotAreaSizeXUpdated = plotAreaWidth;\n\t\t\t\t\tthis._plotAreaSizeYUpdated = plotAreaHeight;\n\t\t\t\t\tthis.updateLine(line, coordinateX, coordinateY, plotAreaWidth, plotAreaHeight);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected updateLine(\n\t\tline: EShapeLine,\n\t\txcoordinate: DChartCoordinate<CHART>,\n\t\tycoordinate: DChartCoordinate<CHART>,\n\t\tplotAreaSizeX: number,\n\t\tplotAreaSizeY: number\n\t): void {\n\t\tconst values = line.points.values;\n\t\tconst segments = line.points.segments;\n\n\t\tconst parameters = this._parameters;\n\t\tconst a = parameters.a;\n\t\tconst b = parameters.b;\n\t\tconst x0 = parameters.x0;\n\t\tconst y0 = parameters.y0;\n\t\tconst aabs = Math.abs(a);\n\t\tconst babs = Math.abs(b);\n\n\t\tlet p0x = NaN;\n\t\tlet p0y = NaN;\n\t\tlet p1x = NaN;\n\t\tlet p1y = NaN;\n\n\t\tconst threshold = 0.00001;\n\t\tif (babs <= aabs) {\n\t\t\tconst xfrom = xcoordinate.unmap(xcoordinate.transform.unmap(0));\n\t\t\tconst xto = xcoordinate.unmap(xcoordinate.transform.unmap(plotAreaSizeX));\n\t\t\tp0x = Math.min(xfrom, xto);\n\t\t\tp1x = Math.max(xfrom, xto);\n\n\t\t\tconst yfrom = ycoordinate.unmap(ycoordinate.transform.unmap(0));\n\t\t\tconst yto = ycoordinate.unmap(ycoordinate.transform.unmap(plotAreaSizeY));\n\t\t\tp0y = Math.min(yfrom, yto);\n\t\t\tp1y = Math.max(yfrom, yto);\n\n\t\t\tif (threshold < babs) {\n\t\t\t\tconst f = b / a;\n\t\t\t\tconst xfrom1 = f * (yfrom - y0) + x0;\n\t\t\t\tconst xto1 = f * (yto - y0) + x0;\n\t\t\t\tconst p2x = Math.min(xfrom1, xto1);\n\t\t\t\tconst p3x = Math.max(xfrom1, xto1);\n\t\t\t\tp0x = Math.max(p0x, p2x);\n\t\t\t\tp1x = Math.min(p1x, p3x);\n\t\t\t\tconst g = 1 / f;\n\t\t\t\tp0y = g * (p0x - x0) + b * y0;\n\t\t\t\tp1y = g * (p1x - x0) + b * y0;\n\t\t\t} else {\n\t\t\t\tp0x = x0;\n\t\t\t\tp1x = x0;\n\t\t\t}\n\t\t} else {\n\t\t\tconst yfrom = ycoordinate.unmap(ycoordinate.transform.unmap(0));\n\t\t\tconst yto = ycoordinate.unmap(ycoordinate.transform.unmap(plotAreaSizeY));\n\t\t\tp0y = Math.min(yfrom, yto);\n\t\t\tp1y = Math.max(yfrom, yto);\n\n\t\t\tconst xfrom = xcoordinate.unmap(xcoordinate.transform.unmap(0));\n\t\t\tconst xto = xcoordinate.unmap(xcoordinate.transform.unmap(plotAreaSizeX));\n\t\t\tp0x = Math.min(xfrom, xto);\n\t\t\tp1x = Math.max(xfrom, xto);\n\n\t\t\tif (threshold < aabs) {\n\t\t\t\tconst f = a / b;\n\t\t\t\tconst yfrom1 = f * (xfrom - x0) + y0;\n\t\t\t\tconst yto1 = f * (xto - x0) + y0;\n\t\t\t\tconst p2y = Math.min(yfrom1, yto1);\n\t\t\t\tconst p3y = Math.max(yfrom1, yto1);\n\t\t\t\tp0y = Math.max(p0y, p2y);\n\t\t\t\tp1y = Math.min(p1y, p3y);\n\t\t\t\tconst g = 1 / f;\n\t\t\t\tp0x = g * (p0y - y0) + a * x0;\n\t\t\t\tp1x = g * (p1y - y0) + a * x0;\n\t\t\t} else {\n\t\t\t\tp0y = y0;\n\t\t\t\tp1y = y0;\n\t\t\t}\n\t\t}\n\n\t\tp0x = xcoordinate.transform.map(xcoordinate.map(p0x));\n\t\tp0y = ycoordinate.transform.map(ycoordinate.map(p0y));\n\t\tp1x = xcoordinate.transform.map(xcoordinate.map(p1x));\n\t\tp1y = ycoordinate.transform.map(ycoordinate.map(p1y));\n\n\t\tconst cx = (p0x + p1x) * 0.5;\n\t\tconst cy = (p0y + p1y) * 0.5;\n\t\tconst sx = Math.abs(p1x - p0x);\n\t\tconst sy = Math.abs(p1y - p0y);\n\n\t\tp0x -= cx;\n\t\tp0y -= cy;\n\t\tp1x -= cx;\n\t\tp1y -= cy;\n\n\t\tif (values.length !== 4) {\n\t\t\tvalues.length = 0;\n\t\t\tvalues.push(p0x, p0y, p1x, p1y);\n\t\t} else {\n\t\t\tvalues[0] = p0x;\n\t\t\tvalues[1] = p0y;\n\t\t\tvalues[2] = p1x;\n\t\t\tvalues[3] = p1y;\n\t\t}\n\t\tif (0 < segments.length) {\n\t\t\tsegments.length = 0;\n\t\t}\n\t\tline.disallowUploadedUpdate();\n\t\tline.points.set(values, segments);\n\t\tline.size.set(sx, sy);\n\t\tline.points.toFitted();\n\t\tline.transform.position.set(cx, cy);\n\t\tline.allowUploadedUpdate();\n\t\tDApplications.update(line);\n\t}\n\n\tprotected updateRegion(): void {\n\t\t// DO NOTHING\n\t}\n\n\tdestroy(): void {\n\t\tconst line = this._line;\n\t\tif (line) {\n\t\t\tthis._line = null;\n\t\t\tline.detach();\n\t\t\tline.destroy();\n\t\t}\n\t\tsuper.destroy();\n\t}\n\n\thitTest(x: number, y: number): boolean {\n\t\tconst line = this._line;\n\t\tif (line) {\n\t\t\tconst local = DChartSeriesLinear.WORK;\n\t\t\tlocal.set(x, y);\n\t\t\tline.toLocal(local, undefined, local);\n\t\t\treturn line.contains(local.x, local.y) != null;\n\t\t}\n\t\treturn false;\n\t}\n\n\tcalcHitPoint(x: number, y: number, result: DChartSeriesHitResult): boolean {\n\t\tconst line = this._line;\n\t\tif (line) {\n\t\t\tconst local = DChartSeriesLinear.WORK;\n\t\t\tlocal.set(x, y);\n\t\t\tline.toLocal(local, undefined, local);\n\t\t\tresult.shape = line;\n\t\t\treturn line.calcHitPoint(\n\t\t\t\tlocal.x,\n\t\t\t\tlocal.y,\n\t\t\t\tthis.toThreshold,\n\t\t\t\tnull,\n\t\t\t\tthis.calcHitPointHitTester,\n\t\t\t\tresult\n\t\t\t);\n\t\t}\n\t\treturn false;\n\t}\n\n\tprotected toThreshold(this: unknown, strokeWidth: number, strokeScale: number): number {\n\t\treturn +Infinity;\n\t}\n\n\tcalcHitPointHitTester(\n\t\tthis: unknown,\n\t\tx: number,\n\t\ty: number,\n\t\tp0x: number,\n\t\tp0y: number,\n\t\tp1x: number,\n\t\tp1y: number,\n\t\tindex: number,\n\t\tthreshold: number,\n\t\tresult: DChartSeriesHitResult\n\t): boolean {\n\t\tif (p0x <= x && x < p1x) {\n\t\t\tconst l = p1x - p0x;\n\t\t\tif (0.0001 < Math.abs(l)) {\n\t\t\t\tconst t = (x - p0x) / l;\n\t\t\t\tconst p2x = x;\n\t\t\t\tconst p2y = p0y + t * (p1y - p0y);\n\t\t\t\tconst distance = Math.abs(p2y - y);\n\t\t\t\tif (distance < threshold) {\n\t\t\t\t\tconst transform = result.shape!.transform;\n\t\t\t\t\tconst position = transform.position;\n\t\t\t\t\tconst px = position.x;\n\t\t\t\t\tconst py = position.y;\n\t\t\t\t\tconst scale = transform.scale;\n\t\t\t\t\tconst sx = scale.x;\n\t\t\t\t\tconst sy = scale.y;\n\t\t\t\t\tresult.x = result.p0x = result.p1x = px + sx * p2x;\n\t\t\t\t\tresult.y = result.p0y = result.p1y = py + sy * p2y;\n\t\t\t\t\tresult.t = t;\n\t\t\t\t\tresult.index = index;\n\t\t\t\t\tresult.distance = distance;\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBase, DBaseOptions, DThemeBase } from \"./d-base\";\nimport { DBaseOverflowMask } from \"./d-base-overflow-mask\";\nimport { DChartPlotArea, DChartPlotAreaOptions } from \"./d-chart-plot-area\";\nimport { DChartPlotAreaImpl } from \"./d-chart-plot-area-impl\";\n\nexport interface DChartOptions<THEME extends DThemeChart> extends DBaseOptions<THEME> {\n\tplotArea: DChartPlotAreaOptions<DChart>;\n\tmask?: boolean;\n}\n\nexport interface DThemeChart extends DThemeBase {\n\tisOverflowMaskEnabled(): boolean;\n}\n\nexport class DChart<\n\tTHEME extends DThemeChart = DThemeChart,\n\tOPTIONS extends DChartOptions<THEME> = DChartOptions<THEME>\n> extends DBase<THEME, OPTIONS> {\n\tprotected _plotArea?: DChartPlotArea<DChart>;\n\tprotected _overflowMask?: DBaseOverflowMask | null;\n\n\tprotected init(options?: OPTIONS): void {\n\t\tsuper.init(options);\n\n\t\t// Plot area\n\t\tconst plotArea = this.plotArea;\n\t\tthis.addChild(plotArea);\n\n\t\t// Overflow mask\n\t\tconst mask = options?.mask ?? this.theme.isOverflowMaskEnabled();\n\t\tif (mask) {\n\t\t\tplotArea.axis.container.mask = this.getOverflowMask();\n\t\t}\n\t}\n\n\tprotected getOverflowMask(): DBaseOverflowMask {\n\t\tif (this._overflowMask == null) {\n\t\t\tthis._overflowMask = new DBaseOverflowMask(this);\n\t\t\tthis.reflowable.add(this._overflowMask);\n\t\t\tthis.toDirty();\n\t\t}\n\t\treturn this._overflowMask;\n\t}\n\n\tget plotArea(): DChartPlotArea<DChart> {\n\t\tlet result = this._plotArea;\n\t\tif (result == null) {\n\t\t\tresult = this.newPlotArea();\n\t\t\tthis._plotArea = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected newPlotArea(): DChartPlotArea<DChart> {\n\t\treturn new DChartPlotAreaImpl<DChart>(this, this._options?.plotArea);\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DChart\";\n\t}\n\n\tdestroy(): void {\n\t\tif (!this._destroyed) {\n\t\t\tthis._plotArea?.destroy();\n\t\t\tsuper.destroy();\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DCommand } from \"./d-command\";\nimport { DCommandFlag } from \"./d-command-flag\";\n\nexport abstract class DCommandCreate implements DCommand {\n\tabstract execute(): Promise<unknown> | boolean;\n\n\tredo(): Promise<unknown> | boolean {\n\t\tthrow new Error(\"Method not implemented.\");\n\t}\n\n\tundo(): Promise<unknown> | boolean {\n\t\tthrow new Error(\"Method not implemented.\");\n\t}\n\n\tdestroy(): void {\n\t\t// DO NOTHING\n\t}\n\n\tgetFlag(): DCommandFlag {\n\t\treturn DCommandFlag.UNSTORABLE | DCommandFlag.CLEAR;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DCommand } from \"./d-command\";\nimport { DCommandFlag } from \"./d-command-flag\";\nimport { DControllers } from \"./d-controllers\";\n\nexport class DCommandDelete implements DCommand {\n\texecute(): Promise<unknown> | boolean {\n\t\treturn DControllers.getDocumentController().delete();\n\t}\n\n\tredo(): Promise<unknown> | boolean {\n\t\tthrow new Error(\"Method not implemented.\");\n\t}\n\n\tundo(): Promise<unknown> | boolean {\n\t\tthrow new Error(\"Method not implemented.\");\n\t}\n\n\tdestroy(): void {\n\t\t// DO NOTHING\n\t}\n\n\tgetFlag(): DCommandFlag {\n\t\treturn DCommandFlag.UNSTORABLE | DCommandFlag.CLEAR;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DCommand } from \"./d-command\";\nimport { DCommandFlag } from \"./d-command-flag\";\nimport { DControllers } from \"./d-controllers\";\n\nexport class DCommandSaveAs implements DCommand {\n\tprotected _name: string;\n\n\tconstructor(name: string) {\n\t\tthis._name = name;\n\t}\n\n\texecute(): Promise<unknown> | boolean {\n\t\treturn DControllers.getDocumentController().saveAs(this._name);\n\t}\n\n\tredo(): Promise<unknown> | boolean {\n\t\treturn true;\n\t}\n\n\tundo(): Promise<unknown> | boolean {\n\t\treturn true;\n\t}\n\n\tdestroy(): void {\n\t\t// DO NOTHING\n\t}\n\n\tgetFlag(): DCommandFlag {\n\t\treturn DCommandFlag.UNSTORABLE;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DCommand } from \"./d-command\";\nimport { DCommandFlag } from \"./d-command-flag\";\nimport { DControllers } from \"./d-controllers\";\n\nexport class DCommandSave implements DCommand {\n\texecute(): Promise<unknown> | boolean {\n\t\treturn DControllers.getDocumentController().save();\n\t}\n\n\tredo(): Promise<unknown> | boolean {\n\t\treturn true;\n\t}\n\n\tundo(): Promise<unknown> | boolean {\n\t\treturn true;\n\t}\n\n\tdestroy(): void {\n\t\t// DO NOTHING\n\t}\n\n\tgetFlag(): DCommandFlag {\n\t\treturn DCommandFlag.UNSTORABLE;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { utils } from \"pixi.js\";\nimport { DApplications } from \"./d-applications\";\nimport { DBase } from \"./d-base\";\nimport { DBaseSnippetContainer } from \"./d-base-snippet-container\";\nimport { DOnOptions } from \"./d-on-options\";\nimport { DView } from \"./d-view\";\nimport { EShapeContainer } from \"./shape\";\nimport { isNumber } from \"./util\";\nimport { isString } from \"./util/is-string\";\nimport { UtilExtract } from \"./util/util-extract\";\n\nexport interface DDiagramSnapshotParent<CANVAS> {\n\tcanvas: CANVAS | null;\n\tview: DView;\n}\n\nexport interface DDiagramSnapshotEvents<CANVAS, EMITTER> {\n\t/**\n\t * Triggered before taking a snapshot.\n\t *\n\t * @param canvas a canvas\n\t * @param emitter an emitter\n\t */\n\ttaking(canvas: CANVAS, emitter: EMITTER): void;\n\n\t/**\n\t * Triggered when a snapshot is taken successfully or when failed to take.\n\t *\n\t * @param canvas a canvas\n\t * @param reason Null if succeeded. Otherwise, a string representing a reason why failed.\n\t * @param emitter an emitter\n\t */\n\ttook(canvas: CANVAS, reason: string | null, emitter: EMITTER): void;\n}\n\nexport interface DDiagramSnapshotCanvasSnap {\n\tcontainer: EShapeContainer;\n}\n\nexport interface DDiagramSnapshotCanvas extends DBase {\n\tsnap?: DDiagramSnapshotCanvasSnap | null;\n}\n\nexport interface DDiagramSnapshotOnOptions<CANVAS, EMITTER>\n\textends Partial<DDiagramSnapshotEvents<CANVAS, EMITTER>>,\n\t\tDOnOptions {}\n\n/**\n * Options to eliminate the snap grid, the snap targets and the canvas background from a snapshot.\n */\nexport interface DDiagramSnapshotCleanupOptions {\n\tsnap?: boolean;\n\tbackground?: boolean;\n\trefit?: boolean;\n\treflow?: boolean;\n}\n\nexport interface DDiagramSnapshotCreateAsUrlOptions {\n\tsize?: number | null;\n\tcleanup?: boolean | DDiagramSnapshotCleanupOptions;\n}\n\nexport interface DDiagramSnapshotCreateAsFileOptions {\n\tsize?: number | null;\n\tfilename: string;\n\tcleanup?: boolean | DDiagramSnapshotCleanupOptions;\n}\n\nexport interface DDiagramSnapshotCreateOptions<CANVAS, DATA> {\n\tsize?: number | null;\n\tcleanup?: boolean | DDiagramSnapshotCleanupOptions;\n\textractor: (canvas: CANVAS) => DATA;\n}\n\nexport interface DDiagramSnapshotOptions<CANVAS, EMITTER = any> {\n\ton?: DDiagramSnapshotOnOptions<CANVAS, EMITTER>;\n}\n\nexport class DDiagramSnapshot<\n\tCANVAS extends DDiagramSnapshotCanvas = DDiagramSnapshotCanvas\n> extends utils.EventEmitter {\n\tprotected _parent: DDiagramSnapshotParent<CANVAS>;\n\n\tconstructor(parent: DDiagramSnapshotParent<CANVAS>, options?: DDiagramSnapshotOptions<CANVAS>) {\n\t\tsuper();\n\t\tthis._parent = parent;\n\t\tconst on = options?.on;\n\t\tif (on) {\n\t\t\tfor (const name in on) {\n\t\t\t\tconst handler = on[name];\n\t\t\t\tif (handler) {\n\t\t\t\t\tthis.on(name, handler);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Creates a snapshot.\n\t *\n\t * @param size a maximum image size\n\t * @returns an URL of a created image or undefined\n\t */\n\tcreateAsUrl(size?: number | null): string | undefined;\n\n\t/**\n\t * Creates a snapshot.\n\t *\n\t * @param options options\n\t * @returns an URL of a created image or undefined\n\t */\n\tcreateAsUrl(options: DDiagramSnapshotCreateAsUrlOptions): string | undefined;\n\n\tcreateAsUrl(\n\t\tsizeOrOptions?: number | null | DDiagramSnapshotCreateAsUrlOptions\n\t): string | undefined {\n\t\tif (sizeOrOptions == null || isNumber(sizeOrOptions)) {\n\t\t\treturn this.create({\n\t\t\t\tsize: sizeOrOptions,\n\t\t\t\textractor: (canvas: CANVAS): string => {\n\t\t\t\t\treturn UtilExtract.base64({ target: canvas });\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\treturn this.create({\n\t\t\t\tsize: sizeOrOptions.size,\n\t\t\t\tcleanup: sizeOrOptions.cleanup,\n\t\t\t\textractor: (canvas: CANVAS): string => {\n\t\t\t\t\treturn UtilExtract.base64({ target: canvas });\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Creates and downloads a snapshot.\n\t *\n\t * @param filename a filename\n\t */\n\tcreateAsFile(filename: string): void;\n\n\t/**\n\t * Creates and downloads a snapshot.\n\t *\n\t * @param size a maximum image size\n\t * @param filename a filename\n\t */\n\tcreateAsFile(size: number | null, filename: string): void;\n\n\t/**\n\t * Creates and downloads a snapshot.\n\t *\n\t * @param options options\n\t */\n\tcreateAsFile(options: DDiagramSnapshotCreateAsFileOptions): void;\n\n\tcreateAsFile(\n\t\tsizeOrFilenameOrOptions: number | string | null | DDiagramSnapshotCreateAsFileOptions,\n\t\tfilename?: string\n\t): void {\n\t\tif (isString(sizeOrFilenameOrOptions)) {\n\t\t\tthis.create({\n\t\t\t\textractor: (canvas): void => {\n\t\t\t\t\tUtilExtract.file({ target: canvas, filename: sizeOrFilenameOrOptions });\n\t\t\t\t}\n\t\t\t});\n\t\t} else if (sizeOrFilenameOrOptions === null || isNumber(sizeOrFilenameOrOptions)) {\n\t\t\tthis.create({\n\t\t\t\tsize: sizeOrFilenameOrOptions,\n\t\t\t\textractor: (canvas): void => {\n\t\t\t\t\tUtilExtract.file({ target: canvas, filename: filename! });\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tthis.create({\n\t\t\t\tsize: sizeOrFilenameOrOptions.size,\n\t\t\t\tcleanup: sizeOrFilenameOrOptions.cleanup,\n\t\t\t\textractor: (canvas): void => {\n\t\t\t\t\tUtilExtract.file({\n\t\t\t\t\t\ttarget: canvas,\n\t\t\t\t\t\tfilename: sizeOrFilenameOrOptions.filename\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tprotected toScale(size: number | null | undefined, canvas: CANVAS): number {\n\t\tif (size == null) {\n\t\t\treturn 1;\n\t\t}\n\t\treturn size / DApplications.getResolution(canvas) / Math.max(canvas.width, canvas.height);\n\t}\n\n\tprotected toCleanupSnap(options?: DDiagramSnapshotCreateOptions<CANVAS, unknown>): boolean {\n\t\tif (options == null) {\n\t\t\treturn true;\n\t\t}\n\t\tconst cleanup = options.cleanup;\n\t\tif (cleanup == null || cleanup === true) {\n\t\t\treturn true;\n\t\t}\n\t\treturn cleanup !== false && cleanup.snap !== false;\n\t}\n\n\tprotected toCleanupBackground(\n\t\toptions?: DDiagramSnapshotCreateOptions<CANVAS, unknown>\n\t): boolean {\n\t\tif (options == null) {\n\t\t\treturn false;\n\t\t}\n\t\tconst cleanup = options.cleanup;\n\t\tif (cleanup == null || cleanup === false) {\n\t\t\treturn false;\n\t\t}\n\t\treturn cleanup === true || cleanup.background === true;\n\t}\n\n\tprotected toCleanupRefit(options?: DDiagramSnapshotCreateOptions<CANVAS, unknown>): boolean {\n\t\tif (options == null) {\n\t\t\treturn true;\n\t\t}\n\t\tconst cleanup = options.cleanup;\n\t\tif (cleanup == null || cleanup === true) {\n\t\t\treturn true;\n\t\t}\n\t\treturn cleanup !== false && cleanup.refit !== false;\n\t}\n\n\tprotected toCleanupReflow(options?: DDiagramSnapshotCreateOptions<CANVAS, unknown>): boolean {\n\t\tif (options == null) {\n\t\t\treturn true;\n\t\t}\n\t\tconst cleanup = options.cleanup;\n\t\tif (cleanup == null || cleanup === true) {\n\t\t\treturn true;\n\t\t}\n\t\treturn cleanup !== false && cleanup.reflow !== false;\n\t}\n\n\tcreate<DATA>(options: DDiagramSnapshotCreateOptions<CANVAS, DATA>): DATA | undefined {\n\t\tconst parent = this._parent;\n\t\tconst canvas = parent.canvas;\n\t\tif (canvas) {\n\t\t\tconst view = parent.view;\n\t\t\tconst viewPosition = view.position;\n\t\t\tconst viewScale = view.scale;\n\n\t\t\tconst oldPositionX = viewPosition.x;\n\t\t\tconst oldPositionY = viewPosition.y;\n\t\t\tconst oldScaleX = viewScale.x;\n\t\t\tconst oldScaleY = viewScale.y;\n\n\t\t\tconst newScale: number = this.toScale(options.size, canvas);\n\t\t\tview.transform(0, 0, newScale, newScale, 0);\n\n\t\t\t// Turns off the snap grid and targets\n\t\t\tlet container: EShapeContainer | undefined;\n\t\t\tif (this.toCleanupSnap(options) && \"snap\" in canvas) {\n\t\t\t\tconst snap = canvas.snap;\n\t\t\t\tif (snap != null) {\n\t\t\t\t\tcontainer = snap.container;\n\t\t\t\t\tif (container.renderable) {\n\t\t\t\t\t\tcontainer.renderable = false;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcontainer = undefined;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Turns off the canvas snippets\n\t\t\tlet snippet: DBaseSnippetContainer | undefined;\n\t\t\tif (this.toCleanupBackground(options)) {\n\t\t\t\tsnippet = canvas.snippet;\n\t\t\t\tif (snippet.renderable) {\n\t\t\t\t\tsnippet.renderable = false;\n\t\t\t\t} else {\n\t\t\t\t\tsnippet = undefined;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Refit & reflow\n\t\t\tconst refit = this.toCleanupRefit(options);\n\t\t\tconst reflow = this.toCleanupReflow(options);\n\t\t\tif (refit || reflow) {\n\t\t\t\tconst layer = DApplications.getLayer(canvas);\n\t\t\t\tif (layer) {\n\t\t\t\t\tif (refit) {\n\t\t\t\t\t\tlayer.refit();\n\t\t\t\t\t}\n\t\t\t\t\tif (reflow) {\n\t\t\t\t\t\tlayer.reflow();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Extracts\n\t\t\tthis.emit(\"taking\", canvas, this);\n\t\t\tconst result = options.extractor(canvas);\n\t\t\tthis.emit(\"took\", canvas, null, this);\n\n\t\t\t// Turn on the canvas snippets\n\t\t\tif (snippet) {\n\t\t\t\tsnippet.renderable = true;\n\t\t\t}\n\n\t\t\t// Turn on the snap grid and targets\n\t\t\tif (container != null) {\n\t\t\t\tcontainer.renderable = true;\n\t\t\t}\n\n\t\t\tview.transform(oldPositionX, oldPositionY, oldScaleX, oldScaleY, 0);\n\t\t\treturn result;\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DApplications } from \"./d-applications\";\nimport { DBaseShadow } from \"./d-base\";\nimport {\n\tDCanvasContainer,\n\tDCanvasContainerEvents,\n\tDCanvasContainerOptions,\n\tDThemeCanvasContainer\n} from \"./d-canvas-container\";\nimport {\n\tDDiagramCanvasBackgroundOptions,\n\tDDiagramCanvasBase,\n\tDDiagramCanvasBaseOptions\n} from \"./d-diagram-canvas-base\";\nimport { DDiagramCanvasTilePyramidFactory } from \"./d-diagram-canvas-tile\";\nimport { DDiagramLayer } from \"./d-diagram-layer\";\nimport { DDiagramSerialized, DDiagramSerializedSimple } from \"./d-diagram-serialized\";\nimport { DDiagramSnapshot, DDiagramSnapshotOptions } from \"./d-diagram-snapshot\";\nimport { DDiagrams } from \"./d-diagrams\";\nimport { DOnOptions } from \"./d-on-options\";\nimport { EShape } from \"./shape/e-shape\";\nimport { EShapeResourceManagerDeserialization } from \"./shape/e-shape-resource-manager-deserialization\";\nimport { EShapeEmbeddedDatum } from \"./shape/variant/e-shape-embedded-datum\";\n\n/**\n * {@link DDiagramBase} events.\n */\nexport interface DDiagramBaseEvents<CANVAS, EMITTER>\n\textends DCanvasContainerEvents<CANVAS, EMITTER> {\n\t/**\n\t * Triggered when all the shape initializations are finished.\n\t *\n\t * @param emitter an emitter\n\t */\n\tready(emitter: EMITTER): void;\n}\n\n/**\n * {@link DDiagram} piece controller.\n */\nexport interface DDiagramBasePieceController {\n\tgetByName(name: string): Promise<DDiagramSerializedSimple | DDiagramSerialized>;\n}\n\n/**\n * {@link DDiagram} controller.\n */\nexport interface DDiagramBaseController {\n\tpiece: DDiagramBasePieceController;\n\tgetByName(name: string): Promise<DDiagramSerializedSimple | DDiagramSerialized>;\n}\n\n/**\n * {@link DDiagramBase} \"on\" options.\n */\nexport interface DDiagramBaseOnOptions<CANVAS, EMITTER>\n\textends Partial<DDiagramBaseEvents<CANVAS, EMITTER>>,\n\t\tDOnOptions {}\n\n/**\n * {@link DDiagramBase} options.\n */\nexport interface DDiagramBaseOptions<\n\tCANVAS extends DDiagramCanvasBase = DDiagramCanvasBase,\n\tCANVAS_OPTIONS extends DDiagramCanvasBaseOptions = DDiagramCanvasBaseOptions,\n\tCONTROLLER extends DDiagramBaseController = DDiagramBaseController,\n\tTHEME extends DThemeDiagramBase = DThemeDiagramBase,\n\tEMITTER = any\n> extends DCanvasContainerOptions<CANVAS, CANVAS_OPTIONS, THEME> {\n\tcontroller?: CONTROLLER;\n\n\t/**\n\t * A tile pyramid factory.\n\t */\n\ttile?: DDiagramCanvasTilePyramidFactory;\n\n\tambient?: boolean;\n\n\t/**\n\t * Snapshot options.\n\t */\n\tsnapshot?: DDiagramSnapshotOptions<CANVAS>;\n\n\ton?: DDiagramBaseOnOptions<CANVAS, EMITTER>;\n}\n\n/**\n * {@link DDiagramBase} theme.\n */\nexport interface DThemeDiagramBase extends DThemeCanvasContainer {\n\tgetCanvasBackgroundColor(): number;\n\tgetCanvasBackgroundAlpha(): number;\n\tgetCanvasShadow(): DBaseShadow | null;\n\tisAmbient(): boolean;\n}\n\nexport abstract class DDiagramBase<\n\tCANVAS extends DDiagramCanvasBase = DDiagramCanvasBase,\n\tCANVAS_OPTIONS extends DDiagramCanvasBaseOptions = DDiagramCanvasBaseOptions,\n\tCONTROLLER extends DDiagramBaseController = DDiagramBaseController,\n\tTHEME extends DThemeDiagramBase = DThemeDiagramBase,\n\tOPTIONS extends DDiagramBaseOptions<\n\t\tCANVAS,\n\t\tCANVAS_OPTIONS,\n\t\tCONTROLLER,\n\t\tTHEME\n\t> = DDiagramBaseOptions<CANVAS, CANVAS_OPTIONS, CONTROLLER, THEME>\n> extends DCanvasContainer<CANVAS, CANVAS_OPTIONS, THEME, OPTIONS> {\n\tprotected _serialized: DDiagramSerialized | null;\n\tprotected _tileFactory?: DDiagramCanvasTilePyramidFactory;\n\tprotected _controller?: CONTROLLER;\n\tprotected _isAmbient: boolean;\n\tprotected _snapshot: DDiagramSnapshot;\n\n\tconstructor(options?: OPTIONS) {\n\t\tsuper(options);\n\t\tthis._serialized = null;\n\t\tthis._tileFactory = options?.tile;\n\t\tthis._controller = options?.controller;\n\t\tthis._isAmbient = options?.ambient ?? this.theme.isAmbient();\n\t\tthis._snapshot = new DDiagramSnapshot(this, options?.snapshot);\n\t}\n\n\tget snapshot(): DDiagramSnapshot {\n\t\treturn this._snapshot;\n\t}\n\n\tget controller(): CONTROLLER | null {\n\t\treturn this._controller || null;\n\t}\n\n\tset(serialized: DDiagramSerialized | null): void {\n\t\tconst oldSerialized = this._serialized;\n\t\tif (oldSerialized !== serialized) {\n\t\t\tif (oldSerialized) {\n\t\t\t\tthis._serialized = null;\n\t\t\t\tthis.onUnset();\n\t\t\t}\n\n\t\t\tthis._serialized = serialized;\n\t\t\tif (serialized) {\n\t\t\t\tthis.onSet(serialized);\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected onSet(serialized: DDiagramSerialized): void {\n\t\tconst canvas = this.newCanvas(serialized);\n\t\tconst pieces = serialized.pieces;\n\t\tconst isEditMode = this.isEditMode();\n\t\tDDiagrams.toPieceData(this._controller, pieces, isEditMode).then((pieceData): void => {\n\t\t\tthis.newLayer(serialized, canvas, isEditMode, pieces, pieceData);\n\t\t});\n\t\tthis.canvas = canvas;\n\t}\n\n\tprotected abstract isEditMode(): boolean;\n\n\tprotected newLayer(\n\t\tserialized: DDiagramSerialized,\n\t\tcanvas: CANVAS,\n\t\tisEditMode: boolean,\n\t\tpieces?: string[],\n\t\tpieceData?: Map<string, EShapeEmbeddedDatum | null>\n\t): void {\n\t\tconst layer = canvas.layer;\n\t\tconst manager = new EShapeResourceManagerDeserialization(\n\t\t\tserialized,\n\t\t\tpieces,\n\t\t\tpieceData,\n\t\t\tisEditMode\n\t\t);\n\t\tDDiagrams.newLayer(serialized, layer, manager).then((shapes: EShape[]): void => {\n\t\t\tlayer.init();\n\t\t\tthis.initialize(shapes);\n\t\t\tcanvas.initialize(shapes);\n\t\t\tDApplications.update(this);\n\t\t\tthis.emit(\"ready\", this);\n\t\t});\n\t\tif (this._isAmbient) {\n\t\t\tconst background = this.toCanvasBaseBackgroundOptions(serialized, this.theme, false);\n\t\t\tthis.background.color = background.color;\n\t\t\tthis.background.alpha = background.alpha;\n\t\t}\n\t}\n\n\tprotected toCanvasBaseOptions(serialized: DDiagramSerialized): DDiagramCanvasBaseOptions<any> {\n\t\tconst theme = this.theme;\n\t\tconst isAmbient = this._isAmbient;\n\t\treturn {\n\t\t\tname: serialized.name,\n\t\t\twidth: serialized.width,\n\t\t\theight: serialized.height,\n\t\t\tbackground: this.toCanvasBaseBackgroundOptions(serialized, theme, isAmbient),\n\t\t\tborder: isAmbient ? { color: null } : undefined,\n\t\t\toutline: isAmbient ? { color: null } : undefined,\n\t\t\tshadow: isAmbient ? null : theme.getCanvasShadow(),\n\t\t\ttile: {\n\t\t\t\tfactory: this._tileFactory,\n\t\t\t\tmapping: serialized.tile?.mapping\n\t\t\t},\n\t\t\tambient: isAmbient\n\t\t};\n\t}\n\n\tprotected toCanvasBaseBackgroundOptions(\n\t\tserialized: DDiagramSerialized,\n\t\ttheme: THEME,\n\t\tisAmbient: boolean\n\t): DDiagramCanvasBackgroundOptions {\n\t\tif (isAmbient) {\n\t\t\treturn {\n\t\t\t\tcolor: null\n\t\t\t};\n\t\t}\n\t\tconst background = serialized.background;\n\t\treturn {\n\t\t\tcolor: background?.color ?? theme.getCanvasBackgroundColor(),\n\t\t\talpha: background?.alpha ?? theme.getCanvasBackgroundAlpha()\n\t\t};\n\t}\n\n\topenByName(name: string): void {\n\t\tconst controller = this._controller;\n\t\tif (controller) {\n\t\t\tcontroller.getByName(name).then((found): void => {\n\t\t\t\tthis.set(DDiagrams.toSerialized(found));\n\t\t\t});\n\t\t}\n\t}\n\n\tprotected initialize(shapes: EShape[]): void {\n\t\t// DO NOTHING\n\t}\n\n\tprotected abstract newCanvas(serialized: DDiagramSerialized): CANVAS;\n\n\tprotected onUnset(): void {\n\t\tconst canvas = this.canvas;\n\t\tif (canvas) {\n\t\t\tthis.canvas = null;\n\t\t}\n\t}\n\n\tget(): DDiagramSerialized | null {\n\t\treturn this._serialized;\n\t}\n\n\tget layer(): DDiagramLayer | null {\n\t\tconst canvas = this.canvas;\n\t\tif (canvas) {\n\t\t\treturn canvas.layer.active;\n\t\t}\n\t\treturn null;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DDiagramBase\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBackgroundStateAware } from \"./d-background\";\nimport { DThemeBase } from \"./d-base\";\nimport { DBaseStateSet } from \"./d-base-state-set\";\nimport { DStateAwareOrValueMightBe } from \"./d-state-aware\";\nimport { UtilRgb } from \"./util/util-rgb\";\n\nexport class DDiagramCanvasEditorBackground implements DBackgroundStateAware {\n\tprotected _target: DBackgroundStateAware;\n\tprotected _base: number | null;\n\n\tconstructor(target: DBackgroundStateAware, base: number | null) {\n\t\tthis._target = target;\n\t\tthis._base = base;\n\t}\n\n\tgetTheme(): DThemeBase {\n\t\treturn this._target.getTheme();\n\t}\n\n\tsetTheme(theme: DThemeBase): void {\n\t\tthis._target.setTheme(theme);\n\t}\n\n\tgetBaseColor(): number | null {\n\t\treturn this._base;\n\t}\n\n\tsetBaseColor(baseColor: number | null): void {\n\t\tthis._base = baseColor;\n\t}\n\n\tgetColor(state: DBaseStateSet): number | null {\n\t\tconst target = this._target;\n\t\tconst base = this._base;\n\t\tconst color = target.getColor(state);\n\t\tif (base != null) {\n\t\t\tif (color != null) {\n\t\t\t\treturn UtilRgb.blend(base, color, target.getAlpha(state));\n\t\t\t}\n\t\t\treturn base;\n\t\t}\n\t\treturn color;\n\t}\n\n\tget color(): DStateAwareOrValueMightBe<number | null> {\n\t\treturn this._target.color;\n\t}\n\n\tset color(color: DStateAwareOrValueMightBe<number | null>) {\n\t\tthis._target.color = color;\n\t}\n\n\tgetAlpha(state: DBaseStateSet): number {\n\t\tconst base = this._base;\n\t\tif (base != null) {\n\t\t\treturn 1;\n\t\t}\n\t\treturn this._target.getAlpha(state);\n\t}\n\n\tget alpha(): DStateAwareOrValueMightBe<number> {\n\t\treturn this._target.alpha;\n\t}\n\n\tset alpha(alpha: DStateAwareOrValueMightBe<number>) {\n\t\tthis._target.alpha = alpha;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { ObservablePoint } from \"pixi.js\";\nimport { DMapTileMappingPoint } from \"./d-map-tile-mapping\";\n\nexport class DDiagramCanvasTileMappingPointImpl\n\textends ObservablePoint\n\timplements DMapTileMappingPoint\n{\n\tget lon(): number {\n\t\treturn this.x;\n\t}\n\n\tset lon(lon: number) {\n\t\tthis.x = lon;\n\t}\n\n\tget lat(): number {\n\t\treturn this.y;\n\t}\n\n\tset lat(lat: number) {\n\t\tthis.y = lat;\n\t}\n\n\ttoObject(): { lon: number; lat: number } {\n\t\treturn {\n\t\t\tlon: this.x,\n\t\t\tlat: this.y\n\t\t};\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDiagramCanvasTileMapping } from \"./d-diagram-canvas-mapping\";\nimport { DDiagramCanvasTileMappingPointImpl } from \"./d-diagram-canvas-mapping-point-impl\";\nimport { DMapTileMappingPoint } from \"./d-map-tile-mapping\";\n\nexport class DDiagramCanvasTileMappingImpl implements DDiagramCanvasTileMapping {\n\tprotected _enable: boolean;\n\tprotected _from: DDiagramCanvasTileMappingPointImpl;\n\tprotected _to: DDiagramCanvasTileMappingPointImpl;\n\tprotected _cb: () => void;\n\n\tconstructor(cb: () => void, mapping?: DDiagramCanvasTileMapping);\n\tconstructor(\n\t\tcb: () => void,\n\t\tenable: boolean,\n\t\tlon0: number,\n\t\tlat0: number,\n\t\tlon1: number,\n\t\tlat1: number\n\t);\n\tconstructor(\n\t\tcb: () => void,\n\t\tmappingOrEnable?: DDiagramCanvasTileMapping | boolean,\n\t\tlon0?: number,\n\t\tlat0?: number,\n\t\tlon1?: number,\n\t\tlat1?: number\n\t) {\n\t\tthis._cb = cb;\n\t\tif (mappingOrEnable === true || mappingOrEnable === false) {\n\t\t\tthis._enable = mappingOrEnable;\n\t\t\tthis._from = new DDiagramCanvasTileMappingPointImpl(cb, null, lon0, lat0);\n\t\t\tthis._to = new DDiagramCanvasTileMappingPointImpl(cb, null, lon1, lat1);\n\t\t} else if (mappingOrEnable != null) {\n\t\t\tthis._enable = mappingOrEnable.enable;\n\t\t\tconst from = mappingOrEnable.from;\n\t\t\tconst to = mappingOrEnable.to;\n\t\t\tthis._from = new DDiagramCanvasTileMappingPointImpl(cb, null, from.lon, from.lat);\n\t\t\tthis._to = new DDiagramCanvasTileMappingPointImpl(cb, null, to.lon, to.lat);\n\t\t} else {\n\t\t\tthis._enable = false;\n\t\t\tthis._from = new DDiagramCanvasTileMappingPointImpl(cb, null, -180, +85.05112877980659);\n\t\t\tthis._to = new DDiagramCanvasTileMappingPointImpl(cb, null, +180, -85.05112877980659);\n\t\t}\n\t}\n\n\tget enable(): boolean {\n\t\treturn this._enable;\n\t}\n\n\tset enable(enable: boolean) {\n\t\tif (this._enable !== enable) {\n\t\t\tthis._enable = enable;\n\t\t\tthis._cb();\n\t\t}\n\t}\n\n\tget from(): DMapTileMappingPoint {\n\t\treturn this._from;\n\t}\n\n\tget to(): DMapTileMappingPoint {\n\t\treturn this._to;\n\t}\n\n\tserialize(): DDiagramCanvasTileMapping {\n\t\treturn {\n\t\t\tenable: this._enable,\n\t\t\tfrom: this._from.toObject(),\n\t\t\tto: this._to.toObject()\n\t\t};\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDiagramCanvasBase } from \"./d-diagram-canvas-base\";\nimport { DDiagramCanvasTileMapping } from \"./d-diagram-canvas-mapping\";\nimport { DDiagramCanvasTileMappingImpl } from \"./d-diagram-canvas-mapping-impl\";\nimport { DMapTilePyramid } from \"./d-map-tile-pyramid\";\n\n/**\n * A tile pyramid factory.\n */\nexport type DDiagramCanvasTilePyramidFactory = (\n\tcanvas: DDiagramCanvasBase<any, any>\n) => DMapTilePyramid;\n\nexport interface DDiagramCanvasTileOptions {\n\tfactory?: DDiagramCanvasTilePyramidFactory;\n\tmapping?: DDiagramCanvasTileMapping;\n}\n\nexport class DDiagramCanvasTile {\n\tprotected _canvas: DDiagramCanvasBase;\n\tprotected _pyramid?: DMapTilePyramid;\n\tprotected _factory?: DDiagramCanvasTilePyramidFactory;\n\tprotected _mapping: DDiagramCanvasTileMappingImpl;\n\n\tconstructor(canvas: DDiagramCanvasBase, options?: DDiagramCanvasTileOptions) {\n\t\tthis._canvas = canvas;\n\t\tthis._factory = options?.factory;\n\t\tthis._mapping = new DDiagramCanvasTileMappingImpl((): void => {\n\t\t\tthis.onMappingChange();\n\t\t}, options?.mapping);\n\t}\n\n\tinit(): void {\n\t\tthis.onMappingChange();\n\t}\n\n\tprotected onMappingChange(): void {\n\t\tconst factory = this._factory;\n\t\tif (factory) {\n\t\t\tconst mapping = this._mapping;\n\t\t\tif (mapping.enable) {\n\t\t\t\tconst pyramid = this._pyramid;\n\t\t\t\tif (pyramid) {\n\t\t\t\t\tpyramid.mapping = mapping;\n\t\t\t\t} else {\n\t\t\t\t\tthis._pyramid = factory(this._canvas).fit();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst pyramid = this._pyramid;\n\t\t\t\tif (pyramid) {\n\t\t\t\t\tthis._pyramid = undefined;\n\t\t\t\t\tpyramid.destroy();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tget pyramid(): DMapTilePyramid | undefined {\n\t\treturn this._pyramid;\n\t}\n\n\tget factory(): DDiagramCanvasTilePyramidFactory | undefined {\n\t\treturn this._factory;\n\t}\n\n\tget mapping(): DDiagramCanvasTileMapping {\n\t\treturn this._mapping;\n\t}\n\n\tserialize(): { mapping: DDiagramCanvasTileMapping } {\n\t\treturn {\n\t\t\tmapping: this._mapping.serialize()\n\t\t};\n\t}\n\n\tdestroy(): void {\n\t\tconst pyramid = this._pyramid;\n\t\tif (pyramid != null) {\n\t\t\tthis._pyramid = undefined;\n\t\t\tpyramid.destroy();\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { IPoint } from \"pixi.js\";\nimport { DBaseStateSet } from \"./d-base-state-set\";\nimport { DDiagramCanvasIdMap } from \"./d-diagram-canvas-id-map\";\nimport { DDiagramCanvasDataMap } from \"./d-diagram-canvas-data-map\";\nimport { DDiagramLayerBackground } from \"./d-diagram-layer-background\";\nimport { DDiagramSerializedItem, DDiagramSerializedLayer } from \"./d-diagram-serialized\";\nimport { EShapeActionValueMiscGestureType } from \"./shape/action/e-shape-action-value-misc-gesture-type\";\nimport { EShapeActionValueMiscLayerGesture } from \"./shape/action/e-shape-action-value-misc-layer-gesture\";\nimport { EShape } from \"./shape/e-shape\";\nimport { EShapeContainer } from \"./shape/e-shape-container\";\nimport { EShapeLayerState } from \"./shape/e-shape-layer-state\";\nimport { EShapeResourceManagerDeserialization } from \"./shape/e-shape-resource-manager-deserialization\";\nimport { EShapeResourceManagerSerialization } from \"./shape/e-shape-resource-manager-serialization\";\nimport { EShapeRuntime } from \"./shape/e-shape-runtime\";\nimport { EShapeRectanglePivoted } from \"./shape/variant/e-shape-rectangle-pivoted\";\nimport { isString } from \"./util/is-string\";\nimport { UtilKeyboardEvent } from \"./util/util-keyboard-event\";\n\nexport class DDiagramLayer extends EShapeContainer {\n\treference: number;\n\tinteractives: EShape[];\n\tprotected declare _shape: EShape;\n\n\tconstructor(name: string) {\n\t\tsuper();\n\t\tthis.name = name;\n\t\tthis.interactive = false;\n\t\tthis.reference = 0;\n\t\tconst shape = this.newShape();\n\t\tshape.parent = this;\n\t\tthis._shape = shape;\n\t\tthis.interactives = [];\n\t}\n\n\tget width(): number {\n\t\treturn this._shape.size.x;\n\t}\n\n\tset width(width: number) {\n\t\tthis._shape.size.x = width;\n\t}\n\n\tget height(): number {\n\t\treturn this._shape.size.y;\n\t}\n\n\tset height(height: number) {\n\t\tthis._shape.size.y = height;\n\t}\n\n\tget background(): DDiagramLayerBackground {\n\t\treturn this._shape.fill;\n\t}\n\n\tget state(): DBaseStateSet {\n\t\treturn this._shape.state;\n\t}\n\n\tprotected newShape(): EShape {\n\t\tconst result = new EShapeRectanglePivoted();\n\t\tresult.fill.set(false, 0xffffff, 1);\n\t\tresult.stroke.set(false);\n\t\tresult.state.add(EShapeLayerState.INTERACTIVE);\n\t\treturn result;\n\t}\n\n\tinitialize(data: DDiagramCanvasDataMap, ids: DDiagramCanvasIdMap, actionables: EShape[]): void {\n\t\tconst interactives = this.interactives;\n\t\tconst shape = this._shape;\n\t\tconst isInteractive = shape.state.is(EShapeLayerState.INTERACTIVE);\n\t\tconst isDraggable = shape.state.is(EShapeLayerState.DRAGGABLE);\n\t\tconst isPinchable = shape.state.is(EShapeLayerState.PINCHABLE);\n\t\tif (isDraggable || isPinchable) {\n\t\t\tconst runtime = new EShapeRuntime(shape);\n\t\t\tshape.runtime = runtime;\n\t\t\tconst gestureType =\n\t\t\t\t(isDraggable\n\t\t\t\t\t? EShapeActionValueMiscGestureType.DRAG\n\t\t\t\t\t: EShapeActionValueMiscGestureType.NONE) |\n\t\t\t\t(isPinchable\n\t\t\t\t\t? EShapeActionValueMiscGestureType.PINCH\n\t\t\t\t\t: EShapeActionValueMiscGestureType.NONE);\n\t\t\truntime.actions.push(\n\t\t\t\tnew EShapeActionValueMiscLayerGesture(\"\", gestureType).toRuntime()\n\t\t\t);\n\t\t\tactionables.push(shape);\n\t\t\truntime.initialize(shape);\n\t\t}\n\t\tif (isInteractive || isDraggable || isPinchable) {\n\t\t\tshape.interactive = true;\n\t\t\tinteractives.push(shape);\n\t\t}\n\t\tthis.doInitialize(this.children, data, interactives, actionables, ids);\n\t}\n\n\tprotected doInitialize(\n\t\tshapes: EShape[],\n\t\tdata: DDiagramCanvasDataMap,\n\t\tinteractives: EShape[],\n\t\tactionables: EShape[],\n\t\tids: DDiagramCanvasIdMap\n\t): void {\n\t\tfor (let i = 0, imax = shapes.length; i < imax; ++i) {\n\t\t\tconst shape = shapes[i];\n\n\t\t\t// Data mappings\n\t\t\tconst shapeData = shape.data;\n\t\t\tfor (let j = 0, jmax = shapeData.size(); j < jmax; ++j) {\n\t\t\t\tconst shapeDatum = shapeData.get(j);\n\t\t\t\tif (shapeDatum) {\n\t\t\t\t\tconst shapeDatumId = shapeDatum.id;\n\t\t\t\t\tif (0 < shapeDatumId.length) {\n\t\t\t\t\t\tlet shapeDatumList = data[shapeDatumId];\n\t\t\t\t\t\tif (shapeDatumList == null) {\n\t\t\t\t\t\t\tshapeDatumList = [];\n\t\t\t\t\t\t\tdata[shapeDatumId] = shapeDatumList;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tshapeDatumList.push(shapeDatum);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Id mappings\n\t\t\tconst shapeId = shape.id;\n\t\t\tif (0 < shapeId.length) {\n\t\t\t\tconst mapping: EShape[] | undefined = ids[shapeId];\n\t\t\t\tif (mapping == null) {\n\t\t\t\t\tids[shapeId] = [shape];\n\t\t\t\t} else {\n\t\t\t\t\tmapping.push(shape);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst runtime = shape.runtime;\n\t\t\tif (runtime) {\n\t\t\t\t// Interactives\n\t\t\t\tif (shape.interactive || 0 < shape.cursor.length || runtime.interactive) {\n\t\t\t\t\tinteractives.push(shape);\n\t\t\t\t}\n\n\t\t\t\t// Actionables\n\t\t\t\tif (runtime.isActionable()) {\n\t\t\t\t\tactionables.push(shape);\n\t\t\t\t}\n\n\t\t\t\t// Shortcuts\n\t\t\t\tconst shortcut = shape.shortcut;\n\t\t\t\tif (shortcut != null) {\n\t\t\t\t\tUtilKeyboardEvent.on(shape, shortcut, (e: KeyboardEvent): void => {\n\t\t\t\t\t\truntime.onClick(shape, e);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t// Runtime\n\t\t\t\truntime.initialize(shape);\n\t\t\t}\n\n\t\t\t// Children\n\t\t\tconst children = shape.children;\n\t\t\tif (0 < children.length) {\n\t\t\t\tthis.doInitialize(children, data, interactives, actionables, ids);\n\t\t\t}\n\t\t}\n\t}\n\n\thitTestInteractives(global: IPoint): EShape | null {\n\t\tconst local = this._work;\n\t\tconst interactives = this.interactives;\n\t\tfor (let i = interactives.length - 1; 0 <= i; --i) {\n\t\t\tconst interactive = interactives[i];\n\t\t\tif (interactive.visible) {\n\t\t\t\tinteractive.toLocal(global, undefined, local);\n\t\t\t\tif (interactive.contains(local.x, local.y) != null) {\n\t\t\t\t\treturn interactive;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\taddUuid(manager: EShapeResourceManagerSerialization): void {\n\t\tconst children = this.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].addUuid(manager);\n\t\t}\n\t}\n\n\tupdateUuid(manager: EShapeResourceManagerSerialization): void {\n\t\tconst children = this.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].updateUuid(manager);\n\t\t}\n\t}\n\n\tdestroy(): void {\n\t\tif (!this._destroyed) {\n\t\t\tconst children = this.children;\n\t\t\tfor (let i = children.length - 1; 0 <= i; --i) {\n\t\t\t\tchildren[i].destroy();\n\t\t\t}\n\t\t\tchildren.length = 0;\n\t\t\tsuper.destroy();\n\t\t}\n\t}\n\n\tserialize(\n\t\tlayer: number,\n\t\tmanager: EShapeResourceManagerSerialization,\n\t\titems: DDiagramSerializedItem[]\n\t): DDiagramSerializedLayer {\n\t\tconst children = this.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tconst shape = children[i];\n\t\t\tconst item = shape.serialize(manager);\n\t\t\titem[16] = layer;\n\t\t\titems.push(item);\n\t\t}\n\n\t\tconst shape = this._shape;\n\t\tconst nameId = manager.addResource(this.name || \"\");\n\t\tconst visible =\n\t\t\t(this.visible ? 1 : 0) | (shape.state.is(EShapeLayerState.INVISIBLE) ? 0 : 2);\n\t\tconst position = this.position;\n\t\tconst size = shape.size;\n\t\tconst fill = shape.fill.serialize(manager);\n\t\tconst isInteractive = shape.state.is(EShapeLayerState.INTERACTIVE) ? 1 : 0;\n\t\tconst isDraggable = shape.state.is(EShapeLayerState.DRAGGABLE) ? 2 : 0;\n\t\tconst isPinchable = shape.state.is(EShapeLayerState.PINCHABLE) ? 4 : 0;\n\t\treturn [\n\t\t\tnameId,\n\t\t\tvisible,\n\t\t\tposition.x,\n\t\t\tposition.y,\n\t\t\tsize.x,\n\t\t\tsize.y,\n\t\t\tfill,\n\t\t\tisInteractive | isDraggable | isPinchable\n\t\t];\n\t}\n\n\tstatic deserialize(\n\t\tserialized: DDiagramSerializedLayer,\n\t\tmanager: EShapeResourceManagerDeserialization,\n\t\twidth: number,\n\t\theight: number\n\t): DDiagramLayer {\n\t\tconst result = new DDiagramLayer(this.deserializeName(serialized[0], manager));\n\t\tconst shape = result._shape;\n\n\t\tconst visibility = serialized[1];\n\t\tif (visibility != null) {\n\t\t\tif (manager.isEditMode && !(visibility & 0x1)) {\n\t\t\t\tresult.visible = false;\n\t\t\t}\n\t\t\tif (!(visibility & 0x2)) {\n\t\t\t\tshape.state.add(EShapeLayerState.INVISIBLE);\n\t\t\t\tif (!manager.isEditMode) {\n\t\t\t\t\tresult.visible = false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst positionX = serialized[2];\n\t\tconst positionY = serialized[3];\n\t\tresult.position.set(positionX, positionY);\n\n\t\tconst sizeX = serialized[4] ?? width;\n\t\tconst sizeY = serialized[5] ?? height;\n\t\tshape.size.set(sizeX, sizeY);\n\n\t\tconst fillId = serialized[6];\n\t\tif (fillId != null) {\n\t\t\tshape.fill.deserialize(fillId, manager);\n\t\t}\n\n\t\tconst state = serialized[7] ?? 1;\n\t\tshape.state.set(EShapeLayerState.INTERACTIVE, !!(state & 0x1));\n\t\tshape.state.set(EShapeLayerState.DRAGGABLE, !!(state & 0x2));\n\t\tshape.state.set(EShapeLayerState.PINCHABLE, !!(state & 0x4));\n\t\treturn result;\n\t}\n\n\tstatic deserializeName(\n\t\ttarget: string | number,\n\t\tmanager: EShapeResourceManagerDeserialization\n\t): string {\n\t\tif (isString(target)) {\n\t\t\treturn target;\n\t\t} else {\n\t\t\tconst resources = manager.resources;\n\t\t\tif (0 <= target && target <= resources.length) {\n\t\t\t\treturn resources[target];\n\t\t\t}\n\t\t\treturn \"\";\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Container } from \"pixi.js\";\nimport { DApplications } from \"./d-applications\";\nimport { DDiagramLayer } from \"./d-diagram-layer\";\nimport { DDiagramSerializedItem, DDiagramSerializedLayer } from \"./d-diagram-serialized\";\nimport { EShapeResourceManagerDeserialization } from \"./shape\";\nimport { EShapeResourceManagerSerialization } from \"./shape/e-shape-resource-manager-serialization\";\n\nexport class DDiagramLayerContainer extends Container {\n\tdeclare children: DDiagramLayer[];\n\tprotected _active: DDiagramLayer | null;\n\tprotected _width: number;\n\tprotected _height: number;\n\n\tconstructor(width: number, height: number) {\n\t\tsuper();\n\t\tthis._active = null;\n\t\tthis._width = width;\n\t\tthis._height = height;\n\t\tthis.interactive = false;\n\t\tthis.interactiveChildren = false;\n\t}\n\n\tinit(): void {\n\t\tif (this._active == null) {\n\t\t\tconst children = this.children;\n\t\t\tconst childrenLength = children.length;\n\t\t\tif (0 < childrenLength) {\n\t\t\t\tthis._active = children[childrenLength - 1];\n\t\t\t}\n\t\t}\n\t}\n\n\tget active(): DDiagramLayer | null {\n\t\treturn this._active;\n\t}\n\n\tset active(layer: DDiagramLayer | null) {\n\t\tif (this._active !== layer && (layer == null || 0 <= this.children.indexOf(layer))) {\n\t\t\tthis._active = layer;\n\t\t\tthis.onLayerChange();\n\t\t}\n\t}\n\n\tcreate(name: string, activate?: boolean): DDiagramLayer {\n\t\tconst result = new DDiagramLayer(name);\n\t\tthis.attach(result, activate);\n\t\treturn result;\n\t}\n\n\t/**\n\t * Adds the specified layer and activates it if the `activate` is true.\n\t *\n\t * @param layer\n\t * @param activate\n\t */\n\tattach(layer: DDiagramLayer, activate?: boolean): void {\n\t\tthis.addChild(layer);\n\t\tif (activate === true) {\n\t\t\tthis._active = layer;\n\t\t}\n\t\tthis.onLayerChange();\n\t\tDApplications.update(this);\n\t}\n\n\tattachAt(layer: DDiagramLayer, index: number, activate?: boolean): void {\n\t\tthis.addChildAt(layer, index);\n\t\tif (activate === true) {\n\t\t\tthis._active = layer;\n\t\t}\n\t\tthis.onLayerChange();\n\t\tDApplications.update(this);\n\t}\n\n\t/**\n\t * Removes the specified layer from this container and activates the specified layer.\n\t * This method does not destroy the secified layer.\n\t *\n\t * @param layer\n\t */\n\tdetach(layer: DDiagramLayer, active: DDiagramLayer | null): void {\n\t\tconst children = this.children;\n\t\tconst index = children.indexOf(layer);\n\t\tif (0 <= index) {\n\t\t\tthis._active = active;\n\n\t\t\tchildren.splice(index, 1);\n\t\t\t(layer as any).parent = undefined;\n\n\t\t\tthis.onLayerChange();\n\t\t\tDApplications.update(this);\n\t\t}\n\t}\n\n\t/**\n\t * Removes the specified layer and activate the next layer.\n\t * This method does not destroy the specified layer.\n\t *\n\t * @param layer\n\t * @param activateNext\n\t */\n\tdelete(layer: DDiagramLayer, activateNext?: boolean): number {\n\t\tconst children = this.children;\n\t\tconst index = children.indexOf(layer);\n\t\tif (0 <= index) {\n\t\t\tchildren.splice(index, 1);\n\t\t\t(layer as any).parent = undefined;\n\n\t\t\tif (this._active === layer) {\n\t\t\t\tif (activateNext === true) {\n\t\t\t\t\tif (index < children.length) {\n\t\t\t\t\t\tthis._active = children[index];\n\t\t\t\t\t} else if (0 < children.length) {\n\t\t\t\t\t\tthis._active = children[index - 1];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis._active = null;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis._active = null;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.onLayerChange();\n\t\t\tDApplications.update(this);\n\t\t}\n\t\treturn index;\n\t}\n\n\tget(index: number): DDiagramLayer | null {\n\t\tconst child = this.children[index];\n\t\tif (child != null) {\n\t\t\treturn child;\n\t\t}\n\t\treturn null;\n\t}\n\n\tclear(): void {\n\t\tconst children = this.children;\n\t\tif (0 < children.length) {\n\t\t\tfor (let i = children.length - 1; 0 <= i; --i) {\n\t\t\t\tconst child = children[i];\n\t\t\t\t(child as any).parent = null;\n\t\t\t\tchild.destroy();\n\t\t\t}\n\t\t\tchildren.length = 0;\n\t\t\tthis.onLayerChange();\n\t\t\tDApplications.update(this);\n\t\t}\n\t}\n\n\tdestroy(): void {\n\t\tif (!this._destroyed) {\n\t\t\tthis.clear();\n\t\t\tsuper.destroy();\n\t\t}\n\t}\n\n\tsize(): number {\n\t\treturn this.children.length;\n\t}\n\n\tprotected onLayerChange(): void {\n\t\tthis.emit(\"change\", this);\n\t}\n\n\tserialize(\n\t\tmanager: EShapeResourceManagerSerialization,\n\t\titems: DDiagramSerializedItem[]\n\t): DDiagramSerializedLayer[] {\n\t\tconst result: DDiagramSerializedLayer[] = [];\n\t\tconst children = this.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].addUuid(manager);\n\t\t}\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tchildren[i].updateUuid(manager);\n\t\t}\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tresult.push(children[i].serialize(i, manager, items));\n\t\t}\n\t\treturn result;\n\t}\n\n\tdeserialize(\n\t\tserializedLayers: DDiagramSerializedLayer[],\n\t\tmanager: EShapeResourceManagerDeserialization\n\t): void {\n\t\tconst serializedLayersLength = serializedLayers.length;\n\t\tif (0 < serializedLayersLength) {\n\t\t\tconst width = this._width;\n\t\t\tconst height = this._height;\n\t\t\tfor (let i = 0; i < serializedLayersLength; ++i) {\n\t\t\t\tthis.addChild(\n\t\t\t\t\tDDiagramLayer.deserialize(serializedLayers[i], manager, width, height)\n\t\t\t\t);\n\t\t\t}\n\t\t\tthis.onLayerChange();\n\t\t\tDApplications.update(this);\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { IPoint } from \"pixi.js\";\nimport { DBaseBackgroundOptions } from \"./d-base\";\nimport { DCanvas, DCanvasOptions, DThemeCanvas } from \"./d-canvas\";\nimport { DDiagramCanvasEditorBackground } from \"./d-diagram-canvas-editor-background\";\nimport { DDiagramCanvasTile, DDiagramCanvasTileOptions } from \"./d-diagram-canvas-tile\";\nimport { DDiagramLayerContainer } from \"./d-diagram-layer-container\";\nimport { EShape } from \"./shape/e-shape\";\n\nexport interface DDiagramCanvasBackgroundOptions extends DBaseBackgroundOptions {\n\tbase?: number | null;\n}\n\nexport interface DDiagramCanvasBaseOptions<\n\tTHEME extends DThemeDiagramCanvasBase = DThemeDiagramCanvasBase\n> extends DCanvasOptions<THEME> {\n\ttile?: DDiagramCanvasTileOptions;\n\tbackground?: DDiagramCanvasBackgroundOptions;\n\tambient?: boolean;\n}\n\nexport interface DThemeDiagramCanvasBase extends DThemeCanvas {\n\tisAmbient(): boolean;\n\tgetBackgroundBase(): number | null;\n}\n\nexport class DDiagramCanvasBase<\n\tTHEME extends DThemeDiagramCanvasBase = DThemeDiagramCanvasBase,\n\tOPTIONS extends DDiagramCanvasBaseOptions<THEME> = DDiagramCanvasBaseOptions<THEME>\n> extends DCanvas<THEME, OPTIONS> {\n\tprotected _layer: DDiagramLayerContainer;\n\tprotected _tile: DDiagramCanvasTile;\n\n\tconstructor(options?: OPTIONS) {\n\t\tsuper(options);\n\n\t\t// Background\n\t\tconst theme = this.theme;\n\t\tif (!this.isAmbient(theme, options)) {\n\t\t\tthis._background = new DDiagramCanvasEditorBackground(\n\t\t\t\tthis._background,\n\t\t\t\tthis.toBackgroundBase(theme, options)\n\t\t\t);\n\t\t}\n\n\t\t// Layer\n\t\tconst layer = new DDiagramLayerContainer(this.width, this.height);\n\t\tthis._layer = layer;\n\t\tthis.addChild(layer);\n\n\t\t// Tile\n\t\tconst tile = new DDiagramCanvasTile(this, options?.tile);\n\t\tthis._tile = tile;\n\t\ttile.init();\n\t}\n\n\tprotected isAmbient(theme: THEME, options?: OPTIONS): boolean {\n\t\treturn options?.ambient ?? theme.isAmbient();\n\t}\n\n\tprotected toBackgroundBase(theme: THEME, options?: OPTIONS): number | null {\n\t\treturn options?.background?.base ?? theme.getBackgroundBase();\n\t}\n\n\tget tile(): DDiagramCanvasTile {\n\t\treturn this._tile;\n\t}\n\n\tget layer(): DDiagramLayerContainer {\n\t\treturn this._layer;\n\t}\n\n\tinitialize(shapes: EShape[]): void {\n\t\t// DO NOTHING\n\t}\n\n\tdestroy(): void {\n\t\tif (!this._destroyed) {\n\t\t\tthis._tile.destroy();\n\t\t\tthis._layer.destroy();\n\t\t\tsuper.destroy();\n\t\t}\n\t}\n\n\thitTest(global: IPoint, onHit?: (shape: EShape) => boolean): EShape | null {\n\t\tconst layers = this._layer.children;\n\t\tfor (let i = layers.length - 1; 0 <= i; --i) {\n\t\t\tconst layer = layers[i];\n\t\t\tif (layer.visible) {\n\t\t\t\tconst shape = layer.hitTest(global, onHit);\n\t\t\t\tif (shape != null) {\n\t\t\t\t\treturn shape;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DDiagramCanvasBase\";\n\t}\n}\n","/*\n * Copyright (C) 2021 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Container } from \"pixi.js\";\nimport { DApplications } from \"./d-applications\";\nimport { DDiagramSerializedSnap } from \"./d-diagram-serialized\";\nimport { EShapeContainer } from \"./shape/e-shape-container\";\nimport { EShapeStrokeStyle } from \"./shape/e-shape-stroke-style\";\nimport { EShapeBar } from \"./shape/variant/e-shape-bar\";\nimport { EShapeBarPosition } from \"./shape/variant/e-shape-bar-position\";\nimport { ESnapper } from \"./snapper/e-snapper\";\nimport { ESnapperTargetValueType } from \"./snapper/e-snapper-target-value\";\n\nexport interface DDiagramCanvasEditorSnapGridMajorOptions {\n\tinterval?: number;\n\tcolor?: number;\n\talpha?: number;\n\twidth?: number;\n\tstyle?: EShapeStrokeStyle;\n}\n\nexport interface DDiagramCanvasEditorSnapGridMinorOptions {\n\tcolor?: number;\n\talpha?: number;\n\twidth?: number;\n\tstyle?: EShapeStrokeStyle;\n}\n\nexport type DDiagramCanvasEditorSnapGridSize = (\n\tgiven: number,\n\twidth: number,\n\theight: number\n) => number;\n\nexport interface DDiagramCanvasEditorSnapGridOptions {\n\tmajor?: DDiagramCanvasEditorSnapGridMajorOptions;\n\tminor?: DDiagramCanvasEditorSnapGridMinorOptions;\n\tsize?: DDiagramCanvasEditorSnapGridSize;\n}\n\nexport interface DDiagramCanvasEditorSnapTargetOptions {\n\tcolor?: number;\n\talpha?: number;\n\twidth?: number;\n\tstyle?: EShapeStrokeStyle;\n}\n\nexport interface DDiagramCanvasEditorSnapOptions {\n\tcontroller: ESnapper;\n\tgrid?: DDiagramCanvasEditorSnapGridOptions;\n\ttarget?: DDiagramCanvasEditorSnapTargetOptions;\n}\n\nexport interface DThemeDiagramCanvasEditorSnap {\n\tgetSnapGridMajorInterval(): number;\n\tgetSnapGridMajorColor(): number;\n\tgetSnapGridMajorAlpha(): number;\n\tgetSnapGridMajorWidth(): number;\n\tgetSnapGridMajorStyle(): EShapeStrokeStyle;\n\n\tgetSnapGridMinorColor(): number;\n\tgetSnapGridMinorAlpha(): number;\n\tgetSnapGridMinorWidth(): number;\n\tgetSnapGridMinorStyle(): EShapeStrokeStyle;\n\n\tgetSnapGridSize(): DDiagramCanvasEditorSnapGridSize;\n\n\tgetSnapTargetColor(): number;\n\tgetSnapTargetAlpha(): number;\n\tgetSnapTargetWidth(): number;\n\tgetSnapTargetStyle(): EShapeStrokeStyle;\n}\n\nexport interface DDiagramCanvasEditorSnapParent extends Container {\n\treadonly width: number;\n\treadonly height: number;\n\ttoDirty(): void;\n}\n\nexport interface DDiagramCanvasEditorSnapGridMajor {\n\tinterval: number;\n\tcolor: number;\n\talpha: number;\n\twidth: number;\n\tstyle: EShapeStrokeStyle;\n}\n\nexport interface DDiagramCanvasEditorSnapGridMinor {\n\tcolor: number;\n\talpha: number;\n\twidth: number;\n\tstyle: EShapeStrokeStyle;\n}\n\nexport interface DDiagramCanvasEditorSnapGrid {\n\tmajor: DDiagramCanvasEditorSnapGridMajor;\n\tminor: DDiagramCanvasEditorSnapGridMinor;\n\tsize: DDiagramCanvasEditorSnapGridSize;\n}\n\nexport interface DDiagramCanvasEditorSnapTarget {\n\tcolor: number;\n\talpha: number;\n\twidth: number;\n\tstyle: EShapeStrokeStyle;\n}\n\nexport class DDiagramCanvasEditorSnap {\n\tprotected _parent: DDiagramCanvasEditorSnapParent;\n\tprotected _controller: ESnapper;\n\tprotected _container: EShapeContainer;\n\tprotected _grid: DDiagramCanvasEditorSnapGrid;\n\tprotected _target: DDiagramCanvasEditorSnapTarget;\n\n\tconstructor(\n\t\tparent: DDiagramCanvasEditorSnapParent,\n\t\ttheme: DThemeDiagramCanvasEditorSnap,\n\t\toptions: DDiagramCanvasEditorSnapOptions\n\t) {\n\t\tthis._parent = parent;\n\n\t\t// Controller\n\t\tconst controller = options.controller;\n\t\tthis._controller = controller;\n\t\tconst onChangeBound = (): void => {\n\t\t\tthis.onChange();\n\t\t};\n\t\tcontroller.grid.on(\"change\", onChangeBound);\n\t\tcontroller.target.on(\"change\", onChangeBound);\n\n\t\t// Container\n\t\tconst container = new EShapeContainer();\n\t\tcontainer.visible = false;\n\t\tthis._container = container;\n\t\tparent.addChildAt(container, parent.children.length - 1);\n\n\t\t// Grid\n\t\tthis._grid = this.toGrid(theme, options.grid);\n\n\t\t// Target\n\t\tthis._target = this.toTarget(theme, options.target);\n\t}\n\n\tprotected toGrid(\n\t\ttheme: DThemeDiagramCanvasEditorSnap,\n\t\toptions?: DDiagramCanvasEditorSnapGridOptions\n\t): DDiagramCanvasEditorSnapGrid {\n\t\treturn {\n\t\t\tmajor: this.toGridMajor(theme, options?.major),\n\t\t\tminor: this.toGridMinor(theme, options?.minor),\n\t\t\tsize: options?.size ?? theme.getSnapGridSize()\n\t\t};\n\t}\n\n\tprotected toGridMajor(\n\t\ttheme: DThemeDiagramCanvasEditorSnap,\n\t\toptions?: DDiagramCanvasEditorSnapGridMajorOptions\n\t): DDiagramCanvasEditorSnapGridMajor {\n\t\treturn {\n\t\t\tinterval: options?.interval ?? theme.getSnapGridMajorInterval(),\n\t\t\tcolor: options?.color ?? theme.getSnapGridMajorColor(),\n\t\t\talpha: options?.alpha ?? theme.getSnapGridMajorAlpha(),\n\t\t\twidth: options?.width ?? theme.getSnapGridMajorWidth(),\n\t\t\tstyle: options?.style ?? theme.getSnapGridMajorStyle()\n\t\t};\n\t}\n\n\tprotected toGridMinor(\n\t\ttheme: DThemeDiagramCanvasEditorSnap,\n\t\toptions?: DDiagramCanvasEditorSnapGridMinorOptions\n\t): DDiagramCanvasEditorSnapGridMinor {\n\t\treturn {\n\t\t\tcolor: options?.color ?? theme.getSnapGridMinorColor(),\n\t\t\talpha: options?.alpha ?? theme.getSnapGridMinorAlpha(),\n\t\t\twidth: options?.width ?? theme.getSnapGridMinorWidth(),\n\t\t\tstyle: options?.style ?? theme.getSnapGridMinorStyle()\n\t\t};\n\t}\n\n\tprotected toTarget(\n\t\ttheme: DThemeDiagramCanvasEditorSnap,\n\t\toptions?: DDiagramCanvasEditorSnapTargetOptions\n\t): DDiagramCanvasEditorSnapTarget {\n\t\treturn {\n\t\t\tcolor: options?.color ?? theme.getSnapTargetColor(),\n\t\t\talpha: options?.alpha ?? theme.getSnapTargetAlpha(),\n\t\t\twidth: options?.width ?? theme.getSnapTargetWidth(),\n\t\t\tstyle: options?.style ?? theme.getSnapTargetStyle()\n\t\t};\n\t}\n\n\tprotected onChange(): void {\n\t\tconst parent = this._parent;\n\t\tparent.toDirty();\n\t\tDApplications.update(parent);\n\t}\n\n\tget container(): EShapeContainer {\n\t\treturn this._container;\n\t}\n\n\tserialize(): DDiagramSerializedSnap {\n\t\treturn this._controller.serialize();\n\t}\n\n\tonReflow(): void {\n\t\tconst parent = this._parent;\n\t\tconst container = this._container;\n\t\tconst controller = this._controller;\n\n\t\tconst isGridVisible = controller.grid.visible;\n\t\tconst isTargetVisible = controller.target.visible;\n\t\tif (isGridVisible || isTargetVisible) {\n\t\t\tconst w = parent.width;\n\t\t\tconst h = parent.height;\n\t\t\tconst wh = 0.5 * w;\n\t\t\tconst hh = 0.5 * h;\n\t\t\tconst TOP = EShapeBarPosition.TOP;\n\t\t\tconst LEFT = EShapeBarPosition.LEFT;\n\n\t\t\tconst shapes = container.children as EShapeBar[];\n\t\t\tlet index = 0;\n\n\t\t\t// Grid\n\t\t\tif (isGridVisible) {\n\t\t\t\tconst grid = this._grid;\n\t\t\t\tconst major = grid.major;\n\t\t\t\tconst minor = grid.minor;\n\t\t\t\tconst interval = major.interval;\n\t\t\t\tconst size = grid.size(controller.grid.size, w, h);\n\t\t\t\tfor (let x = size, ix = 1; x < w; x += size, ix += 1, index += 1) {\n\t\t\t\t\tconst style = ix % interval === 0 ? major : minor;\n\t\t\t\t\tthis.update(container, shapes, index, x, hh, TOP, w, h, style);\n\t\t\t\t}\n\t\t\t\tfor (let y = size, iy = 1; y < h; y += size, iy += 1, index += 1) {\n\t\t\t\t\tconst style = iy % interval === 0 ? major : minor;\n\t\t\t\t\tthis.update(container, shapes, index, wh, y, LEFT, w, h, style);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Target\n\t\t\tif (isTargetVisible) {\n\t\t\t\tconst values = controller.target.values;\n\t\t\t\tconst target = this._target;\n\t\t\t\tfor (let i = 0, imax = values.length; i < imax; i += 1, index += 1) {\n\t\t\t\t\tconst value = values[i];\n\t\t\t\t\tconst position = value.position;\n\t\t\t\t\tif (value.type === ESnapperTargetValueType.VERTICAL) {\n\t\t\t\t\t\tthis.update(container, shapes, index, position, hh, TOP, w, h, target);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.update(container, shapes, index, wh, position, LEFT, w, h, target);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (let i = index, imax = shapes.length; i < imax; ++i) {\n\t\t\t\tshapes[i].visible = false;\n\t\t\t}\n\n\t\t\tcontainer.visible = true;\n\t\t} else {\n\t\t\tcontainer.visible = false;\n\t\t}\n\t}\n\n\tprotected update(\n\t\tcontainer: EShapeContainer,\n\t\tshapes: EShapeBar[],\n\t\tindex: number,\n\t\tx: number,\n\t\ty: number,\n\t\tposition: EShapeBarPosition,\n\t\tw: number,\n\t\th: number,\n\t\tstyle:\n\t\t\t| DDiagramCanvasEditorSnapGridMajor\n\t\t\t| DDiagramCanvasEditorSnapGridMinor\n\t\t\t| DDiagramCanvasEditorSnapTarget\n\t): void {\n\t\tlet shape = null;\n\t\tif (index < shapes.length) {\n\t\t\tshape = shapes[index];\n\t\t\tshape.disallowUploadedUpdate();\n\t\t\tshape.points.position = position;\n\t\t\tshape.transform.position.set(x, y);\n\t\t\tshape.stroke.set(\n\t\t\t\ttrue,\n\t\t\t\tstyle.color,\n\t\t\t\tstyle.alpha,\n\t\t\t\tstyle.width,\n\t\t\t\tundefined,\n\t\t\t\tundefined,\n\t\t\t\tstyle.style\n\t\t\t);\n\t\t\tshape.size.set(w, h);\n\t\t\tshape.visible = true;\n\t\t\tshape.allowUploadedUpdate();\n\t\t} else {\n\t\t\tshape = new EShapeBar();\n\t\t\tshape.disallowUploadedUpdate();\n\t\t\tshape.points.position = position;\n\t\t\tshape.transform.position.set(x, y);\n\t\t\tshape.stroke.set(\n\t\t\t\ttrue,\n\t\t\t\tstyle.color,\n\t\t\t\tstyle.alpha,\n\t\t\t\tstyle.width,\n\t\t\t\tundefined,\n\t\t\t\tundefined,\n\t\t\t\tstyle.style\n\t\t\t);\n\t\t\tshape.size.set(w, h);\n\t\t\tshape.visible = true;\n\t\t\tshape.allowUploadedUpdate();\n\t\t\tshape.attach(container);\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {\n\tDDiagramCanvasBase,\n\tDDiagramCanvasBaseOptions,\n\tDThemeDiagramCanvasBase\n} from \"./d-diagram-canvas-base\";\nimport {\n\tDDiagramCanvasEditorSnap,\n\tDDiagramCanvasEditorSnapOptions,\n\tDThemeDiagramCanvasEditorSnap\n} from \"./d-diagram-canvas-editor-snap\";\nimport {\n\tDDiagramSerialized,\n\tDDiagramSerializedItem,\n\tDDiagramSerializedVersion\n} from \"./d-diagram-serialized\";\nimport { EShapeResourceManagerSerialization } from \"./shape/e-shape-resource-manager-serialization\";\nimport { isNumber } from \"./util/is-number\";\n\nexport interface DDiagramCanvasEditorOptions<\n\tTHEME extends DThemeDiagramCanvasEditor = DThemeDiagramCanvasEditor\n> extends DDiagramCanvasBaseOptions<THEME> {\n\tsnap?: DDiagramCanvasEditorSnapOptions;\n}\n\nexport interface DThemeDiagramCanvasEditor\n\textends DThemeDiagramCanvasBase,\n\t\tDThemeDiagramCanvasEditorSnap {}\n\nexport interface DDiagramCanvasEditorThumbnail {\n\tserialize(): string | undefined;\n}\n\nexport class DDiagramCanvasEditor<\n\tTHEME extends DThemeDiagramCanvasEditor = DThemeDiagramCanvasEditor,\n\tOPTIONS extends DDiagramCanvasEditorOptions<THEME> = DDiagramCanvasEditorOptions<THEME>\n> extends DDiagramCanvasBase<THEME, OPTIONS> {\n\tprotected _snap: DDiagramCanvasEditorSnap | null;\n\n\tconstructor(options: OPTIONS) {\n\t\tsuper(options);\n\t\tthis._snap = this.toSnap(this.theme, options.snap);\n\t}\n\n\tprotected toSnap(\n\t\ttheme: THEME,\n\t\toptions?: DDiagramCanvasEditorSnapOptions\n\t): DDiagramCanvasEditorSnap | null {\n\t\tif (options) {\n\t\t\treturn new DDiagramCanvasEditorSnap(this, theme, options);\n\t\t}\n\t\treturn null;\n\t}\n\n\tget snap(): DDiagramCanvasEditorSnap | null {\n\t\treturn this._snap;\n\t}\n\n\tserialize(id?: number, thumbnail?: DDiagramCanvasEditorThumbnail): DDiagramSerialized {\n\t\tconst manager = new EShapeResourceManagerSerialization();\n\t\tconst items: DDiagramSerializedItem[] = [];\n\t\tconst background = this._background;\n\t\tconst backgroundColor = background.color;\n\t\tconst backgroundAlpha = background.alpha;\n\t\treturn {\n\t\t\tversion: DDiagramSerializedVersion,\n\t\t\tid,\n\t\t\tname: this.name,\n\t\t\twidth: this.width,\n\t\t\theight: this.height,\n\t\t\tbackground: {\n\t\t\t\tcolor: isNumber(backgroundColor) ? backgroundColor : 0xffffff,\n\t\t\t\talpha: isNumber(backgroundAlpha) ? backgroundAlpha : 0\n\t\t\t},\n\t\t\ttile: this._tile.serialize(),\n\t\t\tresources: manager.resources,\n\t\t\tdata: manager.data,\n\t\t\tpieces: manager.pieces,\n\t\t\tlayers: this._layer.serialize(manager, items),\n\t\t\titems,\n\t\t\tsnap: this._snap?.serialize(),\n\t\t\tthumbnail: thumbnail?.serialize()\n\t\t};\n\t}\n\n\tonReflow(): void {\n\t\tsuper.onReflow();\n\t\tthis._snap?.onReflow();\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DDiagramCanvasEditor\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDiagramCanvasTileMapping } from \"./d-diagram-canvas-mapping\";\nimport { EShapeCorner } from \"./shape/e-shape-corner\";\nimport { EShapeStrokeSide } from \"./shape/e-shape-stroke-side\";\nimport { EShapeStrokeStyle } from \"./shape/e-shape-stroke-style\";\nimport { EShapeDataValueOrder } from \"./shape/e-shape-data-value\";\nimport { EShapeTextStyle, EShapeTextWeight } from \"./shape/e-shape-text\";\nimport { EShapeTextAlignHorizontal } from \"./shape/e-shape-text-align-horizontal\";\nimport { EShapeTextAlignVertical } from \"./shape/e-shape-text-align-vertical\";\nimport { EShapeTextDirection } from \"./shape/e-shape-text-direction\";\nimport { EShapeType } from \"./shape/e-shape-type\";\nimport { ESnapperTargetValueType } from \"./snapper/e-snapper-target-value\";\nimport { EShapeDataValueRangeType } from \"./shape/e-shape-data-value-range\";\n\nexport const DDiagramSerializedVersion: number = 1;\n\n/**\n * A serialized data range.\n */\nexport interface DDiagramSerializedDataRange {\n\t/** A type. */\n\t[0]: EShapeDataValueRangeType;\n\n\t/** A lower bound. */\n\t[1]: number;\n\n\t/** An upper bound. */\n\t[2]: number;\n}\n\n/**\n * A serialized data value.\n */\nexport interface DDiagramSerializedDataValue {\n\t/**\n\t * A resource index number of an ID.\n\t * Stored at DDiagramSerialized#resources.\n\t */\n\t[0]: number;\n\n\t/**\n\t * A resource index number of an initial value expression.\n\t * Stored at DDiagramSerialized#resources.\n\t */\n\t[1]: number;\n\n\t/**\n\t * A resource index number of a format expression.\n\t * Stored at DDiagramSerialized#resources.\n\t */\n\t[2]: number;\n\n\t/**\n\t * A resource index number of a serialized range, JSON.stringify(DDiagramSerializedDataRange).\n\t * Stored at DDiagramSerialized#resources.\n\t */\n\t[3]: number;\n\n\t/**\n\t * A capacity.\n\t */\n\t[4]: number;\n\n\t/**\n\t * A order.\n\t */\n\t[5]: EShapeDataValueOrder;\n}\n\n/**\n * A serialized fill.\n */\nexport interface DDiagramSerializedFill {\n\t/** 0: Disabled, 1: Enabled */\n\t[0]: number;\n\n\t/** A color. */\n\t[1]: number;\n\n\t/** An alpha. */\n\t[2]: number;\n}\n\n/**\n * A serialized stroke.\n */\nexport interface DDiagramSerializedStroke {\n\t/** 0: Disabled, 1: Enabled */\n\t[0]: number;\n\n\t/** A color. */\n\t[1]: number;\n\n\t/** An alpha. */\n\t[2]: number;\n\n\t/** A width. */\n\t[3]: number;\n\n\t/** An align. */\n\t[4]: number;\n\n\t/** A side. */\n\t[5]: EShapeStrokeSide;\n\n\t/** A style */\n\t[6]: EShapeStrokeStyle | undefined;\n}\n\n/**\n * A serialized text outline.\n */\nexport interface DDiagramSerializedTextOutline {\n\t/** 0: Disabled, 1: Enabled */\n\t[0]: number;\n\n\t/** A color. */\n\t[1]: number;\n\n\t/** An alpha. */\n\t[2]: number;\n\n\t/** A width. */\n\t[3]: number;\n}\n\n/**\n * A serialized text align.\n */\nexport interface DDiagramSerializedTextAlign {\n\t/** A horizontal align. */\n\t[0]: EShapeTextAlignHorizontal;\n\n\t/** A vertical align. */\n\t[1]: EShapeTextAlignVertical;\n}\n\n/**\n * A serialized text offset.\n */\nexport interface DDiagramSerializedTextOffset {\n\t/** A horizontal offset. */\n\t[0]: number;\n\n\t/** A vertical offset. */\n\t[1]: number;\n}\n\n/**\n * A serialized text spacing.\n */\nexport interface DDiagramSerializedTextSpacing {\n\t/** A horizontal spacing. */\n\t[0]: number;\n\n\t/** A vertical spacing. */\n\t[1]: number;\n}\n\n/**\n * A serialized text padding.\n */\nexport interface DDiagramSerializedTextPadding {\n\t/** A horizontal padding. */\n\t[0]: number;\n\n\t/** A vertical padding. */\n\t[1]: number;\n}\n\n/**\n * A serialized text.\n */\nexport interface DDiagramSerializedText {\n\t/** A resource index number of a value. */\n\t[0]: number;\n\n\t/** A color. */\n\t[1]: number;\n\n\t/** An alpha. */\n\t[2]: number;\n\n\t/** A resource index number of a font family. */\n\t[3]: number;\n\n\t/** A size. */\n\t[4]: number;\n\n\t/** A weight. */\n\t[5]: EShapeTextWeight;\n\n\t/**\n\t * A resource index number of a stringified serialized align,\n\t * JSON.stringify(DDiagramSerializedTextAlign).\n\t */\n\t[6]: number;\n\n\t/**\n\t * A resource index number of a stringified serialized offset,\n\t * JSON.stringify(DDiagramSerializedTextOffset).\n\t */\n\t[7]: number;\n\n\t/** A style. */\n\t[8]: EShapeTextStyle;\n\n\t/**\n\t * A resource index number of a stringified serialized outline,\n\t * JSON.stringify(DDiagramSerializedTextOutline).\n\t */\n\t[9]: number;\n\n\t/**\n\t * A resource index number of a stringified serialized spacing,\n\t * JSON.stringify(DDiagramSerializedTextSpacing).\n\t */\n\t[10]: number;\n\n\t/** A direction. */\n\t[11]: EShapeTextDirection;\n\n\t/**\n\t * A resource index number of a stringified serialized padding,\n\t * JSON.stringify(DDiagramSerializedTextPadding).\n\t */\n\t[12]: number;\n\n\t/** A clipping. (0: Off, 1: On) */\n\t[13]: number;\n}\n\n/**\n * A serialized item.\n */\nexport interface DDiagramSerializedItem {\n\t/** A type. */\n\t[0]: EShapeType;\n\n\t/** A resource index number of a ID. */\n\t[1]: number;\n\n\t/** A X-coordinate position. */\n\t[2]: number;\n\n\t/** A Y-coordinate position. */\n\t[3]: number;\n\n\t/** A width. */\n\t[4]: number;\n\n\t/** A height. */\n\t[5]: number;\n\n\t/** A rotation. */\n\t[6]: number;\n\n\t/** A skew. */\n\t[7]: number;\n\n\t/**\n\t * A resource index number of a stringified serialized fill,\n\t * JSON.stringify(DDiagramSerializedFill).\n\t */\n\t[8]: number;\n\n\t/**\n\t * A resource index number of a stringified serialized stroke,\n\t * JSON.stringify(DDiagramSerializedStroke).\n\t */\n\t[9]: number;\n\n\t/** A resource index number of a cursor. */\n\t[10]: number;\n\n\t/**\n\t * A resource index number of a stringified serialized text,\n\t * JSON.stringify(DDiagramSerializedText).\n\t */\n\t[11]: number;\n\n\t/**\n\t * A resource index number of stringified serialized data,\n\t * JSON.stringify(DDiagramSerializedDataValue[]).\n\t */\n\t[12]: number;\n\n\t/** A radius. */\n\t[13]: number;\n\n\t/** A corner. */\n\t[14]: EShapeCorner;\n\n\t/** A resource index number of a shape-specific resource. */\n\t[15]: number;\n\n\t/** A layer index number. */\n\t[16]: number;\n\n\t/** Actions */\n\t[17]: number[];\n\n\t/** A resource index number of an image. */\n\t[18]: number;\n\n\t/**\n\t * A resource index number of a stringified serialized gradient.\n\t * A stringified serialized gradient is a stringified number array,\n\t * JSON.stringify(number[]).\n\t *\n\t * * The first number in the array is a direction in degree.\n\t * * The number at an index number 1 + 3 * n + 0 is a color of a n-th point.\n\t * * The number at an index number 1 + 3 * n + 1 is a alpha of a n-th point.\n\t * * The number at an index number 1 + 3 * n + 2 is a position of a n-th point whose range is [0, 1].\n\t */\n\t[19]: number;\n\n\t/** A children. */\n\t[20]: DDiagramSerializedItem[];\n\n\t/** A X pivot. */\n\t[21]: number;\n\n\t/** A Y pivot. */\n\t[22]: number;\n\n\t/** (interactive ? 1 : 0) | (unfocusable ? 2 : 0) */\n\t[23]: number;\n\n\t/** A resource index number of a shortcut. */\n\t[24]: number;\n\n\t/** A resource index number of a title. */\n\t[25]: number;\n\n\t/** UUID */\n\t[26]: number;\n}\n\n/**\n * A serialized layer.\n */\nexport interface DDiagramSerializedLayer {\n\t/** A name or a resource index number of a name*/\n\t[0]: string | number;\n\n\t/**\n\t * A visibility.\n\t *\n\t * * 1st bit\n\t *     * 0: Invisible when edit mode\n\t *     * 1: Visible when edit mode\n\t * * 2nd bit\n\t *     * 0: Invisible when non-edit mode\n\t *     * 1: Visible when non-edit mode\n\t */\n\t[1]?: number;\n\n\t/** A X-coordinate position. */\n\t[2]?: number;\n\n\t/** A Y-coordinate position. */\n\t[3]?: number;\n\n\t/** A width. */\n\t[4]?: number;\n\n\t/** A height. */\n\t[5]?: number;\n\n\t/**\n\t * A resource index number of a stringified serialized fill,\n\t * JSON.stringify(DDiagramSerializedFill).\n\t */\n\t[6]?: number;\n\n\t/**\n\t * * 1st bit\n\t *     * 0: Not interactive\n\t *     * 1: Interactive\n\t * * 2nd bit\n\t *     * 0: Not draggable\n\t *     * 1: Draggable\n\t * * 3rd bit\n\t *     * 0: Not pinchable\n\t *     * 1: Pinchable\n\t */\n\t[7]?: number;\n}\n\n/**\n * A serialized snap target.\n */\nexport interface DDiagramSerializedSnapTargetValue {\n\t/** A type. */\n\t[0]: ESnapperTargetValueType;\n\n\t/** A position. */\n\t[1]: number;\n}\n\n/**\n * Serialized snap on guide settings.\n */\nexport interface DDiagramSerializedSnapTarget {\n\t/** Snap on guide (0: Off, 1: On) */\n\t[0]: number;\n\n\t/** A visibility (0: Invisible, 1: Visible). */\n\t[1]: number;\n\n\t/** Snap targets. */\n\t[2]: DDiagramSerializedSnapTargetValue[];\n}\n\n/**\n * Serialized grid snap settings without a visibility option.\n */\nexport interface DDiagramSerializedSnapGridWithoutVisibility {\n\t/** Snap on grid (0: Off, 1: On) */\n\t[0]: number;\n\n\t/** A grid size. */\n\t[1]: number;\n}\n\n/**\n * Serialized grid snap settings with a visibility option.\n */\nexport interface DDiagramSerializedSnapGridWithVisibility {\n\t/** Snap on grid (0: Off, 1: On) */\n\t[0]: number;\n\n\t/** A visibility (0: Invisible, 1: Visible). */\n\t[1]: number;\n\n\t/** A grid size. */\n\t[2]: number;\n}\n\n/**\n * Serialized grid snap settings with a visibility.\n */\nexport type DDiagramSerializedSnapGrid =\n\t| DDiagramSerializedSnapGridWithoutVisibility\n\t| DDiagramSerializedSnapGridWithVisibility;\n\n/**\n * Serialized snap settings.\n */\nexport interface DDiagramSerializedSnap {\n\t/** Snap (0: Off, 1: On). */\n\t[0]: number;\n\n\t/** Snap on targets */\n\t[1]: DDiagramSerializedSnapTarget;\n\n\t/** Snap on grid */\n\t[2]: DDiagramSerializedSnapGrid;\n}\n\n/**\n * Serialized background settings.\n */\nexport interface DDiagramSerializedBackground {\n\tcolor?: number | null;\n\talpha?: number;\n}\n\n/**\n * Serialized tile settings.\n */\nexport interface DDiagramSerializedTile {\n\tmapping?: DDiagramCanvasTileMapping;\n}\n\n/**\n * A serialized diagram.\n */\nexport interface DDiagramSerialized {\n\tversion: number;\n\tid?: number;\n\tname: string;\n\twidth: number;\n\theight: number;\n\tbackground?: DDiagramSerializedBackground;\n\ttile?: DDiagramSerializedTile;\n\tresources: string[];\n\t/** @deprecated in favor of {@link data} */\n\ttags?: string[];\n\tdata?: string[];\n\tpieces?: string[];\n\tlayers: DDiagramSerializedLayer[];\n\titems: DDiagramSerializedItem[];\n\tsnap?: DDiagramSerializedSnap;\n\tthumbnail?: string;\n}\n\nexport type DDiagramSerializedSimpleData = Omit<\n\tDDiagramSerialized,\n\t\"version\" | \"id\" | \"name\" | \"thumbnail\"\n>;\n\n/**\n * A simplified version of a serialized diagram.\n */\nexport interface DDiagramSerializedSimple {\n\tversion: number;\n\tid: number | undefined;\n\tname: string;\n\n\t/**\n\t * A stringified {@link DDiagramSerialized#data}.\n\t *\n\t * @deprecated in favor of {@link DDiagramSerializedSimpleData}.\n\t */\n\ttags?: string;\n\n\t/**\n\t * A stringified {@link DDiagramSerialized#pieces}.\n\t *\n\t * @deprecated in favor of {@link DDiagramSerializedSimpleData}.\n\t */\n\tpieces?: string;\n\n\t/**\n\t * Thumbnail data URL.\n\t */\n\tthumbnail?: string;\n\n\t/**\n\t * A stringified {@link DDiagramSerializedSimpleData}.\n\t */\n\tdata: string;\n}\n\nexport interface DDiagramSerializedName {\n\tid: number;\n\tname: string;\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction, IPoint, Point } from \"pixi.js\";\nimport { DApplications } from \"./d-applications\";\nimport {\n\tDDiagramCanvasBase,\n\tDDiagramCanvasBaseOptions,\n\tDThemeDiagramCanvasBase\n} from \"./d-diagram-canvas-base\";\nimport { DDiagramCanvasIdMap } from \"./d-diagram-canvas-id-map\";\nimport { DDiagramCanvasDataMap } from \"./d-diagram-canvas-data-map\";\nimport { EShapeContainer } from \"./shape\";\nimport { EShape } from \"./shape/e-shape\";\nimport { EShapeBase } from \"./shape/variant/e-shape-base\";\nimport { UtilPointerEvent } from \"./util/util-pointer-event\";\n\nexport interface DDiagramCanvasOptions<THEME extends DThemeDiagramCanvas = DThemeDiagramCanvas>\n\textends DDiagramCanvasBaseOptions<THEME> {}\n\nexport interface DThemeDiagramCanvas extends DThemeDiagramCanvasBase {}\n\nexport class DDiagramCanvas<\n\tTHEME extends DThemeDiagramCanvas = DThemeDiagramCanvas,\n\tOPTIONS extends DDiagramCanvasOptions<THEME> = DDiagramCanvasOptions<THEME>\n> extends DDiagramCanvasBase<THEME, OPTIONS> {\n\tprotected static WORK_DBLCLICK?: Point;\n\n\t/** @deprecated in favor of {@link data} */\n\ttags: DDiagramCanvasDataMap;\n\tdata: DDiagramCanvasDataMap;\n\tactionables: EShape[];\n\tids: DDiagramCanvasIdMap;\n\n\tprotected _overed?: EShape | null;\n\tprotected _downed?: EShape | null;\n\tprotected _downeds: Set<EShape>;\n\n\tconstructor(options: OPTIONS) {\n\t\tsuper(options);\n\t\tconst data = {};\n\t\tthis.data = data;\n\t\tthis.tags = data;\n\t\tthis.actionables = [];\n\t\tthis.ids = {};\n\t\tthis._downeds = new Set<EShape>();\n\t}\n\n\tinitialize(): void {\n\t\tconst time = Date.now();\n\t\tconst data = this.data;\n\t\tconst actionables = this.actionables;\n\t\tconst ids = this.ids;\n\t\tconst layers = this._layer.children;\n\t\tfor (let i = 0, imax = layers.length; i < imax; ++i) {\n\t\t\tlayers[i].initialize(data, ids, actionables);\n\t\t}\n\t\tfor (let i = 0, imax = layers.length; i < imax; ++i) {\n\t\t\tconst layerChildren = layers[i].children;\n\t\t\tfor (let j = 0, jmax = layerChildren.length; j < jmax; ++j) {\n\t\t\t\tlayerChildren[j].update(time);\n\t\t\t}\n\t\t}\n\t}\n\n\thitTestInteractives(global: IPoint): EShape | null {\n\t\tconst layers = this._layer.children;\n\t\tfor (let i = layers.length - 1; 0 <= i; --i) {\n\t\t\tconst layer = layers[i];\n\t\t\tif (layer.visible) {\n\t\t\t\tconst result = layer.hitTestInteractives(global);\n\t\t\t\tif (result != null) {\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tonShapeMove(e: interaction.InteractionEvent): boolean {\n\t\tconst found = this.hitTestInteractives(e.data.global);\n\n\t\tconst layer = DApplications.getLayer(this);\n\t\tif (layer) {\n\t\t\tconst view = layer.view;\n\n\t\t\t// Cursor\n\t\t\tconst cursor = this.toShapeCursor(found);\n\t\t\tconst style = view.style;\n\t\t\tif (style.cursor !== cursor) {\n\t\t\t\tstyle.cursor = cursor;\n\t\t\t}\n\n\t\t\t// TItle\n\t\t\tconst title = this.toShapeTitle(found);\n\t\t\tif (view.title !== title) {\n\t\t\t\tview.title = title;\n\t\t\t}\n\t\t}\n\n\t\tconst overed = this._overed;\n\t\tthis._overed = found;\n\t\tif (found === overed) {\n\t\t\tif (found != null) {\n\t\t\t\tconst runtime = found.runtime;\n\t\t\t\tif (runtime) {\n\t\t\t\t\truntime.onMove(found, e);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tthis.onShapeOut(e, overed, found);\n\t\t\tthis.onShapeOver(e, found);\n\t\t}\n\t\treturn found != null;\n\t}\n\n\tprotected toShapeCursor(target: EShape | null): string {\n\t\tif (target != null) {\n\t\t\tconst result = target.cursor;\n\t\t\tif (0 < result.length) {\n\t\t\t\treturn result;\n\t\t\t}\n\t\t}\n\t\treturn \"auto\";\n\t}\n\n\tprotected toShapeTitle(target: EShape | null): string {\n\t\tif (target != null) {\n\t\t\treturn target.title || \"\";\n\t\t}\n\t\treturn \"\";\n\t}\n\n\tprotected onShapeOut(\n\t\te: interaction.InteractionEvent,\n\t\ttarget?: EShape | EShapeContainer | null,\n\t\texcept?: EShape | null\n\t): void {\n\t\twhile (target != null && target !== except && target instanceof EShapeBase) {\n\t\t\tconst runtime = target.runtime;\n\t\t\tif (runtime) {\n\t\t\t\truntime.onOut(target, e);\n\t\t\t}\n\t\t\ttarget = target.parent;\n\t\t}\n\t}\n\n\tprotected onShapeOver(\n\t\te: interaction.InteractionEvent,\n\t\ttarget?: EShape | EShapeContainer | null,\n\t\texcept?: EShape | null\n\t): void {\n\t\twhile (target != null && target !== except && target instanceof EShapeBase) {\n\t\t\tconst runtime = target.runtime;\n\t\t\tif (runtime) {\n\t\t\t\truntime.onOver(target, e);\n\t\t\t}\n\t\t\ttarget = target.parent;\n\t\t}\n\t}\n\n\tonShapeDown(e: interaction.InteractionEvent): boolean {\n\t\tconst found = this.hitTestInteractives(e.data.global);\n\t\tthis._downed = found;\n\t\tif (found) {\n\t\t\tthis._downeds.add(found);\n\t\t\tlet target = found;\n\t\t\twhile (true) {\n\t\t\t\tconst runtime = target.runtime;\n\t\t\t\tif (runtime) {\n\t\t\t\t\truntime.onDown(target, e);\n\t\t\t\t}\n\t\t\t\tconst parent = target.parent;\n\t\t\t\tif (parent instanceof EShapeBase) {\n\t\t\t\t\ttarget = parent;\n\t\t\t\t} else {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tonShapeUp(e: interaction.InteractionEvent): boolean {\n\t\tconst downeds = this._downeds;\n\t\tconst found = this.hitTestInteractives(e.data.global);\n\t\tif (found) {\n\t\t\tdowneds.delete(found);\n\t\t\tlet target = found;\n\t\t\twhile (true) {\n\t\t\t\tconst runtime = target.runtime;\n\t\t\t\tif (runtime) {\n\t\t\t\t\truntime.onUp(target, e);\n\t\t\t\t}\n\t\t\t\tconst parent = target.parent;\n\t\t\t\tif (parent instanceof EShapeBase) {\n\t\t\t\t\ttarget = parent;\n\t\t\t\t} else {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis.onShapeCancel(e);\n\t\treturn found != null;\n\t}\n\n\tonShapeCancel(e: interaction.InteractionEvent): boolean {\n\t\tconst downeds = this._downeds;\n\t\tif (0 < downeds.size) {\n\t\t\tdowneds.forEach((downed: EShape): void => {\n\t\t\t\tlet target = downed;\n\t\t\t\twhile (true) {\n\t\t\t\t\tconst runtime = target.runtime;\n\t\t\t\t\tif (runtime) {\n\t\t\t\t\t\truntime.onUpOutside(target, e);\n\t\t\t\t\t}\n\t\t\t\t\tconst parent = target.parent;\n\t\t\t\t\tif (parent instanceof EShapeBase) {\n\t\t\t\t\t\ttarget = parent;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tdowneds.clear();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tonShapeClick(e: interaction.InteractionEvent): boolean {\n\t\tconst found = this.hitTestInteractives(e.data.global);\n\t\tif (found && this._downed === found) {\n\t\t\tlet target = found;\n\t\t\twhile (true) {\n\t\t\t\tconst runtime = target.runtime;\n\t\t\t\tif (runtime) {\n\t\t\t\t\truntime.onClick(target, e);\n\t\t\t\t}\n\t\t\t\tconst parent = target.parent;\n\t\t\t\tif (parent instanceof EShapeBase) {\n\t\t\t\t\ttarget = parent;\n\t\t\t\t} else {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tonShapeDblClick(\n\t\te: MouseEvent | TouchEvent,\n\t\tinteractionManager: interaction.InteractionManager\n\t): boolean {\n\t\tconst global = (DDiagramCanvas.WORK_DBLCLICK ??= new Point());\n\t\tUtilPointerEvent.toGlobal(e, interactionManager, global);\n\t\tconst found = this.hitTestInteractives(global);\n\t\tif (found) {\n\t\t\tlet target = found;\n\t\t\twhile (true) {\n\t\t\t\tconst runtime = target.runtime;\n\t\t\t\tif (runtime) {\n\t\t\t\t\truntime.onDblClick(target, e, interactionManager);\n\t\t\t\t}\n\t\t\t\tconst parent = target.parent;\n\t\t\t\tif (parent instanceof EShapeBase) {\n\t\t\t\t\ttarget = parent;\n\t\t\t\t} else {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DDiagramCanvas\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport interface DDiagramDataRemoteController {\n\twrite(id: string, value: unknown): void;\n}\n\nexport interface DDiagramDataRemoteOptions {\n\tcontroller?: DDiagramDataRemoteController;\n}\n\nexport class DDiagramDataRemote {\n\tprotected _controller?: DDiagramDataRemoteController;\n\n\tconstructor(options?: DDiagramDataRemoteOptions) {\n\t\tthis._controller = options && options.controller;\n\t}\n\n\tset(id: string, value: unknown, time: number): boolean {\n\t\tconst controller = this._controller;\n\t\tif (controller) {\n\t\t\tcontroller.write(id, value);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDiagramCanvasDataMap } from \"./d-diagram-canvas-data-map\";\nimport { DDiagramDataRemote, DDiagramDataRemoteOptions } from \"./d-diagram-data-remote\";\nimport { EShape } from \"./shape/e-shape\";\nimport { EShapeDataValue } from \"./shape/e-shape-data-value\";\nimport { EShapeDataValueRangeType } from \"./shape/e-shape-data-value-range\";\n\nexport interface DDiagramDataCanvas {\n\tdata: DDiagramCanvasDataMap;\n}\n\nexport interface DDiagramDataDiagram {\n\tcanvas: DDiagramDataCanvas | null;\n}\n\n/**\n * A data mapper.\n *\n * @param dataValue a data value\n */\nexport type DDiagramDataMapper = (value: EShapeDataValue, shape: EShape) => void;\n\nexport interface DDiagramDataOptions {\n\t/**\n\t * A data mapper.\n\t */\n\tmapper?: DDiagramDataMapper;\n\n\t/**\n\t * Remote data options.\n\t */\n\tremote?: DDiagramDataRemoteOptions;\n}\n\n/**\n * A data helper class for diagrams.\n */\nexport class DDiagramData {\n\tprotected _diagram: DDiagramDataDiagram;\n\tprotected _mapper: DDiagramDataMapper | null;\n\tprotected _remote: DDiagramDataRemote;\n\n\tconstructor(diagram: DDiagramDataDiagram, options?: DDiagramDataOptions) {\n\t\tthis._diagram = diagram;\n\t\tthis._mapper = (options && options.mapper) || null;\n\t\tthis._remote = new DDiagramDataRemote(options && options.remote);\n\t}\n\n\tupdate(): void {\n\t\t// DO NOTHING\n\t}\n\n\tget mapper(): DDiagramDataMapper | null {\n\t\treturn this._mapper;\n\t}\n\n\tset mapper(mapper: DDiagramDataMapper | null) {\n\t\tthis._mapper = mapper;\n\t}\n\n\tget remote(): DDiagramDataRemote {\n\t\treturn this._remote;\n\t}\n\n\tgetIds(): string[] {\n\t\tconst canvas = this._diagram.canvas;\n\t\tif (canvas != null) {\n\t\t\treturn Object.keys(canvas.data);\n\t\t}\n\t\treturn [];\n\t}\n\n\teach(callback: (id: string) => boolean | void): string | null {\n\t\tconst canvas = this._diagram.canvas;\n\t\tif (canvas != null) {\n\t\t\tconst data = canvas.data;\n\t\t\tfor (const id in data) {\n\t\t\t\tif (callback(id) === false) {\n\t\t\t\t\treturn id;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tset(\n\t\tid: string,\n\t\tvalue: unknown,\n\t\ttime?: number,\n\t\tfrom?: number | null,\n\t\tto?: number | null\n\t): boolean {\n\t\tconst canvas = this._diagram.canvas;\n\t\tif (canvas != null) {\n\t\t\tconst datum = canvas.data[id];\n\t\t\tif (datum != null) {\n\t\t\t\tfor (let i = 0, imax = datum.length; i < imax; ++i) {\n\t\t\t\t\tconst datumValue = datum[i];\n\t\t\t\t\tconst range = datumValue.range;\n\n\t\t\t\t\t// Range\n\t\t\t\t\trange.set(from, to);\n\n\t\t\t\t\t// Time\n\t\t\t\t\tif (time !== undefined) {\n\t\t\t\t\t\tdatumValue.time = time;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Value\n\t\t\t\t\tdatumValue.value = value;\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tclear(id: string): boolean {\n\t\tconst canvas = this._diagram.canvas;\n\t\tif (canvas != null) {\n\t\t\tconst datum = canvas.data[id];\n\t\t\tif (datum != null) {\n\t\t\t\tfor (let i = 0, imax = datum.length; i < imax; ++i) {\n\t\t\t\t\tdatum[i].clear();\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tsetAll(\n\t\tid: string,\n\t\tvalues: unknown[],\n\t\ttimes?: number[],\n\t\tfrom?: number | null,\n\t\tto?: number | null\n\t): boolean {\n\t\tconst canvas = this._diagram.canvas;\n\t\tif (canvas != null) {\n\t\t\tconst datum = canvas.data[id];\n\t\t\tif (datum != null) {\n\t\t\t\tfor (let i = 0, imax = datum.length; i < imax; ++i) {\n\t\t\t\t\tconst datumValue = datum[i];\n\t\t\t\t\tconst range = datumValue.range;\n\n\t\t\t\t\t// Range\n\t\t\t\t\trange.set(from, to);\n\n\t\t\t\t\t// Time\n\t\t\t\t\tif (times !== undefined) {\n\t\t\t\t\t\tdatumValue.times = times;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Value\n\t\t\t\t\tdatumValue.values = values;\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tsetValue(id: string, value: unknown, time?: number): boolean {\n\t\tconst canvas = this._diagram.canvas;\n\t\tif (canvas != null) {\n\t\t\tconst datum = canvas.data[id];\n\t\t\tif (datum != null) {\n\t\t\t\tfor (let i = 0, imax = datum.length; i < imax; ++i) {\n\t\t\t\t\tconst datumValue = datum[i];\n\n\t\t\t\t\tif (time !== undefined) {\n\t\t\t\t\t\tdatumValue.time = time;\n\t\t\t\t\t}\n\n\t\t\t\t\tdatumValue.value = value;\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tsetValues(id: string, values: unknown[], times?: number[]): boolean {\n\t\tconst canvas = this._diagram.canvas;\n\t\tif (canvas != null) {\n\t\t\tconst datum = canvas.data[id];\n\t\t\tif (datum != null) {\n\t\t\t\tfor (let i = 0, imax = datum.length; i < imax; ++i) {\n\t\t\t\t\tconst datumValue = datum[i];\n\n\t\t\t\t\tif (times !== undefined) {\n\t\t\t\t\t\tdatumValue.times = times;\n\t\t\t\t\t}\n\n\t\t\t\t\tdatumValue.values = values;\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tsetTime(id: string, time: number): boolean {\n\t\tconst canvas = this._diagram.canvas;\n\t\tif (canvas != null) {\n\t\t\tconst datum = canvas.data[id];\n\t\t\tif (datum != null) {\n\t\t\t\tfor (let i = 0, imax = datum.length; i < imax; ++i) {\n\t\t\t\t\tdatum[i].time = time;\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tsetTimes(id: string, times: number[]): boolean {\n\t\tconst canvas = this._diagram.canvas;\n\t\tif (canvas != null) {\n\t\t\tconst datum = canvas.data[id];\n\t\t\tif (datum != null) {\n\t\t\t\tfor (let i = 0, imax = datum.length; i < imax; ++i) {\n\t\t\t\t\tdatum[i].times = times;\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tsetRange(id: string, from?: number | null, to?: number | null): boolean {\n\t\tconst canvas = this._diagram.canvas;\n\t\tif (canvas != null) {\n\t\t\tconst datum = canvas.data[id];\n\t\t\tif (datum != null) {\n\t\t\t\tfor (let i = 0, imax = datum.length; i < imax; ++i) {\n\t\t\t\t\tconst range = datum[i].range;\n\t\t\t\t\tif (from !== undefined) {\n\t\t\t\t\t\tif (from !== null) {\n\t\t\t\t\t\t\trange.type |= EShapeDataValueRangeType.FROM;\n\t\t\t\t\t\t\trange.from = from;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trange.type &= ~EShapeDataValueRangeType.FROM;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (to !== undefined) {\n\t\t\t\t\t\tif (to !== null) {\n\t\t\t\t\t\t\trange.type |= EShapeDataValueRangeType.TO;\n\t\t\t\t\t\t\trange.to = to;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trange.type &= ~EShapeDataValueRangeType.TO;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDiagramSnapshotCleanupOptions } from \"./d-diagram-snapshot\";\n\n/**\n * {@link DDiagramEditorThumbnail} options.\n */\nexport interface DDiagramEditorThumbnailOptions {\n\tenable?: boolean;\n\tsize?: number | null;\n\tcleanup?: boolean | DDiagramSnapshotCleanupOptions;\n}\n\n/**\n * {@link DDiagramEditorThumbnail} theme.\n */\nexport interface DThemeDiagramEditorThumbnail {\n\tisThumbnailEnabled(): boolean;\n\n\t/**\n\t * Returns a thumbnail maximum size.\n\t * If the size is null, a thumbnail size will be of a canvas size.\n\t */\n\tgetThumbnailSize(): number | null;\n}\n\nexport interface DDiagramEditorThumbnailSnapshot {\n\tcreateAsUrl(options: DDiagramEditorThumbnailSnapshotCreateAsUrlOptions): string | undefined;\n}\n\nexport interface DDiagramEditorThumbnailSnapshotCleanupOptions {\n\tsnap: boolean;\n\tbackground: boolean;\n}\n\nexport interface DDiagramEditorThumbnailSnapshotCreateAsUrlOptions {\n\tsize: number | null;\n\tcleanup: DDiagramEditorThumbnailSnapshotCleanupOptions;\n}\n\nexport class DDiagramEditorThumbnail {\n\tprotected _snapshot: DDiagramEditorThumbnailSnapshot;\n\tprotected _isEnabled: boolean;\n\tprotected _options: DDiagramEditorThumbnailSnapshotCreateAsUrlOptions;\n\n\tconstructor(\n\t\tsnapshot: DDiagramEditorThumbnailSnapshot,\n\t\ttheme: DThemeDiagramEditorThumbnail,\n\t\toptions?: DDiagramEditorThumbnailOptions\n\t) {\n\t\tthis._snapshot = snapshot;\n\t\tthis._isEnabled = this.toIsEnabled(theme, options);\n\t\tthis._options = this.toCreateAsUrlOptions(theme, options);\n\t}\n\n\tprotected toIsEnabled(\n\t\ttheme: DThemeDiagramEditorThumbnail,\n\t\toptions?: DDiagramEditorThumbnailOptions\n\t): boolean {\n\t\treturn options?.enable ?? theme.isThumbnailEnabled();\n\t}\n\n\tprotected toSize(theme: DThemeDiagramEditorThumbnail, options?: number | null): number | null {\n\t\treturn options !== undefined ? options : theme.getThumbnailSize();\n\t}\n\n\tprotected toCleanup(\n\t\ttheme: DThemeDiagramEditorThumbnail,\n\t\tcleanup?: boolean | DDiagramSnapshotCleanupOptions\n\t): DDiagramEditorThumbnailSnapshotCleanupOptions {\n\t\tif (cleanup == null || cleanup === true) {\n\t\t\treturn {\n\t\t\t\tsnap: true,\n\t\t\t\tbackground: true\n\t\t\t};\n\t\t} else if (cleanup === false) {\n\t\t\treturn {\n\t\t\t\tsnap: false,\n\t\t\t\tbackground: false\n\t\t\t};\n\t\t}\n\t\treturn {\n\t\t\tsnap: cleanup.snap ?? true,\n\t\t\tbackground: cleanup.background ?? true\n\t\t};\n\t}\n\n\tprotected toCreateAsUrlOptions(\n\t\ttheme: DThemeDiagramEditorThumbnail,\n\t\toptions?: DDiagramEditorThumbnailOptions\n\t): DDiagramEditorThumbnailSnapshotCreateAsUrlOptions {\n\t\treturn {\n\t\t\tsize: this.toSize(theme, options?.size),\n\t\t\tcleanup: this.toCleanup(theme, options?.cleanup)\n\t\t};\n\t}\n\n\tget enable(): boolean {\n\t\treturn this._isEnabled;\n\t}\n\n\tset enable(enable: boolean) {\n\t\tthis._isEnabled = enable;\n\t}\n\n\tget size(): number | null {\n\t\treturn this._options.size;\n\t}\n\n\tset size(size: number | null) {\n\t\tthis._options.size = size;\n\t}\n\n\tget cleanup(): DDiagramEditorThumbnailSnapshotCleanupOptions {\n\t\treturn this._options.cleanup;\n\t}\n\n\tserialize(): string | undefined {\n\t\tif (this._isEnabled) {\n\t\t\treturn this._snapshot.createAsUrl(this._options);\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DControllerDocument } from \"./d-controller-document\";\nimport { DControllers } from \"./d-controllers\";\nimport {\n\tDDiagramBase,\n\tDDiagramBaseController,\n\tDDiagramBaseEvents,\n\tDDiagramBaseOptions,\n\tDDiagramBasePieceController,\n\tDThemeDiagramBase\n} from \"./d-diagram-base\";\nimport { DDiagramCanvasEditor, DDiagramCanvasEditorOptions } from \"./d-diagram-canvas-editor\";\nimport {\n\tDDiagramEditorThumbnail,\n\tDDiagramEditorThumbnailOptions,\n\tDThemeDiagramEditorThumbnail\n} from \"./d-diagram-editor-thumbnail\";\nimport {\n\tDDiagramSerialized,\n\tDDiagramSerializedSimple,\n\tDDiagramSerializedVersion\n} from \"./d-diagram-serialized\";\nimport { DDiagrams } from \"./d-diagrams\";\nimport { DOnOptions } from \"./d-on-options\";\nimport { ESnapper } from \"./snapper/e-snapper\";\n\n/**\n * {@link DDiagramEditor} piece controller.\n */\nexport interface DDiagramEditorPieceController extends DDiagramBasePieceController {}\n\n/**\n * {@link DDiagramEditor} controller.\n */\nexport interface DDiagramEditorController extends DDiagramBaseController {\n\tget(id: number): Promise<DDiagramSerializedSimple | DDiagramSerialized>;\n\tsave(simple: DDiagramSerializedSimple): Promise<number>;\n\tdelete(id: number): Promise<void>;\n}\n\n/**\n * {@link DDiagramEditor} events.\n */\nexport interface DDiagramEditorEvents<EMITTER>\n\textends DDiagramBaseEvents<DDiagramCanvasEditor, EMITTER> {\n\t/**\n\t * Triggered when a serialized data is changed without using the set / unset methods.\n\t * This happens, for instance, when the name or the ID of the serialized data is changed.\n\t *\n\t * @param emitter an emitter\n\t */\n\tchange(emitter: EMITTER): void;\n\n\t/**\n\t * Triggered before serializing a canvas.\n\t *\n\t * @param canvas a canvas\n\t * @param emitter an emitter\n\t */\n\tserializing(canvas: DDiagramCanvasEditor, emitter: EMITTER): void;\n\n\t/**\n\t * Triggered when serialized successfully or when failed to serialize.\n\t *\n\t * @param reason Null if succeeded. Otherwise, a string representing a reason why failed.\n\t * @param emitter an emitter\n\t */\n\tserialized(canvas: DDiagramCanvasEditor, reason: string | null, emitter: EMITTER): void;\n\n\t/**\n\t * Triggered before saving.\n\t *\n\t * @param simple a serialized data\n\t * @param emitter an emitter\n\t */\n\tsaving(simple: DDiagramSerializedSimple, emitter: EMITTER): void;\n\n\t/**\n\t * Triggered when saved successfully or when failed to save.\n\t *\n\t * @param reason Null if succeeded. Otherwise, a string representing a reason why failed.\n\t * @param emitter an emitter\n\t */\n\tsaved(reason: string | null, emitter: EMITTER): void;\n\n\t/**\n\t * Triggered before opening.\n\t *\n\t * @param emitter an emitter\n\t */\n\topening(emitter: EMITTER): void;\n\n\t/**\n\t * Triggered when opened successfully or when failed to open.\n\t *\n\t * @param reason Null if succeeded. Otherwise, a string representing a reason why failed.\n\t * @param emitter an emitter\n\t */\n\topened(reason: string | null, emitter: EMITTER): void;\n\n\t/**\n\t * Triggered before deleting.\n\t *\n\t * @param emitter an emitter\n\t */\n\tdeleting(emitter: EMITTER): void;\n\n\t/**\n\t * Triggered when deleted successfully or when failed to delete.\n\t *\n\t * @param reason Null if succeeded. Otherwise, a string representing a reason why failed.\n\t * @param emitter an emitter.\n\t */\n\tdeleted(reason: string | null, emitter: EMITTER): void;\n}\n\n/**\n * {@link DDiagramEditor} \"on\" options.\n */\nexport interface DDiagramEditorOnOptions<EMITTER>\n\textends Partial<DDiagramEditorEvents<EMITTER>>,\n\t\tDOnOptions {}\n\n/**\n * {@link DDiagramEditor} options.\n */\nexport interface DDiagramEditorOptions<\n\tTHEME extends DThemeDiagramEditor = DThemeDiagramEditor,\n\tEMITTER = any\n> extends DDiagramBaseOptions<\n\t\tDDiagramCanvasEditor,\n\t\tDDiagramCanvasEditorOptions,\n\t\tDDiagramEditorController,\n\t\tTHEME\n\t> {\n\tcontroller?: DDiagramEditorController;\n\ton?: DDiagramEditorOnOptions<EMITTER>;\n\tthumbnail?: DDiagramEditorThumbnailOptions;\n}\n\n/**\n * {@link DDiagramEditor} theme.\n */\nexport interface DThemeDiagramEditor extends DThemeDiagramBase, DThemeDiagramEditorThumbnail {}\n\nexport class DDiagramEditor<\n\t\tTHEME extends DThemeDiagramEditor = DThemeDiagramEditor,\n\t\tOPTIONS extends DDiagramEditorOptions<THEME> = DDiagramEditorOptions<THEME>\n\t>\n\textends DDiagramBase<\n\t\tDDiagramCanvasEditor,\n\t\tDDiagramCanvasEditorOptions,\n\t\tDDiagramEditorController,\n\t\tTHEME,\n\t\tOPTIONS\n\t>\n\timplements DControllerDocument<DDiagramSerialized>\n{\n\tprotected _isChanged: boolean = false;\n\tprotected _snapper: ESnapper;\n\tprotected _thumbnail: DDiagramEditorThumbnail;\n\n\tconstructor(options?: OPTIONS) {\n\t\tsuper(options);\n\t\tthis._isChanged = false;\n\n\t\tconst commands = DControllers.getCommandController();\n\t\tcommands.on(\"dirty\", (): void => {\n\t\t\tif (this._isChanged !== true) {\n\t\t\t\tthis._isChanged = true;\n\t\t\t\tthis.emit(\"change\", this);\n\t\t\t}\n\t\t});\n\n\t\tthis._snapper = new ESnapper(this);\n\t\tthis._thumbnail = new DDiagramEditorThumbnail(\n\t\t\tthis._snapshot,\n\t\t\tthis.theme,\n\t\t\toptions?.thumbnail\n\t\t);\n\t}\n\n\tget thumbnail(): DDiagramEditorThumbnail {\n\t\treturn this._thumbnail;\n\t}\n\n\tget snapper(): ESnapper {\n\t\treturn this._snapper;\n\t}\n\n\tprotected isEditMode(): boolean {\n\t\treturn true;\n\t}\n\n\tprotected newCanvas(serialized: DDiagramSerialized): DDiagramCanvasEditor {\n\t\treturn new DDiagramCanvasEditor(this.toCanvasOptions(serialized));\n\t}\n\n\tprotected toCanvasOptions(serialized: DDiagramSerialized): DDiagramCanvasEditorOptions {\n\t\tconst options: DDiagramCanvasEditorOptions = this.toCanvasBaseOptions(serialized);\n\n\t\t// Snapper\n\t\tconst snapper = this._snapper;\n\t\tconst snap = options.snap;\n\t\tif (snap == null) {\n\t\t\toptions.snap = {\n\t\t\t\tcontroller: snapper\n\t\t\t};\n\t\t} else if (snap.controller == null) {\n\t\t\tsnap.controller = snapper;\n\t\t}\n\n\t\treturn options;\n\t}\n\n\tserialize(): DDiagramSerialized | null {\n\t\tconst canvas = this.canvas;\n\t\tconst serialized = this._serialized;\n\t\tif (canvas != null && serialized != null) {\n\t\t\tthis.emit(\"serializing\", canvas, this);\n\t\t\ttry {\n\t\t\t\tconst result = canvas.serialize(serialized.id, this._thumbnail);\n\t\t\t\tthis.emit(\"serialized\", canvas, null, this);\n\t\t\t\treturn result;\n\t\t\t} catch (e) {\n\t\t\t\tthis.emit(\"serialized\", canvas, \"exception\", this);\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tsave(): Promise<unknown> {\n\t\tconst serialized = this.serialize();\n\t\tif (serialized != null) {\n\t\t\tconst controller = this._controller;\n\t\t\tif (controller) {\n\t\t\t\tconst simple = DDiagrams.toSimple(serialized);\n\t\t\t\tthis.emit(\"saving\", simple, this);\n\t\t\t\treturn controller.save(simple).then(\n\t\t\t\t\t(newId: number): void => {\n\t\t\t\t\t\tthis._isChanged = false;\n\t\t\t\t\t\tserialized.id = newId;\n\t\t\t\t\t\tthis._serialized = serialized;\n\t\t\t\t\t\tthis.emit(\"change\", this);\n\t\t\t\t\t\tthis.emit(\"saved\", null, this);\n\t\t\t\t\t},\n\t\t\t\t\t(reason: string): void => {\n\t\t\t\t\t\tthis.emit(\"saved\", reason, this);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tthis.emit(\"saved\", \"no-controller\", this);\n\t\t\t\treturn Promise.reject();\n\t\t\t}\n\t\t}\n\t\tthis.emit(\"saved\", null, this);\n\t\treturn Promise.resolve();\n\t}\n\n\tsaveAs(name: string): Promise<unknown> {\n\t\tconst serialized = this.serialize();\n\t\tif (serialized != null) {\n\t\t\tconst controller = this._controller;\n\t\t\tif (controller) {\n\t\t\t\tserialized.id = undefined;\n\t\t\t\tserialized.name = name;\n\t\t\t\tconst simple = DDiagrams.toSimple(serialized);\n\t\t\t\tthis.emit(\"saving\", simple, this);\n\t\t\t\treturn controller.save(simple).then(\n\t\t\t\t\t(newId: number): void => {\n\t\t\t\t\t\tthis._isChanged = false;\n\t\t\t\t\t\tserialized.id = newId;\n\t\t\t\t\t\tthis._serialized = serialized;\n\t\t\t\t\t\tconst canvas = this.canvas;\n\t\t\t\t\t\tif (canvas != null) {\n\t\t\t\t\t\t\tcanvas.name = name;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.emit(\"change\", this);\n\t\t\t\t\t\tthis.emit(\"saved\", null, this);\n\t\t\t\t\t},\n\t\t\t\t\t(reason: string): void => {\n\t\t\t\t\t\tthis.emit(\"saved\", reason, this);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tthis.emit(\"saved\", \"no-controller\", this);\n\t\t\t\treturn Promise.reject(\"no-controller\");\n\t\t\t}\n\t\t}\n\t\tthis.emit(\"saved\", null, this);\n\t\treturn Promise.resolve();\n\t}\n\n\tdelete(): Promise<unknown> {\n\t\tconst serialized = this._serialized;\n\t\tif (serialized && serialized.id != null) {\n\t\t\tconst controller = this._controller;\n\t\t\tif (controller) {\n\t\t\t\tthis.emit(\"deleting\", this);\n\t\t\t\treturn controller.delete(serialized.id).then(\n\t\t\t\t\t(): void => {\n\t\t\t\t\t\tthis.set(null);\n\t\t\t\t\t\tthis.emit(\"deleted\", this);\n\t\t\t\t\t},\n\t\t\t\t\t(reason: string): void => {\n\t\t\t\t\t\tthis.emit(\"deleted\", reason, this);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tthis.emit(\"deleted\", \"no-controller\", this);\n\t\t\t\treturn Promise.reject(\"no-controller\");\n\t\t\t}\n\t\t}\n\t\tthis.set(null);\n\t\tthis.emit(\"deleted\", null, this);\n\t\treturn Promise.resolve();\n\t}\n\n\tcreate(name: string, width: number, height: number): void {\n\t\tthis.set({\n\t\t\tversion: DDiagramSerializedVersion,\n\t\t\tid: undefined,\n\t\t\tname,\n\t\t\twidth,\n\t\t\theight,\n\t\t\tresources: [],\n\t\t\tdata: [],\n\t\t\tlayers: [[\"Default layer\"]],\n\t\t\titems: [],\n\t\t\tsnap: undefined\n\t\t});\n\t}\n\n\tprotected onSet(serialized: DDiagramSerialized): void {\n\t\tsuper.onSet(serialized);\n\n\t\t// Snap settings\n\t\tconst snap = serialized.snap;\n\t\tconst snapper = this._snapper;\n\t\tif (snap != null) {\n\t\t\tsnapper.deserialize(snap);\n\t\t} else {\n\t\t\tsnapper.reset();\n\t\t}\n\t\tif (this._isAmbient) {\n\t\t\tsnapper.target.visible = false;\n\t\t\tsnapper.grid.visible = false;\n\t\t}\n\n\t\t// Reset the isChanged flag\n\t\tthis._isChanged = false;\n\n\t\t// Done\n\t\tthis.emit(\"change\", this);\n\t}\n\n\tprotected onUnset(): void {\n\t\tsuper.onUnset();\n\t\tthis._isChanged = false;\n\t\tthis.emit(\"change\", this);\n\t}\n\n\topen(id: number): Promise<unknown> {\n\t\tconst controller = this._controller;\n\t\tif (controller) {\n\t\t\tthis.emit(\"opening\", this);\n\t\t\treturn controller.get(id).then(\n\t\t\t\t(serialized: DDiagramSerializedSimple | DDiagramSerialized): void => {\n\t\t\t\t\tthis.set(DDiagrams.toSerialized(serialized));\n\t\t\t\t\tthis.emit(\"opened\", null, this);\n\t\t\t\t},\n\t\t\t\t(reason: string): void => {\n\t\t\t\t\tthis.emit(\"opened\", reason, this);\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t\tthis.emit(\"opened\", \"no-controller\", this);\n\t\treturn Promise.reject(\"no-controller\");\n\t}\n\n\tclose(): void {\n\t\tthis.set(null);\n\t}\n\n\tisChanged(): boolean {\n\t\treturn this._isChanged || this.isNew();\n\t}\n\n\tisNew(): boolean {\n\t\tconst serialized = this._serialized;\n\t\tif (serialized != null) {\n\t\t\treturn serialized.id == null;\n\t\t}\n\t\treturn false;\n\t}\n\n\tgetName(): string | null {\n\t\tconst serialized = this._serialized;\n\t\tif (serialized != null) {\n\t\t\treturn serialized.name;\n\t\t}\n\t\treturn null;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DDiagramEditor\";\n\t}\n}\n","/*\n * Copyright (C) 2021 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Renderer, utils } from \"pixi.js\";\nimport { DApplicationTarget } from \"./d-application-like\";\nimport { DApplications } from \"./d-applications\";\nimport { DDiagramCanvasIdMap } from \"./d-diagram-canvas-id-map\";\nimport { EShape } from \"./shape/e-shape\";\n\nexport interface DDiagramShapeLayer {\n\tchildren: EShape[];\n}\n\nexport interface DDiagramShapeLayerContainer {\n\tchildren: DDiagramShapeLayer[];\n}\n\nexport interface DDiagramShapeCanvas {\n\tlayer: DDiagramShapeLayerContainer;\n\tids: DDiagramCanvasIdMap;\n\tactionables: EShape[];\n}\n\nexport interface DDiagramShapeDiagram extends DApplicationTarget {\n\tcanvas: DDiagramShapeCanvas | null;\n}\n\n/**\n * A shape helper class for diagrams.\n */\nexport class DDiagramShape extends utils.EventEmitter {\n\tprotected _diagram: DDiagramShapeDiagram;\n\tprotected _updateBound: () => void;\n\n\tconstructor(diagram: DDiagramShapeDiagram) {\n\t\tsuper();\n\t\tthis._diagram = diagram;\n\t\tthis._updateBound = (): void => {\n\t\t\tDApplications.update(diagram);\n\t\t};\n\t}\n\n\tupdate(): void {\n\t\tconst diagram = this._diagram;\n\t\tconst canvas = diagram.canvas;\n\t\tif (canvas) {\n\t\t\tconst actionables = canvas.actionables;\n\t\t\tif (0 < actionables.length) {\n\t\t\t\tlet effect = -1;\n\t\t\t\tconst time = Date.now();\n\t\t\t\tfor (let i = 0, imax = actionables.length; i < imax; ++i) {\n\t\t\t\t\tconst actionable = actionables[i];\n\t\t\t\t\tactionable.update(time);\n\t\t\t\t\tconst runtime = actionable.runtime;\n\t\t\t\t\tif (runtime && time < runtime.effect) {\n\t\t\t\t\t\tconst runtimeEffect = runtime.effect;\n\t\t\t\t\t\tif (time < runtimeEffect) {\n\t\t\t\t\t\t\teffect = effect < 0 ? runtimeEffect : Math.min(effect, runtimeEffect);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (0 <= effect) {\n\t\t\t\t\tsetTimeout(this._updateBound, effect - Date.now());\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tonRender(renderer: Renderer): void {\n\t\tconst diagram = this._diagram;\n\t\tconst canvas = diagram.canvas;\n\t\tif (canvas) {\n\t\t\tconst actionables = canvas.actionables;\n\t\t\tif (0 < actionables.length) {\n\t\t\t\tlet effect = -1;\n\t\t\t\tconst time = Date.now();\n\t\t\t\tfor (let i = 0, imax = actionables.length; i < imax; ++i) {\n\t\t\t\t\tconst actionable = actionables[i];\n\t\t\t\t\tactionable.onRender(time, renderer);\n\t\t\t\t\tconst runtime = actionable.runtime;\n\t\t\t\t\tif (runtime && time < runtime.effect) {\n\t\t\t\t\t\tconst runtimeEffect = runtime.effect;\n\t\t\t\t\t\tif (time < runtimeEffect) {\n\t\t\t\t\t\t\teffect = effect < 0 ? runtimeEffect : Math.min(effect, runtimeEffect);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (0 <= effect) {\n\t\t\t\t\tsetTimeout(this._updateBound, effect - Date.now());\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tget(id: string): EShape | null {\n\t\tconst shapes = this._diagram.canvas?.ids[id];\n\t\treturn shapes && 0 < shapes.length ? shapes[0] : null;\n\t}\n\n\tgetAll(id: string): EShape[] {\n\t\treturn this._diagram.canvas?.ids[id] || [];\n\t}\n\n\teach(callback: (shape: EShape) => boolean | void, reverse = false): EShape | null {\n\t\tconst canvas = this._diagram.canvas;\n\t\tif (canvas != null) {\n\t\t\tconst layers = canvas.layer.children;\n\t\t\tif (!reverse) {\n\t\t\t\tfor (let i = 0, imax = layers.length; i < imax; ++i) {\n\t\t\t\t\tconst layer = layers[i];\n\t\t\t\t\tconst children = layer.children;\n\t\t\t\t\tfor (let j = 0, jmax = children.length; j < jmax; ++j) {\n\t\t\t\t\t\tconst child = children[j];\n\t\t\t\t\t\tif (callback(child) === false) {\n\t\t\t\t\t\t\treturn child;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (let i = layers.length - 1; 0 <= i; --i) {\n\t\t\t\t\tconst layer = layers[i];\n\t\t\t\t\tconst children = layer.children;\n\t\t\t\t\tfor (let j = children.length - 1; 0 <= j; --j) {\n\t\t\t\t\t\tconst child = children[j];\n\t\t\t\t\t\tif (callback(child) === false) {\n\t\t\t\t\t\t\treturn child;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction, Renderer } from \"pixi.js\";\nimport {\n\tDDiagramBase,\n\tDDiagramBaseController,\n\tDDiagramBaseOptions,\n\tDDiagramBasePieceController,\n\tDThemeDiagramBase\n} from \"./d-diagram-base\";\nimport { DDiagramCanvas, DDiagramCanvasOptions } from \"./d-diagram-canvas\";\nimport { DDiagramSerialized } from \"./d-diagram-serialized\";\nimport { DDiagramShape } from \"./d-diagram-shape\";\nimport { DDiagramData, DDiagramDataMapper, DDiagramDataOptions } from \"./d-diagram-data\";\nimport { EShapeActionRuntime } from \"./shape/action/e-shape-action-runtime\";\nimport { EShapeActionRuntimeOpen } from \"./shape/action/e-shape-action-runtime-open\";\nimport { EShapeActionValue } from \"./shape/action/e-shape-action-value\";\nimport { EShape } from \"./shape/e-shape\";\nimport { EShapeRuntime } from \"./shape/e-shape-runtime\";\nimport { EShapeRuntimes } from \"./shape/e-shape-runtimes\";\nimport { EShapeType } from \"./shape/e-shape-type\";\nimport { UtilPointerEvent } from \"./util/util-pointer-event\";\n\n/**\n * {@link DDiagram} piece controller.\n */\nexport interface DDiagramPieceController extends DDiagramBasePieceController {}\n\n/**\n * {@link DDiagram} controller.\n */\nexport interface DDiagramController extends DDiagramBaseController {}\n\n/**\n * {@link DDiagram} options.\n */\nexport interface DDiagramOptions<THEME extends DThemeDiagram = DThemeDiagram, EMITTER = any>\n\textends DDiagramBaseOptions<\n\t\tDDiagramCanvas,\n\t\tDDiagramCanvasOptions,\n\t\tDDiagramController,\n\t\tTHEME,\n\t\tEMITTER\n\t> {\n\t/** @deprecated in favor of {@link data} */\n\ttag?: DDiagramDataOptions;\n\tdata?: DDiagramDataOptions;\n}\n\n/**\n * {@link DDiagram} theme.\n */\nexport interface DThemeDiagram extends DThemeDiagramBase {}\n\nexport class DDiagram<\n\tTHEME extends DThemeDiagram = DThemeDiagram,\n\tOPTIONS extends DDiagramOptions<THEME> = DDiagramOptions<THEME>\n> extends DDiagramBase<DDiagramCanvas, DDiagramCanvasOptions, DDiagramController, THEME, OPTIONS> {\n\t/** @deprecated in favor of {@link data} */\n\ttag: DDiagramData;\n\tdata: DDiagramData;\n\tshape: DDiagramShape;\n\n\tconstructor(options?: OPTIONS) {\n\t\tsuper(options);\n\n\t\tthis.on(UtilPointerEvent.move, (e: interaction.InteractionEvent): void => {\n\t\t\tconst canvas = this.canvas;\n\t\t\tif (canvas) {\n\t\t\t\tcanvas.onShapeMove(e);\n\t\t\t}\n\t\t});\n\n\t\tthis.on(UtilPointerEvent.up, (e: interaction.InteractionEvent): void => {\n\t\t\tconst canvas = this.canvas;\n\t\t\tif (canvas) {\n\t\t\t\tcanvas.onShapeUp(e);\n\t\t\t}\n\t\t});\n\n\t\tthis.on(UtilPointerEvent.upoutside, (e: interaction.InteractionEvent): void => {\n\t\t\tconst canvas = this.canvas;\n\t\t\tif (canvas) {\n\t\t\t\tcanvas.onShapeCancel(e);\n\t\t\t}\n\t\t});\n\n\t\tthis.on(UtilPointerEvent.cancel, (e: interaction.InteractionEvent): void => {\n\t\t\tconst canvas = this.canvas;\n\t\t\tif (canvas) {\n\t\t\t\tcanvas.onShapeCancel(e);\n\t\t\t}\n\t\t});\n\n\t\tUtilPointerEvent.onClick(this, (e: interaction.InteractionEvent): void => {\n\t\t\tconst canvas = this.canvas;\n\t\t\tif (canvas) {\n\t\t\t\tcanvas.onShapeClick(e);\n\t\t\t}\n\t\t});\n\n\t\t//\n\t\tconst data = new DDiagramData(this, options && (options.data || options.tag));\n\t\tthis.data = data;\n\t\tthis.tag = data;\n\t\tthis.shape = new DDiagramShape(this);\n\t}\n\n\tprotected initialize(shapes: EShape[]): void {\n\t\tthis.initializeShapes(shapes, null, this.data.mapper);\n\t}\n\n\tprotected initializeShapes(\n\t\tshapes: EShape[],\n\t\tdataShape: EShape | null,\n\t\tdataMapper: DDiagramDataMapper | null\n\t): void {\n\t\tconst formatterMap: Record<string, (value: unknown) => unknown> = {};\n\t\tconst initialMap: Record<string, unknown | undefined> = {};\n\t\tconst actionMap: Map<EShapeActionValue, EShapeActionRuntime> = new Map<\n\t\t\tEShapeActionValue,\n\t\t\tEShapeActionRuntime\n\t\t>();\n\n\t\tfor (let i = 0, imax = shapes.length; i < imax; ++i) {\n\t\t\tconst shape = shapes[i];\n\t\t\tconst runtimeConstructor = EShapeRuntimes[shape.type] || EShapeRuntime;\n\t\t\tconst runtime = (shape.runtime = new runtimeConstructor(shape));\n\n\t\t\t// Data\n\t\t\tconst shapeData = shape.data;\n\t\t\tfor (let j = 0, jmax = shapeData.size(); j < jmax; ++j) {\n\t\t\t\tconst shapeDatum = shapeData.get(j);\n\t\t\t\tif (shapeDatum) {\n\t\t\t\t\t// Mapping\n\t\t\t\t\tif (dataMapper) {\n\t\t\t\t\t\tdataMapper(shapeDatum, dataShape || shape);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Format\n\t\t\t\t\tconst datumFormat = shapeDatum.format;\n\t\t\t\t\tconst datumInitial = shapeDatum.initial;\n\t\t\t\t\tif (datumFormat in formatterMap) {\n\t\t\t\t\t\tshapeDatum.formatter = formatterMap[datumFormat];\n\t\t\t\t\t} else if (0 < datumFormat.length) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst formatter = Function(\n\t\t\t\t\t\t\t\t\"value\",\n\t\t\t\t\t\t\t\t/* eslint-disable prettier/prettier */\n\t\t\t\t\t\t\t\t`try {` +\n\t\t\t\t\t\t\t\t\t`return (${datumFormat});` +\n\t\t\t\t\t\t\t\t`} catch( e1 ) {` +\n\t\t\t\t\t\t\t\t\t`try {` +\n\t\t\t\t\t\t\t\t\t\t`return (${0 < datumInitial.length ? datumInitial : 0});` +\n\t\t\t\t\t\t\t\t\t`} catch( e2 ) {` +\n\t\t\t\t\t\t\t\t\t\t`return 0;` +\n\t\t\t\t\t\t\t\t\t`}` +\n\t\t\t\t\t\t\t\t`}`\n\t\t\t\t\t\t\t\t/* eslint-enable prettier/prettier */\n\t\t\t\t\t\t\t) as any;\n\t\t\t\t\t\t\tformatterMap[datumFormat] = formatter;\n\t\t\t\t\t\t\tshapeDatum.formatter = formatter;\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t//\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Initial\n\t\t\t\t\tif (datumInitial in initialMap) {\n\t\t\t\t\t\tshapeDatum.value = initialMap[datumInitial];\n\t\t\t\t\t} else if (0 < datumInitial.length) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tshapeDatum.value = initialMap[datumInitial] = Function(\n\t\t\t\t\t\t\t\t/* eslint-disable prettier/prettier */\n\t\t\t\t\t\t\t\t`try {` +\n\t\t\t\t\t\t\t\t\t`return (${datumInitial});` +\n\t\t\t\t\t\t\t\t`} catch( e ) {` +\n\t\t\t\t\t\t\t\t\t`return 0;` +\n\t\t\t\t\t\t\t\t`}`\n\t\t\t\t\t\t\t\t/* eslint-enable prettier/prettier */\n\t\t\t\t\t\t\t)();\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t//\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Initialize runtime actions\n\t\t\tconst values = shape.action.values;\n\t\t\tconst actions = runtime.actions;\n\t\t\tfor (let j = 0, jmax = values.length; j < jmax; ++j) {\n\t\t\t\tconst value = values[j];\n\t\t\t\tlet action: EShapeActionRuntime | undefined | null = actionMap.get(value);\n\t\t\t\tif (action == null) {\n\t\t\t\t\taction = value.toRuntime();\n\t\t\t\t\tif (action != null) {\n\t\t\t\t\t\tif (action instanceof EShapeActionRuntimeOpen) {\n\t\t\t\t\t\t\tif (shape.cursor.length <= 0) {\n\t\t\t\t\t\t\t\tshape.cursor = \"pointer\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tactionMap.set(value, action);\n\t\t\t\t\t\tactions.push(action);\n\t\t\t\t\t\truntime.reset |= action.reset;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tactions.push(action);\n\t\t\t\t\truntime.reset |= action.reset;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Children\n\t\t\tconst children = shape.children;\n\t\t\tif (0 < children.length) {\n\t\t\t\tthis.initializeShapes(children, this.toDataShape(dataShape, shape), dataMapper);\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected toDataShape(dataShape: EShape | null, shape: EShape): EShape | null {\n\t\tif (dataShape != null) {\n\t\t\treturn dataShape;\n\t\t}\n\t\tif (shape.type === EShapeType.EMBEDDED) {\n\t\t\treturn shape;\n\t\t}\n\t\treturn null;\n\t}\n\n\tprotected isEditMode(): boolean {\n\t\treturn false;\n\t}\n\n\tprotected newCanvas(serialized: DDiagramSerialized): DDiagramCanvas {\n\t\treturn new DDiagramCanvas(this.toCanvasOptions(serialized));\n\t}\n\n\tprotected toCanvasOptions(serialized: DDiagramSerialized): DDiagramCanvasOptions {\n\t\treturn this.toCanvasBaseOptions(serialized);\n\t}\n\n\tprotected onDown(e: interaction.InteractionEvent): void {\n\t\tsuper.onDown(e, this.canvas?.onShapeDown(e));\n\t}\n\n\tonDblClick(\n\t\te: MouseEvent | TouchEvent,\n\t\tinteractionManager: interaction.InteractionManager\n\t): boolean {\n\t\treturn super.onDblClick(\n\t\t\te,\n\t\t\tinteractionManager,\n\t\t\tthis.canvas?.onShapeDblClick(e, interactionManager)\n\t\t);\n\t}\n\n\trender(renderer: Renderer): void {\n\t\tthis.shape.onRender(renderer);\n\t\tsuper.render(renderer);\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DDiagram\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DImage, DImageOptions, DThemeImage } from \"./d-image\";\n\nexport interface DDialogConfirmMessageOptions<\n\tTHEME extends DThemeDialogConfirmMessage = DThemeDialogConfirmMessage\n> extends DImageOptions<string, THEME> {}\n\nexport interface DThemeDialogConfirmMessage extends DThemeImage<string> {}\n\nexport class DDialogConfirmMessage<\n\tTHEME extends DThemeDialogConfirmMessage = DThemeDialogConfirmMessage,\n\tOPTIONS extends DDialogConfirmMessageOptions<THEME> = DDialogConfirmMessageOptions<THEME>\n> extends DImage<string, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DDialogConfirmMessage\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBase } from \"./d-base\";\nimport { DDialogCommand, DDialogCommandOptions, DThemeDialogCommand } from \"./d-dialog-command\";\nimport { DDialogConfirmMessage, DDialogConfirmMessageOptions } from \"./d-dialog-confirm-message\";\nimport { DLayoutVertical } from \"./d-layout-vertical\";\nimport { DStateAwareOrValue } from \"./d-state-aware\";\nimport { isFunction } from \"./util/is-function\";\nimport { isString } from \"./util/is-string\";\n\nexport interface DDialogConfirmOptions<THEME extends DThemeDialogConfirm = DThemeDialogConfirm>\n\textends DDialogCommandOptions<void, THEME> {\n\tmessage?: DStateAwareOrValue<string> | DDialogConfirmMessageOptions | DDialogConfirmMessage;\n}\n\nexport interface DThemeDialogConfirm extends DThemeDialogCommand {\n\tgetMessage(): DStateAwareOrValue<string>;\n}\n\nexport class DDialogConfirm<\n\tTHEME extends DThemeDialogConfirm = DThemeDialogConfirm,\n\tOPTIONS extends DDialogConfirmOptions<THEME> = DDialogConfirmOptions<THEME>\n> extends DDialogCommand<void, THEME, OPTIONS> {\n\tprotected _message?: DDialogConfirmMessage;\n\n\tprotected onInit(layout: DLayoutVertical, options?: OPTIONS): void {\n\t\tsuper.onInit(layout, options);\n\t\tlayout.addChild(this.message);\n\t}\n\n\tprotected toMessage(theme: THEME, options?: OPTIONS): DDialogConfirmMessage {\n\t\tconst message = options?.message;\n\t\tif (message != null) {\n\t\t\tif (isString(message) || isFunction(message)) {\n\t\t\t\treturn this.newMessage(this.toMessageOptions(message));\n\t\t\t} else if (message instanceof DBase) {\n\t\t\t\treturn message;\n\t\t\t} else {\n\t\t\t\treturn this.newMessage(this.toMessageOptionsMerged(message, theme.getMessage()));\n\t\t\t}\n\t\t}\n\t\treturn this.newMessage(this.toMessageOptions(theme.getMessage()));\n\t}\n\n\tprotected toMessageOptionsMerged(\n\t\toptions: DDialogConfirmMessageOptions,\n\t\tmessage: DStateAwareOrValue<string>\n\t): DDialogConfirmMessageOptions {\n\t\tlet text = options.text;\n\t\tif (text == null) {\n\t\t\ttext = {};\n\t\t\toptions.text = text;\n\t\t}\n\t\tif (text.value === undefined) {\n\t\t\ttext.value = message;\n\t\t}\n\t\treturn options;\n\t}\n\n\tprotected toMessageOptions(message: DStateAwareOrValue<string>): DDialogConfirmMessageOptions {\n\t\treturn {\n\t\t\ttext: {\n\t\t\t\tvalue: message\n\t\t\t}\n\t\t};\n\t}\n\n\tprotected newMessage(options: DDialogConfirmMessageOptions): DDialogConfirmMessage {\n\t\treturn new DDialogConfirmMessage(options);\n\t}\n\n\tget message(): DDialogConfirmMessage {\n\t\tlet result = this._message;\n\t\tif (result == null) {\n\t\t\tresult = this.toMessage(this.theme, this._options);\n\t\t\tthis._message = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected getResolvedValue(): void | PromiseLike<void> {\n\t\treturn undefined;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DDialogConfirm\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDialogConfirm, DDialogConfirmOptions, DThemeDialogConfirm } from \"./d-dialog-confirm\";\n\nexport interface DDialogConfirmDeleteOptions<THEME extends DThemeDialogConfirm>\n\textends DDialogConfirmOptions<THEME> {}\n\nexport interface DThemeDialogConfirmDelete extends DThemeDialogConfirm {}\n\nexport class DDialogConfirmDelete<\n\tTHEME extends DThemeDialogConfirm = DThemeDialogConfirm,\n\tOPTIONS extends DDialogConfirmDeleteOptions<THEME> = DDialogConfirmDeleteOptions<THEME>\n> extends DDialogConfirm<THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DDialogConfirmDelete\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDialogConfirm, DDialogConfirmOptions, DThemeDialogConfirm } from \"./d-dialog-confirm\";\n\nexport interface DDialogConfirmDiscardOptions<THEME extends DThemeDialogConfirm>\n\textends DDialogConfirmOptions<THEME> {}\n\nexport interface DThemeDialogConfirmDiscard extends DThemeDialogConfirm {}\n\nexport class DDialogConfirmDiscard<\n\tTHEME extends DThemeDialogConfirm = DThemeDialogConfirm,\n\tOPTIONS extends DDialogConfirmDiscardOptions<THEME> = DDialogConfirmDiscardOptions<THEME>\n> extends DDialogConfirm<THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DDialogConfirmDiscard\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDialogConfirm, DDialogConfirmOptions, DThemeDialogConfirm } from \"./d-dialog-confirm\";\n\nexport interface DDialogMessageOptions<THEME extends DThemeDialogMessage>\n\textends DDialogConfirmOptions<THEME> {}\n\nexport interface DThemeDialogMessage extends DThemeDialogConfirm {}\n\nexport class DDialogMessage<\n\tTHEME extends DThemeDialogMessage = DThemeDialogMessage,\n\tOPTIONS extends DDialogMessageOptions<THEME> = DDialogMessageOptions<THEME>\n> extends DDialogConfirm<THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DDialogMessage\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {\n\tDDialogConfirmMessage,\n\tDDialogConfirmMessageOptions,\n\tDThemeDialogConfirmMessage\n} from \"./d-dialog-confirm-message\";\n\nexport class DDialogProcessingMessage<\n\tTHEME extends DThemeDialogConfirmMessage = DThemeDialogConfirmMessage,\n\tOPTIONS extends DDialogConfirmMessageOptions<THEME> = DDialogConfirmMessageOptions<THEME>\n> extends DDialogConfirmMessage<THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DDialogProcessingMessage\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBaseState } from \"./d-base-state\";\nimport { DDialogConfirm, DDialogConfirmOptions, DThemeDialogConfirm } from \"./d-dialog-confirm\";\nimport { DDialogConfirmMessage, DDialogConfirmMessageOptions } from \"./d-dialog-confirm-message\";\nimport { DDialogProcessingMessage } from \"./d-dialog-processing-message\";\nimport { DStateAwareOrValueMightBe } from \"./d-state-aware\";\n\nexport interface DDialogProcessingDelayOptions {\n\tdone?: number;\n\tclose?: number | null;\n}\n\nexport interface DDialogProcessingOptions<THEME extends DThemeDialogProcessing>\n\textends DDialogConfirmOptions<THEME> {\n\tdelay?: DDialogProcessingDelayOptions;\n}\n\nexport interface DThemeDialogProcessing extends DThemeDialogConfirm {\n\tgetDoneDelay(): number;\n\tgetCloseDelay(): number | null;\n}\n\nexport class DDialogProcessing<\n\tTHEME extends DThemeDialogProcessing = DThemeDialogProcessing,\n\tOPTIONS extends DDialogProcessingOptions<THEME> = DDialogProcessingOptions<THEME>\n> extends DDialogConfirm<THEME, OPTIONS> {\n\tprotected _isDone: boolean;\n\tprotected _startTime: number;\n\tprotected _delayDone: number;\n\tprotected _delayClose: number | null;\n\tprotected _timeoutId?: number;\n\tprotected _messageText: DStateAwareOrValueMightBe<string>;\n\tprotected _closeTimeoutId?: number;\n\n\tconstructor(options?: OPTIONS) {\n\t\tsuper(options);\n\t\tthis._isDone = true;\n\t\tthis._startTime = 0;\n\t\tconst delay = options?.delay;\n\t\tthis._delayDone = delay?.done ?? this.theme.getDoneDelay();\n\t\tconst delayClose = delay?.close;\n\t\tthis._delayClose = delayClose !== undefined ? delayClose : this.theme.getCloseDelay();\n\t\tthis._messageText = this.message.text;\n\t}\n\n\tprotected newMessage(options: DDialogConfirmMessageOptions): DDialogConfirmMessage {\n\t\treturn new DDialogProcessingMessage(options);\n\t}\n\n\tprotected onOpen(): void {\n\t\tthis._isDone = false;\n\t\tthis._startTime = Date.now();\n\t\tconst timeoutId = this._timeoutId;\n\t\tif (timeoutId != null) {\n\t\t\tclearTimeout(timeoutId);\n\t\t}\n\t\tconst closeTimeoutId = this._closeTimeoutId;\n\t\tif (closeTimeoutId != null) {\n\t\t\tclearTimeout(closeTimeoutId);\n\t\t}\n\t\tconst message = this.message;\n\t\tmessage.text = this._messageText;\n\t\tmessage.state.removeAll(DBaseState.SUCCEEDED, DBaseState.FAILED);\n\t\tconst buttonLayout = this._buttonLayout;\n\t\tif (buttonLayout != null) {\n\t\t\tbuttonLayout.hide();\n\t\t}\n\t\tsuper.onOpen();\n\t}\n\n\tprotected onDone(delay: number | null): void {\n\t\tif (delay != null) {\n\t\t\tthis._closeTimeoutId = window.setTimeout(() => {\n\t\t\t\tthis.close();\n\t\t\t}, delay);\n\t\t} else {\n\t\t\tthis.close();\n\t\t}\n\t}\n\n\tprotected onResolved(message?: string): void {\n\t\tif (message != null) {\n\t\t\tthis.message.text = message;\n\t\t}\n\t\tthis.message.state.set(DBaseState.SUCCEEDED, DBaseState.FAILED);\n\t\tconst delayClose = this._delayClose;\n\t\tif (delayClose != null) {\n\t\t\tthis.onDone(delayClose);\n\t\t} else {\n\t\t\tconst buttonLayout = this._buttonLayout;\n\t\t\tif (buttonLayout != null) {\n\t\t\t\tbuttonLayout.show();\n\t\t\t} else {\n\t\t\t\tthis.close();\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected onRejected(message?: string): void {\n\t\tif (message != null) {\n\t\t\tthis.message.text = message;\n\t\t}\n\t\tthis.message.state.set(DBaseState.FAILED, DBaseState.SUCCEEDED);\n\t\tconst buttonLayout = this._buttonLayout;\n\t\tif (buttonLayout != null) {\n\t\t\tbuttonLayout.show();\n\t\t} else {\n\t\t\tthis.onDone(this._delayClose);\n\t\t}\n\t}\n\n\tresolve(message?: string): void {\n\t\tif (!this._isDone) {\n\t\t\tthis._isDone = true;\n\t\t\tconst elapsedTime = Date.now() - this._startTime;\n\t\t\tconst delay = this._delayDone - elapsedTime;\n\t\t\tif (0 < delay) {\n\t\t\t\tthis._timeoutId = window.setTimeout((): void => {\n\t\t\t\t\tthis._timeoutId = undefined;\n\t\t\t\t\tthis.onResolved(message);\n\t\t\t\t}, delay);\n\t\t\t} else {\n\t\t\t\tthis.onResolved(message);\n\t\t\t}\n\t\t}\n\t}\n\n\treject(message?: string): void {\n\t\tif (!this._isDone) {\n\t\t\tthis._isDone = true;\n\t\t\tconst elapsedTime = Date.now() - this._startTime;\n\t\t\tconst delay = this._delayDone - elapsedTime;\n\t\t\tif (0 < delay) {\n\t\t\t\tthis._timeoutId = window.setTimeout((): void => {\n\t\t\t\t\tthis._timeoutId = undefined;\n\t\t\t\t\tthis.onRejected(message);\n\t\t\t\t}, delay);\n\t\t\t} else {\n\t\t\t\tthis.onRejected(message);\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected onCloseOn(): void {\n\t\tif (this._isDone) {\n\t\t\tsuper.onCloseOn();\n\t\t}\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DDialogProcessing\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DCommandSaveAs } from \"./d-command-save-as\";\nimport { DControllers } from \"./d-controllers\";\nimport {\n\tDDialogInputText,\n\tDDialogInputTextOptions,\n\tDThemeDialogInputText\n} from \"./d-dialog-input-text\";\nimport { isString } from \"./util/is-string\";\n\nexport interface DDialogSaveAsOptions<THEME extends DThemeDialogSaveAs>\n\textends DDialogInputTextOptions<THEME> {}\n\nexport interface DThemeDialogSaveAs extends DThemeDialogInputText {}\n\nexport class DDialogSaveAs<\n\tTHEME extends DThemeDialogSaveAs = DThemeDialogSaveAs,\n\tOPTIONS extends DDialogSaveAsOptions<THEME> = DDialogSaveAsOptions<THEME>\n> extends DDialogInputText<THEME, OPTIONS> {\n\tprotected onOpen(): void {\n\t\tconst name = DControllers.getDocumentController().getName();\n\t\tif (name != null) {\n\t\t\tthis.input.value = name;\n\t\t}\n\t\tsuper.onOpen();\n\t}\n\n\tprotected onOk(value: string | PromiseLike<string>): void {\n\t\tsuper.onOk(value);\n\t\tconst commandController = DControllers.getCommandController();\n\t\tif (isString(value)) {\n\t\t\tcommandController.push(new DCommandSaveAs(value));\n\t\t} else {\n\t\t\tvalue.then((resolved: string): void => {\n\t\t\t\tcommandController.push(new DCommandSaveAs(resolved));\n\t\t\t});\n\t\t}\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DDialogSaveAs\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DisplayObject } from \"pixi.js\";\n\nexport interface Owner {\n\tfocus(): void;\n}\n\nexport interface Parent {\n\tparent: unknown;\n}\n\nexport interface Closeable extends DisplayObject {\n\tclose(): void;\n}\n\nexport class DMenuContext {\n\tprotected _owner: Owner;\n\tprotected _closeables: Closeable[];\n\n\tconstructor(owner: Owner) {\n\t\tthis._owner = owner;\n\t\tthis._closeables = [];\n\t}\n\n\tprotected indexOf(target: unknown): number {\n\t\treturn this._closeables.indexOf(target as any);\n\t}\n\n\tprotected close(index: number): void {\n\t\tconst closeables = this._closeables;\n\t\tconst imin = Math.max(0, index);\n\t\tfor (let i = closeables.length - 1; imin <= i; --i) {\n\t\t\tcloseables[i].close();\n\t\t}\n\t}\n\n\tadd(closeable: Closeable): void {\n\t\tthis._closeables.push(closeable);\n\t}\n\n\ttrim(closeable: Closeable | null): void {\n\t\tthis.close(this.indexOf(closeable) + 1);\n\t}\n\n\tremove(closeable: Closeable): void {\n\t\tconst index = this.indexOf(closeable);\n\t\tif (0 <= index) {\n\t\t\tthis.close(index + 1);\n\t\t\tthis._closeables.splice(index, 1);\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DisplayObject, Point } from \"pixi.js\";\nimport { DApplications } from \"./d-applications\";\nimport { DBase } from \"./d-base\";\nimport { DBaseState } from \"./d-base-state\";\nimport { DFocusable } from \"./d-controller-focus\";\nimport { DLayoutVertical, DLayoutVerticalOptions, DThemeLayoutVertical } from \"./d-layout-vertical\";\nimport { DMenuAlign } from \"./d-menu-align\";\nimport { Closeable, DMenuContext } from \"./d-menu-context\";\nimport { DMenuItem } from \"./d-menu-item\";\nimport { DMenuItemOptionsUnion } from \"./d-menu-item-options-union\";\nimport { DMenus } from \"./d-menus\";\nimport { toEnum } from \"./util/to-enum\";\nimport { UtilAttach } from \"./util/util-attach\";\nimport { UtilClickOutside } from \"./util/util-click-outside\";\nimport { UtilKeyboardEvent } from \"./util/util-keyboard-event\";\nimport { UtilOverlay } from \"./util/util-overlay\";\n\nexport interface DMenuOptions<VALUE = unknown, THEME extends DThemeMenu = DThemeMenu>\n\textends DLayoutVerticalOptions<THEME> {\n\talign?: keyof typeof DMenuAlign | DMenuAlign;\n\tfit?: boolean;\n\tsticky?: boolean;\n\titems?: Array<DMenuItemOptionsUnion<VALUE> | DisplayObject | null | undefined>;\n}\n\nexport interface DThemeMenu extends DThemeLayoutVertical {\n\tgetOffsetX(): number;\n\tgetOffsetY(): number;\n}\n\nexport class DMenu<\n\tVALUE,\n\tTHEME extends DThemeMenu = DThemeMenu,\n\tOPTIONS extends DMenuOptions<VALUE, THEME> = DMenuOptions<VALUE, THEME>\n> extends DLayoutVertical<THEME, OPTIONS> {\n\tprotected _align!: DMenuAlign;\n\tprotected _fit!: boolean;\n\tprotected _sticky!: boolean;\n\tprotected _sub!: boolean;\n\tprotected _owner!: DBase<any, any> | null;\n\tprotected _context!: DMenuContext | null;\n\tprotected _overlay!: UtilOverlay;\n\tprotected _onPrerenderBound!: () => void;\n\tprotected _focused?: DFocusable | null;\n\n\tprotected init(options?: OPTIONS): void {\n\t\tsuper.init(options);\n\n\t\tthis._onPrerenderBound = (): void => {\n\t\t\tthis.onPrerender();\n\t\t};\n\n\t\tthis._align = toEnum(options?.align ?? DMenuAlign.BOTTOM, DMenuAlign);\n\t\tthis._fit = options?.fit ?? false;\n\t\tthis._sticky = options?.sticky ?? false;\n\t\tthis._sub = false;\n\t\tthis._owner = null;\n\t\tthis._context = null;\n\t\tthis.visible = false;\n\n\t\t// Event handlers\n\t\tUtilClickOutside.apply(this, (): void => {\n\t\t\tthis.close();\n\t\t});\n\n\t\tthis.on(\"select\", (): void => {\n\t\t\tthis.close();\n\t\t});\n\n\t\t// Items\n\t\tconst items = options?.items;\n\t\tif (items) {\n\t\t\tDMenus.newItems(this, items, this._sticky);\n\t\t}\n\n\t\t// Overlay\n\t\tthis._overlay = new UtilOverlay(options);\n\t}\n\n\tfindItem(value: VALUE): DMenuItem<VALUE> | null {\n\t\tconst children = this.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tconst child = children[i];\n\t\t\tif (child instanceof DMenuItem && child.value === value) {\n\t\t\t\treturn child;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DMenu\";\n\t}\n\n\tgetContext(): DMenuContext | null {\n\t\treturn this._context;\n\t}\n\n\tgetCloseable(): Closeable | null {\n\t\treturn this;\n\t}\n\n\topen(\n\t\towner: DBase<any, any>,\n\t\tcloseable?: Closeable | null,\n\t\tcontext?: DMenuContext | null\n\t): this {\n\t\tif (this.isHidden()) {\n\t\t\tconst layer = this._overlay.pick(this);\n\t\t\tthis._owner = owner;\n\n\t\t\t// States\n\t\t\tconst children = this.children;\n\t\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\t\tconst child = children[i];\n\t\t\t\tif (child instanceof DBase) {\n\t\t\t\t\tchild.state.removeAll(DBaseState.FOCUSED, DBaseState.HOVERED);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Position & size\n\t\t\tconst renderer = layer.renderer;\n\t\t\tconst onPrerenderBound = this._onPrerenderBound;\n\t\t\tif (this._sticky) {\n\t\t\t\trenderer.on(\"prerender\", onPrerenderBound);\n\t\t\t} else {\n\t\t\t\trenderer.once(\"prerender\", onPrerenderBound);\n\t\t\t}\n\t\t\tif (this._fit) {\n\t\t\t\tconst bounds = owner.getBounds();\n\t\t\t\tif (bounds != null) {\n\t\t\t\t\tthis.width = bounds.width;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Target\n\t\t\tthis._sub = context != null;\n\t\t\tcontext = context || new DMenuContext(owner);\n\t\t\tif (closeable != null) {\n\t\t\t\tcontext.trim(closeable);\n\t\t\t}\n\t\t\tcontext.add(this);\n\t\t\tthis._context = context;\n\n\t\t\t// Stage\n\t\t\tlayer.stage.addChild(this);\n\n\t\t\t// Focus\n\t\t\tthis._focused = layer.getFocusController().get();\n\t\t\tthis.focus();\n\n\t\t\t// Show\n\t\t\tsuper.show();\n\n\t\t\t// Event\n\t\t\tthis.emit(\"open\", this);\n\t\t}\n\t\treturn this;\n\t}\n\n\tprotected onPrerender(): void {\n\t\tconst owner = this._owner;\n\t\tif (owner) {\n\t\t\tconst bounds = owner.getBounds();\n\t\t\tif (bounds) {\n\t\t\t\tif (this._fit) {\n\t\t\t\t\tthis.width = bounds.width;\n\t\t\t\t}\n\t\t\t\tconst layer = this._overlay.picked;\n\t\t\t\tif (layer) {\n\t\t\t\t\tconst theme = this.theme;\n\t\t\t\t\tUtilAttach.attach(\n\t\t\t\t\t\tthis,\n\t\t\t\t\t\tbounds,\n\t\t\t\t\t\ttheme.getOffsetX(),\n\t\t\t\t\t\ttheme.getOffsetY(),\n\t\t\t\t\t\tlayer.width,\n\t\t\t\t\t\tlayer.height,\n\t\t\t\t\t\tthis._align\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tclose(): this {\n\t\tif (this.isShown()) {\n\t\t\t// Remove from the context\n\t\t\tconst context = this._context;\n\t\t\tif (context) {\n\t\t\t\tcontext.remove(this);\n\t\t\t}\n\n\t\t\t// Remove the prerender event handler\n\t\t\tconst layer = this._overlay.picked;\n\t\t\tif (layer) {\n\t\t\t\tlayer.renderer.off(\"prerender\", this._onPrerenderBound);\n\t\t\t}\n\n\t\t\t// Forget the owner\n\t\t\tthis._owner = null;\n\n\t\t\t// Restore the focus\n\t\t\tconst focused = this._focused;\n\t\t\tif (focused != null) {\n\t\t\t\tthis._focused = null;\n\t\t\t\tif (layer) {\n\t\t\t\t\tconst focusedLayer = DApplications.getLayer(focused);\n\t\t\t\t\tif (focusedLayer != null && layer !== focusedLayer) {\n\t\t\t\t\t\tfocusedLayer.view.focus();\n\t\t\t\t\t}\n\t\t\t\t\tlayer.getFocusController().focus(focused);\n\t\t\t\t} else {\n\t\t\t\t\tthis.blur(true);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.blur(true);\n\t\t\t}\n\n\t\t\t// Visibility\n\t\t\tsuper.hide();\n\n\t\t\t// Remove from the tree\n\t\t\tconst parent = this.parent;\n\t\t\tif (parent) {\n\t\t\t\tparent.removeChild(this);\n\t\t\t}\n\n\t\t\t// Emit the event\n\t\t\tthis.emit(\"close\", this);\n\t\t}\n\t\treturn this;\n\t}\n\n\tonKeyDown(e: KeyboardEvent): boolean {\n\t\tUtilKeyboardEvent.moveFocusVertically(e, this, this._overlay);\n\t\tif (\n\t\t\tthis.state.isActionable &&\n\t\t\t(UtilKeyboardEvent.isArrowLeftKey(e) || UtilKeyboardEvent.isCancelKey(e))\n\t\t) {\n\t\t\tthis.close();\n\t\t}\n\t\treturn super.onKeyDown(e);\n\t}\n\n\tprotected containsGlobalPoint(point: Point): boolean {\n\t\treturn !this._sub;\n\t}\n}\n\nDMenus.setMenuCreator((options?: DMenuOptions<any>) => new DMenu<any>(options));\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction } from \"pixi.js\";\nimport {\n\tDButtonBase,\n\tDButtonBaseEvents,\n\tDButtonBaseOptions,\n\tDThemeButtonBase\n} from \"./d-button-base\";\nimport { DMenu, DMenuOptions, DThemeMenu } from \"./d-menu\";\nimport { DMenuItem } from \"./d-menu-item\";\nimport { DOnOptions } from \"./d-on-options\";\nimport { UtilKeyboardEvent } from \"./util/util-keyboard-event\";\n\n/**\n * {@link DDropdownBase} events.\n */\nexport interface DDropdownBaseEvents<VALUE, TEXT_VALUE, EMITTER>\n\textends DButtonBaseEvents<VALUE, EMITTER> {\n\t/**\n\t * Triggered when a menu item is selected.\n\t *\n\t * @param value a value of a selected menu item\n\t * @param item a selected menu item\n\t * @param emitter an emitter\n\t */\n\tselect(value: VALUE, item: DMenuItem<VALUE>, emitter: EMITTER): void;\n}\n\n/**\n * {@link DDropdownBase} \"on\" options.\n */\nexport interface DDropdownBaseOnOptions<VALUE, TEXT_VALUE, EMITTER>\n\textends Partial<DDropdownBaseEvents<VALUE, TEXT_VALUE, EMITTER>>,\n\t\tDOnOptions {}\n\n/**\n * {@link DDropdownBase} options.\n */\nexport interface DDropdownBaseOptions<\n\tVALUE = unknown,\n\tTEXT_VALUE = string,\n\tTHEME extends DThemeDropdownBase<TEXT_VALUE> = DThemeDropdownBase<TEXT_VALUE>,\n\tEMITTER = any\n> extends DButtonBaseOptions<TEXT_VALUE, THEME, EMITTER> {\n\t/**\n\t * Menu options.\n\t */\n\tmenu?: DMenuOptions<VALUE> | DMenu<VALUE>;\n\n\ton?: DDropdownBaseOnOptions<VALUE, TEXT_VALUE, EMITTER>;\n}\n\n/**\n * {@link DDropdownBase} theme.\n */\nexport interface DThemeDropdownBase<TEXT_VALUE = unknown> extends DThemeButtonBase<TEXT_VALUE> {}\n\n/**\n * A dropdown base class.\n */\nexport class DDropdownBase<\n\tVALUE = unknown,\n\tTEXT_VALUE = string,\n\tTHEME extends DThemeDropdownBase<TEXT_VALUE> = DThemeDropdownBase<TEXT_VALUE>,\n\tOPTIONS extends DDropdownBaseOptions<VALUE, TEXT_VALUE, THEME> = DDropdownBaseOptions<\n\t\tVALUE,\n\t\tTEXT_VALUE,\n\t\tTHEME\n\t>\n> extends DButtonBase<TEXT_VALUE, THEME, OPTIONS> {\n\tprotected _menu?: DMenu<VALUE>;\n\tprotected _onMenuSelectBound?: (\n\t\tselected: VALUE,\n\t\titem: DMenuItem<VALUE>,\n\t\tmenu: DMenu<VALUE>\n\t) => void;\n\tprotected _onMenuCloseBound?: () => void;\n\n\tconstructor(options?: OPTIONS) {\n\t\tsuper(options);\n\t}\n\n\tprotected onMenuSelect(value: VALUE, item: DMenuItem<VALUE>, menu: DMenu<VALUE>): void {\n\t\tthis.emit(\"select\", value, item, this);\n\t}\n\n\tprotected onMenuClose(menu?: DMenu<VALUE>): void {\n\t\tif (menu) {\n\t\t\tconst onMenuSelectBound = this._onMenuSelectBound;\n\t\t\tif (onMenuSelectBound) {\n\t\t\t\tmenu.off(\"select\", onMenuSelectBound);\n\t\t\t}\n\t\t\tconst onMenuCloseBound = this._onMenuCloseBound;\n\t\t\tif (onMenuCloseBound) {\n\t\t\t\tmenu.off(\"close\", onMenuCloseBound);\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected toMenu(theme: THEME, options?: OPTIONS): DMenu<VALUE> {\n\t\tconst menu = options?.menu;\n\t\tif (menu instanceof DMenu) {\n\t\t\treturn menu;\n\t\t}\n\t\treturn new DMenu<VALUE>(this.toMenuOptions(theme, menu));\n\t}\n\n\tprotected toMenuOptions(\n\t\ttheme: THEME,\n\t\toptions?: DMenuOptions<VALUE>\n\t): DMenuOptions<VALUE, DThemeMenu> {\n\t\tif (options) {\n\t\t\tif (options.fit == null) {\n\t\t\t\toptions.fit = true;\n\t\t\t}\n\t\t\treturn options;\n\t\t}\n\t\treturn {\n\t\t\tfit: true\n\t\t};\n\t}\n\n\tget menu(): DMenu<VALUE> {\n\t\tlet result = this._menu;\n\t\tif (result == null) {\n\t\t\tresult = this.toMenu(this.theme, this._options);\n\t\t\tthis._menu = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tset menu(newMenu: DMenu<VALUE>) {\n\t\tconst oldMenu = this._menu;\n\t\tif (oldMenu != newMenu) {\n\t\t\tthis._menu = newMenu;\n\t\t\tthis.onMenuReplaced(newMenu, oldMenu);\n\t\t}\n\t}\n\n\tprotected onMenuReplaced(newMenu: DMenu<VALUE>, oldMenu?: DMenu<VALUE>): void {\n\t\tif (oldMenu != null) {\n\t\t\tthis.onMenuClose(oldMenu);\n\t\t}\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DDropdownBase\";\n\t}\n\n\tonKeyDown(e: KeyboardEvent): boolean {\n\t\tif (UtilKeyboardEvent.isArrowDownKey(e)) {\n\t\t\tthis.onKeyDownArrowDown(e);\n\t\t}\n\t\treturn super.onKeyDown(e);\n\t}\n\n\tprotected onKeyDownArrowDown(e: KeyboardEvent): boolean {\n\t\tif (this.state.isActionable && this.state.isFocused) {\n\t\t\tthis.onClick(e);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tprotected onActivate(\n\t\te?: interaction.InteractionEvent | KeyboardEvent | MouseEvent | TouchEvent\n\t): void {\n\t\tsuper.onActivate(e);\n\t\tthis.start();\n\t}\n\n\tstart(): void {\n\t\tconst menu = this.menu;\n\t\tif (menu.isHidden()) {\n\t\t\t// In the case that the menu is created elsewhere,\n\t\t\t// the menu might be opened by other UI elements\n\t\t\t// and the `select` event might be triggered. In\n\t\t\t// that case, we are not supposed to catct that\n\t\t\t// `select` event. This is why the `select` event\n\t\t\t// handler is registered here. Instead of the\n\t\t\t// initialization time.\n\t\t\tlet onMenuSelectBound = this._onMenuSelectBound;\n\t\t\tif (onMenuSelectBound == null) {\n\t\t\t\tonMenuSelectBound = (\n\t\t\t\t\tvalue: VALUE,\n\t\t\t\t\titem: DMenuItem<VALUE>,\n\t\t\t\t\tm: DMenu<VALUE>\n\t\t\t\t): void => {\n\t\t\t\t\tthis.onMenuSelect(value, item, m);\n\t\t\t\t};\n\t\t\t\tthis._onMenuSelectBound = onMenuSelectBound;\n\t\t\t}\n\t\t\tlet onMenuCloseBound = this._onMenuCloseBound;\n\t\t\tif (onMenuCloseBound == null) {\n\t\t\t\tonMenuCloseBound = (): void => {\n\t\t\t\t\tthis.onMenuClose(this._menu);\n\t\t\t\t};\n\t\t\t}\n\t\t\tmenu.on(\"select\", onMenuSelectBound);\n\t\t\tmenu.on(\"close\", onMenuCloseBound);\n\t\t\tmenu.open(this);\n\t\t}\n\t}\n\n\tclose(): void {\n\t\tthis.menu.close();\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDropdownBase, DDropdownBaseOptions, DThemeDropdownBase } from \"./d-dropdown-base\";\n\n/**\n * Dropdown options.\n */\nexport interface DDropdownOptions<VALUE = unknown, THEME extends DThemeDropdown = DThemeDropdown>\n\textends DDropdownBaseOptions<VALUE, string, THEME> {}\n\n/**\n * A dropdown theme.\n */\nexport interface DThemeDropdown extends DThemeDropdownBase<string> {}\n\nexport class DDropdown<\n\tVALUE = unknown,\n\tTHEME extends DThemeDropdown = DThemeDropdown,\n\tOPTIONS extends DDropdownOptions<VALUE, THEME> = DDropdownOptions<VALUE, THEME>\n> extends DDropdownBase<VALUE, string, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DDropdown\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction } from \"pixi.js\";\nimport { DImage, DImageOptions, DThemeImage } from \"./d-image\";\nimport { UtilKeyboardEvent } from \"./util/util-keyboard-event\";\nimport { UtilPointerEvent } from \"./util/util-pointer-event\";\n\nexport interface DExpandableHeaderOptions<\n\tVALUE = unknown,\n\tTHEME extends DThemeExpandableHeader<VALUE> = DThemeExpandableHeader<VALUE>\n> extends DImageOptions<VALUE, THEME> {}\n\nexport interface DThemeExpandableHeader<VALUE = unknown> extends DThemeImage<VALUE> {}\n\nexport class DExpandableHeader<\n\tVALUE = unknown,\n\tTHEME extends DThemeExpandableHeader<VALUE> = DThemeExpandableHeader<VALUE>,\n\tOPTIONS extends DExpandableHeaderOptions<VALUE, THEME> = DExpandableHeaderOptions<VALUE, THEME>\n> extends DImage<VALUE, THEME, OPTIONS> {\n\tconstructor(options?: OPTIONS) {\n\t\tsuper(options);\n\n\t\tthis.on(UtilPointerEvent.down, (e: interaction.InteractionEvent): void => {\n\t\t\tif (this.state.isActionable) {\n\t\t\t\tthis.onSelect(e);\n\t\t\t}\n\t\t});\n\t}\n\n\tprotected onSelect(e: KeyboardEvent | interaction.InteractionEvent): void {\n\t\tthis.emit(\"select\", this);\n\t}\n\n\tonKeyDown(e: KeyboardEvent): boolean {\n\t\tif (UtilKeyboardEvent.isActivateKey(e)) {\n\t\t\tthis.onKeyDownActivate(e);\n\t\t}\n\t\treturn super.onKeyDown(e);\n\t}\n\n\tprotected onKeyDownActivate(e: KeyboardEvent): boolean {\n\t\tif (this.state.isActionable && this.state.isFocused) {\n\t\t\tthis.onSelect(e);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DExpandableHeader\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Container, DisplayObject } from \"pixi.js\";\nimport { DBase } from \"./d-base\";\nimport { DBaseStateSet } from \"./d-base-state-set\";\nimport { DExpandableHeader, DExpandableHeaderOptions } from \"./d-expandable-header\";\nimport { DLayoutVertical, DLayoutVerticalOptions, DThemeLayoutVertical } from \"./d-layout-vertical\";\n\nexport interface DExpandableOptions<THEME extends DThemeExpandable = DThemeExpandable>\n\textends DLayoutVerticalOptions<THEME> {\n\theader?: DisplayObject | DExpandableHeaderOptions;\n\tbody: Container;\n}\n\nexport interface DThemeExpandable extends DThemeLayoutVertical {}\n\nexport class DExpandable<\n\tTHEME extends DThemeExpandable = DThemeExpandable,\n\tOPTIONS extends DExpandableOptions<THEME> = DExpandableOptions<THEME>\n> extends DLayoutVertical<THEME, OPTIONS> {\n\tprotected _header!: DisplayObject;\n\tprotected _body!: Container;\n\n\tprotected init(options: OPTIONS): void {\n\t\tsuper.init(options);\n\n\t\t// Header\n\t\tconst theme = this.theme;\n\t\tconst header = this.toHeader(theme, options);\n\t\tthis._header = header;\n\t\theader.on(\"select\", (): void => {\n\t\t\tthis.toggle();\n\t\t});\n\t\tthis.addChild(header);\n\n\t\t// Body\n\t\tconst body = this.toBody(theme, options);\n\t\tthis._body = body;\n\t\tthis.addChild(body);\n\n\t\t//\n\t\tif (this.state.isActive) {\n\t\t\tthis.onActivated();\n\t\t} else {\n\t\t\tthis.onDeactivated();\n\t\t}\n\t}\n\n\tprotected toHeader(theme: THEME, options?: OPTIONS): DisplayObject {\n\t\tif (options && options.header) {\n\t\t\tif (options.header instanceof DisplayObject) {\n\t\t\t\treturn options.header;\n\t\t\t} else {\n\t\t\t\treturn this.newHeader(theme, options.header);\n\t\t\t}\n\t\t}\n\t\treturn this.newHeader(theme);\n\t}\n\n\tprotected newHeader(theme: THEME, options?: DExpandableHeaderOptions): DisplayObject {\n\t\treturn new DExpandableHeader(options);\n\t}\n\n\tprotected toBody(theme: THEME, options: OPTIONS): Container {\n\t\treturn options.body;\n\t}\n\n\topen(): void {\n\t\tthis.state.isActive = true;\n\t}\n\n\tclose(): void {\n\t\tthis.state.isActive = false;\n\t}\n\n\ttoggle(): void {\n\t\tthis.state.isActive = !this.state.isActive;\n\t}\n\n\tprotected onActivated(): void {\n\t\tconst body = this._body;\n\t\tif (body instanceof DBase) {\n\t\t\tbody.show();\n\t\t} else {\n\t\t\tbody.visible = true;\n\t\t}\n\t}\n\n\tprotected onDeactivated(): void {\n\t\tconst body = this._body;\n\t\tif (body instanceof DBase) {\n\t\t\tbody.hide();\n\t\t} else {\n\t\t\tbody.visible = false;\n\t\t}\n\t}\n\n\tprotected onStateChange(newState: DBaseStateSet, oldState: DBaseStateSet): void {\n\t\tsuper.onStateChange(newState, oldState);\n\n\t\tif (newState.isActive) {\n\t\t\tif (!oldState.isActive) {\n\t\t\t\tthis.onActivated();\n\t\t\t}\n\t\t} else {\n\t\t\tif (oldState.isActive) {\n\t\t\t\tthis.onDeactivated();\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DExpandable\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DInputAndLabel, DInputAndLabelOptions, DThemeInputAndLabel } from \"./d-input-and-label\";\nimport { DInputInteger, DInputIntegerOptions, DThemeInputInteger } from \"./d-input-integer\";\n\nexport interface DInputIntegerAndLabelOptions<\n\tTHEME extends DThemeInputAndLabel = DThemeInputAndLabel\n> extends DInputAndLabelOptions<DInputIntegerOptions, THEME> {}\n\nexport class DInputIntegerAndLabel<\n\tTHEME extends DThemeInputAndLabel = DThemeInputAndLabel,\n\tOPTIONS extends DInputIntegerAndLabelOptions<THEME> = DInputIntegerAndLabelOptions<THEME>\n> extends DInputAndLabel<DInputInteger, DInputIntegerOptions, THEME, OPTIONS> {\n\tprotected createInput(options?: DInputIntegerOptions<DThemeInputInteger>): DInputInteger {\n\t\treturn new DInputInteger(options);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DInput, DInputOptions, DThemeInput } from \"./d-input\";\nimport {\n\tUtilInputTextArea,\n\tUtilInputTextAreaOptions,\n\tUtilThemeInputTextArea\n} from \"./util/util-input-text-area\";\n\nexport interface DInputTextAreaOptions<THEME extends DThemeInputTextArea = DThemeInputTextArea>\n\textends DInputOptions<string, HTMLTextAreaElement, THEME>,\n\t\tUtilInputTextAreaOptions {}\n\nexport interface DThemeInputTextArea\n\textends DThemeInput<string, HTMLTextAreaElement>,\n\t\tUtilThemeInputTextArea {}\n\nexport class DInputTextArea<\n\tTHEME extends DThemeInputTextArea = DThemeInputTextArea,\n\tOPTIONS extends DInputTextAreaOptions<THEME> = DInputTextAreaOptions<THEME>\n> extends DInput<string, HTMLTextAreaElement, THEME, OPTIONS, UtilInputTextArea> {\n\tprotected newUtil(): UtilInputTextArea {\n\t\treturn new UtilInputTextArea(this, this.newOperation(), this.theme, this._options);\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DInputTextArea\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DListItem, DListItemOptions, DThemeListItem } from \"./d-list-item\";\n\nexport interface DListItemAmbientOptions<\n\tVALUE = unknown,\n\tTHEME extends DThemeListItemAmbient = DThemeListItemAmbient\n> extends DListItemOptions<VALUE, THEME> {}\n\nexport interface DThemeListItemAmbient extends DThemeListItem {}\n\nexport class DListItemAmbient<\n\tVALUE = unknown,\n\tTHEME extends DThemeListItemAmbient = DThemeListItemAmbient,\n\tOPTIONS extends DListItemAmbientOptions<VALUE, THEME> = DListItemAmbientOptions<VALUE, THEME>\n> extends DListItem<VALUE, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DListItemAmbient\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DMapCoordinate, DMapPoint } from \"./d-map-coordinate\";\n\nexport class DMapCoordinateEPSG3857 implements DMapCoordinate {\n\tprotected static CIRCUMFERENCE_HALF: number =\n\t\tMath.PI * 6378137 /* Approximate earth radius in meter */;\n\tprotected _tileSize: number;\n\n\tconstructor(tileSize: number = 256) {\n\t\tthis._tileSize = tileSize;\n\t}\n\n\tgetTileSize(): number {\n\t\treturn this._tileSize;\n\t}\n\n\t/**\n\t * Converts the given (lon, lat) point in WGS84 to (x, y) in EPSG:900913.\n\t * The origin of the converted point (x, y) is at the middle-left corner.\n\t * The `meters` can be the same instance that is passed in as the `lonlat`.\n\t *\n\t * @param lonlat (lon, lat) point\n\t * @param meters (x, y) point in meters converted from the given lonlat.\n\t * @return (x, y) point in meters\n\t * @see https://www.maptiler.com/google-maps-coordinates-tile-bounds-projection/\n\t * @see https://qiita.com/MALORGIS/items/1a9114dd090e5b891bf7\n\t */\n\tlonLatToMeters(lonlat: DMapPoint, meters: DMapPoint): DMapPoint {\n\t\tconst C = DMapCoordinateEPSG3857.CIRCUMFERENCE_HALF;\n\t\tmeters.x = (lonlat.x * C) / 180;\n\t\tmeters.y = (Math.log(Math.tan(((90 + lonlat.y) * Math.PI) / 360)) * C) / Math.PI;\n\t\treturn meters;\n\t}\n\n\t/**\n\t * The `lonlat` can be the same instance that is passed in as the `meters`.\n\t *\n\t * @param meters\n\t * @param lonlat\n\t */\n\tmetersToLonLat(meters: DMapPoint, lonlat: DMapPoint): DMapPoint {\n\t\tconst C = DMapCoordinateEPSG3857.CIRCUMFERENCE_HALF;\n\t\tlonlat.x = (meters.x / C) * 180;\n\t\tlonlat.y = (Math.atan(Math.exp((meters.y * Math.PI) / C)) * 360) / Math.PI - 90;\n\t\treturn lonlat;\n\t}\n\n\t/**\n\t * Converts pixel coordinates in given zoom level of pyramid to EPSG:900913.\n\t * The origin of the `pixels` is the top-left corner.\n\t * The `meters` can be the same instance that is passed in as the `pixels`.\n\t */\n\tpixelsToMeters(pixels: DMapPoint, tz: number, tileSize: number, meters: DMapPoint): DMapPoint {\n\t\tconst R = this.toResolution(tz, tileSize);\n\t\tconst C = DMapCoordinateEPSG3857.CIRCUMFERENCE_HALF;\n\t\tmeters.x = pixels.x * R - C;\n\t\tmeters.y = C - pixels.y * R;\n\t\treturn meters;\n\t}\n\n\t/**\n\t * Converts EPSG:900913 to pyramid pixel coordinates in given zoom level.\n\t * The origin of the pixels is the top-left corner.\n\t * The `pixels` can be the same instance that is passed in as the `meters`.\n\t */\n\tmetersToPixels(meters: DMapPoint, tz: number, tileSize: number, pixels: DMapPoint): DMapPoint {\n\t\tconst R = this.toResolution(tz, tileSize);\n\t\tconst C = DMapCoordinateEPSG3857.CIRCUMFERENCE_HALF;\n\t\tpixels.x = (meters.x + C) / R;\n\t\tpixels.y = (C - meters.y) / R;\n\t\treturn pixels;\n\t}\n\n\t/**\n\t * Returns a tile covering region in given pixel coordinates.\n\t * The origin of the tile is the top-left corner.\n\t * The `tile` can be the same instance that is passed in as the `pixels`.\n\t */\n\tpixelsToTile(pixels: DMapPoint, tileSize: number, tile: DMapPoint): DMapPoint {\n\t\ttile.x = Math.ceil(pixels.x / tileSize) - 1;\n\t\ttile.y = Math.ceil(pixels.y / tileSize) - 1;\n\t\treturn tile;\n\t}\n\n\t/**\n\t * The origin of the tile is the top-left corner.\n\t * The `tile` can be the same instance that is passed in as the `meters`.\n\t */\n\tmetersToTile(meters: DMapPoint, tz: number, tile: DMapPoint): DMapPoint {\n\t\tconst C = DMapCoordinateEPSG3857.CIRCUMFERENCE_HALF;\n\t\tconst Z = 1 << tz;\n\t\ttile.x = Math.ceil(0.5 * (meters.x / C + 1) * Z) - 1;\n\t\ttile.y = Math.ceil(0.5 * (1 - meters.y / C) * Z) - 1;\n\t\treturn tile;\n\t}\n\n\tlonLatToTile(lonlat: DMapPoint, tz: number, tile: DMapPoint): DMapPoint {\n\t\treturn this.metersToTile(this.lonLatToMeters(lonlat, tile), tz, tile);\n\t}\n\n\tlonLatToPixels(lonlat: DMapPoint, tz: number, tileSize: number, pixels: DMapPoint): DMapPoint {\n\t\treturn this.metersToPixels(this.lonLatToMeters(lonlat, pixels), tz, tileSize, pixels);\n\t}\n\n\tpixelsToLonLat(pixels: DMapPoint, tz: number, tileSize: number, lonlat: DMapPoint): DMapPoint {\n\t\treturn this.metersToLonLat(this.pixelsToMeters(pixels, tz, tileSize, lonlat), lonlat);\n\t}\n\n\t/**\n\t * The `pixels` can be the same instance that is passed in as the `tile`.\n\t */\n\ttileToPixels(tile: DMapPoint, tileSize: number, pixels: DMapPoint): DMapPoint {\n\t\tpixels.x = tile.x * tileSize;\n\t\tpixels.y = tile.y * tileSize;\n\t\treturn pixels;\n\t}\n\n\t/**\n\t * Returns bounds of the given tile in EPSG:900913 coordinates\n\t * The `meters` can be the same instance that is passed in as the `tile`.\n\t */\n\ttileToMeters(tile: DMapPoint, tz: number, meters: DMapPoint): DMapPoint {\n\t\tconst R = this.toResolutionMeter(tz);\n\t\tconst C = DMapCoordinateEPSG3857.CIRCUMFERENCE_HALF;\n\t\tmeters.x = tile.x * R + C;\n\t\tmeters.y = C - tile.y * R;\n\t\treturn meters;\n\t}\n\n\tprotected toResolutionMeter(tz: number): number {\n\t\treturn (2 * DMapCoordinateEPSG3857.CIRCUMFERENCE_HALF) / (1 << tz);\n\t}\n\n\tprotected toResolution(tz: number, tileSize: number): number {\n\t\treturn (2 * DMapCoordinateEPSG3857.CIRCUMFERENCE_HALF) / (tileSize << tz);\n\t}\n\n\ttoTileCount(tz: number): number {\n\t\treturn 1 << tz;\n\t}\n\n\ttoTileCode(tz: number, tx: number, ty: number): number {\n\t\treturn (tx << tz) + ty;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DMapCoordinate } from \"./d-map-coordinate\";\nimport { DMapCoordinateEPSG3857 } from \"./d-map-coordinate-epsg3857\";\n\nexport class DMapCoordinates {\n\tprotected static _default?: DMapCoordinate;\n\n\tstatic get DEFAULT(): DMapCoordinate {\n\t\tif (this._default == null) {\n\t\t\tthis._default = new DMapCoordinateEPSG3857();\n\t\t}\n\t\treturn this._default;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Container, Renderer, resources, Sprite, Texture } from \"pixi.js\";\n\nexport class DMapTile {\n\ttx: number;\n\tty: number;\n\n\tprotected _sprite: Sprite;\n\n\tconstructor(parent: Container, tx: number, ty: number, px: number, py: number, scale: number) {\n\t\tthis.tx = tx;\n\t\tthis.ty = ty;\n\t\tconst sprite = new Sprite(Texture.EMPTY);\n\t\t(sprite as any).parent = parent;\n\t\tsprite.position.set(px, py);\n\t\tsprite.scale.set(scale, scale);\n\t\tthis._sprite = sprite;\n\t}\n\n\tload(url: string, onLoaded: () => void): void {\n\t\tconst texture = Texture.from(url, { resolution: 1 });\n\t\tthis._sprite.texture = texture;\n\t\tif (texture.valid) {\n\t\t\tonLoaded();\n\t\t} else {\n\t\t\ttexture.on(\"update\", onLoaded);\n\t\t}\n\t}\n\n\ttransform(px: number, py: number, scale: number): void {\n\t\tconst sprite = this._sprite;\n\t\tsprite.position.set(px, py);\n\t\tsprite.scale.set(scale, scale);\n\t}\n\n\tget loaded(): boolean {\n\t\treturn this._sprite.texture.valid;\n\t}\n\n\trender(renderer: Renderer): void {\n\t\tconst sprite = this._sprite;\n\t\tsprite.updateTransform();\n\t\tsprite.render(renderer);\n\t}\n\n\tdestroy(): void {\n\t\tconst sprite = this._sprite;\n\t\tconst texture = sprite.texture;\n\t\tconst resource = texture.baseTexture.resource;\n\t\tlet image: HTMLImageElement | null = null;\n\t\tif (resource instanceof resources.BaseImageResource) {\n\t\t\tif (resource.source instanceof HTMLImageElement) {\n\t\t\t\timage = resource.source;\n\t\t\t}\n\t\t}\n\t\ttexture.destroy(true);\n\t\tsprite.destroy();\n\t\tif (image) {\n\t\t\timage.src = \"\";\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Point, Renderer } from \"pixi.js\";\nimport { DBase } from \"./d-base\";\nimport { DMapCoordinate } from \"./d-map-coordinate\";\nimport { DMapTile } from \"./d-map-tile\";\nimport { DMapTileMappingInternal } from \"./d-map-tile-mapping-internal\";\nimport { DMapTileUrlBuilder } from \"./d-map-tile-url-builder\";\n\nexport class DMapTilePlane {\n\tprotected static WORK: Point = new Point();\n\n\tprotected readonly _parent: DBase;\n\tprotected readonly _builder: DMapTileUrlBuilder;\n\tprotected readonly _tz: number;\n\tprotected _lon0: number;\n\tprotected _lat0: number;\n\tprotected _lon1: number;\n\tprotected _lat1: number;\n\tprotected readonly _tiles: Map<number, DMapTile>;\n\tprotected _renderer?: Renderer;\n\tprotected readonly _renderTileBound: (tile: DMapTile) => void;\n\tprotected _txmin: number;\n\tprotected _txmax: number;\n\tprotected _tymin: number;\n\tprotected _tymax: number;\n\tprotected readonly _deleteTileBound: (\n\t\ttile: DMapTile,\n\t\ttileCode: number,\n\t\ttiles: Map<number, DMapTile>\n\t) => void;\n\tprotected readonly _destroyTileBound: (tile: DMapTile) => void;\n\tprotected _tileCount: number;\n\tprotected _tileScale: number;\n\tprotected _tileScaleRelative: number;\n\tprotected _tileSize: number;\n\tprotected _mapping: DMapTileMappingInternal;\n\tprotected _coordinate: DMapCoordinate;\n\tprotected _isLoaded: boolean;\n\tprotected readonly _updateLoadingStateForEach: (tile: DMapTile) => void;\n\tprotected readonly _onLoaded: () => void;\n\tprotected readonly _onLoadedBound: () => void;\n\tprotected _isOnLoadedCalled: boolean;\n\tprotected _isOnLoadedAllowed: boolean;\n\n\tconstructor(\n\t\tparent: DBase,\n\t\tbuilder: DMapTileUrlBuilder,\n\t\ttz: number,\n\t\tmapping: DMapTileMappingInternal,\n\t\tcoordinate: DMapCoordinate,\n\t\tonLoaded: () => void\n\t) {\n\t\tthis._parent = parent;\n\t\tthis._builder = builder;\n\t\tthis._onLoaded = onLoaded;\n\t\tthis._isOnLoadedCalled = false;\n\t\tthis._isOnLoadedAllowed = true;\n\t\tthis._onLoadedBound = (): void => {\n\t\t\tthis.onLoaded();\n\t\t};\n\t\tthis._tz = tz;\n\t\tthis._lon0 = NaN;\n\t\tthis._lat0 = NaN;\n\t\tthis._lon1 = NaN;\n\t\tthis._lat1 = NaN;\n\t\tthis._tiles = new Map<number, DMapTile>();\n\t\tthis._renderTileBound = (tile: DMapTile): void => {\n\t\t\tthis.renderTile(tile);\n\t\t};\n\t\tthis._txmin = NaN;\n\t\tthis._txmax = NaN;\n\t\tthis._tymin = NaN;\n\t\tthis._tymax = NaN;\n\t\tthis._deleteTileBound = (\n\t\t\ttile: DMapTile,\n\t\t\ttileCode: number,\n\t\t\ttiles: Map<number, DMapTile>\n\t\t): void => {\n\t\t\tthis.deleteTile(tile, tileCode, tiles);\n\t\t};\n\t\tthis._destroyTileBound = (tile: DMapTile): void => {\n\t\t\tthis.destroyTile(tile);\n\t\t};\n\t\tthis._updateLoadingStateForEach = (tile: DMapTile): void => {\n\t\t\tif (!tile.loaded) {\n\t\t\t\tthis._isLoaded = false;\n\t\t\t}\n\t\t};\n\t\tthis._tileCount = coordinate.toTileCount(tz);\n\t\tthis._tileScaleRelative = 1 / this._tileCount;\n\t\tthis._tileScale = mapping.scale * this._tileScaleRelative;\n\t\tthis._tileSize = coordinate.getTileSize() * mapping.scale;\n\t\tthis._mapping = mapping;\n\t\tthis._coordinate = coordinate;\n\t\tthis._isLoaded = true;\n\t}\n\n\tprotected newTile(tx: number, ty: number, px: number, py: number, scale: number): DMapTile {\n\t\treturn new DMapTile(this._parent, tx, ty, px, py, scale);\n\t}\n\n\tprotected renderTile(tile: DMapTile): void {\n\t\ttile.render(this._renderer!);\n\t}\n\n\tget tz(): number {\n\t\treturn this._tz;\n\t}\n\n\trender(renderer: Renderer): void {\n\t\tthis._renderer = renderer;\n\t\tthis._tiles.forEach(this._renderTileBound);\n\t}\n\n\tmove(lon0: number, lat0: number, lon1: number, lat1: number): void {\n\t\tconst oldLon0 = this._lon0;\n\t\tconst oldLat0 = this._lat0;\n\t\tconst oldLon1 = this._lon1;\n\t\tconst oldLat1 = this._lat1;\n\t\tif (oldLon0 !== lon0 || oldLat0 !== lat0 || oldLon1 !== lon1 || oldLat1 !== lat1) {\n\t\t\tthis._lon0 = lon0;\n\t\t\tthis._lat0 = lat0;\n\t\t\tthis._lon1 = lon1;\n\t\t\tthis._lat1 = lat1;\n\n\t\t\tconst tz = this._tz;\n\t\t\tconst coordinate = this._coordinate;\n\n\t\t\tconst work = DMapTilePlane.WORK;\n\t\t\twork.set(lon0, lat0);\n\t\t\tcoordinate.lonLatToTile(work, tz, work);\n\t\t\tconst tx0 = work.x;\n\t\t\tconst ty0 = work.y;\n\n\t\t\twork.set(lon1, lat1);\n\t\t\tcoordinate.lonLatToTile(work, tz, work);\n\t\t\tconst tx1 = work.x;\n\t\t\tconst ty1 = work.y;\n\n\t\t\tconst tileCount = this._tileCount;\n\t\t\tlet txmin = Math.max(0, tx0);\n\t\t\tlet txmax = Math.min(tileCount - 1, tx1);\n\t\t\tlet tymin = Math.max(0, ty0);\n\t\t\tlet tymax = Math.min(tileCount - 1, ty1);\n\t\t\tconst dtxmin = txmin - this._txmin;\n\t\t\tconst dtxmax = txmax - this._txmax;\n\t\t\tconst dtymin = tymin - this._tymin;\n\t\t\tconst dtymax = tymax - this._tymax;\n\n\t\t\tconst isTxMinChanged = dtxmin !== dtxmin || dtxmin < 0 || 1 < dtxmin;\n\t\t\tconst isTxMaxChanged = dtxmax !== dtxmax || 0 < dtxmax || dtxmax < -1;\n\t\t\tconst isTyMinChanged = dtymin !== dtymin || dtymin < 0 || 1 < dtymin;\n\t\t\tconst isTyMaxChanged = dtymax !== dtymax || 0 < dtymax || dtymax < -1;\n\t\t\tif (isTxMinChanged || isTxMaxChanged || isTyMinChanged || isTyMaxChanged) {\n\t\t\t\tif (isTxMinChanged) {\n\t\t\t\t\tthis._txmin = txmin;\n\t\t\t\t} else {\n\t\t\t\t\ttxmin = this._txmin;\n\t\t\t\t}\n\t\t\t\tif (isTxMaxChanged) {\n\t\t\t\t\tthis._txmax = txmax;\n\t\t\t\t} else {\n\t\t\t\t\ttxmax = this._txmax;\n\t\t\t\t}\n\t\t\t\tif (isTyMinChanged) {\n\t\t\t\t\tthis._tymin = tymin;\n\t\t\t\t} else {\n\t\t\t\t\ttymin = this._tymin;\n\t\t\t\t}\n\t\t\t\tif (isTyMaxChanged) {\n\t\t\t\t\tthis._tymax = tymax;\n\t\t\t\t} else {\n\t\t\t\t\ttymax = this._tymax;\n\t\t\t\t}\n\n\t\t\t\tconst tiles = this._tiles;\n\t\t\t\ttiles.forEach(this._deleteTileBound);\n\n\t\t\t\tconst ctx = (txmin + txmax) >> 1;\n\t\t\t\tconst cty = (tymin + tymax) >> 1;\n\t\t\t\tconst ltx = Math.max(ctx - txmin, txmax - ctx);\n\t\t\t\tconst lty = Math.max(cty - tymin, tymax - cty);\n\t\t\t\tconst lt = Math.max(ltx, lty);\n\n\t\t\t\tthis.toOffset(work);\n\t\t\t\tconst offsetX = work.x;\n\t\t\t\tconst offsetY = work.y;\n\n\t\t\t\tthis._isOnLoadedCalled = false;\n\t\t\t\tthis._isOnLoadedAllowed = false;\n\t\t\t\tthis.loadTile(tz, ctx, cty, offsetX, offsetY, work);\n\t\t\t\tfor (let it = 1; it <= lt; ++it) {\n\t\t\t\t\tconst txa = ctx - it;\n\t\t\t\t\tif (txmin <= txa) {\n\t\t\t\t\t\tthis.loadTilesY(tz, txa, cty, it, tymin, tymax, offsetX, offsetY, work);\n\t\t\t\t\t}\n\t\t\t\t\tconst txb = ctx + it;\n\t\t\t\t\tif (txb <= txmax) {\n\t\t\t\t\t\tthis.loadTilesY(tz, txb, cty, it, tymin, tymax, offsetX, offsetY, work);\n\t\t\t\t\t}\n\t\t\t\t\tconst tya = cty - it;\n\t\t\t\t\tif (tymin <= tya) {\n\t\t\t\t\t\tthis.loadTilesX(tz, ctx, it - 1, txmin, txmax, tya, offsetX, offsetY, work);\n\t\t\t\t\t}\n\t\t\t\t\tconst tyb = cty + it;\n\t\t\t\t\tif (tyb <= tymax) {\n\t\t\t\t\t\tthis.loadTilesX(tz, ctx, it - 1, txmin, txmax, tyb, offsetX, offsetY, work);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis._isOnLoadedAllowed = true;\n\t\t\t\tif (this._isOnLoadedCalled) {\n\t\t\t\t\tthis.onLoaded();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected loadTilesX(\n\t\ttz: number,\n\t\tctx: number,\n\t\tltx: number,\n\t\ttxmin: number,\n\t\ttxmax: number,\n\t\tty: number,\n\t\tox: number,\n\t\toy: number,\n\t\twork: Point\n\t): void {\n\t\tthis.loadTile(tz, ctx, ty, ox, oy, work);\n\t\tfor (let i = 1; i <= ltx; ++i) {\n\t\t\tconst txa = ctx - i;\n\t\t\tif (txmin <= txa) {\n\t\t\t\tthis.loadTile(tz, txa, ty, ox, oy, work);\n\t\t\t}\n\t\t\tconst txb = ctx + i;\n\t\t\tif (txb <= txmax) {\n\t\t\t\tthis.loadTile(tz, txb, ty, ox, oy, work);\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected loadTilesY(\n\t\ttz: number,\n\t\ttx: number,\n\t\tcty: number,\n\t\tlty: number,\n\t\ttymin: number,\n\t\ttymax: number,\n\t\tox: number,\n\t\toy: number,\n\t\twork: Point\n\t): void {\n\t\tthis.loadTile(tz, tx, cty, ox, oy, work);\n\t\tfor (let i = 1; i <= lty; ++i) {\n\t\t\tconst tya = cty - i;\n\t\t\tif (tymin <= tya) {\n\t\t\t\tthis.loadTile(tz, tx, tya, ox, oy, work);\n\t\t\t}\n\t\t\tconst tyb = cty + i;\n\t\t\tif (tyb <= tymax) {\n\t\t\t\tthis.loadTile(tz, tx, tyb, ox, oy, work);\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected loadTile(\n\t\ttz: number,\n\t\ttx: number,\n\t\tty: number,\n\t\tox: number,\n\t\toy: number,\n\t\twork: Point\n\t): void {\n\t\tconst coordinate = this._coordinate;\n\t\tconst tileCode = coordinate.toTileCode(tz, tx, ty);\n\t\tconst tiles = this._tiles;\n\t\tlet tile = tiles.get(tileCode);\n\t\tif (tile == null) {\n\t\t\tthis.toTilePosition(tx, ty, ox, oy, work);\n\t\t\ttile = this.newTile(tx, ty, work.x, work.y, this._tileScale);\n\t\t\ttiles.set(tileCode, tile);\n\t\t\ttile.load(this._builder(tz, tx, ty), this._onLoadedBound);\n\t\t\tthis._isLoaded = false;\n\t\t}\n\t}\n\n\tprotected toTilePosition(tx: number, ty: number, ox: number, oy: number, result: Point): Point {\n\t\tconst tileSize = this._tileSize;\n\t\tconst tileScaleRelative = this._tileScaleRelative;\n\t\tresult.set(tx, ty);\n\t\tthis._coordinate.tileToPixels(result, tileSize, result);\n\t\tresult.set(result.x * tileScaleRelative + ox, result.y * tileScaleRelative + oy);\n\t\treturn result;\n\t}\n\n\tprotected toOffset(result: Point): Point {\n\t\tconst parent = this._parent;\n\t\tconst mapping = this._mapping;\n\t\tconst tileSize = this._tileSize;\n\t\tresult.set(\n\t\t\t-mapping.x * tileSize + parent.width * 0.5,\n\t\t\t-mapping.y * tileSize + parent.height * 0.5\n\t\t);\n\t\treturn result;\n\t}\n\n\tprotected deleteTile(tile: DMapTile, tileCode: number, tiles: Map<number, DMapTile>): void {\n\t\tconst tx = tile.tx;\n\t\tconst ty = tile.ty;\n\t\tif (tx < this._txmin || this._txmax < tx || ty < this._tymin || this._tymax < ty) {\n\t\t\ttiles.delete(tileCode);\n\t\t\ttile.destroy();\n\t\t}\n\t}\n\n\tdestroy(): void {\n\t\tconst tiles = this._tiles;\n\t\ttiles.forEach(this._destroyTileBound);\n\t\ttiles.clear();\n\t}\n\n\tprotected destroyTile(tile: DMapTile): void {\n\t\ttile.destroy();\n\t}\n\n\tprotected updateLoadingState(): void {\n\t\tthis._isLoaded = true;\n\t\tthis._tiles.forEach(this._updateLoadingStateForEach);\n\t}\n\n\tprotected onLoaded(): void {\n\t\tif (this._isOnLoadedAllowed) {\n\t\t\tthis._onLoaded();\n\t\t} else {\n\t\t\tthis._isOnLoadedCalled = true;\n\t\t}\n\t}\n\n\tget loaded(): boolean {\n\t\tif (!this._isLoaded) {\n\t\t\tthis.updateLoadingState();\n\t\t}\n\t\treturn this._isLoaded;\n\t}\n\n\tget mapping(): DMapTileMappingInternal {\n\t\treturn this._mapping;\n\t}\n\n\tset mapping(mapping: DMapTileMappingInternal) {\n\t\tconst coordinate = this._coordinate;\n\t\tconst tileScale = mapping.scale * this._tileScaleRelative;\n\t\tconst tileSize = coordinate.getTileSize() * mapping.scale;\n\t\tthis._tileScale = tileScale;\n\t\tthis._tileSize = tileSize;\n\t\tthis._mapping = mapping;\n\n\t\tconst work = DMapTilePlane.WORK;\n\t\tthis.toOffset(work);\n\t\tconst offsetX = work.x;\n\t\tconst offsetY = work.y;\n\n\t\tthis._tiles.forEach((tile: DMapTile): void => {\n\t\t\tthis.toTilePosition(tile.tx, tile.ty, offsetX, offsetY, work);\n\t\t\ttile.transform(work.x, work.y, tileScale);\n\t\t});\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Point, Renderer, utils } from \"pixi.js\";\nimport { DApplications } from \"./d-applications\";\nimport { DBase } from \"./d-base\";\nimport { DMapCoordinate } from \"./d-map-coordinate\";\nimport { DMapTileMapping } from \"./d-map-tile-mapping\";\nimport { DMapTileMappingInternal } from \"./d-map-tile-mapping-internal\";\nimport { DMapTilePlane } from \"./d-map-tile-plane\";\nimport { DMapTilePyramid, DMapTilePyramidOptions } from \"./d-map-tile-pyramid\";\nimport { DMapTileUrlBuilder } from \"./d-map-tile-url-builder\";\n\nexport class DMapTilePyramidImpl extends utils.EventEmitter implements DMapTilePyramid {\n\tprotected static WORK_LONLAT: Point = new Point();\n\n\tprotected readonly _canvas: DBase;\n\tprotected readonly _builder: DMapTileUrlBuilder;\n\tprotected readonly _planes: Array<DMapTilePlane | undefined>;\n\tprotected _z: number;\n\tprotected _tz: number;\n\tprotected _minZ: number;\n\tprotected _maxZ: number;\n\tprotected _mapping: DMapTileMapping;\n\tprotected _mappingInternal: DMapTileMappingInternal;\n\tprotected _coordinate: DMapCoordinate;\n\tprotected _onLoadedBound: () => void;\n\tprotected _fitBound: () => void;\n\tprotected _fitBoundTimeout: number | undefined;\n\tprotected _fitThrottledBound: () => void;\n\tprotected _fitThrottle: number;\n\n\tconstructor(options: DMapTilePyramidOptions) {\n\t\tsuper();\n\t\tconst canvas = options.canvas;\n\t\tthis._canvas = canvas;\n\t\tthis._builder = options.builder;\n\t\tconst mapping = options.mapping;\n\t\tthis._mapping = mapping;\n\t\tconst coordinate = options.coordinate;\n\t\tthis._coordinate = coordinate;\n\t\tthis._mappingInternal = this.toMapping(canvas, mapping, coordinate);\n\t\tthis._z = NaN;\n\t\tthis._tz = NaN;\n\t\tthis._minZ = options.plane.min;\n\t\tthis._maxZ = options.plane.max;\n\t\tthis._planes = [];\n\t\tthis._onLoadedBound = (): void => {\n\t\t\tthis.onLoaded();\n\t\t};\n\t\tthis._fitBound = (): void => {\n\t\t\tthis._fitBoundTimeout = undefined;\n\t\t\tthis.fit();\n\t\t};\n\t\tthis._fitThrottle = options.plane.throttle;\n\t\tconst fitThrottledBound = (): void => {\n\t\t\tthis.fitThrottled();\n\t\t};\n\t\tthis._fitThrottledBound = fitThrottledBound;\n\t\tcanvas.on(\"scale\", fitThrottledBound);\n\t\tcanvas.on(\"move\", fitThrottledBound);\n\t\tcanvas.snippet.add(this, true);\n\t}\n\n\tget coordinate(): DMapCoordinate {\n\t\treturn this._coordinate;\n\t}\n\n\tprotected fitThrottled(): void {\n\t\tif (this._fitBoundTimeout == null) {\n\t\t\tthis._fitBoundTimeout = window.setTimeout(this._fitBound, this._fitThrottle);\n\t\t}\n\t}\n\n\tprotected toMapping(\n\t\tcanvas: DBase,\n\t\tmapping: DMapTileMapping,\n\t\tcoordinate: DMapCoordinate\n\t): DMapTileMappingInternal {\n\t\tconst work = DMapTilePyramidImpl.WORK_LONLAT;\n\t\tconst tileSize = coordinate.getTileSize();\n\n\t\twork.set(mapping.from.lon, mapping.from.lat);\n\t\tcoordinate.lonLatToPixels(work, 0, tileSize, work);\n\t\tconst x0 = work.x;\n\t\tconst y0 = work.y;\n\n\t\twork.set(mapping.to.lon, mapping.to.lat);\n\t\tcoordinate.lonLatToPixels(work, 0, tileSize, work);\n\t\tconst x1 = work.x;\n\t\tconst y1 = work.y;\n\n\t\tconst dx = Math.abs(x1 - x0);\n\t\tconst dy = Math.abs(y1 - y0);\n\t\tconst dmin = 0.0000001;\n\t\tlet scale = 1;\n\t\tif (dmin < dx) {\n\t\t\tif (dmin < dy) {\n\t\t\t\tscale = Math.max(canvas.width / dx, canvas.height / dy);\n\t\t\t} else {\n\t\t\t\tscale = canvas.width / dx;\n\t\t\t}\n\t\t} else {\n\t\t\tif (dmin < dy) {\n\t\t\t\tscale = canvas.height / dy;\n\t\t\t}\n\t\t}\n\t\treturn {\n\t\t\tscale,\n\t\t\tx: (0.5 * (x1 + x0)) / tileSize,\n\t\t\ty: (0.5 * (y1 + y0)) / tileSize\n\t\t};\n\t}\n\n\tget mapping(): DMapTileMapping {\n\t\treturn this._mapping;\n\t}\n\n\tset mapping(mapping: DMapTileMapping) {\n\t\tconst oldMapping = this._mappingInternal;\n\t\tconst newMapping = this.toMapping(this._canvas, mapping, this._coordinate);\n\t\tconst threshold = 0.0000001;\n\t\tif (\n\t\t\tthreshold < Math.abs(oldMapping.scale - newMapping.scale) ||\n\t\t\tthreshold < Math.abs(oldMapping.x - newMapping.x) ||\n\t\t\tthreshold < Math.abs(oldMapping.y - newMapping.y)\n\t\t) {\n\t\t\tthis._mappingInternal = newMapping;\n\n\t\t\tconst planes = this._planes;\n\t\t\tfor (let i = 0, imax = planes.length; i < imax; ++i) {\n\t\t\t\tconst plane = planes[i];\n\t\t\t\tif (plane) {\n\t\t\t\t\tplane.mapping = newMapping;\n\t\t\t\t}\n\t\t\t}\n\t\t\tDApplications.update(this._canvas);\n\n\t\t\tthis._fitThrottledBound();\n\t\t}\n\t}\n\n\tprotected newPlane(tz: number): DMapTilePlane {\n\t\treturn new DMapTilePlane(\n\t\t\tthis._canvas,\n\t\t\tthis._builder,\n\t\t\ttz,\n\t\t\tthis._mappingInternal,\n\t\t\tthis._coordinate,\n\t\t\tthis._onLoadedBound\n\t\t);\n\t}\n\n\trender(renderer: Renderer): void {\n\t\tconst tz = this._tz;\n\t\tconst planes = this._planes;\n\t\tfor (let i = 0; i < tz; ++i) {\n\t\t\tconst plane = planes[i];\n\t\t\tif (plane != null) {\n\t\t\t\tplane.render(renderer);\n\t\t\t}\n\t\t}\n\n\t\tfor (let i = planes.length - 1; tz < i; --i) {\n\t\t\tconst plane = planes[i];\n\t\t\tif (plane != null) {\n\t\t\t\tplane.render(renderer);\n\t\t\t}\n\t\t}\n\n\t\tconst planeTz = planes[tz];\n\t\tif (planeTz != null) {\n\t\t\tplaneTz.render(renderer);\n\t\t}\n\t}\n\n\tprotected toTileZ(tz: number): number {\n\t\treturn Math.min(this._maxZ, Math.max(this._minZ, Math.floor(tz)));\n\t}\n\n\tupdateTransform(): void {\n\t\t// DO NOTHING\n\t}\n\n\tprotected toZ(scale: number): number {\n\t\treturn Math.log(this._mappingInternal.scale * scale) / Math.log(2);\n\t}\n\n\tmove(scale: number, lon0: number, lat0: number, lon1: number, lat1: number): this {\n\t\tconst planes = this._planes;\n\t\tconst z = this.toZ(scale);\n\t\tif (this._z !== z) {\n\t\t\tthis._z = z;\n\n\t\t\tconst tz = this.toTileZ(z);\n\t\t\tif (this._tz !== tz) {\n\t\t\t\tthis._tz = tz;\n\n\t\t\t\tlet newPlane = planes[tz];\n\t\t\t\tif (newPlane == null) {\n\t\t\t\t\tnewPlane = this.newPlane(tz);\n\t\t\t\t\tplanes[tz] = newPlane;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst plane = planes[this._tz];\n\t\tif (plane != null) {\n\t\t\tplane.move(lon0, lat0, lon1, lat1);\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tfit(): this {\n\t\tconst canvas = this._canvas;\n\t\tif (canvas != null) {\n\t\t\tconst container = canvas.parent;\n\t\t\tif (container != null) {\n\t\t\t\tconst scale = canvas.scale;\n\t\t\t\tconst scaleX = scale.x;\n\t\t\t\tconst scaleY = scale.y;\n\t\t\t\tconst x = canvas.x;\n\t\t\t\tconst y = canvas.y;\n\t\t\t\tconst coordinate = this._coordinate;\n\t\t\t\tconst mapping = this._mappingInternal;\n\t\t\t\tconst tileSize = coordinate.getTileSize() * mapping.scale;\n\t\t\t\tconst x0 = mapping.x * tileSize - (x / scaleX + 0.5 * canvas.width);\n\t\t\t\tconst x1 = x0 + container.width / scaleX;\n\t\t\t\tconst y0 = mapping.y * tileSize - (y / scaleY + 0.5 * canvas.height);\n\t\t\t\tconst y1 = y0 + container.height / scaleY;\n\n\t\t\t\tconst work = DMapTilePyramidImpl.WORK_LONLAT;\n\t\t\t\twork.set(x0, y0);\n\t\t\t\tcoordinate.pixelsToLonLat(work, 0, tileSize, work);\n\t\t\t\tconst lon0 = work.x;\n\t\t\t\tconst lat0 = work.y;\n\n\t\t\t\twork.set(x1, y1);\n\t\t\t\tcoordinate.pixelsToLonLat(work, 0, tileSize, work);\n\t\t\t\tconst lon1 = work.x;\n\t\t\t\tconst lat1 = work.y;\n\n\t\t\t\tthis.move(scaleX, lon0, lat0, lon1, lat1);\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tprotected destroyPlanesBefore(tz: number, planes: Array<DMapTilePlane | undefined>): void {\n\t\tfor (let i = 0; i < tz; ++i) {\n\t\t\tconst plane = planes[i];\n\t\t\tif (plane) {\n\t\t\t\tplane.destroy();\n\t\t\t\tplanes[i] = undefined;\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected destroyPlanesAfter(tz: number, planes: Array<DMapTilePlane | undefined>): void {\n\t\tfor (let i = tz + 1, imax = planes.length; i < imax; ++i) {\n\t\t\tconst plane = planes[i];\n\t\t\tif (plane) {\n\t\t\t\tplane.destroy();\n\t\t\t\tplanes[i] = undefined;\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected cleanup(): void {\n\t\tconst tz = this._tz;\n\t\tconst planes = this._planes;\n\t\tconst planeTz = planes[tz];\n\t\tif (planeTz && planeTz.loaded) {\n\t\t\tthis.destroyPlanesBefore(tz, planes);\n\t\t\tthis.destroyPlanesAfter(tz, planes);\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let i = tz + 1, imax = planes.length; i < imax; ++i) {\n\t\t\tconst plane = planes[i];\n\t\t\tif (plane && plane.loaded) {\n\t\t\t\tthis.destroyPlanesBefore(tz, planes);\n\t\t\t\tthis.destroyPlanesAfter(i, planes);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tfor (let i = tz - 1; 0 <= i; --i) {\n\t\t\tconst plane = planes[i];\n\t\t\tif (plane && plane.loaded) {\n\t\t\t\tthis.destroyPlanesBefore(i, planes);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected onLoaded(): void {\n\t\tthis.cleanup();\n\t\tDApplications.update(this._canvas);\n\t}\n\n\tdestroy(): this {\n\t\tconst planes = this._planes;\n\t\tfor (let i = 0, imax = planes.length; i < imax; ++i) {\n\t\t\tconst plane = planes[i];\n\t\t\tif (plane) {\n\t\t\t\tplane.destroy();\n\t\t\t\tplanes[i] = undefined;\n\t\t\t}\n\t\t}\n\n\t\tconst canvas = this._canvas;\n\t\tconst fitThrottledBound = this._fitThrottledBound;\n\t\tcanvas.off(\"scale\", fitThrottledBound);\n\t\tcanvas.off(\"move\", fitThrottledBound);\n\t\tcanvas.snippet.remove(this, true);\n\n\t\treturn this;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDiagramCanvasBase } from \"./d-diagram-canvas-base\";\nimport { DMapCoordinate } from \"./d-map-coordinate\";\nimport { DMapCoordinates } from \"./d-map-coordinates\";\nimport { DMapTilePyramid, DMapTilePyramidPlaneOptions } from \"./d-map-tile-pyramid\";\nimport { DMapTilePyramidImpl } from \"./d-map-tile-pyramid-impl\";\nimport { DMapTileUrlBuilder } from \"./d-map-tile-url-builder\";\n\nexport const DMapTileUrlBuilderKokudo: DMapTileUrlBuilder = (\n\ttz: number,\n\ttx: number,\n\tty: number\n): string => {\n\tif (5 <= tz) {\n\t\treturn `https://cyberjapandata.gsi.go.jp/xyz/pale/${tz}/${tx}/${ty}.png`;\n\t} else if (2 <= tz) {\n\t\treturn `https://cyberjapandata.gsi.go.jp/xyz/std/${tz}/${tx}/${ty}.png`;\n\t} else {\n\t\treturn `https://cyberjapandata.gsi.go.jp/xyz/earthhillshade/${tz}/${tx}/${ty}.png`;\n\t}\n};\n\nexport const DMapTileUrlBuilderOsm: DMapTileUrlBuilder = (\n\ttz: number,\n\ttx: number,\n\tty: number\n): string => {\n\treturn `https://${\"abc\"[(tx + ty) % 3]}.tile.openstreetmap.org/${tz}/${tx}/${ty}.png`;\n};\n\nexport const DMapTileUrlBuilderOsmfj: DMapTileUrlBuilder = (\n\ttz: number,\n\ttx: number,\n\tty: number\n): string => {\n\treturn `https://j.tile.openstreetmap.jp/${tz}/${tx}/${ty}.png`;\n};\n\nexport interface DMapTilePyramidsFromOptions {\n\tcanvas: DDiagramCanvasBase<any, any>;\n\tbuilder?: DMapTileUrlBuilder;\n\tcoordinate?: DMapCoordinate;\n\tplane?: Partial<DMapTilePyramidPlaneOptions>;\n}\n\nexport class DMapTilePyramids {\n\tprotected static MIN: number = 0;\n\tprotected static MAX: number = 18;\n\tprotected static THROTTLE: number = 333;\n\n\tprotected static toPlaneOptions(\n\t\toptions: DMapTilePyramidsFromOptions\n\t): DMapTilePyramidPlaneOptions {\n\t\tconst plane = options.plane;\n\t\treturn {\n\t\t\tmin: plane?.min ?? this.MIN,\n\t\t\tmax: plane?.max ?? this.MAX,\n\t\t\tthrottle: plane?.throttle ?? this.THROTTLE\n\t\t};\n\t}\n\n\tstatic from(options: DMapTilePyramidsFromOptions): DMapTilePyramid {\n\t\treturn new DMapTilePyramidImpl({\n\t\t\tcanvas: options.canvas,\n\t\t\tbuilder: options.builder || DMapTileUrlBuilderOsmfj,\n\t\t\tmapping: options.canvas.tile.mapping,\n\t\t\tcoordinate: options.coordinate || DMapCoordinates.DEFAULT,\n\t\t\tplane: this.toPlaneOptions(options)\n\t\t});\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction } from \"pixi.js\";\nimport { DButton, DButtonOptions, DThemeButton } from \"./d-button\";\nimport { DMenu, DMenuOptions } from \"./d-menu\";\nimport { DMenuItem } from \"./d-menu-item\";\nimport { UtilKeyboardEvent } from \"./util/util-keyboard-event\";\n\nexport interface DMenuBarItemOptions<\n\tVALUE = unknown,\n\tTHEME extends DThemeMenuBarItem<VALUE> = DThemeMenuBarItem<VALUE>\n> extends DButtonOptions<VALUE, THEME> {\n\tmenu?: DMenuOptions<VALUE> | DMenu<VALUE>;\n}\n\nexport interface DThemeMenuBarItem<VALUE = unknown> extends DThemeButton<VALUE> {}\n\nexport class DMenuBarItem<\n\tVALUE = unknown,\n\tTHEME extends DThemeMenuBarItem<VALUE> = DThemeMenuBarItem<VALUE>,\n\tOPTIONS extends DMenuBarItemOptions<VALUE, THEME> = DMenuBarItemOptions<VALUE, THEME>\n> extends DButton<VALUE, THEME, OPTIONS> {\n\tprotected _menu?: DMenu<VALUE>;\n\n\tprotected toMenu(theme: THEME, options?: OPTIONS): DMenu<VALUE> {\n\t\tconst menu = options?.menu;\n\t\tif (menu instanceof DMenu) {\n\t\t\treturn menu;\n\t\t} else {\n\t\t\treturn new DMenu(this.toMenuOptions(theme, menu));\n\t\t}\n\t}\n\n\tprotected newMenu(theme: THEME, options?: DMenuOptions<VALUE>): DMenu<VALUE> {\n\t\treturn new DMenu<VALUE>(this.toMenuOptions(theme, options));\n\t}\n\n\tprotected toMenuOptions(\n\t\ttheme: THEME,\n\t\toptions?: DMenuOptions<VALUE>\n\t): DMenuOptions<VALUE> | undefined {\n\t\tif (options) {\n\t\t\tif (options.fit == null) {\n\t\t\t\toptions.fit = false;\n\t\t\t}\n\t\t\treturn options;\n\t\t}\n\t\treturn {\n\t\t\tfit: false\n\t\t};\n\t}\n\n\tprotected onActivate(\n\t\te?: interaction.InteractionEvent | KeyboardEvent | MouseEvent | TouchEvent\n\t): void {\n\t\tsuper.onActivate(e);\n\t\tthis.open();\n\t}\n\n\topen(): void {\n\t\tthis.menu.open(this);\n\t}\n\n\tclose(): void {\n\t\tthis.menu.close();\n\t}\n\n\tget menu(): DMenu<VALUE> {\n\t\tlet result = this._menu;\n\t\tif (result == null) {\n\t\t\tresult = this.toMenu(this.theme, this._options);\n\t\t\tresult.on(\n\t\t\t\t\"select\",\n\t\t\t\t(value: VALUE, item: DMenuItem<VALUE>, menu: DMenu<VALUE>): void => {\n\t\t\t\t\tthis.onMenuSelect(value, item, menu);\n\t\t\t\t}\n\t\t\t);\n\t\t\tthis._menu = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected onMenuSelect(value: VALUE, item: DMenuItem<VALUE>, menu: DMenu<VALUE>): void {\n\t\tthis.emit(\"select\", value, item, this);\n\t\tconst parent = this.parent;\n\t\tif (parent) {\n\t\t\tparent.emit(\"select\", value, item, parent);\n\t\t}\n\t}\n\n\tonKeyDown(e: KeyboardEvent): boolean {\n\t\tif (UtilKeyboardEvent.isArrowDownKey(e)) {\n\t\t\tthis.onKeyDownArrowDown(e);\n\t\t}\n\t\treturn super.onKeyDown(e);\n\t}\n\n\tprotected onKeyDownArrowDown(e: KeyboardEvent): boolean {\n\t\tif (this.state.isActionable && this.state.isFocused) {\n\t\t\tthis.onActivate(e);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DMenuBarItem\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DisplayObject } from \"pixi.js\";\nimport {\n\tDLayoutHorizontal,\n\tDLayoutHorizontalOptions,\n\tDThemeLayoutHorizontal\n} from \"./d-layout-horizontal\";\nimport { DLayoutSpace, DLayoutSpaceOptions, DThemeLayoutSpace } from \"./d-layout-space\";\nimport { DMenuBarItem, DMenuBarItemOptions } from \"./d-menu-bar-item\";\nimport { UtilKeyboardEvent } from \"./util/util-keyboard-event\";\n\nexport interface DMenuBarItemSpaceOptions<\n\tTHEME extends DThemeMenuBarItemSpace = DThemeMenuBarItemSpace\n> extends DLayoutSpaceOptions<THEME> {\n\tspace: true;\n}\n\nexport interface DThemeMenuBarItemSpace extends DThemeLayoutSpace {}\n\nexport interface DMenuBarOptions<VALUE = unknown, THEME extends DThemeMenuBar = DThemeMenuBar>\n\textends DLayoutHorizontalOptions<THEME> {\n\titems?: Array<DMenuBarItemOptions<VALUE> | DMenuBarItemSpaceOptions | DisplayObject | null>;\n}\n\nexport interface DThemeMenuBar extends DThemeLayoutHorizontal {}\n\nexport class DMenuBar<\n\tVALUE = unknown,\n\tTHEME extends DThemeMenuBar = DThemeMenuBar,\n\tOPTIONS extends DMenuBarOptions<VALUE, THEME> = DMenuBarOptions<VALUE, THEME>\n> extends DLayoutHorizontal<THEME, OPTIONS> {\n\tprotected init(options?: OPTIONS): void {\n\t\tsuper.init(options);\n\n\t\tconst items = options?.items;\n\t\tif (items) {\n\t\t\tfor (let i = 0, imax = items.length; i < imax; ++i) {\n\t\t\t\tconst item = this.toItem(items[i]);\n\t\t\t\tif (item) {\n\t\t\t\t\tthis.addChild(item);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected toItem(\n\t\titem: DMenuBarItemOptions<VALUE> | DMenuBarItemSpaceOptions | DisplayObject | null\n\t): DisplayObject | null {\n\t\tif (item == null) {\n\t\t\treturn null;\n\t\t} else if (item instanceof DisplayObject) {\n\t\t\treturn item;\n\t\t} else if (\"space\" in item) {\n\t\t\treturn new DLayoutSpace(item);\n\t\t}\n\t\treturn new DMenuBarItem<VALUE>(item);\n\t}\n\n\tonKeyDown(e: KeyboardEvent): boolean {\n\t\tUtilKeyboardEvent.moveFocusHorizontally(e, this);\n\t\treturn super.onKeyDown(e);\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DMenuBar\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DLayoutHorizontal } from \"./d-layout-horizontal\";\nimport { DLayoutVerticalOptions, DThemeLayoutVertical } from \"./d-layout-vertical\";\n\nexport interface DMenuSidedContentOptions<\n\tTHEME extends DThemeMenuSidedContent = DThemeMenuSidedContent\n> extends DLayoutVerticalOptions<THEME> {}\n\nexport interface DThemeMenuSidedContent extends DThemeLayoutVertical {}\n\nexport class DMenuSidedContent<\n\tTHEME extends DThemeMenuSidedContent = DThemeMenuSidedContent,\n\tOPTIONS extends DMenuSidedContentOptions<THEME> = DMenuSidedContentOptions<THEME>\n> extends DLayoutHorizontal<THEME, OPTIONS> {\n\tprotected initReflowable(): void {\n\t\t// DO NOTHING\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DMenuSidedContent\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Container, utils } from \"pixi.js\";\nimport { DBase } from \"./d-base\";\nimport { DBaseState } from \"./d-base-state\";\nimport { DMenu } from \"./d-menu\";\nimport { DMenuItemBase } from \"./d-menu-item-base\";\nimport { DOnOptions } from \"./d-on-options\";\nimport { toEnum } from \"./util/to-enum\";\n\nexport const DMenuSidedSelectionType = {\n\tNONE: 0,\n\tSINGLE: 1,\n\tSINGLE_ONCE: 2\n} as const;\n\nexport type DMenuSidedSelectionType =\n\ttypeof DMenuSidedSelectionType[keyof typeof DMenuSidedSelectionType];\n\n/**\n * {@link DMenuSidedSelection} events.\n */\nexport interface DMenuSidedSelectionEvents<EMITTER> {\n\t/**\n\t * Triggered when a selection is changed.\n\t *\n\t * @param emitter an emitter\n\t */\n\tchange(emitter: EMITTER): void;\n}\n\n/**\n * {@link DMenuSidedSelection} \"on\" options.\n */\nexport interface DMenuSidedSelectionOnOptions<EMITTER>\n\textends Partial<DMenuSidedSelectionEvents<EMITTER>>,\n\t\tDOnOptions {}\n\n/**\n * {@link DMenuSidedSelection} options.\n */\nexport interface DMenuSidedSelectionOptions<EMITTER = any> {\n\t/**\n\t * @deprecated in favor of {@link type}\n\t */\n\tmode?: DMenuSidedSelectionType | keyof typeof DMenuSidedSelectionType;\n\n\t/**\n\t * A selection type.\n\t */\n\ttype?: DMenuSidedSelectionType | keyof typeof DMenuSidedSelectionType;\n\n\ton?: DMenuSidedSelectionOnOptions<EMITTER>;\n\n\tfilter?: (item: DBase | null) => boolean;\n}\n\nconst defaultFilter = () => true;\n\nexport class DMenuSidedSelection<VALUE> extends utils.EventEmitter {\n\tprotected _content: Container;\n\tprotected _item: DMenuItemBase<VALUE> | null;\n\tprotected _isDirty: boolean;\n\tprotected _type: DMenuSidedSelectionType;\n\tprotected _filter: (item: DMenuItemBase<VALUE> | null) => boolean;\n\n\tconstructor(content: Container, options?: DMenuSidedSelectionOptions) {\n\t\tsuper();\n\n\t\tthis._content = content;\n\t\tthis._item = null;\n\t\tthis._isDirty = true;\n\t\tthis._type = toEnum(\n\t\t\toptions?.mode ?? options?.type ?? DMenuSidedSelectionType.SINGLE_ONCE,\n\t\t\tDMenuSidedSelectionType\n\t\t);\n\t\tthis._filter = options?.filter ?? this.getFilterDefault();\n\n\t\t// Events\n\t\tconst on = options?.on;\n\t\tif (on) {\n\t\t\tfor (const name in on) {\n\t\t\t\tconst handler = on[name];\n\t\t\t\tif (handler) {\n\t\t\t\t\tthis.on(name, handler);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tfirst(): DMenuItemBase<VALUE> | null {\n\t\treturn this._item;\n\t}\n\n\ttoDirty(): void {\n\t\tthis._isDirty = true;\n\t}\n\n\tupdate(): void {\n\t\tif (this._isDirty) {\n\t\t\tthis._isDirty = false;\n\t\t\tthis.update_(this._content);\n\t\t}\n\t}\n\n\tprotected hasMenu(child: any): child is { menu: DMenu<any> } {\n\t\treturn child && child.menu instanceof DMenu;\n\t}\n\n\tprotected update_(root: Container): void {\n\t\tconst children = root.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tconst child = children[i];\n\t\t\tif (child instanceof DMenuItemBase) {\n\t\t\t\tif (child.state.isActive) {\n\t\t\t\t\tthis.set_(child, false);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (child instanceof Container) {\n\t\t\t\tthis.update_(child);\n\t\t\t}\n\n\t\t\tif (this.hasMenu(child)) {\n\t\t\t\tthis.update_(child.menu);\n\t\t\t}\n\t\t}\n\t}\n\n\tadd(item: DMenuItemBase<VALUE>): void {\n\t\tthis.update();\n\t\tthis.set_(item, true);\n\t}\n\n\tset(item: DMenuItemBase<VALUE>): void {\n\t\tthis.update();\n\t\tthis.set_(item, true);\n\t}\n\n\tget(index: number): DMenuItemBase<VALUE> | null {\n\t\tthis.update();\n\t\treturn this._item;\n\t}\n\n\tgetIndex(index: number): number | null {\n\t\treturn null;\n\t}\n\n\tsize(): number {\n\t\treturn this._item ? 1 : 0;\n\t}\n\n\tisEmpty(): boolean {\n\t\treturn this._item == null;\n\t}\n\n\tremove(item: DBase): void {\n\t\tthis.update();\n\t\tif (this._item === item) {\n\t\t\tthis.set_(null, true);\n\t\t}\n\t}\n\n\tclear(): void {\n\t\tthis.update();\n\t\tthis.set_(null, true);\n\t}\n\n\tprotected getFilterDefault(): (item: DMenuItemBase<VALUE> | null) => boolean {\n\t\treturn defaultFilter;\n\t}\n\n\tprotected set_(item: DMenuItemBase<VALUE> | null, emit: boolean): void {\n\t\tconst oldItem = this._item;\n\t\tconst mode = this._type;\n\t\tif (mode !== DMenuSidedSelectionType.NONE && this._filter(item) && oldItem !== item) {\n\t\t\tthis.setState(oldItem, mode, false);\n\t\t\tthis._item = item;\n\t\t\tthis.setState(item, mode, true);\n\t\t\tif (emit) {\n\t\t\t\tthis.emit(\"change\", this);\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected setState(item: DBase | null, mode: DMenuSidedSelectionType, isOn: boolean): void {\n\t\tif (item) {\n\t\t\tif (mode === DMenuSidedSelectionType.SINGLE) {\n\t\t\t\titem.state.isActive = isOn;\n\t\t\t} else {\n\t\t\t\tif (isOn) {\n\t\t\t\t\titem.state.addAll(DBaseState.ACTIVE, DBaseState.READ_ONLY);\n\t\t\t\t} else {\n\t\t\t\t\titem.state.removeAll(DBaseState.ACTIVE, DBaseState.READ_ONLY);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DisplayObject } from \"pixi.js\";\nimport { DBase, DBaseOptions } from \"./d-base\";\nimport { Closeable, DMenuContext } from \"./d-menu-context\";\nimport { DMenuItemOptionsUnion } from \"./d-menu-item-options-union\";\nimport { DMenuSidedContent, DMenuSidedContentOptions } from \"./d-menu-sided-content\";\nimport { DMenuSidedSelection, DMenuSidedSelectionOptions } from \"./d-menu-sided-selection\";\nimport { DMenuSideds } from \"./d-menu-sideds\";\nimport { DPane, DPaneOptions, DThemePane } from \"./d-pane\";\nimport { UtilKeyboardEvent } from \"./util/util-keyboard-event\";\n\nexport interface DMenuSidedOptions<\n\tVALUE = unknown,\n\tTHEME extends DThemeMenuSided = DThemeMenuSided,\n\tCONTENT_OPTIONS extends DBaseOptions = DMenuSidedContentOptions\n> extends DPaneOptions<THEME, CONTENT_OPTIONS> {\n\titems?: Array<DMenuItemOptionsUnion<VALUE> | DisplayObject>;\n\tsticky?: boolean;\n\tselection?: DMenuSidedSelectionOptions | DMenuSidedSelection<VALUE>;\n}\n\nexport interface DThemeMenuSided extends DThemePane {}\n\nexport class DMenuSided<\n\tVALUE = unknown,\n\tTHEME extends DThemeMenuSided = DThemeMenuSided,\n\tCONTENT_OPTIONS extends DMenuSidedContentOptions = DMenuSidedContentOptions,\n\tOPTIONS extends DMenuSidedOptions<VALUE, THEME, CONTENT_OPTIONS> = DMenuSidedOptions<\n\t\tVALUE,\n\t\tTHEME,\n\t\tCONTENT_OPTIONS\n\t>\n> extends DPane<THEME, CONTENT_OPTIONS, OPTIONS> {\n\tprotected _context: DMenuContext | null;\n\tprotected _selection: DMenuSidedSelection<VALUE>;\n\n\tconstructor(options?: OPTIONS) {\n\t\tsuper(options);\n\n\t\tconst context = new DMenuContext(this);\n\t\tthis._context = context;\n\t\tcontext.add(this);\n\n\t\tconst items = options?.items;\n\t\tif (items != null) {\n\t\t\tconst sticky = options?.sticky ?? false;\n\t\t\tthis.newItems(items, sticky);\n\t\t}\n\n\t\tconst selection = options?.selection;\n\t\tthis._selection =\n\t\t\tselection instanceof DMenuSidedSelection ? selection : this.newSelection(selection);\n\t}\n\n\tprotected newSelection(options?: DMenuSidedSelectionOptions): DMenuSidedSelection<VALUE> {\n\t\treturn new DMenuSidedSelection<VALUE>(this.content, options);\n\t}\n\n\tprotected onChildrenDirty(): void {\n\t\tconst selection = this._selection;\n\t\tif (selection != null) {\n\t\t\tselection.toDirty();\n\t\t}\n\t\tsuper.onChildrenDirty();\n\t}\n\n\tprotected newItems(\n\t\titems: Array<DMenuItemOptionsUnion<VALUE> | DisplayObject>,\n\t\tsticky: boolean\n\t): void {\n\t\tDMenuSideds.newItems(this.content, items, sticky);\n\t}\n\n\tprotected newContent(options?: CONTENT_OPTIONS): DBase {\n\t\treturn new DMenuSidedContent(options);\n\t}\n\n\tget selection(): DMenuSidedSelection<VALUE> {\n\t\treturn this._selection;\n\t}\n\n\tgetContext(): DMenuContext | null {\n\t\treturn this._context;\n\t}\n\n\tgetCloseable(): Closeable | null {\n\t\treturn this;\n\t}\n\n\topen(): void {\n\t\t// DO NOTHING\n\t}\n\n\tclose(): void {\n\t\t// DO NOTHING\n\t}\n\n\tonKeyDown(e: KeyboardEvent): boolean {\n\t\tUtilKeyboardEvent.moveFocusVertically(e, this);\n\t\treturn super.onKeyDown(e);\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DMenuSided\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DNote, DNoteOptions, DThemeNote } from \"./d-note\";\n\nexport interface DNoteErrorOptions<THEME extends DThemeNoteError = DThemeNoteError>\n\textends DNoteOptions<THEME> {}\n\nexport interface DThemeNoteError extends DThemeNote {}\n\nexport class DNoteError<\n\tTHEME extends DThemeNote = DThemeNote,\n\tOPTIONS extends DNoteOptions<THEME> = DNoteOptions<THEME>\n> extends DNote<THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DNoteError\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DNote, DNoteOptions, DThemeNote } from \"./d-note\";\n\nexport interface DNoteNoItemsFoundOptions<\n\tTHEME extends DThemeNoteNoItemsFound = DThemeNoteNoItemsFound\n> extends DNoteOptions<THEME> {}\n\nexport interface DThemeNoteNoItemsFound extends DThemeNote {}\n\nexport class DNoteNoItemsFound<\n\tTHEME extends DThemeNote = DThemeNote,\n\tOPTIONS extends DNoteOptions<THEME> = DNoteOptions<THEME>\n> extends DNote<THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DNoteNoItemsFound\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DNote, DNoteOptions, DThemeNote } from \"./d-note\";\n\nexport interface DNoteSearchingOptions<THEME extends DThemeNoteSearching = DThemeNoteSearching>\n\textends DNoteOptions<THEME> {}\n\nexport interface DThemeNoteSearching extends DThemeNote {}\n\nexport class DNoteSearching<\n\tTHEME extends DThemeNote = DThemeNote,\n\tOPTIONS extends DNoteOptions<THEME> = DNoteOptions<THEME>\n> extends DNote<THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DNoteSearching\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBase, DBaseOptions, DThemeBase } from \"./d-base\";\n\nexport interface DNotificationOptions<THEME extends DThemeNotification>\n\textends DBaseOptions<THEME> {}\n\nexport interface DThemeNotification extends DThemeBase {}\n\nexport class DNotification<\n\tTHEME extends DThemeNotification = DThemeNotification,\n\tOPTIONS extends DNotificationOptions<THEME> = DNotificationOptions<THEME>\n> extends DBase<THEME, OPTIONS> {}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DButtonAmbient, DButtonAmbientOptions, DThemeButtonAmbient } from \"./d-button-ambient\";\n\nexport interface DPaginationButtonLastOptions<\n\tTHEME extends DThemePaginationButtonLast = DThemePaginationButtonLast\n> extends DButtonAmbientOptions<string, THEME> {}\n\nexport interface DThemePaginationButtonLast extends DThemeButtonAmbient<string> {}\n\nexport class DPaginationButtonLast<\n\tTHEME extends DThemePaginationButtonLast = DThemePaginationButtonLast,\n\tOPTIONS extends DPaginationButtonLastOptions<THEME> = DPaginationButtonLastOptions<THEME>\n> extends DButtonAmbient<string, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DPaginationButtonLast\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DButtonAmbient, DButtonAmbientOptions, DThemeButtonAmbient } from \"./d-button-ambient\";\n\nexport interface DPaginationButtonNextOptions<\n\tTHEME extends DThemePaginationButtonNext = DThemePaginationButtonNext\n> extends DButtonAmbientOptions<string, THEME> {}\n\nexport interface DThemePaginationButtonNext extends DThemeButtonAmbient<string> {}\n\nexport class DPaginationButtonNext<\n\tTHEME extends DThemePaginationButtonNext = DThemePaginationButtonNext,\n\tOPTIONS extends DPaginationButtonNextOptions<THEME> = DPaginationButtonNextOptions<THEME>\n> extends DButtonAmbient<string, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DPaginationButtonNext\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DButtonAmbient, DButtonAmbientOptions, DThemeButtonAmbient } from \"./d-button-ambient\";\n\nexport interface DPaginationButtonPageOptions<\n\tTHEME extends DThemePaginationButtonPage = DThemePaginationButtonPage\n> extends DButtonAmbientOptions<number, THEME> {}\n\nexport interface DThemePaginationButtonPage extends DThemeButtonAmbient<number> {}\n\nexport class DPaginationButtonPage<\n\tTHEME extends DThemePaginationButtonPage = DThemePaginationButtonPage,\n\tOPTIONS extends DPaginationButtonPageOptions<THEME> = DPaginationButtonPageOptions<THEME>\n> extends DButtonAmbient<number, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DPaginationButtonPage\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DButtonAmbient, DButtonAmbientOptions, DThemeButtonAmbient } from \"./d-button-ambient\";\n\nexport interface DPaginationButtonPreviousOptions<\n\tTHEME extends DThemePaginationButtonPrevious = DThemePaginationButtonPrevious\n> extends DButtonAmbientOptions<string, THEME> {}\n\nexport interface DThemePaginationButtonPrevious extends DThemeButtonAmbient<string> {}\n\nexport class DPaginationButtonPrevious<\n\tTHEME extends DThemePaginationButtonPrevious = DThemePaginationButtonPrevious,\n\tOPTIONS extends DPaginationButtonPreviousOptions<THEME> = DPaginationButtonPreviousOptions<THEME>\n> extends DButtonAmbient<string, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DPaginationButtonPrevious\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DButtonAmbient, DButtonAmbientOptions, DThemeButtonAmbient } from \"./d-button-ambient\";\n\nexport interface DPaginationButtonTopOptions<\n\tTHEME extends DThemePaginationButtonTop = DThemePaginationButtonTop\n> extends DButtonAmbientOptions<string, THEME> {}\n\nexport interface DThemePaginationButtonTop extends DThemeButtonAmbient<string> {}\n\nexport class DPaginationButtonTop<\n\tTHEME extends DThemePaginationButtonTop = DThemePaginationButtonTop,\n\tOPTIONS extends DPaginationButtonTopOptions<THEME> = DPaginationButtonTopOptions<THEME>\n> extends DButtonAmbient<string, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DPaginationButtonTop\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DImageBase, DImageBaseOptions, DThemeImageBase } from \"./d-image-base\";\n\nexport interface DPaginationDotsOptions<THEME extends DThemePaginationDots = DThemePaginationDots>\n\textends DImageBaseOptions<string, THEME> {}\n\nexport interface DThemePaginationDots extends DThemeImageBase<string> {}\n\nexport class DPaginationDots<\n\tTHEME extends DThemePaginationDots = DThemePaginationDots,\n\tOPTIONS extends DPaginationDotsOptions<THEME> = DPaginationDotsOptions<THEME>\n> extends DImageBase<string, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DPaginationDots\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DImageBase, DImageBaseOptions, DThemeImageBase } from \"./d-image-base\";\n\nexport interface DPaginationPageOptions<THEME extends DThemePaginationPage = DThemePaginationPage>\n\textends DImageBaseOptions<number, THEME> {}\n\nexport interface DThemePaginationPage extends DThemeImageBase<number> {}\n\nexport class DPaginationPage<\n\tTHEME extends DThemePaginationPage = DThemePaginationPage,\n\tOPTIONS extends DPaginationPageOptions<THEME> = DPaginationPageOptions<THEME>\n> extends DImageBase<number, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DPaginationPage\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DButton } from \"./d-button\";\nimport {\n\tDLayoutHorizontal,\n\tDLayoutHorizontalOptions,\n\tDThemeLayoutHorizontal\n} from \"./d-layout-horizontal\";\nimport { DPaginationDots } from \"./d-pagination-dots\";\nimport { DPaginationButtonLast, DPaginationButtonLastOptions } from \"./d-pagination-button-last\";\nimport { DPaginationButtonNext, DPaginationButtonNextOptions } from \"./d-pagination-button-next\";\nimport { DPaginationButtonPage, DPaginationButtonPageOptions } from \"./d-pagination-button-page\";\nimport {\n\tDPaginationButtonPrevious,\n\tDPaginationButtonPreviousOptions\n} from \"./d-pagination-button-previous\";\nimport { DPaginationButtonTop, DPaginationButtonTopOptions } from \"./d-pagination-button-top\";\nimport { isNumber } from \"./util/is-number\";\nimport { DPaginationPage, DPaginationPageOptions } from \"./d-pagination-page\";\nimport { DLayoutSpace } from \"./d-layout-space\";\n\nexport interface DPaginationButtonOptions {\n\t/**\n\t * {@link DPagination} top button options.\n\t */\n\ttop?: DPaginationButtonTopOptions | boolean | null;\n\n\t/**\n\t * {@link DPagination} previous button options.\n\t */\n\tprevious?: DPaginationButtonPreviousOptions | boolean | null;\n\n\t/**\n\t * {@link DPagination} page button options.\n\t */\n\tpage?: DPaginationButtonPageOptions;\n\n\t/**\n\t * {@link DPagination} next button options.\n\t */\n\tnext?: DPaginationButtonNextOptions | boolean | null;\n\n\t/**\n\t * {@link DPagination} last button options.\n\t */\n\tlast?: DPaginationButtonLastOptions | boolean | null;\n\n\t/**\n\t * A space between page buttons and next / previous buttons.\n\t */\n\tspace?: number;\n}\n\nexport interface DPaginationOptions<THEME extends DThemePagination>\n\textends DLayoutHorizontalOptions<THEME> {\n\t/**\n\t * An index number of a selected page.\n\t */\n\tvalue?: number;\n\n\t/**\n\t * An index number of a selected page.\n\t *\n\t * @deprecated in favor of {@link value}.\n\t */\n\tselected?: number;\n\n\t/**\n\t * A total number of pages.\n\t */\n\tsize?: number;\n\n\t/**\n\t * A total number of pages.\n\t *\n\t * @deprecated in favor of {@link size};\n\t */\n\ttotal?: number;\n\n\t/**\n\t * {@link DPagination} button options.\n\t */\n\tbutton?: DPaginationButtonOptions;\n\n\t/**\n\t * {@link DPagination} page options.\n\t */\n\tpage?: DPaginationPageOptions;\n}\n\nexport interface DThemePagination extends DThemeLayoutHorizontal {\n\tgetButtonSpace(): number;\n}\n\nexport class DPagination<\n\tTHEME extends DThemePagination = DThemePagination,\n\tOPTIONS extends DPaginationOptions<THEME> = DPaginationOptions<THEME>\n> extends DLayoutHorizontal<THEME, OPTIONS> {\n\tprotected _size: number;\n\tprotected _value: number;\n\n\tprotected _buttonTop?: DButton<string> | null;\n\tprotected _buttonPrevious?: DButton<string> | null;\n\tprotected _dots0?: DPaginationDots;\n\tprotected _buttonPages0?: DButton<number>[];\n\tprotected _page?: DPaginationPage;\n\tprotected _buttonPages1?: DButton<number>[];\n\tprotected _dots1?: DPaginationDots;\n\tprotected _buttonNext?: DButton<string> | null;\n\tprotected _buttonLast?: DButton<string> | null;\n\n\tconstructor(options?: OPTIONS) {\n\t\tsuper(options);\n\n\t\tif (options != null) {\n\t\t\tthis._size = options.size ?? options.total ?? 10;\n\t\t\tthis._value = options.value ?? options.selected ?? 0;\n\t\t} else {\n\t\t\tthis._size = 10;\n\t\t\tthis._value = 0;\n\t\t}\n\n\t\tconst buttonTop = this.buttonTop;\n\t\tconst buttonPrevious = this.buttonPrevious;\n\t\tif (buttonTop != null) {\n\t\t\tthis.addChild(buttonTop);\n\t\t}\n\t\tif (buttonPrevious != null) {\n\t\t\tthis.addChild(buttonPrevious);\n\t\t}\n\t\tif (buttonTop != null || buttonPrevious != null) {\n\t\t\tthis.addChild(this.newSpace());\n\t\t}\n\t\tconst buttonPages0 = this.buttonPages0;\n\t\tconst buttonPages0Length = buttonPages0.length;\n\t\tthis.addChild(buttonPages0[buttonPages0Length - 1]);\n\t\tthis.addChild(this.dots0);\n\t\tfor (let i = buttonPages0Length - 2; 0 <= i; --i) {\n\t\t\tthis.addChild(buttonPages0[i]);\n\t\t}\n\t\tthis.addChild(this.page);\n\t\tconst buttonPages1 = this.buttonPages1;\n\t\tconst buttonPages1Length = buttonPages1.length;\n\t\tfor (let i = 0, imax = buttonPages1Length - 1; i < imax; ++i) {\n\t\t\tthis.addChild(buttonPages1[i]);\n\t\t}\n\t\tthis.addChild(this.dots1);\n\t\tthis.addChild(buttonPages1[buttonPages1Length - 1]);\n\t\tconst buttonNext = this.buttonNext;\n\t\tconst buttonLast = this.buttonLast;\n\t\tif (buttonNext != null || buttonLast != null) {\n\t\t\tthis.addChild(this.newSpace());\n\t\t}\n\t\tif (buttonNext != null) {\n\t\t\tthis.addChild(buttonNext);\n\t\t}\n\t\tif (buttonLast != null) {\n\t\t\tthis.addChild(buttonLast);\n\t\t}\n\n\t\tthis.update();\n\t}\n\n\tprotected newSpace(): DLayoutSpace {\n\t\treturn new DLayoutSpace({\n\t\t\twidth: this._options?.button?.space ?? this.theme.getButtonSpace()\n\t\t});\n\t}\n\n\t/**\n\t * Sets a value that is an index of a current page.\n\t *\n\t * @param value a value that is an index of a page\n\t */\n\tset value(value: number) {\n\t\tif (0 <= value && value < this._size && this._value !== value) {\n\t\t\tthis._value = value;\n\t\t\tthis.update();\n\t\t}\n\t}\n\n\t/**\n\t * Returns a value that is an index of a current page.\n\t *\n\t * @returns a value that is an index of a selected page.\n\t */\n\tget value(): number {\n\t\treturn this._value;\n\t}\n\n\t/**\n\t * Selects a page.\n\t *\n\t * @param index an index of a page\n\t * @deprecated in favor of {@link #value}.\n\t */\n\tset selected(index: number) {\n\t\tthis.value = index;\n\t}\n\n\t/**\n\t * Returns an index of the selected page.\n\t *\n\t * @returns an index of the selected page.\n\t * @deprecated in favor of {@link value}.\n\t */\n\tget selected(): number {\n\t\treturn this.value;\n\t}\n\n\t/**\n\t * Sets a number of total pages.\n\t *\n\t * @param size a number of pages\n\t */\n\tset size(size: number) {\n\t\tif (0 <= size && this._size !== size) {\n\t\t\tthis._size = size;\n\t\t\tif (size === 0) {\n\t\t\t\tthis._value = -1;\n\t\t\t} else {\n\t\t\t\tthis._value = Math.max(0, Math.min(this._size - 1, this._value));\n\t\t\t}\n\t\t\tthis.update();\n\t\t}\n\t}\n\n\t/**\n\t * Returns a number of total pages.\n\t *\n\t * @returns a number of total pages.\n\t */\n\tget size(): number {\n\t\treturn this._size;\n\t}\n\n\t/**\n\t * Sets a number of total pages.\n\t *\n\t * @param total a number of pages\n\t * @deprecated in favor of {@link size}\n\t */\n\tset total(total: number) {\n\t\tthis.size = total;\n\t}\n\n\t/**\n\t * Returns a number of total pages.\n\t *\n\t * @returns a number of total pages.\n\t * @deprecated in favor of {@link size}\n\t */\n\tget total(): number {\n\t\treturn this.size;\n\t}\n\n\tprotected get dots0(): DPaginationDots {\n\t\tlet result = this._dots0;\n\t\tif (result == null) {\n\t\t\tresult = this.newDots();\n\t\t\tthis._dots0 = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected get dots1(): DPaginationDots {\n\t\tlet result = this._dots1;\n\t\tif (result == null) {\n\t\t\tresult = this.newDots();\n\t\t\tthis._dots1 = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected newDots(): DPaginationDots {\n\t\treturn new DPaginationDots();\n\t}\n\n\tprotected get buttonLast(): DButton<string> | null {\n\t\tlet result = this._buttonLast;\n\t\tif (result === undefined) {\n\t\t\tresult = this.newButtonLast();\n\t\t\tthis._buttonLast = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected newButtonLast(): DButton<string> | null {\n\t\tconst last = this._options?.button?.last;\n\t\tif (last !== null && last !== false && last !== undefined) {\n\t\t\tconst result = new DPaginationButtonLast(last !== true ? last : undefined);\n\t\t\tresult.on(\"active\", () => {\n\t\t\t\tthis.onButtonLastActive();\n\t\t\t});\n\t\t\treturn result;\n\t\t}\n\t\treturn null;\n\t}\n\n\tprotected onButtonLastActive(): void {\n\t\tthis.moveTo(this._size - 1);\n\t}\n\n\tprotected moveTo(index: number): void {\n\t\tif (0 <= index && index < this._size && this._value !== index) {\n\t\t\tconst oldIndex = this._value;\n\t\t\tthis._value = index;\n\t\t\tthis.emit(\"change\", index, oldIndex, this);\n\t\t\tthis.update();\n\t\t}\n\t}\n\n\tprotected get buttonNext(): DButton<string> | null {\n\t\tlet result = this._buttonNext;\n\t\tif (result === undefined) {\n\t\t\tresult = this.newButtonNext();\n\t\t\tthis._buttonNext = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected newButtonNext(): DButton<string> | null {\n\t\tconst next = this._options?.button?.next;\n\t\tif (next !== null && next !== false) {\n\t\t\tconst result = new DPaginationButtonNext(next !== true ? next : undefined);\n\t\t\tresult.on(\"active\", (): void => {\n\t\t\t\tthis.onButtonNextActive();\n\t\t\t});\n\t\t\treturn result;\n\t\t}\n\t\treturn null;\n\t}\n\n\tprotected onButtonNextActive(): void {\n\t\tthis.moveTo(this._value + 1);\n\t}\n\n\tprotected get buttonPrevious(): DButton<string> | null {\n\t\tlet result = this._buttonPrevious;\n\t\tif (result === undefined) {\n\t\t\tresult = this.newButtonPrevious();\n\t\t\tthis._buttonPrevious = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected newButtonPrevious(): DButton<string> | null {\n\t\tconst previous = this._options?.button?.previous;\n\t\tif (previous !== null && previous !== false) {\n\t\t\tconst result = new DPaginationButtonPrevious(previous !== true ? previous : undefined);\n\t\t\tresult.on(\"active\", (): void => {\n\t\t\t\tthis.onButtonPreviousActive();\n\t\t\t});\n\t\t\treturn result;\n\t\t}\n\t\treturn null;\n\t}\n\n\tprotected onButtonPreviousActive(): void {\n\t\tthis.moveTo(this._value - 1);\n\t}\n\n\tprotected get buttonTop(): DButton<string> | null {\n\t\tlet result = this._buttonTop;\n\t\tif (result === undefined) {\n\t\t\tresult = this.newButtonTop();\n\t\t\tthis._buttonTop = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected newButtonTop(): DButton<string> | null {\n\t\tconst top = this._options?.button?.top;\n\t\tif (top !== null && top !== false && top !== undefined) {\n\t\t\tconst result = new DPaginationButtonTop(top !== true ? top : undefined);\n\t\t\tresult.on(\"active\", (): void => {\n\t\t\t\tthis.onButtonTopActive();\n\t\t\t});\n\t\t\treturn result;\n\t\t}\n\t\treturn null;\n\t}\n\n\tprotected onButtonTopActive(): void {\n\t\tthis.moveTo(0);\n\t}\n\n\tprotected newButtonPage(): DButton<number> {\n\t\tconst result = new DPaginationButtonPage(this._options?.button?.page);\n\t\tresult.on(\"active\", (): void => {\n\t\t\tthis.onButtonPageActive(result);\n\t\t});\n\t\treturn result;\n\t}\n\n\tprotected get buttonPages0(): DButton<number>[] {\n\t\tlet result = this._buttonPages0;\n\t\tif (result == null) {\n\t\t\tresult = this.newButtonPages0();\n\t\t\tthis._buttonPages0 = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected newButtonPages0(): DButton<number>[] {\n\t\treturn [\n\t\t\tthis.newButtonPage(),\n\t\t\tthis.newButtonPage(),\n\t\t\tthis.newButtonPage(),\n\t\t\tthis.newButtonPage()\n\t\t];\n\t}\n\n\tprotected get buttonPages1(): DButton<number>[] {\n\t\tlet result = this._buttonPages1;\n\t\tif (result == null) {\n\t\t\tresult = this.newButtonPages1();\n\t\t\tthis._buttonPages1 = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected newButtonPages1(): DButton<number>[] {\n\t\treturn [\n\t\t\tthis.newButtonPage(),\n\t\t\tthis.newButtonPage(),\n\t\t\tthis.newButtonPage(),\n\t\t\tthis.newButtonPage()\n\t\t];\n\t}\n\n\tprotected get page(): DPaginationPage {\n\t\tlet result = this._page;\n\t\tif (result == null) {\n\t\t\tresult = this.newPage();\n\t\t\tthis._page = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected newPage(): DPaginationPage {\n\t\treturn new DPaginationPage(this._options?.page);\n\t}\n\n\tprotected onButtonPageActive(button: DButton<number>): void {\n\t\tconst text = button.text;\n\t\tif (isNumber(text)) {\n\t\t\tthis.moveTo(text - 1);\n\t\t\tif (button.state.isFocused) {\n\t\t\t\tbutton.state.isHovered = false;\n\t\t\t\tthis.page.focus();\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected update(): void {\n\t\tconst size = this._size;\n\t\tconst value = this._value;\n\t\tif (size <= 0) {\n\t\t\tconst buttonTop = this.buttonTop;\n\t\t\tif (buttonTop != null) {\n\t\t\t\tbuttonTop.state.isEnabled = false;\n\t\t\t}\n\t\t\tconst buttonPrevious = this.buttonPrevious;\n\t\t\tif (buttonPrevious != null) {\n\t\t\t\tbuttonPrevious.state.isEnabled = false;\n\t\t\t}\n\n\t\t\tthis.dots0.hide();\n\n\t\t\tconst buttonPages0 = this.buttonPages0;\n\t\t\tfor (let i = 0, imax = buttonPages0.length; i < imax; ++i) {\n\t\t\t\tbuttonPages0[i].hide();\n\t\t\t}\n\n\t\t\tthis.page.hide();\n\n\t\t\tconst buttonPages1 = this.buttonPages1;\n\t\t\tfor (let i = 0, imax = buttonPages1.length; i < imax; ++i) {\n\t\t\t\tbuttonPages1[i].hide();\n\t\t\t}\n\n\t\t\tthis.dots1.hide();\n\n\t\t\tconst buttonNext = this.buttonNext;\n\t\t\tif (buttonNext != null) {\n\t\t\t\tbuttonNext.state.isEnabled = false;\n\t\t\t}\n\t\t\tconst buttonLast = this.buttonLast;\n\t\t\tif (buttonLast) {\n\t\t\t\tbuttonLast.state.isEnabled = false;\n\t\t\t}\n\t\t} else {\n\t\t\tlet from = value - 2;\n\t\t\tlet to = value + 2;\n\t\t\tif (from < 0) {\n\t\t\t\tto = to - from;\n\t\t\t\tfrom = 0;\n\t\t\t} else if (size <= to) {\n\t\t\t\tconst delta = to - size + 1;\n\t\t\t\tto -= delta;\n\t\t\t\tfrom -= delta;\n\t\t\t}\n\t\t\tlet top = false;\n\t\t\tif (0 < from) {\n\t\t\t\ttop = true;\n\t\t\t\tfrom = Math.min(from + 1, value);\n\t\t\t}\n\t\t\tlet last = false;\n\t\t\tif (to < size - 1) {\n\t\t\t\tlast = true;\n\t\t\t\tto = Math.max(to - 1, value);\n\t\t\t}\n\n\t\t\tconst buttonTop = this.buttonTop;\n\t\t\tif (buttonTop != null) {\n\t\t\t\tbuttonTop.state.isEnabled = 0 < value;\n\t\t\t}\n\t\t\tconst buttonPrevious = this.buttonPrevious;\n\t\t\tif (buttonPrevious != null) {\n\t\t\t\tbuttonPrevious.state.isEnabled = 0 < value;\n\t\t\t}\n\n\t\t\tif (top) {\n\t\t\t\tthis.dots0.show();\n\t\t\t} else {\n\t\t\t\tthis.dots0.hide();\n\t\t\t}\n\n\t\t\tconst buttonPages0 = this.buttonPages0;\n\t\t\tfor (let i = 0, imax = buttonPages0.length; i < imax; ++i) {\n\t\t\t\tconst index = value - i - 1;\n\t\t\t\tconst buttonPage = buttonPages0[i];\n\t\t\t\tif (from <= index && index <= to) {\n\t\t\t\t\tbuttonPage.text = index + 1;\n\t\t\t\t\tbuttonPage.show();\n\t\t\t\t} else {\n\t\t\t\t\tif (top && i === imax - 1) {\n\t\t\t\t\t\tbuttonPage.text = 1;\n\t\t\t\t\t\tbuttonPage.show();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbuttonPage.hide();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.page.text = value + 1;\n\n\t\t\tconst buttonPages1 = this.buttonPages1;\n\t\t\tfor (let i = 0, imax = buttonPages1.length; i < imax; ++i) {\n\t\t\t\tconst index = value + i + 1;\n\t\t\t\tconst buttonPage = buttonPages1[i];\n\t\t\t\tif (from <= index && index <= to) {\n\t\t\t\t\tbuttonPage.text = index + 1;\n\t\t\t\t\tbuttonPage.show();\n\t\t\t\t} else {\n\t\t\t\t\tif (last && i === imax - 1) {\n\t\t\t\t\t\tbuttonPage.text = size;\n\t\t\t\t\t\tbuttonPage.show();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbuttonPage.hide();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (last) {\n\t\t\t\tthis.dots1.show();\n\t\t\t} else {\n\t\t\t\tthis.dots1.hide();\n\t\t\t}\n\n\t\t\tconst buttonNext = this.buttonNext;\n\t\t\tif (buttonNext != null) {\n\t\t\t\tbuttonNext.state.isEnabled = value < size - 1;\n\t\t\t}\n\t\t\tconst buttonLast = this.buttonLast;\n\t\t\tif (buttonLast != null) {\n\t\t\t\tbuttonLast.state.isEnabled = value < size - 1;\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DPagination\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBase, DBaseOptions, DThemeBase } from \"./d-base\";\n\nexport interface DPickerDatetimeRangeOptions<THEME extends DThemePickerDatetimeRange>\n\textends DBaseOptions<THEME> {}\n\nexport interface DThemePickerDatetimeRange extends DThemeBase {}\n\nexport class DPickerDatetimeRange<\n\tTHEME extends DThemePickerDatetimeRange = DThemePickerDatetimeRange,\n\tOPTIONS extends DPickerDatetimeRangeOptions<THEME> = DPickerDatetimeRangeOptions<THEME>\n> extends DBase<THEME, OPTIONS> {}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBase, DBaseOptions, DThemeBase } from \"./d-base\";\n\nexport interface DPickerTimeRangeOptions<THEME extends DThemePickerTimeRange>\n\textends DBaseOptions<THEME> {}\n\nexport interface DThemePickerTimeRange extends DThemeBase {}\n\nexport class DPickerTimeRange<\n\tTHEME extends DThemePickerTimeRange = DThemePickerTimeRange,\n\tOPTIONS extends DPickerTimeRangeOptions<THEME> = DPickerTimeRangeOptions<THEME>\n> extends DBase<THEME, OPTIONS> {}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {\n\tDDropdownBase,\n\tDDropdownBaseEvents,\n\tDDropdownBaseOptions,\n\tDThemeDropdownBase\n} from \"./d-dropdown-base\";\nimport { DMenu } from \"./d-menu\";\nimport { DMenuItem } from \"./d-menu-item\";\nimport { DMenuItemCheck } from \"./d-menu-item-check\";\nimport { DMenuItemMenu } from \"./d-menu-item-menu\";\nimport { DOnOptions } from \"./d-on-options\";\n\n/**\n * {@link DSelectMultiple} events.\n */\nexport interface DSelectMultipleEvents<VALUE, EMITTER>\n\textends DDropdownBaseEvents<VALUE, Array<DMenuItem<VALUE>>, EMITTER> {\n\t/**\n\t * Triggered when the selection is changed.\n\t *\n\t * @param newValues new selected values\n\t * @param oldValues old selected values\n\t * @param items selected items\n\t * @param emitter an emitter\n\t */\n\tchange(\n\t\tnewValues: VALUE[],\n\t\toldValues: VALUE[],\n\t\titems: Array<DMenuItem<VALUE>>,\n\t\temitter: EMITTER\n\t): void;\n}\n\n/**\n * {@link DSelectMultiple} \"on\" options.\n */\nexport interface DSelectMultipleOnOptions<VALUE, EMITTER>\n\textends Partial<DSelectMultipleEvents<VALUE, EMITTER>>,\n\t\tDOnOptions {}\n\n/**\n * {@link DSelectMultiple} options.\n */\nexport interface DSelectMultipleOptions<\n\tVALUE = unknown,\n\tTHEME extends DThemeSelectMultiple<VALUE> = DThemeSelectMultiple<VALUE>,\n\tEMITTER = any\n> extends DDropdownBaseOptions<VALUE, Array<DMenuItem<VALUE>>, THEME, EMITTER> {\n\t/**\n\t * A default values.\n\t */\n\tvalues?: VALUE[];\n\n\ton?: DSelectMultipleOnOptions<VALUE, EMITTER>;\n}\n\n/**\n * {@link DSelectMultiple} theme.\n */\nexport interface DThemeSelectMultiple<VALUE = unknown>\n\textends DThemeDropdownBase<Array<DMenuItem<VALUE>>> {}\n\n/**\n * A multi-value selector class.\n */\nexport class DSelectMultiple<\n\tVALUE = unknown,\n\tTHEME extends DThemeSelectMultiple<VALUE> = DThemeSelectMultiple<VALUE>,\n\tOPTIONS extends DSelectMultipleOptions<VALUE, THEME> = DSelectMultipleOptions<VALUE, THEME>\n> extends DDropdownBase<VALUE, Array<DMenuItem<VALUE>>, THEME, OPTIONS> {\n\tprotected _values: VALUE[];\n\n\tconstructor(options?: OPTIONS) {\n\t\tsuper(options);\n\n\t\t// Default values\n\t\tthis._values = [];\n\t\tconst values = options?.values;\n\t\tif (values) {\n\t\t\tthis.values = values;\n\t\t}\n\t}\n\n\tprotected onMenuSelect(value: VALUE, item: DMenuItem<VALUE>, menu: DMenu<VALUE>): void {\n\t\tsuper.onMenuSelect(value, item, menu);\n\t\tif (item instanceof DMenuItemCheck) {\n\t\t\tconst oldValues = this._values;\n\t\t\tconst newValues: VALUE[] = [];\n\t\t\tconst newItems: Array<DMenuItem<VALUE>> = [];\n\t\t\tif (item.state.isActive) {\n\t\t\t\tthis.updateMenuItems(menu, oldValues, value, undefined, newValues, newItems);\n\t\t\t} else {\n\t\t\t\tthis.updateMenuItems(menu, oldValues, undefined, value, newValues, newItems);\n\t\t\t}\n\t\t\tthis._values = newValues;\n\t\t\tthis.text = newItems;\n\t\t\tthis.onValueChange(newValues, oldValues, newItems);\n\t\t}\n\t}\n\n\tprotected onMenuReplaced(newMenu: DMenu<VALUE>, oldMenu?: DMenu<VALUE>): void {\n\t\tsuper.onMenuReplaced(newMenu, oldMenu);\n\n\t\t// Update the values\n\t\tconst values = this._values;\n\t\tconst newValues: VALUE[] = [];\n\t\tconst newItems: Array<DMenuItem<VALUE>> = [];\n\t\tthis.updateMenuItems(newMenu, values, undefined, undefined, newValues, newItems);\n\t\tthis._values = newValues;\n\t\tthis.text = newItems;\n\t}\n\n\tprotected onValueChange(\n\t\tnewValues: VALUE[],\n\t\toldValues: VALUE[],\n\t\titems: Array<DMenuItem<VALUE>>\n\t): void {\n\t\tthis.emit(\"change\", newValues, oldValues, items, this);\n\t}\n\n\tstart(): void {\n\t\tthis.updateMenuItems(this.menu, this._values);\n\t\tsuper.start();\n\t}\n\n\t/**\n\t * Returns a selected value or null.\n\t */\n\tget values(): VALUE[] {\n\t\treturn this._values;\n\t}\n\n\t/**\n\t * Sets to the specified value.\n\t */\n\tset values(values: VALUE[]) {\n\t\tconst oldValues = this._values;\n\t\tif (!this.isSameValues(values, oldValues)) {\n\t\t\tconst newValues: VALUE[] = [];\n\t\t\tconst newItems: Array<DMenuItem<VALUE>> = [];\n\t\t\tthis.updateMenuItems(this.menu, values, undefined, undefined, newValues, newItems);\n\t\t\tthis._values = newValues;\n\t\t\tthis.text = newItems;\n\t\t}\n\t}\n\n\tprotected isSameValues(a: VALUE[], b: VALUE[]): boolean {\n\t\tif (a.length === b.length) {\n\t\t\tfor (let i = 0, imax = a.length; i < imax; ++i) {\n\t\t\t\tif (b.indexOf(a[i]) < 0) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tprotected updateMenuItems(\n\t\tmenu: DMenu<VALUE>,\n\t\toldValues: VALUE[],\n\t\taddedValue?: VALUE,\n\t\tremovedValue?: VALUE,\n\t\tnewValues?: VALUE[],\n\t\tnewItems?: Array<DMenuItem<VALUE>>\n\t): void {\n\t\tconst children = menu.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tconst child = children[i];\n\t\t\tif (child instanceof DMenuItemMenu) {\n\t\t\t\tthis.updateMenuItems(\n\t\t\t\t\tchild.menu,\n\t\t\t\t\toldValues,\n\t\t\t\t\taddedValue,\n\t\t\t\t\tremovedValue,\n\t\t\t\t\tnewValues,\n\t\t\t\t\tnewItems\n\t\t\t\t);\n\t\t\t} else if (child instanceof DMenuItemCheck) {\n\t\t\t\tconst childValue = child.value;\n\t\t\t\tif (removedValue !== undefined && removedValue === childValue) {\n\t\t\t\t\tchild.state.isActive = false;\n\t\t\t\t} else if (\n\t\t\t\t\t(addedValue !== undefined && child.value === addedValue) ||\n\t\t\t\t\t0 <= oldValues.indexOf(child.value)\n\t\t\t\t) {\n\t\t\t\t\tif (newValues) {\n\t\t\t\t\t\tnewValues.push(child.value);\n\t\t\t\t\t}\n\t\t\t\t\tif (newItems) {\n\t\t\t\t\t\tnewItems.push(child);\n\t\t\t\t\t}\n\t\t\t\t\tchild.state.isActive = true;\n\t\t\t\t} else {\n\t\t\t\t\tchild.state.isActive = false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DSelectMultiple\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {\n\tDDropdownBase,\n\tDDropdownBaseEvents,\n\tDDropdownBaseOptions,\n\tDThemeDropdownBase\n} from \"./d-dropdown-base\";\nimport { DMenu } from \"./d-menu\";\nimport { DMenuItem } from \"./d-menu-item\";\nimport { DMenuItemMenu } from \"./d-menu-item-menu\";\nimport { DOnOptions } from \"./d-on-options\";\n\n/**\n * {@link DSelect} events.\n */\nexport interface DSelectEvents<VALUE, EMITTER>\n\textends DDropdownBaseEvents<VALUE, DMenuItem<VALUE> | null, EMITTER> {\n\t/**\n\t * Triggered when a selection is changed.\n\t *\n\t * @param newVAlue a newly-selected value\n\t * @param oldValue a previously-selected value\n\t * @param item a newly-selected item\n\t * @param emitter an emitter\n\t */\n\tchange(\n\t\tnewValue: VALUE | null,\n\t\toldValue: VALUE | null,\n\t\titem: DMenuItem<VALUE> | null,\n\t\temitter: EMITTER\n\t): void;\n}\n\n/**\n * {@link DSelect} \"on\" options.\n */\nexport interface DSelectOnOptions<VALUE, EMITTER>\n\textends Partial<DSelectEvents<VALUE, EMITTER>>,\n\t\tDOnOptions {}\n\n/**\n * {@link DSelect} options.\n */\nexport interface DSelectOptions<\n\tVALUE = unknown,\n\tTHEME extends DThemeSelect<VALUE> = DThemeSelect<VALUE>,\n\tEMITTER = any\n> extends DDropdownBaseOptions<VALUE, DMenuItem<VALUE> | null, THEME, EMITTER> {\n\t/**\n\t * A default value.\n\t */\n\tvalue?: VALUE | null;\n\n\ton?: DSelectOnOptions<VALUE, EMITTER>;\n}\n\n/**\n * {@link DSelect} theme.\n */\nexport interface DThemeSelect<VALUE = unknown>\n\textends DThemeDropdownBase<DMenuItem<VALUE> | null> {}\n\n/**\n * A selector class.\n */\nexport class DSelect<\n\tVALUE = unknown,\n\tTHEME extends DThemeSelect<VALUE> = DThemeSelect<VALUE>,\n\tOPTIONS extends DSelectOptions<VALUE, THEME> = DSelectOptions<VALUE, THEME>\n> extends DDropdownBase<VALUE, DMenuItem<VALUE> | null, THEME, OPTIONS> {\n\tprotected _value: VALUE | null;\n\n\tconstructor(options?: OPTIONS) {\n\t\tsuper(options);\n\n\t\t// Default value\n\t\tthis._value = null;\n\t\tconst value = options?.value;\n\t\tif (value != null) {\n\t\t\tthis.value = value;\n\t\t}\n\t}\n\n\tprotected onMenuSelect(newValue: VALUE, item: DMenuItem<VALUE>, menu: DMenu<VALUE>): void {\n\t\tsuper.onMenuSelect(newValue, item, menu);\n\t\tconst oldValue = this._value;\n\t\tif (oldValue !== newValue) {\n\t\t\tthis._value = newValue;\n\t\t\tthis.text = item;\n\t\t\tthis.onValueChange(newValue, oldValue, item);\n\t\t}\n\t}\n\n\tprotected onMenuReplaced(newMenu: DMenu<VALUE>, oldMenu?: DMenu<VALUE>): void {\n\t\tsuper.onMenuReplaced(newMenu, oldMenu);\n\n\t\t// Update the value\n\t\tconst value = this._value;\n\t\tif (value != null) {\n\t\t\tconst item = this.findMenuItem(newMenu, value);\n\t\t\tif (item != null) {\n\t\t\t\tthis._value = value;\n\t\t\t\tthis.text = item;\n\t\t\t} else {\n\t\t\t\tthis._value = null;\n\t\t\t\tthis.text = null;\n\t\t\t}\n\t\t} else {\n\t\t\tthis._value = null;\n\t\t\tthis.text = null;\n\t\t}\n\t}\n\n\tprotected onValueChange(\n\t\tnewValue: VALUE | null,\n\t\toldValue: VALUE | null,\n\t\titem: DMenuItem<VALUE> | null\n\t): void {\n\t\tthis.emit(\"change\", newValue, oldValue, item, this);\n\t}\n\n\tprotected findMenuItem(menu: DMenu<VALUE>, value: VALUE | null): DMenuItem<VALUE> | null {\n\t\tconst children = menu.children;\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\n\t\t\tconst child = children[i];\n\t\t\tif (child instanceof DMenuItemMenu) {\n\t\t\t\tconst result = this.findMenuItem(child.menu, value);\n\t\t\t\tif (result != null) {\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t} else if (child instanceof DMenuItem) {\n\t\t\t\tif (child.value === value) {\n\t\t\t\t\treturn child;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\t/**\n\t * Returns a selected value or null.\n\t */\n\tget value(): VALUE | null {\n\t\treturn this._value;\n\t}\n\n\t/**\n\t * Sets to the specified value.\n\t */\n\tset value(value: VALUE | null) {\n\t\tif (this._value !== value) {\n\t\t\tconst item = this.findMenuItem(this.menu, value);\n\t\t\tif (item != null) {\n\t\t\t\tthis._value = value;\n\t\t\t\tthis.text = item;\n\t\t\t} else {\n\t\t\t\tthis._value = null;\n\t\t\t\tthis.text = null;\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DSelect\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { NineSlicePlane, Texture } from \"pixi.js\";\nimport { DBase } from \"./d-base\";\nimport { DShadow } from \"./d-shadow\";\n\nexport class DShadowImpl extends NineSlicePlane implements DShadow {\n\tprotected _offsetX: number;\n\tprotected _offsetY: number;\n\tprotected _shiftX: number;\n\tprotected _shiftY: number;\n\n\tconstructor(texture: Texture, width: number, height: number, offsetX: number, offsetY: number) {\n\t\tsuper(texture, width, height, width, height);\n\n\t\tthis._offsetX = offsetX;\n\t\tthis._offsetY = offsetY;\n\t\tthis._shiftX = width * 0.5;\n\t\tthis._shiftY = height * 0.5;\n\n\t\tthis.interactive = false;\n\t\tthis.interactiveChildren = false;\n\n\t\ttexture.on(\"update\", (): void => {\n\t\t\tthis.onTextureUpdate();\n\t\t});\n\t}\n\n\tprotected onTextureUpdate(): void {\n\t\tthis.emit(\"update\", this);\n\t}\n\n\tonReflow(base: DBase, width: number, height: number): void {\n\t\tconst sx = this._shiftX;\n\t\tconst sy = this._shiftY;\n\t\tthis.x = -sx + this._offsetX;\n\t\tthis.y = -sy + this._offsetY;\n\t\tthis.width = sx + width + sx;\n\t\tthis.height = sy + height + sy;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DTextBase, DTextBaseOptions, DThemeTextBase } from \"./d-text-base\";\n\nexport interface DSliderLabelOptions<\n\tVALUE = unknown,\n\tTHEME extends DThemeSliderLabel<VALUE> = DThemeSliderLabel<VALUE>\n> extends DTextBaseOptions<VALUE, THEME> {\n\tvalue?: number;\n}\n\nexport interface DThemeSliderLabel<VALUE = unknown> extends DThemeTextBase<VALUE> {}\n\nexport class DSliderLabel<\n\tVALUE = unknown,\n\tTHEME extends DThemeSliderLabel<VALUE> = DThemeSliderLabel<VALUE>,\n\tOPTIONS extends DSliderLabelOptions<VALUE, THEME> = DSliderLabelOptions<VALUE, THEME>\n> extends DTextBase<VALUE, THEME, OPTIONS> {\n\tprotected _value!: number;\n\n\tprotected init(options?: OPTIONS): void {\n\t\tsuper.init(options);\n\t\tthis._value = options?.value ?? 0;\n\t}\n\n\tset value(value: number) {\n\t\tthis._value = value;\n\t}\n\n\tget value(): number {\n\t\treturn this._value;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DSliderLabel\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DButton, DButtonOptions, DThemeButton } from \"./d-button\";\n\nexport interface DSliderThumbOptions<\n\tVALUE = unknown,\n\tTHEME extends DThemeSliderThumb<VALUE> = DThemeSliderThumb<VALUE>\n> extends DButtonOptions<VALUE, THEME> {}\n\nexport interface DThemeSliderThumb<VALUE = unknown> extends DThemeButton<VALUE> {}\n\nexport class DSliderThumb<\n\tVALUE = unknown,\n\tTHEME extends DThemeSliderThumb<VALUE> = DThemeSliderThumb<VALUE>,\n\tOPTIONS extends DSliderThumbOptions<VALUE, THEME> = DSliderThumbOptions<VALUE, THEME>\n> extends DButton<VALUE, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DSliderThumb\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DTextBase, DTextBaseOptions, DThemeTextBase } from \"./d-text-base\";\n\nexport interface DSliderValueOptions<\n\tVALUE = number,\n\tTHEME extends DThemeSliderValue<VALUE> = DThemeSliderValue<VALUE>\n> extends DTextBaseOptions<VALUE, THEME> {\n\tvalue?: number;\n\tprecision?: number;\n\trounder?: (value: number) => number;\n}\n\nexport interface DThemeSliderValue<VALUE = unknown> extends DThemeTextBase<VALUE> {\n\tgetPrecision(): number;\n}\n\nexport class DSliderValue<\n\tVALUE = number,\n\tTHEME extends DThemeSliderValue<VALUE> = DThemeSliderValue<VALUE>,\n\tOPTIONS extends DSliderValueOptions<VALUE, THEME> = DSliderValueOptions<VALUE, THEME>\n> extends DTextBase<VALUE, THEME, OPTIONS> {\n\tprotected _value!: number;\n\tprotected _rounder!: (value: number) => number;\n\n\tprotected init(options?: OPTIONS): void {\n\t\tsuper.init(options);\n\t\tthis._value = options?.value ?? 0;\n\t\tthis._rounder = this.toRounder(options);\n\t}\n\n\ttoRounder(options?: OPTIONS): (value: number) => number {\n\t\tconst rounder = options?.rounder;\n\t\tif (rounder) {\n\t\t\treturn rounder;\n\t\t}\n\n\t\tconst precision = options?.precision ?? this.theme.getPrecision();\n\t\treturn (value: number) => {\n\t\t\tconst base = Math.pow(10, precision);\n\t\t\treturn Math.round(value * base) / base;\n\t\t};\n\t}\n\n\tset value(value: number) {\n\t\tthis._value = value;\n\t}\n\n\tget value(): number {\n\t\treturn this._value;\n\t}\n\n\tget rounder(): (value: number) => number {\n\t\treturn this._rounder;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DSliderValue\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction, Point } from \"pixi.js\";\nimport InteractionEvent = interaction.InteractionEvent;\nimport InteractionManager = interaction.InteractionManager;\nimport { DApplications } from \"./d-applications\";\nimport { DBase, DBaseEvents, DBaseOptions, DThemeBase } from \"./d-base\";\nimport { DSliderLabel, DSliderLabelOptions } from \"./d-slider-label\";\nimport { DSliderThumb, DSliderThumbOptions } from \"./d-slider-thumb\";\nimport { DSliderTrack, DSliderTrackOptions } from \"./d-slider-track\";\nimport { DSliderValue, DSliderValueOptions } from \"./d-slider-value\";\nimport { UtilPointerEvent } from \"./util/util-pointer-event\";\nimport { DOnOptions } from \"./d-on-options\";\n\n/**\n * {@link DSlider} events.\n */\nexport interface DSliderEvents<EMITTER> extends DBaseEvents<EMITTER> {\n\t/**\n\t * Triggered when a value is changed.\n\t *\n\t * @param newValue a new value\n\t * @param oldValue an old value\n\t * @param emitter an emitter\n\t */\n\tchange(newValue: number, oldValue: number, emitter: EMITTER): void;\n}\n\n/**\n * {@link DSlider} \"on\" options.\n */\nexport interface DSliderOnOptions<EMITTER> extends Partial<DSliderEvents<EMITTER>>, DOnOptions {}\n\n/**\n * {@link DSlider} options.\n */\nexport interface DSliderOptions<THEME extends DThemeSlider = DThemeSlider, EMITTER = any>\n\textends DBaseOptions<THEME, EMITTER> {\n\tmin?: DSliderLabelOptions;\n\tmax?: DSliderLabelOptions;\n\tvalue?: DSliderValueOptions;\n\ttrack?: DSliderTrackOptions;\n\tthumb?: DSliderThumbOptions;\n\ton?: DSliderOnOptions<EMITTER>;\n}\n\n/**\n * {@link DSlider} theme.\n */\nexport interface DThemeSlider extends DThemeBase {}\n\n/**\n * A slider class.\n */\nexport abstract class DSlider<\n\tTHEME extends DThemeSlider = DThemeSlider,\n\tOPTIONS extends DSliderOptions<THEME> = DSliderOptions<THEME>\n> extends DBase<THEME, OPTIONS> {\n\tprotected _track!: DSliderTrack;\n\tprotected _thumb!: DSliderThumb;\n\tprotected _trackSelected!: DSliderTrack;\n\tprotected _value!: DSliderValue;\n\tprotected _roundNumber!: number;\n\tprotected _offset!: number;\n\tprotected _yOffset!: number;\n\tprotected _ratioValue!: number;\n\tprotected _min!: DSliderLabel;\n\tprotected _max!: DSliderLabel;\n\tprotected _onThumbMoveBound!: (e: InteractionEvent) => void;\n\tprotected _onThumbUpBound!: (e: InteractionEvent) => void;\n\tprotected _onTrackUpBound!: (e: InteractionEvent) => void;\n\tprotected _onTrackSelectedUpBound!: (e: InteractionEvent) => void;\n\tprotected _interactionManager?: InteractionManager;\n\n\tprotected init(options?: OPTIONS): void {\n\t\tsuper.init(options);\n\n\t\tthis._ratioValue = 0;\n\n\t\tthis._track = this.newTrack(options);\n\t\tthis.addChild(this._track);\n\t\tthis._trackSelected = this.newTrackSelected(options);\n\t\tthis._trackSelected.state.isActive = true;\n\t\tthis.addChild(this._trackSelected);\n\t\tthis._thumb = this.newThumb(options);\n\t\tthis.addChild(this._thumb);\n\t\tthis._min = this.newLabelMin(options);\n\t\tthis.addChild(this._min);\n\t\tthis._max = this.newLabelMax(options);\n\t\tthis.addChild(this._max);\n\t\tthis._value = this.newValue(options);\n\t\tthis.addChild(this._value);\n\n\t\t// Event listeners\n\t\tthis._track.on(UtilPointerEvent.down, (e: InteractionEvent) => {\n\t\t\tthis._value.visible = this.state.inEnabled;\n\t\t\tthis.onTrackDown(e.data.global);\n\t\t});\n\n\t\tthis._trackSelected.on(UtilPointerEvent.down, (e: InteractionEvent) => {\n\t\t\tthis._value.visible = this.state.inEnabled;\n\t\t\tthis.onTrackSelectedDown(e.data.global);\n\t\t});\n\n\t\tthis._onTrackUpBound = (e: InteractionEvent): void => {\n\t\t\tthis.onTrackUpBound(e);\n\t\t\tthis._value.visible = false;\n\t\t};\n\n\t\tthis._onTrackSelectedUpBound = (e: InteractionEvent): void => {\n\t\t\tthis.onTrackSelectedUpBound(e);\n\t\t\tthis._value.visible = false;\n\t\t};\n\n\t\tthis._thumb.on(UtilPointerEvent.down, (e: InteractionEvent) => {\n\t\t\tthis._value.visible = true;\n\t\t\tthis.onThumbDown(e);\n\t\t});\n\n\t\tthis._onThumbMoveBound = (e: InteractionEvent): void => {\n\t\t\tthis.onThumbMove(e);\n\t\t};\n\n\t\tthis._onThumbUpBound = (e: InteractionEvent): void => {\n\t\t\tthis.onThumbUp(e);\n\t\t\tthis._value.visible = false;\n\t\t};\n\n\t\t//\n\t\tthis.onValuesChange();\n\t}\n\n\tprotected newThumb(options?: OPTIONS): DSliderThumb {\n\t\treturn new DSliderThumb(options?.thumb);\n\t}\n\n\tprotected newValue(options?: OPTIONS): DSliderValue {\n\t\treturn new DSliderValue(this.toValueOptions(options?.value));\n\t}\n\n\tprotected toValueOptions(options?: DSliderValueOptions): DSliderValueOptions {\n\t\toptions = options || {};\n\t\tif (options.value == null) {\n\t\t\toptions.value = 0;\n\t\t}\n\t\tconst text = options.text || {};\n\t\toptions.text = text;\n\t\tif (text.value == null) {\n\t\t\ttext.value = options.value;\n\t\t}\n\t\tif (options.visible == null) {\n\t\t\toptions.visible = false;\n\t\t}\n\t\treturn options;\n\t}\n\n\tprotected newLabelMin(options?: OPTIONS): DSliderLabel {\n\t\treturn new DSliderLabel(this.toLabelMinOptions(options?.min));\n\t}\n\n\tprotected toLabelMinOptions(options?: DSliderLabelOptions): DSliderLabelOptions {\n\t\toptions = options || {};\n\t\tif (options.value == null) {\n\t\t\toptions.value = 0;\n\t\t}\n\t\tconst text = options.text || {};\n\t\toptions.text = text;\n\t\tif (text.value == null) {\n\t\t\ttext.value = `${options.value}`;\n\t\t}\n\t\treturn options;\n\t}\n\n\tprotected newLabelMax(options?: OPTIONS): DSliderLabel {\n\t\treturn new DSliderLabel(this.toLabelMaxOptions(options?.max));\n\t}\n\n\tprotected toLabelMaxOptions(options?: DSliderLabelOptions): DSliderLabelOptions {\n\t\toptions = options || {};\n\t\tif (options.value == null) {\n\t\t\toptions.value = 1;\n\t\t}\n\t\tconst text = options.text || {};\n\t\toptions.text = text;\n\t\tif (text.value == null) {\n\t\t\ttext.value = `${options.value}`;\n\t\t}\n\t\treturn options;\n\t}\n\n\tprotected abstract newTrack(options?: OPTIONS): DSliderTrack;\n\tprotected abstract newTrackSelected(options?: OPTIONS): DSliderTrack;\n\n\tprotected abstract onPick(global: Point): void;\n\tprotected abstract onValuesChange(): void;\n\tprotected abstract moveThumbPosition(thumbCoordinate: number): void;\n\n\tprotected getValueMargin(): number {\n\t\treturn 14;\n\t}\n\n\tprotected onTrackDown(global: Point): void {\n\t\tif (this.state.inDisabled) {\n\t\t\treturn;\n\t\t}\n\t\tconst layer = DApplications.getLayer(this);\n\t\tif (layer) {\n\t\t\tconst interactionManager = layer.renderer.plugins.interaction;\n\t\t\tthis._interactionManager = interactionManager;\n\t\t\tconst onTrackUpBound = this._onTrackUpBound;\n\t\t\tinteractionManager.on(UtilPointerEvent.up, onTrackUpBound);\n\t\t\tinteractionManager.on(UtilPointerEvent.upoutside, onTrackUpBound);\n\t\t\tinteractionManager.on(UtilPointerEvent.cancel, onTrackUpBound);\n\t\t}\n\t\tthis.onPick(global);\n\t}\n\n\tprotected onTrackSelectedDown(global: Point): void {\n\t\tif (this.state.inDisabled) {\n\t\t\treturn;\n\t\t}\n\t\tconst layer = DApplications.getLayer(this);\n\t\tif (layer) {\n\t\t\tconst interactionManager = layer.renderer.plugins.interaction;\n\t\t\tthis._interactionManager = interactionManager;\n\t\t\tconst onTrackSelectedUpBound = this._onTrackSelectedUpBound;\n\t\t\tinteractionManager.on(UtilPointerEvent.up, onTrackSelectedUpBound);\n\t\t\tinteractionManager.on(UtilPointerEvent.upoutside, onTrackSelectedUpBound);\n\t\t\tinteractionManager.on(UtilPointerEvent.cancel, onTrackSelectedUpBound);\n\t\t}\n\t\tthis.onPick(global);\n\t}\n\n\tprotected onTrackUpBound(e: InteractionEvent): void {\n\t\tconst interactionManager = this._interactionManager;\n\t\tif (interactionManager) {\n\t\t\tthis._interactionManager = undefined;\n\t\t\tconst onTrackUpBound = this._onTrackUpBound;\n\t\t\tinteractionManager.off(UtilPointerEvent.up, onTrackUpBound);\n\t\t\tinteractionManager.off(UtilPointerEvent.upoutside, onTrackUpBound);\n\t\t\tinteractionManager.off(UtilPointerEvent.cancel, onTrackUpBound);\n\t\t}\n\t}\n\n\tprotected onTrackSelectedUpBound(e: InteractionEvent): void {\n\t\tconst interactionManager = this._interactionManager;\n\t\tif (interactionManager) {\n\t\t\tthis._interactionManager = undefined;\n\t\t\tconst onTrackSelectedUpBound = this._onTrackSelectedUpBound;\n\t\t\tinteractionManager.off(UtilPointerEvent.up, onTrackSelectedUpBound);\n\t\t\tinteractionManager.off(UtilPointerEvent.upoutside, onTrackSelectedUpBound);\n\t\t\tinteractionManager.off(UtilPointerEvent.cancel, onTrackSelectedUpBound);\n\t\t}\n\t}\n\n\tprotected onThumbMove(e: InteractionEvent): void {\n\t\tif (this.state.inDisabled) {\n\t\t\treturn;\n\t\t}\n\t\tthis.onPick(e.data.global);\n\t}\n\n\tprotected onThumbDown(e: InteractionEvent): void {\n\t\tconst layer = DApplications.getLayer(this);\n\t\tif (layer) {\n\t\t\tconst interactionManager = layer.renderer.plugins.interaction;\n\t\t\tthis._interactionManager = interactionManager;\n\t\t\tconst onThumbMoveBound = this._onThumbMoveBound;\n\t\t\tinteractionManager.on(UtilPointerEvent.move, onThumbMoveBound);\n\t\t\tconst onThumbUpBound = this._onThumbUpBound;\n\t\t\tinteractionManager.on(UtilPointerEvent.up, onThumbUpBound);\n\t\t\tinteractionManager.on(UtilPointerEvent.upoutside, onThumbUpBound);\n\t\t\tinteractionManager.on(UtilPointerEvent.cancel, onThumbUpBound);\n\t\t}\n\t}\n\n\tprotected onThumbUp(e: InteractionEvent): void {\n\t\tconst interactionManager = this._interactionManager;\n\t\tif (interactionManager) {\n\t\t\tthis._interactionManager = undefined;\n\t\t\tconst onThumbMoveBound = this._onThumbMoveBound;\n\t\t\tinteractionManager.off(UtilPointerEvent.move, onThumbMoveBound);\n\t\t\tconst onThumbUpBound = this._onThumbUpBound;\n\t\t\tinteractionManager.off(UtilPointerEvent.up, onThumbUpBound);\n\t\t\tinteractionManager.off(UtilPointerEvent.upoutside, onThumbUpBound);\n\t\t\tinteractionManager.off(UtilPointerEvent.cancel, onThumbUpBound);\n\t\t}\n\t}\n\n\tprotected updateValue(): void {\n\t\tconst min = this._min.value;\n\t\tconst max = this._max.value;\n\t\tconst value = this._value;\n\t\tconst newValue = value.rounder(min + this._ratioValue * (max - min));\n\t\tconst oldValue = value.value;\n\t\tif (newValue !== oldValue) {\n\t\t\tvalue.value = newValue;\n\t\t\tvalue.text = value.value;\n\t\t\tthis.emit(\"change\", newValue, oldValue, this);\n\t\t}\n\t}\n\n\tonResize(newWidth: number, newHeight: number, oldWidth: number, oldHeight: number): void {\n\t\tsuper.onResize(newWidth, newHeight, oldWidth, oldHeight);\n\t\tthis.onValuesChange();\n\t}\n\n\t/**\n\t * Returns a current value.\n\t */\n\tget value(): number {\n\t\treturn this._value.value;\n\t}\n\n\t/**\n\t * Sets a current value.\n\t */\n\tset value(value: number) {\n\t\tvalue = Math.max(this._min.value, Math.min(this._max.value, value));\n\t\t// Adjust if value is new\n\t\tif (this._value.value !== value) {\n\t\t\tthis._value.value = value;\n\t\t\tthis.onValuesChange();\n\t\t}\n\t}\n\n\t/**\n\t * Returns a minimum value.\n\t */\n\tget min(): number {\n\t\treturn this._min.value;\n\t}\n\n\t/**\n\t * Sets a minimum value.\n\t */\n\tset min(newMin: number) {\n\t\tconst min = this._min;\n\t\tnewMin = Math.min(this._max.value, newMin);\n\t\tif (min.value !== newMin) {\n\t\t\tconst value = this._value;\n\t\t\tmin.text = min.value = newMin;\n\t\t\tvalue.value = Math.max(newMin, value.value);\n\t\t\tthis.onValuesChange();\n\t\t}\n\t}\n\n\t/**\n\t * Returns a maximum value.\n\t */\n\tget max(): number {\n\t\treturn this._max.value;\n\t}\n\n\t/**\n\t * Sets a maximum value.\n\t */\n\tset max(newMax: number) {\n\t\tconst max = this._max;\n\t\tnewMax = Math.max(this._min.value, newMax);\n\t\tif (max.value !== newMax) {\n\t\t\tconst value = this._value;\n\t\t\tmax.text = max.value = newMax;\n\t\t\tvalue.value = Math.min(newMax, value.value);\n\t\t\tthis.onValuesChange();\n\t\t}\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DSlider\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DButton, DButtonOptions, DThemeButton } from \"./d-button\";\n\nexport interface DSliderTrackOptions<\n\tVALUE = unknown,\n\tTHEME extends DThemeSliderTrack<VALUE> = DThemeSliderTrack<VALUE>\n> extends DButtonOptions<VALUE, THEME> {}\n\nexport interface DThemeSliderTrack<VALUE = unknown> extends DThemeButton<VALUE> {}\n\nexport class DSliderTrack<\n\tVALUE = unknown,\n\tTHEME extends DThemeSliderTrack<VALUE> = DThemeSliderTrack<VALUE>,\n\tOPTIONS extends DSliderTrackOptions<VALUE, THEME> = DSliderTrackOptions<VALUE, THEME>\n> extends DButton<VALUE, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DSliderTrack\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DSliderTrack, DSliderTrackOptions, DThemeSliderTrack } from \"./d-slider-track\";\n\nexport interface DSliderTrackHorizontalOptions<\n\tVALUE = unknown,\n\tTHEME extends DThemeSliderTrackHorizontal<VALUE> = DThemeSliderTrackHorizontal<VALUE>\n> extends DSliderTrackOptions<VALUE, THEME> {}\n\nexport interface DThemeSliderTrackHorizontal<VALUE = unknown> extends DThemeSliderTrack<VALUE> {}\n\nexport class DSliderTrackHorizontal<\n\tVALUE = unknown,\n\tTHEME extends DThemeSliderTrackHorizontal<VALUE> = DThemeSliderTrackHorizontal<VALUE>,\n\tOPTIONS extends DSliderTrackHorizontalOptions<VALUE, THEME> = DSliderTrackHorizontalOptions<\n\t\tVALUE,\n\t\tTHEME\n\t>\n> extends DSliderTrack<VALUE, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DSliderTrackHorizontal\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Point } from \"pixi.js\";\nimport { DSlider, DSliderOptions, DThemeSlider } from \"./d-slider\";\nimport { DSliderLabelOptions } from \"./d-slider-label\";\nimport { DSliderTrack } from \"./d-slider-track\";\nimport { DSliderTrackHorizontal } from \"./d-slider-track-horizontal\";\nimport { DSliderValueOptions } from \"./d-slider-value\";\n\nexport interface DSliderHorizontalOptions<THEME extends DThemeSliderHorizontal>\n\textends DSliderOptions<THEME> {}\n\nexport interface DThemeSliderHorizontal extends DThemeSlider {}\n\nexport class DSliderHorizontal<\n\tTHEME extends DThemeSliderHorizontal = DThemeSliderHorizontal,\n\tOPTIONS extends DSliderHorizontalOptions<THEME> = DSliderHorizontalOptions<THEME>\n> extends DSlider<THEME, OPTIONS> {\n\tprotected newTrack(options?: OPTIONS): DSliderTrack {\n\t\treturn new DSliderTrackHorizontal(options?.track);\n\t}\n\n\tprotected newTrackSelected(options?: OPTIONS): DSliderTrack {\n\t\treturn new DSliderTrackHorizontal(options?.track);\n\t}\n\n\tprotected toValueOptions(options?: DSliderValueOptions): DSliderValueOptions {\n\t\toptions = super.toValueOptions(options);\n\t\tif (options.y == null) {\n\t\t\toptions.y = (p, s) => p * 0.5 - s - this.getValueMargin();\n\t\t}\n\t\treturn options;\n\t}\n\n\tprotected toLabelMinOptions(options?: DSliderLabelOptions): DSliderLabelOptions {\n\t\toptions = super.toLabelMinOptions(options);\n\t\tif (options.x == null) {\n\t\t\toptions.x = (p, s) => -s * 0.5;\n\t\t}\n\t\tif (options.y == null) {\n\t\t\toptions.y = (p, s) => -s;\n\t\t}\n\t\treturn options;\n\t}\n\n\tprotected toLabelMaxOptions(options?: DSliderLabelOptions): DSliderLabelOptions {\n\t\toptions = super.toLabelMaxOptions(options);\n\t\tif (options.x == null) {\n\t\t\toptions.x = (p, s) => p - s * 0.5;\n\t\t}\n\t\tif (options.y == null) {\n\t\t\toptions.y = (p, s) => -s;\n\t\t}\n\t\treturn options;\n\t}\n\n\tprotected onPick(global: Point): void {\n\t\tconst point = new Point(0, 0);\n\t\tthis.toLocal(global, undefined, point);\n\t\tconst x = Math.max(0, Math.min(this._track.width, point.x));\n\t\tthis._ratioValue = x / this._track.width;\n\t\tthis.moveThumbPosition(x);\n\t}\n\n\tprotected onValuesChange(): void {\n\t\tconst min = this._min.value;\n\t\tconst max = this._max.value;\n\t\tconst value = this._value.value;\n\t\tthis._ratioValue = (value - min) / (max - min);\n\t\tconst x = this._ratioValue * this._track.width;\n\t\tthis.moveThumbPosition(x);\n\t}\n\n\tprotected moveThumbPosition(x: number): void {\n\t\tconst thumb = this._thumb;\n\t\tthumb.x = x - thumb.width * 0.5;\n\n\t\tthis._trackSelected.width = x;\n\n\t\tconst value = this._value;\n\t\tvalue.x = x - value.width * 0.5;\n\n\t\tthis.updateValue();\n\t}\n\n\tprotected toThumbCoordinate(x: number): number {\n\t\treturn x - this._thumb.width * 0.5;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DSliderHorizontal\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DSliderTrack, DSliderTrackOptions, DThemeSliderTrack } from \"./d-slider-track\";\n\nexport interface DSliderTrackVerticalOptions<\n\tVALUE = unknown,\n\tTHEME extends DThemeSliderTrackVertical<VALUE> = DThemeSliderTrackVertical<VALUE>\n> extends DSliderTrackOptions<VALUE, THEME> {}\n\nexport interface DThemeSliderTrackVertical<VALUE = unknown> extends DThemeSliderTrack<VALUE> {}\n\nexport class DSliderTrackVertical<\n\tVALUE = unknown,\n\tTHEME extends DThemeSliderTrackVertical<VALUE> = DThemeSliderTrackVertical<VALUE>,\n\tOPTIONS extends DSliderTrackVerticalOptions<VALUE, THEME> = DSliderTrackVerticalOptions<\n\t\tVALUE,\n\t\tTHEME\n\t>\n> extends DSliderTrack<VALUE, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DSliderTrackVertical\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Point } from \"pixi.js\";\nimport { DAlignHorizontal } from \"./d-align-horizontal\";\nimport { DSlider, DSliderOptions, DThemeSlider } from \"./d-slider\";\nimport { DSliderLabelOptions } from \"./d-slider-label\";\nimport { DSliderTrack } from \"./d-slider-track\";\nimport { DSliderTrackVertical } from \"./d-slider-track-vertical\";\n\nexport interface DSliderVerticalOptions<THEME extends DThemeSliderVertical = DThemeSliderVertical>\n\textends DSliderOptions<THEME> {}\n\nexport interface DThemeSliderVertical extends DThemeSlider {}\n\nexport class DSliderVertical<\n\tTHEME extends DThemeSliderVertical = DThemeSliderVertical,\n\tOPTIONS extends DSliderVerticalOptions<THEME> = DSliderVerticalOptions<THEME>\n> extends DSlider<THEME, OPTIONS> {\n\tprotected newTrack(options?: OPTIONS): DSliderTrack {\n\t\treturn new DSliderTrackVertical(options?.track);\n\t}\n\n\tprotected newTrackSelected(options?: OPTIONS): DSliderTrack {\n\t\treturn new DSliderTrackVertical(options?.track);\n\t}\n\n\tprotected toLabelMinOptions(options?: DSliderLabelOptions): DSliderLabelOptions {\n\t\toptions = super.toLabelMinOptions(options);\n\t\tif (options.x == null) {\n\t\t\toptions.x = (p, s) => -s;\n\t\t}\n\t\tif (options.y == null) {\n\t\t\toptions.y = (p, s) => p - s * 0.5;\n\t\t}\n\t\tconst text = options.text || {};\n\t\toptions.text = text;\n\t\tconst textAlign = text.align || {};\n\t\ttext.align = textAlign;\n\t\tif (textAlign.horizontal == null) {\n\t\t\ttextAlign.horizontal = DAlignHorizontal.RIGHT;\n\t\t}\n\t\treturn options;\n\t}\n\n\tprotected toLabelMaxOptions(options?: DSliderLabelOptions): DSliderLabelOptions {\n\t\toptions = super.toLabelMaxOptions(options);\n\t\tif (options.x == null) {\n\t\t\toptions.x = (p, s) => -s;\n\t\t}\n\t\tif (options.y == null) {\n\t\t\toptions.y = (p, s) => -s * 0.5;\n\t\t}\n\t\tconst text = options.text || {};\n\t\toptions.text = text;\n\t\tconst textAlign = text.align || {};\n\t\ttext.align = textAlign;\n\t\tif (textAlign.horizontal == null) {\n\t\t\ttextAlign.horizontal = DAlignHorizontal.RIGHT;\n\t\t}\n\t\treturn options;\n\t}\n\n\tprotected onPick(global: Point): void {\n\t\tconst point = new Point(0, 0);\n\t\tthis.toLocal(global, undefined, point);\n\t\tconst height = this.height;\n\t\tconst y = Math.max(0, Math.min(height, point.y));\n\t\tthis._ratioValue = (height - y) / height;\n\t\tthis.moveThumbPosition(y);\n\t}\n\n\tprotected onValuesChange(): void {\n\t\tconst min = this._min.value;\n\t\tconst max = this._max.value;\n\t\tconst value = this._value.value;\n\t\tthis._ratioValue = (value - min) / (max - min);\n\t\tconst y = this.height * (1 - this._ratioValue);\n\t\tthis.moveThumbPosition(y);\n\t}\n\n\tprotected moveThumbPosition(y: number): void {\n\t\tconst thumb = this._thumb;\n\t\tthumb.y = y - thumb.height * 0.5;\n\n\t\tconst trackSelected = this._trackSelected;\n\t\ttrackSelected.y = y;\n\t\ttrackSelected.height = this.height - y;\n\n\t\tconst value = this._value;\n\t\tvalue.y = y - value.height - this.getValueMargin();\n\n\t\tthis.updateValue();\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DSliderVertical\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBaseStateSet } from \"./d-base-state-set\";\nimport { DTableEditable, DTableRenderable } from \"./d-table-column\";\n\nexport interface DTableBodyCellsColumnEditing<ROW> {\n\tenable: boolean | DTableEditable<ROW>;\n}\n\nexport interface DTableBodyCellsColumn<ROW> {\n\tediting: DTableBodyCellsColumnEditing<ROW>;\n\trenderable: boolean | DTableRenderable<ROW>;\n}\n\nexport interface DTableBodyCellsTarget {\n\trenderable: boolean;\n\tstate: DBaseStateSet;\n}\n\nexport class DTableBodyCells {\n\tstatic setReadOnly<ROW>(\n\t\ttarget: DTableBodyCellsTarget,\n\t\trow: ROW,\n\t\tcolumnIndex: number,\n\t\tcolumn: DTableBodyCellsColumn<ROW>\n\t): void {\n\t\ttarget.state.isReadOnly = this.toReadOnly(row, columnIndex, column);\n\t}\n\n\tstatic setRenderable<ROW>(\n\t\ttarget: DTableBodyCellsTarget,\n\t\trow: ROW,\n\t\tcolumnIndex: number,\n\t\tcolumn: DTableBodyCellsColumn<ROW>\n\t): void {\n\t\tconst renderable = this.toRenderable(row, columnIndex, column);\n\t\ttarget.renderable = renderable;\n\t\ttarget.state.isDisabled = !renderable;\n\t}\n\n\tstatic toReadOnly<ROW>(\n\t\trow: ROW,\n\t\tcolumnIndex: number,\n\t\tcolumn: DTableBodyCellsColumn<ROW>\n\t): boolean {\n\t\tconst enable = column.editing.enable;\n\t\tif (enable === true) {\n\t\t\treturn false;\n\t\t} else if (enable === false) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn !enable(row, columnIndex);\n\t\t}\n\t}\n\tstatic toRenderable<ROW>(\n\t\trow: ROW,\n\t\tcolumnIndex: number,\n\t\tcolumn: DTableBodyCellsColumn<ROW>\n\t): boolean {\n\t\tconst renderable = column.renderable;\n\t\tif (renderable === true) {\n\t\t\treturn true;\n\t\t} else if (renderable === false) {\n\t\t\treturn false;\n\t\t} else {\n\t\t\treturn renderable(row, columnIndex);\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction } from \"pixi.js\";\nimport { DButton, DButtonOptions, DThemeButton } from \"./d-button\";\nimport { DTableBodyCell, DTableBodyCellOnChange } from \"./d-table-body-cell\";\nimport { DTableBodyCells } from \"./d-table-body-cells\";\nimport { DTableColumn } from \"./d-table-column\";\n\nexport interface DTableBodyCellSelectDialogOptions<\n\tROW = unknown,\n\tVALUE = unknown,\n\tTHEME extends DThemeTableBodyCellSelectDialog<VALUE> = DThemeTableBodyCellSelectDialog<VALUE>\n> extends DButtonOptions<VALUE | null, THEME> {\n\t/**\n\t * False to stop synchronization of the selected value and the text.\n\t */\n\tsync?: boolean;\n}\n\nexport interface DThemeTableBodyCellSelectDialog<VALUE = unknown>\n\textends DThemeButton<VALUE | null> {\n\tisSyncEnabled(): boolean;\n}\n\nexport class DTableBodyCellSelectDialog<\n\t\tROW = unknown,\n\t\tVALUE = unknown,\n\t\tTHEME extends DThemeTableBodyCellSelectDialog<VALUE> = DThemeTableBodyCellSelectDialog<VALUE>,\n\t\tOPTIONS extends DTableBodyCellSelectDialogOptions<\n\t\t\tROW,\n\t\t\tVALUE,\n\t\t\tTHEME\n\t\t> = DTableBodyCellSelectDialogOptions<ROW, VALUE, THEME>\n\t>\n\textends DButton<VALUE | null, THEME, OPTIONS>\n\timplements DTableBodyCell<ROW, VALUE | null>\n{\n\tprotected _row?: ROW;\n\tprotected _rowIndex: number;\n\tprotected _columnIndex: number;\n\tprotected _column: DTableColumn<ROW, VALUE | null>;\n\tprotected _onChange: DTableBodyCellOnChange<ROW, VALUE | null>;\n\tprotected _isSyncEnabled: boolean;\n\n\tconstructor(\n\t\tcolumnIndex: number,\n\t\tcolumn: DTableColumn<ROW, VALUE | null>,\n\t\tonChange: DTableBodyCellOnChange<ROW, VALUE | null>,\n\t\toptions?: OPTIONS\n\t) {\n\t\tsuper(options);\n\n\t\tthis._rowIndex = -1;\n\t\tthis._columnIndex = columnIndex;\n\t\tthis._column = column;\n\t\tthis._onChange = onChange;\n\t\tthis._isSyncEnabled = options?.sync ?? this.theme.isSyncEnabled();\n\t}\n\n\tprotected onActivate(\n\t\te?: interaction.InteractionEvent | KeyboardEvent | MouseEvent | TouchEvent\n\t): void {\n\t\tsuper.onActivate(e);\n\t\tconst selecting = this._column.selecting;\n\t\tconst dialog = selecting.dialog;\n\t\tif (dialog) {\n\t\t\tconst oldValue = this._textValueComputed ?? null;\n\t\t\tselecting.setter(dialog, oldValue);\n\t\t\tdialog.open().then((): void => {\n\t\t\t\tconst newValue = selecting.getter(dialog);\n\t\t\t\tif (this._isSyncEnabled) {\n\t\t\t\t\tif (newValue !== oldValue) {\n\t\t\t\t\t\tthis.text = newValue;\n\t\t\t\t\t\tthis.onValueChange(newValue, oldValue);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis.onValueChange(newValue, null);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tprotected onValueChange(newValue: VALUE | null, oldValue: VALUE | null): void {\n\t\tconst row = this._row;\n\t\tif (row !== undefined) {\n\t\t\tconst rowIndex = this._rowIndex;\n\t\t\tconst columnIndex = this._columnIndex;\n\t\t\tthis._column.setter(row, columnIndex, newValue);\n\t\t\tthis.emit(\"change\", newValue, oldValue, this);\n\t\t\tthis._onChange(newValue, oldValue, row, rowIndex, columnIndex, this);\n\t\t}\n\t}\n\n\tget row(): ROW | undefined {\n\t\treturn this._row;\n\t}\n\n\tget rowIndex(): number {\n\t\treturn this._rowIndex;\n\t}\n\n\tget columnIndex(): number {\n\t\treturn this._columnIndex;\n\t}\n\n\tget column(): DTableColumn<ROW, VALUE | null> {\n\t\treturn this._column;\n\t}\n\n\tget value(): VALUE | null {\n\t\tconst textValueComputed = this._textValueComputed;\n\t\tif (textValueComputed !== undefined) {\n\t\t\treturn textValueComputed;\n\t\t}\n\t\treturn null;\n\t}\n\n\tset value(value: VALUE | null) {\n\t\tthis.text = value;\n\t}\n\n\tset(\n\t\tvalue: VALUE | null,\n\t\trow: ROW,\n\t\tsupplimental: unknown,\n\t\trowIndex: number,\n\t\tcolumnIndex: number,\n\t\tforcibly?: boolean\n\t): void {\n\t\tthis._row = row;\n\t\tthis._rowIndex = rowIndex;\n\t\tif (forcibly) {\n\t\t\tthis._textValue = value as VALUE;\n\t\t\tthis._textValueComputed = value as VALUE;\n\t\t\tthis.onTextChange();\n\t\t\tthis.createOrUpdateText();\n\t\t} else {\n\t\t\tthis.text = value as VALUE;\n\t\t}\n\n\t\tconst column = this._column;\n\t\tDTableBodyCells.setReadOnly(this, row, columnIndex, column);\n\t\tDTableBodyCells.setRenderable(this, row, columnIndex, column);\n\t}\n\n\tunset(): void {\n\t\tthis._row = undefined;\n\t\tthis._rowIndex = -1;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DTableBodyCellSelectDialog\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {\n\tDTableBodyCellSelectDialog,\n\tDTableBodyCellSelectDialogOptions,\n\tDThemeTableBodyCellSelectDialog\n} from \"./d-table-body-cell-select-dialog\";\n\nexport interface DTableBodyCellActionDialogOptions<\n\tROW = unknown,\n\tVALUE = unknown,\n\tTHEME extends DThemeTableBodyCellActionDialog<VALUE> = DThemeTableBodyCellActionDialog<VALUE>\n> extends DTableBodyCellSelectDialogOptions<ROW, VALUE, THEME> {}\n\nexport interface DThemeTableBodyCellActionDialog<VALUE = unknown>\n\textends DThemeTableBodyCellSelectDialog<VALUE> {}\n\nexport class DTableBodyCellActionDialog<\n\tROW = unknown,\n\tVALUE = unknown,\n\tTHEME extends DThemeTableBodyCellActionDialog<VALUE> = DThemeTableBodyCellActionDialog<VALUE>,\n\tOPTIONS extends DTableBodyCellActionDialogOptions<\n\t\tROW,\n\t\tVALUE,\n\t\tTHEME\n\t> = DTableBodyCellActionDialogOptions<ROW, VALUE, THEME>\n> extends DTableBodyCellSelectDialog<ROW, VALUE, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DTableBodyCellActionDialog\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DDropdown, DDropdownOptions, DThemeDropdown } from \"./d-dropdown\";\nimport { DMenu } from \"./d-menu\";\nimport { DMenuItem } from \"./d-menu-item\";\nimport { DTableBodyCell, DTableBodyCellOnChange } from \"./d-table-body-cell\";\nimport { DTableBodyCells } from \"./d-table-body-cells\";\nimport { DTableColumn } from \"./d-table-column\";\n\nexport interface DTableBodyCellActionMenuOptions<\n\tROW = unknown,\n\tVALUE = unknown,\n\tTHEME extends DThemeTableBodyCellActionMenu = DThemeTableBodyCellActionMenu\n> extends DDropdownOptions<VALUE, THEME> {}\n\nexport interface DThemeTableBodyCellActionMenu extends DThemeDropdown {}\n\nexport class DTableBodyCellActionMenu<\n\t\tROW = unknown,\n\t\tVALUE = unknown,\n\t\tTHEME extends DThemeTableBodyCellActionMenu = DThemeTableBodyCellActionMenu,\n\t\tOPTIONS extends DTableBodyCellActionMenuOptions<\n\t\t\tROW,\n\t\t\tVALUE,\n\t\t\tTHEME\n\t\t> = DTableBodyCellActionMenuOptions<ROW, VALUE, THEME>\n\t>\n\textends DDropdown<VALUE, THEME, OPTIONS>\n\timplements DTableBodyCell<ROW, VALUE | null>\n{\n\tprotected _row?: ROW;\n\tprotected _rowIndex: number;\n\tprotected _columnIndex: number;\n\tprotected _column: DTableColumn<ROW, VALUE | null>;\n\tprotected _onChange: DTableBodyCellOnChange<ROW, VALUE | null>;\n\n\tconstructor(\n\t\tcolumnIndex: number,\n\t\tcolumn: DTableColumn<ROW, VALUE | null>,\n\t\tonChange: DTableBodyCellOnChange<ROW, VALUE | null>,\n\t\toptions?: OPTIONS\n\t) {\n\t\tsuper(options);\n\n\t\tthis._rowIndex = -1;\n\t\tthis._columnIndex = columnIndex;\n\t\tthis._column = column;\n\t\tthis._onChange = onChange;\n\t}\n\n\tprotected onMenuSelect(selected: VALUE, item: DMenuItem<VALUE>, menu: DMenu<VALUE>): void {\n\t\tconst row = this._row;\n\t\tif (row !== undefined) {\n\t\t\tconst rowIndex = this._rowIndex;\n\t\t\tconst columnIndex = this._columnIndex;\n\t\t\tthis._column.setter(row, columnIndex, selected);\n\t\t\tsuper.onMenuSelect(selected, item, menu);\n\t\t\tthis._onChange(selected, null, row, rowIndex, columnIndex, this);\n\t\t}\n\t}\n\n\tprotected onKeyDownArrowDown(e: KeyboardEvent): boolean {\n\t\treturn false;\n\t}\n\n\tget row(): ROW | undefined {\n\t\treturn this._row;\n\t}\n\n\tget rowIndex(): number {\n\t\treturn this._rowIndex;\n\t}\n\n\tget columnIndex(): number {\n\t\treturn this._columnIndex;\n\t}\n\n\tget column(): DTableColumn<ROW, VALUE | null> {\n\t\treturn this._column;\n\t}\n\n\tset(\n\t\tvalue: unknown,\n\t\trow: ROW,\n\t\tsupplimental: unknown,\n\t\trowIndex: number,\n\t\tcolumnIndex: number,\n\t\tforcibly?: boolean\n\t): void {\n\t\tthis._row = row;\n\t\tthis._rowIndex = rowIndex;\n\t\tthis.text = value as string | undefined;\n\n\t\tconst column = this._column;\n\t\tDTableBodyCells.setReadOnly(this, row, columnIndex, column);\n\t\tDTableBodyCells.setRenderable(this, row, columnIndex, column);\n\t}\n\n\tunset(): void {\n\t\tthis._row = undefined;\n\t\tthis._rowIndex = -1;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DTableBodyCellActionMenu\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction } from \"pixi.js\";\nimport { DButton, DButtonOptions, DThemeButton } from \"./d-button\";\nimport { DTableBodyCell, DTableBodyCellOnChange } from \"./d-table-body-cell\";\nimport { DTableBodyCells } from \"./d-table-body-cells\";\nimport { DTableColumn } from \"./d-table-column\";\n\nexport interface DTableBodyCellSelectPromiseOptions<\n\tROW = unknown,\n\tVALUE = unknown,\n\tTHEME extends DThemeTableBodyCellSelectPromise<VALUE> = DThemeTableBodyCellSelectPromise<VALUE>\n> extends DButtonOptions<VALUE | null, THEME> {\n\t/**\n\t * False to stop synchronizing the resolved value and the text.\n\t */\n\tsync?: boolean;\n}\n\nexport interface DThemeTableBodyCellSelectPromise<VALUE = unknown>\n\textends DThemeButton<VALUE | null> {\n\tisSyncEnabled(): boolean;\n}\n\nexport class DTableBodyCellSelectPromise<\n\t\tROW = unknown,\n\t\tVALUE = unknown,\n\t\tTHEME extends DThemeTableBodyCellSelectPromise<VALUE> = DThemeTableBodyCellSelectPromise<VALUE>,\n\t\tOPTIONS extends DTableBodyCellSelectPromiseOptions<\n\t\t\tROW,\n\t\t\tVALUE,\n\t\t\tTHEME\n\t\t> = DTableBodyCellSelectPromiseOptions<ROW, VALUE, THEME>\n\t>\n\textends DButton<VALUE | null, THEME, OPTIONS>\n\timplements DTableBodyCell<ROW, VALUE | null>\n{\n\tprotected _row?: ROW;\n\tprotected _rowIndex: number;\n\tprotected _columnIndex: number;\n\tprotected _column: DTableColumn<ROW, VALUE | null>;\n\tprotected _onChange: DTableBodyCellOnChange<ROW, VALUE | null>;\n\tprotected _isSyncEnabled: boolean;\n\n\tconstructor(\n\t\tcolumnIndex: number,\n\t\tcolumn: DTableColumn<ROW, VALUE | null>,\n\t\tonChange: DTableBodyCellOnChange<ROW, VALUE | null>,\n\t\toptions?: OPTIONS\n\t) {\n\t\tsuper(options);\n\n\t\tthis._rowIndex = -1;\n\t\tthis._columnIndex = columnIndex;\n\t\tthis._column = column;\n\t\tthis._onChange = onChange;\n\t\tthis._isSyncEnabled = options?.sync ?? this.theme.isSyncEnabled();\n\t}\n\n\tprotected onActivate(\n\t\te?: interaction.InteractionEvent | KeyboardEvent | MouseEvent | TouchEvent\n\t): void {\n\t\tsuper.onActivate(e);\n\t\tconst selecting = this._column.selecting;\n\t\tconst promise = selecting.promise;\n\t\tif (promise) {\n\t\t\tpromise().then((newValue: VALUE | null): void => {\n\t\t\t\tif (this._isSyncEnabled) {\n\t\t\t\t\tconst oldValue = this._textValueComputed ?? null;\n\t\t\t\t\tif (newValue !== oldValue) {\n\t\t\t\t\t\tthis.text = newValue;\n\t\t\t\t\t\tthis.onValueChange(newValue, oldValue);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis.onValueChange(newValue, null);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tprotected onValueChange(newValue: VALUE | null, oldValue: VALUE | null): void {\n\t\tconst row = this._row;\n\t\tif (row !== undefined) {\n\t\t\tconst rowIndex = this._rowIndex;\n\t\t\tconst columnIndex = this._columnIndex;\n\t\t\tthis._column.setter(row, columnIndex, newValue);\n\t\t\tthis.emit(\"change\", newValue, oldValue, this);\n\t\t\tthis._onChange(newValue, oldValue, row, rowIndex, columnIndex, this);\n\t\t}\n\t}\n\n\tget row(): ROW | undefined {\n\t\treturn this._row;\n\t}\n\n\tget rowIndex(): number {\n\t\treturn this._rowIndex;\n\t}\n\n\tget columnIndex(): number {\n\t\treturn this._columnIndex;\n\t}\n\n\tget column(): DTableColumn<ROW, VALUE | null> {\n\t\treturn this._column;\n\t}\n\n\tget value(): VALUE | null {\n\t\tconst textValueComputed = this._textValueComputed;\n\t\tif (textValueComputed !== undefined) {\n\t\t\treturn textValueComputed;\n\t\t}\n\t\treturn null;\n\t}\n\n\tset value(value: VALUE | null) {\n\t\tthis.text = value;\n\t}\n\n\tset(\n\t\tvalue: VALUE | null,\n\t\trow: ROW,\n\t\tsupplimental: unknown,\n\t\trowIndex: number,\n\t\tcolumnIndex: number,\n\t\tforcibly?: boolean\n\t): void {\n\t\tthis._row = row;\n\t\tthis._rowIndex = rowIndex;\n\t\tif (forcibly) {\n\t\t\tthis._textValue = value;\n\t\t\tthis._textValueComputed = value;\n\t\t\tthis.onTextChange();\n\t\t\tthis.createOrUpdateText();\n\t\t} else {\n\t\t\tthis.text = value;\n\t\t}\n\n\t\tconst column = this._column;\n\t\tDTableBodyCells.setReadOnly(this, row, columnIndex, column);\n\t\tDTableBodyCells.setRenderable(this, row, columnIndex, column);\n\t}\n\n\tunset(): void {\n\t\tthis._row = undefined;\n\t\tthis._rowIndex = -1;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DTableBodyCellSelectPromise\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {\n\tDTableBodyCellSelectPromise,\n\tDTableBodyCellSelectPromiseOptions,\n\tDThemeTableBodyCellSelectPromise\n} from \"./d-table-body-cell-select-promise\";\n\nexport interface DTableBodyCellActionPromiseOptions<\n\tROW = unknown,\n\tVALUE = unknown,\n\tTHEME extends DThemeTableBodyCellActionPromise<VALUE> = DThemeTableBodyCellActionPromise<VALUE>\n> extends DTableBodyCellSelectPromiseOptions<ROW, VALUE, THEME> {}\n\nexport interface DThemeTableBodyCellActionPromise<VALUE = unknown>\n\textends DThemeTableBodyCellSelectPromise<VALUE> {}\n\nexport class DTableBodyCellActionPromise<\n\tROW = unknown,\n\tVALUE = unknown,\n\tTHEME extends DThemeTableBodyCellActionPromise<VALUE> = DThemeTableBodyCellActionPromise<VALUE>,\n\tOPTIONS extends DTableBodyCellActionPromiseOptions<\n\t\tROW,\n\t\tVALUE,\n\t\tTHEME\n\t> = DTableBodyCellActionPromiseOptions<ROW, VALUE, THEME>\n> extends DTableBodyCellSelectPromise<ROW, VALUE, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DTableBodyCellActionPromise\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DImageBase, DImageBaseOptions, DThemeImageBase } from \"./d-image-base\";\nimport { DStateAwareOrValue } from \"./d-state-aware\";\nimport { DTableBodyCell, DTableBodyCellOnChange } from \"./d-table-body-cell\";\nimport { DTableBodyCells } from \"./d-table-body-cells\";\nimport { DTableColumn } from \"./d-table-column\";\n\nexport interface DTableBodyCellTextOptions<\n\tROW,\n\tVALUE = unknown,\n\tTHEME extends DThemeTableBodyCellText<VALUE> = DThemeTableBodyCellText<VALUE>\n> extends DImageBaseOptions<VALUE, THEME> {}\n\nexport interface DThemeTableBodyCellText<VALUE = unknown> extends DThemeImageBase<VALUE> {}\n\nexport class DTableBodyCellText<\n\t\tROW,\n\t\tVALUE = unknown,\n\t\tTHEME extends DThemeTableBodyCellText<VALUE> = DThemeTableBodyCellText<VALUE>,\n\t\tOPTIONS extends DTableBodyCellTextOptions<ROW, VALUE, THEME> = DTableBodyCellTextOptions<\n\t\t\tROW,\n\t\t\tVALUE,\n\t\t\tTHEME\n\t\t>\n\t>\n\textends DImageBase<VALUE, THEME, OPTIONS>\n\timplements DTableBodyCell<ROW, VALUE>\n{\n\tprotected _row?: ROW;\n\tprotected _rowIndex: number;\n\tprotected _columnIndex: number;\n\tprotected _column: DTableColumn<ROW, VALUE>;\n\tprotected _onChange: DTableBodyCellOnChange<ROW, VALUE>;\n\n\tconstructor(\n\t\tcolumnIndex: number,\n\t\tcolumn: DTableColumn<ROW, VALUE>,\n\t\tonChange: DTableBodyCellOnChange<ROW, VALUE>,\n\t\toptions?: OPTIONS\n\t) {\n\t\tsuper(options);\n\n\t\tthis._rowIndex = -1;\n\t\tthis._columnIndex = columnIndex;\n\t\tthis._column = column;\n\t\tthis._onChange = onChange;\n\t}\n\n\tget row(): ROW | undefined {\n\t\treturn this._row;\n\t}\n\n\tget rowIndex(): number {\n\t\treturn this._rowIndex;\n\t}\n\n\tget columnIndex(): number {\n\t\treturn this._columnIndex;\n\t}\n\n\tget column(): DTableColumn<ROW, VALUE> {\n\t\treturn this._column;\n\t}\n\n\tset(\n\t\tvalue: unknown,\n\t\trow: ROW,\n\t\tsupplimental: unknown,\n\t\trowIndex: number,\n\t\tcolumnIndex: number,\n\t\tforcibly?: boolean\n\t): void {\n\t\tthis._row = row;\n\t\tthis._rowIndex = rowIndex;\n\t\tthis.text = value as DStateAwareOrValue<VALUE>;\n\n\t\tconst column = this._column;\n\t\tDTableBodyCells.setReadOnly(this, row, columnIndex, column);\n\t\tDTableBodyCells.setRenderable(this, row, columnIndex, column);\n\t}\n\n\tunset(): void {\n\t\tthis._row = undefined;\n\t\tthis._rowIndex = -1;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DTableBodyCellText\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction } from \"pixi.js\";\nimport { DButtonBaseWhen } from \"./d-button-base-when\";\nimport { DTableBodyCellOnChange } from \"./d-table-body-cell\";\nimport {\n\tDTableBodyCellText,\n\tDTableBodyCellTextOptions,\n\tDThemeTableBodyCellText\n} from \"./d-table-body-cell-text\";\nimport { DTableColumn } from \"./d-table-column\";\nimport { toEnum } from \"./util/to-enum\";\nimport { UtilKeyboardEvent } from \"./util/util-keyboard-event\";\nimport { UtilPointerEvent } from \"./util/util-pointer-event\";\n\nexport interface DTableBodyCellButtonOptions<\n\tROW,\n\tVALUE = unknown,\n\tTHEME extends DThemeTableBodyCellButton<VALUE> = DThemeTableBodyCellButton<VALUE>\n> extends DTableBodyCellTextOptions<ROW, VALUE | null, THEME> {\n\twhen?: DButtonBaseWhen | keyof typeof DButtonBaseWhen;\n}\n\nexport interface DThemeTableBodyCellButton<VALUE = unknown>\n\textends DThemeTableBodyCellText<VALUE | null> {}\n\nexport class DTableBodyCellButton<\n\tROW,\n\tVALUE = unknown,\n\tTHEME extends DThemeTableBodyCellButton<VALUE> = DThemeTableBodyCellButton<VALUE>,\n\tOPTIONS extends DTableBodyCellButtonOptions<ROW, VALUE, THEME> = DTableBodyCellButtonOptions<\n\t\tROW,\n\t\tVALUE,\n\t\tTHEME\n\t>\n> extends DTableBodyCellText<ROW, VALUE | null, THEME, OPTIONS> {\n\tprotected _when: DButtonBaseWhen;\n\n\tconstructor(\n\t\tcolumnIndex: number,\n\t\tcolumn: DTableColumn<ROW, VALUE | null>,\n\t\tonChange: DTableBodyCellOnChange<ROW, VALUE | null>,\n\t\toptions?: OPTIONS\n\t) {\n\t\tsuper(columnIndex, column, onChange, options);\n\n\t\tconst when = toEnum(options?.when ?? DButtonBaseWhen.CLICKED, DButtonBaseWhen);\n\t\tthis._when = when;\n\t\tthis.initOnClick(when, this.theme, options);\n\t}\n\n\tprotected initOnClick(when: DButtonBaseWhen, theme: THEME, options?: OPTIONS): void {\n\t\tUtilPointerEvent.onClick(this, (e: interaction.InteractionEvent): void => {\n\t\t\tif (when === DButtonBaseWhen.CLICKED) {\n\t\t\t\tthis.onClick(e);\n\t\t\t}\n\t\t});\n\t}\n\n\tonClick(e?: interaction.InteractionEvent | KeyboardEvent | MouseEvent | TouchEvent): void {\n\t\tif (this.state.isActionable) {\n\t\t\tthis.onActivate(e);\n\t\t}\n\t}\n\n\tonDblClick(\n\t\te: MouseEvent | TouchEvent,\n\t\tinteractionManager: interaction.InteractionManager\n\t): boolean {\n\t\tif (this._when === DButtonBaseWhen.DOUBLE_CLICKED) {\n\t\t\tthis.onClick(e);\n\t\t}\n\t\treturn super.onDblClick(e, interactionManager);\n\t}\n\n\tprotected onActivate(\n\t\te?: interaction.InteractionEvent | KeyboardEvent | MouseEvent | TouchEvent\n\t): void {\n\t\tthis.emit(\"active\", this);\n\t\tconst row = this._row;\n\t\tif (row !== undefined) {\n\t\t\tconst rowIndex = this._rowIndex;\n\t\t\tconst columnIndex = this._columnIndex;\n\t\t\tthis.emit(\"change\", null, null, this);\n\t\t\tthis._onChange(null, null, row, rowIndex, columnIndex, this);\n\t\t}\n\t}\n\n\tprotected onActivateKeyDown(e: KeyboardEvent): void {\n\t\tif (this.state.isActionable) {\n\t\t\tthis.state.isPressed = true;\n\t\t}\n\t}\n\n\tprotected onActivateKeyUp(e: KeyboardEvent): void {\n\t\tif (this.state.isActionable) {\n\t\t\tif (this.state.isPressed) {\n\t\t\t\tthis.onActivate(e);\n\t\t\t}\n\t\t\tthis.state.isPressed = false;\n\t\t}\n\t}\n\n\tonKeyDown(e: KeyboardEvent): boolean {\n\t\tif (UtilKeyboardEvent.isActivateKey(e)) {\n\t\t\tthis.onActivateKeyDown(e);\n\t\t}\n\n\t\treturn super.onKeyDown(e);\n\t}\n\n\tonKeyUp(e: KeyboardEvent): boolean {\n\t\tif (UtilKeyboardEvent.isActivateKey(e)) {\n\t\t\tthis.onActivateKeyUp(e);\n\t\t}\n\n\t\treturn super.onKeyUp(e);\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DTableBodyCellButton\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DAlignHorizontal } from \"./d-align-horizontal\";\nimport { DDialogSelectOptions } from \"./d-dialog-select\";\nimport { DMenu, DMenuOptions } from \"./d-menu\";\nimport { DTableBodyCellButtonOptions } from \"./d-table-body-cell-button\";\nimport { DTableBodyCellCheckOptions } from \"./d-table-body-cell-check\";\nimport { DTableBodyCellColorOptions } from \"./d-table-body-cell-color\";\nimport { DTableBodyCellDateOptions } from \"./d-table-body-cell-date\";\nimport { DTableBodyCellDatetimeOptions } from \"./d-table-body-cell-datetime\";\nimport { DTableBodyCellIndexOptions } from \"./d-table-body-cell-index\";\nimport { DTableBodyCellInputIntegerOptions } from \"./d-table-body-cell-input-integer\";\nimport { DTableBodyCellInputRealOptions } from \"./d-table-body-cell-input-real\";\nimport { DTableBodyCellInputTextOptions } from \"./d-table-body-cell-input-text\";\nimport { DTableBodyCellLinkLinkOptions, DTableBodyCellLinkOptions } from \"./d-table-body-cell-link\";\nimport { DTableBodyCellSelectDialogOptions } from \"./d-table-body-cell-select-dialog\";\nimport { DTableBodyCellSelectMenuOptions } from \"./d-table-body-cell-select-menu\";\nimport { DTableBodyCellSelectMultipleOptions } from \"./d-table-body-cell-select-multiple\";\nimport { DTableBodyCellSelectPromiseOptions } from \"./d-table-body-cell-select-promise\";\nimport { DTableBodyCellTextOptions } from \"./d-table-body-cell-text\";\nimport { DTableBodyCellTimeOptions } from \"./d-table-body-cell-time\";\nimport { DTableBodyCellTreeOptions } from \"./d-table-body-cell-tree\";\nimport { DTableDataComparator } from \"./d-table-data-sorter\";\nimport { DTableHeaderCellOptions } from \"./d-table-header-cell\";\n\nexport const DTableColumnType = {\n\tINDEX: 0,\n\tTEXT: 1,\n\tINTEGER: 2,\n\tREAL: 3,\n\tCHECK: 4,\n\tCHECK_SINGLE: 5,\n\tCOLOR: 6,\n\tBUTTON: 7,\n\tSELECT: 8,\n\tDATE: 9,\n\tDATETIME: 10,\n\tTIME: 11,\n\tACTION: 12,\n\tLINK: 13,\n\tTREE: 14\n} as const;\n\nexport type DTableColumnType = typeof DTableColumnType[keyof typeof DTableColumnType];\n\nexport type DTableGetter<ROW_VALUE, CELL_VALUE> = (\n\trow: ROW_VALUE,\n\tcolumnIndex: number\n) => CELL_VALUE;\nexport type DTableSetter<ROW_VALUE, CELL_VALUE> = (\n\trow: ROW_VALUE,\n\tcolumnIndex: number,\n\tcell: CELL_VALUE\n) => void;\nexport type DTableFormatter<CELL_VALUE> = (cell: CELL_VALUE) => string;\nexport type DTableEditingFormatter<CELL_VALUE> = (cell: CELL_VALUE) => string;\nexport type DTableEditingUnformatter<CELL_VALUE> = (formatted: string) => CELL_VALUE;\nexport type DTableEditingValidator<CELL_VALUE> = (cell: CELL_VALUE) => string | null;\nexport type DTableSelectingGetter<CELL_VALUE, DIALOG> = (dialog: DIALOG) => CELL_VALUE;\nexport type DTableSelectingSetter<CELL_VALUE, DIALOG> = (dialog: DIALOG, cell: CELL_VALUE) => void;\nexport type DTableEditable<ROW_VALUE> = (row: ROW_VALUE, columnIndex: number) => boolean;\nexport type DTableRenderable<ROW_VALUE> = (row: ROW_VALUE, columnIndex: number) => boolean;\n\nexport type DTableBodyCellOptionsUnion<ROW_VALUE> =\n\t| DTableBodyCellTextOptions<ROW_VALUE>\n\t| DTableBodyCellInputTextOptions<ROW_VALUE>\n\t| DTableBodyCellInputIntegerOptions<ROW_VALUE>\n\t| DTableBodyCellInputRealOptions<ROW_VALUE>\n\t| DTableBodyCellIndexOptions<ROW_VALUE>\n\t| DTableBodyCellColorOptions<ROW_VALUE>\n\t| DTableBodyCellCheckOptions<ROW_VALUE>\n\t| DTableBodyCellSelectDialogOptions<ROW_VALUE>\n\t| DTableBodyCellSelectPromiseOptions<ROW_VALUE>\n\t| DTableBodyCellSelectMenuOptions<ROW_VALUE>\n\t| DTableBodyCellDateOptions<ROW_VALUE>\n\t| DTableBodyCellDatetimeOptions<ROW_VALUE>\n\t| DTableBodyCellTimeOptions<ROW_VALUE>\n\t| DTableBodyCellButtonOptions<ROW_VALUE>\n\t| DTableBodyCellLinkOptions<ROW_VALUE>\n\t| DTableBodyCellSelectMultipleOptions<ROW_VALUE>\n\t| DTableBodyCellTreeOptions<ROW_VALUE>;\n\nexport interface DTableColumnEditingOptions<ROW_VALUE, CELL_VALUE> {\n\tenable?: boolean | DTableEditable<ROW_VALUE> | \"auto\" | \"AUTO\";\n\tformatter?: DTableEditingFormatter<CELL_VALUE>;\n\tunformatter?: DTableEditingUnformatter<CELL_VALUE>;\n\tvalidator?: DTableEditingValidator<CELL_VALUE>;\n}\n\nexport interface DTableColumnEditing<ROW_VALUE, CELL_VALUE> {\n\tenable: boolean | DTableEditable<ROW_VALUE>;\n\tformatter?: DTableEditingFormatter<CELL_VALUE>;\n\tunformatter?: DTableEditingUnformatter<CELL_VALUE>;\n\tvalidator?: DTableEditingValidator<CELL_VALUE>;\n}\n\nexport interface DTableColumnSortingOptions<ROW_VALUE> {\n\tenable?: boolean;\n\tcomparator?: DTableDataComparator<ROW_VALUE>;\n}\n\nexport interface DTableColumnSorting<ROW_VALUE> {\n\tenable: boolean;\n\tcomparator?: DTableDataComparator<ROW_VALUE>;\n}\n\nexport interface DTableColumnSelectingDialog<DIALOG_VALUE> {\n\treadonly value: DIALOG_VALUE;\n\topen(): Promise<DIALOG_VALUE>;\n}\n\nexport interface DTableColumnSelectingOptions<\n\tCELL_VALUE,\n\tDIALOG_VALUE,\n\tDIALOG extends DTableColumnSelectingDialog<DIALOG_VALUE>\n> {\n\tgetter?: DTableSelectingGetter<CELL_VALUE, DIALOG>;\n\tsetter?: DTableSelectingSetter<CELL_VALUE, DIALOG>;\n\n\tmenu?: DMenuOptions<CELL_VALUE> | DMenu<CELL_VALUE>;\n\tmultiple?: DMenuOptions<CELL_VALUE> | DMenu<CELL_VALUE>;\n\tdialog?: DDialogSelectOptions<DIALOG_VALUE> | DIALOG;\n\tpromise?: () => Promise<CELL_VALUE>;\n}\n\nexport interface DTableColumnSelecting<\n\tCELL_VALUE,\n\tDIALOG_VALUE,\n\tDIALOG extends DTableColumnSelectingDialog<DIALOG_VALUE>\n> {\n\tgetter: DTableSelectingGetter<CELL_VALUE, DIALOG>;\n\tsetter: DTableSelectingSetter<CELL_VALUE, DIALOG>;\n\n\tmenu?: DMenu<CELL_VALUE>;\n\tmultiple?: DMenu<CELL_VALUE>;\n\tdialog?: DIALOG;\n\tpromise?: () => Promise<CELL_VALUE>;\n}\n\nexport interface DTableColumnOptions<\n\tROW_VALUE,\n\tCELL_VALUE = any,\n\tDIALOG_VALUE = any,\n\tDIALOG extends DTableColumnSelectingDialog<DIALOG_VALUE> = any\n> {\n\tweight?: number;\n\twidth?: number;\n\n\ttype?: keyof typeof DTableColumnType | DTableColumnType;\n\tlabel?: string;\n\tgetter?: DTableGetter<ROW_VALUE, CELL_VALUE>;\n\tsetter?: DTableSetter<ROW_VALUE, CELL_VALUE>;\n\tpath?: string;\n\tdefault?: CELL_VALUE;\n\tformatter?: DTableFormatter<CELL_VALUE>;\n\talign?: keyof typeof DAlignHorizontal | DAlignHorizontal;\n\n\t/**\n\t * If the renderable is\n\t *\n\t * * true, cells get rendered.\n\t * * false, cells do not get rendered.\n\t * * a function, cells get rendered only when that function returns true.\n\t * * \"AUTO\", cells get rendered only when the cell data exit.\n\t */\n\trenderable?: boolean | DTableRenderable<ROW_VALUE> | \"auto\" | \"AUTO\";\n\n\t/**\n\t * If the editable is\n\t *\n\t * * true, cells get editable.\n\t * * false, cells do not get editable.\n\t * * a function, cells are editable only when that function returns true.\n\t * * \"AUTO\", cells are editable only when the cell data exist.\n\t */\n\teditable?: boolean | DTableEditable<ROW_VALUE> | \"auto\" | \"AUTO\";\n\tediting?: DTableColumnEditingOptions<ROW_VALUE, CELL_VALUE>;\n\n\tsortable?: boolean;\n\tsorting?: DTableColumnSortingOptions<ROW_VALUE>;\n\n\theader?: DTableHeaderCellOptions<ROW_VALUE>;\n\tbody?: DTableBodyCellOptionsUnion<ROW_VALUE>;\n\n\tselecting?: DTableColumnSelectingOptions<CELL_VALUE, DIALOG_VALUE, DIALOG>;\n\n\tcategory?: string | string[];\n\tfrozen?: boolean;\n\n\tlink?: DTableBodyCellLinkLinkOptions<ROW_VALUE, CELL_VALUE>;\n}\n\nexport interface DTableColumn<\n\tROW_VALUE,\n\tCELL_VALUE,\n\tDIALOG_VALUE = CELL_VALUE,\n\tDIALOG extends DTableColumnSelectingDialog<DIALOG_VALUE> = DTableColumnSelectingDialog<DIALOG_VALUE>\n> {\n\tweight: number | undefined;\n\twidth: number | undefined;\n\n\ttype: DTableColumnType;\n\tlabel: string;\n\tgetter: DTableGetter<ROW_VALUE, CELL_VALUE>;\n\tsetter: DTableSetter<ROW_VALUE, CELL_VALUE>;\n\tformatter?: DTableFormatter<CELL_VALUE>;\n\talign: DAlignHorizontal;\n\trenderable: boolean | DTableRenderable<ROW_VALUE>;\n\n\tediting: DTableColumnEditing<ROW_VALUE, CELL_VALUE>;\n\tsorting: DTableColumnSorting<ROW_VALUE>;\n\n\theader?: DTableHeaderCellOptions<ROW_VALUE>;\n\tbody?: DTableBodyCellOptionsUnion<ROW_VALUE>;\n\n\tselecting: DTableColumnSelecting<CELL_VALUE, DIALOG_VALUE, DIALOG>;\n\n\tcategory?: string | string[];\n\tfrozen?: boolean;\n\toffset: number;\n\n\tlink?: DTableBodyCellLinkLinkOptions<ROW_VALUE, CELL_VALUE>;\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction } from \"pixi.js\";\nimport { DButtonCheck, DButtonCheckOptions, DThemeButtonCheck } from \"./d-button-check\";\nimport { DTableBodyCell, DTableBodyCellOnChange } from \"./d-table-body-cell\";\nimport { DTableBodyCells } from \"./d-table-body-cells\";\nimport { DTableColumn, DTableColumnType } from \"./d-table-column\";\nimport { DTableData } from \"./d-table-data\";\n\nexport interface DTableBodyCellCheckOptions<\n\tROW = unknown,\n\tTHEME extends DThemeTableBodyCellCheck = DThemeTableBodyCellCheck\n> extends DButtonCheckOptions<boolean, THEME> {}\n\nexport interface DThemeTableBodyCellCheck extends DThemeButtonCheck<boolean> {}\n\nexport class DTableBodyCellCheck<\n\t\tROW = unknown,\n\t\tTHEME extends DThemeTableBodyCellCheck = DThemeTableBodyCellCheck,\n\t\tOPTIONS extends DTableBodyCellCheckOptions<ROW, THEME> = DTableBodyCellCheckOptions<\n\t\t\tROW,\n\t\t\tTHEME\n\t\t>\n\t>\n\textends DButtonCheck<boolean, THEME, OPTIONS>\n\timplements DTableBodyCell<ROW, boolean>\n{\n\tprotected _row?: ROW;\n\tprotected _rowIndex: number;\n\tprotected _columnIndex: number;\n\tprotected _column: DTableColumn<ROW, boolean>;\n\tprotected _onChange: DTableBodyCellOnChange<ROW, boolean>;\n\n\tconstructor(\n\t\tcolumnIndex: number,\n\t\tcolumn: DTableColumn<ROW, boolean>,\n\t\tonChange: DTableBodyCellOnChange<ROW, boolean>,\n\t\toptions?: OPTIONS\n\t) {\n\t\tsuper(options);\n\n\t\tthis._rowIndex = -1;\n\t\tthis._columnIndex = columnIndex;\n\t\tthis._column = column;\n\t\tthis._onChange = onChange;\n\t}\n\n\tprotected onActivate(\n\t\te?: interaction.InteractionEvent | KeyboardEvent | MouseEvent | TouchEvent\n\t): void {\n\t\tsuper.onActivate(e);\n\t\tthis.onValueChange(true, false);\n\t}\n\n\tprotected onInactivate(\n\t\te?: interaction.InteractionEvent | KeyboardEvent | MouseEvent | TouchEvent\n\t): void {\n\t\tsuper.onInactivate(e);\n\t\tthis.onValueChange(false, true);\n\t}\n\n\tprotected onValueChange(newValue: boolean, oldValue: boolean): void {\n\t\tconst row = this._row;\n\t\tif (row !== undefined) {\n\t\t\tconst rowIndex = this._rowIndex;\n\t\t\tconst columnIndex = this._columnIndex;\n\t\t\tconst column = this._column;\n\t\t\tcolumn.setter(row, columnIndex, newValue);\n\t\t\tthis.emit(\"change\", newValue, oldValue, this);\n\t\t\tconst onChange = this._onChange;\n\t\t\tonChange(newValue, oldValue, row, rowIndex, columnIndex, this);\n\t\t\tif (newValue && column.type === DTableColumnType.CHECK_SINGLE) {\n\t\t\t\tthis.onChangeSingle(rowIndex, columnIndex, column, onChange);\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected onChangeSingle(\n\t\trowIndex: number,\n\t\tcolumnIndex: number,\n\t\tcolumn: DTableColumn<ROW, boolean>,\n\t\tonChange: DTableBodyCellOnChange<ROW, boolean>\n\t): void {\n\t\tconst tableBodyRow = this.parent;\n\t\tif (tableBodyRow) {\n\t\t\tconst tableBody = tableBodyRow.parent as any;\n\t\t\tif (tableBody) {\n\t\t\t\tlet isChanged = false;\n\t\t\t\tconst getter = column.getter;\n\t\t\t\tconst setter = column.setter;\n\t\t\t\tconst data = tableBody.data as DTableData<ROW>;\n\t\t\t\tdata.each((row: ROW, index: number): boolean => {\n\t\t\t\t\tif (rowIndex !== index && getter(row, columnIndex)) {\n\t\t\t\t\t\tsetter(row, columnIndex, false);\n\t\t\t\t\t\tisChanged = true;\n\t\t\t\t\t\tonChange(false, true, row, index, columnIndex, this);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\treturn true;\n\t\t\t\t});\n\t\t\t\tif (isChanged) {\n\t\t\t\t\ttableBody.update(true);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tget row(): ROW | undefined {\n\t\treturn this._row;\n\t}\n\n\tget rowIndex(): number {\n\t\treturn this._rowIndex;\n\t}\n\n\tget columnIndex(): number {\n\t\treturn this._columnIndex;\n\t}\n\n\tget column(): DTableColumn<ROW, boolean> {\n\t\treturn this._column;\n\t}\n\n\tset(\n\t\tvalue: unknown,\n\t\trow: ROW,\n\t\tsupplimental: unknown,\n\t\trowIndex: number,\n\t\tcolumnIndex: number,\n\t\tforcibly?: boolean\n\t): void {\n\t\tthis._row = row;\n\t\tthis._rowIndex = rowIndex;\n\t\tthis.state.isActive = !!value;\n\n\t\tconst column = this._column;\n\t\tDTableBodyCells.setReadOnly(this, row, columnIndex, column);\n\t\tDTableBodyCells.setRenderable(this, row, columnIndex, column);\n\t}\n\n\tunset(): void {\n\t\tthis._row = undefined;\n\t\tthis._rowIndex = -1;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DTableBodyCellCheck\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DButtonColor, DButtonColorOptions, DThemeButtonColor } from \"./d-button-color\";\nimport { DColorAndAlpha } from \"./d-color-and-alpha\";\nimport { DTableBodyCell, DTableBodyCellOnChange } from \"./d-table-body-cell\";\nimport { DTableBodyCells } from \"./d-table-body-cells\";\nimport { DTableColumn } from \"./d-table-column\";\nimport { isNumber } from \"./util/is-number\";\nimport { isString } from \"./util/is-string\";\n\nexport interface DTableBodyCellColorOptions<\n\tROW = unknown,\n\tTHEME extends DThemeTableBodyCellColor = DThemeTableBodyCellColor\n> extends DButtonColorOptions<THEME> {}\n\nexport interface DThemeTableBodyCellColor extends DThemeButtonColor {}\n\nexport class DTableBodyCellColor<\n\t\tROW = unknown,\n\t\tTHEME extends DThemeTableBodyCellColor = DThemeTableBodyCellColor,\n\t\tOPTIONS extends DTableBodyCellColorOptions<ROW, THEME> = DTableBodyCellColorOptions<\n\t\t\tROW,\n\t\t\tTHEME\n\t\t>\n\t>\n\textends DButtonColor<THEME, OPTIONS>\n\timplements DTableBodyCell<ROW, DColorAndAlpha>\n{\n\tprotected _row?: ROW;\n\tprotected _rowIndex: number;\n\tprotected _columnIndex: number;\n\tprotected _column: DTableColumn<ROW, DColorAndAlpha>;\n\tprotected _onChange: DTableBodyCellOnChange<ROW, DColorAndAlpha>;\n\n\tconstructor(\n\t\tcolumnIndex: number,\n\t\tcolumn: DTableColumn<ROW, DColorAndAlpha>,\n\t\tonChange: DTableBodyCellOnChange<ROW, DColorAndAlpha>,\n\t\toptions?: OPTIONS\n\t) {\n\t\tsuper(options);\n\n\t\tthis._rowIndex = -1;\n\t\tthis._columnIndex = columnIndex;\n\t\tthis._column = column;\n\t\tthis._onChange = onChange;\n\t}\n\n\tprotected onValueChange(newValue: DColorAndAlpha, oldValue: DColorAndAlpha): void {\n\t\tconst row = this._row;\n\t\tif (row !== undefined) {\n\t\t\tconst rowIndex = this._rowIndex;\n\t\t\tconst columnIndex = this._columnIndex;\n\t\t\tthis._column.setter(row, columnIndex, newValue);\n\t\t\tsuper.onValueChange(newValue, oldValue);\n\t\t\tthis._onChange(newValue, oldValue, row, rowIndex, columnIndex, this);\n\t\t}\n\t}\n\n\tget row(): ROW | undefined {\n\t\treturn this._row;\n\t}\n\n\tget rowIndex(): number {\n\t\treturn this._rowIndex;\n\t}\n\n\tget columnIndex(): number {\n\t\treturn this._columnIndex;\n\t}\n\n\tget column(): DTableColumn<ROW, DColorAndAlpha> {\n\t\treturn this._column;\n\t}\n\n\tset(\n\t\tnewValue: unknown,\n\t\trow: ROW,\n\t\tsupplimental: unknown,\n\t\trowIndex: number,\n\t\tcolumnIndex: number,\n\t\tforcibly?: boolean\n\t): void {\n\t\tthis._row = row;\n\t\tthis._rowIndex = rowIndex;\n\t\tconst value = this._value;\n\t\tif (isNumber(newValue)) {\n\t\t\tvalue.color = newValue;\n\t\t\tvalue.alpha = 1;\n\t\t} else if (isString(newValue)) {\n\t\t\tconst parsed = Number(newValue);\n\t\t\tvalue.color = parsed === parsed ? parsed : 0xffffff;\n\t\t\tvalue.alpha = 1;\n\t\t} else if (newValue != null) {\n\t\t\tconst color = (newValue as any).color;\n\t\t\tconst alpha = (newValue as any).alpha;\n\t\t\tvalue.color = isNumber(color) ? color : 0xffffff;\n\t\t\tvalue.alpha = isNumber(alpha) ? alpha : 1;\n\t\t} else {\n\t\t\tvalue.color = 0xffffff;\n\t\t\tvalue.alpha = 1;\n\t\t}\n\n\t\tconst column = this._column;\n\t\tDTableBodyCells.setReadOnly(this, row, columnIndex, column);\n\t\tDTableBodyCells.setRenderable(this, row, columnIndex, column);\n\t}\n\n\tunset(): void {\n\t\tthis._row = undefined;\n\t\tthis._rowIndex = -1;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DTableBodyCellColor\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction } from \"pixi.js\";\nimport { DButton, DButtonOptions, DThemeButton } from \"./d-button\";\nimport { DDialogDate, DDialogDateOptions } from \"./d-dialog-date\";\nimport { DDialogDates } from \"./d-dialog-dates\";\nimport { DTableBodyCell, DTableBodyCellOnChange } from \"./d-table-body-cell\";\nimport { DTableBodyCells } from \"./d-table-body-cells\";\nimport { DTableColumn } from \"./d-table-column\";\nimport { isNumber } from \"./util/is-number\";\n\nexport interface DTableBodyCellDateOptions<\n\tROW = unknown,\n\tTHEME extends DThemeTableBodyCellDate = DThemeTableBodyCellDate\n> extends DButtonOptions<Date, THEME> {\n\tdialog?: DDialogDateOptions;\n}\n\nexport interface DThemeTableBodyCellDate extends DThemeButton<Date> {}\n\nexport class DTableBodyCellDate<\n\t\tROW = unknown,\n\t\tTHEME extends DThemeTableBodyCellDate = DThemeTableBodyCellDate,\n\t\tOPTIONS extends DTableBodyCellDateOptions<ROW, THEME> = DTableBodyCellDateOptions<\n\t\t\tROW,\n\t\t\tTHEME\n\t\t>\n\t>\n\textends DButton<Date, THEME, OPTIONS>\n\timplements DTableBodyCell<ROW, Date>\n{\n\tprotected _row?: ROW;\n\tprotected _rowIndex: number;\n\tprotected _columnIndex: number;\n\tprotected _column: DTableColumn<ROW, Date>;\n\tprotected _onChange: DTableBodyCellOnChange<ROW, Date>;\n\tprotected _dialog?: DDialogDate;\n\n\tconstructor(\n\t\tcolumnIndex: number,\n\t\tcolumn: DTableColumn<ROW, Date>,\n\t\tonChange: DTableBodyCellOnChange<ROW, Date>,\n\t\toptions?: OPTIONS\n\t) {\n\t\tsuper(options);\n\n\t\tthis._rowIndex = -1;\n\t\tthis._columnIndex = columnIndex;\n\t\tthis._column = column;\n\t\tthis._onChange = onChange;\n\t}\n\n\tprotected onActivate(\n\t\te?: interaction.InteractionEvent | KeyboardEvent | MouseEvent | TouchEvent\n\t): void {\n\t\tsuper.onActivate(e);\n\t\tconst value = this._textValueComputed?.getTime() ?? Date.now();\n\t\tconst dialog = this.dialog;\n\t\tdialog.current = new Date(value);\n\t\tdialog.new = new Date(value);\n\t\tdialog.page = new Date(value);\n\t\tdialog.open().then((): void => {\n\t\t\tconst newValue = dialog.new;\n\t\t\tconst oldValue = dialog.current;\n\t\t\tthis.text = new Date(newValue.getTime());\n\t\t\tconst row = this._row;\n\t\t\tif (row !== undefined) {\n\t\t\t\tconst rowIndex = this._rowIndex;\n\t\t\t\tconst columnIndex = this._columnIndex;\n\t\t\t\tthis._column.setter(row, columnIndex, newValue);\n\t\t\t\tthis.emit(\"change\", newValue, oldValue, this);\n\t\t\t\tthis._onChange(newValue, oldValue, row, rowIndex, columnIndex, this);\n\t\t\t}\n\t\t});\n\t}\n\n\tget dialog(): DDialogDate {\n\t\tlet dialog = this._dialog;\n\t\tif (dialog == null) {\n\t\t\tconst options = this._options?.dialog;\n\t\t\tif (options) {\n\t\t\t\tdialog = new DDialogDate(options);\n\t\t\t} else {\n\t\t\t\tdialog = DDialogDates.getInstance();\n\t\t\t}\n\t\t\tthis._dialog = dialog;\n\t\t}\n\t\treturn dialog;\n\t}\n\n\tget row(): ROW | undefined {\n\t\treturn this._row;\n\t}\n\n\tget rowIndex(): number {\n\t\treturn this._rowIndex;\n\t}\n\n\tget columnIndex(): number {\n\t\treturn this._columnIndex;\n\t}\n\n\tget column(): DTableColumn<ROW, Date> {\n\t\treturn this._column;\n\t}\n\n\tset(\n\t\tvalue: Date,\n\t\trow: ROW,\n\t\tsupplimental: unknown,\n\t\trowIndex: number,\n\t\tcolumnIndex: number,\n\t\tforcibly?: boolean\n\t): void {\n\t\tthis._row = row;\n\t\tthis._rowIndex = rowIndex;\n\t\tif (value instanceof Date) {\n\t\t\tif (forcibly) {\n\t\t\t\tthis._textValue = value;\n\t\t\t\tthis._textValueComputed = value;\n\t\t\t\tthis.onTextChange();\n\t\t\t\tthis.createOrUpdateText();\n\t\t\t} else {\n\t\t\t\tthis.text = value;\n\t\t\t}\n\t\t} else if (isNumber(value)) {\n\t\t\tconst textValueComputed = this._textValueComputed;\n\t\t\tif (textValueComputed === undefined) {\n\t\t\t\tthis.text = new Date(value);\n\t\t\t} else if (textValueComputed.getTime() !== value) {\n\t\t\t\ttextValueComputed.setTime(value);\n\t\t\t\tthis.onTextChange();\n\t\t\t\tthis.createOrUpdateText();\n\t\t\t}\n\t\t}\n\n\t\tconst column = this._column;\n\t\tDTableBodyCells.setReadOnly(this, row, columnIndex, column);\n\t\tDTableBodyCells.setRenderable(this, row, columnIndex, column);\n\t}\n\n\tunset(): void {\n\t\tthis._row = undefined;\n\t\tthis._rowIndex = -1;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DTableBodyCellDate\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction } from \"pixi.js\";\nimport { DButton, DButtonOptions, DThemeButton } from \"./d-button\";\nimport { DDialogDatetime, DDialogDatetimeOptions } from \"./d-dialog-datetime\";\nimport { DDialogDatetimes } from \"./d-dialog-datetimes\";\nimport { DPickerDatetimeMask } from \"./d-picker-datetime-mask\";\nimport { DPickerDatetimes } from \"./d-picker-datetimes\";\nimport { DTableBodyCell, DTableBodyCellOnChange } from \"./d-table-body-cell\";\nimport { DTableBodyCells } from \"./d-table-body-cells\";\nimport { DTableColumn } from \"./d-table-column\";\nimport { isNumber } from \"./util/is-number\";\n\nexport interface DTableBodyCellDatetimeOptions<\n\tROW = unknown,\n\tTHEME extends DThemeTableBodyCellDatetime = DThemeTableBodyCellDatetime\n> extends DButtonOptions<Date, THEME> {\n\tdialog?: DDialogDatetimeOptions;\n}\n\nexport interface DThemeTableBodyCellDatetime extends DThemeButton<Date> {}\n\nexport class DTableBodyCellDatetime<\n\t\tROW = unknown,\n\t\tTHEME extends DThemeTableBodyCellDatetime = DThemeTableBodyCellDatetime,\n\t\tOPTIONS extends DTableBodyCellDatetimeOptions<ROW, THEME> = DTableBodyCellDatetimeOptions<\n\t\t\tROW,\n\t\t\tTHEME\n\t\t>\n\t>\n\textends DButton<Date, THEME, OPTIONS>\n\timplements DTableBodyCell<ROW, Date>\n{\n\tprotected _row?: ROW;\n\tprotected _rowIndex: number;\n\tprotected _columnIndex: number;\n\tprotected _column: DTableColumn<ROW, Date>;\n\tprotected _onChange: DTableBodyCellOnChange<ROW, Date>;\n\tprotected _dialog?: DDialogDatetime;\n\tprotected _datetimeMask?: DPickerDatetimeMask;\n\n\tconstructor(\n\t\tcolumnIndex: number,\n\t\tcolumn: DTableColumn<ROW, Date>,\n\t\tonChange: DTableBodyCellOnChange<ROW, Date>,\n\t\toptions?: OPTIONS\n\t) {\n\t\tsuper(options);\n\n\t\tthis._rowIndex = -1;\n\t\tthis._columnIndex = columnIndex;\n\t\tthis._column = column;\n\t\tthis._onChange = onChange;\n\t}\n\n\tprotected onActivate(\n\t\te?: interaction.InteractionEvent | KeyboardEvent | MouseEvent | TouchEvent\n\t): void {\n\t\tsuper.onActivate(e);\n\t\tconst value = this._textValueComputed?.getTime() ?? Date.now();\n\t\tconst dialog = this.dialog;\n\t\tdialog.current = new Date(value);\n\t\tdialog.new = new Date(value);\n\t\tdialog.page = new Date(value);\n\t\tdialog.open().then((): void => {\n\t\t\tconst newValue = dialog.new;\n\t\t\tconst oldValue = dialog.current;\n\t\t\tthis.text = new Date(newValue.getTime());\n\t\t\tconst row = this._row;\n\t\t\tif (row !== undefined) {\n\t\t\t\tconst rowIndex = this._rowIndex;\n\t\t\t\tconst columnIndex = this._columnIndex;\n\t\t\t\tthis._column.setter(row, columnIndex, newValue);\n\t\t\t\tthis.emit(\"change\", newValue, oldValue, this);\n\t\t\t\tthis._onChange(newValue, oldValue, row, rowIndex, columnIndex, this);\n\t\t\t}\n\t\t});\n\t}\n\n\tgetDatetimeMask(): DPickerDatetimeMask {\n\t\tlet result = this._datetimeMask;\n\t\tif (result == null) {\n\t\t\tresult = DPickerDatetimes.toMask(this._options?.dialog?.picker);\n\t\t\tthis._datetimeMask = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tget dialog(): DDialogDatetime {\n\t\tlet dialog = this._dialog;\n\t\tif (dialog == null) {\n\t\t\tconst options = this._options?.dialog;\n\t\t\tif (options) {\n\t\t\t\tdialog = new DDialogDatetime(options);\n\t\t\t} else {\n\t\t\t\tdialog = DDialogDatetimes.getInstance();\n\t\t\t}\n\t\t\tthis._dialog = dialog;\n\t\t}\n\t\treturn dialog;\n\t}\n\n\tget row(): ROW | undefined {\n\t\treturn this._row;\n\t}\n\n\tget rowIndex(): number {\n\t\treturn this._rowIndex;\n\t}\n\n\tget columnIndex(): number {\n\t\treturn this._columnIndex;\n\t}\n\n\tget column(): DTableColumn<ROW, Date> {\n\t\treturn this._column;\n\t}\n\n\tset(\n\t\tvalue: Date,\n\t\trow: ROW,\n\t\tsupplimental: unknown,\n\t\trowIndex: number,\n\t\tcolumnIndex: number,\n\t\tforcibly?: boolean\n\t): void {\n\t\tthis._row = row;\n\t\tthis._rowIndex = rowIndex;\n\t\tif (value instanceof Date) {\n\t\t\tif (forcibly) {\n\t\t\t\tthis._textValue = value;\n\t\t\t\tthis._textValueComputed = value;\n\t\t\t\tthis.onTextChange();\n\t\t\t\tthis.createOrUpdateText();\n\t\t\t} else {\n\t\t\t\tthis.text = value;\n\t\t\t}\n\t\t} else if (isNumber(value)) {\n\t\t\tconst textValueComputed = this._textValueComputed;\n\t\t\tif (textValueComputed === undefined) {\n\t\t\t\tthis.text = new Date(value);\n\t\t\t} else if (textValueComputed.getTime() !== value) {\n\t\t\t\ttextValueComputed.setTime(value);\n\t\t\t\tthis.onTextChange();\n\t\t\t\tthis.createOrUpdateText();\n\t\t\t}\n\t\t}\n\n\t\tconst column = this._column;\n\t\tDTableBodyCells.setReadOnly(this, row, columnIndex, column);\n\t\tDTableBodyCells.setRenderable(this, row, columnIndex, column);\n\t}\n\n\tunset(): void {\n\t\tthis._row = undefined;\n\t\tthis._rowIndex = -1;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DTableBodyCellDatetime\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DImageBase, DImageBaseOptions, DThemeImageBase } from \"./d-image-base\";\nimport { DTableBodyCell, DTableBodyCellOnChange } from \"./d-table-body-cell\";\nimport { DTableBodyCells } from \"./d-table-body-cells\";\nimport { DTableColumn } from \"./d-table-column\";\n\nexport interface DTableBodyCellIndexOptions<\n\tROW = unknown,\n\tVALUE = unknown,\n\tTHEME extends DThemeTableBodyCellIndex = DThemeTableBodyCellIndex\n> extends DImageBaseOptions<number, THEME> {}\n\nexport interface DThemeTableBodyCellIndex<VALUE = unknown> extends DThemeImageBase<number> {}\n\nexport class DTableBodyCellIndex<\n\t\tROW = unknown,\n\t\tVALUE = unknown,\n\t\tTHEME extends DThemeTableBodyCellIndex<VALUE> = DThemeTableBodyCellIndex<VALUE>,\n\t\tOPTIONS extends DTableBodyCellIndexOptions<ROW, VALUE, THEME> = DTableBodyCellIndexOptions<\n\t\t\tROW,\n\t\t\tVALUE,\n\t\t\tTHEME\n\t\t>\n\t>\n\textends DImageBase<number, THEME, OPTIONS>\n\timplements DTableBodyCell<ROW, VALUE>\n{\n\tprotected _row?: ROW;\n\tprotected _rowIndex: number;\n\tprotected _columnIndex: number;\n\tprotected _column: DTableColumn<ROW, VALUE>;\n\tprotected _onChange: DTableBodyCellOnChange<ROW, VALUE>;\n\n\tconstructor(\n\t\tcolumnIndex: number,\n\t\tcolumn: DTableColumn<ROW, VALUE>,\n\t\tonChange: DTableBodyCellOnChange<ROW, unknown>,\n\t\toptions?: OPTIONS\n\t) {\n\t\tsuper(options);\n\n\t\tthis._rowIndex = -1;\n\t\tthis._columnIndex = columnIndex;\n\t\tthis._column = column;\n\t\tthis._onChange = onChange;\n\t}\n\n\tget row(): ROW | undefined {\n\t\treturn this._row;\n\t}\n\n\tget rowIndex(): number {\n\t\treturn this._rowIndex;\n\t}\n\n\tget columnIndex(): number {\n\t\treturn this._columnIndex;\n\t}\n\n\tget column(): DTableColumn<ROW, VALUE> {\n\t\treturn this._column;\n\t}\n\n\tset(\n\t\tvalue: unknown,\n\t\trow: ROW,\n\t\tsupplimental: unknown,\n\t\trowIndex: number,\n\t\tcolumnIndex: number,\n\t\tforcibly?: boolean\n\t): void {\n\t\tthis._row = row;\n\t\tthis._rowIndex = rowIndex;\n\t\tthis.text = rowIndex;\n\n\t\tconst column = this._column;\n\t\tDTableBodyCells.setReadOnly(this, row, columnIndex, column);\n\t\tDTableBodyCells.setRenderable(this, row, columnIndex, column);\n\t}\n\n\tunset(): void {\n\t\tthis._row = undefined;\n\t\tthis._rowIndex = -1;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DTableBodyCellIndex\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DInputInteger, DInputIntegerOptions, DThemeInputInteger } from \"./d-input-integer\";\nimport { DTableBodyCell, DTableBodyCellOnChange } from \"./d-table-body-cell\";\nimport { DTableBodyCells } from \"./d-table-body-cells\";\nimport { DTableColumn } from \"./d-table-column\";\n\nexport interface DTableBodyCellInputIntegerOptions<\n\tROW = unknown,\n\tTHEME extends DThemeTableBodyCellInputInteger = DThemeTableBodyCellInputInteger\n> extends DInputIntegerOptions<THEME> {}\n\nexport interface DThemeTableBodyCellInputInteger extends DThemeInputInteger {}\n\nexport class DTableBodyCellInputInteger<\n\t\tROW = unknown,\n\t\tTHEME extends DThemeTableBodyCellInputInteger = DThemeTableBodyCellInputInteger,\n\t\tOPTIONS extends DTableBodyCellInputIntegerOptions<\n\t\t\tROW,\n\t\t\tTHEME\n\t\t> = DTableBodyCellInputIntegerOptions<ROW, THEME>\n\t>\n\textends DInputInteger<THEME, OPTIONS>\n\timplements DTableBodyCell<ROW, number>\n{\n\tprotected _row?: ROW;\n\tprotected _rowIndex: number;\n\tprotected _columnIndex: number;\n\tprotected _column: DTableColumn<ROW, number>;\n\tprotected _onChange: DTableBodyCellOnChange<ROW, number>;\n\n\tconstructor(\n\t\tcolumnIndex: number,\n\t\tcolumn: DTableColumn<ROW, number>,\n\t\tonChange: DTableBodyCellOnChange<ROW, number>,\n\t\toptions?: OPTIONS\n\t) {\n\t\tsuper(options);\n\n\t\tthis._rowIndex = -1;\n\t\tthis._columnIndex = columnIndex;\n\t\tthis._column = column;\n\t\tthis._onChange = onChange;\n\t}\n\n\tprotected onValueChange(newValue: number, oldValue: number): void {\n\t\tconst row = this._row;\n\t\tif (row !== undefined) {\n\t\t\tconst rowIndex = this._rowIndex;\n\t\t\tconst columnIndex = this._columnIndex;\n\t\t\tthis._column.setter(row, columnIndex, newValue);\n\t\t\tsuper.onValueChange(newValue, oldValue);\n\t\t\tthis._onChange(newValue, oldValue, row, rowIndex, columnIndex, this);\n\t\t}\n\t}\n\n\tget row(): ROW | undefined {\n\t\treturn this._row;\n\t}\n\n\tget rowIndex(): number {\n\t\treturn this._rowIndex;\n\t}\n\n\tget columnIndex(): number {\n\t\treturn this._columnIndex;\n\t}\n\n\tget column(): DTableColumn<ROW, number> {\n\t\treturn this._column;\n\t}\n\n\tset(\n\t\tvalue: unknown,\n\t\trow: ROW,\n\t\tsupplimental: unknown,\n\t\trowIndex: number,\n\t\tcolumnIndex: number,\n\t\tforcibly?: boolean\n\t): void {\n\t\tthis._row = row;\n\t\tthis._rowIndex = rowIndex;\n\t\tthis.text = Number(value);\n\n\t\tconst column = this._column;\n\t\tDTableBodyCells.setReadOnly(this, row, columnIndex, column);\n\t\tDTableBodyCells.setRenderable(this, row, columnIndex, column);\n\t}\n\n\tunset(): void {\n\t\tthis._row = undefined;\n\t\tthis._rowIndex = -1;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DTableBodyCellInputInteger\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DInputReal, DInputRealOptions, DThemeInputReal } from \"./d-input-real\";\nimport { DTableBodyCell, DTableBodyCellOnChange } from \"./d-table-body-cell\";\nimport { DTableBodyCells } from \"./d-table-body-cells\";\nimport { DTableColumn } from \"./d-table-column\";\n\nexport interface DTableBodyCellInputRealOptions<\n\tROW = unknown,\n\tTHEME extends DThemeTableBodyCellInputReal = DThemeTableBodyCellInputReal\n> extends DInputRealOptions<THEME> {}\n\nexport interface DThemeTableBodyCellInputReal extends DThemeInputReal {}\n\nexport class DTableBodyCellInputReal<\n\t\tROW = unknown,\n\t\tTHEME extends DThemeTableBodyCellInputReal = DThemeTableBodyCellInputReal,\n\t\tOPTIONS extends DTableBodyCellInputRealOptions<ROW, THEME> = DTableBodyCellInputRealOptions<\n\t\t\tROW,\n\t\t\tTHEME\n\t\t>\n\t>\n\textends DInputReal<THEME, OPTIONS>\n\timplements DTableBodyCell<ROW, number>\n{\n\tprotected _row?: ROW;\n\tprotected _rowIndex: number;\n\tprotected _columnIndex: number;\n\tprotected _column: DTableColumn<ROW, number>;\n\tprotected _onChange: DTableBodyCellOnChange<ROW, number>;\n\n\tconstructor(\n\t\tcolumnIndex: number,\n\t\tcolumn: DTableColumn<ROW, number>,\n\t\tonChange: DTableBodyCellOnChange<ROW, number>,\n\t\toptions?: OPTIONS\n\t) {\n\t\tsuper(options);\n\n\t\tthis._rowIndex = -1;\n\t\tthis._columnIndex = columnIndex;\n\t\tthis._column = column;\n\t\tthis._onChange = onChange;\n\t}\n\n\tprotected onValueChange(newValue: number, oldValue: number): void {\n\t\tconst row = this._row;\n\t\tif (row !== undefined) {\n\t\t\tconst rowIndex = this._rowIndex;\n\t\t\tconst columnIndex = this._columnIndex;\n\t\t\tthis._column.setter(row, columnIndex, newValue);\n\t\t\tsuper.onValueChange(newValue, oldValue);\n\t\t\tthis._onChange(newValue, oldValue, row, rowIndex, columnIndex, this);\n\t\t}\n\t}\n\n\tget row(): ROW | undefined {\n\t\treturn this._row;\n\t}\n\n\tget rowIndex(): number {\n\t\treturn this._rowIndex;\n\t}\n\n\tget columnIndex(): number {\n\t\treturn this._columnIndex;\n\t}\n\n\tget column(): DTableColumn<ROW, number> {\n\t\treturn this._column;\n\t}\n\n\tset(\n\t\tvalue: unknown,\n\t\trow: ROW,\n\t\tsupplimental: unknown,\n\t\trowIndex: number,\n\t\tcolumnIndex: number,\n\t\tforcibly?: boolean\n\t): void {\n\t\tthis._row = row;\n\t\tthis._rowIndex = rowIndex;\n\t\tthis.text = Number(value);\n\n\t\tconst column = this._column;\n\t\tDTableBodyCells.setReadOnly(this, row, columnIndex, column);\n\t\tDTableBodyCells.setRenderable(this, row, columnIndex, column);\n\t}\n\n\tunset(): void {\n\t\tthis._row = undefined;\n\t\tthis._rowIndex = -1;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DTableBodyCellInputReal\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DInputText, DInputTextOptions, DThemeInputText } from \"./d-input-text\";\nimport { DTableBodyCell, DTableBodyCellOnChange } from \"./d-table-body-cell\";\nimport { DTableBodyCells } from \"./d-table-body-cells\";\nimport { DTableColumn } from \"./d-table-column\";\n\nexport interface DTableBodyCellInputTextOptions<\n\tROW = unknown,\n\tTHEME extends DThemeTableBodyCellInputText = DThemeTableBodyCellInputText\n> extends DInputTextOptions<THEME> {}\n\nexport interface DThemeTableBodyCellInputText extends DThemeInputText {}\n\nexport class DTableBodyCellInputText<\n\t\tROW = unknown,\n\t\tTHEME extends DThemeTableBodyCellInputText = DThemeTableBodyCellInputText,\n\t\tOPTIONS extends DTableBodyCellInputTextOptions<ROW, THEME> = DTableBodyCellInputTextOptions<\n\t\t\tROW,\n\t\t\tTHEME\n\t\t>\n\t>\n\textends DInputText<THEME, OPTIONS>\n\timplements DTableBodyCell<ROW, string>\n{\n\tprotected _row?: ROW;\n\tprotected _rowIndex: number;\n\tprotected _columnIndex: number;\n\tprotected _column: DTableColumn<ROW, string>;\n\tprotected _onChange: DTableBodyCellOnChange<ROW, string>;\n\n\tconstructor(\n\t\tcolumnIndex: number,\n\t\tcolumn: DTableColumn<ROW, string>,\n\t\tonChange: DTableBodyCellOnChange<ROW, string>,\n\t\toptions?: OPTIONS\n\t) {\n\t\tsuper(options);\n\n\t\tthis._rowIndex = -1;\n\t\tthis._columnIndex = columnIndex;\n\t\tthis._column = column;\n\t\tthis._onChange = onChange;\n\t}\n\n\tprotected onValueChange(newValue: string, oldValue: string): void {\n\t\tconst row = this._row;\n\t\tif (row !== undefined) {\n\t\t\tconst rowIndex = this._rowIndex;\n\t\t\tconst columnIndex = this._columnIndex;\n\t\t\tthis._column.setter(row, columnIndex, newValue);\n\t\t\tsuper.onValueChange(newValue, oldValue);\n\t\t\tthis._onChange(newValue, oldValue, row, rowIndex, columnIndex, this);\n\t\t}\n\t}\n\n\tget row(): ROW | undefined {\n\t\treturn this._row;\n\t}\n\n\tget rowIndex(): number {\n\t\treturn this._rowIndex;\n\t}\n\n\tget columnIndex(): number {\n\t\treturn this._columnIndex;\n\t}\n\n\tget column(): DTableColumn<ROW, string> {\n\t\treturn this._column;\n\t}\n\n\tset(\n\t\tvalue: unknown,\n\t\trow: ROW,\n\t\tsupplimental: unknown,\n\t\trowIndex: number,\n\t\tcolumnIndex: number,\n\t\tforcibly?: boolean\n\t): void {\n\t\tthis._row = row;\n\t\tthis._rowIndex = rowIndex;\n\t\tthis.text = String(value);\n\n\t\tconst column = this._column;\n\t\tDTableBodyCells.setReadOnly(this, row, columnIndex, column);\n\t\tDTableBodyCells.setRenderable(this, row, columnIndex, column);\n\t}\n\n\tunset(): void {\n\t\tthis._row = undefined;\n\t\tthis._rowIndex = -1;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DTableBodyCellInputText\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBasePaddingAdjustable } from \"./d-base-padding-adjustable\";\nimport { DInputText, DInputTextOptions, DThemeInputText } from \"./d-input-text\";\n\nexport interface DTableBodyCellInputTreeInputOptions<\n\tTHEME extends DThemeTableBodyCellInputTreeInput = DThemeTableBodyCellInputTreeInput\n> extends DInputTextOptions<THEME> {}\n\nexport interface DThemeTableBodyCellInputTreeInput extends DThemeInputText {}\n\nexport class DTableBodyCellInputTreeInput<\n\tTHEME extends DThemeTableBodyCellInputTreeInput = DThemeTableBodyCellInputTreeInput,\n\tOPTIONS extends DTableBodyCellInputTreeInputOptions<THEME> = DTableBodyCellInputTreeInputOptions<THEME>\n> extends DInputText<THEME, OPTIONS> {\n\tprotected _padding!: DBasePaddingAdjustable;\n\n\tconstructor(options?: OPTIONS) {\n\t\tsuper(options);\n\t\tthis._padding = new DBasePaddingAdjustable(this._padding);\n\t}\n\n\tget padding(): DBasePaddingAdjustable {\n\t\treturn this._padding;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DTableBodyCellInputTreeInput\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DButtonBase, DButtonBaseOptions, DThemeButtonBase } from \"./d-button-base\";\n\nexport interface DTableBodyCellInputTreeMarkerOptions<\n\tVALUE = unknown,\n\tTHEME extends DThemeTableBodyCellInputTreeMarker<VALUE> = DThemeTableBodyCellInputTreeMarker<VALUE>\n> extends DButtonBaseOptions<VALUE, THEME> {}\n\nexport interface DThemeTableBodyCellInputTreeMarker<VALUE = unknown>\n\textends DThemeButtonBase<VALUE> {}\n\nexport class DTableBodyCellInputTreeMarker<\n\tVALUE = unknown,\n\tTHEME extends DThemeTableBodyCellInputTreeMarker<VALUE> = DThemeTableBodyCellInputTreeMarker<VALUE>,\n\tOPTIONS extends DTableBodyCellInputTreeMarkerOptions<\n\t\tVALUE,\n\t\tTHEME\n\t> = DTableBodyCellInputTreeMarkerOptions<VALUE, THEME>\n> extends DButtonBase<VALUE, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DTableBodyCellInputTreeMarker\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * {@link DTable} states.\n */\nexport const DTableState = {\n\t/**\n\t * Start cells in rows.\n\t */\n\tSTART: \"START\",\n\n\t/**\n\t * End cells in rows.\n\t */\n\tEND: \"END\",\n\n\t/**\n\t * Cells of frozen columns.\n\t */\n\tFROZEN: \"FROZEN\",\n\n\t/**\n\t * Cells of a right-most frozen column.\n\t */\n\tFROZEN_END: \"FROZEN_END\",\n\n\t/**\n\t * Header cells of sortable columns.\n\t */\n\tSORTABLE: \"SORTABLE\",\n\n\t/**\n\t * Header cells of columns sorted in the ascending order.\n\t */\n\tSORTED_ASCENDING: \"SORTED_ASCENDING\",\n\n\t/**\n\t * Header cells of columns sorted in the descending order.\n\t */\n\tSORTED_DESCENDING: \"SORTED_DESCENDING\",\n\n\t/**\n\t * Tree cells with child cells.\n\t */\n\tHAS_CHILDREN: \"HAS_CHILDREN\",\n\n\t/**\n\t * Tree cells opened.\n\t */\n\tOPENED: \"OPENED\",\n\n\t/**\n\t * Header cells of checkable columns.\n\t */\n\tCHECKABLE: \"CHECKABLE\",\n\n\t/**\n\t * Selectable row\n\t */\n\tSELECTABLE: \"SELECTABLE\"\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction, Point } from \"pixi.js\";\nimport { DBase, DThemeBase } from \"./d-base\";\nimport { DBaseState } from \"./d-base-state\";\nimport {\n\tDTableBodyCellInputTreeInput,\n\tDTableBodyCellInputTreeInputOptions\n} from \"./d-table-body-cell-input-tree-input\";\nimport { DTableBodyCellInputTreeMarker } from \"./d-table-body-cell-input-tree-marker\";\nimport { DTableBodyCells } from \"./d-table-body-cells\";\nimport { DTableState } from \"./d-table-state\";\nimport { DTableColumn } from \"./d-table-column\";\nimport { isNumber } from \"./util/is-number\";\nimport { DTableBodyCell, DTableBodyCellOnChange } from \"./d-table-body-cell\";\n\nexport interface DThemeTableBodyCellInputTree extends DThemeBase {\n\tgetLevelPadding(level: number): number;\n}\n\nconst toBaseOptions = (options?: DTableBodyCellInputTreeInputOptions) => {\n\tif (options != null) {\n\t\treturn {\n\t\t\tweight: options.weight,\n\t\t\twidth: options.width\n\t\t};\n\t}\n\treturn undefined;\n};\n\nexport class DTableBodyCellInputTree<\n\t\tROW = unknown,\n\t\tTHEME extends DThemeTableBodyCellInputTree = DThemeTableBodyCellInputTree,\n\t\tOPTIONS extends DTableBodyCellInputTreeInputOptions = DTableBodyCellInputTreeInputOptions\n\t>\n\textends DBase<THEME>\n\timplements DTableBodyCell<ROW, string>\n{\n\tprotected _row?: ROW;\n\tprotected _rowIndex: number;\n\tprotected _columnIndex: number;\n\tprotected _column: DTableColumn<ROW, string>;\n\tprotected _onChange: DTableBodyCellOnChange<ROW, string>;\n\n\tprotected _marker: DTableBodyCellInputTreeMarker;\n\tprotected _input: DTableBodyCellInputTreeInput;\n\n\tconstructor(\n\t\tcolumnIndex: number,\n\t\tcolumn: DTableColumn<ROW, string>,\n\t\tonChange: DTableBodyCellOnChange<ROW, string>,\n\t\toptions?: OPTIONS\n\t) {\n\t\tsuper(toBaseOptions(options));\n\n\t\tthis._rowIndex = -1;\n\t\tthis._columnIndex = columnIndex;\n\t\tthis._column = column;\n\t\tthis._onChange = onChange;\n\n\t\t// Input\n\t\tconst input = this.newInput(options);\n\t\tthis._input = input;\n\t\tthis.addChild(input);\n\n\t\t// Marker\n\t\tconst marker = this.newMarker(options);\n\t\tthis._marker = marker;\n\t\tthis.addChild(marker);\n\t}\n\n\tprotected newInput(options?: OPTIONS): DTableBodyCellInputTreeInput {\n\t\treturn new DTableBodyCellInputTreeInput(this.toInputOptions(options));\n\t}\n\n\tprotected toInputOptions(options?: OPTIONS): DTableBodyCellInputTreeInputOptions {\n\t\treturn {\n\t\t\tweight: 1,\n\t\t\ttext: options?.text,\n\t\t\tediting: options?.editing,\n\t\t\twhen: options?.when,\n\t\t\tcursor: options?.cursor,\n\t\t\ton: {\n\t\t\t\tchange: (newValue: string, oldValue: string): void => {\n\t\t\t\t\tthis.onInputChange(newValue, oldValue);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\tprotected onInputChange(newValue: string, oldValue: string): void {\n\t\tconst row = this._row;\n\t\tif (row !== undefined) {\n\t\t\tconst rowIndex = this._rowIndex;\n\t\t\tconst columnIndex = this._columnIndex;\n\t\t\tthis._column.setter(row, columnIndex, newValue);\n\t\t\tthis.emit(\"change\", newValue, oldValue, this);\n\t\t\tthis._onChange(newValue, oldValue, row, rowIndex, columnIndex, this);\n\t\t}\n\t}\n\n\tprotected newMarker(options?: OPTIONS): DTableBodyCellInputTreeMarker {\n\t\treturn new DTableBodyCellInputTreeMarker({\n\t\t\tvisible: false,\n\t\t\ton: {\n\t\t\t\tactive: (): void => {\n\t\t\t\t\tthis.onMarkerActive();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tprotected onMarkerActive(): void {\n\t\tif (this._marker.state.is(DTableState.HAS_CHILDREN)) {\n\t\t\tconst row = this.parent;\n\t\t\tif (row) {\n\t\t\t\tconst body = row.parent as any;\n\t\t\t\tif (body) {\n\t\t\t\t\tconst data = body.data;\n\t\t\t\t\tif (data && data.toggle) {\n\t\t\t\t\t\tdata.toggle(this._row);\n\t\t\t\t\t\tthis.emit(\n\t\t\t\t\t\t\t\"cellchange\",\n\t\t\t\t\t\t\tnull,\n\t\t\t\t\t\t\tnull,\n\t\t\t\t\t\t\tthis._row,\n\t\t\t\t\t\t\tthis._rowIndex,\n\t\t\t\t\t\t\tthis._columnIndex,\n\t\t\t\t\t\t\tthis\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tget row(): ROW | undefined {\n\t\treturn this._row;\n\t}\n\n\tget rowIndex(): number {\n\t\treturn this._rowIndex;\n\t}\n\n\tget columnIndex(): number {\n\t\treturn this._columnIndex;\n\t}\n\n\tget column(): DTableColumn<ROW, string> {\n\t\treturn this._column;\n\t}\n\n\tonRowSelect(e: interaction.InteractionEvent, local: Point): boolean {\n\t\tif (local.x <= this.position.x + this._input.padding.getLeft()) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tset(\n\t\tvalue: unknown,\n\t\trow: ROW,\n\t\tsupplimental: unknown,\n\t\trowIndex: number,\n\t\tcolumnIndex: number,\n\t\tforcibly?: boolean\n\t): void {\n\t\tthis._row = row;\n\t\tthis._rowIndex = rowIndex;\n\t\tconst input = this._input;\n\t\tinput.visible = true;\n\t\tinput.text = String(value);\n\n\t\tconst marker = this._marker;\n\t\tif (isNumber(supplimental)) {\n\t\t\tconst isOpened = !!(supplimental & 0x1);\n\t\t\tconst hasChildren = !!(supplimental & 0x2);\n\t\t\tconst level = supplimental >> 2;\n\t\t\tconst markerState = marker.state;\n\t\t\tmarkerState.lock();\n\t\t\tmarkerState.set(DTableState.HAS_CHILDREN, hasChildren);\n\t\t\tmarkerState.set(DBaseState.DISABLED, !hasChildren);\n\t\t\tmarkerState.set(DTableState.OPENED, isOpened);\n\t\t\tmarkerState.unlock();\n\t\t\tconst padding = this.theme.getLevelPadding(level);\n\t\t\tmarker.width = padding;\n\t\t\tif (hasChildren) {\n\t\t\t\tmarker.show();\n\t\t\t} else {\n\t\t\t\tmarker.hide();\n\t\t\t}\n\t\t\tinput.padding.adjLeft(padding);\n\t\t} else {\n\t\t\tmarker.state.removeAll(DTableState.OPENED, DTableState.HAS_CHILDREN);\n\t\t\tmarker.hide();\n\t\t\tinput.padding.adjLeft(0);\n\t\t}\n\n\t\tconst column = this._column;\n\t\tDTableBodyCells.setReadOnly(this._input, row, columnIndex, column);\n\t\tDTableBodyCells.setRenderable(this, row, columnIndex, column);\n\t}\n\n\tunset(): void {\n\t\tthis._row = undefined;\n\t\tthis._rowIndex = -1;\n\t\tthis._input.visible = false;\n\t\tthis._marker.hide();\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DTableBodyCellInputTree\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction } from \"pixi.js\";\nimport { DButtonBaseWhen } from \"./d-button-base-when\";\nimport { DLink, DLinkChecker, DLinkOptions, DLinkUrlMaker } from \"./d-link\";\nimport { DLinkMenuItemId } from \"./d-link-menu-item-id\";\nimport { DLinkTarget } from \"./d-link-target\";\nimport { DLinks } from \"./d-links\";\nimport { DMenu, DMenuOptions } from \"./d-menu\";\nimport { DTableBodyCell, DTableBodyCellOnChange } from \"./d-table-body-cell\";\nimport {\n\tDTableBodyCellButton,\n\tDTableBodyCellButtonOptions,\n\tDThemeTableBodyCellButton\n} from \"./d-table-body-cell-button\";\nimport { DTableColumn } from \"./d-table-column\";\nimport { isString } from \"./util/is-string\";\n\nexport type DTableBodyCellLinkUrlMaker<ROW, VALUE> = (\n\trow: ROW,\n\trowIndex: number,\n\tcolumnIndex: number,\n\tlink: DTableBodyCell<ROW, VALUE | null>\n) => string | null | Promise<string | null>;\n\nexport type DTableBodyCellLinkChecker<ROW, VALUE> = (\n\trow: ROW,\n\trowIndex: number,\n\tcolumnIndex: number,\n\tlink: DTableBodyCell<ROW, VALUE | null>\n) => boolean | Promise<boolean>;\n\nexport interface DTableBodyCellLinkLinkOptions<ROW, VALUE> {\n\turl?: string | DTableBodyCellLinkUrlMaker<ROW, VALUE>;\n\ttarget?: DLinkTarget | keyof typeof DLinkTarget;\n\tchecker?: DTableBodyCellLinkChecker<ROW, VALUE>;\n\tmenu?: DMenuOptions<DLinkMenuItemId> | DMenu<DLinkMenuItemId>;\n}\n\nexport interface DTableBodyCellLinkOptions<\n\tROW,\n\tVALUE = unknown,\n\tTHEME extends DThemeTableBodyCellLink<VALUE> = DThemeTableBodyCellLink<VALUE>\n> extends DTableBodyCellButtonOptions<ROW, VALUE, THEME> {\n\tlink?: DTableBodyCellLinkLinkOptions<ROW, VALUE>;\n}\n\nexport interface DThemeTableBodyCellLink<VALUE = unknown>\n\textends DThemeTableBodyCellButton<VALUE> {}\n\nexport const toLinkOptions = <ROW, VALUE>(\n\tcell: DTableBodyCell<ROW, VALUE | null>,\n\toptions?: DTableBodyCellLinkLinkOptions<ROW, VALUE>\n): DLinkOptions | undefined => {\n\tif (options) {\n\t\treturn {\n\t\t\turl: toUrl(cell, options.url),\n\t\t\ttarget: options.target,\n\t\t\tchecker: toChecker(cell, options.checker),\n\t\t\tmenu: options.menu\n\t\t};\n\t}\n\treturn undefined;\n};\n\nexport const toUrl = <ROW, VALUE>(\n\tcell: DTableBodyCell<ROW, VALUE | null>,\n\turl?: string | DTableBodyCellLinkUrlMaker<ROW, VALUE>\n): string | DLinkUrlMaker | undefined => {\n\tif (isString(url) || url == null) {\n\t\treturn url;\n\t} else {\n\t\treturn () => {\n\t\t\tconst row = cell.row;\n\t\t\tif (row !== undefined) {\n\t\t\t\treturn url(row, cell.rowIndex, cell.columnIndex, cell);\n\t\t\t}\n\t\t\treturn null;\n\t\t};\n\t}\n};\n\nexport const toChecker = <ROW, VALUE>(\n\tcell: DTableBodyCell<ROW, VALUE | null>,\n\tchecker?: DTableBodyCellLinkChecker<ROW, VALUE>\n): DLinkChecker | undefined => {\n\tif (checker != null) {\n\t\treturn (): boolean | Promise<boolean> => {\n\t\t\tconst row = cell.row;\n\t\t\tif (row !== undefined) {\n\t\t\t\treturn checker(row, cell.rowIndex, cell.columnIndex, cell);\n\t\t\t}\n\t\t\treturn false;\n\t\t};\n\t}\n\treturn undefined;\n};\n\nexport class DTableBodyCellLink<\n\tROW,\n\tVALUE = unknown,\n\tTHEME extends DThemeTableBodyCellLink<VALUE> = DThemeTableBodyCellLink<VALUE>,\n\tOPTIONS extends DTableBodyCellLinkOptions<ROW, VALUE, THEME> = DTableBodyCellLinkOptions<\n\t\tROW,\n\t\tVALUE,\n\t\tTHEME\n\t>\n> extends DTableBodyCellButton<ROW, VALUE, THEME, OPTIONS> {\n\tprotected _link?: DLink;\n\n\tconstructor(\n\t\tcolumnIndex: number,\n\t\tcolumn: DTableColumn<ROW, VALUE | null>,\n\t\tonChange: DTableBodyCellOnChange<ROW, VALUE | null>,\n\t\toptions: OPTIONS\n\t) {\n\t\tsuper(columnIndex, column, onChange, DLinks.toStateOptions(options?.link?.target, options));\n\t}\n\n\tprotected initOnClick(when: DButtonBaseWhen, theme: THEME, options?: OPTIONS): void {\n\t\tthis.link.add(this, (e: interaction.InteractionEvent): void => {\n\t\t\tif (when === DButtonBaseWhen.CLICKED) {\n\t\t\t\tthis.onClick(e);\n\t\t\t}\n\t\t});\n\t}\n\n\tget link(): DLink {\n\t\tlet result = this._link;\n\t\tif (result == null) {\n\t\t\tresult = new DLink(toLinkOptions(this, this._options?.link));\n\t\t\tthis._link = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DTableBodyCellLink\";\n\t}\n\n\tprotected onActivate(\n\t\te?: interaction.InteractionEvent | KeyboardEvent | MouseEvent | TouchEvent\n\t): void {\n\t\tsuper.onActivate(e);\n\t\tthis.link.open(e);\n\t}\n\n\topen(inNewWindow: boolean): void {\n\t\tthis.link.open(inNewWindow);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DMenuItem } from \"./d-menu-item\";\nimport { DSelect, DSelectOptions, DThemeSelect } from \"./d-select\";\nimport { DTableBodyCell, DTableBodyCellOnChange } from \"./d-table-body-cell\";\nimport { DTableBodyCells } from \"./d-table-body-cells\";\nimport { DTableColumn } from \"./d-table-column\";\n\nexport interface DTableBodyCellSelectMenuOptions<\n\tROW = unknown,\n\tVALUE = unknown,\n\tTHEME extends DThemeTableBodyCellSelectMenu<VALUE> = DThemeTableBodyCellSelectMenu<VALUE>\n> extends DSelectOptions<VALUE, THEME> {}\n\nexport interface DThemeTableBodyCellSelectMenu<VALUE = unknown> extends DThemeSelect<VALUE> {}\n\nexport class DTableBodyCellSelectMenu<\n\t\tROW = unknown,\n\t\tVALUE = unknown,\n\t\tTHEME extends DThemeTableBodyCellSelectMenu<VALUE> = DThemeTableBodyCellSelectMenu<VALUE>,\n\t\tOPTIONS extends DTableBodyCellSelectMenuOptions<\n\t\t\tROW,\n\t\t\tVALUE,\n\t\t\tTHEME\n\t\t> = DTableBodyCellSelectMenuOptions<ROW, VALUE, THEME>\n\t>\n\textends DSelect<VALUE, THEME, OPTIONS>\n\timplements DTableBodyCell<ROW, VALUE | null>\n{\n\tprotected _row?: ROW;\n\tprotected _rowIndex: number;\n\tprotected _columnIndex: number;\n\tprotected _column: DTableColumn<ROW, VALUE | null>;\n\tprotected _onChange: DTableBodyCellOnChange<ROW, VALUE | null>;\n\n\tconstructor(\n\t\tcolumnIndex: number,\n\t\tcolumn: DTableColumn<ROW, VALUE | null>,\n\t\tonChange: DTableBodyCellOnChange<ROW, VALUE | null>,\n\t\toptions?: OPTIONS\n\t) {\n\t\tsuper(options);\n\n\t\tthis._rowIndex = -1;\n\t\tthis._columnIndex = columnIndex;\n\t\tthis._column = column;\n\t\tthis._onChange = onChange;\n\t}\n\n\tprotected onValueChange(\n\t\tnewValue: VALUE | null,\n\t\toldValue: VALUE | null,\n\t\titem: DMenuItem<VALUE> | null\n\t): void {\n\t\tconst row = this._row;\n\t\tif (row !== undefined) {\n\t\t\tconst rowIndex = this._rowIndex;\n\t\t\tconst columnIndex = this._columnIndex;\n\t\t\tthis._column.setter(row, columnIndex, newValue);\n\t\t\tsuper.onValueChange(newValue, oldValue, item);\n\t\t\tthis._onChange(newValue, oldValue, row, rowIndex, columnIndex, this);\n\t\t}\n\t}\n\n\tprotected onKeyDownArrowDown(e: KeyboardEvent): boolean {\n\t\treturn false;\n\t}\n\n\tget row(): ROW | undefined {\n\t\treturn this._row;\n\t}\n\n\tget rowIndex(): number {\n\t\treturn this._rowIndex;\n\t}\n\n\tget columnIndex(): number {\n\t\treturn this._columnIndex;\n\t}\n\n\tget column(): DTableColumn<ROW, VALUE | null> {\n\t\treturn this._column;\n\t}\n\n\tset(\n\t\tvalue: unknown,\n\t\trow: ROW,\n\t\tsupplimental: unknown,\n\t\trowIndex: number,\n\t\tcolumnIndex: number,\n\t\tforcibly?: boolean\n\t): void {\n\t\tthis._row = row;\n\t\tthis._rowIndex = rowIndex;\n\t\tthis.value = value as VALUE | null;\n\n\t\tconst column = this._column;\n\t\tDTableBodyCells.setReadOnly(this, row, columnIndex, column);\n\t\tDTableBodyCells.setRenderable(this, row, columnIndex, column);\n\t}\n\n\tunset(): void {\n\t\tthis._row = undefined;\n\t\tthis._rowIndex = -1;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DTableBodyCellSelectMenu\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DMenuItem } from \"./d-menu-item\";\nimport { DSelectMultiple, DSelectMultipleOptions, DThemeSelectMultiple } from \"./d-select-multiple\";\nimport { DTableBodyCell, DTableBodyCellOnChange } from \"./d-table-body-cell\";\nimport { DTableBodyCells } from \"./d-table-body-cells\";\nimport { DTableColumn } from \"./d-table-column\";\n\nexport interface DTableBodyCellSelectMultipleOptions<\n\tROW = unknown,\n\tVALUE = unknown,\n\tTHEME extends DThemeTableBodyCellSelectMultiple<VALUE> = DThemeTableBodyCellSelectMultiple<VALUE>\n> extends DSelectMultipleOptions<VALUE, THEME> {}\n\nexport interface DThemeTableBodyCellSelectMultiple<VALUE = unknown>\n\textends DThemeSelectMultiple<VALUE> {}\n\nexport class DTableBodyCellSelectMultiple<\n\t\tROW = unknown,\n\t\tVALUE = unknown,\n\t\tTHEME extends DThemeTableBodyCellSelectMultiple<VALUE> = DThemeTableBodyCellSelectMultiple<VALUE>,\n\t\tOPTIONS extends DTableBodyCellSelectMultipleOptions<\n\t\t\tROW,\n\t\t\tVALUE,\n\t\t\tTHEME\n\t\t> = DTableBodyCellSelectMultipleOptions<ROW, VALUE, THEME>\n\t>\n\textends DSelectMultiple<VALUE, THEME, OPTIONS>\n\timplements DTableBodyCell<ROW, VALUE[]>\n{\n\tprotected _row?: ROW;\n\tprotected _rowIndex: number;\n\tprotected _columnIndex: number;\n\tprotected _column: DTableColumn<ROW, VALUE[]>;\n\tprotected _onChange: DTableBodyCellOnChange<ROW, VALUE[]>;\n\n\tconstructor(\n\t\tcolumnIndex: number,\n\t\tcolumn: DTableColumn<ROW, VALUE[]>,\n\t\tonChange: DTableBodyCellOnChange<ROW, VALUE[]>,\n\t\toptions?: OPTIONS\n\t) {\n\t\tsuper(options);\n\n\t\tthis._rowIndex = -1;\n\t\tthis._columnIndex = columnIndex;\n\t\tthis._column = column;\n\t\tthis._onChange = onChange;\n\t}\n\n\tprotected onValueChange(\n\t\tnewValues: VALUE[],\n\t\toldValues: VALUE[],\n\t\titems: Array<DMenuItem<VALUE>>\n\t): void {\n\t\tconst row = this._row;\n\t\tif (row !== undefined) {\n\t\t\tconst rowIndex = this._rowIndex;\n\t\t\tconst columnIndex = this._columnIndex;\n\t\t\tthis._column.setter(row, columnIndex, newValues);\n\t\t\tsuper.onValueChange(newValues, oldValues, items);\n\t\t\tthis._onChange(newValues, oldValues, row, rowIndex, columnIndex, this);\n\t\t}\n\t}\n\n\tprotected onKeyDownArrowDown(e: KeyboardEvent): boolean {\n\t\treturn false;\n\t}\n\n\tget row(): ROW | undefined {\n\t\treturn this._row;\n\t}\n\n\tget rowIndex(): number {\n\t\treturn this._rowIndex;\n\t}\n\n\tget columnIndex(): number {\n\t\treturn this._columnIndex;\n\t}\n\n\tget column(): DTableColumn<ROW, VALUE[]> {\n\t\treturn this._column;\n\t}\n\n\tset(\n\t\tvalue: unknown,\n\t\trow: ROW,\n\t\tsupplimental: unknown,\n\t\trowIndex: number,\n\t\tcolumnIndex: number,\n\t\tforcibly?: boolean\n\t): void {\n\t\tthis._row = row;\n\t\tthis._rowIndex = rowIndex;\n\t\tthis.values = value as VALUE[];\n\n\t\tconst column = this._column;\n\t\tDTableBodyCells.setReadOnly(this, row, columnIndex, column);\n\t\tDTableBodyCells.setRenderable(this, row, columnIndex, column);\n\t}\n\n\tunset(): void {\n\t\tthis._row = undefined;\n\t\tthis._rowIndex = -1;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DTableBodyCellSelectMultiple\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction } from \"pixi.js\";\nimport { DButton, DButtonOptions, DThemeButton } from \"./d-button\";\nimport { DDialogTime, DDialogTimeOptions } from \"./d-dialog-time\";\nimport { DDialogTimes } from \"./d-dialog-times\";\nimport { DPickerDatetimeMask } from \"./d-picker-datetime-mask\";\nimport { DPickerTimes } from \"./d-picker-times\";\nimport { DTableBodyCell, DTableBodyCellOnChange } from \"./d-table-body-cell\";\nimport { DTableBodyCells } from \"./d-table-body-cells\";\nimport { DTableColumn } from \"./d-table-column\";\nimport { isNumber } from \"./util/is-number\";\n\nexport interface DTableBodyCellTimeOptions<\n\tROW = unknown,\n\tTHEME extends DThemeTableBodyCellTime = DThemeTableBodyCellTime\n> extends DButtonOptions<Date, THEME> {\n\tdialog?: DDialogTimeOptions;\n}\n\nexport interface DThemeTableBodyCellTime extends DThemeButton<Date> {}\n\nexport class DTableBodyCellTime<\n\t\tROW = unknown,\n\t\tTHEME extends DThemeTableBodyCellTime = DThemeTableBodyCellTime,\n\t\tOPTIONS extends DTableBodyCellTimeOptions<ROW, THEME> = DTableBodyCellTimeOptions<\n\t\t\tROW,\n\t\t\tTHEME\n\t\t>\n\t>\n\textends DButton<Date, THEME, OPTIONS>\n\timplements DTableBodyCell<ROW, Date>\n{\n\tprotected _row?: ROW;\n\tprotected _rowIndex: number;\n\tprotected _columnIndex: number;\n\tprotected _column: DTableColumn<ROW, Date>;\n\tprotected _onChange: DTableBodyCellOnChange<ROW, Date>;\n\tprotected _dialog?: DDialogTime;\n\tprotected _datetimeMask?: DPickerDatetimeMask;\n\n\tconstructor(\n\t\tcolumnIndex: number,\n\t\tcolumn: DTableColumn<ROW, Date>,\n\t\tonChange: DTableBodyCellOnChange<ROW, Date>,\n\t\toptions?: OPTIONS\n\t) {\n\t\tsuper(options);\n\n\t\tthis._rowIndex = -1;\n\t\tthis._columnIndex = columnIndex;\n\t\tthis._column = column;\n\t\tthis._onChange = onChange;\n\t}\n\n\tprotected onActivate(\n\t\te?: interaction.InteractionEvent | KeyboardEvent | MouseEvent | TouchEvent\n\t): void {\n\t\tsuper.onActivate(e);\n\t\tconst value = this._textValueComputed?.getTime() ?? Date.now();\n\t\tconst dialog = this.dialog;\n\t\tdialog.current = new Date(value);\n\t\tdialog.new = new Date(value);\n\t\tdialog.open().then((): void => {\n\t\t\tconst newValue = dialog.new;\n\t\t\tconst oldValue = dialog.current;\n\t\t\tthis.text = new Date(newValue.getTime());\n\t\t\tconst row = this._row;\n\t\t\tif (row !== undefined) {\n\t\t\t\tconst rowIndex = this._rowIndex;\n\t\t\t\tconst columnIndex = this._columnIndex;\n\t\t\t\tthis._column.setter(row, columnIndex, newValue);\n\t\t\t\tthis.emit(\"change\", newValue, oldValue, this);\n\t\t\t\tthis._onChange(newValue, oldValue, row, rowIndex, columnIndex, this);\n\t\t\t}\n\t\t});\n\t}\n\n\tgetDatetimeMask(): DPickerDatetimeMask {\n\t\tlet result = this._datetimeMask;\n\t\tif (result == null) {\n\t\t\tresult = DPickerTimes.toMask(this._options?.dialog?.picker);\n\t\t\tthis._datetimeMask = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tget dialog(): DDialogTime {\n\t\tlet dialog = this._dialog;\n\t\tif (dialog == null) {\n\t\t\tconst options = this._options?.dialog;\n\t\t\tif (options) {\n\t\t\t\tdialog = new DDialogTime(options);\n\t\t\t} else {\n\t\t\t\tdialog = DDialogTimes.getInstance();\n\t\t\t}\n\t\t\tthis._dialog = dialog;\n\t\t}\n\t\treturn dialog;\n\t}\n\n\tget row(): ROW | undefined {\n\t\treturn this._row;\n\t}\n\n\tget rowIndex(): number {\n\t\treturn this._rowIndex;\n\t}\n\n\tget columnIndex(): number {\n\t\treturn this._columnIndex;\n\t}\n\n\tget column(): DTableColumn<ROW, Date> {\n\t\treturn this._column;\n\t}\n\n\tset(\n\t\tvalue: Date,\n\t\trow: ROW,\n\t\tsupplimental: unknown,\n\t\trowIndex: number,\n\t\tcolumnIndex: number,\n\t\tforcibly?: boolean\n\t): void {\n\t\tthis._row = row;\n\t\tthis._rowIndex = rowIndex;\n\t\tif (value instanceof Date) {\n\t\t\tif (forcibly) {\n\t\t\t\tthis._textValue = value;\n\t\t\t\tthis._textValueComputed = value;\n\t\t\t\tthis.onTextChange();\n\t\t\t\tthis.createOrUpdateText();\n\t\t\t} else {\n\t\t\t\tthis.text = value;\n\t\t\t}\n\t\t} else if (isNumber(value)) {\n\t\t\tconst textValueComputed = this._textValueComputed;\n\t\t\tif (textValueComputed == null) {\n\t\t\t\tthis.text = new Date(value);\n\t\t\t} else if (textValueComputed.getTime() !== value) {\n\t\t\t\ttextValueComputed.setTime(value);\n\t\t\t\tthis.onTextChange();\n\t\t\t\tthis.createOrUpdateText();\n\t\t\t}\n\t\t}\n\n\t\tconst column = this._column;\n\t\tDTableBodyCells.setReadOnly(this, row, columnIndex, column);\n\t\tDTableBodyCells.setRenderable(this, row, columnIndex, column);\n\t}\n\n\tunset(): void {\n\t\tthis._row = undefined;\n\t\tthis._rowIndex = -1;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DTableBodyCellTime\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction, Point } from \"pixi.js\";\nimport { DBasePaddingAdjustable } from \"./d-base-padding-adjustable\";\nimport { DButtonBaseWhen } from \"./d-button-base-when\";\nimport { DLink } from \"./d-link\";\nimport { DLinks } from \"./d-links\";\nimport {\n\tDTableBodyCellButton,\n\tDTableBodyCellButtonOptions,\n\tDThemeTableBodyCellButton\n} from \"./d-table-body-cell-button\";\nimport { DTableBodyCellLinkLinkOptions, toLinkOptions } from \"./d-table-body-cell-link\";\nimport { DTableBodyCells } from \"./d-table-body-cells\";\nimport { DTableState } from \"./d-table-state\";\nimport { DTableColumn } from \"./d-table-column\";\nimport { isNumber } from \"./util/is-number\";\nimport { DTableBodyCellOnChange } from \"./d-table-body-cell\";\nimport { DStateAwareOrValue } from \"./d-state-aware\";\n\nexport interface DTableBodyCellTreeOptions<\n\tROW,\n\tVALUE = unknown,\n\tTHEME extends DThemeTableBodyCellTree<VALUE> = DThemeTableBodyCellTree<VALUE>\n> extends DTableBodyCellButtonOptions<ROW, VALUE, THEME> {\n\tlink?: DTableBodyCellLinkLinkOptions<ROW, VALUE>;\n}\n\nexport interface DThemeTableBodyCellTree<VALUE = unknown> extends DThemeTableBodyCellButton<VALUE> {\n\tgetLevelPadding(level: number): number;\n}\n\nexport class DTableBodyCellTree<\n\tROW,\n\tVALUE = unknown,\n\tTHEME extends DThemeTableBodyCellTree<VALUE> = DThemeTableBodyCellTree<VALUE>,\n\tOPTIONS extends DTableBodyCellTreeOptions<ROW, VALUE, THEME> = DTableBodyCellTreeOptions<\n\t\tROW,\n\t\tVALUE,\n\t\tTHEME\n\t>\n> extends DTableBodyCellButton<ROW, VALUE, THEME, OPTIONS> {\n\tprotected _padding!: DBasePaddingAdjustable;\n\tprotected _link?: DLink | null;\n\n\tconstructor(\n\t\tcolumnIndex: number,\n\t\tcolumn: DTableColumn<ROW, VALUE | null>,\n\t\tonChange: DTableBodyCellOnChange<ROW, VALUE | null>,\n\t\toptions?: OPTIONS\n\t) {\n\t\tsuper(columnIndex, column, onChange, DLinks.toStateOptions(options?.link?.target, options));\n\t\tthis._padding = new DBasePaddingAdjustable(this._padding);\n\t}\n\n\tprotected initOnClick(when: DButtonBaseWhen, theme: THEME, options: OPTIONS): void {\n\t\tconst link = this.link;\n\t\tif (link) {\n\t\t\tlink.add(this, (e: interaction.InteractionEvent): void => {\n\t\t\t\tif (when === DButtonBaseWhen.CLICKED) {\n\t\t\t\t\tthis.onClick(e);\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tsuper.initOnClick(when, theme, options);\n\t\t}\n\t}\n\n\tget link(): DLink | null {\n\t\tlet result = this._link;\n\t\tif (result === undefined) {\n\t\t\tresult = this.newLink();\n\t\t\tthis._link = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected newLink(): DLink | null {\n\t\tconst options = this._options?.link;\n\t\tif (options) {\n\t\t\treturn new DLink(toLinkOptions(this, options));\n\t\t}\n\t\treturn null;\n\t}\n\n\tprotected onActivate(\n\t\te?: interaction.InteractionEvent | KeyboardEvent | MouseEvent | TouchEvent\n\t): void {\n\t\tsuper.onActivate(e);\n\t\tif (this.state.is(DTableState.HAS_CHILDREN)) {\n\t\t\tthis.toggle();\n\t\t} else {\n\t\t\tthis.link?.open(e);\n\t\t}\n\t}\n\n\tprotected toggle(): void {\n\t\tconst row = this._row;\n\t\tif (row === undefined) {\n\t\t\treturn;\n\t\t}\n\t\tconst parent = this.parent;\n\t\tif (parent == null) {\n\t\t\treturn;\n\t\t}\n\t\tconst body = parent.parent;\n\t\tif (body == null) {\n\t\t\treturn;\n\t\t}\n\t\tconst data = (body as any).data;\n\t\tif (data && data.toggle) {\n\t\t\tdata.toggle(row);\n\t\t}\n\t}\n\n\tonRowSelect(e: interaction.InteractionEvent, local: Point): boolean {\n\t\tif (local.x <= this.position.x + this.padding.getLeft()) {\n\t\t\tthis.toggle();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tset(\n\t\tvalue: unknown,\n\t\trow: ROW,\n\t\tsupplimental: unknown,\n\t\trowIndex: number,\n\t\tcolumnIndex: number,\n\t\tforcibly?: boolean\n\t): void {\n\t\tthis._row = row;\n\t\tthis._rowIndex = rowIndex;\n\t\tthis.text = value as DStateAwareOrValue<VALUE | null>;\n\n\t\tconst column = this._column;\n\t\tDTableBodyCells.setRenderable(this, row, columnIndex, column);\n\n\t\tconst link = this.link;\n\t\tconst padding = this._padding;\n\t\tif (isNumber(supplimental)) {\n\t\t\tconst isOpened = !!(supplimental & 0x1);\n\t\t\tconst hasChildren = !!(supplimental & 0x2);\n\t\t\tconst level = supplimental >> 2;\n\t\t\tconst state = this.state;\n\t\t\tstate.lock();\n\t\t\tstate.set(DTableState.HAS_CHILDREN, hasChildren);\n\t\t\tstate.set(DTableState.OPENED, isOpened);\n\t\t\tstate.unlock();\n\t\t\tpadding.adjLeft(this.theme.getLevelPadding(level));\n\t\t\tif (link) {\n\t\t\t\tlink.menu.enable = !hasChildren;\n\t\t\t}\n\t\t} else {\n\t\t\tthis.state.removeAll(DTableState.OPENED, DTableState.HAS_CHILDREN);\n\t\t\tpadding.adjLeft(0);\n\t\t\tif (link) {\n\t\t\t\tlink.menu.enable = false;\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DTableBodyCellTree\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { utils } from \"pixi.js\";\nimport { DTableData } from \"./d-table-data\";\n\nexport const DTableDataSelectionType = {\n\tNONE: 0,\n\tSINGLE: 1,\n\tMULTIPLE: 2\n} as const;\n\nexport type DTableDataSelectionType =\n\ttypeof DTableDataSelectionType[keyof typeof DTableDataSelectionType];\n\nexport interface DTableDataSelectionOptions {\n\ttype?: keyof typeof DTableDataSelectionType | DTableDataSelectionType;\n}\n\nexport interface DTableDataSelection<ROW> extends utils.EventEmitter {\n\t/**\n\t * Returns a copy of an index array of selected rows.\n\t * The order of indices is an insertion order.\n\t */\n\treadonly indices: number[];\n\n\t/**\n\t * Returns a copy of an array of selected row value.\n\t * The order is an insertion order.\n\t */\n\treadonly rows: ROW[];\n\n\treadonly type: DTableDataSelectionType;\n\n\treadonly first: number | null;\n\treadonly last: number | null;\n\n\ttoggle(rowIndex: number): void;\n\tadd(rowIndex: number): void;\n\taddTo(rowIndex: number): void;\n\taddRange(from: number, includeFrom: boolean, to: number, includeTo: boolean): void;\n\taddAll(rowIndices: number[]): void;\n\tcontains(rowIndex: number): boolean;\n\tremove(rowIndex: number): void;\n\tclear(): void;\n\tclearAndAdd(rowIndex: number): void;\n\tclearAndAddAll(rowIndices: number[]): void;\n\tshift(rowIndex: number, amount: number): void;\n\tsize(): number;\n\tisEmpty(): boolean;\n\n\t/**\n\t * Returns an array of the (index, row value) pairs of selected rows.\n\t * The order of pairs is an insertion order.\n\t */\n\ttoArray(): Array<[number, ROW]>;\n\n\t/**\n\t * Returns an sorted array of the (index, row value) pairs of selected rows.\n\t */\n\ttoSortedArray(): Array<[number, ROW]>;\n\n\ttoObject(): Record<number, ROW>;\n\n\ttoMap(): Map<number, ROW>;\n}\n\nexport interface DTableDataSelectionParent<ROW> extends DTableData<ROW> {\n\tupdate(): void;\n}\n\nexport type DTableDataSelectionCreator<NODE> = (\n\tparent: DTableDataSelectionParent<NODE>\n) => DTableDataSelection<NODE>;\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Rectangle } from \"pixi.js\";\nimport { DBase } from \"./d-base\";\nimport {\n\tDLayoutHorizontal,\n\tDLayoutHorizontalOptions,\n\tDThemeLayoutHorizontal\n} from \"./d-layout-horizontal\";\nimport { DTableState } from \"./d-table-state\";\n\nexport interface DTableRowOptions<ROW, COLUMN, THEME extends DThemeTableRow = DThemeTableRow>\n\textends DLayoutHorizontalOptions<THEME> {\n\tcolumns?: COLUMN[];\n\tfrozen?: number;\n}\n\nexport interface DThemeTableRow extends DThemeLayoutHorizontal {}\n\nexport interface DTableRowColumn {\n\tweight?: number;\n\tfrozen?: boolean;\n\toffset: number;\n}\n\nexport abstract class DTableRow<\n\tROW,\n\tCOLUMN extends DTableRowColumn,\n\tTHEME extends DThemeTableRow = DThemeTableRow,\n\tOPTIONS extends DTableRowOptions<ROW, COLUMN, THEME> = DTableRowOptions<ROW, COLUMN, THEME>\n> extends DLayoutHorizontal<THEME, OPTIONS> {\n\tprotected _columns: COLUMN[];\n\tprotected _frozen: number;\n\n\tconstructor(options: OPTIONS) {\n\t\tsuper(options);\n\n\t\tthis._reverse = true;\n\t\tthis._frozen = options.frozen ?? 0;\n\t\tthis._columns = options.columns ?? [];\n\t}\n\n\tprotected initCells(options: OPTIONS, columns: COLUMN[], frozen: number): void {\n\t\tconst iend = this.toIndexEnd(columns);\n\t\tfor (let i = columns.length - 1; 0 <= i; --i) {\n\t\t\tconst cell = this.newCell(i, columns[i], columns, options);\n\t\t\tconst cellState = cell.state;\n\t\t\tcellState.lock(false);\n\t\t\tif (i === 0) {\n\t\t\t\tcellState.add(DTableState.START);\n\t\t\t}\n\t\t\tif (i === iend) {\n\t\t\t\tcellState.add(DTableState.END);\n\t\t\t}\n\t\t\tif (i < frozen) {\n\t\t\t\tcellState.add(DTableState.FROZEN);\n\t\t\t}\n\t\t\tif (i === frozen - 1) {\n\t\t\t\tcellState.add(DTableState.FROZEN_END);\n\t\t\t}\n\t\t\tcellState.unlock();\n\t\t\tthis.addChild(cell);\n\t\t}\n\t}\n\n\tprotected toIndexEnd(columns: COLUMN[]): number {\n\t\tconst imax = columns.length;\n\t\tfor (let i = 0; i < imax; ++i) {\n\t\t\tconst column = columns[i];\n\t\t\tif (column.weight !== undefined) {\n\t\t\t\treturn imax - 1;\n\t\t\t}\n\t\t}\n\t\treturn imax;\n\t}\n\n\tprotected onRefit(): void {\n\t\tsuper.onRefit();\n\t\tthis.resetFrozenCellPosition();\n\t}\n\n\tupdateFrozenCellPosition(x: number): void {\n\t\tconst columns = this._columns;\n\t\tconst cells = this.children;\n\t\tconst cellsLength = cells.length;\n\t\tconst frozen = this._frozen;\n\t\tfor (let i = 0; i < frozen; ++i) {\n\t\t\tconst column = columns[i];\n\t\t\tconst cell = cells[cellsLength - 1 - i];\n\t\t\tcell.position.x = -x + column.offset;\n\t\t}\n\t}\n\n\tprotected resetFrozenCellPosition(): void {\n\t\tconst columns = this._columns;\n\t\tconst cells = this.children;\n\t\tconst cellsLength = cells.length;\n\t\tconst frozen = this._frozen;\n\t\tconst x = this.getContentPositionX();\n\t\tfor (let i = 0; i < frozen; ++i) {\n\t\t\tconst column = columns[i];\n\t\t\tconst cell = cells[cellsLength - 1 - i];\n\t\t\tcolumn.offset = cell.position.x;\n\t\t\tcell.position.x = -x + column.offset;\n\t\t}\n\t}\n\n\tprotected abstract getContentPositionX(): number;\n\n\tgetClippingRect(target: unknown, result: Rectangle): void {\n\t\tsuper.getClippingRect(target, result);\n\n\t\tconst frozen = this._frozen;\n\t\tif (0 < frozen) {\n\t\t\tconst cell = target as any;\n\t\t\tif (cell && cell.parent === this) {\n\t\t\t\tconst cells = this.children as DBase[];\n\t\t\t\tconst cellIndex = cells.indexOf(cell);\n\t\t\t\tif (0 <= cellIndex) {\n\t\t\t\t\tconst columnIndex = cells.length - 1 - cellIndex;\n\t\t\t\t\tif (frozen <= columnIndex) {\n\t\t\t\t\t\tconst previous = cells[cellIndex + 1];\n\t\t\t\t\t\tconst shiftX = previous.position.x + previous.width;\n\t\t\t\t\t\tresult.x += shiftX;\n\t\t\t\t\t\tresult.width -= shiftX;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected abstract newCell(\n\t\tcolumnIndex: number,\n\t\tcolumn: COLUMN,\n\t\tcolumns: COLUMN[],\n\t\toptions: OPTIONS\n\t): DBase;\n\n\tprotected getType(): string {\n\t\treturn \"DTableRow\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBase } from \"./d-base\";\nimport { DBaseStateSet } from \"./d-base-state-set\";\nimport { DTableBodyCell, DTableBodyCellOnChange } from \"./d-table-body-cell\";\nimport { DTableBodyCellActionDialog } from \"./d-table-body-cell-action-dialog\";\nimport { DTableBodyCellActionMenu } from \"./d-table-body-cell-action-menu\";\nimport { DTableBodyCellActionPromise } from \"./d-table-body-cell-action-promise\";\nimport { DTableBodyCellButton } from \"./d-table-body-cell-button\";\nimport { DTableBodyCellCheck } from \"./d-table-body-cell-check\";\nimport { DTableBodyCellColor } from \"./d-table-body-cell-color\";\nimport { DTableBodyCellDate } from \"./d-table-body-cell-date\";\nimport { DTableBodyCellDatetime } from \"./d-table-body-cell-datetime\";\nimport { DTableBodyCellIndex } from \"./d-table-body-cell-index\";\nimport { DTableBodyCellInputInteger } from \"./d-table-body-cell-input-integer\";\nimport { DTableBodyCellInputReal } from \"./d-table-body-cell-input-real\";\nimport { DTableBodyCellInputText } from \"./d-table-body-cell-input-text\";\nimport { DTableBodyCellInputTree } from \"./d-table-body-cell-input-tree\";\nimport { DTableBodyCellLink } from \"./d-table-body-cell-link\";\nimport { DTableBodyCellSelectDialog } from \"./d-table-body-cell-select-dialog\";\nimport { DTableBodyCellSelectMenu } from \"./d-table-body-cell-select-menu\";\nimport { DTableBodyCellSelectMultiple } from \"./d-table-body-cell-select-multiple\";\nimport { DTableBodyCellSelectPromise } from \"./d-table-body-cell-select-promise\";\nimport { DTableBodyCellText } from \"./d-table-body-cell-text\";\nimport { DTableBodyCellTime } from \"./d-table-body-cell-time\";\nimport { DTableBodyCellTree } from \"./d-table-body-cell-tree\";\nimport { DTableBodyCellOptionsUnion, DTableColumn, DTableColumnType } from \"./d-table-column\";\nimport { DTableDataSelectionType } from \"./d-table-data-selection\";\nimport { DTableRow, DTableRowOptions, DThemeTableRow } from \"./d-table-row\";\nimport { DTableState } from \"./d-table-state\";\n\nexport interface DTableBodyRowSelectionOptions {\n\ttype?: DTableDataSelectionType;\n}\n\nexport interface DTableBodyRowOptions<ROW, THEME extends DThemeTableBodyRow = DThemeTableBodyRow>\n\textends DTableRowOptions<ROW, DTableColumn<ROW, unknown>, THEME> {\n\theight?: number;\n\tcell?: DTableBodyCellOptionsUnion<ROW>;\n\tselection?: DTableBodyRowSelectionOptions;\n}\n\nexport interface DThemeTableBodyRow extends DThemeTableRow {}\n\nexport type DTableBodyRowOnChange<ROW, VALUE, EMITTER = any> = (\n\tnewValue: VALUE,\n\toldValue: VALUE,\n\trow: ROW,\n\trowIndex: number,\n\tcolumnIndex: number,\n\temitter: EMITTER\n) => void;\n\nexport class DTableBodyRow<\n\tROW,\n\tTHEME extends DThemeTableBodyRow = DThemeTableBodyRow,\n\tOPTIONS extends DTableBodyRowOptions<ROW, THEME> = DTableBodyRowOptions<ROW, THEME>\n> extends DTableRow<ROW, DTableColumn<ROW, unknown>, THEME, OPTIONS> {\n\tprotected _value?: ROW;\n\tprotected _index: number;\n\tprotected _onCellChangeBound: DTableBodyCellOnChange<ROW, unknown>;\n\n\tconstructor(onChange: DTableBodyRowOnChange<ROW, unknown>, isEven: boolean, options: OPTIONS) {\n\t\tsuper(options);\n\n\t\tthis._index = -1;\n\t\tthis._onCellChangeBound = (newValue, oldValue, row, rowIndex, columnIndex): void => {\n\t\t\tthis.emit(\"change\", newValue, oldValue, row, rowIndex, columnIndex, this);\n\t\t\tonChange(newValue, oldValue, row, rowIndex, columnIndex, this);\n\t\t};\n\t\tthis.state.isAlternated = !isEven;\n\t\tthis.initCells(options, this._columns, this._frozen);\n\t}\n\n\tprotected newCell(\n\t\tcolumnIndex: number,\n\t\tcolumn: DTableColumn<ROW, unknown>,\n\t\tcolumns: Array<DTableColumn<ROW, unknown>>,\n\t\toptions: OPTIONS\n\t): DBase {\n\t\tconst onChange = this._onCellChangeBound;\n\t\tconst cellOptions = this.toCellOptions(columnIndex, column, options);\n\t\tif (column.editing.enable !== false) {\n\t\t\treturn this.newCellEditable(columnIndex, column, onChange, cellOptions);\n\t\t} else {\n\t\t\tconst cell = this.newCellUnediable(columnIndex, column, onChange, cellOptions);\n\t\t\tif (column.type !== DTableColumnType.TREE) {\n\t\t\t\tcell.state.isReadOnly = true;\n\t\t\t}\n\t\t\treturn cell;\n\t\t}\n\t}\n\n\tprotected newCellEditable(\n\t\tcolumnIndex: number,\n\t\tcolumn: DTableColumn<ROW, any>,\n\t\tonChange: DTableBodyCellOnChange<ROW, unknown>,\n\t\toptions: any\n\t): DBase {\n\t\tswitch (column.type) {\n\t\t\tcase DTableColumnType.INDEX:\n\t\t\t\treturn new DTableBodyCellIndex(columnIndex, column, onChange, options);\n\t\t\tcase DTableColumnType.TEXT:\n\t\t\t\treturn new DTableBodyCellInputText(columnIndex, column, onChange, options);\n\t\t\tcase DTableColumnType.TREE:\n\t\t\t\treturn new DTableBodyCellInputTree(columnIndex, column, onChange, options);\n\t\t\tcase DTableColumnType.INTEGER:\n\t\t\t\treturn new DTableBodyCellInputInteger(columnIndex, column, onChange, options);\n\t\t\tcase DTableColumnType.REAL:\n\t\t\t\treturn new DTableBodyCellInputReal(columnIndex, column, onChange, options);\n\t\t\tcase DTableColumnType.CHECK:\n\t\t\tcase DTableColumnType.CHECK_SINGLE:\n\t\t\t\treturn new DTableBodyCellCheck(columnIndex, column, onChange, options);\n\t\t\tcase DTableColumnType.COLOR:\n\t\t\t\treturn new DTableBodyCellColor(columnIndex, column, onChange, options);\n\t\t\tcase DTableColumnType.BUTTON:\n\t\t\t\treturn new DTableBodyCellButton(columnIndex, column, onChange, options);\n\t\t\tcase DTableColumnType.LINK:\n\t\t\t\treturn new DTableBodyCellLink(columnIndex, column, onChange, options);\n\t\t\tcase DTableColumnType.SELECT:\n\t\t\t\treturn this.newCellSelect(columnIndex, column, onChange, options);\n\t\t\tcase DTableColumnType.ACTION:\n\t\t\t\treturn this.newCellAction(columnIndex, column, onChange, options);\n\t\t\tcase DTableColumnType.DATE:\n\t\t\t\treturn new DTableBodyCellDate(columnIndex, column, onChange, options);\n\t\t\tcase DTableColumnType.DATETIME:\n\t\t\t\treturn new DTableBodyCellDatetime(columnIndex, column, onChange, options);\n\t\t\tcase DTableColumnType.TIME:\n\t\t\t\treturn new DTableBodyCellTime(columnIndex, column, onChange, options);\n\t\t\tdefault:\n\t\t\t\treturn new DTableBodyCellText(columnIndex, column, onChange, options);\n\t\t}\n\t}\n\n\tprotected newCellUnediable(\n\t\tcolumnIndex: number,\n\t\tcolumn: DTableColumn<ROW, any>,\n\t\tonChange: DTableBodyCellOnChange<ROW, unknown>,\n\t\toptions: any\n\t): DBase {\n\t\tswitch (column.type) {\n\t\t\tcase DTableColumnType.INDEX:\n\t\t\t\treturn new DTableBodyCellIndex(columnIndex, column, onChange, options);\n\t\t\tcase DTableColumnType.TEXT:\n\t\t\t\treturn new DTableBodyCellText(columnIndex, column, onChange, options);\n\t\t\tcase DTableColumnType.TREE:\n\t\t\t\treturn new DTableBodyCellTree(columnIndex, column, onChange, options);\n\t\t\tcase DTableColumnType.INTEGER:\n\t\t\t\treturn new DTableBodyCellText(columnIndex, column, onChange, options);\n\t\t\tcase DTableColumnType.REAL:\n\t\t\t\treturn new DTableBodyCellText(columnIndex, column, onChange, options);\n\t\t\tcase DTableColumnType.CHECK:\n\t\t\tcase DTableColumnType.CHECK_SINGLE:\n\t\t\t\treturn new DTableBodyCellCheck(columnIndex, column, onChange, options);\n\t\t\tcase DTableColumnType.COLOR:\n\t\t\t\treturn new DTableBodyCellColor(columnIndex, column, onChange, options);\n\t\t\tcase DTableColumnType.BUTTON:\n\t\t\t\treturn new DTableBodyCellButton(columnIndex, column, onChange, options);\n\t\t\tcase DTableColumnType.LINK:\n\t\t\t\treturn new DTableBodyCellLink(columnIndex, column, onChange, options);\n\t\t\tcase DTableColumnType.SELECT:\n\t\t\t\treturn this.newCellSelect(columnIndex, column, onChange, options);\n\t\t\tcase DTableColumnType.ACTION:\n\t\t\t\treturn this.newCellAction(columnIndex, column, onChange, options);\n\t\t\tcase DTableColumnType.DATE:\n\t\t\t\treturn new DTableBodyCellDate(columnIndex, column, onChange, options);\n\t\t\tcase DTableColumnType.DATETIME:\n\t\t\t\treturn new DTableBodyCellDatetime(columnIndex, column, onChange, options);\n\t\t\tcase DTableColumnType.TIME:\n\t\t\t\treturn new DTableBodyCellTime(columnIndex, column, onChange, options);\n\t\t\tdefault:\n\t\t\t\treturn new DTableBodyCellText(columnIndex, column, onChange, options);\n\t\t}\n\t}\n\n\tprotected newCellSelect(\n\t\tcolumnIndex: number,\n\t\tcolumn: DTableColumn<ROW, any>,\n\t\tonChange: DTableBodyCellOnChange<ROW, unknown>,\n\t\toptions: any\n\t): DBase {\n\t\tconst selecting = column.selecting;\n\t\tif (selecting.menu != null) {\n\t\t\treturn new DTableBodyCellSelectMenu(columnIndex, column, onChange, options);\n\t\t} else if (selecting.multiple != null) {\n\t\t\treturn new DTableBodyCellSelectMultiple(columnIndex, column, onChange, options);\n\t\t} else if (selecting.dialog != null) {\n\t\t\treturn new DTableBodyCellSelectDialog(columnIndex, column, onChange, options);\n\t\t} else if (selecting.promise != null) {\n\t\t\treturn new DTableBodyCellSelectPromise(columnIndex, column, onChange, options);\n\t\t} else {\n\t\t\treturn new DTableBodyCellText(columnIndex, column, onChange, options);\n\t\t}\n\t}\n\n\tprotected newCellAction(\n\t\tcolumnIndex: number,\n\t\tcolumn: DTableColumn<ROW, any>,\n\t\tonChange: DTableBodyCellOnChange<ROW, unknown>,\n\t\toptions: any\n\t): DBase {\n\t\tconst selecting = column.selecting;\n\t\tif (selecting.menu != null) {\n\t\t\treturn new DTableBodyCellActionMenu(columnIndex, column, onChange, options);\n\t\t} else if (selecting.dialog != null) {\n\t\t\treturn new DTableBodyCellActionDialog(columnIndex, column, onChange, options);\n\t\t} else if (selecting.promise != null) {\n\t\t\treturn new DTableBodyCellActionPromise(columnIndex, column, onChange, options);\n\t\t} else {\n\t\t\treturn new DTableBodyCellText(columnIndex, column, onChange, options);\n\t\t}\n\t}\n\n\tprotected toCellOptions(\n\t\tcolumnIndex: number,\n\t\tcolumn: DTableColumn<ROW, unknown>,\n\t\toptions: OPTIONS\n\t): DTableBodyCellOptionsUnion<ROW> {\n\t\tlet result: any = column.body || options.cell;\n\t\tconst columnWeight = column.weight;\n\t\tconst columnWidth = column.width;\n\t\tconst columnFormatter = column.formatter;\n\t\tconst columnAlign = column.align;\n\t\tconst columnSelecting = column.selecting;\n\t\tconst columnSelectingMenu = columnSelecting.menu || columnSelecting.multiple;\n\t\tif (result != null) {\n\t\t\tresult.weight = columnWeight;\n\t\t\tresult.width = columnWidth;\n\n\t\t\tconst text = result.text || {};\n\t\t\tresult.text = text;\n\t\t\ttext.formatter ||= columnFormatter;\n\n\t\t\tconst textAlign = text.align || {};\n\t\t\ttext.align = textAlign;\n\t\t\ttextAlign.horizontal = columnAlign;\n\n\t\t\tresult.menu ||= columnSelectingMenu;\n\t\t} else {\n\t\t\tresult = {\n\t\t\t\tweight: columnWeight,\n\t\t\t\twidth: columnWidth,\n\t\t\t\ttext: {\n\t\t\t\t\tformatter: columnFormatter,\n\t\t\t\t\talign: {\n\t\t\t\t\t\thorizontal: columnAlign\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tmenu: columnSelectingMenu\n\t\t\t};\n\t\t}\n\n\t\tconst columnEditing = column.editing;\n\t\tif (columnEditing.enable !== false) {\n\t\t\tconst editing = result.editing || {};\n\t\t\tresult.editing = editing;\n\t\t\tediting.formatter ||= columnEditing.formatter;\n\t\t\tediting.unformatter ||= columnEditing.unformatter;\n\t\t\tediting.validator ||= columnEditing.validator;\n\t\t}\n\n\t\tconst columnLink = column.link;\n\t\tif (columnLink) {\n\t\t\tresult.link = columnLink;\n\t\t}\n\n\t\tconst selectionType = options?.selection?.type ?? DTableDataSelectionType.NONE;\n\t\tif (selectionType !== DTableDataSelectionType.NONE) {\n\t\t\tresult.when = \"DOUBLE_CLICKED\";\n\t\t\tresult.cursor = (state: DBaseStateSet): string | undefined => {\n\t\t\t\tif (state.in(DTableState.SELECTABLE)) {\n\t\t\t\t\treturn \"pointer\";\n\t\t\t\t}\n\t\t\t\treturn undefined;\n\t\t\t};\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DTableBodyRow\";\n\t}\n\n\t/**\n\t * Returns a row data if exists.\n\t * Returns undefined if a row data does not exit.\n\t *\n\t * @returns a row data or undefined.\n\t */\n\tget value(): ROW | undefined {\n\t\treturn this._value;\n\t}\n\n\t/**\n\t * Returns a row index if a row data exists.\n\t * Returns -1 if a row data does not exit.\n\t *\n\t * @returns a row index or -1.\n\t */\n\tget index(): number {\n\t\treturn this._index;\n\t}\n\n\tprotected isCell(target: any): target is DTableBodyCell<unknown, unknown> {\n\t\treturn target != null && \"set\" in target;\n\t}\n\n\tset(value: ROW, supplimental: unknown, rowIndex: number, forcibly?: boolean): void {\n\t\tif (forcibly || this._value !== value || this._index !== rowIndex) {\n\t\t\tthis._value = value;\n\t\t\tthis._index = rowIndex;\n\n\t\t\tconst cells = this.children;\n\t\t\tconst cellsLength = cells.length;\n\t\t\tconst columns = this._columns;\n\t\t\tconst columnsLength = columns.length;\n\t\t\tfor (let i = 0; i < cellsLength; ++i) {\n\t\t\t\tconst cell = cells[i];\n\t\t\t\tconst columnIndex = columnsLength - 1 - i;\n\t\t\t\tconst column = columns[columnIndex];\n\t\t\t\tif (this.isCell(cell)) {\n\t\t\t\t\tcell.set(\n\t\t\t\t\t\tcolumn.getter(value, columnIndex),\n\t\t\t\t\t\tvalue,\n\t\t\t\t\t\tsupplimental,\n\t\t\t\t\t\trowIndex,\n\t\t\t\t\t\tcolumnIndex,\n\t\t\t\t\t\tforcibly\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.onSet(value, rowIndex);\n\t\t}\n\t}\n\n\tprotected onSet(value: ROW, rowIndex: number): void {\n\t\tthis.emit(\"set\", value, rowIndex, this);\n\t}\n\n\tunset(): void {\n\t\tif (this._value !== undefined) {\n\t\t\tthis._value = undefined;\n\t\t\tthis._index = -1;\n\n\t\t\tconst cells = this.children;\n\t\t\tconst cellsLength = cells.length;\n\t\t\tfor (let i = 0; i < cellsLength; ++i) {\n\t\t\t\tconst cell = cells[i];\n\t\t\t\tif (this.isCell(cell)) {\n\t\t\t\t\tcell.unset();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.onUnset();\n\t\t}\n\t}\n\n\tprotected onUnset(): void {\n\t\tthis.emit(\"unset\", this);\n\t}\n\n\tprotected getContentPositionX(): number {\n\t\tconst parent = this.parent;\n\t\tif (parent) {\n\t\t\tconst content = parent.parent;\n\t\t\tif (content) {\n\t\t\t\treturn content.position.x;\n\t\t\t}\n\t\t}\n\t\treturn 0;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { utils } from \"pixi.js\";\nimport { DTableDataFilter, DTableDataFilterer } from \"./d-table-data-filter\";\nimport { DTableDataSorter } from \"./d-table-data-sorter\";\nimport { isFunction } from \"./util/is-function\";\n\nexport interface DTableDataListFilterParent<ROW> {\n\treadonly sorter: DTableDataSorter<ROW>;\n\treadonly rows: ROW[];\n\tupdate(): void;\n}\n\nexport class DTableDataListFilter<ROW> extends utils.EventEmitter implements DTableDataFilter<ROW> {\n\tprotected _id: number;\n\tprotected _idUpdated: number;\n\tprotected _isApplied: boolean;\n\tprotected _sorterId: number;\n\tprotected _parent: DTableDataListFilterParent<ROW>;\n\tprotected _filter: DTableDataFilterer<ROW> | null;\n\tprotected _filtered: number[] | null;\n\n\tconstructor(parent: DTableDataListFilterParent<ROW>) {\n\t\tsuper();\n\n\t\tthis._id = 0;\n\t\tthis._idUpdated = -1;\n\t\tthis._isApplied = false;\n\t\tthis._sorterId = -1;\n\n\t\tthis._parent = parent;\n\t\tthis._filter = null;\n\t\tthis._filtered = null;\n\t}\n\n\tget id(): number {\n\t\treturn this._id;\n\t}\n\n\tapply(): void {\n\t\tthis._isApplied = true;\n\t\tthis._id += 1;\n\t\tthis._parent.update();\n\t}\n\n\tunapply(): void {\n\t\tif (this._isApplied) {\n\t\t\tthis._isApplied = false;\n\t\t\tthis._id += 1;\n\t\t\tthis._parent.update();\n\t\t}\n\t}\n\n\tisApplied(): boolean {\n\t\treturn this._isApplied;\n\t}\n\n\tprotected newFiltered(): number[] | null {\n\t\tconst filter = this._filter;\n\t\tif (filter != null) {\n\t\t\tconst filtered: number[] = [];\n\t\t\tconst parent = this._parent;\n\t\t\tconst sorter = parent.sorter;\n\t\t\tconst rows = parent.rows;\n\t\t\tif (isFunction(filter)) {\n\t\t\t\tconst indicesSorted = sorter.indices;\n\t\t\t\tif (indicesSorted) {\n\t\t\t\t\tfor (let i = 0, imax = indicesSorted.length; i < imax; ++i) {\n\t\t\t\t\t\tconst indexSorted = indicesSorted[i];\n\t\t\t\t\t\tif (filter(rows[indexSorted], indexSorted)) {\n\t\t\t\t\t\t\tfiltered.push(i);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tfor (let i = 0, imax = rows.length; i < imax; ++i) {\n\t\t\t\t\t\tif (filter(rows[i], i)) {\n\t\t\t\t\t\t\tfiltered.push(i);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst indicesSorted = sorter.indices;\n\t\t\t\tif (indicesSorted) {\n\t\t\t\t\tfor (let i = 0, imax = indicesSorted.length; i < imax; ++i) {\n\t\t\t\t\t\tconst indexSorted = indicesSorted[i];\n\t\t\t\t\t\tif (filter.test(rows[indexSorted], indexSorted)) {\n\t\t\t\t\t\t\tfiltered.push(i);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tfor (let i = 0, imax = rows.length; i < imax; ++i) {\n\t\t\t\t\t\tif (filter.test(rows[i], i)) {\n\t\t\t\t\t\t\tfiltered.push(i);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn filtered;\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tget(): DTableDataFilterer<ROW> | null {\n\t\treturn this._filter;\n\t}\n\n\tset(filter: DTableDataFilterer<ROW> | null): void {\n\t\tif (this._filter !== filter) {\n\t\t\tthis._filter = filter;\n\t\t}\n\t}\n\n\ttoDirty(): void {\n\t\tthis._id += 1;\n\t}\n\n\tupdate(): void {\n\t\tif (this._id !== this._idUpdated || this._parent.sorter.id !== this._sorterId) {\n\t\t\tthis._idUpdated = this._id;\n\t\t\tthis._sorterId = this._parent.sorter.id;\n\t\t\tif (this._isApplied) {\n\t\t\t\tthis._filtered = this.newFiltered();\n\t\t\t\tthis.emit(\"change\", this);\n\t\t\t} else if (this._filtered != null) {\n\t\t\t\tthis._filtered = null;\n\t\t\t\tthis.emit(\"change\", this);\n\t\t\t}\n\t\t}\n\t}\n\n\tget indices(): number[] | null {\n\t\tthis.update();\n\t\treturn this._filtered;\n\t}\n\n\tmap(sortedIndex: number): number | null {\n\t\tlet result = sortedIndex;\n\n\t\tconst indicesFiltered = this.indices;\n\t\tif (indicesFiltered) {\n\t\t\tconst index = indicesFiltered.indexOf(result);\n\t\t\tif (0 <= index) {\n\t\t\t\tresult = index;\n\t\t\t} else {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tunmap(index: number): number {\n\t\tlet result = index;\n\n\t\tconst indicesFiltered = this.indices;\n\t\tif (indicesFiltered) {\n\t\t\tresult = indicesFiltered[result];\n\t\t}\n\n\t\treturn result;\n\t}\n}\n","import { DTableData, DTableDataMapped, DTableDataMappedEachIteratee } from \"./d-table-data\";\n\nexport interface DTableDataListMappedParent<ROW> extends DTableData<ROW> {\n\treadonly rows: ROW[];\n\treadonly supplimentals?: unknown[];\n}\n\nexport class DTableDataListMapped<ROW> implements DTableDataMapped<ROW> {\n\tprotected _parent: DTableDataListMappedParent<ROW>;\n\n\tconstructor(parent: DTableDataListMappedParent<ROW>) {\n\t\tthis._parent = parent;\n\t}\n\n\tmap(unmappedIndex: number): number | null {\n\t\tconst parent = this._parent;\n\t\tconst sortedIndex = parent.sorter.map(unmappedIndex);\n\t\tif (sortedIndex != null) {\n\t\t\treturn parent.filter.map(sortedIndex);\n\t\t}\n\t\treturn null;\n\t}\n\n\tunmap(index: number): number {\n\t\tconst parent = this._parent;\n\t\treturn parent.sorter.unmap(parent.filter.unmap(index));\n\t}\n\n\tsize(): number {\n\t\tconst parent = this._parent;\n\t\tconst indicesFiltered = parent.filter.indices;\n\t\treturn indicesFiltered != null ? indicesFiltered.length : parent.size();\n\t}\n\n\tget(index: number): ROW | null {\n\t\tconst parent = this._parent;\n\t\treturn parent.get(this.unmap(index));\n\t}\n\n\teach(iteratee: DTableDataMappedEachIteratee<ROW>, ifrom?: number, ito?: number): void {\n\t\tconst parent = this._parent;\n\t\tconst rows = parent.rows;\n\t\tconst supplimentals = parent.supplimentals;\n\t\tconst indicesFiltered = parent.filter.indices;\n\t\tconst indicesSorted = parent.sorter.indices;\n\t\tifrom = ifrom != null ? Math.max(0, ifrom) : 0;\n\t\tif (indicesFiltered) {\n\t\t\tconst size = indicesFiltered.length;\n\t\t\tito = ito != null ? Math.min(size, ito) : size;\n\t\t\tif (indicesSorted) {\n\t\t\t\tfor (let i = ifrom; i < ito; ++i) {\n\t\t\t\t\tconst unmappedIndex = indicesSorted[indicesFiltered[i]];\n\t\t\t\t\tconst row = rows[unmappedIndex];\n\t\t\t\t\tconst supplimental = supplimentals ? supplimentals[unmappedIndex] : null;\n\t\t\t\t\tif (iteratee(row, supplimental, i, unmappedIndex) === false) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (let i = ifrom; i < ito; ++i) {\n\t\t\t\t\tconst unmappedIndex = indicesFiltered[i];\n\t\t\t\t\tconst row = rows[unmappedIndex];\n\t\t\t\t\tconst supplimental = supplimentals ? supplimentals[unmappedIndex] : null;\n\t\t\t\t\tif (iteratee(row, supplimental, i, unmappedIndex) === false) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tconst size = rows.length;\n\t\t\tito = ito != null ? Math.min(size, ito) : size;\n\t\t\tif (indicesSorted) {\n\t\t\t\tfor (let i = ifrom; i < ito; ++i) {\n\t\t\t\t\tconst unmappedIndex = indicesSorted[i];\n\t\t\t\t\tconst row = rows[unmappedIndex];\n\t\t\t\t\tconst supplimental = supplimentals ? supplimentals[unmappedIndex] : null;\n\t\t\t\t\tif (iteratee(row, supplimental, i, unmappedIndex) === false) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (let i = ifrom; i < ito; ++i) {\n\t\t\t\t\tconst row = rows[i];\n\t\t\t\t\tconst supplimental = supplimentals ? supplimentals[i] : null;\n\t\t\t\t\tif (iteratee(row, supplimental, i, i) === false) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { utils } from \"pixi.js\";\nimport {\n\tDTableDataSelection,\n\tDTableDataSelectionOptions,\n\tDTableDataSelectionParent,\n\tDTableDataSelectionType\n} from \"./d-table-data-selection\";\nimport { toEnum } from \"./util/to-enum\";\n\nconst COMPARATOR = (a: [number, unknown], b: [number, unknown]): number => {\n\treturn a[0] - b[0];\n};\n\nexport class DTableDataListSelection<ROW>\n\textends utils.EventEmitter\n\timplements DTableDataSelection<ROW>\n{\n\tprotected _parent: DTableDataSelectionParent<ROW>;\n\tprotected _type: DTableDataSelectionType;\n\tprotected _indices: Set<number>;\n\n\tconstructor(parent: DTableDataSelectionParent<ROW>, options?: DTableDataSelectionOptions) {\n\t\tsuper();\n\n\t\tthis._parent = parent;\n\t\tthis._type = toEnum(options?.type ?? DTableDataSelectionType.NONE, DTableDataSelectionType);\n\t\tthis._indices = new Set<number>();\n\t}\n\n\tget type(): DTableDataSelectionType {\n\t\treturn this._type;\n\t}\n\n\tprotected onChange(): void {\n\t\tthis._parent.update();\n\t\tthis.emit(\"change\", this);\n\t}\n\n\ttoggle(rowIndex: number): void {\n\t\tconst indices = this._indices;\n\t\tif (indices.has(rowIndex)) {\n\t\t\tindices.delete(rowIndex);\n\t\t} else {\n\t\t\tindices.add(rowIndex);\n\t\t}\n\t\tthis.onChange();\n\t}\n\n\tadd(rowIndex: number): void {\n\t\tconst indices = this._indices;\n\t\tconst oldSize = indices.size;\n\t\tindices.add(rowIndex);\n\t\tconst newSize = indices.size;\n\t\tif (oldSize !== newSize) {\n\t\t\tthis.onChange();\n\t\t}\n\t}\n\n\tget first(): number | null {\n\t\tconst indices = this._indices;\n\t\tif (0 < indices.size) {\n\t\t\tlet result: number = NaN;\n\t\t\tindices.forEach((index: number): void => {\n\t\t\t\tif (result !== result) {\n\t\t\t\t\tresult = index;\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn result;\n\t\t}\n\t\treturn null;\n\t}\n\n\tget last(): number | null {\n\t\tconst indices = this._indices;\n\t\tif (0 < indices.size) {\n\t\t\tlet result: number = 0;\n\t\t\tindices.forEach((index: number): void => {\n\t\t\t\tresult = index;\n\t\t\t});\n\t\t\treturn result;\n\t\t}\n\t\treturn null;\n\t}\n\n\taddTo(rowIndex: number): void {\n\t\tconst lastRowIndex = this.last;\n\t\tif (lastRowIndex != null) {\n\t\t\tthis.addRange(lastRowIndex, false, rowIndex, true);\n\t\t}\n\t}\n\n\taddRange(from: number, includeFrom: boolean, to: number, includeTo: boolean): void {\n\t\tconst indices = this._indices;\n\t\tconst oldSize = indices.size;\n\t\tif (from < to) {\n\t\t\tconst ifrom = from + (includeFrom ? 0 : 1);\n\t\t\tconst ito = to + (includeTo ? 1 : 0);\n\t\t\tfor (let i = ifrom; i < ito; ++i) {\n\t\t\t\tindices.add(i);\n\t\t\t}\n\t\t} else {\n\t\t\tconst ifrom = to + (includeTo ? 0 : 1);\n\t\t\tconst ito = from + (includeFrom ? 1 : 0);\n\t\t\tfor (let i = ifrom; i < ito; ++i) {\n\t\t\t\tindices.add(i);\n\t\t\t}\n\t\t}\n\t\tconst newSize = indices.size;\n\t\tif (oldSize !== newSize) {\n\t\t\tthis.onChange();\n\t\t}\n\t}\n\n\taddAll(rowIndices: number[]): void {\n\t\tconst indices = this._indices;\n\t\tconst oldSize = indices.size;\n\t\tfor (let i = 0, imax = rowIndices.length; i < imax; ++i) {\n\t\t\tindices.add(rowIndices[i]);\n\t\t}\n\t\tconst newSize = indices.size;\n\t\tif (oldSize !== newSize) {\n\t\t\tthis.onChange();\n\t\t}\n\t}\n\n\tcontains(rowIndex: number): boolean {\n\t\treturn this._indices.has(rowIndex);\n\t}\n\n\tremove(rowIndex: number): void {\n\t\tif (this._indices.delete(rowIndex)) {\n\t\t\tthis.onChange();\n\t\t}\n\t}\n\n\tclear(): void {\n\t\tconst indices = this._indices;\n\t\tif (0 < indices.size) {\n\t\t\tindices.clear();\n\t\t\tthis.onChange();\n\t\t}\n\t}\n\n\tclearAndAdd(rowIndex: number): void {\n\t\tconst indices = this._indices;\n\t\tif (!indices.has(rowIndex) || indices.size !== 1) {\n\t\t\tindices.clear();\n\t\t\tindices.add(rowIndex);\n\t\t\tthis.onChange();\n\t\t}\n\t}\n\n\tclearAndAddAll(rowIndices: number[]): void {\n\t\tconst indices = this._indices;\n\t\tif (0 < indices.size || 0 < rowIndices.length) {\n\t\t\tindices.clear();\n\t\t\tfor (let i = 0, imax = rowIndices.length; i < imax; ++i) {\n\t\t\t\tindices.add(rowIndices[i]);\n\t\t\t}\n\t\t\tthis.onChange();\n\t\t}\n\t}\n\n\tshift(rowIndex: number, amount: number): void {\n\t\tconst shifted: number[] = [];\n\t\tconst indices = this._indices;\n\t\tindices.forEach((index: number): void => {\n\t\t\tif (rowIndex <= index) {\n\t\t\t\tshifted.push(index);\n\t\t\t}\n\t\t});\n\t\tconst shiftedLength = shifted.length;\n\t\tif (0 < shiftedLength) {\n\t\t\tfor (let i = 0, imax = shifted.length; i < imax; ++i) {\n\t\t\t\tindices.delete(shifted[i]);\n\t\t\t}\n\t\t\tfor (let i = 0, imax = shifted.length; i < imax; ++i) {\n\t\t\t\tindices.add(shifted[i] + amount);\n\t\t\t}\n\t\t\tthis.onChange();\n\t\t}\n\t}\n\n\tsize(): number {\n\t\treturn this._indices.size;\n\t}\n\n\tisEmpty(): boolean {\n\t\treturn this._indices.size === 0;\n\t}\n\n\t/**\n\t * Returns a copy of an index array of selected rows.\n\t * The order of indices is an insertion order.\n\t */\n\tget indices(): number[] {\n\t\tconst result: number[] = [];\n\t\tthis._indices.forEach((index: number): void => {\n\t\t\tresult.push(index);\n\t\t});\n\t\treturn result;\n\t}\n\n\t/**\n\t * Returns a copy of an array of selected row value.\n\t * The order is an insertion order.\n\t */\n\tget rows(): ROW[] {\n\t\tconst result: ROW[] = [];\n\t\tconst parent = this._parent;\n\t\tthis._indices.forEach((index: number): void => {\n\t\t\tresult.push(parent.get(index)!);\n\t\t});\n\t\treturn result;\n\t}\n\n\t/**\n\t * Returns an array of the (index, row value) pairs of selected rows.\n\t * The order of pairs is an insertion order.\n\t */\n\ttoArray(): Array<[number, ROW]> {\n\t\tconst result: Array<[number, ROW]> = [];\n\t\tconst parent = this._parent;\n\t\tthis._indices.forEach((index: number): void => {\n\t\t\tresult.push([index, parent.get(index)!]);\n\t\t});\n\t\treturn result;\n\t}\n\n\t/**\n\t * Returns an sorted array of the (index, row value) pairs of selected rows.\n\t */\n\ttoSortedArray(): Array<[number, ROW]> {\n\t\treturn this.toArray().sort(COMPARATOR);\n\t}\n\n\ttoObject(): Record<number, ROW> {\n\t\tconst result: Record<number, ROW> = {};\n\t\tconst parent = this._parent;\n\t\tthis._indices.forEach((index: number): void => {\n\t\t\tresult[index] = parent.get(index)!;\n\t\t});\n\t\treturn result;\n\t}\n\n\ttoMap(): Map<number, ROW> {\n\t\tconst result: Map<number, ROW> = new Map<number, ROW>();\n\t\tconst parent = this._parent;\n\t\tthis._indices.forEach((index: number): void => {\n\t\t\tresult.set(index, parent.get(index)!);\n\t\t});\n\t\treturn result;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { utils } from \"pixi.js\";\n\n/**\n * A row comparator function.\n */\nexport type DTableDataComparatorFunction<ROW> = (\n\trowA: ROW,\n\trowB: ROW,\n\tindexA: number,\n\tindexB: number\n) => number;\n\n/**\n * A row comparator object.\n */\nexport interface DTableDataComparatorObject<ROW> {\n\tcompare(rowA: ROW, rowB: ROW, indexA: number, indexB: number): number;\n}\n\n/**\n * A row comparator.\n */\nexport type DTableDataComparator<ROW> =\n\t| DTableDataComparatorFunction<ROW>\n\t| DTableDataComparatorObject<ROW>;\n\n/**\n * A sort order.\n */\nexport const DTableDataOrder = {\n\tASCENDING: 0,\n\tDESCENDING: 1\n} as const;\n\nexport type DTableDataOrder = typeof DTableDataOrder[keyof typeof DTableDataOrder];\n\n/**\n * Table data sorter.\n */\nexport interface DTableDataSorter<ROW> extends utils.EventEmitter {\n\treadonly id: number;\n\n\t/**\n\t * An indices of sorted rows.\n\t * Must not change this indices directly.\n\t */\n\treadonly indices: number[] | null;\n\n\t/**\n\t * A sort order.\n\t */\n\torder: DTableDataOrder;\n\n\t/**\n\t * Applys a sorting.\n\t */\n\tapply(): void;\n\n\t/**\n\t * Unapplys a sorting.\n\t */\n\tunapply(): void;\n\n\t/**\n\t * Returns true if a sorting is applied.\n\t */\n\tisApplied(): boolean;\n\n\t/**\n\t * Returns a current comparator.\n\t */\n\tget(): DTableDataComparator<ROW> | null;\n\n\t/**\n\t * Sets to the given comparator.\n\t *\n\t * @param comparator A comparator\n\t */\n\tset(comparator: DTableDataComparator<ROW> | null): void;\n\n\t/**\n\t * Returns a sorted index of the specified unmapped index.\n\t *\n\t * @param unmappedIndex an unmapped index\n\t */\n\tmap(unmappedIndex: number): number | null;\n\n\t/**\n\t * Returns an unmapped index of the specified sorted index.\n\t *\n\t * @param index a mapped index\n\t */\n\tunmap(index: number): number;\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { utils } from \"pixi.js\";\nimport { DTableDataComparator, DTableDataOrder, DTableDataSorter } from \"./d-table-data-sorter\";\nimport { isFunction } from \"./util/is-function\";\n\nexport interface DTableDataListSorterParent<ROW> {\n\treadonly rows: ROW[];\n\tupdate(): void;\n}\n\nexport class DTableDataListSorter<ROW> extends utils.EventEmitter implements DTableDataSorter<ROW> {\n\tprotected _id: number;\n\tprotected _idUpdated: number;\n\tprotected _isApplied: boolean;\n\tprotected _parent: DTableDataListSorterParent<ROW>;\n\tprotected _comparator: DTableDataComparator<ROW> | null;\n\tprotected _sorted: number[] | null;\n\tprotected _order: DTableDataOrder;\n\n\tconstructor(parent: DTableDataListSorterParent<ROW>) {\n\t\tsuper();\n\n\t\tthis._id = 0;\n\t\tthis._idUpdated = -1;\n\t\tthis._isApplied = false;\n\t\tthis._parent = parent;\n\t\tthis._comparator = null;\n\t\tthis._sorted = null;\n\t\tthis._order = DTableDataOrder.ASCENDING;\n\t}\n\n\tget id(): number {\n\t\treturn this._id;\n\t}\n\n\tget order(): DTableDataOrder {\n\t\treturn this._order;\n\t}\n\n\tset order(order: DTableDataOrder) {\n\t\tthis._order = order;\n\t}\n\n\tapply(): void {\n\t\tthis._isApplied = true;\n\t\tthis._id += 1;\n\t\tthis._parent.update();\n\t}\n\n\tunapply(): void {\n\t\tif (this._isApplied) {\n\t\t\tthis._isApplied = false;\n\t\t\tthis._id += 1;\n\t\t\tthis._parent.update();\n\t\t}\n\t}\n\n\tisApplied(): boolean {\n\t\treturn this._isApplied;\n\t}\n\n\tprotected newSorted(): number[] | null {\n\t\tconst comparator = this._comparator;\n\t\tif (comparator != null) {\n\t\t\tconst parent = this._parent;\n\t\t\tconst sorted: number[] = [];\n\t\t\tconst rows: ROW[] = parent.rows;\n\t\t\tfor (let i = 0, imax = rows.length; i < imax; ++i) {\n\t\t\t\tsorted.push(i);\n\t\t\t}\n\t\t\tsorted.sort(this.toComparator(rows, comparator));\n\t\t\treturn sorted;\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tprotected toComparator(\n\t\trows: ROW[],\n\t\tcomparator: DTableDataComparator<ROW>\n\t): (indexA: number, indexB: number) => number {\n\t\tconst order = this._order;\n\t\tif (isFunction(comparator)) {\n\t\t\tif (order === DTableDataOrder.ASCENDING) {\n\t\t\t\treturn (indexA: number, indexB: number): number => {\n\t\t\t\t\treturn comparator(rows[indexA], rows[indexB], indexA, indexB);\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\treturn (indexA: number, indexB: number): number => {\n\t\t\t\t\treturn comparator(rows[indexB], rows[indexA], indexB, indexA);\n\t\t\t\t};\n\t\t\t}\n\t\t} else {\n\t\t\tif (order === DTableDataOrder.ASCENDING) {\n\t\t\t\treturn (indexA: number, indexB: number): number => {\n\t\t\t\t\treturn comparator.compare(rows[indexA], rows[indexB], indexA, indexB);\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\treturn (indexA: number, indexB: number): number => {\n\t\t\t\t\treturn comparator.compare(rows[indexB], rows[indexA], indexB, indexA);\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t}\n\n\tget(): DTableDataComparator<ROW> | null {\n\t\treturn this._comparator;\n\t}\n\n\tset(comparator: DTableDataComparator<ROW> | null): void {\n\t\tif (this._comparator !== comparator) {\n\t\t\tthis._comparator = comparator;\n\t\t}\n\t}\n\n\ttoDirty(): void {\n\t\tthis._id += 1;\n\t}\n\n\tupdate(): void {\n\t\tif (this._id !== this._idUpdated) {\n\t\t\tthis._idUpdated = this._id;\n\t\t\tif (this._isApplied) {\n\t\t\t\tthis._sorted = this.newSorted();\n\t\t\t\tthis.emit(\"change\", this);\n\t\t\t} else if (this._sorted != null) {\n\t\t\t\tthis._sorted = null;\n\t\t\t\tthis.emit(\"change\", this);\n\t\t\t}\n\t\t}\n\t}\n\n\tget indices(): number[] | null {\n\t\tthis.update();\n\t\treturn this._sorted;\n\t}\n\n\tmap(unmappedIndex: number): number | null {\n\t\tlet result = unmappedIndex;\n\n\t\tconst indicesSorted = this.indices;\n\t\tif (indicesSorted) {\n\t\t\tconst index = indicesSorted.indexOf(result);\n\t\t\tif (0 <= index) {\n\t\t\t\tresult = index;\n\t\t\t} else {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tunmap(index: number): number {\n\t\tlet result = index;\n\n\t\tconst indicesSorted = this.indices;\n\t\tif (indicesSorted) {\n\t\t\tresult = indicesSorted[result];\n\t\t}\n\n\t\treturn result;\n\t}\n}\n","import { utils } from \"pixi.js\";\nimport { DTableData, DTableDataMapped, DTableDataOptions, DTableDataParent } from \"./d-table-data\";\nimport { DTableDataFilter } from \"./d-table-data-filter\";\nimport { DTableDataListFilter } from \"./d-table-data-list-filter\";\nimport { DTableDataListMapped } from \"./d-table-data-list-mapped\";\nimport {\n\tDTableDataSelection,\n\tDTableDataSelectionCreator,\n\tDTableDataSelectionOptions\n} from \"./d-table-data-selection\";\nimport { DTableDataListSelection } from \"./d-table-data-list-selection\";\nimport { DTableDataSorter } from \"./d-table-data-sorter\";\nimport { DTableDataListSorter } from \"./d-table-data-list-sorter\";\nimport { isFunction } from \"./util/is-function\";\n\nexport interface DTableDataListOptions<ROW> extends DTableDataOptions<ROW> {\n\trows?: ROW[];\n}\n\nexport class DTableDataList<ROW> extends utils.EventEmitter implements DTableData<ROW> {\n\tprotected _parent: DTableDataParent | null;\n\tprotected _rows: ROW[];\n\tprotected _filter: DTableDataListFilter<ROW>;\n\tprotected _sorter: DTableDataListSorter<ROW>;\n\tprotected _selection: DTableDataSelection<ROW>;\n\tprotected _mapped: DTableDataMapped<ROW>;\n\n\tconstructor(options?: DTableDataListOptions<ROW>) {\n\t\tsuper();\n\n\t\tthis._parent = null;\n\t\tthis._rows = this.toRows(options?.rows);\n\t\tthis._mapped = new DTableDataListMapped<ROW>(this);\n\t\tthis._selection = this.toSelection(options?.selection);\n\t\tthis._filter = new DTableDataListFilter<ROW>(this);\n\t\tthis._sorter = new DTableDataListSorter<ROW>(this);\n\t\tif (options) {\n\t\t\t// Filter\n\t\t\tconst filter = options.filter;\n\t\t\tif (filter) {\n\t\t\t\tthis._filter.set(filter);\n\t\t\t}\n\n\t\t\t// Comparator\n\t\t\tconst comparator = options.comparator;\n\t\t\tif (comparator) {\n\t\t\t\tthis._sorter.set(comparator);\n\t\t\t}\n\n\t\t\t// Events\n\t\t\tconst on = options.on;\n\t\t\tif (on) {\n\t\t\t\tfor (const name in on) {\n\t\t\t\t\tconst handler = on[name];\n\t\t\t\t\tif (handler) {\n\t\t\t\t\t\tthis.on(name, handler);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected toSelection(\n\t\toptions?:\n\t\t\t| DTableDataSelection<ROW>\n\t\t\t| DTableDataSelectionCreator<ROW>\n\t\t\t| DTableDataSelectionOptions\n\t): DTableDataSelection<ROW> {\n\t\tif (options instanceof utils.EventEmitter) {\n\t\t\treturn options;\n\t\t} else if (isFunction(options)) {\n\t\t\treturn options(this);\n\t\t}\n\t\treturn this.newSelection(options);\n\t}\n\n\tprotected newSelection(options?: DTableDataSelectionOptions): DTableDataSelection<ROW> {\n\t\treturn new DTableDataListSelection(this, options);\n\t}\n\n\tbind(parent: DTableDataParent): void {\n\t\tthis._parent = parent;\n\t}\n\n\tprotected toRows(row?: ROW[]): ROW[] {\n\t\tconst result: ROW[] = [];\n\t\tif (row != null) {\n\t\t\tfor (let i = 0, imax = row.length; i < imax; ++i) {\n\t\t\t\tresult.push(row[i]);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tget rows(): ROW[] {\n\t\treturn this._rows;\n\t}\n\n\tupdate(): void {\n\t\tconst parent = this._parent;\n\t\tif (parent) {\n\t\t\tparent.update();\n\t\t}\n\t}\n\n\tlock(): void {\n\t\tconst parent = this._parent;\n\t\tif (parent) {\n\t\t\tparent.lock();\n\t\t}\n\t}\n\n\tunlock(): void {\n\t\tconst parent = this._parent;\n\t\tif (parent) {\n\t\t\tparent.unlock(false);\n\t\t\tparent.update();\n\t\t}\n\t}\n\n\tsize(): number {\n\t\treturn this._rows.length;\n\t}\n\n\tclear(): void {\n\t\tconst rows = this._rows;\n\t\tif (0 < rows.length) {\n\t\t\trows.length = 0;\n\t\t\tthis.lock();\n\t\t\tthis._selection.clear();\n\t\t\tthis._sorter.toDirty();\n\t\t\tthis._filter.toDirty();\n\t\t\tthis.unlock();\n\t\t}\n\t}\n\n\tclearAndAdd(row: ROW): void {\n\t\tconst rows = this._rows;\n\t\trows.length = 0;\n\t\trows.push(row);\n\t\tthis.lock();\n\t\tthis._selection.clear();\n\t\tthis._sorter.toDirty();\n\t\tthis._filter.toDirty();\n\t\tthis.unlock();\n\t}\n\n\tclearAndAddAll(newRows: ROW[]): void {\n\t\tconst rows = this._rows;\n\t\trows.length = 0;\n\t\tfor (let i = 0, imax = newRows.length; i < imax; ++i) {\n\t\t\trows.push(newRows[i]);\n\t\t}\n\t\tthis.lock();\n\t\tthis._selection.clear();\n\t\tthis._sorter.toDirty();\n\t\tthis._filter.toDirty();\n\t\tthis.unlock();\n\t}\n\n\tadd(row: ROW, index?: number): void {\n\t\tconst rows = this._rows;\n\t\tconst selection = this._selection;\n\t\tconst sorter = this._sorter;\n\t\tconst filter = this._filter;\n\t\tif (index == null) {\n\t\t\trows.push(row);\n\t\t\tthis.lock();\n\t\t\tsorter.toDirty();\n\t\t\tfilter.toDirty();\n\t\t\tthis.unlock();\n\t\t} else if (0 <= index && index < rows.length) {\n\t\t\trows.splice(index, 0, row);\n\t\t\tthis.lock();\n\t\t\tselection.shift(index, 1);\n\t\t\tsorter.toDirty();\n\t\t\tfilter.toDirty();\n\t\t\tthis.unlock();\n\t\t}\n\t}\n\n\taddAll(newRows: ROW[], index?: number): void {\n\t\tconst rows = this._rows;\n\t\tconst rowsLength = rows.length;\n\t\tconst selection = this._selection;\n\t\tconst sorter = this._sorter;\n\t\tconst filter = this._filter;\n\t\tif (index == null) {\n\t\t\tconst newRowsLength = newRows.length;\n\t\t\tfor (let i = 0, imax = newRowsLength; i < imax; ++i) {\n\t\t\t\trows.push(newRows[i]);\n\t\t\t}\n\t\t\tthis.lock();\n\t\t\tsorter.toDirty();\n\t\t\tfilter.toDirty();\n\t\t\tthis.unlock();\n\t\t} else if (0 <= index && index < rowsLength) {\n\t\t\tconst newRowsLength = newRows.length;\n\t\t\tfor (let i = 0; i < newRowsLength; ++i) {\n\t\t\t\trows.splice(index + i, 0, newRows[i]);\n\t\t\t}\n\t\t\tthis.lock();\n\t\t\tselection.shift(index, newRowsLength);\n\t\t\tsorter.toDirty();\n\t\t\tfilter.toDirty();\n\t\t\tthis.unlock();\n\t\t}\n\t}\n\n\tget(index: number): ROW | null {\n\t\tconst rows = this._rows;\n\t\tif (0 <= index && index < rows.length) {\n\t\t\treturn rows[index];\n\t\t}\n\t\treturn null;\n\t}\n\n\tset(index: number, row: ROW): ROW | null {\n\t\tconst rows = this._rows;\n\t\tif (0 <= index && index < rows.length) {\n\t\t\tconst result = rows[index];\n\t\t\trows[index] = row;\n\t\t\tthis.lock();\n\t\t\tthis._sorter.toDirty();\n\t\t\tthis._filter.toDirty();\n\t\t\tthis.unlock();\n\t\t\treturn result;\n\t\t}\n\t\treturn null;\n\t}\n\n\tremove(index: number): ROW | null {\n\t\tconst rows = this._rows;\n\t\tif (0 <= index && index < rows.length) {\n\t\t\tconst result = rows.splice(index, 1)[0];\n\t\t\tthis.lock();\n\t\t\tthis._selection.remove(index);\n\t\t\tthis._sorter.toDirty();\n\t\t\tthis._filter.toDirty();\n\t\t\tthis.unlock();\n\t\t\treturn result;\n\t\t}\n\t\treturn null;\n\t}\n\n\teach(\n\t\titeratee: (row: ROW, index: number) => boolean | void,\n\t\tifrom?: number,\n\t\tito?: number\n\t): void {\n\t\tconst rows = this._rows;\n\t\tifrom = ifrom != null ? Math.max(0, ifrom) : 0;\n\t\tito = ito != null ? Math.min(rows.length, ito) : rows.length;\n\t\tfor (let i = ifrom; i < ito; ++i) {\n\t\t\tconst row = rows[i];\n\t\t\tif (iteratee(row, i) === false) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tget selection(): DTableDataSelection<ROW> {\n\t\treturn this._selection;\n\t}\n\n\tget filter(): DTableDataFilter<ROW> {\n\t\treturn this._filter;\n\t}\n\n\tget sorter(): DTableDataSorter<ROW> {\n\t\treturn this._sorter;\n\t}\n\n\tget mapped(): DTableDataMapped<ROW> {\n\t\treturn this._mapped;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction, Point, Rectangle } from \"pixi.js\";\nimport InteractionEvent = interaction.InteractionEvent;\nimport { DBase, DBaseOptions, DThemeBase } from \"./d-base\";\nimport { DBaseState } from \"./d-base-state\";\nimport { DTableBodyRow, DTableBodyRowOnChange, DTableBodyRowOptions } from \"./d-table-body-row\";\nimport { DTableColumn } from \"./d-table-column\";\nimport { DTableData, DTableDataOptions } from \"./d-table-data\";\nimport { DTableDataList, DTableDataListOptions } from \"./d-table-data-list\";\nimport { DTableDataSelection, DTableDataSelectionType } from \"./d-table-data-selection\";\nimport { DTableBodyCell } from \"./d-table-body-cell\";\nimport { DTableState } from \"./d-table-state\";\n\nexport interface DTableBodyOptions<\n\tROW,\n\tDATA extends DTableData<ROW> = DTableDataList<ROW>,\n\tTHEME extends DThemeTableBody = DThemeTableBody\n> extends DBaseOptions<THEME> {\n\tcolumns?: Array<DTableColumn<ROW, unknown>>;\n\trow?: DTableBodyRowOptions<ROW>;\n\tdata?: DTableDataListOptions<ROW> | DATA;\n\toffset?: number;\n\tfrozen?: number;\n}\n\nexport interface DThemeTableBody extends DThemeBase {\n\tgetRowHeight(): number;\n}\n\nconst toRowOptions = <ROW, DATA extends DTableData<ROW>>(\n\ttheme: DThemeTableBody,\n\toptions: DTableBodyOptions<ROW, DATA>,\n\tselectionType: DTableDataSelectionType\n): DTableBodyRowOptions<ROW> => {\n\tconst columns = options.columns || [];\n\tlet result = options.row;\n\tif (result != null) {\n\t\tif (result.height == null) {\n\t\t\tresult.height = theme.getRowHeight();\n\t\t}\n\t\tif (result.columns === undefined) {\n\t\t\tresult.columns = columns;\n\t\t}\n\t\tif (result.frozen == null) {\n\t\t\tresult.frozen = options.frozen;\n\t\t}\n\t\tif (result.selection === undefined) {\n\t\t\tresult.selection = {\n\t\t\t\ttype: selectionType\n\t\t\t};\n\t\t} else if (result.selection.type === undefined) {\n\t\t\tresult.selection.type = selectionType;\n\t\t}\n\t} else {\n\t\tresult = {\n\t\t\tcolumns,\n\t\t\theight: theme.getRowHeight(),\n\t\t\tfrozen: options.frozen,\n\t\t\tselection: {\n\t\t\t\ttype: selectionType\n\t\t\t}\n\t\t};\n\t}\n\treturn result as DTableBodyRowOptions<ROW>;\n};\n\nexport class DTableBody<\n\tROW,\n\tDATA extends DTableData<ROW> = DTableDataList<ROW>,\n\tTHEME extends DThemeTableBody = DThemeTableBody,\n\tOPTIONS extends DTableBodyOptions<ROW, DATA, THEME> = DTableBodyOptions<ROW, DATA, THEME>\n> extends DBase<THEME, OPTIONS> {\n\tprotected static WORK_ON_CLICK = new Point();\n\n\tprotected _columns: Array<DTableColumn<ROW, unknown>>;\n\tprotected _rowHeight: number;\n\tprotected _rowIndexMappedStart: number;\n\tprotected _rowIndexMappedEnd: number;\n\tprotected _rowOptions: DTableBodyRowOptions<ROW>;\n\tprotected _updateRowsCount: number;\n\tprotected _isUpdateRowsCalled: boolean;\n\tprotected _isUpdateRowsCalledForcibly: boolean;\n\tprotected _workRows: Array<DTableBodyRow<ROW>>;\n\tprotected _onRowChangeBound: DTableBodyRowOnChange<ROW, unknown>;\n\tprotected _data: DATA;\n\n\tconstructor(options: OPTIONS) {\n\t\tsuper(options);\n\n\t\tthis.transform.position.y = options.offset ?? 0;\n\t\tconst data = this.toData(options.data);\n\t\tthis._data = data;\n\t\tdata.bind(this);\n\t\tconst theme = this.theme;\n\t\tconst rowOptions = toRowOptions(theme, options, data.selection.type);\n\t\tthis._rowOptions = rowOptions;\n\t\tthis._rowHeight = rowOptions.height != null ? rowOptions.height : theme.getRowHeight();\n\t\tthis._columns = rowOptions.columns || [];\n\t\tthis._rowIndexMappedStart = 0;\n\t\tthis._rowIndexMappedEnd = 0;\n\t\tthis._updateRowsCount = 0;\n\t\tthis._isUpdateRowsCalled = false;\n\t\tthis._isUpdateRowsCalledForcibly = false;\n\t\tthis._workRows = [];\n\t\tthis._onRowChangeBound = (newValue, oldValue, row, rowIndex, columnIndex): void => {\n\t\t\tdata.emit(\"change\", newValue, oldValue, row, rowIndex, columnIndex, data);\n\t\t};\n\t\tthis._data.emit(\"init\", this._data);\n\t}\n\n\tprotected toData(options?: DATA | DTableDataListOptions<ROW>): DATA {\n\t\tif (this.isData(options)) {\n\t\t\treturn options;\n\t\t}\n\t\treturn new DTableDataList<ROW>(options) as any;\n\t}\n\n\tprotected isData(\n\t\ttarget?: ROW[] | DTableDataOptions<ROW> | DTableData<ROW>\n\t): target is DTableData<ROW> {\n\t\treturn target != null && \"mapped\" in target;\n\t}\n\n\tonResize(newWidth: number, newHeight: number, oldWidth: number, oldHeight: number): void {\n\t\tsuper.onResize(newWidth, newHeight, oldWidth, oldHeight);\n\t\tthis.update();\n\t}\n\n\tget selection(): DTableDataSelection<ROW> {\n\t\treturn this._data.selection;\n\t}\n\n\tlock(): void {\n\t\tthis._updateRowsCount += 1;\n\t\tif (this._updateRowsCount === 1) {\n\t\t\tthis._isUpdateRowsCalled = false;\n\t\t\tthis._isUpdateRowsCalledForcibly = false;\n\t\t}\n\t}\n\n\tunlock(callIfNeeded: boolean): void {\n\t\tthis._updateRowsCount -= 1;\n\t\tif (this._updateRowsCount === 0) {\n\t\t\tif (callIfNeeded && this._isUpdateRowsCalled) {\n\t\t\t\tthis.update(this._isUpdateRowsCalledForcibly);\n\t\t\t}\n\t\t\tthis._isUpdateRowsCalled = false;\n\t\t\tthis._isUpdateRowsCalledForcibly = false;\n\t\t}\n\t}\n\n\t/**\n\t * Updates rows. If the `forcibly` is true, some dirty checkings for\n\t * avoiding unnecessary state changes are skipped.\n\t *\n\t * @param forcibly true to update forcibly\n\t */\n\tupdate(forcibly?: boolean): void {\n\t\tif (0 < this._updateRowsCount) {\n\t\t\tthis._isUpdateRowsCalled = true;\n\t\t\tif (forcibly) {\n\t\t\t\tthis._isUpdateRowsCalledForcibly = true;\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tconst content = this.parent;\n\t\tif (content == null) {\n\t\t\treturn;\n\t\t}\n\t\tconst contentParent = content.parent;\n\t\tif (contentParent == null) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst rows = this.children as Array<DTableBodyRow<ROW>>;\n\t\tconst height = contentParent.height;\n\t\tconst rowHeight = this._rowHeight;\n\n\t\tconst data = this._data;\n\t\tconst dataMappedSize = data.mapped.size();\n\n\t\tconst oldRowIndexMappedStart = this._rowIndexMappedStart;\n\t\tlet oldRowIndexMappedEnd = this._rowIndexMappedEnd;\n\t\tlet oldRowCount = oldRowIndexMappedEnd - oldRowIndexMappedStart;\n\n\t\tconst y = this.transform.position.y;\n\t\tconst newHeight = y + dataMappedSize * rowHeight;\n\t\tconst newContentHeight = Math.max(height, newHeight);\n\t\tconst newContentY = Math.max(height - newContentHeight, content.position.y);\n\n\t\tconst newRowIndexMappedLowerBound = Math.floor((0 - (newContentY + y)) / rowHeight);\n\t\tconst newRowIndexMappedUpperBound = Math.floor((height - (newContentY + y)) / rowHeight);\n\t\tconst newRowIndexMappedStart =\n\t\t\tnewRowIndexMappedLowerBound - (newRowIndexMappedLowerBound % 2 === 0 ? 2 : 1);\n\t\tlet newRowIndexMappedEnd =\n\t\t\tnewRowIndexMappedUpperBound +\n\t\t\t((newRowIndexMappedUpperBound - newRowIndexMappedStart + 1) % 2 === 0 ? 3 : 2);\n\t\tlet newRowCount = newRowIndexMappedEnd - newRowIndexMappedStart;\n\t\tif (newRowCount < oldRowCount && oldRowCount - 2 <= newRowCount) {\n\t\t\tnewRowCount = oldRowCount;\n\t\t\tnewRowIndexMappedEnd = newRowIndexMappedStart + newRowCount;\n\t\t}\n\n\t\tif (oldRowCount < newRowCount) {\n\t\t\tfor (let i = oldRowCount; i < newRowCount; ++i) {\n\t\t\t\tconst oldRowIndexMapped = oldRowIndexMappedStart + i;\n\t\t\t\tconst newRow = this.newRow(oldRowIndexMapped % 2 === 0);\n\t\t\t\tthis.addChild(newRow);\n\t\t\t}\n\t\t\toldRowCount = newRowCount;\n\t\t\toldRowIndexMappedEnd = oldRowIndexMappedStart + oldRowCount;\n\t\t} else if (newRowCount < oldRowCount) {\n\t\t\tfor (let i = oldRowCount - 1; newRowCount <= i; --i) {\n\t\t\t\tthis.removeChild(rows[i]);\n\t\t\t}\n\t\t\toldRowCount = newRowCount;\n\t\t\toldRowIndexMappedEnd = oldRowIndexMappedStart + oldRowCount;\n\t\t}\n\n\t\tthis._rowIndexMappedStart = newRowIndexMappedStart;\n\t\tthis._rowIndexMappedEnd = newRowIndexMappedEnd;\n\n\t\tconst rowIndexMappedStartDelta = newRowIndexMappedStart - oldRowIndexMappedStart;\n\t\tconst rowIndexMappedStartDeltaAbs = Math.abs(rowIndexMappedStartDelta);\n\t\tconst rowsLength = rows.length;\n\t\tif (0 < rowIndexMappedStartDeltaAbs && rowIndexMappedStartDeltaAbs < rowsLength) {\n\t\t\tconst work = this._workRows;\n\t\t\tif (0 < rowIndexMappedStartDelta) {\n\t\t\t\tfor (let i = 0; i < rowIndexMappedStartDeltaAbs; ++i) {\n\t\t\t\t\twork.push(this.resetRow(rows[i]));\n\t\t\t\t}\n\t\t\t\tfor (let i = rowIndexMappedStartDeltaAbs; i < rowsLength; ++i) {\n\t\t\t\t\trows[i - rowIndexMappedStartDeltaAbs] = rows[i];\n\t\t\t\t}\n\t\t\t\tfor (let i = 0; i < rowIndexMappedStartDeltaAbs; ++i) {\n\t\t\t\t\trows[rowsLength - rowIndexMappedStartDeltaAbs + i] = work[i];\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (let i = 0; i < rowIndexMappedStartDeltaAbs; ++i) {\n\t\t\t\t\twork.push(this.resetRow(rows[rowsLength - rowIndexMappedStartDeltaAbs + i]));\n\t\t\t\t}\n\t\t\t\tfor (let i = rowsLength - rowIndexMappedStartDeltaAbs - 1; 0 <= i; --i) {\n\t\t\t\t\trows[i + rowIndexMappedStartDeltaAbs] = rows[i];\n\t\t\t\t}\n\t\t\t\tfor (let i = 0; i < rowIndexMappedStartDeltaAbs; ++i) {\n\t\t\t\t\trows[i] = work[i];\n\t\t\t\t}\n\t\t\t}\n\t\t\twork.length = 0;\n\t\t}\n\n\t\tconst selection = data.selection;\n\t\tconst isRowSelectable = selection.type !== DTableDataSelectionType.NONE;\n\t\tdata.mapped.each(\n\t\t\t(\n\t\t\t\tdatum: ROW,\n\t\t\t\tsupplimental: unknown,\n\t\t\t\tindex: number,\n\t\t\t\tunmappedIndex: number\n\t\t\t): void | boolean => {\n\t\t\t\tconst row = rows[index - newRowIndexMappedStart];\n\n\t\t\t\t// Position\n\t\t\t\trow.position.y = index * rowHeight;\n\n\t\t\t\t// State\n\t\t\t\tconst rowState = row.state;\n\t\t\t\trowState.lock();\n\t\t\t\trowState.set(DTableState.SELECTABLE, isRowSelectable);\n\t\t\t\trowState.set(DBaseState.ACTIVE, selection.contains(unmappedIndex));\n\t\t\t\trowState.remove(DBaseState.DISABLED);\n\t\t\t\trowState.unlock();\n\n\t\t\t\t// Data\n\t\t\t\trow.set(datum, supplimental, unmappedIndex, forcibly);\n\t\t\t},\n\t\t\tnewRowIndexMappedStart,\n\t\t\tnewRowIndexMappedStart + rowsLength\n\t\t);\n\n\t\tfor (let i = 0; newRowIndexMappedStart + i < 0 && i < rowsLength; ++i) {\n\t\t\tconst row = rows[i];\n\n\t\t\t// Position\n\t\t\trow.position.y = (newRowIndexMappedStart + i) * rowHeight;\n\n\t\t\t// State\n\t\t\tconst rowState = row.state;\n\t\t\trowState.lock();\n\t\t\trowState.add(DBaseState.DISABLED);\n\t\t\trowState.removeAll(DTableState.SELECTABLE, DBaseState.ACTIVE);\n\t\t\trowState.unlock();\n\n\t\t\t// Data\n\t\t\trow.unset();\n\t\t}\n\n\t\tfor (let i = rowsLength - 1; dataMappedSize <= newRowIndexMappedStart + i && 0 <= i; --i) {\n\t\t\tconst row = rows[i];\n\n\t\t\t// Position\n\t\t\trow.position.y = (newRowIndexMappedStart + i) * rowHeight;\n\n\t\t\t// State\n\t\t\tconst rowState = row.state;\n\t\t\trowState.lock();\n\t\t\trowState.add(DBaseState.DISABLED);\n\t\t\trowState.removeAll(DTableState.SELECTABLE, DBaseState.ACTIVE);\n\t\t\trowState.unlock();\n\n\t\t\t// Data\n\t\t\trow.unset();\n\t\t}\n\n\t\tthis.lock();\n\t\tcontent.position.y = newContentY;\n\t\tcontent.height = newContentHeight;\n\t\tthis.height = newHeight;\n\t\tthis.unlock(false);\n\t}\n\n\tprotected resetRow(row: DTableBodyRow<ROW>): DTableBodyRow<ROW> {\n\t\trow.blur(true);\n\t\tconst cells = row.children;\n\t\tfor (let i = 0, imax = cells.length; i < imax; ++i) {\n\t\t\tconst cell = cells[i];\n\t\t\tif (cell instanceof DBase) {\n\t\t\t\tcell.state.isPressed = false;\n\t\t\t}\n\t\t}\n\t\treturn row;\n\t}\n\n\tprotected newRow(isEven: boolean): DTableBodyRow<ROW> {\n\t\treturn new DTableBodyRow<ROW>(this._onRowChangeBound, isEven, this._rowOptions);\n\t}\n\n\tprotected onParentMove(newX: number, newY: number, oldX: number, oldY: number): void {\n\t\tsuper.onParentMove(newX, newY, oldX, oldY);\n\t\tthis.updateFrozenCellPosition(newX);\n\t}\n\n\tprotected updateFrozenCellPosition(x: number): void {\n\t\tconst frozen = this._rowOptions.frozen;\n\t\tif (frozen != null && 0 < frozen) {\n\t\t\tconst rows = this.children as Array<DTableBodyRow<ROW>>;\n\t\t\tfor (let i = 0, imax = rows.length; i < imax; ++i) {\n\t\t\t\trows[i].updateFrozenCellPosition(x);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetClippingRect(target: unknown, result: Rectangle): void {\n\t\tsuper.getClippingRect(target, result);\n\n\t\tconst parent = this.parent;\n\t\tif (parent) {\n\t\t\tconst dy = -parent.transform.position.y;\n\t\t\tresult.y += dy;\n\t\t\tresult.height -= dy;\n\t\t}\n\t}\n\n\tprotected toRowIndexMapped(local: Point): number {\n\t\tif (0 <= this.parent.position.y + local.y) {\n\t\t\treturn Math.floor(local.y / this._rowHeight);\n\t\t}\n\t\treturn -1;\n\t}\n\n\tprotected toRow(rowIndexMapped: number): DTableBodyRow<ROW> | null {\n\t\tconst index = rowIndexMapped - this._rowIndexMappedStart;\n\t\tconst rows = this.children as Array<DTableBodyRow<ROW>>;\n\t\tif (0 <= index && index < rows.length) {\n\t\t\treturn rows[index];\n\t\t}\n\t\treturn null;\n\t}\n\n\tprotected toCell(row: DTableBodyRow<ROW>, local: Point): DTableBodyCell<ROW, unknown> | null {\n\t\tconst cells = row.children as Array<DTableBodyCell<ROW, unknown>>;\n\t\tconst cellsLength = cells.length;\n\t\tconst columns = this._columns;\n\t\tconst columnsLength = columns.length;\n\t\tfor (let i = 0, imax = Math.min(cellsLength, columnsLength); i < imax; ++i) {\n\t\t\tconst cell = cells[cellsLength - i - 1];\n\t\t\tconst x = local.x - cell.position.x;\n\t\t\tif (0 <= x && x <= cell.width) {\n\t\t\t\treturn cell;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tonRowClick(e: InteractionEvent): void {\n\t\tif (this.state.isActionable) {\n\t\t\tconst local = DTableBody.WORK_ON_CLICK;\n\t\t\tlocal.copyFrom(e.data.global);\n\t\t\tthis.toLocal(local, undefined, local, false);\n\t\t\tconst rowIndexMapped = this.toRowIndexMapped(local);\n\t\t\tif (0 <= rowIndexMapped && rowIndexMapped < this._data.mapped.size()) {\n\t\t\t\t// Delegate to the cell at first\n\t\t\t\tconst row = this.toRow(rowIndexMapped);\n\t\t\t\tif (row) {\n\t\t\t\t\tconst cell = this.toCell(row, local);\n\t\t\t\t\tif (cell && cell.onRowSelect && cell.onRowSelect(e, local)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Fallback to the default\n\t\t\t\tthis.onRowSelect(e, rowIndexMapped);\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected onRowSelect(e: InteractionEvent, rowIndexMapped: number): void {\n\t\tconst data = this._data;\n\t\tconst selection = data.selection;\n\t\tconst isSingle = selection.type === DTableDataSelectionType.SINGLE;\n\t\tconst isNotSingle = !isSingle;\n\t\tconst rowIndex = data.mapped.unmap(rowIndexMapped);\n\t\tconst originalEvent = e.data.originalEvent;\n\t\tconst ctrlKey = originalEvent.ctrlKey;\n\t\tconst shiftKey = originalEvent.shiftKey;\n\t\tif (isSingle || selection.isEmpty() || !(isNotSingle && (ctrlKey || shiftKey))) {\n\t\t\tselection.clearAndAdd(rowIndex);\n\t\t} else if (ctrlKey) {\n\t\t\tselection.toggle(rowIndex);\n\t\t} else if (shiftKey) {\n\t\t\tconst lastRowIndex = selection.last;\n\t\t\tif (lastRowIndex != null) {\n\t\t\t\tconst sorter = data.sorter;\n\t\t\t\tconst filter = data.filter;\n\t\t\t\tconst rowIndexSorted = sorter.map(rowIndex);\n\t\t\t\tconst lastRowIndexSorted = sorter.map(lastRowIndex);\n\t\t\t\tif (rowIndexSorted != null && lastRowIndexSorted != null) {\n\t\t\t\t\tlet istart = lastRowIndexSorted + 1;\n\t\t\t\t\tlet iend = rowIndexSorted + 1;\n\t\t\t\t\tif (rowIndexSorted < lastRowIndexSorted) {\n\t\t\t\t\t\tistart = rowIndexSorted;\n\t\t\t\t\t\tiend = lastRowIndexSorted;\n\t\t\t\t\t}\n\t\t\t\t\tif (istart < iend) {\n\t\t\t\t\t\tconst rowIndices: number[] = [];\n\t\t\t\t\t\tconst indicesFiltered = filter.indices;\n\t\t\t\t\t\tconst indicesSorted = sorter.indices;\n\t\t\t\t\t\tif (indicesFiltered) {\n\t\t\t\t\t\t\tif (indicesSorted) {\n\t\t\t\t\t\t\t\tfor (let i = 0, imax = indicesFiltered.length; i < imax; ++i) {\n\t\t\t\t\t\t\t\t\tconst indexFiltered = indicesFiltered[i];\n\t\t\t\t\t\t\t\t\tif (istart <= indexFiltered && indexFiltered < iend) {\n\t\t\t\t\t\t\t\t\t\trowIndices.push(indicesSorted[indexFiltered]);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tfor (let i = 0, imax = indicesFiltered.length; i < imax; ++i) {\n\t\t\t\t\t\t\t\t\tconst indexFiltered = indicesFiltered[i];\n\t\t\t\t\t\t\t\t\tif (istart <= indexFiltered && indexFiltered < iend) {\n\t\t\t\t\t\t\t\t\t\trowIndices.push(indexFiltered);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (indicesSorted) {\n\t\t\t\t\t\t\t\tfor (let i = istart; i < iend; ++i) {\n\t\t\t\t\t\t\t\t\trowIndices.push(indicesSorted[i]);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tfor (let i = istart; i < iend; ++i) {\n\t\t\t\t\t\t\t\t\trowIndices.push(i);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tselection.addAll(rowIndices);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DTableBody\";\n\t}\n\n\tget data(): DATA {\n\t\treturn this._data;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DImage, DImageOptions, DThemeImage } from \"./d-image\";\n\nexport interface DTableCategoryCellOptions<\n\tTHEME extends DThemeTableCategoryCell = DThemeTableCategoryCell\n> extends DImageOptions<string | null, THEME> {}\n\nexport interface DThemeTableCategoryCell extends DThemeImage<string | null> {}\n\nexport class DTableCategoryCell<\n\tTHEME extends DThemeTableCategoryCell = DThemeTableCategoryCell,\n\tOPTIONS extends DTableCategoryCellOptions<THEME> = DTableCategoryCellOptions<THEME>\n> extends DImage<string | null, THEME, OPTIONS> {\n\tprotected getType(): string {\n\t\treturn \"DTableCategoryCell\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBase } from \"./d-base\";\nimport { DTableCategoryCell, DTableCategoryCellOptions } from \"./d-table-category-cell\";\nimport { DTableRow, DTableRowOptions, DThemeTableRow } from \"./d-table-row\";\n\nexport interface DTableCategoryColumn {\n\tlabel?: string;\n\tweight?: number;\n\twidth?: number;\n\toffset: number;\n}\n\nexport interface DTableCategoryOptions<THEME extends DThemeTableCategory = DThemeTableCategory>\n\textends DTableRowOptions<unknown, DTableCategoryColumn, THEME> {\n\toffset?: number;\n\tcell?: DTableCategoryCellOptions;\n}\n\nexport interface DThemeTableCategory extends DThemeTableRow {}\n\nexport class DTableCategory<\n\tTHEME extends DThemeTableCategory = DThemeTableCategory,\n\tOPTIONS extends DTableCategoryOptions<THEME> = DTableCategoryOptions<THEME>\n> extends DTableRow<unknown, DTableCategoryColumn, THEME, OPTIONS> {\n\tprotected _offset: number;\n\n\tconstructor(options: OPTIONS) {\n\t\tsuper(options);\n\n\t\tconst offset = options.offset ?? 0;\n\t\tthis._offset = offset;\n\t\tthis.transform.position.y = offset;\n\n\t\tthis.initCells(options, this._columns, this._frozen);\n\t}\n\n\tprotected onParentMove(newX: number, newY: number, oldX: number, oldY: number): void {\n\t\tsuper.onParentMove(newX, newY, oldX, oldY);\n\t\tthis.transform.position.y = -newY + this._offset;\n\t\tthis.updateFrozenCellPosition(newX);\n\t}\n\n\tprotected getContentPositionX(): number {\n\t\tconst content = this.parent;\n\t\tif (content) {\n\t\t\treturn content.position.x;\n\t\t}\n\t\treturn 0;\n\t}\n\n\tprotected newCell(\n\t\tcolumnIndex: number,\n\t\tcolumn: DTableCategoryColumn,\n\t\tcolumns: DTableCategoryColumn[],\n\t\toptions: OPTIONS\n\t): DBase {\n\t\treturn new DTableCategoryCell(this.toCellOptions(columnIndex, column, options));\n\t}\n\n\tprotected toCellOptions(\n\t\tcolumnIndex: number,\n\t\tcolumn: DTableCategoryColumn,\n\t\toptions: OPTIONS\n\t): DTableCategoryCellOptions {\n\t\tconst result = options.cell;\n\t\tif (result) {\n\t\t\tresult.weight = column.weight;\n\t\t\tresult.width = column.width;\n\t\t\tconst text = result.text || {};\n\t\t\tresult.text = text;\n\t\t\ttext.value = text.value || column.label;\n\t\t\treturn result;\n\t\t} else {\n\t\t\treturn {\n\t\t\t\tweight: column.weight,\n\t\t\t\twidth: column.width,\n\t\t\t\ttext: {\n\t\t\t\t\tvalue: column.label\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DTableCategory\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { utils } from \"pixi.js\";\nimport { DTableDataFilter, DTableDataFilterer } from \"./d-table-data-filter\";\nimport { DTableDataTreeNode } from \"./d-table-data-tree-item\";\nimport { DTableDataTreeItemAccessor } from \"./d-table-data-tree-item-accessor\";\nimport { isFunction } from \"./util/is-function\";\n\nexport interface DTableDataTreeFilterParent<NODE> {\n\treadonly nodes: NODE[] | undefined;\n\treadonly accessor: DTableDataTreeItemAccessor<NODE>;\n\tisOpened(node: NODE): boolean;\n\tupdate(): void;\n}\n\nexport class DTableDataTreeFilter<NODE extends DTableDataTreeNode<NODE, NODE>>\n\textends utils.EventEmitter\n\timplements DTableDataFilter<NODE>\n{\n\tprotected _id: number;\n\tprotected _idUpdated: number;\n\tprotected _isApplied: boolean;\n\tprotected _parent: DTableDataTreeFilterParent<NODE>;\n\tprotected _filter: DTableDataFilterer<NODE> | null;\n\tprotected _filtered: number[] | null;\n\n\tconstructor(parent: DTableDataTreeFilterParent<NODE>) {\n\t\tsuper();\n\n\t\tthis._id = 0;\n\t\tthis._idUpdated = -1;\n\t\tthis._isApplied = false;\n\n\t\tthis._parent = parent;\n\t\tthis._filter = null;\n\t\tthis._filtered = null;\n\t}\n\n\tget id(): number {\n\t\treturn this._id;\n\t}\n\n\tapply(): void {\n\t\tthis._isApplied = true;\n\t\tthis._id += 1;\n\t\tthis._parent.update();\n\t}\n\n\tunapply(): void {\n\t\tif (this._isApplied) {\n\t\t\tthis._isApplied = false;\n\t\t\tthis._id += 1;\n\t\t\tthis._parent.update();\n\t\t}\n\t}\n\n\tisApplied(): boolean {\n\t\treturn this._isApplied;\n\t}\n\n\tprotected isFiltered(node: NODE, index: number, filter: DTableDataFilterer<NODE>): boolean {\n\t\tif (isFunction(filter)) {\n\t\t\treturn filter(node, index);\n\t\t} else {\n\t\t\treturn filter.test(node, index);\n\t\t}\n\t}\n\n\tprotected hasFiltered(\n\t\tparent: DTableDataTreeFilterParent<NODE>,\n\t\tnodes: NODE[],\n\t\tfilter: DTableDataFilterer<NODE>\n\t): boolean {\n\t\tconst toChildren = this._parent.accessor.toChildren;\n\t\tfor (let i = 0, imax = nodes.length; i < imax; ++i) {\n\t\t\tconst node = nodes[i];\n\t\t\tif (this.isFiltered(node, -1, filter)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tconst children = toChildren(node);\n\t\t\tif (\n\t\t\t\tchildren != null &&\n\t\t\t\t0 < children.length &&\n\t\t\t\tthis.hasFiltered(parent, children, filter)\n\t\t\t) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tprotected addAllToFiltered(\n\t\tparent: DTableDataTreeFilterParent<NODE>,\n\t\tnodes: NODE[],\n\t\tfiltered: number[],\n\t\tcursor: [number]\n\t): void {\n\t\tconst toChildren = this._parent.accessor.toChildren;\n\t\tfor (let i = 0, imax = nodes.length; i < imax; ++i) {\n\t\t\tconst node = nodes[i];\n\t\t\tfiltered.push(cursor[0]);\n\t\t\tcursor[0] += 1;\n\t\t\tconst children = toChildren(node);\n\t\t\tif (children != null && 0 < children.length && parent.isOpened(node)) {\n\t\t\t\tthis.addAllToFiltered(parent, children, filtered, cursor);\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected newFilteredSub(\n\t\tparent: DTableDataTreeFilterParent<NODE>,\n\t\tnodes: NODE[],\n\t\tfilter: DTableDataFilterer<NODE>,\n\t\tfiltered: number[],\n\t\tcursor: [number]\n\t): boolean {\n\t\tlet result = false;\n\t\tconst toChildren = this._parent.accessor.toChildren;\n\t\tfor (let i = 0, imax = nodes.length; i < imax; ++i) {\n\t\t\tconst node = nodes[i];\n\t\t\tconst index = cursor[0];\n\t\t\tcursor[0] += 1;\n\t\t\tconst isFiltered = this.isFiltered(node, index, filter);\n\t\t\tconst children = toChildren(node);\n\t\t\tif (children != null && 0 < children.length) {\n\t\t\t\tif (parent.isOpened(node)) {\n\t\t\t\t\tif (isFiltered) {\n\t\t\t\t\t\tfiltered.push(index);\n\t\t\t\t\t\tresult = true;\n\t\t\t\t\t\tthis.addAllToFiltered(parent, children, filtered, cursor);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst position = filtered.length;\n\t\t\t\t\t\tif (this.newFilteredSub(parent, children, filter, filtered, cursor)) {\n\t\t\t\t\t\t\tfiltered.splice(position, 0, index);\n\t\t\t\t\t\t\tresult = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if (isFiltered || this.hasFiltered(parent, children, filter)) {\n\t\t\t\t\tfiltered.push(index);\n\t\t\t\t\tresult = true;\n\t\t\t\t}\n\t\t\t} else if (isFiltered) {\n\t\t\t\tfiltered.push(index);\n\t\t\t\tresult = true;\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected newFiltered(): number[] | null {\n\t\tconst filter = this._filter;\n\t\tif (filter != null) {\n\t\t\tconst filtered: number[] = [];\n\t\t\tconst parent = this._parent;\n\t\t\tconst nodes = parent.nodes;\n\t\t\tif (nodes) {\n\t\t\t\tconst cursor: [number] = [0];\n\t\t\t\tthis.newFilteredSub(parent, nodes, filter, filtered, cursor);\n\t\t\t}\n\t\t\treturn filtered;\n\t\t}\n\t\treturn null;\n\t}\n\n\tget(): DTableDataFilterer<NODE> | null {\n\t\treturn this._filter;\n\t}\n\n\tset(filter: DTableDataFilterer<NODE> | null): void {\n\t\tif (this._filter !== filter) {\n\t\t\tthis._filter = filter;\n\t\t}\n\t}\n\n\ttoDirty(): void {\n\t\tthis._id += 1;\n\t}\n\n\tupdate(): void {\n\t\tif (this._id !== this._idUpdated) {\n\t\t\tthis._idUpdated = this._id;\n\t\t\tif (this._isApplied) {\n\t\t\t\tthis._filtered = this.newFiltered();\n\t\t\t\tthis.emit(\"change\", this);\n\t\t\t} else if (this._filtered != null) {\n\t\t\t\tthis._filtered = null;\n\t\t\t\tthis.emit(\"change\", this);\n\t\t\t}\n\t\t}\n\t}\n\n\tget indices(): number[] | null {\n\t\tthis.update();\n\t\treturn this._filtered;\n\t}\n\n\tmap(sortedIndex: number): number | null {\n\t\tlet result = sortedIndex;\n\n\t\tconst indices = this.indices;\n\t\tif (indices) {\n\t\t\tconst index = indices.indexOf(result);\n\t\t\tif (0 <= index) {\n\t\t\t\tresult = index;\n\t\t\t} else {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tunmap(index: number): number {\n\t\tlet result = index;\n\n\t\tconst indices = this.indices;\n\t\tif (indices) {\n\t\t\tresult = indices[result];\n\t\t}\n\n\t\treturn result;\n\t}\n}\n","/*\n * Copyright (C) 2021 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport interface DTableDataTreeItemAccessorOptions<NODE> {\n\ttoParent?: (node: NODE) => NODE | null | undefined;\n\ttoChildren?: (node: NODE) => NODE[] | null | undefined;\n}\n\nconst toParent = <NODE>(node: any): NODE | null | undefined => {\n\treturn node.parent;\n};\n\nconst toChildren = <NODE>(node: any): NODE | null | undefined => {\n\treturn node.children;\n};\n\nexport class DTableDataTreeItemAccessor<NODE> {\n\ttoParent: (node: NODE) => NODE | null | undefined;\n\ttoChildren: (node: NODE) => NODE[] | null | undefined;\n\n\tconstructor(options?: DTableDataTreeItemAccessorOptions<NODE>) {\n\t\tthis.toParent = options?.toParent ?? toParent;\n\t\tthis.toChildren = options?.toChildren ?? toChildren;\n\t}\n}\n","/*\n * Copyright (C) 2021 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { utils } from \"pixi.js\";\nimport { DTableDataSelectionOptions, DTableDataSelectionType } from \"./d-table-data-selection\";\nimport {\n\tDTableDataTreeSelection,\n\tDTableDataTreeSelectionParent\n} from \"./d-table-data-tree-selection\";\nimport { toEnum } from \"./util/to-enum\";\n\nconst COMPARATOR = (a: [number, unknown], b: [number, unknown]): number => {\n\treturn a[0] - b[0];\n};\n\nexport class DTableDataTreeSelectionImpl<NODE>\n\textends utils.EventEmitter\n\timplements DTableDataTreeSelection<NODE>\n{\n\tprotected _parent: DTableDataTreeSelectionParent<NODE>;\n\tprotected _type: DTableDataSelectionType;\n\tprotected _rows: Set<NODE>;\n\n\tconstructor(parent: DTableDataTreeSelectionParent<NODE>, options?: DTableDataSelectionOptions) {\n\t\tsuper();\n\t\tthis._parent = parent;\n\t\tthis._type = toEnum(options?.type ?? DTableDataSelectionType.NONE, DTableDataSelectionType);\n\t\tthis._rows = new Set<NODE>();\n\t}\n\n\tonNodeChange(nodes?: NODE[]): void {\n\t\tif (nodes != null) {\n\t\t\tconst toChildren = this._parent.accessor.toChildren;\n\t\t\tconst oldRows = this._rows;\n\t\t\tconst newRows = this.newRows(nodes, toChildren, oldRows, new Set<NODE>());\n\t\t\tif (oldRows.size !== newRows.size) {\n\t\t\t\tthis._rows = newRows;\n\t\t\t\tthis.onChange();\n\t\t\t}\n\t\t} else {\n\t\t\tconst rows = this._rows;\n\t\t\tif (0 < rows.size) {\n\t\t\t\trows.clear();\n\t\t\t\tthis.onChange();\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected newRows(\n\t\tnodes: NODE[],\n\t\ttoChildren: (node: NODE) => NODE[] | null | undefined,\n\t\trows: Set<NODE>,\n\t\tresult: Set<NODE>\n\t): Set<NODE> {\n\t\tfor (let i = 0, imax = nodes.length; i < imax; ++i) {\n\t\t\tconst node = nodes[i];\n\t\t\tif (rows.has(node)) {\n\t\t\t\tresult.add(node);\n\t\t\t}\n\t\t\tconst children = toChildren(node);\n\t\t\tif (children != null) {\n\t\t\t\tthis.newRows(children, toChildren, rows, result);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tget indices(): number[] {\n\t\tconst rows = this._rows;\n\t\tconst result: number[] = [];\n\t\tthis._parent.each((row: NODE, index: number): void => {\n\t\t\tif (rows.has(row)) {\n\t\t\t\tresult.push(index);\n\t\t\t}\n\t\t});\n\t\treturn result;\n\t}\n\n\tget rows(): NODE[] {\n\t\tconst result: NODE[] = [];\n\t\tthis._rows.forEach((row: NODE): void => {\n\t\t\tresult.push(row);\n\t\t});\n\t\treturn result;\n\t}\n\n\tget type(): DTableDataSelectionType {\n\t\treturn this._type;\n\t}\n\n\tprotected getFirst(): NODE | null {\n\t\tconst rows = this._rows;\n\t\tif (0 < rows.size) {\n\t\t\tlet result: NODE | null = null;\n\t\t\trows.forEach((row: NODE): void => {\n\t\t\t\tif (result == null) {\n\t\t\t\t\tresult = row;\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn result;\n\t\t}\n\t\treturn null;\n\t}\n\n\tprotected getLast(): NODE | null {\n\t\tconst rows = this._rows;\n\t\tif (0 < rows.size) {\n\t\t\tlet result: NODE | null = null;\n\t\t\trows.forEach((row: NODE): void => {\n\t\t\t\tresult = row;\n\t\t\t});\n\t\t\treturn result;\n\t\t}\n\t\treturn null;\n\t}\n\n\tprotected toIndex(target: NODE): number | null {\n\t\tlet result: number | null = null;\n\t\tthis._parent.each((row: NODE, index: number): boolean => {\n\t\t\tif (target === row) {\n\t\t\t\tresult = index;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t});\n\t\treturn result;\n\t}\n\n\tget first(): number | null {\n\t\tconst row = this.getFirst();\n\t\tif (row) {\n\t\t\treturn this.toIndex(row);\n\t\t}\n\t\treturn null;\n\t}\n\n\tget last(): number | null {\n\t\tconst row = this.getLast();\n\t\tif (row) {\n\t\t\treturn this.toIndex(row);\n\t\t}\n\t\treturn null;\n\t}\n\n\tprotected onChange(): void {\n\t\tthis._parent.update();\n\t\tthis.emit(\"change\", this);\n\t}\n\n\ttoggle(rowIndex: number): void {\n\t\tconst row = this._parent.get(rowIndex);\n\t\tif (row) {\n\t\t\tconst rows = this._rows;\n\t\t\tif (rows.has(row)) {\n\t\t\t\trows.delete(row);\n\t\t\t} else {\n\t\t\t\trows.add(row);\n\t\t\t}\n\t\t\tthis.onChange();\n\t\t}\n\t}\n\n\tadd(rowIndex: number): void {\n\t\tconst row = this._parent.get(rowIndex);\n\t\tif (row) {\n\t\t\tconst rows = this._rows;\n\t\t\tif (!rows.has(row)) {\n\t\t\t\trows.add(row);\n\t\t\t\tthis.onChange();\n\t\t\t}\n\t\t}\n\t}\n\n\taddTo(rowIndex: number): void {\n\t\tconst lastRowIndex = this.last;\n\t\tif (lastRowIndex != null) {\n\t\t\tthis.addRange(lastRowIndex, false, rowIndex, true);\n\t\t}\n\t}\n\n\taddRange(from: number, includeFrom: boolean, to: number, includeTo: boolean): void {\n\t\tconst rows = this._rows;\n\t\tconst oldSize = rows.size;\n\t\tconst parent = this._parent;\n\t\tif (from < to) {\n\t\t\tparent.each(\n\t\t\t\t(row: NODE): void => {\n\t\t\t\t\trows.add(row);\n\t\t\t\t},\n\t\t\t\tfrom + (includeFrom ? 0 : 1),\n\t\t\t\tto + (includeTo ? 1 : 0)\n\t\t\t);\n\t\t} else {\n\t\t\tparent.each(\n\t\t\t\t(row: NODE): void => {\n\t\t\t\t\trows.add(row);\n\t\t\t\t},\n\t\t\t\tto + (includeTo ? 0 : 1),\n\t\t\t\tfrom + (includeFrom ? 1 : 0)\n\t\t\t);\n\t\t}\n\t\tconst newSize = rows.size;\n\t\tif (oldSize !== newSize) {\n\t\t\tthis.onChange();\n\t\t}\n\t}\n\n\taddAll(rowIndices: number[]): void {\n\t\tif (0 < rowIndices.length) {\n\t\t\tconst rows = this._rows;\n\t\t\tconst parent = this._parent;\n\t\t\tfor (let i = 0, imax = rowIndices.length; i < imax; ++i) {\n\t\t\t\tconst row = parent.get(rowIndices[i]);\n\t\t\t\tif (row) {\n\t\t\t\t\trows.add(row);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.onChange();\n\t\t}\n\t}\n\n\tcontains(rowIndex: number): boolean {\n\t\tconst row = this._parent.get(rowIndex);\n\t\tif (row) {\n\t\t\treturn this._rows.has(row);\n\t\t}\n\t\treturn false;\n\t}\n\n\tremove(rowIndex: number): void {\n\t\tconst row = this._parent.get(rowIndex);\n\t\tif (row) {\n\t\t\tconst rows = this._rows;\n\t\t\tif (rows.has(row)) {\n\t\t\t\trows.delete(row);\n\t\t\t\tthis.onChange();\n\t\t\t}\n\t\t}\n\t}\n\n\tclear(): void {\n\t\tconst rows = this._rows;\n\t\tif (0 < rows.size) {\n\t\t\trows.clear();\n\t\t\tthis.onChange();\n\t\t}\n\t}\n\n\tclearAndAdd(rowIndex: number): void {\n\t\tconst row = this._parent.get(rowIndex);\n\t\tif (row) {\n\t\t\tconst rows = this._rows;\n\t\t\tif (rows.has(row)) {\n\t\t\t\tif (1 < rows.size) {\n\t\t\t\t\trows.clear();\n\t\t\t\t\trows.add(row);\n\t\t\t\t\tthis.onChange();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\trows.clear();\n\t\t\t\trows.add(row);\n\t\t\t\tthis.onChange();\n\t\t\t}\n\t\t}\n\t}\n\n\tclearAndAddAll(rowIndices: number[]): void {\n\t\tconst rows = this._rows;\n\t\tif (0 < rows.size || 0 < rowIndices.length) {\n\t\t\trows.clear();\n\t\t\tconst parent = this._parent;\n\t\t\tfor (let i = 0, imax = rowIndices.length; i < imax; ++i) {\n\t\t\t\tconst row = parent.get(rowIndices[i]);\n\t\t\t\tif (row) {\n\t\t\t\t\trows.add(row);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.onChange();\n\t\t}\n\t}\n\n\tshift(rowIndex: number, amount: number): void {\n\t\t// DO NOTHING\n\t}\n\n\tsize(): number {\n\t\treturn this._rows.size;\n\t}\n\n\tisEmpty(): boolean {\n\t\treturn this._rows.size <= 0;\n\t}\n\n\ttoArray(): Array<[number, NODE]> {\n\t\tconst rows = this._rows;\n\t\tconst result: Array<[number, NODE]> = [];\n\t\tthis._parent.each((row: NODE, index: number): void => {\n\t\t\tif (rows.has(row)) {\n\t\t\t\tresult.push([index, row]);\n\t\t\t}\n\t\t});\n\t\treturn result;\n\t}\n\n\ttoSortedArray(): Array<[number, NODE]> {\n\t\treturn this.toArray().sort(COMPARATOR);\n\t}\n\n\ttoObject(): Record<number, NODE> {\n\t\tconst rows = this._rows;\n\t\tconst result: Record<number, NODE> = {};\n\t\tthis._parent.each((row: NODE, index: number): void => {\n\t\t\tif (rows.has(row)) {\n\t\t\t\tresult[index] = row;\n\t\t\t}\n\t\t});\n\t\treturn result;\n\t}\n\n\ttoMap(): Map<number, NODE> {\n\t\tconst rows = this._rows;\n\t\tconst result = new Map<number, NODE>();\n\t\tthis._parent.each((row: NODE, index: number): void => {\n\t\t\tif (rows.has(row)) {\n\t\t\t\tresult.set(index, row);\n\t\t\t}\n\t\t});\n\t\treturn result;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { utils } from \"pixi.js\";\nimport { DTableDataComparator, DTableDataOrder, DTableDataSorter } from \"./d-table-data-sorter\";\n\nexport class DTableDataTreeSorter<NODE>\n\textends utils.EventEmitter\n\timplements DTableDataSorter<NODE>\n{\n\tconstructor() {\n\t\tsuper();\n\t}\n\n\tget id(): number {\n\t\treturn 0;\n\t}\n\n\tget order(): DTableDataOrder {\n\t\treturn DTableDataOrder.ASCENDING;\n\t}\n\n\tset order(order: DTableDataOrder) {\n\t\t// DO NOTHING\n\t}\n\n\tapply(): void {\n\t\t// DO NOTHING\n\t}\n\n\tunapply(): void {\n\t\t// DO NOTHING\n\t}\n\n\tisApplied(): boolean {\n\t\treturn false;\n\t}\n\n\tget(): DTableDataComparator<NODE> | null {\n\t\treturn null;\n\t}\n\n\tset(comparator: DTableDataComparator<NODE> | null): void {\n\t\t// DO NOTHING\n\t}\n\n\ttoDirty(): void {\n\t\t// DO NOTHING\n\t}\n\n\tupdate(): void {\n\t\t// DO NOTHING\n\t}\n\n\tget indices(): number[] | null {\n\t\treturn null;\n\t}\n\n\tmap(unmappedIndex: number): number | null {\n\t\treturn unmappedIndex;\n\t}\n\n\tunmap(index: number): number {\n\t\treturn index;\n\t}\n}\n","/*\n * Copyright (C) 2021 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { utils } from \"pixi.js\";\nimport { DTableData, DTableDataMapped, DTableDataParent } from \"./d-table-data\";\nimport { DTableDataFilter, DTableDataFilterer } from \"./d-table-data-filter\";\nimport { DTableDataTreeFilter } from \"./d-table-data-tree-filter\";\nimport { DTableDataListMapped } from \"./d-table-data-list-mapped\";\nimport { DTableDataSelection } from \"./d-table-data-selection\";\nimport { DTableDataComparator, DTableDataSorter } from \"./d-table-data-sorter\";\nimport { DTableDataTreeSorter } from \"./d-table-data-tree-sorter\";\nimport { DTableDataTreeNode } from \"./d-table-data-tree-item\";\nimport {\n\tDTableDataTreeItemAccessor,\n\tDTableDataTreeItemAccessorOptions\n} from \"./d-table-data-tree-item-accessor\";\nimport {\n\tDTableDataTreeSelection,\n\tDTableDataTreeSelectionCreator,\n\tDTableDataTreeSelectionOptions\n} from \"./d-table-data-tree-selection\";\nimport { DTableDataTreeSelectionImpl } from \"./d-table-data-tree-selection-impl\";\nimport { isFunction } from \"./util/is-function\";\nimport { DBaseOnOptions } from \"./d-base\";\n\nexport interface DTableDataTreeOptions<NODE, EMITTER = any>\n\textends DTableDataTreeItemAccessorOptions<NODE> {\n\tnodes?: NODE[];\n\n\t/**\n\t * Selection options.\n\t */\n\tselection?:\n\t\t| DTableDataTreeSelection<NODE>\n\t\t| DTableDataTreeSelectionCreator<NODE>\n\t\t| DTableDataTreeSelectionOptions;\n\n\t/**\n\t * A filter.\n\t */\n\tfilter?: DTableDataFilterer<NODE>;\n\n\t/**\n\t * A comparator.\n\t */\n\tcomparator?: DTableDataComparator<NODE>;\n\n\t/**\n\t * True to list up nodes in the given node array in the reverse order.\n\t */\n\treverse?: boolean;\n\n\t/**\n\t * Mappings of event names and event handlers.\n\t */\n\ton?: DBaseOnOptions<EMITTER>;\n}\n\n/**\n * Please note that this data class does not support the sorter.\n */\nexport class DTableDataTree<NODE extends DTableDataTreeNode<NODE, NODE>>\n\textends utils.EventEmitter\n\timplements DTableData<NODE>\n{\n\tprotected _parent: DTableDataParent | null;\n\tprotected _nodes?: NODE[];\n\tprotected _rows: NODE[];\n\tprotected _isRowsDirty: boolean;\n\tprotected _supplimentals: number[];\n\tprotected _flags: WeakMap<NODE, number>;\n\tprotected _filter: DTableDataTreeFilter<NODE>;\n\tprotected _sorter: DTableDataTreeSorter<NODE>;\n\tprotected _selection: DTableDataTreeSelection<NODE>;\n\tprotected _mapped: DTableDataMapped<NODE>;\n\tprotected _accessor: DTableDataTreeItemAccessor<NODE>;\n\tprotected _reverse: boolean;\n\n\tconstructor(options?: DTableDataTreeOptions<NODE>) {\n\t\tsuper();\n\n\t\tthis._parent = null;\n\t\tthis._accessor = this.toAccessor(options);\n\t\tthis._mapped = new DTableDataListMapped<NODE>(this);\n\t\tthis._rows = [];\n\t\tthis._isRowsDirty = false;\n\t\tthis._supplimentals = [];\n\t\tthis._flags = new WeakMap<NODE, number>();\n\t\tthis._reverse = !!options?.reverse;\n\t\tthis._selection = this.toSelection(options?.selection);\n\t\tthis._filter = new DTableDataTreeFilter<NODE>(this);\n\t\tthis._sorter = new DTableDataTreeSorter<NODE>();\n\n\t\tif (options) {\n\t\t\t// Filter\n\t\t\tconst filter = options.filter;\n\t\t\tif (filter) {\n\t\t\t\tthis._filter.set(filter);\n\t\t\t}\n\n\t\t\t// Events\n\t\t\tconst on = options.on;\n\t\t\tif (on) {\n\t\t\t\tfor (const name in on) {\n\t\t\t\t\tconst handler = on[name];\n\t\t\t\t\tif (handler) {\n\t\t\t\t\t\tthis.on(name, handler);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Update rows\n\t\tthis.nodes = options?.nodes;\n\t}\n\n\tprotected toSelection(\n\t\toptions?:\n\t\t\t| DTableDataTreeSelection<NODE>\n\t\t\t| DTableDataTreeSelectionCreator<NODE>\n\t\t\t| DTableDataTreeSelectionOptions\n\t): DTableDataTreeSelection<NODE> {\n\t\tif (options instanceof utils.EventEmitter) {\n\t\t\treturn options;\n\t\t} else if (isFunction(options)) {\n\t\t\treturn options(this);\n\t\t}\n\t\treturn this.newSelection(options);\n\t}\n\n\tprotected newSelection(\n\t\toptions?: DTableDataTreeSelectionOptions\n\t): DTableDataTreeSelection<NODE> {\n\t\treturn new DTableDataTreeSelectionImpl(this, options);\n\t}\n\n\tprotected toAccessor(options?: DTableDataTreeOptions<NODE>): DTableDataTreeItemAccessor<NODE> {\n\t\treturn new DTableDataTreeItemAccessor(options);\n\t}\n\n\tbind(parent: DTableDataParent): void {\n\t\tthis._parent = parent;\n\t}\n\n\tget nodes(): NODE[] | undefined {\n\t\treturn this._nodes;\n\t}\n\n\tset nodes(nodes: NODE[] | undefined) {\n\t\tthis._nodes = nodes;\n\t\tthis._isRowsDirty = true;\n\t\tthis._selection.onNodeChange(nodes);\n\t\tthis._filter.toDirty();\n\t\tthis.update(true);\n\t}\n\n\tget rows(): NODE[] {\n\t\tif (this._isRowsDirty) {\n\t\t\tthis._isRowsDirty = false;\n\t\t\tthis.updateRows(this._nodes);\n\t\t}\n\t\treturn this._rows;\n\t}\n\n\tget supplimentals(): number[] {\n\t\treturn this._supplimentals;\n\t}\n\n\tget accessor(): DTableDataTreeItemAccessor<NODE> {\n\t\treturn this._accessor;\n\t}\n\n\tprotected updateRows(nodes: NODE[] | undefined): void {\n\t\tconst rows = this._rows;\n\t\tconst supplimentals = this._supplimentals;\n\t\tconst flags = this._flags;\n\t\tif (nodes != null) {\n\t\t\tconst irows = this.newRows(\n\t\t\t\tnodes,\n\t\t\t\t0,\n\t\t\t\t0,\n\t\t\t\trows,\n\t\t\t\tsupplimentals,\n\t\t\t\tflags,\n\t\t\t\tthis._reverse,\n\t\t\t\tthis._accessor.toChildren\n\t\t\t);\n\t\t\tif (irows !== rows.length) {\n\t\t\t\trows.length = irows;\n\t\t\t\tsupplimentals.length = irows;\n\t\t\t}\n\t\t} else {\n\t\t\trows.length = 0;\n\t\t\tsupplimentals.length = 0;\n\t\t}\n\t}\n\n\tprotected toSupplimental(ilevel: number, hasChildren: boolean, isOpened: boolean): number {\n\t\treturn (ilevel << 2) | (hasChildren ? 2 : 0) | (isOpened ? 1 : 0);\n\t}\n\n\tprotected newRows(\n\t\tnodes: NODE[],\n\t\tirows: number,\n\t\tilevel: number,\n\t\trows: NODE[],\n\t\tsupplimentals: number[],\n\t\tflags: WeakMap<NODE, number>,\n\t\treverse: boolean,\n\t\ttoChildren: (node: NODE) => NODE[] | null | undefined\n\t): number {\n\t\tconst nodesLength = nodes.length;\n\t\tconst istart = reverse ? nodesLength - 1 : 0;\n\t\tconst idelta = reverse ? -1 : +1;\n\t\tfor (let i = istart; 0 <= i && i < nodesLength; i += idelta) {\n\t\t\tconst node = nodes[i];\n\t\t\tconst children = toChildren(node);\n\t\t\tconst isOpened = flags.has(node);\n\t\t\tconst supplimental = this.toSupplimental(\n\t\t\t\tilevel,\n\t\t\t\t!!(children && 0 < children.length),\n\t\t\t\tisOpened\n\t\t\t);\n\t\t\tif (irows < rows.length) {\n\t\t\t\trows[irows] = node;\n\t\t\t\tsupplimentals[irows] = supplimental;\n\t\t\t} else {\n\t\t\t\trows.push(node);\n\t\t\t\tsupplimentals.push(supplimental);\n\t\t\t}\n\t\t\tirows += 1;\n\n\t\t\tif (isOpened && children) {\n\t\t\t\tirows = this.newRows(\n\t\t\t\t\tchildren,\n\t\t\t\t\tirows,\n\t\t\t\t\tilevel + 1,\n\t\t\t\t\trows,\n\t\t\t\t\tsupplimentals,\n\t\t\t\t\tflags,\n\t\t\t\t\treverse,\n\t\t\t\t\ttoChildren\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\treturn irows;\n\t}\n\n\tupdate(forcibly?: boolean): void {\n\t\tconst parent = this._parent;\n\t\tif (parent) {\n\t\t\tparent.update(forcibly);\n\t\t}\n\t}\n\n\tsize(): number {\n\t\treturn this.rows.length;\n\t}\n\n\tget(index: number): NODE | null {\n\t\tconst rows = this.rows;\n\t\tif (0 <= index && index < rows.length) {\n\t\t\treturn rows[index];\n\t\t}\n\t\treturn null;\n\t}\n\n\topen(node: NODE): void {\n\t\tconst flags = this._flags;\n\t\tif (!flags.has(node)) {\n\t\t\tflags.set(node, 1);\n\t\t\tthis._isRowsDirty = true;\n\t\t\tthis._filter.toDirty();\n\t\t\tthis.update(true);\n\t\t}\n\t}\n\n\tclose(node: NODE): void {\n\t\tconst flags = this._flags;\n\t\tif (flags.has(node)) {\n\t\t\tflags.delete(node);\n\t\t\tthis._isRowsDirty = true;\n\t\t\tthis._filter.toDirty();\n\t\t\tthis.update(true);\n\t\t}\n\t}\n\n\tisOpened(node: NODE): boolean {\n\t\treturn this._flags.has(node);\n\t}\n\n\ttoggle(node: NODE): void {\n\t\tconst flags = this._flags;\n\t\tif (flags.has(node)) {\n\t\t\tflags.delete(node);\n\t\t} else {\n\t\t\tflags.set(node, 1);\n\t\t}\n\t\tthis._isRowsDirty = true;\n\t\tthis._filter.toDirty();\n\t\tthis.update(true);\n\t}\n\n\teach(\n\t\titeratee: (node: NODE, index: number) => boolean | void,\n\t\tifrom?: number,\n\t\tito?: number\n\t): void {\n\t\tconst rows = this.rows;\n\t\tifrom = ifrom != null ? Math.max(0, ifrom) : 0;\n\t\tito = ito != null ? Math.min(rows.length, ito) : rows.length;\n\t\tfor (let i = ifrom; i < ito; ++i) {\n\t\t\tconst row = rows[i];\n\t\t\tif (iteratee(row, i) === false) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tget selection(): DTableDataSelection<NODE> {\n\t\treturn this._selection;\n\t}\n\n\tget filter(): DTableDataFilter<NODE> {\n\t\treturn this._filter;\n\t}\n\n\tget sorter(): DTableDataSorter<NODE> {\n\t\treturn this._sorter;\n\t}\n\n\tget mapped(): DTableDataMapped<NODE> {\n\t\treturn this._mapped;\n\t}\n}\n","import { DTableColumn } from \"./d-table-column\";\nimport { DTableHeaderTable } from \"./d-table-header\";\nimport { DTableHeaderCellHeader } from \"./d-table-header-cell\";\n\nexport interface DTableHeaderCellCheckOptions {\n\tenable?: boolean;\n\tfilterable?: boolean;\n\temittable?: boolean;\n}\n\nexport interface DTableHeaderCellCheckParent<ROW> {\n\treadonly column?: DTableColumn<ROW, unknown>;\n\treadonly columnIndex?: number;\n\treadonly header?: DTableHeaderCellHeader<ROW>;\n}\n\nexport class DTableHeaderCellCheck<ROW> {\n\tprotected _parent: DTableHeaderCellCheckParent<ROW>;\n\tprotected _isEnabled: boolean;\n\tprotected _isFilterable: boolean;\n\tprotected _isEmittable: boolean;\n\n\tconstructor(parent: DTableHeaderCellCheckParent<ROW>, options?: DTableHeaderCellCheckOptions) {\n\t\tthis._parent = parent;\n\t\tthis._isEnabled = options?.enable ?? false;\n\t\tthis._isFilterable = options?.filterable ?? true;\n\t\tthis._isEmittable = options?.emittable ?? true;\n\t}\n\n\tget isEnabled(): boolean {\n\t\treturn this._isEnabled;\n\t}\n\n\tget isFilterable(): boolean {\n\t\treturn this._isFilterable;\n\t}\n\n\tset isFilterable(isFilterable: boolean) {\n\t\tthis._isFilterable = isFilterable;\n\t}\n\n\tget isEmittable(): boolean {\n\t\treturn this._isEmittable;\n\t}\n\n\tset isEmittable(isEmittable: boolean) {\n\t\tthis._isEmittable = isEmittable;\n\t}\n\n\tprotected newIteratee(\n\t\ttable: DTableHeaderTable<ROW>,\n\t\tisChecked: boolean\n\t): ((row: ROW, rowIndex: number) => boolean) | null {\n\t\tconst parent = this._parent;\n\t\tconst column = parent.column;\n\t\tconst columnIndex = parent.columnIndex;\n\t\tif (column != null && columnIndex != null) {\n\t\t\tconst getter = column.getter;\n\t\t\tconst setter = column.setter;\n\t\t\tif (this._isEmittable) {\n\t\t\t\tconst data = table.data;\n\t\t\t\treturn (row: ROW, rowIndex: number): boolean => {\n\t\t\t\t\tif (getter(row, columnIndex) !== isChecked) {\n\t\t\t\t\t\tsetter(row, columnIndex, isChecked);\n\t\t\t\t\t\tdata.emit(\n\t\t\t\t\t\t\t\"change\",\n\t\t\t\t\t\t\tisChecked,\n\t\t\t\t\t\t\t!isChecked,\n\t\t\t\t\t\t\trow,\n\t\t\t\t\t\t\trowIndex,\n\t\t\t\t\t\t\tcolumnIndex,\n\t\t\t\t\t\t\tdata\n\t\t\t\t\t\t);\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t\treturn false;\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\treturn (row: ROW): boolean => {\n\t\t\t\t\tif (getter(row, columnIndex) !== isChecked) {\n\t\t\t\t\t\tsetter(row, columnIndex, isChecked);\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t\treturn false;\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tpublic execute(isChecked: boolean): void {\n\t\tconst table = this._parent.header?.table;\n\t\tif (table) {\n\t\t\tconst iteratee = this.newIteratee(table, isChecked);\n\t\t\tif (iteratee) {\n\t\t\t\tlet isChanged = false;\n\t\t\t\tif (this._isFilterable) {\n\t\t\t\t\ttable.data.mapped.each(\n\t\t\t\t\t\t(\n\t\t\t\t\t\t\trow: ROW,\n\t\t\t\t\t\t\tsupplimental: unknown,\n\t\t\t\t\t\t\tindex: number,\n\t\t\t\t\t\t\tunmappedIndex: number\n\t\t\t\t\t\t): void => {\n\t\t\t\t\t\t\tif (iteratee(row, unmappedIndex)) {\n\t\t\t\t\t\t\t\tisChanged = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\ttable.data.each((row: ROW, index: number): void => {\n\t\t\t\t\t\tif (iteratee(row, index)) {\n\t\t\t\t\t\t\tisChanged = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif (isChanged) {\n\t\t\t\t\ttable.body.update(true);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction, Point } from \"pixi.js\";\nimport InteractionEvent = interaction.InteractionEvent;\nimport { DImage, DImageOptions, DThemeImage } from \"./d-image\";\nimport { DTableState } from \"./d-table-state\";\nimport { DTableColumn } from \"./d-table-column\";\nimport { DTableDataComparator, DTableDataOrder, DTableDataSorter } from \"./d-table-data-sorter\";\nimport { DTableHeaderTable } from \"./d-table-header\";\nimport { DTableHeaderCellCheck, DTableHeaderCellCheckOptions } from \"./d-table-header-cell-check\";\nimport { UtilKeyboardEvent } from \"./util/util-keyboard-event\";\nimport { UtilPointerEvent } from \"./util/util-pointer-event\";\n\nexport interface DTableHeaderCellHeader<ROW> {\n\treadonly table: DTableHeaderTable<ROW> | null;\n}\n\nexport interface DTableHeaderCellOptions<\n\tROW,\n\tTHEME extends DThemeTableHeaderCell = DThemeTableHeaderCell\n> extends DImageOptions<string | null, THEME> {\n\theader?: DTableHeaderCellHeader<ROW>;\n\tcolumn?: DTableColumn<ROW, unknown>;\n\tcolumnIndex?: number;\n\tcheck?: DTableHeaderCellCheckOptions;\n}\n\nexport interface DThemeTableHeaderCell extends DThemeImage<string | null> {}\n\nexport class DTableHeaderCell<\n\tROW,\n\tTHEME extends DThemeTableHeaderCell = DThemeTableHeaderCell,\n\tOPTIONS extends DTableHeaderCellOptions<ROW, THEME> = DTableHeaderCellOptions<ROW, THEME>\n> extends DImage<string | null, THEME, OPTIONS> {\n\tprotected _sorter?: DTableDataSorter<ROW>;\n\tprotected _onSorterChangeBound?: () => void;\n\tprotected _header?: DTableHeaderCellHeader<ROW>;\n\tprotected _column?: DTableColumn<ROW, unknown>;\n\tprotected _columnIndex?: number;\n\tprotected _check!: DTableHeaderCellCheck<ROW>;\n\tprotected _checkWork?: Point;\n\n\tprotected init(options?: OPTIONS): void {\n\t\tif (options != null) {\n\t\t\tthis._header = options.header;\n\t\t\tthis._column = options.column;\n\t\t\tthis._columnIndex = options.columnIndex;\n\t\t\tthis._check = new DTableHeaderCellCheck<ROW>(this, options.check);\n\t\t} else {\n\t\t\tthis._check = new DTableHeaderCellCheck<ROW>(this);\n\t\t}\n\t\tsuper.init(options);\n\t\tthis.initOnClick(options);\n\t}\n\n\tget column(): DTableColumn<ROW, unknown> | undefined {\n\t\treturn this._column;\n\t}\n\n\tget columnIndex(): number | undefined {\n\t\treturn this._columnIndex;\n\t}\n\n\tget header(): DTableHeaderCellHeader<ROW> | undefined {\n\t\treturn this._header;\n\t}\n\n\tget check(): DTableHeaderCellCheck<ROW> {\n\t\treturn this._check;\n\t}\n\n\tprotected initOnClick(options?: OPTIONS): void {\n\t\tconst column = this._column;\n\t\tif (column) {\n\t\t\tconst sortable = column.sorting.enable;\n\t\t\tconst checkable = this._check.isEnabled;\n\t\t\tif (checkable || sortable) {\n\t\t\t\tUtilPointerEvent.onClick(this, (e: InteractionEvent): void => {\n\t\t\t\t\tthis.onClick(e);\n\t\t\t\t});\n\t\t\t\tconst state = this.state;\n\t\t\t\tstate.lock();\n\t\t\t\tstate.set(DTableState.SORTABLE, sortable);\n\t\t\t\tstate.set(DTableState.CHECKABLE, checkable);\n\t\t\t\tstate.unlock();\n\t\t\t}\n\t\t}\n\t}\n\n\tget sorter(): DTableDataSorter<ROW> | null {\n\t\tlet sorter = this._sorter;\n\t\tif (sorter == null) {\n\t\t\tconst header = this._header;\n\t\t\tif (header) {\n\t\t\t\tconst table = header.table;\n\t\t\t\tif (table) {\n\t\t\t\t\tsorter = table.data.sorter;\n\t\t\t\t\tthis._sorter = sorter;\n\t\t\t\t\tthis._onSorterChangeBound =\n\t\t\t\t\t\tthis._onSorterChangeBound ||\n\t\t\t\t\t\t(() => {\n\t\t\t\t\t\t\tthis.onSorterChange();\n\t\t\t\t\t\t});\n\t\t\t\t\tsorter.on(\"change\", this._onSorterChangeBound);\n\t\t\t\t} else {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\t\treturn sorter;\n\t}\n\n\tget comparator(): DTableDataComparator<ROW> | null {\n\t\tconst column = this._column;\n\t\tif (column) {\n\t\t\treturn column.sorting.comparator || null;\n\t\t}\n\t\treturn null;\n\t}\n\n\tprotected onSorterChange(): void {\n\t\tconst comparator = this.comparator;\n\t\tif (comparator) {\n\t\t\tconst sorter = this._sorter;\n\t\t\tif (sorter) {\n\t\t\t\tconst SORTED_ASCENDING = DTableState.SORTED_ASCENDING;\n\t\t\t\tconst SORTED_DESCENDING = DTableState.SORTED_DESCENDING;\n\t\t\t\tif (sorter.isApplied() && sorter.get() === comparator) {\n\t\t\t\t\tif (sorter.order === DTableDataOrder.ASCENDING) {\n\t\t\t\t\t\tthis.state.set(SORTED_ASCENDING, SORTED_DESCENDING);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.state.set(SORTED_DESCENDING, SORTED_ASCENDING);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis.state.removeAll(SORTED_ASCENDING, SORTED_DESCENDING);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected toClickPosition(e: InteractionEvent): number {\n\t\tconst checkWork = this._checkWork || new Point();\n\t\tthis._checkWork = checkWork;\n\t\treturn e.data.getLocalPosition(this, checkWork).x;\n\t}\n\n\tprotected isCheckClicked(e: InteractionEvent): boolean {\n\t\tif (this._check.isEnabled) {\n\t\t\tif (this.isSortable) {\n\t\t\t\tconst image = this._images[1];\n\t\t\t\tif (image && image.image != null) {\n\t\t\t\t\tconst position = this.toClickPosition(e);\n\t\t\t\t\tconst bound = image.bound;\n\t\t\t\t\tconst margin = image.margin.horizontal;\n\t\t\t\t\treturn bound.left - margin <= position && position <= bound.right + margin;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tonClick(e: InteractionEvent): void {\n\t\tif (this.state.isActionable) {\n\t\t\tif (this.isCheckClicked(e)) {\n\t\t\t\tthis.onToggleStart();\n\t\t\t\tthis.onToggleEnd();\n\t\t\t} else {\n\t\t\t\tthis.onActivate(e);\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected onActivate(e?: InteractionEvent | KeyboardEvent | MouseEvent | TouchEvent): void {\n\t\tthis.doSort(e);\n\t\tthis.emit(\"active\", this);\n\t}\n\n\tprotected doSort(e?: InteractionEvent | KeyboardEvent | MouseEvent | TouchEvent): void {\n\t\tif (this.isSortable) {\n\t\t\tconst comparator = this.comparator;\n\t\t\tif (comparator) {\n\t\t\t\tconst sorter = this.sorter;\n\t\t\t\tif (sorter) {\n\t\t\t\t\tif (sorter.get() === comparator) {\n\t\t\t\t\t\tif (sorter.order === DTableDataOrder.ASCENDING) {\n\t\t\t\t\t\t\tsorter.order = DTableDataOrder.DESCENDING;\n\t\t\t\t\t\t\tsorter.apply();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsorter.set(null);\n\t\t\t\t\t\t\tsorter.apply();\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsorter.set(comparator);\n\t\t\t\t\t\tsorter.order = DTableDataOrder.ASCENDING;\n\t\t\t\t\t\tsorter.apply();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tget isSortable(): boolean {\n\t\tconst column = this._column;\n\t\tif (column) {\n\t\t\treturn column.sorting.enable;\n\t\t}\n\t\treturn false;\n\t}\n\n\tget isToggle(): boolean {\n\t\treturn this._check.isEnabled;\n\t}\n\n\ttoggle(): void {\n\t\tif (this.state.isActionable) {\n\t\t\tif (this.isToggle) {\n\t\t\t\tthis.onToggleStart();\n\t\t\t\tthis.onToggleEnd();\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected onToggleStart(): void {\n\t\tthis.state.isActive = !this.state.isActive;\n\t}\n\n\tprotected onToggleEnd(): void {\n\t\tif (this.state.isActive) {\n\t\t\tthis._check.execute(true);\n\t\t\tthis.emit(\"active\", this);\n\t\t} else {\n\t\t\tthis._check.execute(false);\n\t\t\tthis.emit(\"inactive\", this);\n\t\t}\n\t}\n\n\tprotected onActivateKeyDown(e: KeyboardEvent): void {\n\t\tif (this.state.isActionable) {\n\t\t\tif (this.isToggle) {\n\t\t\t\tthis.onToggleStart();\n\t\t\t} else {\n\t\t\t\tthis.state.isPressed = true;\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected onActivateKeyUp(e: KeyboardEvent): void {\n\t\tif (this.state.isActionable) {\n\t\t\tif (this.isToggle) {\n\t\t\t\tthis.onToggleEnd();\n\t\t\t} else {\n\t\t\t\tif (this.state.isPressed) {\n\t\t\t\t\tthis.onActivate(e);\n\t\t\t\t}\n\t\t\t\tthis.state.isPressed = false;\n\t\t\t}\n\t\t}\n\t}\n\n\tonKeyDown(e: KeyboardEvent): boolean {\n\t\tif (UtilKeyboardEvent.isActivateKey(e)) {\n\t\t\tthis.onActivateKeyDown(e);\n\t\t}\n\n\t\treturn super.onKeyDown(e);\n\t}\n\n\tonKeyUp(e: KeyboardEvent): boolean {\n\t\tif (UtilKeyboardEvent.isActivateKey(e)) {\n\t\t\tthis.onActivateKeyUp(e);\n\t\t}\n\n\t\treturn super.onKeyUp(e);\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DTableHeaderCell\";\n\t}\n\n\tdestroy(): void {\n\t\tconst sorter = this._sorter;\n\t\tconst onSorterChangeBound = this._onSorterChangeBound;\n\t\tif (sorter && onSorterChangeBound) {\n\t\t\tsorter.off(\"change\", onSorterChangeBound);\n\t\t}\n\t\tthis._sorter = undefined;\n\t\tthis._onSorterChangeBound = undefined;\n\n\t\tsuper.destroy();\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DBase } from \"./d-base\";\nimport { DTableColumn } from \"./d-table-column\";\nimport { DTableData } from \"./d-table-data\";\nimport { DTableHeaderCell, DTableHeaderCellOptions } from \"./d-table-header-cell\";\nimport { DTableRow, DTableRowOptions, DThemeTableRow } from \"./d-table-row\";\n\nexport interface DTableHeaderTableBody {\n\tupdate(forcibly?: boolean): void;\n}\n\nexport interface DTableHeaderTable<ROW> {\n\treadonly data: DTableData<ROW>;\n\treadonly body: DTableHeaderTableBody;\n}\n\nexport interface DTableHeaderOptions<ROW, THEME extends DThemeTableHeader = DThemeTableHeader>\n\textends DTableRowOptions<ROW, DTableColumn<ROW, unknown>, THEME> {\n\ttable?: DTableHeaderTable<ROW>;\n\toffset?: number;\n\tcell?: DTableHeaderCellOptions<ROW>;\n}\n\nexport interface DThemeTableHeader extends DThemeTableRow {}\n\nexport class DTableHeader<\n\tROW,\n\tTHEME extends DThemeTableHeader = DThemeTableHeader,\n\tOPTIONS extends DTableHeaderOptions<ROW, THEME> = DTableHeaderOptions<ROW, THEME>\n> extends DTableRow<ROW, DTableColumn<ROW, unknown>, THEME, OPTIONS> {\n\tprotected _table: DTableHeaderTable<ROW> | null;\n\tprotected _offset: number;\n\n\tconstructor(options: OPTIONS) {\n\t\tsuper(options);\n\n\t\tthis._table = options.table ?? null;\n\n\t\tconst offset = options.offset ?? 0;\n\t\tthis._offset = offset;\n\t\tthis.transform.position.y = offset;\n\n\t\tthis.initCells(options, this._columns, this._frozen);\n\t}\n\n\tget table(): DTableHeaderTable<ROW> | null {\n\t\treturn this._table;\n\t}\n\n\tprotected onParentMove(newX: number, newY: number, oldX: number, oldY: number): void {\n\t\tsuper.onParentMove(newX, newY, oldX, oldY);\n\t\tthis.transform.position.y = -newY + this._offset;\n\t\tthis.updateFrozenCellPosition(newX);\n\t}\n\n\tprotected getContentPositionX(): number {\n\t\tconst content = this.parent;\n\t\tif (content) {\n\t\t\treturn content.position.x;\n\t\t}\n\t\treturn 0;\n\t}\n\n\tprotected newCell(\n\t\tcolumnIndex: number,\n\t\tcolumn: DTableColumn<ROW, unknown>,\n\t\tcolumns: Array<DTableColumn<ROW, unknown>>,\n\t\toptions: OPTIONS\n\t): DBase {\n\t\treturn new DTableHeaderCell<ROW>(this.toCellOptions(columnIndex, column, options));\n\t}\n\n\tprotected toCellOptions(\n\t\tcolumnIndex: number,\n\t\tcolumn: DTableColumn<ROW, unknown>,\n\t\toptions: OPTIONS\n\t): DTableHeaderCellOptions<ROW> {\n\t\tconst result = column.header || options.cell;\n\t\tif (result != null) {\n\t\t\tif (result.weight === undefined) {\n\t\t\t\tresult.weight = column.weight;\n\t\t\t}\n\t\t\tif (result.width === undefined) {\n\t\t\t\tresult.width = column.width;\n\t\t\t}\n\t\t\tif (result.text === undefined) {\n\t\t\t\tresult.text = {\n\t\t\t\t\tvalue: column.label\n\t\t\t\t};\n\t\t\t} else if (result.text.value === undefined) {\n\t\t\t\tresult.text.value = column.label;\n\t\t\t}\n\t\t\tif (result.header === undefined) {\n\t\t\t\tresult.header = this;\n\t\t\t}\n\t\t\tif (result.column === undefined) {\n\t\t\t\tresult.column = column;\n\t\t\t}\n\t\t\tif (result.columnIndex === undefined) {\n\t\t\t\tresult.columnIndex = columnIndex;\n\t\t\t}\n\t\t\treturn result;\n\t\t} else {\n\t\t\treturn {\n\t\t\t\tweight: column.weight,\n\t\t\t\twidth: column.width,\n\t\t\t\ttext: {\n\t\t\t\t\tvalue: column.label\n\t\t\t\t},\n\t\t\t\theader: this,\n\t\t\t\tcolumn,\n\t\t\t\tcolumnIndex\n\t\t\t};\n\t\t}\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DTableHeader\";\n\t}\n}\n","import { DisplayObject } from \"pixi.js\";\nimport { DPaneScrollBar, DPaneScrollBarParent } from \"./d-pane-scrollbar\";\n\nexport interface DTableScrollBarParent extends DPaneScrollBarParent {\n\tbody: DisplayObject;\n}\n\nexport class DTableScrollBar extends DPaneScrollBar<DTableScrollBarParent> {\n\tprotected getOffsetVerticalStart(size: number): number {\n\t\treturn size * 0.5 + this._parent.body.position.y;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction, Rectangle } from \"pixi.js\";\nimport InteractionEvent = interaction.InteractionEvent;\nimport InteractionManager = interaction.InteractionManager;\nimport { DDialogSelectOptions } from \"../ui/d-dialog-select\";\nimport { DAlignHorizontal } from \"./d-align-horizontal\";\nimport { DApplications } from \"./d-applications\";\nimport { DBase, DBaseOptions } from \"./d-base\";\nimport { DContentOptions } from \"./d-content\";\nimport { DFocusable, DFocusableContainer } from \"./d-controller-focus\";\nimport { DCoordinateSize } from \"./d-coordinate\";\nimport { DDialogSelect } from \"./d-dialog-select\";\nimport { DMenu, DMenuOptions } from \"./d-menu\";\nimport { DPane, DPaneOptions, DThemePane } from \"./d-pane\";\nimport { DTableBody, DTableBodyOptions } from \"./d-table-body\";\nimport { DTableCategory, DTableCategoryColumn, DTableCategoryOptions } from \"./d-table-category\";\nimport {\n\tDTableColumn,\n\tDTableColumnEditing,\n\tDTableColumnOptions,\n\tDTableColumnSelecting,\n\tDTableColumnSelectingDialog,\n\tDTableColumnSelectingOptions,\n\tDTableColumnSorting,\n\tDTableColumnType,\n\tDTableEditable,\n\tDTableGetter,\n\tDTableRenderable,\n\tDTableSetter\n} from \"./d-table-column\";\nimport { DTableData, DTableDataOptions } from \"./d-table-data\";\nimport { DTableDataList, DTableDataListOptions } from \"./d-table-data-list\";\nimport { DTableDataSelectionType } from \"./d-table-data-selection\";\nimport { DTableDataComparatorFunction } from \"./d-table-data-sorter\";\nimport { DTableHeader, DTableHeaderOptions } from \"./d-table-header\";\nimport { DTableRow } from \"./d-table-row\";\nimport { isArray } from \"./util/is-array\";\nimport { isString } from \"./util/is-string\";\nimport { toEnum } from \"./util/to-enum\";\nimport { UtilKeyboardEvent } from \"./util/util-keyboard-event\";\nimport { UtilPointerEvent } from \"./util/util-pointer-event\";\nimport { DTableScrollBar } from \"./d-table-scrollbar\";\nimport { DPaneScrollBarOptions } from \"./d-pane-scrollbar\";\n\nexport interface DTableOptions<\n\tROW,\n\tDATA extends DTableData<ROW> = DTableDataList<ROW>,\n\tTHEME extends DThemeTable = DThemeTable,\n\tCONTENT_OPTIONS extends DBaseOptions = DContentOptions\n> extends DPaneOptions<THEME, CONTENT_OPTIONS> {\n\tcolumns: Array<DTableColumnOptions<ROW>>;\n\tcategory?: DTableCategoryOptions;\n\theader?: DTableHeaderOptions<ROW>;\n\tbody?: DTableBodyOptions<ROW, DATA>;\n\tdata?: ROW[] | DTableDataListOptions<ROW> | DATA;\n}\n\nexport interface DThemeTable extends DThemePane {}\n\nconst defaultGetter = <ROW, CELL>(row: ROW, columnIndex: number): CELL => {\n\treturn (row as any)[columnIndex];\n};\n\nconst defaultSetter = <ROW, CELL>(row: ROW, columnIndex: number, cell: CELL): void => {\n\t(row as any)[columnIndex] = cell;\n};\n\nconst defaultGetterEmpty = <CELL>(): CELL => \"\" as any;\n\nconst defaultSetterEmpty = (): void => {\n\t// DO NOTHING\n};\n\nconst toPathGetter = <ROW, CELL>(path: string[], def?: CELL): DTableGetter<ROW, CELL> => {\n\tif (path.length <= 1) {\n\t\tconst key = path[0];\n\t\tif (def === undefined) {\n\t\t\treturn (row: ROW): CELL => {\n\t\t\t\treturn (row as any)[key];\n\t\t\t};\n\t\t} else {\n\t\t\treturn (row: ROW): CELL => {\n\t\t\t\treturn key in row ? (row as any)[key] : def;\n\t\t\t};\n\t\t}\n\t} else {\n\t\tif (def === undefined) {\n\t\t\treturn (row: ROW): CELL => {\n\t\t\t\tfor (let i = 0, imax = path.length - 1; i < imax; ++i) {\n\t\t\t\t\trow = (row as any)[path[i]];\n\t\t\t\t}\n\t\t\t\treturn (row as any)[path[path.length - 1]];\n\t\t\t};\n\t\t} else {\n\t\t\treturn (row: ROW): CELL => {\n\t\t\t\tfor (let i = 0, imax = path.length - 1; i < imax; ++i) {\n\t\t\t\t\trow = (row as any)[path[i]];\n\t\t\t\t}\n\t\t\t\tconst key = path[path.length - 1];\n\t\t\t\treturn key in row ? (row as any)[key] : def;\n\t\t\t};\n\t\t}\n\t}\n};\n\nconst toPathSetter = <ROW, CELL>(path: string[]): DTableSetter<ROW, CELL> => {\n\tif (path.length <= 1) {\n\t\tconst key = path[0];\n\t\treturn (row: ROW, columnIndex: number, cell: CELL): void => {\n\t\t\t(row as any)[key] = cell;\n\t\t};\n\t} else {\n\t\treturn (row: ROW, columnIndex: number, cell: CELL): void => {\n\t\t\tfor (let i = 0, imax = path.length - 1; i < imax; ++i) {\n\t\t\t\trow = (row as any)[path[i]] || {};\n\t\t\t}\n\t\t\t(row as any)[path[path.length - 1]] = cell;\n\t\t};\n\t}\n};\n\nconst toColumnAlign = <ROW, CELL>(\n\toptions: DTableColumnOptions<ROW, CELL>,\n\ttype: DTableColumnType\n): DAlignHorizontal => {\n\tconst align = options.align;\n\tif (align != null) {\n\t\tif (isString(align)) {\n\t\t\treturn DAlignHorizontal[align];\n\t\t} else {\n\t\t\treturn align;\n\t\t}\n\t}\n\tswitch (type) {\n\t\tcase DTableColumnType.TEXT:\n\t\t\treturn DAlignHorizontal.LEFT;\n\t\tcase DTableColumnType.REAL:\n\t\tcase DTableColumnType.INTEGER:\n\t\t\treturn DAlignHorizontal.RIGHT;\n\t\tcase DTableColumnType.BUTTON:\n\t\tcase DTableColumnType.INDEX:\n\t\tcase DTableColumnType.SELECT:\n\t\tcase DTableColumnType.ACTION:\n\t\tcase DTableColumnType.LINK:\n\t\t\treturn DAlignHorizontal.CENTER;\n\t\tdefault:\n\t\t\treturn DAlignHorizontal.LEFT;\n\t}\n};\n\nconst toColumnDataChecker = <ROW>(path: string[] | null): DTableEditable<ROW> => {\n\tif (path != null) {\n\t\tconst pathLength = path.length;\n\t\tif (pathLength <= 1) {\n\t\t\tconst key = path[0];\n\t\t\treturn (row: ROW): boolean => {\n\t\t\t\treturn key in row;\n\t\t\t};\n\t\t} else {\n\t\t\treturn (row: any): boolean => {\n\t\t\t\tfor (let i = 0; i < pathLength; ++i) {\n\t\t\t\t\tconst part: string = path[i];\n\t\t\t\t\tif (part in row) {\n\t\t\t\t\t\trow = row[part];\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t};\n\t\t}\n\t}\n\treturn (row: any, columnIndex: number): boolean => {\n\t\treturn columnIndex < row.length;\n\t};\n};\n\nconst toColumnEditingEnable = <ROW>(\n\tenable: boolean | DTableEditable<ROW> | \"auto\" | \"AUTO\" | undefined,\n\tpath: string[] | null\n): boolean | DTableEditable<ROW> => {\n\tif (isString(enable)) {\n\t\treturn toColumnDataChecker(path);\n\t} else if (enable != null) {\n\t\treturn enable;\n\t} else {\n\t\treturn false;\n\t}\n};\n\nconst toColumnEditing = <ROW, CELL>(\n\toptions: DTableColumnOptions<ROW, CELL>,\n\tpath: string[] | null\n): DTableColumnEditing<ROW, CELL> => {\n\tconst editing = options.editing;\n\tconst editable = options.editable;\n\tif (editing) {\n\t\treturn {\n\t\t\tenable: toColumnEditingEnable(editing.enable ?? editable, path),\n\t\t\tformatter: editing.formatter,\n\t\t\tunformatter: editing.unformatter,\n\t\t\tvalidator: editing.validator\n\t\t};\n\t}\n\treturn {\n\t\tenable: toColumnEditingEnable(editable, path)\n\t};\n};\n\nconst toComparator = <ROW, CELL>(\n\tgetter: DTableGetter<ROW, CELL>,\n\tindex: number\n): DTableDataComparatorFunction<ROW> => {\n\treturn (rowA: ROW, rowB: ROW): number => {\n\t\tconst valueA = getter(rowA, index) as any;\n\t\tconst valueB = getter(rowB, index) as any;\n\t\treturn valueA < valueB ? -1 : valueB < valueA ? +1 : 0;\n\t};\n};\n\nconst toColumnSorting = <ROW, CELL>(\n\tgetter: DTableGetter<ROW, CELL>,\n\tindex: number,\n\toptions: DTableColumnOptions<ROW, CELL>\n): DTableColumnSorting<ROW> => {\n\tconst sorting = options.sorting;\n\tconst sortable = options.sortable;\n\tif (sorting) {\n\t\tif (sorting.enable || sortable) {\n\t\t\treturn {\n\t\t\t\tenable: true,\n\t\t\t\tcomparator: sorting.comparator || toComparator(getter, index)\n\t\t\t};\n\t\t}\n\t\treturn {\n\t\t\tenable: false\n\t\t};\n\t}\n\tif (sortable) {\n\t\treturn {\n\t\t\tenable: true,\n\t\t\tcomparator: toComparator(getter, index)\n\t\t};\n\t}\n\treturn {\n\t\tenable: false\n\t};\n};\n\nconst toColumnMenu = (\n\toptions?: DMenuOptions<unknown> | DMenu<unknown>\n): DMenu<unknown> | undefined => {\n\tif (options == null) {\n\t\treturn undefined;\n\t} else if (options instanceof DMenu) {\n\t\treturn options;\n\t} else {\n\t\treturn new DMenu(options);\n\t}\n};\n\nconst toColumnDialog = (\n\toptions?: DDialogSelectOptions<unknown> | DTableColumnSelectingDialog<unknown>\n): DTableColumnSelectingDialog<unknown> | undefined => {\n\tif (options == null) {\n\t\treturn undefined;\n\t} else if (\"open\" in options) {\n\t\treturn options;\n\t} else {\n\t\treturn new DDialogSelect(options);\n\t}\n};\n\nconst defaultSelectingGetter = (dialog: DTableColumnSelectingDialog<unknown>): unknown => {\n\treturn dialog.value;\n};\n\nconst defaultSelectingSetter = (): void => {\n\t// DO NOTHING\n};\n\nconst toColumnSelecting = (\n\toptions: DTableColumnSelectingOptions<any, any, any> | undefined\n): DTableColumnSelecting<any, any, any> => {\n\tif (options) {\n\t\treturn {\n\t\t\tgetter: options.getter || defaultSelectingGetter,\n\t\t\tsetter: options.setter || defaultSelectingSetter,\n\t\t\tmenu: toColumnMenu(options.menu),\n\t\t\tmultiple: toColumnMenu(options.multiple),\n\t\t\tdialog: toColumnDialog(options.dialog),\n\t\t\tpromise: options.promise\n\t\t};\n\t}\n\treturn {\n\t\tgetter: defaultSelectingGetter,\n\t\tsetter: defaultSelectingSetter\n\t};\n};\n\nconst toColumnGetter = <ROW, CELL>(\n\toptions: DTableColumnOptions<ROW, CELL>,\n\ttype: DTableColumnType,\n\tparts: string[] | null\n): DTableGetter<ROW, CELL> => {\n\tconst getter = options.getter;\n\tif (getter) {\n\t\treturn getter;\n\t}\n\tswitch (type) {\n\t\tcase DTableColumnType.ACTION:\n\t\tcase DTableColumnType.LINK:\n\t\t\treturn defaultGetterEmpty;\n\t\tdefault:\n\t\t\tif (parts == null) {\n\t\t\t\treturn defaultGetter;\n\t\t\t} else {\n\t\t\t\treturn toPathGetter(parts, options.default);\n\t\t\t}\n\t}\n};\n\nconst toColumnSetter = <ROW, CELL>(\n\toptions: DTableColumnOptions<ROW, CELL>,\n\ttype: DTableColumnType,\n\tpath: string[] | null\n): DTableSetter<ROW, CELL> => {\n\tconst setter = options.setter;\n\tif (setter) {\n\t\treturn setter;\n\t}\n\tswitch (type) {\n\t\tcase DTableColumnType.BUTTON:\n\t\tcase DTableColumnType.ACTION:\n\t\tcase DTableColumnType.LINK:\n\t\t\treturn defaultSetterEmpty;\n\t\tdefault:\n\t\t\tif (path == null) {\n\t\t\t\treturn defaultSetter;\n\t\t\t} else {\n\t\t\t\treturn toPathSetter(path);\n\t\t\t}\n\t}\n};\n\nconst toColumnPath = <ROW, CELL>(options: DTableColumnOptions<ROW, CELL>): string[] | null => {\n\treturn options.path != null ? options.path.split(\".\") : null;\n};\n\nconst toColumnRenderable = <ROW, CELL>(\n\toptions: DTableColumnOptions<ROW, CELL>,\n\tpath: string[] | null\n): boolean | DTableRenderable<ROW> => {\n\tconst renderable = options.renderable;\n\tif (isString(renderable)) {\n\t\treturn toColumnDataChecker(path);\n\t} else if (renderable != null) {\n\t\treturn renderable;\n\t}\n\treturn true;\n};\n\nconst toColumn = <ROW, CELL>(\n\tindex: number,\n\toptions: DTableColumnOptions<ROW, CELL>\n): DTableColumn<ROW, CELL> => {\n\tlet weight = options.weight;\n\tlet width = options.width;\n\tif (weight != null) {\n\t\tif (width != null) {\n\t\t\twidth = undefined;\n\t\t}\n\t} else if (width == null) {\n\t\tweight = 1;\n\t}\n\tconst type = toEnum(options.type ?? DTableColumnType.TEXT, DTableColumnType);\n\tconst align = toColumnAlign(options, type);\n\tconst label = options.label || \"\";\n\tconst path = toColumnPath(options);\n\tconst getter = toColumnGetter(options, type, path);\n\tconst setter = toColumnSetter(options, type, path);\n\treturn {\n\t\tweight,\n\t\twidth,\n\t\ttype,\n\t\tlabel,\n\t\tgetter,\n\t\tsetter,\n\t\tformatter: options.formatter,\n\t\trenderable: toColumnRenderable(options, path),\n\t\talign,\n\n\t\tediting: toColumnEditing(options, path),\n\t\tsorting: toColumnSorting(getter, index, options),\n\n\t\theader: options.header,\n\t\tbody: options.body,\n\n\t\tselecting: toColumnSelecting(options.selecting),\n\n\t\tcategory: options.category,\n\t\tfrozen: options.frozen,\n\t\toffset: 0.0,\n\n\t\tlink: options.link\n\t};\n};\n\nconst toColumns = <ROW, CELL>(\n\toptions: Array<DTableColumnOptions<ROW, CELL>>\n): Array<DTableColumn<ROW, CELL>> => {\n\tconst result = [];\n\tfor (let i = 0, imax = options.length; i < imax; ++i) {\n\t\tresult.push(toColumn(i, options[i]));\n\t}\n\treturn result;\n};\n\nconst toFrozen = <ROW, CELL>(columns: Array<DTableColumn<ROW, CELL>>): number => {\n\tfor (let i = columns.length - 1; 0 <= i; --i) {\n\t\tif (columns[i].frozen === true) {\n\t\t\treturn i + 1;\n\t\t}\n\t}\n\treturn 0;\n};\n\nexport class DTable<\n\tROW,\n\tDATA extends DTableData<ROW> = DTableDataList<ROW>,\n\tTHEME extends DThemeTable = DThemeTable,\n\tCONTENT_OPTIONS extends DBaseOptions = DContentOptions,\n\tOPTIONS extends DTableOptions<ROW, DATA, THEME, CONTENT_OPTIONS> = DTableOptions<\n\t\tROW,\n\t\tDATA,\n\t\tTHEME,\n\t\tCONTENT_OPTIONS\n\t>\n> extends DPane<THEME, CONTENT_OPTIONS, OPTIONS> {\n\tprotected _columns?: Array<DTableColumn<ROW, unknown>>;\n\tprotected _frozen?: number;\n\tprotected _categories?: DTableCategory[];\n\tprotected _headerOffset?: number;\n\tprotected _header?: DTableHeader<ROW> | null;\n\tprotected _bodyOffset?: number;\n\tprotected _body?: DTableBody<ROW, DATA>;\n\n\tconstructor(options?: OPTIONS) {\n\t\tsuper(options);\n\n\t\tconst content = this.content;\n\t\tcontent.setWidth(this.toContentWidth(options));\n\n\t\tconst body = this.body;\n\t\tcontent.addChild(body);\n\t\tif (body.data.selection.type !== DTableDataSelectionType.NONE) {\n\t\t\tUtilPointerEvent.onClick(this, (e: InteractionEvent): void => {\n\t\t\t\tbody.onRowClick(e);\n\t\t\t});\n\t\t}\n\n\t\tconst header = this.header;\n\t\tif (header) {\n\t\t\tcontent.addChild(header);\n\t\t}\n\n\t\tconst categories = this.categories;\n\t\tfor (let i = categories.length - 1; 0 <= i; --i) {\n\t\t\tcontent.addChild(categories[i]);\n\t\t}\n\n\t\tbody.update();\n\t}\n\n\tget columns(): Array<DTableColumn<ROW, unknown>> {\n\t\tlet result = this._columns;\n\t\tif (result == null) {\n\t\t\tconst options = this._options;\n\t\t\tresult = options ? toColumns(options.columns) : [];\n\t\t\tthis._columns = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tget frozen(): number {\n\t\tlet result = this._frozen;\n\t\tif (result == null) {\n\t\t\tresult = toFrozen(this.columns);\n\t\t\tthis._frozen = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tget categories(): DTableCategory[] {\n\t\tlet result = this._categories;\n\t\tif (result == null) {\n\t\t\tresult = this.newCategories(this._options, this.columns, this.frozen);\n\t\t\tthis._categories = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected initContent(content: DBase): void {\n\t\tsuper.initContent(content);\n\t\tcontent.state.isFocusReverse = true;\n\t}\n\n\tprotected onContentChange(): void {\n\t\tsuper.onContentChange();\n\t\tthis.body.update();\n\t}\n\n\tonResize(newWidth: number, newHeight: number, oldWidth: number, oldHeight: number): void {\n\t\tconst scrollbar = this.scrollbar;\n\t\tscrollbar.lock();\n\n\t\tconst body = this.body;\n\t\tbody.lock();\n\t\tsuper.onResize(newWidth, newHeight, oldWidth, oldHeight);\n\t\tbody.update();\n\t\tbody.unlock(true);\n\n\t\tscrollbar.unlock(true);\n\t}\n\n\tprotected getCategoryCount(columns: Array<DTableColumn<ROW, unknown>>): number {\n\t\tlet result = 0;\n\t\tfor (let i = 0, imax = columns.length; i < imax; ++i) {\n\t\t\tconst category = columns[i].category;\n\t\t\tif (category != null) {\n\t\t\t\tconst count = isString(category) ? 1 : category.length;\n\t\t\t\tresult = Math.max(result, count);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected toCategoryLabel(\n\t\tindex: number,\n\t\tcategory: string | string[] | undefined\n\t): string | undefined {\n\t\tif (category) {\n\t\t\tif (isString(category)) {\n\t\t\t\tif (index === 0) {\n\t\t\t\t\treturn category;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (index < category.length) {\n\t\t\t\t\treturn category[index];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprotected isSameCategory(\n\t\tindex: number,\n\t\ta: string | string[] | undefined,\n\t\tb: string | string[] | undefined\n\t): boolean {\n\t\tif (a != null) {\n\t\t\tif (b != null) {\n\t\t\t\tif (isString(a)) {\n\t\t\t\t\tif (isString(b)) {\n\t\t\t\t\t\tif (0 < index) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn a === b;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (0 < index) {\n\t\t\t\t\t\t\treturn b.length <= index;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn b.length === 1 && a === b[0];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (isString(b)) {\n\t\t\t\t\t\tif (0 < index) {\n\t\t\t\t\t\t\treturn a.length <= index;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn a.length === 1 && a[0] === b;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (a.length <= index && b.length <= index) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t} else if (b.length === a.length) {\n\t\t\t\t\t\t\tfor (let i = index, imax = a.length; i < imax; ++i) {\n\t\t\t\t\t\t\t\tif (a[i] !== b[i]) {\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (isString(a)) {\n\t\t\t\t\tif (0 < index) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (a.length <= index) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tif (b != null) {\n\t\t\t\tif (isString(b)) {\n\t\t\t\t\tif (0 < index) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (b.length <= index) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected toCategoryColumns(\n\t\tindex: number,\n\t\tcolumns: Array<DTableColumn<ROW, unknown>>,\n\t\tfrozen: number\n\t): DTableCategoryColumn[] {\n\t\tconst result: DTableCategoryColumn[] = [];\n\t\tlet tcolumn: DTableColumn<ROW, unknown> | null = null;\n\t\tlet ccolumn: DTableCategoryColumn | null = null;\n\t\tfor (let i = 0, imax = columns.length; i < imax; ++i) {\n\t\t\tconst column = columns[i];\n\t\t\tif (\n\t\t\t\ti !== frozen &&\n\t\t\t\tccolumn &&\n\t\t\t\ttcolumn &&\n\t\t\t\tthis.isSameCategory(index, tcolumn.category, column.category)\n\t\t\t) {\n\t\t\t\tif (ccolumn.weight != null && column.weight != null) {\n\t\t\t\t\tccolumn.weight += column.weight;\n\t\t\t\t} else if (ccolumn.width != null && column.width != null) {\n\t\t\t\t\tccolumn.width += column.width;\n\t\t\t\t} else {\n\t\t\t\t\ttcolumn = column;\n\t\t\t\t\tccolumn = {\n\t\t\t\t\t\tlabel: this.toCategoryLabel(index, column.category),\n\t\t\t\t\t\tweight: column.weight,\n\t\t\t\t\t\twidth: column.width,\n\t\t\t\t\t\toffset: 0.0\n\t\t\t\t\t};\n\t\t\t\t\tresult.push(ccolumn);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\ttcolumn = column;\n\t\t\t\tccolumn = {\n\t\t\t\t\tlabel: this.toCategoryLabel(index, column.category),\n\t\t\t\t\tweight: column.weight,\n\t\t\t\t\twidth: column.width,\n\t\t\t\t\toffset: 0.0\n\t\t\t\t};\n\t\t\t\tresult.push(ccolumn);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected toCategoryOptions(\n\t\tindex: number,\n\t\toptions: DTableCategoryOptions | undefined,\n\t\tcolumns: Array<DTableColumn<ROW, unknown>>,\n\t\tfrozen: number,\n\t\toffset: number\n\t): DTableCategoryOptions {\n\t\tif (options) {\n\t\t\tif (options.columns === undefined) {\n\t\t\t\toptions.columns = this.toCategoryColumns(index, columns, frozen);\n\t\t\t}\n\t\t\tif (options.frozen == null) {\n\t\t\t\toptions.frozen = frozen;\n\t\t\t}\n\t\t\tif (options.offset == null) {\n\t\t\t\toptions.offset = offset;\n\t\t\t}\n\t\t\treturn options;\n\t\t}\n\t\treturn {\n\t\t\tcolumns: this.toCategoryColumns(index, columns, frozen),\n\t\t\tfrozen,\n\t\t\toffset\n\t\t};\n\t}\n\n\tprotected newCategories(\n\t\toptions: OPTIONS | undefined,\n\t\tcolumns: Array<DTableColumn<ROW, unknown>>,\n\t\tfrozen: number\n\t): DTableCategory[] {\n\t\tconst count = this.getCategoryCount(columns);\n\t\tconst result: DTableCategory[] = [];\n\t\tlet offset: number = 0;\n\t\tfor (let i = count - 1; 0 <= i; --i) {\n\t\t\tconst category = new DTableCategory(\n\t\t\t\tthis.toCategoryOptions(i, options?.category, columns, frozen, offset)\n\t\t\t);\n\t\t\tresult.push(category);\n\t\t\toffset += category.height;\n\t\t}\n\t\treturn result;\n\t}\n\n\tonDblClick(e: MouseEvent | TouchEvent, interactionManager: InteractionManager): boolean {\n\t\tconst result = this.body.onDblClick(e, interactionManager);\n\t\treturn super.onDblClick(e, interactionManager) || result;\n\t}\n\n\tprotected newScrollBar(options?: DPaneScrollBarOptions): DTableScrollBar {\n\t\treturn new DTableScrollBar(this, options, (isRegionVisible: boolean): void => {\n\t\t\tthis.onScrollBarUpdate(isRegionVisible);\n\t\t});\n\t}\n\n\tprotected toContentWidth(options?: OPTIONS): DCoordinateSize {\n\t\tlet columnWidthTotal = 0;\n\t\tconst columns = options?.columns;\n\t\tif (columns) {\n\t\t\tfor (let i = 0, imax = columns.length; i < imax; ++i) {\n\t\t\t\tconst column = columns[i];\n\t\t\t\tconst columnWidth = column.width;\n\t\t\t\tif (columnWidth != null) {\n\t\t\t\t\tcolumnWidthTotal += columnWidth;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (0 < columnWidthTotal) {\n\t\t\treturn (p: number): number => {\n\t\t\t\treturn Math.max(p, columnWidthTotal);\n\t\t\t};\n\t\t}\n\t\treturn \"100%\";\n\t}\n\n\tget headerOffset(): number {\n\t\tlet result = this._headerOffset;\n\t\tif (result == null) {\n\t\t\tresult = this.newHeaderOffset();\n\t\t\tthis._headerOffset = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected newHeaderOffset(): number {\n\t\tlet result = 0;\n\t\tconst categories = this.categories;\n\t\tfor (let i = 0, imax = categories.length; i < imax; ++i) {\n\t\t\tresult += categories[i].height;\n\t\t}\n\t\treturn result;\n\t}\n\n\tget header(): DTableHeader<ROW> | null {\n\t\tlet result = this._header;\n\t\tif (result === undefined) {\n\t\t\tresult = this.newHeader(this._options, this.columns, this.frozen, this.headerOffset);\n\t\t\tthis._header = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected hasHeader(options?: OPTIONS): boolean {\n\t\tif (options) {\n\t\t\tconst columns = options.columns;\n\t\t\tfor (let i = 0, imax = columns.length; i < imax; ++i) {\n\t\t\t\tif (columns[i].label != null) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tprotected newHeader(\n\t\toptions: OPTIONS | undefined,\n\t\tcolumns: Array<DTableColumn<ROW, unknown>>,\n\t\tfrozen: number,\n\t\toffset: number\n\t): DTableHeader<ROW> | null {\n\t\tif (this.hasHeader(options)) {\n\t\t\treturn new DTableHeader<ROW>(\n\t\t\t\tthis.toHeaderOptions(options?.header, columns, frozen, offset)\n\t\t\t);\n\t\t}\n\t\treturn null;\n\t}\n\n\tprotected toHeaderOptions(\n\t\toptions: DTableHeaderOptions<ROW> | undefined,\n\t\tcolumns: Array<DTableColumn<ROW, unknown>>,\n\t\tfrozen: number,\n\t\toffset: number\n\t): DTableHeaderOptions<ROW> {\n\t\tif (options) {\n\t\t\tif (options.columns === undefined) {\n\t\t\t\toptions.columns = columns;\n\t\t\t}\n\t\t\tif (options.frozen == null) {\n\t\t\t\toptions.frozen = frozen;\n\t\t\t}\n\t\t\tif (options.offset === undefined) {\n\t\t\t\toptions.offset = offset;\n\t\t\t}\n\t\t\tif (options.table === undefined) {\n\t\t\t\toptions.table = this;\n\t\t\t}\n\t\t\treturn options;\n\t\t}\n\t\treturn {\n\t\t\tcolumns,\n\t\t\tfrozen,\n\t\t\toffset,\n\t\t\ttable: this\n\t\t};\n\t}\n\n\tget bodyOffset(): number {\n\t\tlet result = this._bodyOffset;\n\t\tif (result == null) {\n\t\t\tresult = this.newBodyOffset();\n\t\t\tthis._bodyOffset = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected newBodyOffset(): number {\n\t\treturn this.headerOffset + (this.header?.height ?? 0);\n\t}\n\n\tget body(): DTableBody<ROW, DATA> {\n\t\tlet result = this._body;\n\t\tif (result == null) {\n\t\t\tresult = this.newBody(this._options, this.columns, this.frozen, this.bodyOffset);\n\t\t\tthis._body = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected newBody(\n\t\toptions: OPTIONS | undefined,\n\t\tcolumns: Array<DTableColumn<ROW, unknown>>,\n\t\tfrozen: number,\n\t\toffset: number\n\t): DTableBody<ROW, DATA> {\n\t\treturn new DTableBody<ROW, DATA>(\n\t\t\tthis.toBodyOptions(options?.body, columns, frozen, offset, options?.data)\n\t\t);\n\t}\n\n\tprotected toBodyOptions(\n\t\toptions: DTableBodyOptions<ROW, DATA> | undefined,\n\t\tcolumns: Array<DTableColumn<ROW, unknown>>,\n\t\tfrozen: number,\n\t\toffset: number,\n\t\tdata: ROW[] | DTableDataOptions<ROW> | DATA | undefined\n\t): DTableBodyOptions<ROW, DATA> {\n\t\tif (options != null) {\n\t\t\tif (options.columns === undefined) {\n\t\t\t\toptions.columns = columns;\n\t\t\t}\n\t\t\tif (options.frozen == null) {\n\t\t\t\toptions.frozen = frozen;\n\t\t\t}\n\t\t\tif (options.offset === undefined) {\n\t\t\t\toptions.offset = offset;\n\t\t\t}\n\t\t\tif (options.data === undefined && data !== undefined) {\n\t\t\t\tif (isArray(data)) {\n\t\t\t\t\toptions.data = {\n\t\t\t\t\t\trows: data\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\toptions.data = data;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (options.height === undefined && options.weight === undefined) {\n\t\t\t\toptions.weight = 1;\n\t\t\t}\n\t\t\treturn options;\n\t\t}\n\t\tif (isArray(data)) {\n\t\t\treturn {\n\t\t\t\tcolumns,\n\t\t\t\tfrozen,\n\t\t\t\toffset,\n\t\t\t\tdata: {\n\t\t\t\t\trows: data\n\t\t\t\t},\n\t\t\t\tweight: 1\n\t\t\t};\n\t\t} else {\n\t\t\treturn {\n\t\t\t\tcolumns,\n\t\t\t\tfrozen,\n\t\t\t\toffset,\n\t\t\t\tdata,\n\t\t\t\tweight: 1\n\t\t\t};\n\t\t}\n\t}\n\n\tget data(): DATA {\n\t\treturn this.body.data;\n\t}\n\n\tprotected getFocusedChildClippingRect(\n\t\tfocused: DBase,\n\t\tcontentX: number,\n\t\tcontentY: number,\n\t\tcontentWidth: number,\n\t\tcontentHeight: number,\n\t\twidth: number,\n\t\theight: number,\n\t\tresult: Rectangle\n\t): Rectangle {\n\t\tsuper.getFocusedChildClippingRect(\n\t\t\tfocused,\n\t\t\tcontentX,\n\t\t\tcontentY,\n\t\t\tcontentWidth,\n\t\t\tcontentHeight,\n\t\t\twidth,\n\t\t\theight,\n\t\t\tresult\n\t\t);\n\n\t\tconst cell = this.toCell(focused);\n\t\tif (cell) {\n\t\t\t// X\n\t\t\tconst dx = contentX + this.toFrozenCellX(cell) - result.x;\n\t\t\tif (0 < dx) {\n\t\t\t\tresult.x += dx;\n\t\t\t\tresult.width -= dx;\n\t\t\t}\n\n\t\t\t// Y\n\t\t\tif (cell.parent.parent === this.body) {\n\t\t\t\tconst dy = this.bodyOffset;\n\t\t\t\tresult.y += dy;\n\t\t\t\tresult.height -= dy;\n\t\t\t}\n\t\t}\n\n\t\t// Done\n\t\treturn result;\n\t}\n\n\tprotected toFrozenCellX(cell: DBase): number {\n\t\tconst frozen = this.frozen;\n\t\tif (0 < frozen) {\n\t\t\tconst cells = cell.parent.children as DBase[];\n\t\t\tconst cellIndex = cells.indexOf(cell);\n\t\t\tif (0 <= cellIndex) {\n\t\t\t\tconst cellsLength = cells.length;\n\t\t\t\tconst columnIndex = cellsLength - 1 - cellIndex;\n\t\t\t\tif (frozen <= columnIndex) {\n\t\t\t\t\tconst cellFrozen = cells[cellsLength - frozen];\n\t\t\t\t\treturn cellFrozen.position.x + cellFrozen.width;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn 0;\n\t}\n\n\tonKeyDown(e: KeyboardEvent): boolean {\n\t\tUtilKeyboardEvent.moveFocusHorizontally(e, this);\n\t\tconst isArrowUpKey = UtilKeyboardEvent.isArrowUpKey(e);\n\t\tconst isArrowDownKey = UtilKeyboardEvent.isArrowDownKey(e);\n\t\tif (isArrowUpKey || isArrowDownKey) {\n\t\t\tthis.onKeyDownArrowUpOrDown(e, isArrowDownKey);\n\t\t}\n\t\treturn super.onKeyDown(e);\n\t}\n\n\tprotected onKeyDownArrowUpOrDown(e: KeyboardEvent, isDown: boolean): boolean {\n\t\tconst layer = DApplications.getLayer(this);\n\t\tif (layer == null) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst focusController = layer.getFocusController();\n\t\tconst oldFocusable = focusController.get();\n\t\tif (oldFocusable == null) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst oldCell = this.toCell(oldFocusable);\n\t\tif (oldCell == null) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst oldRow = oldCell.parent;\n\t\tif (oldRow == null) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst newRowChild = focusController.find(oldRow, false, false, isDown, this);\n\t\tif (newRowChild == null) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst newCellSibling = this.toCell(newRowChild);\n\t\tif (newCellSibling == null) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst newRow = newCellSibling.parent;\n\t\tif (newRow == null) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst oldCellIndex = oldRow.children.indexOf(oldCell);\n\t\tif (oldCellIndex < 0) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst newCell = newRow.children[oldCellIndex];\n\t\tif (newCell == null || newCell === oldCell || !(\"state\" in newCell)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst newFocusable = focusController.find(newCell, true, true, isDown, this);\n\t\tif (newFocusable == null) {\n\t\t\treturn false;\n\t\t}\n\n\t\tfocusController.focus(newFocusable);\n\t\treturn true;\n\t}\n\n\tprotected toCell(focused: DFocusable): DBase | null {\n\t\tlet current: DFocusable | DFocusableContainer | null = focused;\n\t\twhile (current != null) {\n\t\t\tconst parent: DFocusableContainer | null = current.parent;\n\t\t\tif (parent instanceof DTableRow) {\n\t\t\t\tif (current instanceof DBase) {\n\t\t\t\t\treturn current;\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tcurrent = parent;\n\t\t}\n\t\treturn null;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DTable\";\n\t}\n}\n","/*\n * Copyright (C) 2021 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DisplayObject, Texture } from \"pixi.js\";\nimport { DTreeNode } from \"./d-tree-node\";\nimport { DTreeNodeAccessor, DTreeNodeAccessorOptions } from \"./d-tree-node-accessor\";\nimport { isString } from \"./util/is-string\";\n\nconst toLabel = (item: any): string | undefined => {\n\tconst text = item.text;\n\tif (isString(text)) {\n\t\treturn text;\n\t}\n\tconst label = item.label;\n\tif (isString(label)) {\n\t\treturn label;\n\t}\n\tconst name = item.name;\n\tif (isString(name)) {\n\t\treturn name;\n\t}\n\treturn undefined;\n};\n\nconst toTitle = (item: any): string | undefined => {\n\tconst title = item.title;\n\tif (isString(title)) {\n\t\treturn title;\n\t}\n\treturn undefined;\n};\n\nconst toImage = (item: any): DisplayObject | Texture | null | undefined => {\n\treturn item.image;\n};\n\nconst toChildren = <NODE extends DTreeNode>(item: any): NODE[] | null | undefined => {\n\treturn item.children;\n};\n\nconst newChildren = <NODE extends DTreeNode>(item: any): NODE[] | null | undefined => {\n\treturn (item.children = []);\n};\n\nexport class DTreeNodeAccessorImpl<NODE extends DTreeNode> implements DTreeNodeAccessor<NODE> {\n\ttoLabel: (item: NODE) => string | undefined;\n\ttoTitle: (item: NODE) => string | undefined;\n\ttoImage: (item: NODE) => DisplayObject | Texture | null | undefined;\n\ttoChildren: (item: NODE) => NODE[] | null | undefined;\n\tnewChildren: (item: NODE) => NODE[] | null | undefined;\n\n\tconstructor(options?: DTreeNodeAccessorOptions<NODE>) {\n\t\tthis.toLabel = options?.toLabel ?? toLabel;\n\t\tthis.toTitle = options?.toTitle ?? toTitle;\n\t\tthis.toImage = options?.toImage ?? toImage;\n\t\tthis.toChildren = options?.toChildren ?? toChildren;\n\t\tthis.newChildren = options?.newChildren ?? newChildren;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { utils } from \"pixi.js\";\nimport { DOnOptions } from \"./d-on-options\";\nimport { DTreeNode } from \"./d-tree-node\";\n\nexport const DTreeDataSelectionType = {\n\tNONE: 0,\n\tSINGLE: 1,\n\tMULTIPLE: 2\n} as const;\n\nexport type DTreeDataSelectionType =\n\ttypeof DTreeDataSelectionType[keyof typeof DTreeDataSelectionType];\n\n/**\n * {@link DListSelection} events.\n */\nexport interface DTreeDataSelectionEvents<EMITTER> {\n\t/**\n\t * Triggered when a selection is changed.\n\t *\n\t * @param emitter an emitter\n\t */\n\tchange(emitter: EMITTER): void;\n}\n\n/**\n * {@link DListSelection} \"on\" options.\n */\nexport interface DTreeDataSelectionOnOptions<EMITTER>\n\textends Partial<DTreeDataSelectionEvents<EMITTER>>,\n\t\tDOnOptions {}\n\n/**\n * {@link DListSelection} options.\n */\nexport interface DTreeDataSelectionOptions<ITEM, EMITTER = any> {\n\t/**\n\t * A type.\n\t */\n\ttype?: DTreeDataSelectionType | keyof typeof DTreeDataSelectionType;\n\n\t/**\n\t * Mappings of event names and handlers.\n\t */\n\ton?: DTreeDataSelectionOnOptions<EMITTER>;\n}\n\nexport interface DTreeDataSelection<NODE extends DTreeNode> extends utils.EventEmitter {\n\t/**\n\t * A type.\n\t */\n\treadonly type: DTreeDataSelectionType;\n\n\t/**\n\t * A first selected node or null.\n\t */\n\treadonly first: NODE | null;\n\n\t/**\n\t * A last selected node or null.\n\t */\n\treadonly last: NODE | null;\n\n\t/**\n\t * Returns a node at the given index or null.\n\t *\n\t * @param index an index\n\t * @returns a node at the given index or null\n\t */\n\tget(index: number): NODE | null;\n\n\t/**\n\t * Adds the given node\n\t *\n\t * @param target a node\n\t * @return true if succeeded.\n\t */\n\tadd(target: NODE): boolean;\n\n\t/**\n\t * Removes the given node.\n\t *\n\t * @param target a node\n\t * @return true if succeeded\n\t */\n\tremove(target: NODE): boolean;\n\n\t/**\n\t * Toggles the given node.\n\t *\n\t * @param target a node\n\t * @return true if succeeded.\n\t */\n\ttoggle(target: NODE): boolean;\n\n\t/**\n\t * Clears all the nodes.\n\t */\n\tclear(): boolean;\n\n\t/**\n\t * Clears all the exisint nodes and adds the given node.\n\t *\n\t * @param target a node to be added\n\t * @returns true if the selection is changed\n\t */\n\tclearAndAdd(target: NODE): boolean;\n\n\t/**\n\t * Clears the exising nodes and add all the given nodes.\n\t *\n\t * @param targets nodes to be added\n\t * @returns true if the selection is changed\n\t */\n\tclearAndAddAll(targets: NODE[]): boolean;\n\n\t/**\n\t * Returns true if the given node is selected.\n\t *\n\t * @param target a node to be checked\n\t * @returns true if the given node is selected\n\t */\n\tcontains(target: NODE): boolean;\n\n\t/**\n\t * Returns the number of selected nodes.\n\t *\n\t * @returns the number of selected nodes\n\t */\n\tsize(): number;\n\n\t/**\n\t * Returns true if the selection is empty.\n\t *\n\t * @returns true if the selection is empty\n\t */\n\tisEmpty(): boolean;\n\n\t/**\n\t * Iterates over selected nodes.\n\t *\n\t * @param iteratee an iteratee\n\t */\n\teach(iteratee: (node: NODE) => boolean | void): void;\n\n\t/**\n\t * Returns an array of selected nodes.\n\t *\n\t * @return an array of selected nodes.\n\t */\n\ttoArray(): NODE[];\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DTreeDataMapped } from \"./d-tree-data-mapped\";\nimport { DTreeNodeAccessor } from \"./d-tree-node-accessor\";\n\nexport interface DTreeDataMppedImplParent<NODE> {\n\treadonly nodes: NODE[];\n\treadonly accessor: DTreeNodeAccessor<NODE>;\n\tisExpanded(node: NODE): boolean;\n}\n\nexport class DTreeDataMappedImpl<NODE> implements DTreeDataMapped<NODE> {\n\tprotected readonly _parent: DTreeDataMppedImplParent<NODE>;\n\tprotected readonly _nodes: NODE[];\n\tprotected readonly _levels: number[];\n\tprotected readonly _reverse: boolean;\n\tprotected _isDirty: boolean;\n\n\tconstructor(parent: DTreeDataMppedImplParent<NODE>, reverse: boolean) {\n\t\tthis._parent = parent;\n\t\tthis._nodes = [];\n\t\tthis._levels = [];\n\t\tthis._reverse = reverse;\n\t\tthis._isDirty = false;\n\t}\n\n\tget nodes(): NODE[] {\n\t\tthis.update();\n\t\treturn this._nodes;\n\t}\n\n\tget levels(): number[] {\n\t\tthis.update();\n\t\treturn this._levels;\n\t}\n\n\ttoDirty(): void {\n\t\tthis._isDirty = true;\n\t}\n\n\tsize(): number {\n\t\tthis.update();\n\t\treturn this._nodes.length;\n\t}\n\n\teach(\n\t\titeratee: (value: NODE, index: number) => boolean | void,\n\t\tfrom?: number,\n\t\tto?: number\n\t): void {\n\t\tthis.update();\n\t\tconst nodes = this._nodes;\n\t\tconst ifrom = from != null ? Math.max(0, from) : 0;\n\t\tconst ito = to != null ? Math.min(nodes.length, to) : nodes.length;\n\t\tfor (let i = ifrom; i < ito; ++i) {\n\t\t\tif (iteratee(nodes[i], i) === false) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected update(): void {\n\t\tif (this._isDirty) {\n\t\t\tthis._isDirty = false;\n\n\t\t\tconst parent = this._parent;\n\t\t\tconst parentNodes = parent.nodes;\n\t\t\tconst toChildren = parent.accessor.toChildren;\n\t\t\tconst nodes = this._nodes;\n\t\t\tconst levels = this._levels;\n\t\t\tconst size = this.newNodes(\n\t\t\t\tparent,\n\t\t\t\tparentNodes,\n\t\t\t\t0,\n\t\t\t\t0,\n\t\t\t\tnodes,\n\t\t\t\tlevels,\n\t\t\t\tthis._reverse,\n\t\t\t\ttoChildren\n\t\t\t);\n\t\t\tif (nodes.length !== size) {\n\t\t\t\tnodes.length = size;\n\t\t\t\tlevels.length = size;\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected newNodes(\n\t\tparent: DTreeDataMppedImplParent<NODE>,\n\t\tparentNodes: NODE[],\n\t\tindex: number,\n\t\tlevel: number,\n\t\tnodes: NODE[],\n\t\tlevels: number[],\n\t\treverse: boolean,\n\t\ttoChildren: (node: NODE) => NODE[] | null | undefined\n\t): number {\n\t\tconst parentNodesLength = parentNodes.length;\n\t\tconst istart = reverse ? parentNodesLength - 1 : 0;\n\t\tconst idelta = reverse ? -1 : +1;\n\t\tfor (let i = istart; 0 <= i && i < parentNodesLength; i += idelta) {\n\t\t\tconst parentNode = parentNodes[i];\n\t\t\tif (index < nodes.length) {\n\t\t\t\tnodes[index] = parentNode;\n\t\t\t\tlevels[index] = level;\n\t\t\t} else {\n\t\t\t\tnodes.push(parentNode);\n\t\t\t\tlevels.push(level);\n\t\t\t}\n\t\t\tindex += 1;\n\t\t\tconst children = toChildren(parentNode);\n\t\t\tif (children && parent.isExpanded(parentNode)) {\n\t\t\t\tindex = this.newNodes(\n\t\t\t\t\tparent,\n\t\t\t\t\tchildren,\n\t\t\t\t\tindex,\n\t\t\t\t\tlevel + 1,\n\t\t\t\t\tnodes,\n\t\t\t\t\tlevels,\n\t\t\t\t\treverse,\n\t\t\t\t\ttoChildren\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\treturn index;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { utils } from \"pixi.js\";\nimport { DTreeNode } from \"./d-tree-node\";\nimport { DTreeDataSelectionParent } from \"./d-tree-data-selection-parent\";\nimport {\n\tDTreeDataSelection,\n\tDTreeDataSelectionOptions,\n\tDTreeDataSelectionType\n} from \"./d-tree-data-selection\";\n\nexport class DTreeDataSelectionMultiple<NODE extends DTreeNode>\n\textends utils.EventEmitter\n\timplements DTreeDataSelection<NODE>\n{\n\tprotected _parent: DTreeDataSelectionParent<NODE>;\n\tprotected _nodes: Set<NODE>;\n\n\tconstructor(parent: DTreeDataSelectionParent<NODE>, options?: DTreeDataSelectionOptions<NODE>) {\n\t\tsuper();\n\t\tthis._parent = parent;\n\t\tthis._nodes = new Set<NODE>();\n\n\t\t// Events\n\t\tconst on = options?.on;\n\t\tif (on) {\n\t\t\tfor (const name in on) {\n\t\t\t\tconst handler = on[name];\n\t\t\t\tif (handler) {\n\t\t\t\t\tthis.on(name, handler);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tget type(): DTreeDataSelectionType {\n\t\treturn DTreeDataSelectionType.MULTIPLE;\n\t}\n\n\tget first(): NODE | null {\n\t\tconst nodes = this._nodes;\n\t\tif (0 < nodes.size) {\n\t\t\tlet result: NODE | null = null;\n\t\t\tnodes.forEach((item: NODE): void => {\n\t\t\t\tif (result == null) {\n\t\t\t\t\tresult = item;\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn result;\n\t\t}\n\t\treturn null;\n\t}\n\n\tget last(): NODE | null {\n\t\tconst nodes = this._nodes;\n\t\tif (0 < nodes.size) {\n\t\t\tlet result: NODE | null = null;\n\t\t\tnodes.forEach((row: NODE): void => {\n\t\t\t\tresult = row;\n\t\t\t});\n\t\t\treturn result;\n\t\t}\n\t\treturn null;\n\t}\n\n\tget(index: number): NODE | null {\n\t\tconst nodes = this._nodes;\n\t\tif (0 <= index && index < nodes.size) {\n\t\t\tlet counter = 0;\n\t\t\tlet result: NODE | null = null;\n\t\t\tnodes.forEach((node): void => {\n\t\t\t\tif (counter === index) {\n\t\t\t\t\tresult = node;\n\t\t\t\t}\n\t\t\t\tcounter += 1;\n\t\t\t});\n\t\t\treturn result;\n\t\t}\n\t\treturn null;\n\t}\n\n\tadd(target: NODE): boolean {\n\t\tconst nodes = this._nodes;\n\t\tif (!nodes.has(target)) {\n\t\t\tnodes.add(target);\n\t\t\tthis.onChange();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tremove(target: NODE): boolean {\n\t\tconst nodes = this._nodes;\n\t\tif (nodes.has(target)) {\n\t\t\tnodes.delete(target);\n\t\t\tthis.onChange();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\ttoggle(target: NODE): boolean {\n\t\tconst nodes = this._nodes;\n\t\tif (nodes.has(target)) {\n\t\t\tnodes.delete(target);\n\t\t} else {\n\t\t\tnodes.add(target);\n\t\t}\n\t\tthis.onChange();\n\t\treturn true;\n\t}\n\n\tclear(): boolean {\n\t\tconst nodes = this._nodes;\n\t\tif (0 < nodes.size) {\n\t\t\tnodes.clear();\n\t\t\tthis.onChange();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tclearAndAdd(target: NODE): boolean {\n\t\tconst nodes = this._nodes;\n\t\tconst size = nodes.size;\n\t\tif (size === 1) {\n\t\t\tif (nodes.has(target)) {\n\t\t\t\treturn false;\n\t\t\t} else {\n\t\t\t\tnodes.clear();\n\t\t\t\tnodes.add(target);\n\t\t\t\tthis.onChange();\n\t\t\t\treturn true;\n\t\t\t}\n\t\t} else {\n\t\t\tnodes.clear();\n\t\t\tnodes.add(target);\n\t\t\tthis.onChange();\n\t\t\treturn true;\n\t\t}\n\t}\n\n\tclearAndAddAll(targets: NODE[]): boolean {\n\t\tlet isDirty = false;\n\t\tconst newNodes = new Set<NODE>();\n\t\tconst oldNodes = this._nodes;\n\t\tfor (let i = 0, imax = targets.length; i < imax; ++i) {\n\t\t\tconst target = targets[i];\n\t\t\tif (!oldNodes.has(target)) {\n\t\t\t\tisDirty = true;\n\t\t\t}\n\t\t\tnewNodes.add(target);\n\t\t}\n\t\tif (!isDirty) {\n\t\t\toldNodes.forEach((oldItem): void => {\n\t\t\t\tif (!newNodes.has(oldItem)) {\n\t\t\t\t\tisDirty = true;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tif (isDirty) {\n\t\t\tthis._nodes = newNodes;\n\t\t\tthis.onChange();\n\t\t}\n\t\treturn isDirty;\n\t}\n\n\tcontains(target: NODE): boolean {\n\t\treturn this._nodes.has(target);\n\t}\n\n\tsize(): number {\n\t\treturn this._nodes.size;\n\t}\n\n\tisEmpty(): boolean {\n\t\treturn this._nodes.size <= 0;\n\t}\n\n\teach(iteratee: (node: NODE) => boolean | void): void {\n\t\tlet isCanceled = false;\n\t\tthis._nodes.forEach((item): void => {\n\t\t\tif (!isCanceled) {\n\t\t\t\tif (iteratee(item) === false) {\n\t\t\t\t\tisCanceled = true;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\ttoArray(): NODE[] {\n\t\tconst result: NODE[] = [];\n\t\tthis._nodes.forEach((item): void => {\n\t\t\tresult.push(item);\n\t\t});\n\t\treturn result;\n\t}\n\n\tprotected onChange(): void {\n\t\tthis._parent.update();\n\t\tthis.emit(\"change\", this);\n\t}\n\n\tonNodeChange(nodes: NODE[]): void {\n\t\tconst oldNodes = this._nodes;\n\t\tconst newNodes = this.newNodes(nodes, oldNodes, new Set<NODE>());\n\t\tif (oldNodes.size !== newNodes.size) {\n\t\t\tthis._nodes = newNodes;\n\t\t\tthis.onChange();\n\t\t}\n\t}\n\n\tprotected newNodes(items: NODE[], existing: Set<NODE>, result: Set<NODE>): Set<NODE> {\n\t\tconst toChildren = this._parent.accessor.toChildren;\n\t\tfor (let i = 0, imax = items.length; i < imax; ++i) {\n\t\t\tconst item = items[i];\n\t\t\tif (existing.has(item)) {\n\t\t\t\tresult.add(item);\n\t\t\t}\n\t\t\tconst children = toChildren(item);\n\t\t\tif (children) {\n\t\t\t\tthis.newNodes(children, existing, result);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { utils } from \"pixi.js\";\nimport { DTreeNode } from \"./d-tree-node\";\nimport { DTreeDataSelectionParent } from \"./d-tree-data-selection-parent\";\nimport {\n\tDTreeDataSelection,\n\tDTreeDataSelectionOptions,\n\tDTreeDataSelectionType\n} from \"./d-tree-data-selection\";\n\nexport class DTreeDataSelectionSingle<NODE extends DTreeNode>\n\textends utils.EventEmitter\n\timplements DTreeDataSelection<NODE>\n{\n\tprotected _parent: DTreeDataSelectionParent<NODE>;\n\tprotected _node: NODE | null;\n\n\tconstructor(parent: DTreeDataSelectionParent<NODE>, options?: DTreeDataSelectionOptions<NODE>) {\n\t\tsuper();\n\t\tthis._parent = parent;\n\t\tthis._node = null;\n\n\t\t// Events\n\t\tconst on = options?.on;\n\t\tif (on) {\n\t\t\tfor (const name in on) {\n\t\t\t\tconst handler = on[name];\n\t\t\t\tif (handler) {\n\t\t\t\t\tthis.on(name, handler);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tget type(): DTreeDataSelectionType {\n\t\treturn DTreeDataSelectionType.SINGLE;\n\t}\n\n\tget first(): NODE | null {\n\t\treturn this._node;\n\t}\n\n\tget last(): NODE | null {\n\t\treturn this._node;\n\t}\n\n\tget(index: number): NODE | null {\n\t\tif (index === 0) {\n\t\t\treturn this._node;\n\t\t}\n\t\treturn null;\n\t}\n\n\tadd(target: NODE): boolean {\n\t\tif (this._node !== target) {\n\t\t\tthis._node = target;\n\t\t\tthis.onChange();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tremove(target: NODE): boolean {\n\t\tif (this._node === target) {\n\t\t\tthis._node = null;\n\t\t\tthis.onChange();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\ttoggle(target: NODE): boolean {\n\t\tif (this._node === target) {\n\t\t\tthis._node = null;\n\t\t} else {\n\t\t\tthis._node = target;\n\t\t}\n\t\tthis.onChange();\n\t\treturn true;\n\t}\n\n\tclear(): boolean {\n\t\tif (this._node != null) {\n\t\t\tthis._node = null;\n\t\t\tthis.onChange();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tclearAndAdd(target: NODE): boolean {\n\t\tif (this._node === target) {\n\t\t\treturn false;\n\t\t} else {\n\t\t\tthis._node = target;\n\t\t\tthis.onChange();\n\t\t\treturn true;\n\t\t}\n\t}\n\n\tclearAndAddAll(targets: NODE[]): boolean {\n\t\tif (0 < targets.length) {\n\t\t\tconst last = targets[targets.length - 1];\n\t\t\treturn this.clearAndAdd(last);\n\t\t} else {\n\t\t\treturn this.clear();\n\t\t}\n\t}\n\n\tcontains(target: NODE): boolean {\n\t\treturn this._node === target;\n\t}\n\n\tsize(): number {\n\t\treturn this._node != null ? 1 : 0;\n\t}\n\n\tisEmpty(): boolean {\n\t\treturn this._node == null;\n\t}\n\n\teach(iteratee: (node: NODE) => boolean | void): void {\n\t\tconst node = this._node;\n\t\tif (node != null) {\n\t\t\titeratee(node);\n\t\t}\n\t}\n\n\ttoArray(): NODE[] {\n\t\tconst node = this._node;\n\t\tif (node != null) {\n\t\t\treturn [node];\n\t\t}\n\t\treturn [];\n\t}\n\n\tprotected onChange(): void {\n\t\tthis._parent.update();\n\t\tthis.emit(\"change\", this);\n\t}\n\n\tonNodeChange(nodes: NODE[]): void {\n\t\tconst oldNode = this._node;\n\t\tconst newNode = this.newNode(nodes, oldNode);\n\t\tif (oldNode !== newNode) {\n\t\t\tthis._node = newNode;\n\t\t\tthis.onChange();\n\t\t}\n\t}\n\n\tprotected newNode(items: NODE[], existing: NODE | null): NODE | null {\n\t\tconst toChildren = this._parent.accessor.toChildren;\n\t\tfor (let i = 0, imax = items.length; i < imax; ++i) {\n\t\t\tconst item = items[i];\n\t\t\tif (existing === item) {\n\t\t\t\treturn item;\n\t\t\t}\n\t\t\tconst children = toChildren(item);\n\t\t\tif (children) {\n\t\t\t\tconst result = this.newNode(children, existing);\n\t\t\t\tif (result != null) {\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { utils } from \"pixi.js\";\nimport { DTreeNode } from \"./d-tree-node\";\nimport { DTreeDataSelectionParent } from \"./d-tree-data-selection-parent\";\nimport {\n\tDTreeDataSelection,\n\tDTreeDataSelectionOptions,\n\tDTreeDataSelectionType\n} from \"./d-tree-data-selection\";\n\nexport class DTreeDataSelectionNone<NODE extends DTreeNode>\n\textends utils.EventEmitter\n\timplements DTreeDataSelection<NODE>\n{\n\tprotected _parent: DTreeDataSelectionParent<NODE>;\n\n\tconstructor(parent: DTreeDataSelectionParent<NODE>, options?: DTreeDataSelectionOptions<NODE>) {\n\t\tsuper();\n\t\tthis._parent = parent;\n\n\t\t// Events\n\t\tconst on = options?.on;\n\t\tif (on) {\n\t\t\tfor (const name in on) {\n\t\t\t\tconst handler = on[name];\n\t\t\t\tif (handler) {\n\t\t\t\t\tthis.on(name, handler);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tget type(): DTreeDataSelectionType {\n\t\treturn DTreeDataSelectionType.NONE;\n\t}\n\n\tget first(): NODE | null {\n\t\treturn null;\n\t}\n\n\tget last(): NODE | null {\n\t\treturn null;\n\t}\n\n\tget(index: number): NODE | null {\n\t\treturn null;\n\t}\n\n\tadd(target: NODE): boolean {\n\t\treturn false;\n\t}\n\n\tremove(target: NODE): boolean {\n\t\treturn false;\n\t}\n\n\ttoggle(target: NODE): boolean {\n\t\treturn false;\n\t}\n\n\tclear(): boolean {\n\t\treturn false;\n\t}\n\n\tclearAndAdd(target: NODE): boolean {\n\t\treturn false;\n\t}\n\n\tclearAndAddAll(targets: NODE[]): boolean {\n\t\treturn false;\n\t}\n\n\tcontains(target: NODE): boolean {\n\t\treturn false;\n\t}\n\n\tsize(): number {\n\t\treturn 0;\n\t}\n\n\tisEmpty(): boolean {\n\t\treturn true;\n\t}\n\n\teach(iteratee: (node: NODE) => boolean | void): void {\n\t\t// DO NOTHING\n\t}\n\n\ttoArray(): NODE[] {\n\t\treturn [];\n\t}\n\n\tonNodeChange(nodes: NODE[]): void {\n\t\t// DO NOTHING\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DTreeData, DTreeDataOptions } from \"./d-tree-data\";\nimport { DTreeNode } from \"./d-tree-node\";\nimport { DTreeNodeAccessor } from \"./d-tree-node-accessor\";\nimport { DTreeNodeAccessorImpl } from \"./d-tree-node-accessor-impl\";\nimport { DTreeNodeIteratee } from \"./d-tree-node-iteratee\";\nimport { DTreeDataSelection, DTreeDataSelectionType } from \"./d-tree-data-selection\";\nimport { DTreeDataMapped } from \"./d-tree-data-mapped\";\nimport { DTreeDataMappedImpl } from \"./d-tree-data-mapped-impl\";\nimport { DTreeDataSelectionMultiple } from \"./d-tree-data-selection-multiple\";\nimport { DTreeDataSelectionSingle } from \"./d-tree-data-selection-single\";\nimport { DTreeDataSelectionNone } from \"./d-tree-data-selection-none\";\n\nexport interface DTreeDataImplParent {\n\tupdate(): void;\n}\n\nexport interface DTreeDataImplSelection<NODE extends DTreeNode> extends DTreeDataSelection<NODE> {\n\tonNodeChange(nodes: NODE[]): void;\n}\n\nexport class DTreeDataImpl<NODE extends DTreeNode> implements DTreeData<NODE> {\n\tprotected _parent: DTreeDataImplParent;\n\tprotected _nodeToFlag: WeakMap<NODE, number>;\n\tprotected _selection: DTreeDataImplSelection<NODE>;\n\tprotected _nodes: NODE[];\n\tprotected _accessor: DTreeNodeAccessor<NODE>;\n\tprotected _mapped: DTreeDataMapped<NODE>;\n\n\tconstructor(parent: DTreeDataImplParent, options?: DTreeDataOptions<NODE>) {\n\t\tthis._parent = parent;\n\t\tthis._nodeToFlag = new WeakMap<NODE, number>();\n\t\tthis._selection = this.toSelection(options);\n\t\tthis._accessor = new DTreeNodeAccessorImpl(options);\n\t\tconst mapped = new DTreeDataMappedImpl<NODE>(this, !!options?.reverse);\n\t\tthis._mapped = mapped;\n\n\t\tconst nodes = options?.nodes;\n\t\tif (nodes != null) {\n\t\t\tthis._nodes = nodes;\n\t\t\tmapped.toDirty();\n\t\t} else {\n\t\t\tthis._nodes = [];\n\t\t}\n\t}\n\n\tprotected toSelection(options?: DTreeDataOptions<NODE>): DTreeDataImplSelection<NODE> {\n\t\tconst selection = options?.selection;\n\t\tswitch (selection?.type) {\n\t\t\tcase DTreeDataSelectionType.NONE:\n\t\t\tcase \"NONE\":\n\t\t\t\treturn new DTreeDataSelectionNone<NODE>(this, selection);\n\t\t\tcase DTreeDataSelectionType.MULTIPLE:\n\t\t\tcase \"MULTIPLE\":\n\t\t\t\treturn new DTreeDataSelectionMultiple<NODE>(this, selection);\n\t\t\tdefault:\n\t\t\t\treturn new DTreeDataSelectionSingle<NODE>(this, selection);\n\t\t}\n\t}\n\n\tget nodes(): NODE[] {\n\t\treturn this._nodes;\n\t}\n\n\tset nodes(nodes: NODE[]) {\n\t\tthis._nodes = nodes;\n\t\tthis._mapped.toDirty();\n\t\tthis._selection.onNodeChange(nodes);\n\t\tthis.update();\n\t}\n\n\tget mapped(): DTreeDataMapped<NODE> {\n\t\treturn this._mapped;\n\t}\n\n\tget accessor(): DTreeNodeAccessor<NODE> {\n\t\treturn this._accessor;\n\t}\n\n\tget selection(): DTreeDataSelection<NODE> {\n\t\treturn this._selection;\n\t}\n\n\tupdate(): void {\n\t\tthis._parent.update();\n\t}\n\n\ttoggle(target: NODE): boolean {\n\t\tconst nodeToFlag = this._nodeToFlag;\n\t\tif (nodeToFlag.has(target)) {\n\t\t\tnodeToFlag.delete(target);\n\t\t} else {\n\t\t\tnodeToFlag.set(target, 1);\n\t\t}\n\t\tthis._mapped.toDirty();\n\t\tthis.update();\n\t\treturn true;\n\t}\n\n\texpand(target: NODE): boolean {\n\t\tconst nodeToFlag = this._nodeToFlag;\n\t\tif (!nodeToFlag.has(target)) {\n\t\t\tnodeToFlag.set(target, 1);\n\t\t\tthis._mapped.toDirty();\n\t\t\tthis.update();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tcollapse(target: NODE): boolean {\n\t\tconst nodeToFlag = this._nodeToFlag;\n\t\tif (nodeToFlag.has(target)) {\n\t\t\tnodeToFlag.delete(target);\n\t\t\tthis._mapped.toDirty();\n\t\t\tthis.update();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\texpandAll(): boolean {\n\t\tlet isDirty = false;\n\t\tconst nodeToFlag = this._nodeToFlag;\n\t\tthis.each((node): void => {\n\t\t\tif (!nodeToFlag.has(node)) {\n\t\t\t\tnodeToFlag.set(node, 1);\n\t\t\t\tisDirty = true;\n\t\t\t}\n\t\t});\n\t\tif (isDirty) {\n\t\t\tthis._mapped.toDirty();\n\t\t\tthis.update();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tcollapseAll(): boolean {\n\t\tlet isDirty = false;\n\t\tconst nodeToFlag = this._nodeToFlag;\n\t\tthis.each((node): void => {\n\t\t\tif (nodeToFlag.has(node)) {\n\t\t\t\tnodeToFlag.delete(node);\n\t\t\t\tisDirty = true;\n\t\t\t}\n\t\t});\n\t\tif (isDirty) {\n\t\t\tthis._mapped.toDirty();\n\t\t\tthis.update();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tisCollapsed(target: NODE): boolean {\n\t\treturn !this.isExpanded(target);\n\t}\n\n\tisExpanded(target: NODE): boolean {\n\t\treturn this._nodeToFlag.has(target);\n\t}\n\n\tclear(): boolean {\n\t\tconst nodes = this._nodes;\n\t\tif (0 < nodes.length) {\n\t\t\tnodes.length = 0;\n\t\t\tthis._mapped.toDirty();\n\t\t\tthis._selection.clear();\n\t\t\tthis.update();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tremove(target: NODE): boolean {\n\t\tlet isDirty = false;\n\t\tthis.each((node, index, nodes): boolean => {\n\t\t\tif (node === target) {\n\t\t\t\tnodes.splice(index, 1);\n\t\t\t\tisDirty = true;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t});\n\t\tif (isDirty) {\n\t\t\tthis._mapped.toDirty();\n\t\t\tthis._selection.remove(target);\n\t\t\tthis.update();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tadd(target: NODE, parent?: NODE): boolean {\n\t\tlet isDirty = false;\n\t\tif (parent) {\n\t\t\tconst accessor = this._accessor;\n\t\t\tconst children = accessor.toChildren(parent);\n\t\t\tif (children) {\n\t\t\t\tchildren.push(target);\n\t\t\t\tisDirty = true;\n\t\t\t} else {\n\t\t\t\tconst newChildren = accessor.newChildren(parent);\n\t\t\t\tif (newChildren) {\n\t\t\t\t\tnewChildren.push(target);\n\t\t\t\t\tisDirty = true;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tconst nodes = this._nodes;\n\t\t\tif (nodes) {\n\t\t\t\tnodes.push(target);\n\t\t\t} else {\n\t\t\t\tthis._nodes = [target];\n\t\t\t}\n\t\t\tisDirty = true;\n\t\t}\n\t\tif (isDirty) {\n\t\t\tthis._mapped.toDirty();\n\t\t\tthis.update();\n\t\t}\n\t\treturn true;\n\t}\n\n\taddBefore(target: NODE, sibling: NODE): boolean {\n\t\tlet isDirty = false;\n\t\tthis.each((node, index, nodes): boolean => {\n\t\t\tif (node === sibling) {\n\t\t\t\tnodes.splice(index, 0, target);\n\t\t\t\tisDirty = true;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t});\n\t\tif (isDirty) {\n\t\t\tthis._mapped.toDirty();\n\t\t\tthis.update();\n\t\t}\n\t\treturn isDirty;\n\t}\n\n\taddAfter(target: NODE, sibling: NODE): boolean {\n\t\tlet isDirty = false;\n\t\tthis.each((node, index, nodes): boolean => {\n\t\t\tif (node === sibling) {\n\t\t\t\tnodes.splice(index + 1, 0, target);\n\t\t\t\tisDirty = true;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t});\n\t\tif (isDirty) {\n\t\t\tthis._mapped.toDirty();\n\t\t\tthis.update();\n\t\t}\n\t\treturn isDirty;\n\t}\n\n\teach(iteratee: DTreeNodeIteratee<NODE>): void {\n\t\tconst value = this._nodes;\n\t\tif (value) {\n\t\t\tthis.each_(value, null, iteratee);\n\t\t}\n\t}\n\n\tprotected each_(nodes: NODE[], parent: NODE | null, iteratee: DTreeNodeIteratee<NODE>): void {\n\t\tconst toChildren = this._accessor.toChildren;\n\t\tfor (let i = 0, imax = nodes.length; i < imax; ++i) {\n\t\t\tconst node = nodes[i];\n\t\t\tif (iteratee(node, i, nodes, parent) === false) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst children = toChildren(node);\n\t\t\tif (children) {\n\t\t\t\tthis.each_(children, node, iteratee);\n\t\t\t}\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Tree item states.\n */\nexport const DTreeItemState = {\n\t/**\n\t * A node has children.\n\t */\n\tHAS_CHILDREN: \"HAS_CHILDREN\",\n\n\t/**\n\t * A node is opened.\n\t */\n\tOPENED: \"OPENED\"\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction } from \"pixi.js\";\nimport { DBasePaddingAdjustable } from \"./d-base-padding-adjustable\";\nimport { DBaseState } from \"./d-base-state\";\nimport { DImageBase, DImageBaseEvents, DImageBaseOptions, DThemeImageBase } from \"./d-image-base\";\nimport { DOnOptions } from \"./d-on-options\";\nimport { DTreeData } from \"./d-tree-data\";\nimport { DTreeDataSelectionType } from \"./d-tree-data-selection\";\nimport { DTreeItem } from \"./d-tree-item\";\nimport { DTreeItemState } from \"./d-tree-item-state\";\nimport { DTreeNode } from \"./d-tree-node\";\nimport { UtilKeyboardEvent } from \"./util/util-keyboard-event\";\n\n/**\n * {@link DTreeItemText} events.\n */\nexport interface DTreeItemTextEvents<NODE, EMITTER> extends DImageBaseEvents<NODE, EMITTER> {\n\t/**\n\t * Triggered when a node is set.\n\t *\n\t *     on( \"set\", ( node, index, emitter ) => {} )\n\t *\n\t * @param emitter an emitter\n\t */\n\tset(node: NODE, index: number, emitter: EMITTER): void;\n\n\t/**\n\t * Triggered when set to undefined.\n\t *\n\t *     on( \"unset\", ( emitter ) => {} )\n\t *\n\t * @param emitter an emitter\n\t */\n\tunset(emitter: EMITTER): void;\n}\n\n/**\n * {@link DTreeItemText} \"on\" options.\n */\nexport interface DTreeItemTextOnOptions<NODE, EMITTER>\n\textends Partial<DTreeItemTextEvents<NODE, EMITTER>>,\n\t\tDOnOptions {}\n\n/**\n * {@link DTreeItemText} options.\n */\nexport interface DTreeItemTextOptions<\n\tNODE extends DTreeNode = DTreeNode,\n\tTHEME extends DThemeTreeItemText = DThemeTreeItemText,\n\tEMITTER = any\n> extends DImageBaseOptions<string, THEME> {\n\ton?: DTreeItemTextOnOptions<NODE, EMITTER>;\n}\n\nexport interface DThemeTreeItemText extends DThemeImageBase<string> {\n\tgetLevelPadding(level: number): number;\n}\n\nexport class DTreeItemText<\n\t\tNODE extends DTreeNode = DTreeNode,\n\t\tTHEME extends DThemeTreeItemText = DThemeTreeItemText,\n\t\tOPTIONS extends DTreeItemTextOptions<NODE, THEME> = DTreeItemTextOptions<NODE, THEME>\n\t>\n\textends DImageBase<string, THEME, OPTIONS>\n\timplements DTreeItem<NODE>\n{\n\tprotected _padding!: DBasePaddingAdjustable;\n\tprotected _data: DTreeData<NODE>;\n\tprotected _node?: NODE;\n\tprotected _index?: number;\n\n\tconstructor(data: DTreeData<NODE>, options?: OPTIONS) {\n\t\tsuper(options);\n\t\tthis._padding = new DBasePaddingAdjustable(this._padding);\n\t\tthis._data = data;\n\t}\n\n\tget node(): NODE | undefined {\n\t\treturn this._node;\n\t}\n\n\tget value(): NODE | undefined {\n\t\treturn this._node;\n\t}\n\n\tget index(): number | undefined {\n\t\treturn this._index;\n\t}\n\n\tget data(): DTreeData<NODE> {\n\t\treturn this._data;\n\t}\n\n\ttoggle(): void {\n\t\tconst node = this._node;\n\t\tif (node !== undefined) {\n\t\t\tthis._data.toggle(node);\n\t\t}\n\t}\n\n\tset(node: NODE, index: number, forcibly?: boolean): void {\n\t\tconst data = this._data;\n\t\tconst isNodeChanged = forcibly || this._node !== node;\n\t\tif (isNodeChanged) {\n\t\t\tthis._node = node;\n\t\t\tthis._index = index;\n\n\t\t\tconst accessor = data.accessor;\n\t\t\tthis.text = accessor.toLabel(node);\n\t\t\tthis.title = accessor.toTitle(node) ?? \"\";\n\t\t\tthis.image = accessor.toImage(node);\n\t\t}\n\n\t\tconst level = data.mapped.levels[index];\n\t\tthis._padding.adjLeft(this.theme.getLevelPadding(level));\n\n\t\tconst children = data.accessor.toChildren(node);\n\t\tconst hasChildren = !!(children && 0 < children.length);\n\t\tconst state = this.state;\n\t\tstate.lock();\n\t\tstate.set(DBaseState.ACTIVE, data.selection.contains(node));\n\t\tstate.remove(DBaseState.DISABLED);\n\t\tstate.set(DTreeItemState.HAS_CHILDREN, hasChildren);\n\t\tstate.set(DTreeItemState.OPENED, data.isExpanded(node));\n\t\tstate.unlock();\n\n\t\tif (isNodeChanged) {\n\t\t\tthis.emit(\"set\", node, index, this);\n\t\t}\n\t}\n\n\tunset(): void {\n\t\tif (this._node !== undefined) {\n\t\t\tthis._node = undefined;\n\t\t\tthis._index = undefined;\n\n\t\t\tthis.text = undefined;\n\t\t\tthis.title = \"\";\n\t\t\tthis.image = undefined;\n\n\t\t\tconst state = this.state;\n\t\t\tstate.lock();\n\t\t\tstate.add(DBaseState.DISABLED);\n\t\t\tstate.remove(DBaseState.ACTIVE);\n\t\t\tstate.unlock();\n\n\t\t\tthis.emit(\"unset\", this);\n\t\t}\n\t}\n\n\tprotected onSelect(\n\t\te: interaction.InteractionEvent | KeyboardEvent | MouseEvent | TouchEvent | undefined,\n\t\tvalue: NODE\n\t): void {\n\t\tconst data = this._data;\n\t\tconst selection = data.selection;\n\t\tif (selection.type !== DTreeDataSelectionType.MULTIPLE) {\n\t\t\tselection.clearAndAdd(value);\n\t\t} else {\n\t\t\tconst originalEvent = e && \"data\" in e ? e.data.originalEvent : e;\n\t\t\tif (originalEvent?.ctrlKey) {\n\t\t\t\tselection.toggle(value);\n\t\t\t} else if (originalEvent?.shiftKey) {\n\t\t\t\tconst mapped = data.mapped;\n\t\t\t\tconst last = selection.last;\n\t\t\t\tif (value === last) {\n\t\t\t\t\tselection.clearAndAdd(value);\n\t\t\t\t} else {\n\t\t\t\t\tlet isFound = false;\n\t\t\t\t\tlet isReverse = false;\n\t\t\t\t\tconst newSelection: NODE[] = [];\n\t\t\t\t\tmapped.each((node): boolean | void => {\n\t\t\t\t\t\tif (isFound) {\n\t\t\t\t\t\t\tif (isReverse) {\n\t\t\t\t\t\t\t\tnewSelection.unshift(node);\n\t\t\t\t\t\t\t\tif (node === value) {\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tnewSelection.push(node);\n\t\t\t\t\t\t\t\tif (node === last) {\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (node === value) {\n\t\t\t\t\t\t\t\tisFound = true;\n\t\t\t\t\t\t\t\tisReverse = false;\n\t\t\t\t\t\t\t\tnewSelection.push(node);\n\t\t\t\t\t\t\t} else if (node === last) {\n\t\t\t\t\t\t\t\tisFound = true;\n\t\t\t\t\t\t\t\tisReverse = true;\n\t\t\t\t\t\t\t\tnewSelection.push(node);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tselection.clearAndAddAll(newSelection);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tselection.clearAndAdd(value);\n\t\t\t}\n\t\t}\n\t}\n\n\tonKeyDown(e: KeyboardEvent): boolean {\n\t\tif (UtilKeyboardEvent.isActivateKey(e)) {\n\t\t\tthis.onKeyDownActivate(e);\n\t\t}\n\t\tif (UtilKeyboardEvent.isArrowRightKey(e)) {\n\t\t\tconst node = this._node;\n\t\t\tif (node !== undefined) {\n\t\t\t\tif (this.state.is(DTreeItemState.HAS_CHILDREN)) {\n\t\t\t\t\tthis._data.expand(node);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (UtilKeyboardEvent.isArrowLeftKey(e)) {\n\t\t\tconst node = this._node;\n\t\t\tif (node !== undefined) {\n\t\t\t\tif (this.state.is(DTreeItemState.HAS_CHILDREN)) {\n\t\t\t\t\tthis._data.collapse(node);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn super.onKeyDown(e);\n\t}\n\n\tprotected onKeyDownActivate(e: KeyboardEvent): boolean {\n\t\tif (this.state.isActionable && this.state.isFocused) {\n\t\t\tconst node = this._node;\n\t\t\tif (node !== undefined) {\n\t\t\t\tthis.onSelect(e, node);\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DTreeItemText\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction } from \"pixi.js\";\nimport { DButtonBaseWhen } from \"./d-button-base-when\";\nimport { DTreeData } from \"./d-tree-data\";\nimport { DThemeTreeItemText, DTreeItemText, DTreeItemTextOptions } from \"./d-tree-item-text\";\nimport { DTreeNode } from \"./d-tree-node\";\nimport { toEnum } from \"./util/to-enum\";\nimport { UtilKeyboardEvent } from \"./util/util-keyboard-event\";\nimport { UtilPointerEvent } from \"./util/util-pointer-event\";\n\nexport interface DTreeItemButtonOptions<\n\tNODE extends DTreeNode,\n\tTHEME extends DThemeTreeItemButton = DThemeTreeItemButton,\n\tEMITTER = any\n> extends DTreeItemTextOptions<NODE, THEME, EMITTER> {\n\twhen?: DButtonBaseWhen | keyof typeof DButtonBaseWhen;\n}\n\nexport interface DThemeTreeItemButton extends DThemeTreeItemText {}\n\nexport class DTreeItemButton<\n\tNODE extends DTreeNode = DTreeNode,\n\tTHEME extends DThemeTreeItemButton = DThemeTreeItemButton,\n\tOPTIONS extends DTreeItemButtonOptions<NODE, THEME> = DTreeItemButtonOptions<NODE, THEME>\n> extends DTreeItemText<NODE, THEME, OPTIONS> {\n\tprotected _when: DButtonBaseWhen;\n\n\tconstructor(data: DTreeData<NODE>, options?: OPTIONS) {\n\t\tsuper(data, options);\n\n\t\tconst when = toEnum(options?.when ?? DButtonBaseWhen.CLICKED, DButtonBaseWhen);\n\t\tthis._when = when;\n\t\tthis.initOnClick(when, this.theme, options);\n\t}\n\n\tprotected initOnClick(when: DButtonBaseWhen, theme: THEME, options?: OPTIONS): void {\n\t\tUtilPointerEvent.onClick(this, (e: interaction.InteractionEvent): void => {\n\t\t\tif (when === DButtonBaseWhen.CLICKED) {\n\t\t\t\tthis.onClick(e);\n\t\t\t}\n\t\t});\n\t}\n\n\tonClick(e?: interaction.InteractionEvent | KeyboardEvent | MouseEvent | TouchEvent): void {\n\t\tif (this.state.isActionable) {\n\t\t\tthis.onActivate(e);\n\t\t}\n\t}\n\n\tonDblClick(\n\t\te: MouseEvent | TouchEvent,\n\t\tinteractionManager: interaction.InteractionManager\n\t): boolean {\n\t\tif (this._when === DButtonBaseWhen.DOUBLE_CLICKED) {\n\t\t\tthis.onClick(e);\n\t\t}\n\t\treturn super.onDblClick(e, interactionManager);\n\t}\n\n\tprotected onActivate(\n\t\te?: interaction.InteractionEvent | KeyboardEvent | MouseEvent | TouchEvent\n\t): void {\n\t\tthis.emit(\"active\", this);\n\t}\n\n\tprotected onActivateKeyDown(e: KeyboardEvent): void {\n\t\tif (this.state.isActionable) {\n\t\t\tthis.state.isPressed = true;\n\t\t}\n\t}\n\n\tprotected onActivateKeyUp(e: KeyboardEvent): void {\n\t\tif (this.state.isActionable) {\n\t\t\tif (this.state.isPressed) {\n\t\t\t\tthis.onActivate(e);\n\t\t\t}\n\t\t\tthis.state.isPressed = false;\n\t\t}\n\t}\n\n\tonKeyDown(e: KeyboardEvent): boolean {\n\t\tif (UtilKeyboardEvent.isActivateKey(e)) {\n\t\t\tthis.onActivateKeyDown(e);\n\t\t}\n\n\t\treturn super.onKeyDown(e);\n\t}\n\n\tonKeyUp(e: KeyboardEvent): boolean {\n\t\tif (UtilKeyboardEvent.isActivateKey(e)) {\n\t\t\tthis.onActivateKeyUp(e);\n\t\t}\n\n\t\treturn super.onKeyUp(e);\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DTreeItemButton\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { interaction } from \"pixi.js\";\nimport { DTreeNode } from \"./d-tree-node\";\nimport {\n\tDThemeTreeItemButton,\n\tDTreeItemButton,\n\tDTreeItemButtonOptions\n} from \"./d-tree-item-button\";\nimport { DTreeItemState } from \"./d-tree-item-state\";\n\nexport interface DTreeItemNonEditableOptions<\n\tNODE extends DTreeNode = DTreeNode,\n\tTHEME extends DThemeTreeItemNonEditable = DThemeTreeItemNonEditable,\n\tEMITTER = any\n> extends DTreeItemButtonOptions<NODE, THEME, EMITTER> {}\n\nexport interface DThemeTreeItemNonEditable extends DThemeTreeItemButton {}\n\nexport class DTreeItemNonEditable<\n\tNODE extends DTreeNode = DTreeNode,\n\tTHEME extends DThemeTreeItemNonEditable = DThemeTreeItemNonEditable,\n\tOPTIONS extends DTreeItemNonEditableOptions<NODE, THEME> = DTreeItemNonEditableOptions<\n\t\tNODE,\n\t\tTHEME\n\t>\n> extends DTreeItemButton<NODE, THEME, OPTIONS> {\n\tprotected onActivate(\n\t\te?: interaction.InteractionEvent | KeyboardEvent | MouseEvent | TouchEvent\n\t): void {\n\t\tsuper.onActivate(e);\n\n\t\tconst node = this._node;\n\t\tif (node !== undefined) {\n\t\t\tif (this.state.is(DTreeItemState.HAS_CHILDREN)) {\n\t\t\t\tif (e && \"data\" in e) {\n\t\t\t\t\tconst local = this.toLocal(\n\t\t\t\t\t\te.data.global,\n\t\t\t\t\t\tundefined,\n\t\t\t\t\t\tDTreeItemNonEditable.WORK_CONTAINS_POINT\n\t\t\t\t\t);\n\t\t\t\t\tif (local.x <= this.padding.getLeft()) {\n\t\t\t\t\t\tthis.toggle();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.onSelect(e, node);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.onSelect(e, node);\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DTreeItemNonEditable\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { DItemUpdater, DItemUpdaterOptions } from \"./d-item-updater\";\nimport { DTreeData } from \"./d-tree-data\";\nimport { DTreeDataMapped } from \"./d-tree-data-mapped\";\nimport { DTreeItem } from \"./d-tree-item\";\nimport { DTreeItemNonEditable } from \"./d-tree-item-non-editable\";\nimport { DTreeNode } from \"./d-tree-node\";\n\nexport interface DTreeItemUpdaterOptions<NODE>\n\textends DItemUpdaterOptions<NODE, DTreeData<NODE>, DTreeItem<NODE>> {}\n\nexport class DTreeItemUpdater<NODE extends DTreeNode = DTreeNode> extends DItemUpdater<\n\tNODE,\n\tDTreeData<NODE>,\n\tDTreeDataMapped<NODE>,\n\tDTreeItem<NODE>,\n\tDTreeItemUpdaterOptions<NODE>\n> {\n\tprotected toMapped(data: DTreeData<NODE>): DTreeDataMapped<NODE> {\n\t\treturn data.mapped;\n\t}\n\n\tprotected newItem(this: undefined, data: DTreeData<NODE>): DTreeItem<NODE> {\n\t\treturn new DTreeItemNonEditable<NODE>(data);\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Point } from \"pixi.js\";\nimport { DBase, DBaseOptions } from \"./d-base\";\nimport { DContentOptions } from \"./d-content\";\nimport { DPane, DPaneOptions, DThemePane } from \"./d-pane\";\nimport { DTreeNode } from \"./d-tree-node\";\nimport { DTreeNodeIteratee } from \"./d-tree-node-iteratee\";\nimport { DTreeDataSelection } from \"./d-tree-data-selection\";\nimport { DTreeData, DTreeDataLike, DTreeDataOptions } from \"./d-tree-data\";\nimport { isArray } from \"./util/is-array\";\nimport { DTreeDataImpl } from \"./d-tree-data-impl\";\nimport { DTreeItemUpdater, DTreeItemUpdaterOptions } from \"./d-tree-item-updater\";\n\nexport interface DTreeOptions<\n\tNODE extends DTreeNode = DTreeNode,\n\tDATA extends DTreeData<NODE> = DTreeData<NODE>,\n\tTHEME extends DThemeTree = DThemeTree,\n\tCONTENT_OPTIONS extends DBaseOptions = DContentOptions\n> extends DPaneOptions<THEME, CONTENT_OPTIONS> {\n\t/**\n\t * An alias for {@link data}.\n\t */\n\tvalue?: NODE[];\n\n\t/**\n\t * An alias for {@link data}.\n\t */\n\tnodes?: NODE[];\n\n\t/**\n\t * A data options.\n\t */\n\tdata?: NODE[] | DTreeDataOptions<NODE> | DATA;\n\n\t/**\n\t * An updater options.\n\t */\n\tupdater?: DTreeItemUpdaterOptions<NODE>;\n}\n\nexport interface DThemeTree extends DThemePane {}\n\nexport class DTree<\n\t\tNODE extends DTreeNode = DTreeNode,\n\t\tDATA extends DTreeData<NODE> = DTreeData<NODE>,\n\t\tTHEME extends DThemeTree = DThemeTree,\n\t\tCONTENT_OPTIONS extends DBaseOptions = DContentOptions,\n\t\tOPTIONS extends DTreeOptions<NODE, DATA, THEME, CONTENT_OPTIONS> = DTreeOptions<\n\t\t\tNODE,\n\t\t\tDATA,\n\t\t\tTHEME,\n\t\t\tCONTENT_OPTIONS\n\t\t>\n\t>\n\textends DPane<THEME, CONTENT_OPTIONS, OPTIONS>\n\timplements DTreeDataLike<NODE>\n{\n\tprotected static WORK_ON_CLICK?: Point;\n\n\tprotected _data?: DATA;\n\tprotected _updater?: DTreeItemUpdater<NODE>;\n\n\tconstructor(options?: OPTIONS) {\n\t\tsuper(options);\n\t\tthis.update();\n\t}\n\n\tprotected onContentChange(): void {\n\t\tsuper.onContentChange();\n\t\tthis.update();\n\t}\n\n\tonResize(newWidth: number, newHeight: number, oldWidth: number, oldHeight: number): void {\n\t\tconst updater = this.updater;\n\t\tupdater.lock();\n\t\tsuper.onResize(newWidth, newHeight, oldWidth, oldHeight);\n\t\tupdater.update();\n\t\tupdater.unlock(true);\n\t}\n\n\tget updater(): DTreeItemUpdater<NODE> {\n\t\tlet result = this._updater;\n\t\tif (result == null) {\n\t\t\tresult = this.newUpdater(this.data, this.content, this._options);\n\t\t\tthis._updater = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected newUpdater(data: DATA, content: DBase, options?: OPTIONS): DTreeItemUpdater<NODE> {\n\t\treturn new DTreeItemUpdater<NODE>(data, content, content, options?.updater);\n\t}\n\n\tget data(): DATA {\n\t\tlet result = this._data;\n\t\tif (result == null) {\n\t\t\tresult = this.toData(this._options);\n\t\t\tthis._data = result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected toData(options?: OPTIONS): DATA {\n\t\tconst data = (options && (options.data || options.nodes || options.value)) || [];\n\t\tif (isArray(data)) {\n\t\t\treturn new DTreeDataImpl<NODE>(this, {\n\t\t\t\tnodes: data\n\t\t\t}) as any;\n\t\t} else if (\"add\" in data) {\n\t\t\treturn data;\n\t\t} else {\n\t\t\treturn new DTreeDataImpl<NODE>(this, data) as any;\n\t\t}\n\t}\n\n\tupdate(forcibly?: boolean): void {\n\t\tthis.updater.update(forcibly);\n\t}\n\n\tlock(): void {\n\t\tthis.updater.lock();\n\t}\n\n\tunlock(callIfNeeded: boolean): void {\n\t\tthis.updater.unlock(callIfNeeded);\n\t}\n\n\tget selection(): DTreeDataSelection<NODE> {\n\t\treturn this.data.selection;\n\t}\n\n\tget value(): NODE[] {\n\t\treturn this.data.nodes;\n\t}\n\n\tset value(value: NODE[]) {\n\t\tthis.data.nodes = value;\n\t}\n\n\tget nodes(): NODE[] {\n\t\treturn this.data.nodes;\n\t}\n\n\tset nodes(nodes: NODE[]) {\n\t\tthis.data.nodes = nodes;\n\t}\n\n\ttoggle(target: NODE): boolean {\n\t\treturn this.data.toggle(target);\n\t}\n\n\texpand(target: NODE): boolean {\n\t\treturn this.data.expand(target);\n\t}\n\n\tcollapse(target: NODE): boolean {\n\t\treturn this.data.collapse(target);\n\t}\n\n\texpandAll(): boolean {\n\t\treturn this.data.expandAll();\n\t}\n\n\tcollapseAll(): boolean {\n\t\treturn this.data.collapseAll();\n\t}\n\n\tisCollapsed(target: NODE): boolean {\n\t\treturn this.data.isCollapsed(target);\n\t}\n\n\tisExpanded(target: NODE): boolean {\n\t\treturn this.data.isExpanded(target);\n\t}\n\n\tclear(): boolean {\n\t\treturn this.data.clear();\n\t}\n\n\tremove(target: NODE): boolean {\n\t\treturn this.data.remove(target);\n\t}\n\n\tadd(target: NODE, parent?: NODE): boolean {\n\t\treturn this.data.add(target, parent);\n\t}\n\n\taddBefore(target: NODE, sibling: NODE): boolean {\n\t\treturn this.data.addBefore(target, sibling);\n\t}\n\n\taddAfter(target: NODE, sibling: NODE): boolean {\n\t\treturn this.data.addAfter(target, sibling);\n\t}\n\n\teach(iteratee: DTreeNodeIteratee<NODE>): void {\n\t\treturn this.data.each(iteratee);\n\t}\n\n\tonKeyDown(e: KeyboardEvent): boolean {\n\t\tthis.updater.moveFocus(e, this, true, false);\n\t\treturn super.onKeyDown(e);\n\t}\n\n\tprotected getType(): string {\n\t\treturn \"DTree\";\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { EShapeImage } from \"./e-shape-image\";\nimport { toImageElement } from \"./to-image-element\";\n\nexport const createImage = (dataUrl: string): Promise<EShapeImage> => {\n\treturn toImageElement(dataUrl).then((imageElement: HTMLImageElement): EShapeImage => {\n\t\treturn new EShapeImage(imageElement);\n\t});\n};\n","import { toPointsBoundary } from \"../e-shape-points-formatted\";\nimport { EShapePointsStyle } from \"../e-shape-points-style\";\nimport { EShapeLine } from \"./e-shape-line\";\n\nexport const createLine = (\n\tpoints: number[],\n\tsegments: number[],\n\tstrokeWidth: number,\n\tpointsStyle: EShapePointsStyle\n): EShapeLine => {\n\t// Calculate the boundary\n\tconst boundary = toPointsBoundary(points, [0, 0, 0, 0]);\n\tconst cx = (boundary[2] + boundary[0]) * 0.5;\n\tconst cy = (boundary[3] + boundary[1]) * 0.5;\n\tconst sx = boundary[2] - boundary[0];\n\tconst sy = boundary[3] - boundary[1];\n\n\t// Calculate values\n\tconst values: number[] = [];\n\tfor (let i = 0, imax = points.length; i < imax; i += 2) {\n\t\tvalues.push(points[i] - cx, points[i + 1] - cy);\n\t}\n\n\t// Create a line\n\tconst result = new EShapeLine();\n\tresult.stroke.set(true, undefined, undefined, strokeWidth);\n\tresult.transform.position.set(cx, cy);\n\tresult.size.set(sx, sy);\n\tresult.points.set(values, segments, pointsStyle);\n\treturn result;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { toSvgUrl } from \"../../util/to-svg-url\";\nimport { UtilRgb } from \"../../util/util-rgb\";\nimport { EShapeGradientLike } from \"../e-shape-gradient\";\n\nexport const toGradientImageUrl = (gradient: EShapeGradientLike): string => {\n\tconst direction = gradient.direction;\n\tconst points = gradient.points;\n\n\tlet stops = \"\";\n\tfor (let i = 0, imax = points.length; i < imax; ++i) {\n\t\tconst point = points[i];\n\t\tconst color = UtilRgb.toCode(point.color);\n\t\tconst alpha = point.alpha;\n\t\tconst offset = point.position * 100;\n\t\tstops += `<stop offset=\"${offset}%\" stop-color=\"#${color}\" stop-opacity=\"${alpha}\" />`;\n\t}\n\n\tconst radian = (direction * Math.PI) / 180;\n\tconst dx = 0.5 * Math.cos(radian);\n\tconst dy = -0.5 * Math.sin(radian);\n\n\tconst url = toSvgUrl(\n\t\t/* eslint-disable prettier/prettier */\n\t\t`<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"32\" height=\"32\" viewBox=\"0 0 32 32\">` +\n\t\t\t`<defs>` +\n\t\t\t\t`<linearGradient id=\"o2glkm3aeu2oio\" x1=\"${0.5 - dx}\" x2=\"${0.5 + dx}\" y1=\"${0.5 - dy}\" y2=\"${0.5 + dy}\">` +\n\t\t\t\t\tstops +\n\t\t\t\t`</linearGradient>` +\n\t\t\t`</defs>` +\n\t\t\t`<rect x=\"0\" y=\"0\" width=\"32\" height=\"32\" stroke=\"none\" fill=\"url(#o2glkm3aeu2oio)\" />` +\n\t\t`</svg>`\n\t\t/* eslint-enable prettier/prettier */\n\t);\n\n\treturn url;\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { IPoint } from \"pixi.js\";\nimport { EShape } from \"../e-shape\";\nimport { toSizeNormalized } from \"./to-size-normalized\";\nimport { toSizeRounded } from \"./to-size-rounded\";\n\nexport const toResized = (\n\tshape: EShape,\n\tfrom: IPoint,\n\tto: IPoint,\n\tcenterMode: boolean,\n\tisPerfect: boolean\n): void => {\n\tshape.disallowUploadedUpdate();\n\tconst position = shape.transform.position;\n\tif (centerMode) {\n\t\tconst dx = Math.abs(to.x - from.x);\n\t\tconst dy = Math.abs(to.y - from.y);\n\t\tif (isPerfect) {\n\t\t\tconst hsize = Math.max(dx, dy);\n\t\t\tconst size = hsize + hsize;\n\t\t\tshape.size.set(toSizeNormalized(size), toSizeNormalized(size));\n\t\t\tposition.set(toSizeRounded(from.x), toSizeRounded(from.y));\n\t\t} else {\n\t\t\tshape.size.set(toSizeNormalized(dx + dx), toSizeNormalized(dy + dy));\n\t\t\tposition.set(toSizeRounded(from.x), toSizeRounded(from.y));\n\t\t}\n\t} else {\n\t\tif (isPerfect) {\n\t\t\tconst dx = to.x - from.x;\n\t\t\tconst dy = to.y - from.y;\n\t\t\tconst size = Math.max(Math.abs(dx), Math.abs(dy));\n\t\t\tconst x2 = from.x + (dx < 0 ? -size : +size);\n\t\t\tconst y2 = from.y + (dy < 0 ? -size : +size);\n\t\t\tconst hsize = size * 0.5;\n\t\t\tconst x = Math.min(from.x, x2) + hsize;\n\t\t\tconst y = Math.min(from.y, y2) + hsize;\n\t\t\tshape.size.set(toSizeNormalized(size), toSizeNormalized(size));\n\t\t\tposition.set(toSizeRounded(x), toSizeRounded(y));\n\t\t} else {\n\t\t\tconst x0 = Math.min(from.x, to.x);\n\t\t\tconst y0 = Math.min(from.y, to.y);\n\t\t\tconst x1 = Math.max(from.x, to.x);\n\t\t\tconst y1 = Math.max(from.y, to.y);\n\t\t\tconst width = x1 - x0;\n\t\t\tconst height = y1 - y0;\n\t\t\tconst px = width * 0.5;\n\t\t\tconst py = height * 0.5;\n\t\t\tshape.size.set(toSizeNormalized(width), toSizeNormalized(height));\n\t\t\tposition.set(toSizeRounded(x0 + px), toSizeRounded(y0 + py));\n\t\t}\n\t}\n\tshape.allowUploadedUpdate();\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Point } from \"pixi.js\";\n\nexport class ESnapperResultScale {\n\tdistance: number;\n\tscale: Point;\n\n\tconstructor() {\n\t\tthis.distance = NaN;\n\t\tthis.scale = new Point();\n\t}\n}\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const toString = (value: unknown): string => {\n\treturn value != null ? String(value) : \"\";\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Texture } from \"pixi.js\";\nimport { toSvgUrl } from \"./to-svg-url\";\n\nexport const toSvgTexture = (svg: string, resolution: number): Texture => {\n\treturn Texture.from(toSvgUrl(svg), {\n\t\tresolution\n\t});\n};\n","/*\n * Copyright (C) 2019 Toshiba Corporation\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as ui from \"./wcardinal/ui\";\n\nui.loadAll();\n\nconst global = window as any;\nglobal.wcardinal = global.wcardinal || {};\nglobal.wcardinal.ui = ui;\n"],"names":["EShapeDeserializers","EShapeOnDeserializeds","EShapeType","CIRCLE","RECTANGLE","RECTANGLE_ROUNDED","TRIANGLE","TRIANGLE_ROUNDED","LINE","IMAGE","IMAGE_SDF","GROUP","BAR","LABEL","NULL","GROUP_SHADOWED","LINE_OF_CIRCLES","LINE_OF_RECTANGLES","LINE_OF_RECTANGLE_ROUNDEDS","LINE_OF_TRIANGLES","LINE_OF_TRIANGLE_ROUNDEDS","EMBEDDED","EMBEDDED_LAYER","BUTTON","RECTANGLE_PIVOTED","CONNECTOR_LINE","EXTENSION","EShapeUploadeds","buffer","vertexOffset","indexOffset","vertexCount","indexCount","builders","this","_builders","_vertexOffset","_indexOffset","_vertexCount","_indexCount","EShapeUploadedImpl","shape","uploaded","i","imax","length","init","update","isCompatible","builder","buildUnit","EShapeStrokeStyle","NONE","NON_EXPANDING_WIDTH","NON_SHRINKING_WIDTH","NON_SCALING_DOT_AND_DASH","NON_SCALING","NON_SCALING_MASK","DOTTED","DOTTED_DENSELY","DOTTED_LOOSELY","DOTTED_MASK","DASHED","DASHED_DENSELY","DASHED_LOOSELY","DASHED_MASK","toDash","strokeWidth","style","result","set","toScaleInvariant","nonExpandingWidth","nonShrinkingWidth","BAR_WORK_POINT","Point","buildBarClipping","clippings","voffset","ic","buildBarIndex","indices","ioffset","ii","buildBarVertexStepAndColorFill","vertices","steps","colorFills","pointValues","pointsSize","strokeStyle","internalTransform","a","b","c","d","tx","ty","pv0","pv1","p1x","p1y","pv2","pv3","p2x","p2y","dx","dy","distance","Math","sqrt","l","ratio","p0x","p0y","p3x","p3y","scaleInvariant","dash","dash0","x","dash1","y","iv","icf","is","buildBarUv","uvs","textureUvs","iuv","x0","y0","x3","y3","x1","y1","x2","y2","target","position","UtilCharacterIterator","istart","iend","code","charCodeAt","isLowSurrogate","isVariationSelector","nextBreak","findNextBreak","substring","except","_instance","instance","EShapeTextWeight","NORMAL","BOLD","EShapeTextStyle","ITALIC","EShapeTextAlignHorizontal","LEFT","CENTER","RIGHT","OUTSIDE_LEFT","OUTSIDE_RIGHT","EShapeTextAlignVertical","TOP","MIDDLE","BOTTOM","OUTSIDE_TOP","OUTSIDE_BOTTOM","EShapeTextDirection","LEFT_TO_RIGHT","TOP_TO_BOTTOM","BOTTOM_TO_TOP","toLength","dx01","dy01","TEXT_FMIN","TEXT_WORK_POINT","toTextBufferCount","ceil","text","value","buildTextClipping","vcount","icmax","buildTextIndex","icount","iimax","buildTextStep","textAtlas","textSize","textOutlineWidth","textWeight","ismax","scale","font","size","getTextBBox","halign","valign","hoffset","hpadding","vpadding","width","height","hnx","hny","vnx","vny","toNormalized","defx","defy","li","buildTextVertex","originX","originY","sizeX","sizeY","textValue","textStyle","textAlignHorizontal","textAlignVertical","textOffsetHorizontal","textOffsetVertical","textSpacingHorizontal","textSpacingVertical","textDirection","textPaddingHorizontal","textPaddingVertical","textClipping","textWorld","sx","sy","work","apply","hl","vl","heightChar","lineHeight","max","lineWidth","textAtlasCharacters","characters","iterator","from","advancePrevious","hasNext","character","next","data","advance","tx0","ty0","lineWidthMaximum","NaN","align","rotateAlignVerticalRight","rotateAlignHorizontalRight","rotateAlignVerticalLeft","rotateAlignHorizontalLeft","dwidth","uvx0","uvx1","uvx3","uvy0","uvy1","uvy3","duvx01","duvy01","duvx03","duvy03","lhx","lhy","snx","sny","offsetY","oyx","oyy","offsetItalic","bx0","by0","bx3","by3","cx0","cy0","cx3","cy3","lineCount","lineWidthPrevious","ax","ay","dots","bx","by","writeCharacter","writeCharacterEmpty","adjustTextAlignment","ivmax","atlas","dataOffsetX","origin","dataWidth","dx0","dy0","dx1","dy1","px0","py0","px1","py1","dux0","duy0","dux1","duy1","dvx0","dvy0","dvx1","dvy1","moveText","vertexIndex","textCount","moveTextHalf","offset","nx","ny","moveTextFull","extendStatics","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","__extends","TypeError","String","__","constructor","create","RANGE_DUMMY","TRANSFORMED_POINT_VALUES","EShapePointsStyle","CLOSED","CURVE","FORMATTER_MASK","buildColor","color","alpha","colors","r","g","transformLocalId","strokeAlign","strokeSide","colorFill","alphaFill","colorStroke","alphaStroke","texture","textureTransformId","BuilderBase","fill","isEnabled","visible","enable","updateColorFills","stroke","updateColorStrokes","colorStrokes","Texture","WHITE","baseTexture","push","toTransformLocalId","updateTransform","transform","getLocalId","toTexture","toTextureTransformId","textureAny","_uvs","updateUvs","_updateID","toTextureUvs","DThemes","theme","DEFAULT_THEME_CLASS","INSTANCE","defaultThemeClass","getDefaultThemeClass","Error","EShapeDefaults","_THEME","newTheme","getInstance","get","THEME","getFillColor","getFillAlpha","getStrokeColor","getStrokeAlpha","getStrokeWidth","getStrokeAlign","getStrokeSide","getStrokeStyle","getTextValue","getTextColor","getTextAlpha","getTextFamily","getTextSize","getCursor","getRadius","getSizeX","getSizeY","getHighlightColor","getCurveSegmentCount","EShapePointsMarkerType","parent","_parent","_enable","_color","_alpha","EShapeFillImpl","updateUploaded","isChanged","undefined","manager","stringified","addResource","resources","parsed","getFill","deserialized","JSON","parse","setFill","EShapePointsMarkerNoop","type","_size","_transform","Matrix","_fill","FILL_COLOR","source","resourceId","_marker","EShapePointsMarkerContainerImplNoop","EShapeBarPosition","_id","_values","_segments","_style","_position","_updatedSize","_updatedParentSizeX","_updatedParentSizeY","_updatedPosition","EShapeBarPoints","abs","parentSize","parentSizeX","parentSizeY","psxh","psyh","computedSize","getComputedSize","values","segments","moveTo","formatter","newValues","newSegments","newStyle","newPosition","newSize","copy","point","resource","threshold","toRange","tester","EShapeLineBaseHitPart","MARKER_TAIL","MARKER_HEAD","TEXT","CHILDREN","EShapeCorner","TOP_LEFT","TOP_RIGHT","BOTTOM_LEFT","BOTTOM_RIGHT","ALL","DApplications","INSTANCES","instances","index","indexOf","stage","getStage","layer","application","getLayerBase","getLayerOverlay","getLayer","renderer","resolution","window","devicePixelRatio","render","EShapeAction","splice","destination","clear","add","addAll","isEquals","indexA","indexB","tmp","serialize","_edges","Set","EShapeConnectorContainerImpl","edges","has","delete","each","edge","iteratee","forEach","forcibly","toOnFitBound","_onFitBoundForcibly","newOnFitBound","_onFitBound","_this","onFit","fit","EShapeCopyPart","TRANSFORM","SIZE","STYLE","ACTION","POINTS","STATE","DATA","TAG","CONNECTOR","DBaseState","HOVERED","ACTIVE","FOCUSED","UNFOCUSABLE","FOCUS_ROOT","FOCUS_REVERSE","READ_ONLY","DISABLED","GESTURING","PRESSED","INVALID","SUCCEEDED","FAILED","WARNED","CHANGED","ALTERNATED","NEW_WINDOW","isFunction","isString","toString","_local","DBaseStateSetImpl","state","under","in","callOnChange","added","checkAdded","begin","end","states","local","stateOrStates","arguments","checkAddeds","removed","checkRemoved","stateOrStatesOrMatcher","isDirty_1","checkRemoveds","stateOrAdded","isOnOrRemoved","remove","statesOrAddeds","isOnOrRemoveds","removeAll","addeds","removeds","other","local_1","newState","oldState","isHovered","on","isActive","isPressed","isReadOnly","isDisabled","isGesturing","isFocused","isFocusRoot","isFocusReverse","isFocusable","unfocusable","invalid","succeeded","failed","isWarned","isAlternated","stringify","toObject","onChange","_super","_onChange","_isLocked","_isSaved","_doSave","DBaseStateSetImplObservable","_saved","saved","EShapeState","CLICKED","DOWN","UP","ACTIVATED","DEACTIVATED","EShapeStateSetImplObservable","isClicked","isDown","isUp","isActivated","isDeactivated","EShapeTransformImpl","onTransformChange","updateSkew","_currentLocalID","_localID","_parentID","_worldID","parentTransform","oldLocalId","oldWorldId","newLocalId","newWorldId","localTransform","copyTo","prepend","Transform","strokeScale","EShapeBaseHitTestData","hitTestBBox","toGradientSerialized","gradient","points","direction","j","id","uuid","newTransform","_onTransformChangeLock","_isOnTransformChanged","action","_visible","_uploadedUpdateLock","_isUploadedUpdated","_isUploadedUpdatedRecursively","_boundsTransformId","_boundsInternalTransformId","_boundsLocalTransformId","interactive","children","selected","reference","EShapeBase","onTransformChange_","_connector","onParentTransformChange","parent_1","onChildTransformChange","invokeOnTransformChange","updateUploadedRecursively","_image","image","_points","root","parent_2","parent_3","worldVisible","toDirty","at","detach","onAttach","connector","attach","onDetach","IDENTITY","childrenSerialized","child","src","serialized","pivot","shortcut","shortcutId","title","titleId","rotation","skew","cursor","trim","radius","corner","serializeImage","serializeGradient","serializeChildren","serializeState","addUuid","updateUuid","container","getShapeScale","min","getHitTestSize","WORK_HIT_TEST_DATA","getStrokeWidthScale","s","toHitTestData","containsAbs","containsText","containsChildren","world","th","tv","lx","ly","childResult","contains","containsAbsBBox","sw","ss","sa","skipUpdate","copyFrom","worldTransform","applyInverse","bounds","_bounds","Rectangle","worldId","getWorldId","getBounds_","boundsInternal","_boundsInternal","currentLocalId","getLocalIdCurrent","boundsLocal","_boundsLocal","px","py","getBoundsSize","xmin","ymin","xmax","ymax","destroy","runtime","onStateChange","onParentChange","_state","setFocused","getFocusController","e","onKeyDown","onKeyUp","time","onRender","part","sourceTransform","clearAndAddAll","sourcePoints","lock","unlock","sourceConnector","utils","EventEmitter","side","_width","_align","_side","EShapeStrokeImpl","getStroke","setStroke","EShapeDataValueOrder","ASCENDING","DESCENDING","EShapeDataValueRangeType","FROM","TO","FROM_TO","_type","_from","_to","EShapeDataValueRangeImpl","to","parent_4","copy_","parent_5","getRange","setRange","INDEX_COMPARATOR","initial","format","range","_value","_time","_capacity","_order","EShapeDataValueImpl","newValue","capacity","order","unshift","count","shift","normalize","newTime","times","_times","parent_6","newTimes","parent_7","parent_8","parent_9","parent_10","sorted","slice","sort","parent_11","parent_12","idSerialized","addData","initialSerialized","formatSerialized","rangeSerialized","getDataValue","setDataValue","deserialize","_isChanged","EShapeDataImpl","nvalue","valuesLength","getData","setData","deserializedLength","horizontal","vertical","_horizontal","_vertical","EShapeTextAlignImpl","getAlign","setAlign","EShapeTextOffsetImpl","getMargin","setMargin","EShapeTextOutlineImpl","getTextOutline","setTextOutline","family","_family","_weight","spacing","outline","_direction","padding","_clipping","EShapeTextImpl","weight","clipping","isChangedDirty","isChangedUploaded","valueId","familyId","alignId","offsetId","outlineId","spacingId","paddingId","getText","setText","newFill","newStroke","_radius","RADIUS","_corner","tag","newText","CURSOR","EShapePrimitive","ObservablePoint","onSizeChange","SIZE_X","SIZE_Y","FILL_ALPHA","STROKE_COLOR","STROKE_ALPHA","STROKE_WIDTH","STROKE_ALIGN","STROKE_SIDE","STROKE_STYLE","TEXT_VALUE","TEXT_COLOR","TEXT_ALPHA","TEXT_FAMILY","TEXT_SIZE","imageSrc","hitTestCircle","ay2","ax2","wx","wy","wx2","wy2","EShapeStrokeSide","TOP_OR_LEFT","TOP_OR_RIGHT","BOTTOM_OR_LEFT","BOTTOM_OR_RIGHT","hitTestRectangle","hitTestTriangleFilled","ay1","hitTestTriangle","aw","cy","toThresholdDefault","EShapeLineBase","formatted","boundary","marker","getMarker","head","tail","margin","toMarkerSize","containsAbsMarker","calcHitPointAbsHitTester","calcHitPointAbs","toThreshold","d0x","d0y","d1x","d1y","t","EShapeBar","pointsId","pointsStyle","BuilderBar","updateClippings","updateIndices","updateVertexStepAndColorFill","updateColorStroke","updateUv","isSizeChanged","isStrokeWidthChanged","isTransformChanged","isPointsIdChanged","isPointsStyleChanged","updateVertices","updateSteps","alignHorizontal","alignVertical","offsetHorizontal","offsetVertical","outlineWidth","outlineColor","outlineAlpha","spacingHorizontal","spacingVertical","paddingHorizontal","paddingVertical","BuilderText","updateVertex","updateColorFill","updateStep","textFamily","textTexture","textTextureTransformId","isCharChanged","isCharSizeChanged","isCharStyleChanged","isCharAlignChanged","isCharOffsetChanged","isCharSpacingChanged","isCharDirectionChanged","isClippingChanged","isTextureChanged","shapeSize","textOutline","textBaseTexture","createBarUploaded","antialiasWeight","tcount","tvcount","ticount","check","isArray","isNumber","toPadded","str","strLength","UtilRgb","toUpperCase","trimmed","toLowerCase","Number","colorA","colorB","ar","ag","ab","br","bg","bb","w1","w0","amount","blend","toLuma","UtilKeyboardEvent","key","which","ctrlKey","shiftKey","expressionOrShortcut","event_1","expression","arrowIndex","keyExpression","keys","split","setShortcutKeyAndWhich","alt","ctrl","event","parts","join","handler","toShortcut","document","body","addEventListener","altKey","isActionable","emit","preventDefault","picker","isBackward","isArrowUpKey","isForward","isArrowDownKey","moveFocus","isArrowLeftKey","isArrowRightKey","picked","focusController","focused","find","focus","EShapeRuntimeReset","POSITION_X","POSITION_Y","POSITION","ROTATION","COLOR_FILL","COLOR_STROKE","COLOR_FILL_AND_STROKE","COLOR_TEXT","COLOR_TEXT_OUTLINE","COLOR","VISIBILITY","HEIGHT","WIDTH","actions","reset","written","effect","isStateChanged","EShapeRuntime","disallowUploadedUpdate","onInitialize","allowUploadedUpdate","initialize","interactionManager","onDblClick","onDowning","findParent","onDown","onMove","isActivateKey","wasUp","onUp","onClick","onFocus","onBlur","isEffectTimeUp","onUpdate","execute","doReset","EShapeActionBases","EShapeActionExpressions","caster","def","defLiteral","nullable","parameter","Function","ZERO","ONE","ONE_HUNDRED","EMPTY","TRUE","FALSE","EShapeActionRuntime","condition","ofBoolean","interval","EShapeActionRuntimeBlink","dinterval","elapsed","toOff","toOn","EShapeActionRuntimeConditional","EShapeActionRuntimeBlinkBrighten","toBaseFill","brighten","toBaseStroke","toBaseText","toBaseTextOutline","EShapeActionRuntimeBlinkColorFill","EShapeActionRuntimeBlinkColorStroke","EShapeActionRuntimeBlinkDarken","darken","EShapeActionRuntimeBlinkOpacity","EShapeActionRuntimeBlinkVisibility","EShapeActionValueBlinkType","BRIGHTEN","DARKEN","OPACITY","EShapeActionValueBase","toLabel","subtype","EShapeActionValueSubtyped","EShapeActionValueType","SHOW_HIDE","BLINK","OPEN","EMIT_EVENT","CHANGE_COLOR_LEGACY","CHANGE_TEXT","CHANGE_CURSOR","MISC","CHANGE_COLOR","EShapeActionValues","EShapeActionValueBlink","conditionId","toResource","UtilAlpha","alphaA","alphaB","w","EShapeActionRuntimeChangeColorBase","base","EShapeActionValueChangeColorTarget","COLOR_AND_ALPHA","ALPHA","CODE","BRIGHTNESS","ofNumberOrNull","EShapeActionRuntimeChangeColor","EShapeActionValueChangeColorType","FILL","STROKE","TEXT_OUTLINE","FILL_AND_STROKE","EShapeActionValueChangeColorTypeLegacy","EShapeActionValueChangeColorTypes","types","EShapeActionValueChangeColor","blendId","brightness","EShapeActionRuntimeChangeColorBrightness","toAdjusted","EShapeActionValueChangeColorBrightness","brightnessId","EShapeActionRuntimeChangeColorCode","EShapeActionValueChangeColorCode","colorId","alphaId","name","ofStringOrNull","EShapeActionRuntimeChangeCursor","name_1","EShapeActionValueChangeCursor","nameId","FormatNodeA","step","date","getHours","FormatNodea","FormatNodeD","getDate","FormatNoded","precision","FormatNodee","toExponential","FormatNodePrecision","FormatNodef","toFixed","FormatNodefsi","toAbs","format_","unitInverse","postfix","FormatNodeg","toPrecision","FormatNodeH","FormatNodeh","FormatNodeM","getMonth","FormatNodem","getMinutes","FormatNodemi","getMilliseconds","FormatNodeP","FormatNodep","node","FormatNodePadding","FormatNodeParenthesis","FormatNodePlus","FormatNodeRP","round","FormatNoderp","Y","M","D","H","m","mi","FormatNodesdt","FormatNodeSpace","FormatNodessi","FormatNodeString","FormatNodeY","getFullYear","FormatNodey","FormatNodez","z","getTimezoneOffset","floor","FormatNoderd","FormatNodes","getSeconds","REGEXP","toModifiedDatetime","modifier","toModifiedNumber","previousIndex","isDateRequired","regExp","lastIndex","getRegExp","matched","exec","all","nodes","toParsed","NumberFormatterImpl","DATE","Date","setTime","NumberFormatters","number","ofNumber","formatters","Map","EShapeActionRuntimeChangeTextNumber","newFormatter","getFormatter","ofString","EShapeActionRuntimeChangeTextText","EShapeActionValueChangeTextType","NUMBER","EShapeActionValueChangeText","options","callback","_theme","_callback","background","DBaseBackground","getBackgroundColor","getBackgroundAlpha","DBorderMask","TOP_BOTTOM","RIGHT_BOTTOM","RIGHT_LEFT","NOT_TOP","NOT_RIGHT","NOT_BOTTOM","NOT_LEFT","toEnum","te","border","_mask","mask","DBaseBorder","getBorderColor","getBorderAlpha","getBorderWidth","getBorderAlign","getBorderMask","DCornerMask","DBaseCorner","getCornerRadius","getCornerMask","DBaseInteractive","SELF","BOTH","_offset","DBaseOutline","getOutlineColor","getOutlineAlpha","getOutlineWidth","getOutlineOffset","getOutlineAlign","getOutlineMask","_left","_top","_right","_bottom","left","top","right","bottom","DBasePadding","getPaddingLeft","getPaddingTop","getPaddingRight","getPaddingBottom","_point","DBasePoint","oldX","oldY","equals","_height","_cornerRadius","_cornerMask","_isDirty","_resolution","_vertexBuffer","getBuffer","_vertices","_uvBuffer","_indexBuffer","getIndex","_indices","DBaseMeshGeometry","borderSize","cornerMask","TABLES","newTables","N","n","da","newTable","a0","cos","sin","pi","PI","MeshGeometry","Float32Array","Uint16Array","DBaseBackgroundMeshGeometry","dr","table","cos0","sin0","cos1","sin1","dro","d0","d1","ro","ia","h","ctl","ctr","cbl","cbr","n4","n2","n6","tables","getTables","tlt","ttr","trb","tbl","fillVertices","fillIndices","fillIndicesEnd","MeshMaterial","DBaseBackgroundMesh","geometry","cornerRadius","_render","Mesh","DBaseBackgroundSnippet","_mesh","getBackgroundTexture","mesh","backgroundColor","getColor","backgroundAlpha","getAlpha","backgroundMesh","tint","hide","_borderWidth","_borderMask","DBaseBorderMeshGeometry","borderWidth","borderMask","borderWidthHalf","r0","r2","dr1","dr2","d0i","d1i","r1","r3","loop","vrtcs","bw","bt","bl","n8","n18","DBaseBorderMesh","DBaseBorderSnippet","getBorderTexture","borderColor","borderAlpha","getWidth","getMask","borderMesh","borderOffset","DBaseOutlineSnippet","outlineMask","outlineMesh","outlineOffset","getOffset","_background","snippet","_border","_outline","reflowable","DBaseReflowableImpl","onReflow","DLayoutClearType","BEFORE","AFTER","DScalarExpressionNodeType","CLOSE","PARENSESIS","ADD_OR_PLUS","SUB_OR_MINUS","PLUS","MINUS","ADD","SUB","MUL","DIV","MIN","MAX","COMMA","PARENT","PADDING","CURRENT","toToken","toParensesis","toUnary","toArithmetic","_node","DScalarExpression","ifrom","ito","nodeType","nodeTypePrev","jnode","toComma","operand","iprev","toCommaOf","toUnaryNode","operatorA","operatorB","toArithmeticNode","tokens","TOKEN_REGEX","token","tokenTypeOperator","toTokenOperator","parsedToken","parseFloat","tokenTypeLiteral","toTokenLiteral","tokenLength","self","current","evaluate","args","POSITION_CENTER","POSITION_PADDING","SIZE_MAXIMIZED","SIZE_PADDING","DScalarFunctions","coordinate","scalarExpression_1","calculate","scalar_1","scalarExpression_2","scalar_2","UtilPointerEvent","touches","changedTouches","touch","mapPositionToPoint","clientX","clientY","global","CLICK_DISTANCE_THRESHOLD","isDowned","downX","downY","interactionManagerBound","up","upoutside","cancel","cleanup","off","onCancel","isValidDistance","down","global_1","global_2","plugins","interaction","once","touchable","isDowned_1","downX_1","downY_1","clickTime_1","touchesLength","item","timeStamp","DBLCLICK_INTERVAL_THRESHOLD","targetOrChild","_isOn","DBaseAuto","_befores","_afters","_renderable","DBaseSnippetContainer","renderable","phase","list","_list","DBaseReflowableContainer","newX","newY","_scale","onScale","_skew","onSkew","_options","scalarSet","_scalarSet","_auto","DBaseAutoSet","_hasDirty","_isChildrenDirty","_shadow","toTheme","getThemeDefault","_snippet","_reflowable","_clearType","getClearType","_padding","toParentResized","toChildrenDirty","toDirtyAndUpdate","getX","getY","getHeight","getInteractive","interactiveChildren","_title","getTitle","getWeight","initReflowable","_onShadowUpdateBound","shadow","getShadow","newShadowWeak","newShadow","over","onOver","out","onOut","isDirty","hasDirty","toParentHasDirty","toParentChildrenDirty","newParent","DBase","blur","shortcuts","toShortcuts","_shortcuts","onShortcutBound","onShortcut","addChild","_cursor","toCursor","onChildrenChange","onParentMove","oldWidth","oldHeight","widthResized","heightResized","resized","onResize","getParentOfSize","getLeft","getTop","newWidth","newHeight","onParentResize","getType","scalar","toCoordinate","auto","isOn","isAuto","applyTitle","view","toHasDirty","onChildrenDirty","recursively","onChildFocus","blured","onChildBlur","setTheme","refit","onRefit","isWidthAuto","isHeightAuto","hasRefitableWidth","hasRefitableHeight","resize","getRight","getBottom","isRefitable","reflow","previous","onShadowUpdateBound","addAt","parentWidth","parentHeight","parentPadding","paddingWidth","paddingHeight","deltas","isEventTarget","onDownThis","originalEvent","lastDownPoint","_lastDownPoint","focusOnClosest","onUpThis","worldAlpha","WORK_CONTAINS_POINT","addPoint","_calculateBounds","containsGlobalPoint","containsLocalPoint","Container","DBaseOverflowMask","tl","tr","beginFill","lineStyle","drawRect","arcTo","lineTo","endFill","Graphics","UtilGestureModifier","CTRL","SHIFT","ALT","AND","OR","NOT_NONE","UtilGestureModifiers","oe","UtilGestureMode","OFF","ON","TOUCH","pointers","center","UtilGestureData","pointerId","doUpdate","move","onEnd","centerX","centerY","squareDistance","pointersSize","centerX_1","centerY_1","pointer","squareDistance_1","DAnimationTimings","_target","_startTime","_duration","duration","_durationInverse","_reverse","_onTime","onTime","_onTimeBaseBound","onTimeBase","_onStart","onStart","_onEnd","_timing","timing","ELASTIC","DAnimationBase","reverse","stop","now","setTimeout","toTime","isReverse","elapsedTime","clearTimeout","ds","dt","UtilGestureEasingHistory","_histories","_historiesSorted","_historyBegin","_historyEnd","_dx","_dy","_ds","_dt","_dtw","_t","_animation","onEase","onEaseEnd","LINEAR","_onMove","UtilGestureEasing","histories","HISTORY_CAPACITY","oldHistoryEnd","newHistoryEnd","oldHistoryBegin","unsorted","total","history_1","history_2","history_3","ldt","updateHistoriesSorted","sortedLength","history_4","animation","start","ot","_modifier","checker","defaultChecker","match","_checkerStart","_checkerMove","_easing","easing","_touch","_unused","_used","bind","UtilGesture","used","poped","pop","created","newEasing","newOnMove","newOnEnd","onEasingMove","onEasingEnd","toEasingOptions","pointerType","isTouch","stopPropagation","newData","isUpdatable","oldCenterX","oldCenterY","oldScale","oldTime","newCenterX","newCenterY","newScale","epsilon","onMoveBound","onEndBound","deleteData","toTarget","stopper","constraint","_stopper","_constraint","mode","getGestureMode","getGestureModifier","_gestureUtil","onGestureMove","DViewGestureImpl","oldScaleX","oldScaleY","newScaleX","toNormalizedScale","newScaleY","scaleRatioX","scaleRatioY","scaleRatio","cx","_toTarget","_newScaleX","_newScaleY","_newX","_newY","_oldScaleX","_oldScaleY","_oldX","_oldY","DViewTransformImpl","scaleX","scaleY","DViewImpl","CONSTRAINT","_workRect","zoom","_zoomPoint","_zoomMin","getZoomMin","_zoomMax","getZoomMax","_zoomKeepRatio","keepRatio","getZoomKeepRatio","wheelZoom","wheel","_isWheelZoomEnabled","isWheelZoomEnabled","_wheelZoomSpeed","speed","getWheelZoomSpeed","_wheelZoomModifier","getWheelZoomModifier","_wheelZoomChecker","dblClickZoom","dblclick","_isDblClickZoomEnabled","isDblClickZoomEnabled","_dblClickZoomSpeed","getDblClickZoomSpeed","_dblClickZoomModifier","getDblClickZoomModifier","_dblClickZoomChecker","_dblclickZoomDuration","getDblClickZoomDuration","wheelTranslation","translation","_isWheelTranslationEnabled","isWheelTranslationEnabled","_wheelTranslationSpeed","getWheelTranslationSpeed","_wheelTranslationModifier","getWheelTranslationModifier","_wheelTranslationChecker","_gesture","gesture","targetRect","getLocalBounds","newTargetX","newTargetY","targetX","targetY","targetWidth","targetHeight","newTargetScaleX","newTargetScaleY","newTargetScale","factor","targetScale","toLocal","zoomAt","targetPosition","toGlobal","deltaY","lowest","zoomAtGlobal","deltaX","DCanvasContainer","_canvas","_view","canvas","isOverflowMaskEnabled","getOverflowMask","updateContentSize","removeChild","_overflowMask","canvasX","canvasY","vresult","onWheel","sresult","skipView","overflowMask","EShapeActionRuntimes","toContainer","openByName","remote","EShapeActionRuntimeEmitEvent","EShapeActionValueEmitEvent","EShapeActionRuntimeMiscEmitEvent","DHtmlElementState","NO_POINTER_EVENTS","UtilHtmlElementWhen","DOUBLE_CLICKED","ALWAYS","operation","_operation","toData","_data","_isElementShown","_onElementFocusBound","onElementFocus","_onBeforeFocusBound","onBeforeFocus","_onAfterFocusBound","onAfterFocus","_isStarted","_wasStarted","_doSelectBound","doSelect","_isStartRequested","when","_onPostRenderBound","updateElement","_rendererBound","UtilHtmlElement","element","toElementData","clipper","toClipperData","before","toBeforeData","after","toAfterData","getWhen","select","getSelect","creator","getElementCreator","styler","newElementStyler","elementRect","elementMatrix","clipperRect","setElementStyle","getClipperCreator","newClipperStyler","setClipperStyle","getBeforeCreator","newBeforeStyler","setBeforeStyle","getAfterCreator","newAfterStyler","setAfterStyle","_element","onEndByBlur","isStartable","doStart","_elementRectResult","getElementRect","getElementMatrix","_clipperRectResult","getClipperRect","rendererBound","getClipper","getBefore","getElement","getAfter","getResolution","toClipperRectAdjusted","getPadding","onElementAttached","display","toElementFocused","scrollTop","scrollLeft","HTMLInputElement","HTMLTextAreaElement","activeElement","containsPoint","mouse","onElementDetached","_before","_after","_clipper","removeEventListener","getElementContainer","focusable","stopImmediatePropagation","ex0","ey0","ex1","ey1","cx1","cy1","ncx0","ncx1","ncy0","ncy1","isFirst","getClippingRect","EShapeActionRuntimeMiscHtmlElementBase","newUtil","newOperation","newUtilOptions","getClipperToRect","newElementCreator","toWhen","WORK","getUtil","EShapeActionValueMiscType","INPUT_TEXT","INPUT_INTEGER","INPUT_REAL","WRITE_BOTH","WRITE_LOCAL","WRITE_REMOTE","HTML_ELEMENT","HTML_ELEMENT_WITHOUT_POINTER_EVENTS","LAYER_SHOW_HIDE","LAYER_GESTURE","GESTURE","elementCreator","ofElementOrNull","noPointerEvent","EShapeActionRuntimeMiscHtmlElement","_onInputKeyDownBound","onInputKeyDown","_onInputChangeBound","onInputChange","_onInputInputBound","onInputInput","_description","description","editing","_editingFormatter","getEditingFormatter","_editingUnformatter","unformatter","getEditingUnformatter","_editingValidator","validator","getEditingValidator","UtilInput","fromValue","getValue","isOkKey","onEnter","isCancelKey","isShown","toValue","oldValue","onValueChange","valueAsString","onValueInput","_editingValidationResult","isInvalid","editingValidationResult","UtilInputInput","_step","getStep","_min","getMin","_max","getMax","UtilInputNumber","onStepChange","onMinChange","onMaxChange","updateMin","updateMax","input","removeAttribute","EShapeActionValueOnInputAction","EShapeActionValueOnInputActions","write","onInputAction","EShapeActionRuntimeMiscInput","EShapeActionRuntimeMiscInputInput","EShapeActionRuntimeMiscInputInteger","EShapeActionRuntimeMiscInputNumber","EShapeActionRuntimeMiscInputReal","UtilInputText","EShapeActionRuntimeMiscInputText","ofUnknown","EShapeActionRuntimeMiscWrite","EShapeActionRuntimeMiscWriteBoth","EShapeActionRuntimeMiscWriteLocal","EShapeActionRuntimeMiscWriteRemote","EShapeActionValueMisc","targetId","EShapeActionValueMiscGestureType","DRAG","PINCH","InteractionEvent","_gestureType","gestureType","_scaleMin","scaleMin","_scaleMax","scaleMax","EShapeActionRuntimeMiscGesture","getGestureUtil","GESTURE_UTIL","newGestureUtil","lcx","lcy","EShapeActionValueMiscGesture","ref","frame","DynamicAtlasItem","resolutionInverse","DynamicAtlasItemEmpty","context","DynamicAtlasItemWhite","save","fillStyle","fillRect","restore","createElement","_baseTexture","BaseTexture","mipmap","MIPMAP_MODES","_idToDatum","_sortedData","_predefined","empty","white","DynamicAtlas","maxRowHeight","datum","minHeight","getContext","applyFrame","ITEM_COMPARATOR","idToDatum","canvasWidth","calcCanvasWidth","canvasHeight","updateFrames","renderFrames","setRealSize","applyFrames","predefined","DynamicAtlasItemFontAtlas","drawImage","ASCII_CHARACTERS","life","DynamicFontAtlasCharacterOrigin","DynamicFontAtlasCharacterType","RESERVED","NON_BREAKING","SPACE","SPACE_R","SPACE_NB","SPACE_RNB","LETTER","LETTER_R","LETTER_NB","LETTER_RNB","_gl","_texture","_shaderProgram","_vertexPositionAttribute","_textureCoordAttribute","_samplerUniform","_sizeUniform","_vb","_uvb","_onLostBound","_onRestoreBound","_onUnloadBound","DynamicSDFFontGenerator","isContextLost","config","antialias","depth","stencil","premultipliedAlpha","gl","clearColor","makeVertexBuffer","makeUvBuffer","makeShaders","shader","createShader","FRAGMENT_SHADER","VERTEX_SHADER","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","console","error","getShaderInfoLog","vertexShader","getShader","fragmentShader","shaderProgram","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","deleteShader","useProgram","getAttribLocation","getUniformLocation","getError","deleteProgram","viewport","createTexture","bindTexture","TEXTURE_2D","texImage2D","RGBA","UNSIGNED_BYTE","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_MAG_FILTER","NEAREST","TEXTURE_MIN_FILTER","deleteTexture","vb","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","deleteBuffer","uvb","COLOR_BUFFER_BIT","vertexPositionAttribute","enableVertexAttribArray","vertexAttribPointer","FLOAT","textureCoordAttribute","activeTexture","TEXTURE0","uniform1i","uniform2f","drawArrays","TRIANGLE_STRIP","copyCanvas","copyContext","destroyVertexBuffer","destroyUvBuffer","destroyShaders","WebGLLoseContext","getExtension","loseContext","_INSTANCE","fontFamily","_generator","_font","DynamicSDFFontAtlas","toFontFamily","italic","_characters","_length","addChar","char","isIgnored","DynamicFontAtlasCharacter","generator","characterSize","toPowerOf2","fontStyle","textAlign","textBaseline","lineCap","lineJoin","miterLimit","measureText","characterWidth","characterHeight","clearRect","fillText","updateTexture","read","toJson","getAutoFontFamily","FONT_FAMILY_AUTO","getFontFamilly","_atlases","DynamicSDFFontAtlases","atlases","addAscii","targets","newAtlas","baseAtlas","getBaseTexture","atlasId","DynamicAtlasItemImage","units","EShapeBufferUnitBuilder","unit","EShapeBufferUnit","ntriangles","nindices","nvertices","_vertexCapacity","_clippingBuffer","_stepBuffer","_colorFillBuffer","_colorStrokeBuffer","isIndicesShort","Uint32Array","_indexCapacity","indexCountRequested","_renderer","_builder","_geometry","EShapeBuffer","vertexBuffer","clippingBuffer","stepBuffer","colorFillBuffer","colorStrokeBuffer","uvBuffer","indexBuffer","Buffer","Geometry","addIndex","addAttribute","getGeometry","unitCount","DRAW_MODES","TRIANGLES","unit0","unit1","ioffset0","ioffset1","valid","uniforms","sampler","draw","vindex","iindex","getVertexOffset","getIndexOffset","noMoreThanOne","getVertexCount","getIndexCount","creater","DUMMY_SHAPES","shapes","EShapeRendererIteratorDatum","_index","_datum","_current","EShapeRendererIterator","datumIndex","newDatum","EShapeRenderer","SHADER","Shader","_shader","_iterator","_bufferSizeMax","getBufferSizeMax","extensions","webGLVersion","uint32ElementIndex","fontAtlases","defaultTexture","textureItem","newTextureItem","updateAtlas","jmax","updateAtlases","fontAtlas","updateFontAtlas","updateFontAtlases","buffers","getBuffers","getAntialiasWeight","getAtlas","getFontAtlases","getDefaultTexture","repack","updateBuffers","shapeScale","toShapeScale","pixelScale","toPixelScale","translationMatrix","toArray","setBlendMode","correctBlendMode","BLEND_MODES","buffersLength","upload","ib","bufferSize","bufferSizeBase","bufferSizeMax","jb","ibmax","ObjectRenderer","_shape","_childrenId","_childrenIdRendered","_atlas","_fontAtlases","_pixelScale","_pixelScaleId","_shapeScale","_shapeScaleId","_work","_buffers","EShapeContainer","childrenId","childrenIdRendered","isChildrenDirty","shapeRenderer","_shapeRenderer","batch","setObjectRenderer","render_","worldID","shapeScaleId","onHit","containsBBox","DisplayObject","DDiagramLayers","toLayer","childrenLength","doBringToFront","targetsLength","layers","_layers","EShapeActionRuntimeMiscLayerGesture","newLayer","EShapeActionValueMiscLayerGesture","_bringToFront","bringToFront","EShapeActionRuntimeMiscLayerShowHide","newCondition","bringAllToFront","showAll","hideAll","toLayers","EShapeActionValueMiscLayerShowHide","layersId","serializeLayers","bringToFrontId","delimiter","deserializeLayers","resourcesLength","DButtonBaseWhen","DAlignHorizontal","DAlignVertical","DAlignWith","BORDER","DImageBaseThemeWrapperSecondary","getSecondaryImageAlignHorizontal","getSecondaryImageAlignVertical","getSecondaryImageAlignWith","getSecondaryImageMarginHorizontal","getSecondaryImageMarginVertial","getSecondaryImageTintColor","getSecondaryImageTintAlpha","getSecondaryImageSource","DImageBaseThemeWrapperTertiary","getTertiaryImageAlignHorizontal","getTertiaryImageAlignVertical","getTertiaryImageAlignWith","getTertiaryImageMarginHorizontal","getTertiaryImageMarginVertial","getTertiaryImageTintColor","getTertiaryImageTintAlpha","getTertiaryImageSource","_textAlign","with","getImageAlignWith","getImageAlignVertical","getImageAlignHorizontal","toImageAlign","_margin","getImageMarginVertial","getImageMarginHorizontal","toImageMargin","_tint","_bound","_source","_computed","_onUpdateBound","DImagePiece","getImageSource","updateTint","bound","getImageTintColor","getImageTintAlpha","isTintAware","toTintColor","toTintAlpha","newComputed","computeSource","oldComputed","oldImage","onUpdateBound","Sprite","newImage","computed","DBaseOverflowMaskSimple","wrappable","DDynamicTextMeasureResultCharacter","isWrappable","countPerLine","clipped","DDynamicTextMeasureResult","fontHeight","imin","last","newLine","DDynamicTextStyleWordWrap","BREAK_ALL","NEW_LINE","DDynamicTextMeasure","RESULT","itr","fh","lh","ce","cw","ch","cp","wordWrap","measure1","measure2","lb","newLineBreaker","measure1a","measure2a","measure1b","measure2b","measure3","measure4","lineBreaker","clippingWidth","clippingHeight","lineBreak","characterPosition","isWrappable1","isPushable","isPushableAtNewLine","measure5","isWrappable2","close","lastType","done","LineBreaker","wordBreak","DDynamicTextGeometry","measure","requiredTextSize","requiredVertexSize","requiredIndexSize","cc","u0","v0","u1","v1","vo","_idApproved","defaultOptions","getDefaultOptions","_fontFamily","_fontSize","fontSize","_fontStyle","_fontVariant","fontVariant","_fontWeight","fontWeight","_wordWrap","_lineHeight","_fontIdId","_fontId","_fontIdApproved","_fillApproved","DDynamicTextStyle","DEFAULT_OPTIONS","newDefaultOptions","getFontSize","getLineHeight","newFontId","_isGeometryDirty","update_","_text","_textApproved","_atlasRevisionUpdated","delta","DDynamicText","textApproved","fontId","fontIdApproved","fillApproved","approve","getDynamicFontAtlases","geometryWidth","geometryHeight","style_1","getRevisionUpdate","revisionUpdate","updateClipping","styleClipping","styleWordWrap","styleLineHeight","DTextBase","_textValue","newTextValue","_textValueComputed","computeTextValue","_textColor","_textAlpha","_textStyle","getFontWeight","getFontStyle","getFontVariant","getTextStyleClipping","getTextStyleWordWrap","toTextStyle","getTextAlignVertical","getTextAlignHorizontal","toTextAlign","_textFormatter","getTextFormatter","_isTextVisible","_isOverflowMaskEnabled","onTextChange","createOrUpdateText","updateTextValue","textValueComputed","createText","updateTextPosition","toRounded","newTextValueComputed","updateTextColor","updateText","DImageBase","_images","newImages","images","toImageOptions","hasSecondaryImageSource","hasTertiaryImageSource","imageSource","updateTextAndImage","pl","pr","pt","pb","noText","textLeftFirst","textTopFirst","textRightLastMargin","textBottomLastMargin","textLeft","textRight","textTop","textBottom","paddingLeft","paddingRight","paddingTop","paddingBottom","borderLeft","borderRight","borderTop","borderBottom","updateSource","updateBound","imageImage","imageBoundWidth","imageBound","imageBoundHeight","imageMargin","imageMarginHorizontal","imageMarginVertical","textLeftAdjust","textCenterAdjust","textRightAdjust","textTopAdjust","textMiddleAdjust","textBottomAdjust","setClippingDelta","textWidth","textHeight","paddingCenterAdjust","paddingMiddleAdjust","borderCenterAdjust","borderMiddleAdjust","DButtonBase","_isToggle","toggle","isToggle","_when","initOnClick","initOnPress","group","onToggleStart","onToggleEnd","onActivate","onInactivate","onActivateKeyDown","onActivateKeyUp","DButton","DButtonPrimary","_shiftX","_shiftY","_onPrerenderBound","onPrerender","_onPostrenderBound","onPostrender","DAnimationFadeIn","_storedTime","removeEventListeners","_layer","_storedTarget","addEventListeners","storedTime","unsafe","_storedX","_storedY","_storedAlpha","UtilAttachAlign","TOP_CENTER","LEFT_TOP","LEFT_MIDDLE","LEFT_BOTTOM","RIGHT_TOP","RIGHT_MIDDLE","BOTTOM_CENTER","OVER","UtilAttach","offsetX","adjust","clippingSize","DDialogCloseOn","ESC","CLICK_OUTSIDE","DDialogMode","MODAL","MODELESS","MENU","DDialogState","UtilClickOutside","_application","UtilOverlay","DDialog","getMode","_mode","_sticky","sticky","isSticky","closeOn","_closeOn","DDialogAlign","_overlay","onCloseOn","onAnimationEnd","_focused","firstFocusable","owner","_promise","Promise","resolve","reject","_resolve","_reject","_owner","pick","onPrerenderBound","onOpen","getBounds","getOffsetX","getOffsetY","getAnimation","doReject","onClose","reason","focusedLayer","DLayoutDirection","VERTICAL","HORIZONTAL","DLayoutSpace","isVisible","DLayout","themeMargin","toMargin","getDirection","toDirection","_cornerAdjust","getCornerAdjust","toCornerAdjust","_multiplicity","row","column","getMultiplicity","toMultiplicity","getReverse","toReverse","multiplicity","clearType","baseSize","marginNext","getSpaceLeft","marginVertical","marginHorizontal","weightTotal","getWeightTotal","cornerAdjustWork","requiredSize","CORNER_ADJUST_WORK","irow","weightTotalInverse","spaceLeft","calcSpaceLeft","k","icolumn1","i1","irow1","icolumn0","i0","findRowIndexPrevious","hasClearTypeAfter","icolumn2","i2","findRowIndexNext","hasClearTypeBefore","ncolumn","countColumn","toCornerMaskColumn","icolumn","irow0","findColumnIndexPrevious","irow2","findColumnIndexNext","nrow","countRow","toCornerMaskRow","hasClearType","DLayoutHorizontal","DLayoutVertical","DDialogCommand","layout","newLayout","onInit","ok","getOk","getCancel","buttonLayout","_buttonLayout","_buttonCancel","active","_buttonOk","toLayoutOptions","getLayoutX","getLayoutY","getLayoutWidth","getLayoutHeight","getLayoutMargin","onOk","getResolvedValue","doResolve","getRejectReason","DText","DDialogInput","labelOptions","toLabelOptions","_label","getMarginHorizontal","getMarginVertical","label","getLabel","_input","newInput","_buttons","_active","_onActiveBound","button","DButtonGroup","_isEnabled","newActive","oldActive","buttons","DInputBooleanButtonOff","DInputBooleanButtonOn","getButtonOff","getButtonOn","getButtonGroup","DInputBoolean","_buttonGroup","newButtonGroup","_buttonOn","newButtonOn","_buttonOff","newButtonOff","DDialogInputBoolean","toInputOptions","isOpened","EShapeActionRuntimeOpenDialog","target_1","initial_1","open","then","EShapeActionRuntimeOpen","ofBooleanOrFalse","EShapeActionRuntimeOpenDialogBoolean","dialog","DIALOG","DHtmlElement","_util","util","DInput","hideText","showText","validate","DInputInput","DInputNumber","DInputInteger","DDialogInputInteger","EShapeActionRuntimeOpenDialogInteger","DInputReal","DDialogInputReal","EShapeActionRuntimeOpenDialogReal","DInputText","DDialogInputText","EShapeActionRuntimeOpenDialogText","EShapeActionRuntimeOpenDiagram","EShapeActionRuntimeOpenPage","EShapeActionRuntimeOpenPageInplace","location","href","EShapeActionValueOpenType","DIAGRAM","PAGE","PAGE_INPLACE","DIALOG_TEXT","DIALOG_INTEGER","DIALOG_REAL","DIALOG_BOOLEAN","DIALOG_DATE","DIALOG_TIME","DIALOG_DATETIME","DButtonAmbient","DPickerDatetimeButtonBack","DPickerDatetimeButtonDate","DPickerDatetimeButtonNext","DPickerDatetimeLabel","DPickerDatetimeLabelDate","DPickerDatetimeSpace","DPickerDatetimeMask","HOURS","MINUTES","SECONDS","TIME","DPickerDatetimeMasks","themeOrThemeName","_date","_inclusive","inclusive","DPickerTimeBound","DPickerTimeBoundHours","lower","lowerDate","constant","hour","lowerDateHours","second","minute","upper","upperDate","upperDateHours","DPickerTimeBoundMinutes","lowerDateMinutes","upperDateMinutes","DPickerTimeBoundSeconds","newConstant","hours","minutes","seconds","DPickerTimeBounds","test","getTime","setSeconds","setMinutes","setHours","setDate","am","bm","ad","bd","ah","bh","compare","toBoundOptions","defaultDate","defaultInclusive","onNewChange","DPickerTime","_dateCurrent","dateCurrentTime","_dateNew","_dateBounds","getLowerBound","isLowerBoundInclusive","getUpperBound","isUpperBoundInclusive","toBoundsOptions","newChildren","dateCurrent","dateNew","_inputHours","_inputMinutes","_inputSeconds","currentTime","onReset","dateBounds","inputHours","inputMinutes","inputSeconds","newInputHours","newInputMinutes","newInputSeconds","newTimeLayout","newTimeLayoutChildren","getTimeLayoutWidth","getTimeLayoutHeight","newMinuteSeparator","newSecondSeparator","getMinuteSeparator","getSecondSeparator","inputOptions","getHoursOptions","adjustInputOptions","onHoursChange","getMinutesOptions","onMinutesChange","getSecondsOptions","onSecondsChange","DPickerDatetime","_datePage","_dateButtons","newDateButtons","_dateDecorator","decorator","getDateDecorator","newLabel","newBackButton","newNextButton","newDateLabels","datePage","onPageChange","setFullYear","spaceCount","getDay","getDayStart","show","dateDecorator","dateCount","dateNewDate","labelText","labelTextAlign","getLabelFormatter","buttonOptions","back","getBackButtonOptions","getNextButtonOptions","dateLabels","getDayLabels","dayStart","newDateLabel","newSpace","newDateButton","onDateButtonClicked","setMonth","DDialogDatetime","new","page","_picker","EShapeActionRuntimeOpenDialogDatetime","toDate","toISOString","DDialogTime","isNaN","EShapeActionRuntimeOpenDialogTime","getPattern","toHours","toMinutes","toSeconds","milliseconds","toMilliseconds","setMilliseconds","toNumber","length_1","num","PATTERN","newPattern","FORMATTER","DPickerDate","DDialogDate","EShapeActionRuntimeOpenDialogDate","EShapeActionValueOpen","initialId","EShapeActionValueShowHideType","SHOW","HIDE","visibility","EShapeActionRuntimeShowHide","EShapeActionValueShowHide","EShapeActionRuntimeTransformMoveAbsoluteX","EShapeActionRuntimeTransformMove","EShapeActionRuntimeTransformMoveAbsoluteY","EShapeActionRuntimeTransformMoveForwardOrBackward","writtenPositionX","writtenPositionY","oldPositionX","oldPositionY","EShapeActionRuntimeTransformMoveLeftOrRight","EShapeActionRuntimeTransformMoveRelativeX","EShapeActionRuntimeTransformMoveRelativeY","opetype","EShapeActionValueOpetyped","EShapeActionValueTransformMoveType","RELATIVE_X","RELATIVE_Y","ABSOLUTE_X","ABSOLUTE_Y","FORWARD_OR_BACKWARD","LEFT_OR_RIGHT","EShapeActionValueTransformType","RESIZE","MOVE","ROTATE","EShapeActionValueTransformMove","amountId","toSizeNormalized","EShapeActionValueTransformResizeType","RELATIVE_SIZE","RELATIVE_HEIGHT","RELATIVE_WIDTH","ABSOLUTE_SIZE","ABSOLUTE_HEIGHT","ABSOLUTE_WIDTH","ofNumberOrOne","ofNumberOrOneHundred","EShapeActionRuntimeTransformResize","dsx","dsy","EShapeActionRuntimeTransformResizeHeightAbsolute","sizeAbsolute","oldSizeY","adjustPosition","EShapeActionRuntimeTransformResizeHeightRelative","sizeRelative","EShapeActionRuntimeTransformResizeSizeAbsolute","writtenWidth","writtenHeight","oldSizeX","EShapeActionRuntimeTransformResizeSizeRelative","EShapeActionRuntimeTransformResizeWidthAbsolute","EShapeActionRuntimeTransformResizeWidthRelative","EShapeActionValueTransformResize","EShapeActionRuntimeTransformRotate","oldRotation","newRotation","EShapeActionRuntimeTransformRotateAbsolute","EShapeActionRuntimeTransformRotateRelative","EShapeActionValueTransformRotateType","RELATIVE","ABSOLUTE","EShapeActionValueTransformRotate","deserializeActionValue","getAction","toSerialized","deserializer","deserializeGradient","imageElementCache","toImageElement","dataUrl","cachedImageElement","HTMLImageElement","imageElement","onload","onabort","onerror","deserializeBase","item23","item24","item25","item26","childrenPromise","childrenOrPromises","serializedActions","gradientId","imagePromise","imageId","deserializeBar","deprecated","loadShapeBar","EShapeCapability","ID","SKEW","ALIGN","REPLACING","GROUPING","BORDER_RADIUS","TEXTURE","ORDER_IN_LAYER","COORDINATE","SHAPE","LAYER","PRIMITIVE","EShapeCapabilities","capability","mappings","EShapeRuntimes","RECTANGLE_ROUNDED_VERTEX_COUNT","RECTANGLE_ROUNDED_WORLD_SIZE","RECTANGLE_ROUNDED_WORK_POINT","buildRectangleRoundedIndex","buildRectangleRoundedVertex","worldSize","rx","ry","dxh","dyh","dxhr","dyhr","x4","y4","x11","y11","dxv","dyv","dxvr","dyvr","x7","y7","x5","y5","x6","y6","x9","y9","x8","y8","x10","y10","x12","y12","x20","y20","x15","y15","x13","y13","x14","y14","x17","y17","x16","y16","x18","y18","x19","y19","x22","y22","x21","y21","buildRectangleRoundedClipping","rxc","ryc","buildRectangleRoundedStep","wt","zt","wr","zr","wb","zb","wl","zl","sc","buildRectangleRoundedUv","ruvx","ruvy","x02","y02","BuilderRectangleRounded","updateVertexClippingStepAndUv","isStrokeChanged","isCornerChanged","isVertexChanged","createRectangleRoundedUploaded","createButtonUploaded","hitTestRectangleRounded_","by1","bx1","hitTestRectangleRounded","hasLeftSide","hasTopSide","hasBottomSide","hasRightSide","EShapeRectangleRounded","_isGrouped","EShapeButton","isGrouped","deserializeButton","setExtension","initializer","fillColor","fillColorOnHovered","toOnHovered","fillColorOnPressed","_fillColor","_fillColorDisabled","toGrayscale","_fillColorPressed","_fillColorHovered","fillAlpha","_fillAlpha","_fillAlphaDisabled","strokeColor","strokeColorOnHovered","strokeColorOnPressed","_strokeColor","_strokeColorDisabled","_strokeColorPressed","_strokeColorHovered","strokeAlpha","_strokeAlpha","_strokeAlphaDisabled","textColor","_textColorDisabled","textAlpha","_textAlphaDisabled","textOutlineColor","_textOutlineColor","_textOutlineColorDisabled","textOutlineAlpha","_textOutlineAlpha","_textOutlineAlphaDisabled","EShapeButtonRuntimeAction","luma","getTextOutlineColor","getTextOutlineAlpha","inDisabled","fillColorActive","_fillColorActive","fillColorActiveOnHovered","fillColorActiveOnPressed","_fillColorActivePressed","_fillColorActiveHovered","strokeColorActive","_strokeColorActive","strokeColorActiveOnHovered","strokeColorActiveOnPressed","_strokeColorActivePressed","_strokeColorActiveHovered","_strokeColorGrayscaleHovered","_textColorActive","EShapeButtonRuntimeActionToggle","EShapeButtonRuntime","wasClicked","onActivated","loadShapeButton","CIRCLE_WORLD_SIZE","CIRCLE_WORK_POINT","buildCircleClipping","buildCircleIndex","buildCircleVertex","buildCircleStep","buildCircleUv","BuilderCircle","updateVertexAndStep","createCircle","EShapeCircle","deserializeCircle","loadShapeCircle","LINE_WORK_POINT","toPointsCount","toLinePointCount","toLineVertexCount","pointCount","isClosed","toLineIndexCount","buildLineClipping","buildLineIndex","io","buildLineUv","lengthInverse","dx32","dy32","iuvmax","buildLineVertexStepAndColorFill","pointsClosed","pointSegments","transformedPointValues","buildTransformedLineVertexStepAndColorFill","fillTransformedLineVertexStepAndColorFill","pprevx","pprevy","pnextx","pnexty","llo","lineVertexCount","lineIsClosed","lineVertices","lineSegments","lineSegmentsLength","lmax","lprev","ivoffset","iseg","iprevseg","buildTransformedLineOpenSegmentVertexStepAndColorFill","buildTransformedLineEmptyVertexStepAndColorFill","buildTransformedLineClosedSegmentVertexStepAndColorFill","lineVertexFrom","lineVertexTo","ifirst","isecond","imiddle","icf0","ilast","pointId","BuilderLine","updateLineClipping","updateLineVertexStepAndColorFill","updateLineUv","isPointChanged","TRIANGLE_WORLD_SIZE","TRIANGLE_WORK_POINT","buildTriangleClipping","buildTriangleIndex","buildTriangleVertex","xb","yb","buildTriangleStep","buildTriangleUv","BuilderMarkerBase","toMarker","BuilderMarkerTriangle","updateVertexStepAndUv","BuilderMarkerTriangleHead","BuilderMarkerTriangleTail","BuilderMarkerCircle","BuilderMarkerCircleHead","BuilderMarkerCircleTail","BuilderNull","toIndexOf","array","v2","PID","PIH","vdot","vlen","vcross","pset","a1x","a1y","a2x","a2y","angle1","angle2","angle3","a1","axis1","a2","axis2","angle","pcopy","acopy","sourceLength","UtilCurve","center1","angle10","angle11","axis11","axis12","center2","angle20","angle21","axis21","axis22","nsegment","isAdaptive","isEdge","resultIndex","t1","c1","s1","t2","c2","s2","t3","c3","s3","cc3","ss3","toParameter","rvalues","rsegments","c0","WORK_P0","WORK_P1","WORK_P2","rvaluesCount","rsegmentCount","d01x","d01y","d12x","d12y","m1x","m1y","m2x","m2y","n1x","n1y","n2x","n2y","det","s_1","l1","l2","dc2x","dc2y","atan2","dc0x","dc0y","d10x","d10y","a_1","l0","amax","acos","acurrent","adelta","lmin","beta","asin","e3x","e3y","n3x","n3y","we","wn","e0x","e0y","circle","toCircle","amin","toEllipse","eShapePointsFormatterCurve","interpolate","toHybrid","CURVE_SEGMENT_COUNT","toPointsBoundary","_lockCount","_isTypeChanged","_isSizeChanged","_isFillChanged","_transformId","EShapePointsMarkerBase","onTypeChange","onFillChange","parentParent","toTransform","identity","f","fillId","EShapePointsMarkerHead","toTransformMatrix","EShapePointsMarkerTail","_head","_tail","EShapePointsMarkerContainerImpl","onMarkerTypeChange","onMarkerSizeChange","onMarkerFillChange","headId","tailId","_valuesBaseLength","_parentSizeBase","_parentSizeFitted","_formattedId","EShapeLinePoints","_valuesBase","psizef","psize","psizeX","psizeY","psizeBase","isValidX","isValidY","valuesBase","_formatted","formattedValues","formattedValuesBase","_formattedValuesBase","formattedBoundary","formattedBoundaryBase","_formattedBoundaryBase","newMarker","_formatter","toScaled","boundaryBase","sizeBase","hasSizeBaseX","hasSizeBaseY","isUpdated","styleFormatter","valuesBaseLength","newValuesLength","iupdate","toFitted","newSegmentsLength","revalidate","markerId","WORK_RANGE","RECTANGLE_VERTEX_COUNT","RECTANGLE_INDEX_COUNT","RECTANGLE_WORLD_SIZE","RECTANGLE_WORK_POINT","buildRectangleClipping","brxi","bryi","buildRectangleIndex","buildRectangleVertex","b0x","b0y","b1x","b1y","b2x","b2y","b3x","b3y","brx","bry","d03x","d03y","buildRectangleStep","fillRectangleStep","v3","v4","v5","buildRectangleUv","BuilderMarkerRectangle","BuilderMarkerRectangleTail","BuilderMarkerRectangleHead","toMarkerVertexCount","toMarkerIndexCount","toBuilderMarkerHead","toBuilderMarkerTail","createLineUploaded","lvcount","licount","mttype","mhtype","mtvcount","mticount","mtvoffset","mtioffset","mhvcount","mhicount","mhvoffset","mhioffset","tvoffset","tioffset","EShapeConnectorBodies","tailMargin","headMargin","ex","ey","EShapeAcceptorImpl","EShapeAcceptorType","TAIL","HEAD","EShapeAcceptors","acceptor","typeToAcceptor","_typeToAcceptor","getDefault","_default","newDefault","_edge","EShapeConnectorEdgeAcceptorImpl","onAcceptorChange","_acceptor","onLocalChange","_localIdRequired","_localId","_isAcceptorChanged","_isLocalChanged","_isOtherChanged","EShapeConnectorEdgeImpl","onOtherChange","localX","localY","shapeUuid","edgeId","mapping","localIdRequired","acceptorShape","acceptorEdge","WORK_UPDATE_LOCAL","onChangeBound","EShapeConnectorEdgeContainerImpl","EShapeConnectorBodyImpl","_tailLocalId","_tailMargin","_headLocalId","_headMargin","_bodyId","hx","hy","_body","EShapeConnectorLine","tailLocalId","localId","headLocalId","bodyId","tailLocal","tailLocalX","tailLocalY","headLocal","headLocalX","headLocalY","bodyValues","bodyValuesLength","transformPosition","cx_1","cy_1","WORK_BOUNDARY","deserializeConnectorLine","onDeserializedConnectorLine","loadShapeConnectorLine","BuilderRectanglePivoted","createRectanglePivotedUploaded","createGroupUploaded","EShapeGroupTextAlignEditor","EShapeGroupTextOffsetEditor","EShapeGroupTextOutlineEditor","EShapeGroupTextPaddingEditor","EShapeGroupTextSpacingEditor","EShapeGroupTextEditor","EShapeGroupFillViewer","internalTransformParentInverse","EShapeTransforms","editor","EShapeEditor","invert","disallowOnTransformChange","allowOnTransformChange","keepSize","newLocalTransform","append","applyLocal","shapeBase","EShapeGroupSizeLayout","baseX","baseY","pivotX","pivotY","childBase","WORK_TRANSFORM","translate","isFittable","_layouts","_isFittable","EShapeGroupSizeEditor","ox","oy","doFit","rect","calcRect","_workRectForFit","layouts","workPoint","_workPoint","workRect","_workRectForCalcRect","getBoundsLocal","enlarge","onChange_","_x","_y","_base","EShapeGroupSizeViewer","EShapeGroupStrokeViewer","EShapeGroupTextAlignViewer","EShapeGroupTextOffsetViewer","EShapeGroupTextOutlineViewer","EShapeGroupTextPaddingViewer","EShapeGroupTextSpacingViewer","EShapeGroupTextViewer","isEditMode","_isEditMode","newGroupSize","newGroupFill","newGroupStroke","newGroupText","EShapeGroupViewer","isGroupSizeFittable","_name","EShapeEmbedded","newClone","clone","addPiece","EShapeLayerState","INVISIBLE","INTERACTIVE","DRAGGABLE","PINCHABLE","EShapeEmbeddedLayer","deserializeName","positionX","positionY","isInteractive","isDraggable","isPinchable","EShapeRectangle","deserializeEmbedded","pieces","pieceId","pieceData","piece","pieceDatum","rectangle","createMissing","loadShapeEmbedded","EShapeGroupFillEditor","EShapeGroupPoints","toPoints","EShapeGroupStrokeEditor","newGroupPoints","EShapeGroup","deserializeGroup","loadShapeGroup","EShapeGroupSizeShadowed","EShapeGroupShadowed","deserializeGroupShadowed","loadShapeGroupShadowed","BuilderRectangle","createRectangleUploaded","EShapeImage","deserializeImage","loadShapeImage","IMAGE_SDF_WORLD_SIZE","IMAGE_SDF_WORK_POINT","buildImageSdfClipping","buildImageSdfIndex","buildImageSdfStep","textureWidth","textureHeight","scaleZ","strokeWidthMax","buildImageSdfVertex","buildImageSdfUv","textureUv","BuilderImageSdf","isTextureSizeChanged","createImageSdfUploaded","EShapeImageSdf","deserializeImageSdf","BuilderLabel","createLabelUploaded","EShapeLabel","deserializeLabel","loadShapeLabel","EShapeLine","deserializeLine","loadShapeLine","buildNullClipping","buildNullVertex","buildNullStep","buildNullUv","toLineOfAnyPointCount","buildLineOfAnyColor","vcountPerPoint","colorDef","alphaDef","isStaticColor","isStaticAlpha","pointCountReserved","pointSizeId","pointOffsetId","pointFillId","pointStrokeId","BuilderLineOfAny","pointFill","isPointFillChanged","isFillEnabled","isFillChanged","pointStroke","isPointStrokeChanged","isStrokeEnabled","copyClipping","icd","ics","copyIndex","icountPerPoint","idiv","iid","iis","copyStep","iss0","isd","iss","copyUvs","iuvd","iuvs","copyVertex","pointsValues","pointOffset","isStaticX","isStaticY","ip","ivd","ivs","isStatic","toComputed","EShapeLineOfAnyPointsFillImpl","defX","defY","_defX","_defY","_limit","_limitComputed","_limitId","_limitParentLength","EShapeLineOfAnyPointsPointImpl","limit","updateLimitComputed","limitId","limitParentLength","calcLimit","parentLenght","EShapeLineOfAnyPointsStrokeImpl","_valuesLength","_stroke","EShapeLineOfAnyPointsImpl","getLimit","o","BuilderLineOfCircles","updateLineOfAnyColorFill","updateLineOfAnyColorStroke","pointSize","isPointSizeChanged","pointSizeX","pointSizeY","voffsetReserved","vcountReserved","createLineOfAnyUploaded","pvcount","picount","createLineOfCirclesUploaded","_tester","containsPointAbs","EShapeLineOfCircles","deserializeLineOfCircles","loadShapeLineOfCircles","BuilderLineOfRectangleRoundeds","createLineOfRectangleRoundedsUploaded","EShapeLineOfRectangleRoundeds","deserializeLineOfRectangleRoundeds","loadShapeLineOfRectangleRoundeds","BuilderLineOfRectangles","createLineOfRectanglesUploaded","EShapeLineOfRectangles","deserializeLineOfRectangles","loadShapeLineOfRectangles","TRIANGLE_ROUNDED_VERTEX_COUNT","TRIANGLE_ROUNDED_WORLD_SIZE","TRIANGLE_ROUNDED_WORK_POINT","buildTriangleRoundedIndex","buildTriangleRoundedVertex","sz","rz","dx14","dy14","dx47r","dy47r","dx71","dy71","buildTriangleRoundedClipping","buildTriangleRoundedStep","sr","buildTriangleRoundedUv","BuilderLineOfTriangleRoundeds","isRadiusChanged","createLineOfTriangleRoundedsUploaded","containsCorner","r12","r13","xl","yl","ni","nlx","nly","nrx","nry","deti","xc","yc","containsCorner_","hitTestTriangleRounded","az","EShapeTriangleRounded","EShapeLineOfTriangleRoundeds","deserializeLineOfTriangleRoundeds","loadShapeLineOfTriangleRoundeds","BuilderLineOfTriangles","updateVertexStepAndUvs","createLineOfTrianglesUploaded","EShapeTriangle","EShapeLineOfTriangles","deserializeLineOfTriangles","loadShapeLineOfTriangles","createNullUploaded","EShapeNull","deserializeNull","loadShapeNull","deserializeRectangle","loadShapeRectangle","BuilderTriangleRounded","BuilderTriangle","createImageSdf","convertToSdf","toDataURL","createTriangleRoundedUploaded","createTriangleUploaded","_shapes","EShapeUuidMappingImpl","getUuidToShape","_uuidToShape","newUuidToShape","fillUuidToShape","deserializeAll","serializeds","resolved","callOnDeserialized","onDeserialized","deserializeRectangleRounded","deserializeTriangleRounded","deserializeTriangle","EShapeConnectors","sources","destinations","_MAPPING","fromChild","toChild","newMapping","rootSources","rootDestinations","isConnector","sourceEdge","destEdge","sourceHead","sourceHeadShape","destHeadShape","destHead","sourceTail","sourceTailShape","destTailShape","destTail","moveAll","fromChildren","toChildren","EShapeEmbeddedLayerContainer","hasConnectors","_hasConnectors","newHasConnectors","serializedLayers","serializedLayersLength","tags","_actions","_fills","_strokes","_dataValues","_ranges","_aligns","_margins","_texts","_textOutlines","_extensions","EShapeResourceManagerDeserialization","dataValue","extension","DDiagrams","version","thumbnail","tile","items","snap","serializedItems","shapePromises","serializedItem","controller","onFulfilled","toPieceData_","promises","getByName","found","toPieceData__","serializedOrSimple","EShapeEmbeddedDatum","EShapeEmbeddeds","toPieceData","from_","EShapeRectanglePivoted","toSvgUrl","svg","btoa","toSizeRounded","deserializeRectanglePivoted","loadShapeRectangleRounded","loadShapeTriangle","loadShapeTriangleRounded","loadShapeAll","DImage","DMenuItemBase","onSelect","selection","hasSelection","getSelection","onKeyDownActivate","DMenuItem","getCloseable","DMenuItemText","initOnOver","initShortcuts","shortcutTextValue","_shortcutText","_shortcutMargin","getShortcutTextMargin","shortcutText","getShortcutColor","getShortcutAlpha","updateShortcutText","closeable","DMenuItemCheck","DMenuItemCheckIsCompatible","DLinkMenuItemId","OPEN_LINK","OPEN_LINK_IN_NEW_WINDOW","COPY_LINK_ADDRESS","DMenus","CREATORS","CREATOR_DEFAULT","MENU_CREATOR","creators","creatorDefault","newItemOf","newItem","newItemsOf","DLinkMenu","_menu","toMenu","menu","newMenu","DLinkTarget","AUTO","THIS_WINDOW","createRange","selectNodeContents","removeAllRanges","addRange","toClipboardData","clipboardData","UtilClipboard","clipboard","navigator","writeText","ClipboardEvent","copyUsingWindow","div","setAttribute","textContent","appendChild","execCommand","copyUsingDiv","userAgent","span","innerText","attachShadow","copyUsingSpan","_url","url","toNormalizedTarget","_checker","DLink","getMenuOptions","onResolved","ANCHOR_ELEMENT","toStringifiedUrl","toNormalizedUrl","inNewWindow","checked","rel","click","metaKey","isSimulated","DLinks","DMenuItemLink","toUrl","toChecker","_link","toLinkOptions","toStateOptions","DMenuItemLinkIsCompatible","DMenuItemMenu","initHover","onMenuSelect","isHidden","onKeyDownArrowRight","DMenuItemMenuIsCompatible","DMenuItemMenuToSubMenuOptions","DMenuAlign","DMenuItemSeparatorReflowable","borderAlign","middle","DMenuItemSeparatorIsCompatible","DMenuItemSeparator","DMenuItemSpace","DMenuItemSpaceIsCompatible","loadMenuItem","addItemCreator","setItemCreatorDefault","DMenuItemExpandableBody","DMenuItemExpandableHeader","DMenuItemExpandables","DMenuItemExpandable","header","toHeader","_header","toBody","newItems","onDeactivated","newHeader","newBody","DMenuItemExpandableIsCompatible","DMenuItemExpandableItemCheck","DMenuItemExpandableItemLink","DMenuItemExpandableItemSeparator","DMenuItemExpandableItemSpace","DMenuItemExpandableItemText","loadMenuItemExpandable","DMenuSidedItemCheck","DMenuSidedItemLink","DMenuSidedItemMenu","DMenuSidedItemSeparator","DMenuSidedItemSpace","DMenuSidedItemText","DMenuSideds","loadMenuSidedItem","DMenuSidedItemExpandables","DMenuSidedItemExpandable","DMenuSidedItemExpandableItemCheck","DMenuSidedItemExpandableItemLink","DMenuItemExpandableItemMenu","DMenuSidedItemExpandableItemMenu","DMenuSidedItemExpandableItemSeparator","DMenuSidedItemExpandableItemSpace","DMenuSidedItemExpandableItemText","loadMenuSidedItemExpandable","loadMenuItemAll","loadAll","EShapeSearch","shapeA","shapeB","toDepth","isParent","shapeParent","findChildById","findChildByType","matcher","findChild","findChildrenByType","findChildren","EShapeDeleter","generateListOfDetachedShapes","COMPARATOR_INDEX","EShapePointsStyles","resourceToIndex","dataToIndex","pieceToIndex","uuids","uuidNext","EShapeResourceManagerSerialization","add_","newUuid","map","_isVisible","ESnapperGrid","ESnapperResult","snapped","newDistance","oldDistance","ESnapperTargetValueType","ESnapperTargetValue","ESnapperTarget","valueA","EPSILON","ESnapperModifierAnchor","MIDDLE_LEFT","MIDDLE_RIGHT","_normals","_lengths","_workScale","_workSnapResultX","_workSnapResultY","_workScaleResult","_workTranslate","_workSnapRectangle","_workSnap","grid","ESnapper","prepare","workTranslate","newDx","newDy","baseRotation","deltaRotation","gridSize","getGridSizeRotation","newRotationDegree","toDegree","newRotationDegreeResidual","toRadian","p0","p1","anchor","normals","lengths","calcNormalizedVector","axis","normal","mx","setScaleSnappedResult","my","calcScaleSnapped1D","detA","mdx","mdy","pointO","pointX","pointY","calcScaleSnapped2D","calcScaleSnappedX","calcScaleSnappedY","calcScaleSnappedXY","DynamicAtlasItemText","hex2string","metrics","TextMetrics","measureFont","ascent","descent","fontColor","_context","toPadding","DynamicFontAtlasFont","_unrefCount","_revision","_revisionUpdated","scaleMode","SCALE_MODES","DynamicFontAtlas","getAdvance","remove_","cleanup_","realWidth","realHeight","updateAll","colorToAltas","destroyAll","DynamicFontAtlases","colorToAtlas","newInstance","Lazy","toCeilingIndex","_ratio","_frames","_svg","_nextX","_nextY","UtilSvgAtlasBuilder","path","frames","build","built","_built","force","pow","log","LN2","scaling","frames_1","UtilExtractor","skipUpdateTransform","RenderTexture","matrix","renderTexture","pixels","Uint8Array","readPixels","ignorePremutipliedAlpha","canvasRenderTarget","CanvasRenderTarget","imageData","getImageData","Extract","arrayPostDivide","putImageData","scaledWidth","scaledHeight","scaledImageData","quality","UtilFileDownloader","filename","contents","insertBom","blob","Blob","msSaveBlob","downloadUrl","URL","createObjectURL","UtilExtract","toResolution","toRenderer","toPixels","premultiplied","ignore","toScale","toCanvas","toBase64","base64","UtilFileAs","DATA_URL","BINARY_STRING","ARRAY_BUTTER","FILE","as","facade","_as","_facade","UtilFileOpener","getOrCreateInput","input_1","files","file_1","fileReader","FileReader","onAboart","readAsText","readAsDataURL","readAsBinaryString","readAsArrayBuffer","file","UtilHsv","v","UtilInputTextArea","UtilName","_mapping","UtilRgba","delay","_targets","_delay","_interval","_timeout","_updateBound","UtilStateBlinker","timeout","_lastUpdate","_updateId","UtilTransition","updateId","lastUpdate","remaining","UtilWheelEvent","_names","documentMode","useCapture","names","getNames","name_2","_pageHeight","detail","wheelDelta","wheelDeltaY","wheelDeltaX","HORIZONTAL_AXIS","_timestamp","_lowest","shouldAdjust","deltaMode","getPageHeight","DAnimationEmpty","DApplicationPadding","_root","overlay","getBoundingClientRect","bbox","transparent","_pixi","autoStart","DApplicationLayerOptions","updateWidthAndHeight","pixi","DCommandFlag","UNSTORABLE","CLEAR","DCommandClear","DCommandRedo","DCommandUndo","isCommandStorable","command","getFlag","_done","_waiting","_executing","DControllerDefaultCommand","waiting","command_1","undo","onSuccess","onFail","redo","isClear","isStorable","isRedoable","isUndoable","DControllerKeyboard","hasOnKeyDown","isFocusKey","getFocusDirection","hasOnKeyUp","DControllers","KEYBOARD","COMMAND","DOCUMENT","getPixiApplicationOptions","_isOverlay","isOverlay","_rootElement","getRootElement","_refitLimit","_reflowLimit","_elementContainer","newElementContainer","_renderBound","_renderId","initStage","initView","initRootElement","initFocusHandling","initResizeHandling","initWheelHandling","initDoubleClickHandling","DApplicationLayer","webkitTapHighlightColor","webkitUserSelect","setProperty","userSelect","rootElement","elementContainer","insertionPosition","insertBefore","stage_1","oldOnChildrenChange_1","onStageDirty","rootElementStyle","getComputedStyle","overflow","getKeyboardController","onResizeBound","bboxWidth","bboxHeight","wheelEvent","hitTest","requestAnimationFrame","screen","ilimit","_dynamicFontAtlases","Application","DControllerDefaultFocus","mightBeFocusable","includesTarget","includesTargetChildren","findNext","findPrevious","isFocusableContainer","inEnabled","toRootElement","Renderer","__plugins","accessibility","newLayerBase","_isOverlayEnabled","DApplication","querySelector","_focus","hasFocus","onBlured","toLayerBaseOptions","toLayerOverlayOptions","newLayerOverlay","getCallback","DBasePaddingAdjustable","getTheme","DBoard","DButtonCheck","DButtonCheckRight","_selected","DColorGradientPointObservable","POINT_SORTER","_onChangeBound","first","_workColor","DColorGradientObservable","isSelectionChanged","rgb0","hex2rgb","g0","b0","rgb1","g1","b1","rgb","rgb2hex","oldDirection","oldSelected","pointsCopy","pointLike","DInputLabel","createInput","space","DInputAndLabel","DInputRealAndLabel","DInputTextAndLabel","colorAndAlpha","onColorChange","onAlphaChange","_colorAndAlpha","_onColorChange","_onAlphaChange","DPickerColorAndAlpha","recents","_recents","DPickerColorRecent","recent","DPickerColor","_currentPicker","_newPicker","_recent","_new","setColorNew","setAlphaNew","setColorCurrent","setAlphaCurrent","_pointerPoint","mainWidth","getMainWidth","mainHeight","getMainHeight","mainBaseSprite","_mainBaseSprite","mainSprite","getMainTexture","_mainSprite","_onMainMoveBound","onMainMove","_onMainUpBound","onMainUp","onMainDown","baseSprite","_baseSprite","getBaseMargin","_onBaseMoveBound","onBaseMove","_onBaseUpBound","onBaseUp","onBaseDown","alphaCheckerboardSprite","getAlphaCheckerboardTexture","_alphaCheckerboardSprite","getBaseHeight","alphaSprite","getAlphaTexture","_onAlphaMoveBound","onAlphaMove","_onAlphaUpBound","onAlphaUp","onAlphaDown","mainPointerSprite","getMainPointerTexture","_mainPointerSprite","getMainPointerColor","getMainPointerAlpha","alphaPointerSprite","getAlphaPointerTexture","_alphaPointerSprite","getAlphaPointerColor","getAlphaPointerAlpha","basePointerSprite","getBasePointerTexture","_basePointerSprite","getBasePointerColor","getBasePointerAlpha","_recentColorSprites","recentColorSprites","recentColorCount","getRecentColorCount","recentColorWidth","getRecentColorWidth","recentColorHeight","getRecentColorHeight","recentColorWidthHalf","recentColorHeightHalf","recentColorMargin","getRecentColorMargin","recentColorY","getAlphaHeight","getRecentMargin","recentCheckerboardTexture","getRecentCheckerboardTexture","RECENT_COLORS","getRecents","onRecentChange","onRecentClick","checkerboardSprite","currentTarget","sprite","buttonMode","recentColorAndAlpha","inputMargin","getInputMargin","inputLabelWidth","getInputLabelWidth","inputY","inputWidth","inputAndLabelColor","fromCode","_inputAndLabelColor","inputHeight","inputAndLabelAlpha","_inputAndLabelAlpha","sampleWidth","sampleHeight","sampleX","sampleY","sampleCurrentCheckerboardSprite","getSampleCheckerboardTexture","_sampleCurrentCheckerboardSprite","sampleCurrentSprite","_sampleCurrentSprite","sampleNewCheckerboardSprite","_sampleNewCheckerboardSprite","sampleNewSprite","_sampleNewSprite","onMainPick","hw","ux","uy","toMainHex","onColorNew","toMainColor","hsv","fromRgb","toRgb","ns","nv","toCode","onBasePick","toBaseHex","onColorBase","toBaseColor","onAlphaPick","onAlphaNew","sprites","isEqual","ap","bp","apj","bpj","DPickerColorGradientRecent","nPointsPerData","_nPointsPerData","_colors","_lastHitIndex","_parts","uSampler","DPickerColorGradientView","setColors","setColorsHex","setColorsWhite","setVertices","setUvs","newIndices","setColorsPoint","checkerColors","uCheckerColors","DPickerColorGradient","gradientPointsWidth","getGradientPointsWidth","gradientPointsMargin","getGradientPointsMargin","onAnchorColorChange","onAnchorAlphaChange","getGradientCheckerColors","setRectangle","getLastHitIndex","onViewDown","_onAnchorDownBound","onAnchorDown","_onAnchorMoveBound","onAnchorMove","_onAnchorUpBound","onAnchorUp","_anchors","recentColumn","getGradientRecentColumn","recentWidth","getGradientRecentWidth","recentMargin","getGradientRecentMargin","recentWidthAndMargin","inputDirectionMargin","getGradientDirectionMargin","inputDirectionTexture","getGradientDirectionTexture","inputLeft","inputDirection","change","RECENT_COLOR_GRADIENT","getGradientRecents","getGradientRecentCount","getCapacity","onRecentUpdate","lastHitIndex","updateAnchors","onAnchorSelect","recentData","fromObject","toAnchorPosition","onAnchorDragStart","anchorTexture","getGradientAnchorTexture","anchorOutlinedTexture","getGradientAnchorOutlinedTexture","anchors","anchorSize","newAnchor","oldAnchor","isDeleteKey","DDialogColorGradient","DButtonColorGradient","getViewBaseTexture","checkers","getCheckerColors","_dialog","DDialogColor","DButtonColor","updateTextForcibly","dialogCurrent","dialogNew","toClone","toImageTintOptions","DButtonDanger","DDialogDates","DButtonDate","DDialogDatetimes","DPickerDates","DPickerTimes","DPickerDatetimes","hms","DButtonDatetime","_datetimeMask","toMask","DButtonFile","_opener","newOpener","DButtonFileAs","onResolve","getChecker","getOpener","DButtonLink","link","DButtonRadio","DButtonRadioRight","commandController","getCommandController","DButtonRedo","DButtonSecondary","DListDataSelectionType","SINGLE","MULTIPLE","DListItem","accessor","toLinkUrl","toLinkChecker","clearAndAdd","mapped","last_1","isFound_1","isReverse_1","newSelection_1","isValueChanged","toTitle","toImage","DDialogSelectListItem","content","_updateItemsCount","_isUpdateItemsCalled","_isUpdateItemsCalledForcibly","_itemHeight","_itemWidth","_itemIndexStart","_itemIndexEnd","_workItems","_content","_container","_newItem","toNewItem","_initItem","toInitItem","DItemUpdater","initItem","stripe","initItemNoStriping","callIfNeeded","contentParent","toMapped","dataSize","oldItemIndexStart","oldItemIndexEnd","oldItemCount","itemHeight","itemWidth","contentPadding","contentPaddingTop","contentPaddingBottom","contentPaddingLeft","contentPaddingRight","contentWidthAvailable","newContentHeight","newContentY","newItemIndexLowerBound","newItemIndexUpperBound","newItemIndexStart","newItemIndexEnd","newItemCount","oldItemIndex","itemIndexStartDelta","itemIndexStartDeltaAbs","itemsLength","itemOffsetX","itemOffsetY","ix","iy","unset","cells","cell","moveVertically","moveHorizontally","isLeft","isRight","newIndex","itemIndex","newItemIndex","DListItemUpdater","DDialogSelectListItemUpdater","DListDataMappedImpl","index0","each_","index1","_accessor","_items","DListDataSelectionMultiple","counter_1","result_1","newNodes","oldNodes","oldItem","isCanceled","toId","oldItems","newItemIdMap_1","toItemIdMap","oldItemId","newItemSet_1","toItemSet","existing","DListDataSelectionNone","_item","DListDataSelectionSingle","findById","toLabelDefault","toLink","DListItemAccessorImpl","_selection","toSelection","_mapped","DListDataImpl","onItemChange","DContent","_start","_end","_touchedAt","_isTouched","_fadeOutTimeoutId","_fadeOutDelay","fadeOut","getFadeOutDelay","_isSilent","_onFadeOutTimeoutBound","onFadeOutTimeout","thumb","newThumb","onThumbStateChange","_thumb","DScrollBar","silently","updateThumb","isRegionVisible","fadeOutDelay","fadeOutInterval","onTouchTimeoutBound","thumbState","remainingTime","DScrollBarThumb","getThumbMinimumLength","DScrollBarThumbReflowableHorizontal","DScrollBarThumbHorizontal","onThumbRegionMove","DScrollBarHorizontal","newStart","getLocalPosition","thumbMinimumLength","getMinimumLength","barStart","barLength","DScrollBarThumbReflowableVertical","DScrollBarThumbVertical","DScrollBarVertical","_onUpdate","_isCalled","DPaneScrollBar","_isCalledSilently","verticalWidth","verticalOffsetStart","getOffsetVerticalStart","verticalOffsetEnd","getOffsetVerticalEnd","horizontalHeight","horizontalOffsetStart","getOffsetHorizontalStart","horizontalOffsetEnd","getOffsetHorizontalEnd","scrollbar","initGesture","DPane","position_1","content_1","toContentX","toContentY","_scrollbar","newScrollBar","initScrollBar","onScrollBarUpdate","onScrollBarMoveY","onScrollBarMoveX","gestureUtil","toContent","initContent","newContent","onContentChange","getWheelContentX","getWheelContentY","getWheelSpeed","contentX","contentY","contentWidth","contentHeight","WORK_POINT","clippingRect","WORK_RECTANGLE","getFocusedChildClippingRect","clippingRectX","clippingRectY","clippingRectX0","clippingRectY0","clippingRectX1","clippingRectY1","contentPosition","DList","_updater","newUpdater","updater","DDialogSelectList","search","_search","_","_idCompleted","_result","DDialogSelectSearh","searchResult","DInputSearch","DNote","DNoteSmall","DNoteSmallError","DNoteSmallNoItemsFound","DNoteSmallSearching","DDialogSelect","newInputLayout","newList","noteOptions","note","noteError","newNoteError","_noteError","noteNoItemsFound","newNoteNoItemsFound","_noteNoItemsFound","noteSearching","newNoteSearching","_noteSearching","toSearch","results","onSearched","transition","isDone","getResult","toInputLayoutOptions","toInputMargin","getInputMarginHorizontal","getInputMarginVertical","toListOptions","toNoteOptions","noItemsFound","searching","defaultGetter","defaultSetter","dialogFormatter","toOptions","_dialogGetter","getter","_dialogSetter","setter","DButtonSelect","DDialogTimes","DButtonTime","DButtonUndo","DCanvas","DChartAxisPosition","DChartAxisTickPosition","INSIDE","OUTSIDE","_coordinateIndex","toPosition","_tick","toTickContainer","_bar","toBar","DChartAxisBaseOptionParser","getPosition","getStyle","toBarStroke","tick","getTickEnable","major","toTickMajor","minor","toMinorTick","getMajorTickPosition","optionsStyle","getMajorTickStyle","optionsStroke","toTickMajorStroke","getMajorTickCount","getMajorTickStep","getMajorTickSize","toTickPosition","toMajorTickText","toMajorTickFormatter","gridline","toTickMajorGridline","getMajorTickGridlineStyle","getMajorTickGridlineEnable","toTickMajorGridlineStroke","tickPosition","getMinorTickPosition","getMinorTickStyle","getMinorTickCount","getMinorTickStep","getMinorTickSize","toTickMinorStroke","toStroke","getStrokeEnable","optionsA","optionsB","getMajorTickStrokeEnable","getMajorTickStrokeColor","getMajorTickStrokeAlpha","getMajorTickStrokeWidth","getMajorTickStrokeAlign","getMajorTickStrokeSide","getMajorTickStrokeStyle","getMajorTickGridlineStrokeEnable","getMajorTickGridlineStrokeColor","getMajorTickGridlineStrokeAlpha","getMajorTickGridlineStrokeWidth","getMajorTickGridlineStrokeAlign","getMajorTickGridlineStrokeSide","getMajorTickGridlineStrokeStyle","getMinorTickStrokeEnable","getMinorTickStrokeColor","getMinorTickStrokeAlpha","getMinorTickStrokeWidth","getMinorTickStrokeAlign","getMinorTickStrokeSide","getMinorTickStrokeStyle","getMajorTickTextFormat","toMajorTickTextColor","toMajorTickTextAlign","toMajorTickTextOffset","toMajorTickTextOutline","toMajorTickTextSpacing","toTickMajorTextDirection","toMajorTickTextPadding","getMajorTickTextAlignHorizontal","getMajorTickTextAlignVertical","getMajorTickTextPaddingHorizontal","getMajorTickTextPaddingVertical","getMajorTickTextDirection","getMajorTickTextColor","toLabelColor","toLabelAlign","toLabelOffset","toLabelOutline","toLabelSpacing","toLabelDirection","toLabelPadding","getLabelAlignHorizontal","getLabelAlignVertical","getLabelPaddingHorizontal","getLabelPaddingVertical","getLabelDirection","getLabelColor","parser","coordinateIndex","bar","tickMajorCount","tickMinorCount","_majorTicks","Float64Array","_minorTicks","DChartAxisBase","plotArea","plotAreaWidth","plotAreaHeight","domainMin","domainMax","majorShapes","minorShapes","gridlineShapes","shapePositionY","majorTick","majorCount","majorStep","majorFormatter","minorTick","minorCountPerMajor","minorCount","minorStep","majorTicks","minorTicks","ticks","majorShape","imajorTick","majorTickPosition","majotTickPositionX","majorTickStep","gridlineShape","minorShape","iminorTick","minorTickPosition","minorTickProjectedPosition","shapePositionX","majotTickPositionY","getBoundsInContainer","domainFrom","unmap","domainTo","updateTicksX","updateTicksY","tickShapeContainer","barShape","barPosition","barStyle","tickMajor","gridlinePosition","gridlineCount","gridlineStyle","tickMajorShapes","tickMajorSize","tickMajorPosition","tickMajorStyle","tickMajorShape","tickMinor","tickMinorShapes","tickMinorSize","tickMinorPosition","tickMinorStyle","tickMinorShape","tickMajorGridlineShapes","updateBar","updateTicks","_plotArea","DChartAxisContainerImpl","axes","DChartAxisX","DChartAxisXDatetime","DChartAxisY","DCHART_COLOR_SET_1","DCHART_COLOR_SET_2","DChartColorSet2","DChartCoordinateDirection","X","DChartCoordinateContainerSubImpl","coordinateOrIndex","unbind","mark","cxs","cys","DChartCoordinateContainerImpl","rangeFrom","rangeTo","DChartCoordinateLinearTick","calcStepMajor","power","LN10","toStepScale","calcStepMinor","majorPosition","rangeMin","rangeMax","iresult","minorPosition","majorResult","minorResult","majorStepMapped","toMajorStep","imajorResult","iminorResult","idomainStart","idomainEnd","domainMinMapped","domainMaxMapped","minorStepMapped","toMinorStep","imajor","iminor","majorPositionMapped","minorPositionMapped","_isTranslationEnabled","_translate","_isScalingEnabled","_itranslate","_iscale","DChartCoordinateTransformImpl","isZero","ratioi","newTranslate","oldTranslate","stride","itranslate","iscale","DChartCoordinateTransformMarkImpl","DChartRegionImpl","_mark","DChartCoordinateLinear","doFit_","toFitDomain","toFitRange","series","getDomain","pixelFrom","pixelTo","region","regionFrom","regionTo","regionSize","newTranslation","DChartCoordinateLogTick","domainFromMapped","domainToMapped","idomainStartMapped","idomainEndMapped","DChartCoordinateLog","regionFromMapped","regionSizeMapped","DChartLegendItem","DChartLegend","DChartOverview","DChartPlotAreaContainer","_lastBoundsID","getBoundsInternal","DChartSeriesHitResult","DChartSeriesFillComputedImpl","DChartSeriesScalars","outer","inner","DChartSeriesPaddingComputedImpl","DChartSeriesPointComputedImpl","DChartSeriesStrokeComputedImpl","_domain","_range","DChartSeriesFillImpl","DChartSeriesStrokeImpl","DChartSeriesPointImpl","DChartSeriesPaddingImpl","listLength","DChartSeriesContainerImpl","domain","tmp1","tmp2","WORK_CALCHITPOINT","closest","calcHitPoint","chart","_chart","_blendStartTime","_blendDuration","_blendTimeout","_onBlendBound","onBlend","DChartPlotAreaImpl","_isViewDirty","_isBoundsInContainerDirty","_coordinate","_series","_axis","_boundsInContainer","blendTimeout","DChartRegionImplObservable","newFrom","newTo","setStyle","DChartSelectionShapeBase","newShape","mappedPosition","seriesShape","DChartSelectionGridlineX","mappedX","DChartSelectionGridlineY","mappedY","DChartSelectionGridlineContainerImpl","DChartSelectionMarker","DChartSelectionPoint","PREVIOUS","NEXT","CLOSER","INTERSECTION","_gridline","_coordinateX","_coordinateY","DChartSelectionSubImpl","coordinateX","coordinateY","oldSeries","newSelected","_hovered","newHovered","hovered","_onMoveBound","_onClickBound","DChartSelectionSimple","toSubOptions","gridlineX","gridlineY","WORK_SELECT","_coordinateIndexX","_coordinateIndexY","_coordinateIdUpdatedX","_coordinateIdUpdatedY","_coordinateTransformIdUpdatedX","_coordinateTransformIdUpdatedY","DChartSeriesBaseCoordinateContainer","coordinateIdX","coordinateIdY","isCoordinateXChanged","isCoordinateYChanged","coordinateTransformIdX","coordinateTransformIdY","isCoordinateTransformXChanged","isCoordinateTransformYChanged","_regionPointId","DChartSeriesBase","updateRegion","_line","_pointId","_pointIdUpdated","DChartSeriesLineOfAny","line","newLineOfAny","initLine","sizeDefault","getSizeDefault","offsetDefault","getOffsetDefault","newOffset","isCoordinateChanged","isCoordinateTransformChanged","isTransformDirty","updateLine","xcoordinate","ycoordinate","ivalues","mapAll","WORK_REGION","adjustLineRegion","applyLine","calcRegion","xraw","yraw","calcHitPointTestRange","calcHitPointHitTester","_barCount","_barIndex","_xcoordinateId","_xcoordinateTransformId","_isSizeAutomatic","DChartSeriesBar","newPadding","barIndex","barCount","linePoints","linePointsOffset","linePointsSize","xcoordinateId","xcoordinateTransformId","updateBarCountAndIndex","totalBandWidth","totalBarWidth","barWidth","barX","sizes","sizesLength","offsets","offsetsLength","isize","pointsLength","calcSizeX","sxh","DChartSeriesLineOfCircles","DChartSeriesLineOfRectangleRoundeds","DChartSeriesLineOfRectangles","_sizeId","DChartSeriesLineOfTriangles","DChartSeriesLineOfTriangleRoundeds","_centerX","_centerY","DChartSeriesLine","isPointsDirty","segmentsLength","isegments","segment","_idUpdated","_a","_b","_x0","_y0","DChartSeriesExpressionParametersImpl","_plotAreaSizeXUpdated","_plotAreaSizeYUpdated","_parameters","DChartSeriesLinear","parameters","isParametersChanged","isPlotAreaSizeChagned","toClean","plotAreaSizeX","plotAreaSizeY","aabs","babs","xfrom","xto","yfrom","yto","xfrom1","xto1","yfrom1","yto1","DChart","newPlotArea","_destroyed","DCommandCreate","DCommandDelete","getDocumentController","DCommandSaveAs","saveAs","DCommandSave","DDiagramSnapshot","sizeOrOptions","extractor","sizeOrFilenameOrOptions","viewPosition","viewScale","toCleanupSnap","toCleanupBackground","toCleanupRefit","toCleanupReflow","_serialized","_tileFactory","_controller","_isAmbient","ambient","isAmbient","_snapshot","snapshot","DDiagramBase","oldSerialized","onUnset","onSet","newCanvas","toCanvasBaseBackgroundOptions","getCanvasShadow","factory","getCanvasBackgroundColor","getCanvasBackgroundAlpha","DDiagramCanvasEditorBackground","baseColor","DDiagramCanvasTileMappingPointImpl","lon","lat","cb","mappingOrEnable","lon0","lat0","lon1","lat1","_cb","DDiagramCanvasTileMappingImpl","_factory","onMappingChange","DDiagramCanvasTile","pyramid","_pyramid","interactives","DDiagramLayer","ids","actionables","toRuntime","doInitialize","shapeData","shapeDatum","shapeDatumId","shapeDatumList","shapeId","this_1","DDiagramLayerContainer","onLayerChange","activate","addChildAt","activateNext","toBackgroundBase","_tile","DDiagramCanvasBase","getBackgroundBase","_grid","toGrid","DDiagramCanvasEditorSnap","toGridMajor","toGridMinor","getSnapGridSize","getSnapGridMajorInterval","getSnapGridMajorColor","getSnapGridMajorAlpha","getSnapGridMajorWidth","getSnapGridMajorStyle","getSnapGridMinorColor","getSnapGridMinorAlpha","getSnapGridMinorWidth","getSnapGridMinorStyle","getSnapTargetColor","getSnapTargetAlpha","getSnapTargetWidth","getSnapTargetStyle","isGridVisible","isTargetVisible","wh","hh","_snap","toSnap","DDiagramCanvasEditor","_downeds","DDiagramCanvas","layerChildren","hitTestInteractives","toShapeCursor","toShapeTitle","overed","_overed","onShapeOut","onShapeOver","_downed","downeds","onShapeCancel","downed","onUpOutside","WORK_DBLCLICK","DDiagramDataRemote","diagram","_diagram","_mapper","mapper","_remote","DDiagramData","datumValue","toIsEnabled","toCreateAsUrlOptions","DDiagramEditorThumbnail","isThumbnailEnabled","getThumbnailSize","toSize","toCleanup","createAsUrl","_snapper","_thumbnail","DDiagramEditor","toCanvasOptions","toCanvasBaseOptions","snapper","simple","toSimple","newId","isNew","DDiagramShape","actionable","runtimeEffect","onShapeMove","onShapeUp","onShapeClick","DDiagram","initializeShapes","dataShape","dataMapper","formatterMap","initialMap","actionMap","runtimeConstructor","datumFormat","datumInitial","toDataShape","onShapeDown","onShapeDblClick","DDialogConfirmMessage","DDialogConfirm","message","newMessage","toMessageOptions","toMessageOptionsMerged","getMessage","_message","toMessage","DDialogConfirmDelete","DDialogConfirmDiscard","DDialogMessage","DDialogProcessingMessage","_isDone","_delayDone","getDoneDelay","delayClose","_delayClose","getCloseDelay","_messageText","DDialogProcessing","timeoutId","_timeoutId","closeTimeoutId","_closeTimeoutId","onDone","onRejected","DDialogSaveAs","getName","_closeables","DMenuContext","closeables","DMenu","_fit","_sub","moveFocusVertically","setMenuCreator","DDropdownBase","onMenuSelectBound","_onMenuSelectBound","onMenuCloseBound","_onMenuCloseBound","toMenuOptions","oldMenu","onMenuReplaced","onMenuClose","onKeyDownArrowDown","DDropdown","DExpandableHeader","DExpandable","DInputIntegerAndLabel","DInputTextArea","DListItemAmbient","tileSize","_tileSize","DMapCoordinateEPSG3857","lonlat","meters","C","CIRCUMFERENCE_HALF","tan","atan","exp","tz","R","Z","metersToTile","lonLatToMeters","metersToPixels","metersToLonLat","pixelsToMeters","toResolutionMeter","DMapCoordinates","_sprite","DMapTile","onLoaded","BaseImageResource","_onLoaded","_isOnLoadedCalled","_isOnLoadedAllowed","_onLoadedBound","_tz","_lon0","_lat0","_lon1","_lat1","_tiles","_renderTileBound","renderTile","_txmin","_txmax","_tymin","_tymax","_deleteTileBound","tileCode","tiles","deleteTile","_destroyTileBound","destroyTile","_updateLoadingStateForEach","loaded","_isLoaded","_tileCount","toTileCount","_tileScaleRelative","_tileScale","getTileSize","DMapTilePlane","oldLon0","oldLat0","oldLon1","oldLat1","lonLatToTile","tx1","ty1","tileCount","txmin","txmax","tymin","tymax","dtxmin","dtxmax","dtymin","dtymax","isTxMinChanged","isTxMaxChanged","isTyMinChanged","isTyMaxChanged","ctx","cty","ltx","lty","lt","toOffset","loadTile","it","txa","loadTilesY","txb","tya","loadTilesX","tyb","toTileCode","toTilePosition","newTile","load","tileScaleRelative","tileToPixels","updateLoadingState","tileScale","_mappingInternal","toMapping","_z","_minZ","plane","_maxZ","_planes","_fitBound","_fitBoundTimeout","_fitThrottle","throttle","fitThrottledBound","fitThrottled","_fitThrottledBound","DMapTilePyramidImpl","WORK_LONLAT","lonLatToPixels","dmin","oldMapping","planes","planeTz","toZ","toTileZ","newPlane","pixelsToLonLat","destroyPlanesBefore","destroyPlanesAfter","DMapTileUrlBuilderOsmfj","DMapTilePyramids","THROTTLE","DEFAULT","toPlaneOptions","DMenuBarItem","DMenuBar","toItem","moveFocusHorizontally","DMenuSidedContent","DMenuSidedSelectionType","SINGLE_ONCE","defaultFilter","_filter","filter","getFilterDefault","DMenuSidedSelection","set_","hasMenu","setState","newSelection","DMenuSided","DNoteError","DNoteNoItemsFound","DNoteSearching","DPaginationButtonLast","DPaginationButtonNext","DPaginationButtonPage","DPaginationButtonPrevious","DPaginationButtonTop","DPaginationDots","DPaginationPage","buttonTop","buttonPrevious","buttonPages0","buttonPages0Length","dots0","buttonPages1","buttonPages1Length","dots1","buttonNext","buttonLast","DPagination","getButtonSpace","_dots0","newDots","_dots1","_buttonLast","newButtonLast","onButtonLastActive","oldIndex","_buttonNext","newButtonNext","onButtonNextActive","_buttonPrevious","newButtonPrevious","onButtonPreviousActive","_buttonTop","newButtonTop","onButtonTopActive","onButtonPageActive","_buttonPages0","newButtonPages0","newButtonPage","_buttonPages1","newButtonPages1","_page","newPage","top_1","buttonPage","DSelectMultiple","oldValues","updateMenuItems","isSameValues","addedValue","removedValue","childValue","DSelect","findMenuItem","_offsetX","_offsetY","onTextureUpdate","DShadowImpl","NineSlicePlane","DSliderLabel","DSliderThumb","DSliderValue","_rounder","toRounder","rounder","getPrecision","DSlider","_ratioValue","_track","newTrack","_trackSelected","newTrackSelected","newLabelMin","newLabelMax","onTrackDown","onTrackSelectedDown","_onTrackUpBound","onTrackUpBound","_onTrackSelectedUpBound","onTrackSelectedUpBound","onThumbDown","_onThumbMoveBound","onThumbMove","_onThumbUpBound","onThumbUp","onValuesChange","toValueOptions","toLabelMinOptions","toLabelMaxOptions","_interactionManager","onPick","onThumbMoveBound","onThumbUpBound","newMin","newMax","DSliderTrack","DSliderTrackHorizontal","DSliderHorizontal","track","getValueMargin","moveThumbPosition","updateValue","DSliderTrackVertical","DSliderVertical","trackSelected","DTableBodyCells","columnIndex","toReadOnly","toRenderable","_rowIndex","_columnIndex","_column","_isSyncEnabled","sync","isSyncEnabled","DTableBodyCellSelectDialog","selecting","oldValue_1","_row","rowIndex","supplimental","setReadOnly","setRenderable","DTableBodyCellActionDialog","DTableBodyCellActionMenu","DTableBodyCellSelectPromise","promise","DTableBodyCellActionPromise","DTableBodyCellText","DTableBodyCellButton","DTableColumnType","INDEX","INTEGER","REAL","CHECK","CHECK_SINGLE","SELECT","DATETIME","LINK","TREE","DTableBodyCellCheck","onChangeSingle","tableBodyRow","tableBody","isChanged_1","getter_1","setter_1","DTableBodyCellColor","DTableBodyCellDate","DTableBodyCellDatetime","DTableBodyCellIndex","DTableBodyCellInputInteger","DTableBodyCellInputReal","DTableBodyCellInputText","DTableBodyCellInputTreeInput","DTableBodyCellInputTreeMarker","DTableState","START","END","FROZEN","FROZEN_END","SORTABLE","SORTED_ASCENDING","SORTED_DESCENDING","HAS_CHILDREN","OPENED","CHECKABLE","SELECTABLE","toBaseOptions","DTableBodyCellInputTree","onMarkerActive","hasChildren","level","markerState","getLevelPadding","adjLeft","DTableBodyCellLink","DTableBodyCellSelectMenu","DTableBodyCellSelectMultiple","DTableBodyCellTime","DTableBodyCellTree","newLink","DTableDataSelectionType","_frozen","frozen","_columns","columns","DTableRow","toIndexEnd","newCell","cellState","resetFrozenCellPosition","cellsLength","getContentPositionX","cellIndex","shiftX","isEven","_onCellChangeBound","initCells","DTableBodyRow","cellOptions","toCellOptions","newCellEditable","newCellUnediable","newCellSelect","newCellAction","multiple","columnWeight","columnWidth","columnFormatter","columnAlign","columnSelecting","columnSelectingMenu","columnEditing","columnLink","columnsLength","isCell","_isApplied","_sorterId","_filtered","DTableDataListFilter","indicesSorted","filtered","sorter","rows","indexSorted","newFiltered","sortedIndex","indicesFiltered","DTableDataListMapped","unmappedIndex","supplimentals","COMPARATOR","DTableDataListSelection","oldSize","result_2","lastRowIndex","includeFrom","includeTo","rowIndices","shifted","DTableDataOrder","_comparator","_sorted","DTableDataListSorter","comparator","toComparator","newSorted","_rows","toRows","_sorter","DTableDataList","newRows","rowsLength","newRowsLength","rowOptions","selectionType","getRowHeight","toRowOptions","_rowOptions","_rowHeight","_rowIndexMappedStart","_rowIndexMappedEnd","_updateRowsCount","_isUpdateRowsCalled","_isUpdateRowsCalledForcibly","_workRows","_onRowChangeBound","DTableBody","isData","rowHeight","dataMappedSize","oldRowIndexMappedStart","oldRowIndexMappedEnd","oldRowCount","newRowIndexMappedLowerBound","newRowIndexMappedUpperBound","newRowIndexMappedStart","newRowIndexMappedEnd","newRowCount","oldRowIndexMapped","newRow","rowIndexMappedStartDelta","rowIndexMappedStartDeltaAbs","resetRow","isRowSelectable","rowState","updateFrozenCellPosition","rowIndexMapped","WORK_ON_CLICK","toRowIndexMapped","toRow","toCell","onRowSelect","isSingle","isNotSingle","isEmpty","rowIndexSorted","lastRowIndexSorted","indexFiltered","DTableCategoryCell","DTableCategory","DTableDataTreeFilter","isFiltered","hasFiltered","addAllToFiltered","newFilteredSub","toParent","DTableDataTreeSelectionImpl","oldRows","getFirst","toIndex","getLast","DTableDataTreeSorter","toAccessor","_isRowsDirty","_supplimentals","_flags","WeakMap","DTableDataTree","DTableDataTreeItemAccessor","_nodes","onNodeChange","updateRows","flags","irows","ilevel","nodesLength","idelta","toSupplimental","_isFilterable","filterable","_isEmittable","emittable","DTableHeaderCellCheck","isFilterable","isEmittable","isChecked","data_1","iteratee_1","newIteratee","DTableHeaderCell","_check","sortable","sorting","checkable","_onSorterChangeBound","onSorterChange","isApplied","checkWork","_checkWork","isSortable","toClickPosition","isCheckClicked","doSort","onSorterChangeBound","_table","DTableHeader","DTableScrollBar","defaultGetterEmpty","defaultSetterEmpty","toColumnDataChecker","pathLength_1","key_3","toColumnEditingEnable","toColumnEditing","editable","rowA","rowB","valueB","toColumnSorting","toColumnMenu","toColumnDialog","defaultSelectingGetter","defaultSelectingSetter","toColumnSelecting","toColumnRenderable","toColumn","toColumnAlign","toColumnPath","key_1","toPathGetter","default","toColumnGetter","key_2","toPathSetter","toColumnSetter","category","setWidth","toContentWidth","onRowClick","categories","DTable","toColumns","toFrozen","_categories","newCategories","tcolumn","ccolumn","isSameCategory","toCategoryLabel","toCategoryColumns","getCategoryCount","toCategoryOptions","columnWidthTotal","_headerOffset","newHeaderOffset","headerOffset","hasHeader","toHeaderOptions","_bodyOffset","newBodyOffset","bodyOffset","toBodyOptions","toFrozenCellX","cellFrozen","onKeyDownArrowUpOrDown","oldFocusable","oldCell","oldRow","newRowChild","newCellSibling","oldCellIndex","newFocusable","DTreeDataSelectionType","_levels","DTreeDataMappedImpl","parentNodes","levels","parentNodesLength","parentNode","isExpanded","DTreeDataSelectionMultiple","result_3","DTreeDataSelectionSingle","oldNode","newNode","DTreeDataSelectionNone","_nodeToFlag","DTreeNodeAccessorImpl","DTreeDataImpl","nodeToFlag","sibling","DTreeItemState","DTreeItemText","isNodeChanged","expand","collapse","DTreeItemButton","DTreeItemNonEditable","DTreeItemUpdater","DTree","expandAll","collapseAll","isCollapsed","addBefore","addAfter","stops","radian","centerMode","isPerfect","hsize","wcardinal","ui"],"mappings":"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L,EAAU,EAC1BG,IAAUE,GAAML,EAAU,EAC1BG,IAAUE,GAAML,EAAU,EAC1BG,IAAUE,GAAML,EAAU,EAC1BG,IAAUE,GAAML,EAAU,EAG1BG,IAAUE,GAAML,EAAU,EAC1BG,IAAUE,GAAML,EAAU,EAC1BG,IAAUE,GAAML,EAAU,GAC1BG,IAAUE,GAAML,EAAU,EAC1BG,IAAUE,GAAML,EAAU,GAC1BG,IAAUE,GAAML,EAAU,GAG1BG,IAAUE,GAAML,EAAU,GAC1BG,IAAUE,GAAML,EAAU,GAC1BG,IAAUE,GAAML,EAAU,GAC1BG,IAAUE,GAAML,EAAU,GAC1BG,IAAUE,GAAML,EAAU,GAC1BG,IAAUE,GAAML,EAAU,GAG1BG,IAAUE,GAAML,EAAU,GAC1BG,IAAUE,GAAML,EAAU,GAC1BG,IAAUE,GAAML,EAAU,GAC1BG,IAAUE,GAAML,EAAU,GAC1BG,IAAUE,GAAML,EAAU,GAC1BG,IAAUE,GAAML,EAAU,GAE1BG,IAAUE,GAAML,EAAU,GAC1BG,IAAUE,GAAML,EAAU,GAC1BG,IAAUE,GAAML,EAAU,GAC1BG,IAAUE,GAAML,EAAU,GAC1BG,IAAUE,GAAML,EAAU,GAC1BG,IAAUE,GAAML,EAAU,GAG1BG,IAAUE,GAAML,EAAU,GAC1BG,IAAUE,GAAML,EAAU,GAC1BG,IAAUE,GAAML,EAAU,GAC1BG,IAAUE,GAAML,EAAU,GAC1BG,IAAUE,GAAML,EAAU,GAC1BG,IAAUE,GAAML,EAAU,GAE1BG,IAAUE,GAAML,EAAU,GAC1BG,IAAUE,GAAML,EAAU,GAC1BG,IAAUE,GAAML,EAAU,GAC1BG,IAAUE,GAAML,EAAU,GAC1BG,IAAUE,GAAML,EAAU,GAC1BG,IAAUE,GAAML,EAAU,GAG1BG,IAAUE,GAAML,EAAU,GAC1BG,IAAUE,GAAML,EAAU,GAC1BG,IAAUE,GAAML,EAAU,GAC1BG,IAAUE,GAAML,EAAU,GAC1BG,IAAUE,GAAML,EAAU,GAC1BG,IAAUE,GAAML,EAAU,GAE1BG,IAAUE,GAAML,EAAU,GAC1BG,IAAUE,GAAML,EAAU,GAC1BG,IAAUE,GAAML,EAAU,GAC1BG,IAAUE,GAAM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AI6qG,EAAMC,GACtBC,GAAY9B,GAAkB+B,EAAOC,GAAU,IAE/CE,GACC90G,EACAC,EACAC,EACAw0G,EACAj1G,EAAU0G,EAASuuG,EACnBL,EACAO,EACAD,EACAR,EACAr1G,EACAuB,EACAo0G,GAIKD,EA6BP,IA3BIA,EAAO,EACPC,EAAQ,EACRC,EAAWj1G,EAIX,IADAk1G,EAAOL,EAAa,MAEvBG,EAAQI,GACP70G,EACAC,EACAC,EACAw0G,GACC,EACDL,EACA,EACAM,EACAR,EACAr1G,EACAuB,EACAo0G,GAEDD,EAAOhzG,KAAKmI,IAAI6qG,EAAMC,GACtBC,GAAY9B,GAAkB+B,GAAM,IAIjCC,EAAWD,EACNr3G,EAAI,EAAGA,EAAIi3G,IAAsBj3G,EAErC,IADJq3G,EAAOL,EAAah3G,IACJs3G,IACfH,EAAQI,GACP70G,EACAC,EACAC,EACAw0G,GACC,EACDL,EACAO,EACAD,EACAR,EACAr1G,EACAuB,EACAo0G,GAEDD,EAAOhzG,KAAKmI,IAAI6qG,EAAMC,GACtBC,GAAY9B,GAAkB+B,EAAOC,GAAU,IAEhDA,EAAWD,EAsCZ,OAjCI,IADJA,EAAOR,GACSS,GACfH,EAAQI,GACP70G,EACAC,EACAC,EACAw0G,EACAj1G,EAAU0G,EAASuuG,EACnBL,EACAO,EACAD,EACAR,EACAr1G,EACAuB,EACAo0G,GAEDD,EAAOhzG,KAAKmI,IAAI6qG,EAAMC,GACtBC,GAAY9B,GAAkB+B,EAAOC,GAAU,IAE/CE,GACC90G,EACAC,EACAC,EACAw0G,EACAj1G,EAAU0G,EAASuuG,EACnBL,EACAO,EACAD,EACAR,EACAr1G,EACAuB,EACAo0G,GAGKD,EAGR,OAAIJ,EACIW,GACN/0G,EACAC,EACAC,EACAT,EACA0G,EACAkuG,EACA,EACAF,EACAA,EACAr1G,EACAuB,GAGMw0G,GACN70G,EACAC,EACAC,EACAT,EACA0G,EACAkuG,EACA,EACAF,EACAA,EACAr1G,EACAuB,EACA,IAMEy0G,GAAkD,SACvD90G,EACAC,EACAC,EACAT,EACA0G,EACAkuG,EACAW,EACAC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"}